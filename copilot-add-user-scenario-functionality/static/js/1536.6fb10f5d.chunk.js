"use strict";(self.webpackChunksgex_workbench=self.webpackChunksgex_workbench||[]).push([[1536],{11536:(e,t,s)=>{s.r(t),s.d(t,{default:()=>m});var a=s(89379),n=s(9950),i=s(69396),o=s(46901),l=s(57561),c=s(53782),r=s(44414);const d=e=>{let{page:t,onClose:s}=e;if(!t)return null;const a=t.content?atob(t.content.content):"";return(0,r.jsx)("div",{className:"page-view-modal-overlay",onClick:e=>{e.target===e.currentTarget&&s()},children:(0,r.jsxs)("div",{className:"page-view-modal",children:[(0,r.jsxs)("div",{className:"page-view-modal-header",children:[(0,r.jsx)("h2",{children:t.title}),(0,r.jsx)("button",{className:"close-btn",onClick:s,"aria-label":"Close page view",children:"\xd7"})]}),(0,r.jsxs)("div",{className:"page-view-modal-content",children:[(0,r.jsxs)("div",{className:"page-info",children:[(0,r.jsx)("span",{className:"page-filename",children:t.filename}),(0,r.jsx)("span",{className:"page-path",children:t.path})]}),(0,r.jsxs)("div",{className:"page-content",children:[(0,r.jsxs)("div",{className:"content-tabs",children:[(0,r.jsx)("button",{className:"tab-btn active",children:"Rendered"}),(0,r.jsx)("button",{className:"tab-btn",onClick:()=>{const e=document.querySelector(".rendered-content"),t=document.querySelector(".raw-content"),s=document.querySelectorAll(".tab-btn");"none"===e.style.display?(e.style.display="block",t.style.display="none",s[0].classList.add("active"),s[1].classList.remove("active")):(e.style.display="none",t.style.display="block",s[0].classList.remove("active"),s[1].classList.add("active"))},children:"Raw Markdown"})]}),(0,r.jsx)("div",{className:"rendered-content",dangerouslySetInnerHTML:{__html:(n=a,n.replace(/^# (.*$)/gim,"<h1>$1</h1>").replace(/^## (.*$)/gim,"<h2>$1</h2>").replace(/^### (.*$)/gim,"<h3>$1</h3>").replace(/^\* (.*$)/gim,"<li>$1</li>").replace(/^- (.*$)/gim,"<li>$1</li>").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`(.*?)`/g,"<code>$1</code>").replace(/\n/g,"<br>"))}}),(0,r.jsx)("div",{className:"raw-content",style:{display:"none"},children:(0,r.jsx)("pre",{children:a})})]})]})]})});var n};var h=s(41838),g=s(32675);const m=()=>{const e=(0,i.zy)(),t=(0,i.Zp)(),{profile:s,repository:m,selectedBranch:u}=e.state||{},[p,f]=(0,n.useState)([]),[v,x]=(0,n.useState)(!0),[b,j]=(0,n.useState)(null),[y,N]=(0,n.useState)(!1),[w,k]=(0,n.useState)(!0),[A,S]=(0,n.useState)(null),[C,E]=(0,n.useState)(null);(0,n.useEffect)(()=>{(async()=>{if(o.A.isAuth())return void k(!1);const e=sessionStorage.getItem("github_token")||localStorage.getItem("github_token");if(e){console.log("Restoring GitHub authentication from stored token");o.A.authenticate(e)?console.log("GitHub authentication restored successfully"):(console.warn("Failed to restore GitHub authentication"),sessionStorage.removeItem("github_token"),localStorage.removeItem("github_token"))}else console.warn("No stored GitHub token found");k(!1)})()},[]),(0,n.useEffect)(()=>{w||(async()=>{if(m&&s&&!w)try{var e;const t=await o.A.checkRepositoryWritePermissions((null===(e=m.owner)||void 0===e?void 0:e.login)||m.full_name.split("/")[0],m.name);N(t)}catch(b){console.warn("Could not check write permissions:",b),N(!1)}})()},[m,s,w]),(0,n.useEffect)(()=>{m&&u&&!w&&l.A.initialize(m,u)},[m,u,w]),(0,n.useEffect)(()=>{(async()=>{if(!s||!m)return void t("/");if(w)return;if(!o.A.isAuth())return j("GitHub authentication not available. Please return to the home page and sign in again."),void x(!1);let e=0;for(;e<3;){try{var a;x(!0),j(null);const t=(null===(a=m.owner)||void 0===a?void 0:a.login)||m.full_name.split("/")[0],s=m.name,n=u||"main";if(console.log("Loading pages for ".concat(t,"/").concat(s," on branch: ").concat(n," (attempt ").concat(e+1,")")),console.log("selectedBranch:",u),console.log("GitHub auth status:",o.A.isAuth()),console.log("GitHub octokit:",!!o.A.octokit),!o.A.isAuth()||!o.A.octokit){if(e<2){console.log("GitHub service not ready, waiting..."),await new Promise(e=>setTimeout(e,1e3)),e++;continue}throw new Error("GitHub service not authenticated. Please return to the home page and sign in again.")}const i=await G(t,s,n);if(!i)throw new Error('sushi-config.yaml not found in repository on branch "'.concat(n,'"'));const l=H(i),c=await _(t,s,n,l);f(c);break}catch(b){if(console.error("Failed to load pages:",b),e<2){e++,await new Promise(e=>setTimeout(e,500));continue}j(b.message)}finally{x(!1)}break}})()},[s,m,u,t,w]);const G=async(e,t,s)=>{try{if(!o.A.isAuth()||!o.A.octokit)throw new Error("GitHub service not authenticated");console.log("Fetching sushi-config.yaml from ".concat(e,"/").concat(t," on branch ").concat(s));const{data:a}=await o.A.octokit.rest.repos.getContent({owner:e,repo:t,path:"sushi-config.yaml",ref:s});return"file"===a.type&&a.content?(console.log("Successfully fetched sushi-config.yaml"),atob(a.content)):(console.log("sushi-config.yaml found but no content or not a file"),null)}catch(b){throw console.error("Failed to fetch sushi-config.yaml:",b),404===b.status?new Error('sushi-config.yaml not found in repository on branch "'.concat(s,'"')):403===b.status?new Error("Access denied - insufficient permissions to read repository contents"):401===b.status?new Error("Authentication failed - please check your GitHub token"):o.A.isAuth()?new Error("Failed to fetch sushi-config.yaml: ".concat(b.message)):new Error("GitHub service not authenticated")}},H=e=>{const t=[];try{const s=e.split("\n");let a=!1,n=0;for(let e=0;e<s.length;e++){const i=s[e],o=i.trim();if("pages:"!==o){if(a){const a=i.length-i.trimStart().length;if(o&&a<=n)break;if(o.endsWith(".md:")){const i=o.replace(":","").trim();let l=i;for(let t=e+1;t<s.length;t++){const e=s[t],n=e.trim(),i=e.length-e.trimStart().length;if(n&&i<=a)break;if(n.startsWith("title:")){l=n.replace("title:","").trim();break}}t.push({title:l,filename:i,path:"input/pagecontent/".concat(i),level:Math.floor((a-n)/2)})}else if(o.endsWith(":")&&!o.includes(".md")){const e=o.replace(":","").trim();e&&t.push({title:e,isSection:!0,level:Math.floor((a-n)/2)})}}}else a=!0,n=i.length-i.trimStart().length}}catch(b){console.error("Failed to parse pages from sushi-config.yaml:",b)}return t},_=async(e,t,s,n)=>{const i=[];for(const l of n){if(l.isSection){i.push(l);continue}let n=!1,c=null;try{if(o.A.isAuth()&&o.A.octokit){const{data:a}=await o.A.octokit.rest.repos.getContent({owner:e,repo:t,path:l.path,ref:s});"file"===a.type&&(n=!0,c=a)}}catch(b){n=!1}i.push((0,a.A)((0,a.A)({},l),{},{exists:n,content:c,githubUrl:"https://github.com/".concat(e,"/").concat(t,"/blob/").concat(s,"/").concat(l.path)}))}return i};return(0,n.useEffect)(()=>{s&&m||t("/")},[s,m,t]),s&&m?(0,r.jsx)(c.Mx,{pageName:"pages-manager",children:(0,r.jsxs)("div",{className:"pages-manager",children:[(0,r.jsxs)("div",{className:"pages-content",children:[(0,r.jsx)(g.A,{repository:m,selectedBranch:u,hasWriteAccess:y,profile:s}),(0,r.jsxs)("div",{className:"pages-main",children:[(0,r.jsxs)("div",{className:"pages-intro",children:[(0,r.jsxs)("h2",{children:[(0,r.jsx)("span",{className:"component-icon",style:{color:"#8b5cf6"},children:"\ud83d\udcc4"}),"Pages"]}),(0,r.jsxs)("p",{children:["Published page content and documentation for ",(0,r.jsx)("strong",{children:m.name}),u&&(0,r.jsxs)("span",{children:[" on branch ",(0,r.jsx)("code",{className:"branch-display",children:u})]}),". Pages are defined in ",(0,r.jsx)("code",{children:"sushi-config.yaml"})," and stored as Markdown files in ",(0,r.jsx)("code",{children:"input/pagecontent/"}),"."]})]}),(v||w)&&(0,r.jsxs)("div",{className:"loading-state",children:[(0,r.jsx)("div",{className:"loading-spinner"}),(0,r.jsx)("p",{children:w?"Initializing GitHub authentication...":"Loading pages from sushi-config.yaml..."})]}),b&&(0,r.jsxs)("div",{className:"error-state",children:[(0,r.jsx)("div",{className:"error-icon",children:"\u26a0\ufe0f"}),(0,r.jsxs)("div",{className:"error-content",children:[(0,r.jsx)("h3",{children:"Could not load pages"}),(0,r.jsx)("p",{children:b}),(0,r.jsxs)("div",{className:"error-suggestions",children:[(0,r.jsx)("p",{children:"Make sure:"}),(0,r.jsxs)("ul",{children:[(0,r.jsxs)("li",{children:["The repository contains a ",(0,r.jsx)("code",{children:"sushi-config.yaml"})," file",u&&' on branch "'.concat(u,'"')]}),(0,r.jsxs)("li",{children:["The sushi-config.yaml file has a ",(0,r.jsx)("code",{children:"pages:"})," section"]}),(0,r.jsx)("li",{children:"You have access to view the repository contents"}),u&&"main"!==u&&(0,r.jsxs)("li",{children:['The branch "',u,'" exists and is accessible']})]})]})]})]}),!v&&!w&&!b&&0===p.length&&(0,r.jsxs)("div",{className:"empty-state",children:[(0,r.jsx)("div",{className:"empty-icon",children:"\ud83d\udcc4"}),(0,r.jsx)("h3",{children:"No pages found"}),(0,r.jsx)("p",{children:"This repository doesn't have any pages defined in sushi-config.yaml"}),(0,r.jsx)("div",{className:"empty-actions",children:(0,r.jsx)("a",{href:"https://github.com/".concat(m.full_name,"/blob/").concat(u||"main","/sushi-config.yaml"),target:"_blank",rel:"noopener noreferrer",className:"btn-secondary",children:"View sushi-config.yaml"})})]}),!v&&!w&&!b&&p.length>0&&(0,r.jsxs)("div",{className:"pages-list",children:[(0,r.jsxs)("div",{className:"pages-header-info",children:[(0,r.jsxs)("div",{className:"pages-count",children:[p.filter(e=>!e.isSection).length," pages found"]}),(0,r.jsx)("div",{className:"pages-actions",children:(0,r.jsx)("a",{href:"https://github.com/".concat(m.full_name,"/blob/").concat(u||"main","/sushi-config.yaml"),target:"_blank",rel:"noopener noreferrer",className:"btn-secondary small",children:"View sushi-config.yaml"})})]}),(0,r.jsx)("div",{className:"pages-tree",children:p.map((e,t)=>(0,r.jsx)("div",{className:"page-item ".concat(e.isSection?"section":"page"," level-").concat(e.level),style:{"--indent-level":e.level},children:e.isSection?(0,r.jsxs)("div",{className:"section-header",children:[(0,r.jsx)("span",{className:"section-icon",children:"\ud83d\udcc1"}),(0,r.jsx)("span",{className:"section-title",children:e.title})]}):(0,r.jsxs)("div",{className:"page-row",children:[(0,r.jsxs)("div",{className:"page-info",children:[(0,r.jsxs)("div",{className:"page-title",children:[(0,r.jsx)("span",{className:"page-status ".concat(e.exists?"exists":"missing"),children:e.exists?"\u2705":"\u274c"}),(0,r.jsx)("span",{className:"page-name",children:e.title}),(0,r.jsxs)("span",{className:"page-filename",children:["(",e.filename,")"]})]}),!e.exists&&(0,r.jsx)("div",{className:"page-error",children:"File not found in repository"})]}),(0,r.jsxs)("div",{className:"page-actions",children:[e.exists&&(0,r.jsx)("button",{onClick:()=>(e=>{S(e)})(e),className:"btn-action view",title:"View page content",children:"\ud83d\udc41\ufe0f View"}),(0,r.jsx)("button",{onClick:()=>(e=>{E(e)})(e),className:"btn-action edit",title:"Edit page with WYSIWYG editor",children:"\u270f\ufe0f Edit"}),(0,r.jsx)("a",{href:e.githubUrl,target:"_blank",rel:"noopener noreferrer",className:"btn-action source",title:"View source on GitHub",children:"\ud83d\udd17 Source"})]})]})},t))})]})]})]}),A&&(0,r.jsx)(d,{page:A,onClose:()=>S(null)}),C&&(0,r.jsx)(h.A,{page:C,onClose:()=>E(null),onSave:async function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"staged";if("staged"!==s){if("direct"===s&&!y)throw new Error("You need write access to save changes. Please upgrade your GitHub token permissions.");if("direct"===s){var a,n,i;const s=(null===(a=m.owner)||void 0===a?void 0:a.login)||m.full_name.split("/")[0],l=u||"main",c=btoa(t),r=null===(n=e.content)||void 0===n?void 0:n.sha;await o.A.octokit.rest.repos.createOrUpdateFileContents({owner:s,repo:m.name,path:e.path,message:"Update ".concat(e.filename," via SGEX Workbench"),content:c,branch:l,sha:r});const d=(null===(i=m.owner)||void 0===i?void 0:i.login)||m.full_name.split("/")[0],h=await G(d,m.name,l);if(h){const e=H(h),t=await _(d,m.name,l,e);f(t)}}}else console.log("Page ".concat(e.filename," has been staged for commit"))}})]})}):(0,r.jsx)(c.Mx,{pageName:"pages-manager",children:(0,r.jsx)("div",{className:"pages-manager",children:(0,r.jsxs)("div",{className:"redirecting-state",children:[(0,r.jsx)("h2",{children:"Redirecting..."}),(0,r.jsx)("p",{children:"Missing required context. Redirecting to home page..."})]})})})}},41838:(e,t,s)=>{s.d(t,{A:()=>c});var a=s(89379),n=s(9950),i=s(57561),o=s(44414);const l=(0,n.lazy)(()=>Promise.all([s.e(3738),s.e(7845),s.e(2383),s.e(5743)]).then(s.bind(s,25743))),c=e=>{let{page:t,onClose:s,onSave:c,title:r,enablePreview:d=!1,variableHelper:h=null,additionalMetadata:g={},onContentChange:m=null}=e;const[u,p]=(0,n.useState)(null!==t&&void 0!==t&&t.content?atob(t.content.content):""),[f,v]=(0,n.useState)(!1),[x,b]=(0,n.useState)("edit");if(!t)return null;return(0,o.jsx)("div",{className:"page-edit-modal-overlay",onClick:e=>{e.target===e.currentTarget&&s()},children:(0,o.jsxs)("div",{className:"page-edit-modal",children:[(0,o.jsxs)("div",{className:"page-edit-modal-header",children:[(0,o.jsx)("h2",{children:r||"Edit ".concat(t.title)}),(0,o.jsxs)("div",{className:"header-actions",children:[d&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("button",{className:"btn-toggle ".concat("edit"===x?"active":""),onClick:()=>b("edit"),disabled:f,title:"Edit mode",children:"\u270f\ufe0f Edit"}),(0,o.jsx)("button",{className:"btn-toggle ".concat("preview"===x?"active":""),onClick:()=>b("preview"),disabled:f,title:"Preview mode",children:"\ud83d\udc41\ufe0f Preview"}),(0,o.jsx)("div",{className:"toolbar-separator"})]}),(0,o.jsx)("button",{className:"btn-secondary",onClick:s,disabled:f,children:"Cancel"}),(0,o.jsx)("button",{className:"btn-primary",onClick:async()=>{v(!0);try{const e=(0,a.A)({title:t.title||r,filename:t.filename,tool:g.tool||"PageEditor",contentType:"markdown"},g);if(!i.A.updateFile(t.path,u,e))throw new Error("Failed to save to staging ground");c&&await c(t,u,"staged"),s()}catch(e){console.error("Failed to save page:",e),alert("Failed to save page to staging ground. Please try again.")}finally{v(!1)}},disabled:f,children:f?"Staging...":"Stage Changes"})]})]}),(0,o.jsxs)("div",{className:"page-edit-modal-content",children:[(0,o.jsxs)("div",{className:"page-info",children:[(0,o.jsx)("span",{className:"page-filename",children:t.filename}),(0,o.jsx)("span",{className:"page-path",children:t.path})]}),h&&(0,o.jsx)("div",{className:"variable-helper-toolbar",children:h}),(0,o.jsx)("div",{className:"md-editor-container",children:(0,o.jsx)(n.Suspense,{fallback:(0,o.jsx)("div",{className:"loading-spinner",children:"Loading editor..."}),children:(0,o.jsx)(l,{value:u,onChange:e=>{const t=e||"";p(t),m&&m(t)},preview:d?x:"edit",height:500,visibleDragBar:!1,"data-color-mode":"light",hideToolbar:f})})})]})]})})}}}]);