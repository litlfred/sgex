"use strict";(self.webpackChunksgex_workbench=self.webpackChunksgex_workbench||[]).push([[7381],{41838:(e,a,s)=>{s.d(a,{A:()=>c});var t=s(89379),n=s(9950),r=s(57561),i=s(44414);const o=(0,n.lazy)(()=>Promise.all([s.e(3738),s.e(7845),s.e(2383),s.e(5743)]).then(s.bind(s,25743))),c=e=>{let{page:a,onClose:s,onSave:c,title:l,enablePreview:d=!1,variableHelper:h=null,additionalMetadata:p={},onContentChange:u=null}=e;const[m,x]=(0,n.useState)(null!==a&&void 0!==a&&a.content?atob(a.content.content):""),[v,g]=(0,n.useState)(!1),[j,b]=(0,n.useState)("edit");if(!a)return null;return(0,i.jsx)("div",{className:"page-edit-modal-overlay",onClick:e=>{e.target===e.currentTarget&&s()},children:(0,i.jsxs)("div",{className:"page-edit-modal",children:[(0,i.jsxs)("div",{className:"page-edit-modal-header",children:[(0,i.jsx)("h2",{children:l||"Edit ".concat(a.title)}),(0,i.jsxs)("div",{className:"header-actions",children:[d&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("button",{className:"btn-toggle ".concat("edit"===j?"active":""),onClick:()=>b("edit"),disabled:v,title:"Edit mode",children:"\u270f\ufe0f Edit"}),(0,i.jsx)("button",{className:"btn-toggle ".concat("preview"===j?"active":""),onClick:()=>b("preview"),disabled:v,title:"Preview mode",children:"\ud83d\udc41\ufe0f Preview"}),(0,i.jsx)("div",{className:"toolbar-separator"})]}),(0,i.jsx)("button",{className:"btn-secondary",onClick:s,disabled:v,children:"Cancel"}),(0,i.jsx)("button",{className:"btn-primary",onClick:async()=>{g(!0);try{const e=(0,t.A)({title:a.title||l,filename:a.filename,tool:p.tool||"PageEditor",contentType:"markdown"},p);if(!r.A.updateFile(a.path,m,e))throw new Error("Failed to save to staging ground");c&&await c(a,m,"staged"),s()}catch(e){console.error("Failed to save page:",e),alert("Failed to save page to staging ground. Please try again.")}finally{g(!1)}},disabled:v,children:v?"Staging...":"Stage Changes"})]})]}),(0,i.jsxs)("div",{className:"page-edit-modal-content",children:[(0,i.jsxs)("div",{className:"page-info",children:[(0,i.jsx)("span",{className:"page-filename",children:a.filename}),(0,i.jsx)("span",{className:"page-path",children:a.path})]}),h&&(0,i.jsx)("div",{className:"variable-helper-toolbar",children:h}),(0,i.jsx)("div",{className:"md-editor-container",children:(0,i.jsx)(n.Suspense,{fallback:(0,i.jsx)("div",{className:"loading-spinner",children:"Loading editor..."}),children:(0,i.jsx)(o,{value:m,onChange:e=>{const a=e||"";x(a),u&&u(a)},preview:d?j:"edit",height:500,visibleDragBar:!1,"data-color-mode":"light",hideToolbar:v})})})]})]})})}},97381:(e,a,s)=>{s.r(a),s.d(a,{default:()=>d});var t=s(9950),n=s(69396),r=s(46901),i=s(57561),o=s(41838),c=s(32675),l=s(44414);const d=()=>{var e,a;const{user:s,repo:d,branch:h}=(0,n.g)(),p=(0,n.zy)(),u=(0,n.Zp)(),{profile:m,repository:x,selectedBranch:v}=p.state||{},[g,j]=(0,t.useState)([]),[b,f]=(0,t.useState)([]),[N,y]=(0,t.useState)(!0),[w,S]=(0,t.useState)(null),[C,k]=(0,t.useState)(!1),[A,E]=(0,t.useState)(null),[I,D]=(0,t.useState)(!1),[P,F]=(0,t.useState)(""),[T,U]=(0,t.useState)(""),z=s||(null===x||void 0===x||null===(e=x.owner)||void 0===e?void 0:e.login)||(null===x||void 0===x||null===(a=x.full_name)||void 0===a?void 0:a.split("/")[0]),_=d||(null===x||void 0===x?void 0:x.name),Z=h||v||"main";(0,t.useEffect)(()=>{(async()=>{if(!r.A.isAuth()){const e=sessionStorage.getItem("github_token")||localStorage.getItem("github_token");e&&r.A.authenticate(e)}})()},[]),(0,t.useEffect)(()=>{x&&Z&&i.A.initialize(x,Z)},[x,Z]),(0,t.useEffect)(()=>{(async()=>{if(z&&_)try{const e=await r.A.checkRepositoryWritePermissions(z,_);k(e)}catch(w){console.warn("Could not check write permissions:",w),k(!1)}})()},[z,_]),(0,t.useEffect)(()=>{z&&_&&(async()=>{if(!z||!_)return S("Missing repository information"),void y(!1);try{y(!0),S(null);const e=await L(z,_,Z);j(e);const a=await M(z,_,Z);f(a)}catch(w){console.error("Error loading scenarios:",w),S(w.message)}finally{y(!1)}})()},[z,_,Z]);const L=async(e,a,s)=>{try{const t=await r.A.octokit.rest.repos.getContent({owner:e,repo:a,path:"input/pagecontent",ref:s}),n=(Array.isArray(t.data)?t.data:[t.data]).filter(e=>"file"===e.type&&e.name.match(/^userscenario-[A-Za-z0-9-]+\.md$/)),i=await Promise.all(n.map(async t=>{try{const n=await r.A.octokit.rest.repos.getContent({owner:e,repo:a,path:t.path,ref:s});return{id:t.name.replace(".md","").replace("userscenario-",""),name:t.name,path:t.path,sha:t.sha,content:n.data}}catch(w){return console.warn("Failed to load content for ".concat(t.name,":"),w),{id:t.name.replace(".md","").replace("userscenario-",""),name:t.name,path:t.path,sha:t.sha,content:null}}}));return i}catch(w){if(404===w.status)return[];throw w}},M=async(e,a,s)=>{const t=[];try{const n=await r.A.octokit.rest.repos.getContent({owner:e,repo:a,path:"input/fsh/actors",ref:s}),i=(Array.isArray(n.data)?n.data:[n.data]).filter(e=>e.name.endsWith(".fsh"));for(const o of i)try{const n=await r.A.octokit.rest.repos.getContent({owner:e,repo:a,path:o.path,ref:s}),i=atob(n.data.content);[...i.matchAll(/Profile:\s+([A-Za-z0-9-]+)/g)].forEach(e=>{const a=e[1],s=i.match(new RegExp('Title:\\s*"([^"]+)"',"i")),n=i.match(new RegExp('Description:\\s*"([^"]+)"',"i"));t.push({id:a,title:s?s[1]:a,description:n?n[1]:"",source:"fsh"})})}catch(w){console.warn("Failed to load persona from ".concat(o.name,":"),w)}}catch(w){}try{const c=await r.A.octokit.rest.repos.getContent({owner:e,repo:a,path:"input/actors",ref:s}),l=(Array.isArray(c.data)?c.data:[c.data]).filter(e=>e.name.endsWith(".json"));for(const d of l)try{const c=await r.A.octokit.rest.repos.getContent({owner:e,repo:a,path:d.path,ref:s}),l=JSON.parse(atob(c.data.content));var n,i,o;if("Person"===l.resourceType||"Practitioner"===l.resourceType)t.push({id:l.id||d.name.replace(".json",""),title:(null===(n=l.name)||void 0===n||null===(i=n[0])||void 0===i?void 0:i.text)||l.id||d.name.replace(".json",""),description:(null===(o=l.text)||void 0===o?void 0:o.div)||"",type:l.resourceType,source:"fhir"})}catch(w){console.warn("Failed to load persona from ".concat(d.name,":"),w)}}catch(w){}return t},R=async(e,a)=>{try{const s=[...a.matchAll(/\{\{persona\.([A-Za-z0-9-]+)\./g)].map(e=>e[1]),t=[...new Set(s)],n={id:e,title:e,description:{uri:"input/pagecontent/userscenario-".concat(e,".md")},personas:t.map(e=>{const a=b.find(a=>a.id===e);return{id:e,title:(null===a||void 0===a?void 0:a.title)||e}})};let o=null;try{const e=await r.A.octokit.rest.repos.getContent({owner:z,repo:_,path:"dak.json",ref:Z});o=JSON.parse(atob(e.data.content))}catch(w){o={resourceType:"DAK",id:_,userScenarios:[]}}o.userScenarios||(o.userScenarios=[]);const c=o.userScenarios.findIndex(a=>a.id===e);c>=0?o.userScenarios[c]=n:o.userScenarios.push(n),i.A.updateFile("dak.json",JSON.stringify(o,null,2),{title:"DAK Configuration",filename:"dak.json",tool:"UserScenarioEditor",contentType:"json"})}catch(w){console.error("Failed to update DAK JSON:",w)}};return N?(0,l.jsx)("div",{className:"user-scenarios-manager",children:(0,l.jsxs)("div",{className:"loading-container",children:[(0,l.jsx)("div",{className:"loading-spinner"}),(0,l.jsx)("p",{children:"Loading user scenarios..."})]})}):w?(0,l.jsx)("div",{className:"user-scenarios-manager",children:(0,l.jsxs)("div",{className:"error-container",children:[(0,l.jsx)("h2",{children:"Error Loading User Scenarios"}),(0,l.jsx)("p",{children:w}),(0,l.jsx)("button",{onClick:()=>u(-1),children:"Go Back"})]})}):(0,l.jsxs)("div",{className:"user-scenarios-manager",children:[(0,l.jsxs)("div",{className:"user-scenarios-header",children:[(0,l.jsx)("h1",{children:"\ud83d\udc65 User Scenarios"}),(0,l.jsxs)("p",{className:"header-subtitle",children:[z,"/",_," on ",Z]})]}),(0,l.jsxs)("div",{className:"user-scenarios-content",children:[(0,l.jsx)(c.A,{repository:{full_name:"".concat(z,"/").concat(_),name:_},selectedBranch:Z}),(0,l.jsx)("div",{className:"scenarios-actions",children:(0,l.jsx)("button",{className:"btn-create-new",onClick:()=>{D(!0),F(""),U("")},disabled:!C,title:C?"":"You need write access to create scenarios",children:"\u2795 Create New Scenario"})}),(0,l.jsxs)("div",{className:"scenarios-list",children:[(0,l.jsxs)("h2",{children:["\ud83d\udcc4 Existing User Scenarios (",g.length,")"]}),0===g.length?(0,l.jsxs)("div",{className:"empty-state",children:[(0,l.jsx)("p",{children:"No user scenarios found in input/pagecontent/"}),(0,l.jsx)("p",{className:"empty-state-hint",children:"User scenario files should be named: userscenario-[ID].md"})]}):(0,l.jsx)("div",{className:"scenarios-grid",children:g.map(e=>(0,l.jsxs)("div",{className:"scenario-card",children:[(0,l.jsx)("div",{className:"scenario-card-header",children:(0,l.jsxs)("h3",{children:["\ud83d\udcdd ",e.name]})}),(0,l.jsxs)("div",{className:"scenario-card-body",children:[(0,l.jsxs)("p",{className:"scenario-id",children:["ID: ",e.id]}),(0,l.jsx)("p",{className:"scenario-path",children:e.path})]}),(0,l.jsx)("div",{className:"scenario-card-actions",children:(0,l.jsx)("button",{className:"btn-edit",onClick:()=>(e=>{E(e)})(e),disabled:!C,title:C?"":"You need write access to edit",children:"\u270f\ufe0f Edit"})})]},e.id))})]})]}),I&&(0,l.jsx)("div",{className:"modal-overlay",onClick:()=>D(!1),children:(0,l.jsxs)("div",{className:"modal-dialog",onClick:e=>e.stopPropagation(),children:[(0,l.jsx)("div",{className:"modal-header",children:(0,l.jsx)("h2",{children:"\u2795 Create New User Scenario"})}),(0,l.jsxs)("div",{className:"modal-body",children:[(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{htmlFor:"scenario-id",children:"Scenario ID"}),(0,l.jsx)("input",{type:"text",id:"scenario-id",className:"form-input ".concat(T?"error":""),value:P,onChange:e=>{F(e.target.value),U("")},placeholder:"e.g., Anc-registration-001",autoFocus:!0}),T&&(0,l.jsx)("div",{className:"error-message",children:T})]}),(0,l.jsxs)("div",{className:"id-requirements",children:[(0,l.jsx)("h4",{children:"\u2139\ufe0f ID Requirements:"}),(0,l.jsxs)("ul",{children:[(0,l.jsx)("li",{children:"\u2713 Must start with a capital letter"}),(0,l.jsx)("li",{children:"\u2713 Can contain letters, numbers, and hyphens"}),(0,l.jsx)("li",{children:"\u2717 Cannot contain underscores"}),(0,l.jsx)("li",{children:"\u2713 Must be unique"})]}),(0,l.jsxs)("p",{className:"id-examples",children:[(0,l.jsx)("strong",{children:"Examples:"}),(0,l.jsx)("br",{}),"\u2705 Anc-registration-001",(0,l.jsx)("br",{}),"\u2705 Health-check",(0,l.jsx)("br",{}),"\u2705 VaccinationRecord",(0,l.jsx)("br",{}),"\u274c anc-registration (must start with capital)",(0,l.jsx)("br",{}),"\u274c Health_check (no underscores)"]})]})]}),(0,l.jsxs)("div",{className:"modal-footer",children:[(0,l.jsx)("button",{className:"btn-secondary",onClick:()=>D(!1),children:"Cancel"}),(0,l.jsx)("button",{className:"btn-primary",onClick:async()=>{const e=(a=P)?/^[A-Z]/.test(a)?/^[A-Za-z0-9-]+$/.test(a)?g.some(e=>e.id.toLowerCase()===a.toLowerCase())?"A scenario with this ID already exists":"":"ID can only contain letters, numbers, and hyphens (no underscores)":"ID must start with a capital letter":"ID is required";var a;if(e)return void U(e);const s="userscenario-".concat(P,".md"),t="input/pagecontent/".concat(s),n={id:P,name:s,path:t,content:{content:btoa("# User Scenario: ".concat(P,"\n\n## Description\n\n[Describe the user scenario here]\n\n## Steps\n\n1. [Step 1]\n2. [Step 2]\n")),encoding:"base64"},filename:s,title:P,isNew:!0};E(n),D(!1)},disabled:!P,children:"Create & Edit"})]})]})}),A&&(0,l.jsx)(o.A,{page:A,title:"Edit User Scenario: ".concat(A.id),onClose:()=>E(null),onSave:async(e,a,s)=>{await R(e.id,a);const t=await L(z,_,Z);j(t)},enablePreview:!0,variableHelper:0===b.length?(0,l.jsxs)("div",{className:"variable-helper",children:[(0,l.jsx)("span",{className:"variable-helper-label",children:"\ud83d\udcdd Insert Variable:"}),(0,l.jsx)("span",{className:"variable-helper-empty",children:"No personas found"})]}):(0,l.jsxs)("div",{className:"variable-helper",children:[(0,l.jsx)("span",{className:"variable-helper-label",children:"\ud83d\udcdd Insert Variable:"}),(0,l.jsxs)("select",{className:"variable-helper-select",onChange:e=>{e.target.value&&(navigator.clipboard.writeText(e.target.value),alert("Copied to clipboard: ".concat(e.target.value)),e.target.value="")},children:[(0,l.jsx)("option",{value:"",children:"Select persona property..."}),b.map(e=>(0,l.jsxs)("optgroup",{label:e.title,children:[(0,l.jsxs)("option",{value:"{{persona.".concat(e.id,".title}}"),children:["Insert ",e.title," - title"]}),(0,l.jsxs)("option",{value:"{{persona.".concat(e.id,".description}}"),children:["Insert ",e.title," - description"]}),(0,l.jsxs)("option",{value:"{{persona.".concat(e.id,".id}}"),children:["Insert ",e.title," - id"]})]},e.id))]}),(0,l.jsx)("span",{className:"variable-helper-hint",children:"(Select a variable to copy to clipboard)"})]}),additionalMetadata:{tool:"UserScenarioEditor",scenarioId:A.id}})]})}}}]);