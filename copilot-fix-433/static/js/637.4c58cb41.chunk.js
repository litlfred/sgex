"use strict";(self.webpackChunksgex_workbench=self.webpackChunksgex_workbench||[]).push([[637],{50637:(e,s,n)=>{n.r(s),n.d(s,{default:()=>A});var a=n(9950),t=n(85001),i=n(67818),o=n(29946),c=n(88498),r=n(18354),l=n(37531),d=n(88259),m=n(44414);const u=e=>{let{helpTopic:s,contextData:n={}}=e;const[t,i]=(0,a.useState)(!1),o=(0,d.A)("sgex-mascot.png");return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("button",{className:"help-button",onClick:()=>{i(!0)},title:"Get Help","aria-label":"Get Help",children:(0,m.jsx)("img",{src:o,alt:"SGEX Helper",className:"help-mascot-icon"})}),t&&(0,m.jsx)(l.A,{topic:s,contextData:n,onClose:()=>{i(!1)}})]})};var h=n(32675),p=n(89379),f=n(31048);const v=(0,a.lazy)(()=>Promise.all([n.e(3738),n.e(7845),n.e(2383),n.e(5743)]).then(n.bind(n,25743))),g=e=>{let{repository:s,selectedBranch:n}=e;const[t,i]=(0,a.useState)(!1),[c,r]=(0,a.useState)(!0),[l,d]=(0,a.useState)([]),[u,h]=(0,a.useState)([]),[g,x]=(0,a.useState)([]),[j,b]=(0,a.useState)([]),[N,y]=(0,a.useState)(!1),[w,k]=(0,a.useState)(null),[q,S]=(0,a.useState)(0),[A,C]=(0,a.useState)({}),[_,D]=(0,a.useState)(null),[I,T]=(0,a.useState)(!1),[E,M]=(0,a.useState)(new Set),[P,R]=(0,a.useState)({}),[L,B]=(0,a.useState)(new Set),[F,O]=(0,a.useState)({}),[H,K]=(0,a.useState)(new Set),[G,W]=(0,a.useState)({}),X=(0,a.useRef)(null),z=(0,a.useCallback)(async()=>{var e,n;if(!s)return;const a=(null===(e=s.owner)||void 0===e?void 0:e.login)||(null===(n=s.full_name)||void 0===n?void 0:n.split("/")[0]),t=s.name;if(a&&t)try{y(!0),k(null);if(s.isDemo||"demo-user"===a){h(["authoring","bug reports","feature request","enhancement","documentation","question"]);const e=[{id:1,number:42,title:"Review ANC clinical decision logic for gestational age calculation",body:"The current decision logic for determining gestational age in the ANC workflow may need refinement based on recent WHO guidance updates. Please review the DMN tables in the decision-support module.",state:"open",labels:[{name:"authoring",color:"0e8a16"},{name:"clinical-review",color:"fbca04"}],user:{login:"clinical-expert"},created_at:"2024-07-15T10:30:00Z",html_url:"https://github.com/".concat(a,"/").concat(t,"/issues/42"),comments:3},{id:2,number:38,title:"Update maternal health indicators based on new WHO recommendations",body:"Recent WHO updates to maternal health indicators need to be incorporated into the program indicators component. This includes new definitions for high-risk pregnancy classifications.",state:"open",labels:[{name:"authoring",color:"0e8a16"},{name:"indicators",color:"d4c5f9"}],user:{login:"who-expert"},created_at:"2024-07-10T14:20:00Z",html_url:"https://github.com/".concat(a,"/").concat(t,"/issues/38"),comments:1},{id:3,number:35,title:"Clarification needed on FHIR profile for antenatal care encounters",body:"The current FHIR profile definitions for antenatal care encounters seem to conflict with some of the business process requirements. Need clinical input on the correct mapping.",state:"closed",labels:[{name:"authoring",color:"0e8a16"},{name:"fhir",color:"c2e0c6"}],user:{login:"implementer"},created_at:"2024-07-05T09:15:00Z",html_url:"https://github.com/".concat(a,"/").concat(t,"/issues/35"),comments:5}];x(e);const s=e.filter(e=>"open"===e.state&&e.labels.some(e=>"authoring"===e.name)).length;return S(s),void y(!1)}const e=o.A.isAuth();let n=[];if(e){const e="".concat(a,"/").concat(t),s=Date.now();if(A[e]&&_&&s-_<3e5)n=A[e];else{const i=await o.A.getIssues(a,t,{state:"all",per_page:100}),c=new Set;i.forEach(e=>{e.labels&&Array.isArray(e.labels)&&e.labels.forEach(e=>{"string"===typeof e?c.add(e):e&&e.name&&c.add(e.name)})}),n=Array.from(c).sort(),C(s=>(0,p.A)((0,p.A)({},s),{},{[e]:n})),D(s)}n.includes("authoring")||n.unshift("authoring")}else n=["authoring","bug reports","feature request","enhancement","documentation","question"];h(n);let i=[];try{i=await o.A.getIssues(a,t,{state:"all",per_page:100})}catch(w){console.warn("Could not fetch issues for repository:",w),i=[]}const c=i.filter(e=>!e.pull_request);x(c);const r=c.filter(e=>"open"===e.state&&e.labels&&e.labels.some(e=>"authoring"===("string"===typeof e?e:e.name))).length;S(r)}catch(i){console.error("Error fetching issues and labels:",i),k("Failed to load discussion data")}finally{y(!1)}},[s,A,_]),Q=(0,a.useCallback)(()=>{if(!g.length)return void b([]);const e=g.filter(e=>(!c||"open"===e.state)&&(!(!c&&"closed"!==e.state)&&(0===l.length||l.some(s=>e.labels&&e.labels.some(e=>("string"===typeof e?e:e.name)===s)))));b(e)},[g,c,l]);(0,a.useEffect)(()=>{z()},[z]),(0,a.useEffect)(()=>{Q()},[Q]),(0,a.useEffect)(()=>(t&&s&&o.A.isAuth()?X.current=setInterval(()=>{z()},5e3):X.current&&(clearInterval(X.current),X.current=null),()=>{X.current&&(clearInterval(X.current),X.current=null)}),[t,s,z]);const U=e=>{const n=e.number;M(a=>{const t=new Set(a);return t.has(n)?t.delete(n):(t.add(n),P[n]||(async e=>{var n,a;if(!s)return;const t=(null===(n=s.owner)||void 0===n?void 0:n.login)||(null===(a=s.full_name)||void 0===a?void 0:a.split("/")[0]),i=s.name,c=e.number;if(!L.has(c)){B(e=>new Set(e).add(c));try{const e=await o.A.getPullRequestIssueComments(t,i,c);R(s=>(0,p.A)((0,p.A)({},s),{},{[c]:e}))}catch(w){console.error("Failed to load comments:",w),R(e=>(0,p.A)((0,p.A)({},e),{},{[c]:[]}))}finally{B(e=>{const s=new Set(e);return s.delete(c),s})}}})(e)),t})},Z=async e=>{var n,a;if(!s||!o.A.isAuth())return;const t=(null===(n=s.owner)||void 0===n?void 0:n.login)||(null===(a=s.full_name)||void 0===a?void 0:a.split("/")[0]),i=s.name,c=e.number,r=F[c];if(null!==r&&void 0!==r&&r.trim()){K(e=>new Set(e).add(c));try{const e=await o.A.createPullRequestComment(t,i,c,r);R(s=>(0,p.A)((0,p.A)({},s),{},{[c]:[...s[c]||[],e]})),O(e=>(0,p.A)((0,p.A)({},e),{},{[c]:""})),W(e=>(0,p.A)((0,p.A)({},e),{},{[c]:!1}))}catch(w){console.error("Failed to submit comment:",w)}finally{K(e=>{const s=new Set(e);return s.delete(c),s})}}},Y=e=>{W(s=>(0,p.A)((0,p.A)({},s),{},{[e]:!s[e]}))},J=(e,s)=>{O(n=>(0,p.A)((0,p.A)({},n),{},{[e]:s}))},V=e=>new Date(e).toLocaleDateString(),$=e=>e.labels&&Array.isArray(e.labels)?e.labels.map(e=>{const s="string"===typeof e?e:e.name,n="string"===typeof e?"#666":e.color||"666";return(0,m.jsx)("span",{className:"issue-label-badge",style:{backgroundColor:"#".concat(n)},children:s},s)}):[];return s?(0,m.jsxs)("div",{className:"discussions-status-bar",children:[(0,m.jsxs)("div",{className:"status-bar-header",onClick:()=>i(!t),children:[(0,m.jsxs)("div",{className:"status-bar-title",children:[(0,m.jsx)("span",{className:"status-icon",children:"\ud83d\udcac"}),(0,m.jsx)("span",{className:"status-text",children:"Discussions"}),q>0&&(0,m.jsx)("span",{className:"notification-badge",children:q})]}),(0,m.jsx)("div",{className:"status-bar-controls",children:(0,m.jsx)("span",{className:"expand-icon",children:t?"\u25bc":"\u25b6"})})]}),t&&(0,m.jsxs)("div",{className:"status-bar-content",children:[(0,m.jsxs)("div",{className:"filter-controls",children:[(0,m.jsxs)("div",{className:"state-filter",children:[(0,m.jsx)("button",{className:"filter-toggle ".concat(c?"active":""),onClick:()=>r(!0),children:"Open"}),(0,m.jsx)("button",{className:"filter-toggle ".concat(c?"":"active"),onClick:()=>r(!1),children:"Closed"})]}),(0,m.jsx)("div",{className:"label-filters",children:u.map(e=>(0,m.jsx)("button",{className:"label-badge ".concat(l.includes(e)?"selected":"disabled"),onClick:()=>(e=>{d(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e])})(e),children:e},e))}),(0,m.jsx)("button",{className:"new-issue-btn",onClick:()=>{var e,n;if(!s)return;const a=(null===(e=s.owner)||void 0===e?void 0:e.login)||(null===(n=s.full_name)||void 0===n?void 0:n.split("/")[0]),t=s.name;if(s.isDemo||"demo-user"===a)alert("Demo Mode: In a real implementation, this would open a new discussion creation modal.");else if(o.A.isAuth())T(!0);else{const e="https://github.com/".concat(a,"/").concat(t,"/issues/new?template=dak_content_error.yml&labels=authoring");window.open(e,"_blank")}},children:"+ New Discussion"})]}),(0,m.jsxs)("div",{className:"issues-list",children:[N&&(0,m.jsx)("div",{className:"loading-state",children:(0,m.jsx)("span",{children:"Loading discussions..."})}),w&&(0,m.jsxs)("div",{className:"error-state",children:[(0,m.jsx)("span",{className:"error-icon",children:"\u26a0\ufe0f"}),(0,m.jsx)("span",{children:w}),(0,m.jsx)("button",{onClick:z,className:"retry-btn",children:"Retry"})]}),!N&&!w&&0===j.length&&(0,m.jsx)("div",{className:"empty-state",children:(0,m.jsx)("span",{children:"No discussions found with current filters"})}),!N&&!w&&j.map(e=>{var n,t,i;const c=e.number,r=E.has(c),l=P[c]||[],d=L.has(c),u=H.has(c),h=G[c],p=F[c]||"";return(0,m.jsxs)("div",{className:"issue-card",children:[(0,m.jsxs)("div",{className:"issue-header",children:[(0,m.jsxs)("div",{className:"issue-title",children:[(0,m.jsx)("span",{className:"issue-state ".concat(e.state),children:"open"===e.state?"\ud83d\udfe2":"\ud83d\udd34"}),(0,m.jsx)("span",{className:"issue-title-text",onClick:()=>(e=>{var n,a;const t=(null===s||void 0===s||null===(n=s.owner)||void 0===n?void 0:n.login)||(null===s||void 0===s||null===(a=s.full_name)||void 0===a?void 0:a.split("/")[0]);(null===s||void 0===s?void 0:s.isDemo)||"demo-user"===t?alert("Demo Mode: In a real implementation, this would open issue #".concat(e.number,' "').concat(e.title,'" in GitHub.')):window.open(e.html_url,"_blank")})(e),style:{cursor:"pointer"},children:e.title})]}),(0,m.jsxs)("div",{className:"issue-controls",children:[(0,m.jsxs)("div",{className:"issue-number",children:["#",e.number]}),(0,m.jsxs)("button",{className:"expand-comments-btn",onClick:s=>{s.stopPropagation(),U(e)},title:r?"Collapse comments":"Show comments and add new comment",children:["\ud83d\udcac ",e.comments||0," ",r?"\u25bc":"\u25b6"]})]})]}),(0,m.jsx)("div",{className:"issue-summary",children:e.body?e.body.substring(0,200)+(e.body.length>200?"...":""):"No description provided"}),(0,m.jsxs)("div",{className:"issue-meta",children:[(0,m.jsx)("div",{className:"issue-labels",children:$(e)}),(0,m.jsxs)("div",{className:"issue-info",children:[(0,m.jsxs)("span",{className:"issue-author",children:["by ",null===(n=e.user)||void 0===n?void 0:n.login]}),(0,m.jsx)("span",{className:"issue-date",children:V(e.created_at)})]})]}),r&&(0,m.jsxs)("div",{className:"issue-comments-section",children:[d&&(0,m.jsx)("div",{className:"loading-comments",children:(0,m.jsx)("span",{children:"Loading comments..."})}),l.length>0&&(0,m.jsx)("div",{className:"comments-list",children:l.map(e=>(0,m.jsxs)("div",{className:"comment-item",children:[(0,m.jsxs)("div",{className:"comment-header",children:[(0,m.jsx)("span",{className:"comment-author",children:e.user.login}),(0,m.jsx)("span",{className:"comment-date",children:V(e.created_at)})]}),(0,m.jsx)("div",{className:"comment-body",children:e.body})]},e.id))}),o.A.isAuth()?(0,m.jsx)("div",{className:"add-comment-form",children:h?(0,m.jsxs)("div",{className:"comment-form-advanced",children:[(0,m.jsx)("div",{className:"markdown-editor-container",children:(0,m.jsx)(a.Suspense,{fallback:(0,m.jsx)("div",{className:"loading-spinner",children:"Loading editor..."}),children:(0,m.jsx)(v,{value:p,onChange:e=>J(c,e||""),preview:"edit",height:200,visibleDragBar:!1,"data-color-mode":"light",hideToolbar:u})})}),(0,m.jsxs)("div",{className:"comment-form-actions",children:[(0,m.jsx)("button",{className:"btn-secondary",onClick:()=>Y(c),disabled:u,children:"Simple Editor"}),(0,m.jsx)("button",{className:"submit-comment-btn",onClick:()=>Z(e),disabled:!p.trim()||u,children:u?"Submitting...":"Comment"})]})]}):(0,m.jsxs)("div",{className:"comment-form-simple",children:[(0,m.jsx)("textarea",{value:p,onChange:e=>J(c,e.target.value),placeholder:"Write a comment... (Click 'Advanced Editor' for markdown preview)",rows:3,disabled:u}),(0,m.jsxs)("div",{className:"comment-form-actions",children:[(0,m.jsx)("button",{className:"advanced-editor-btn",onClick:()=>Y(c),disabled:u,children:"\ud83d\udcdd Advanced Editor"}),(0,m.jsx)("button",{className:"submit-comment-btn",onClick:()=>Z(e),disabled:!p.trim()||u,children:u?"Submitting...":"Comment"})]})]})}):(0,m.jsx)("div",{className:"unauthenticated-comment-notice",children:(0,m.jsxs)("p",{children:["\ud83d\udca1 ",(0,m.jsx)("strong",{children:"Want to comment?"})," ",(0,m.jsx)("a",{href:"https://github.com/".concat((null===(t=s.owner)||void 0===t?void 0:t.login)||(null===(i=s.full_name)||void 0===i?void 0:i.split("/")[0]),"/").concat(s.name,"/issues/").concat(e.number),target:"_blank",rel:"noopener noreferrer",children:"Comment on GitHub"})," or sign in with your GitHub token."]})})]})]},e.id)})]})]}),(0,m.jsx)(f.A,{isOpen:I,onClose:()=>T(!1),issueType:"discussion",repository:s,contextData:{pageId:"discussions-status-bar",selectedDak:s,selectedBranch:n},onSuccess:e=>{console.log("Discussion created successfully:",e),z()},onError:e=>{console.error("Failed to create discussion:",e)}})]}):null};var x=n(30221),j=n(58377),b=n(51635),N=n(1932),y=n(87018),w=n(7082);const k=e=>{let{repository:s,branch:n="main",githubService:t,filters:o={},className:c=""}=e;const{t:r,i18n:l}=(0,i.Bd)(),[d,u]=(0,a.useState)([]),[h,p]=(0,a.useState)(new Set),[f,v]=(0,a.useState)(new Map),[g,x]=(0,a.useState)(new Set),[j,b]=(0,a.useState)(!0),[N,k]=(0,a.useState)(null);(0,a.useEffect)(()=>{(async()=>{try{b(!0),await y.A.initialize();const e=y.A.getCatalog(o);u(e),k(null)}catch(e){console.error("Failed to load FAQ questions:",e),k(e.message)}finally{b(!1)}})()},[o]);const q=async e=>{if(t&&s){x(s=>new Set(s).add(e));try{const a={questionId:e,parameters:{repository:s,branch:n,locale:l.language.replace("-","_")||"en_US"}},i={githubService:t},o=await y.A.executeQuestion(a,i);v(s=>new Map(s).set(e,o))}catch(a){console.error("Failed to execute question ".concat(e,":"),a),v(s=>new Map(s).set(e,{structured:{},narrative:'<p class="error">Error: '.concat(a.message,"</p>"),errors:[a.message],warnings:[],meta:{}}))}finally{x(s=>{const n=new Set(s);return n.delete(e),n})}}},S=e=>w.default.sanitize(e,{ALLOWED_TAGS:["h1","h2","h3","h4","h5","h6","p","div","span","ul","ol","li","strong","em","code","pre","time","small"],ALLOWED_ATTR:["class","datetime"]}),A=e=>{const s=f.get(e);return g.has(e)?(0,m.jsxs)("div",{className:"faq-answer loading",children:[(0,m.jsx)("div",{className:"faq-loading-spinner"}),(0,m.jsx)("p",{children:r("dak.faq.loading")})]}):s?s.errors&&s.errors.length>0?(0,m.jsxs)("div",{className:"faq-answer error",children:[(0,m.jsx)("div",{className:"faq-narrative",dangerouslySetInnerHTML:{__html:S(s.narrative||"")}}),(0,m.jsx)("div",{className:"faq-messages",children:s.errors.map((e,s)=>(0,m.jsxs)("div",{className:"faq-message faq-error",children:[(0,m.jsx)("span",{className:"faq-message-icon",children:"\u26a0\ufe0f"}),e]},"error-".concat(s)))}),(0,m.jsx)("button",{onClick:()=>(async e=>{v(s=>{const n=new Map(s);return n.delete(e),n}),await q(e)})(e),className:"faq-retry-button",children:r("dak.faq.retry")})]}):(0,m.jsxs)("div",{className:"faq-answer success",children:[(0,m.jsx)("div",{className:"faq-narrative",dangerouslySetInnerHTML:{__html:S(s.narrative||"")}}),s.warnings&&s.warnings.length>0&&(0,m.jsx)("div",{className:"faq-messages",children:s.warnings.map((e,s)=>(0,m.jsxs)("div",{className:"faq-message faq-warning",children:[(0,m.jsx)("span",{className:"faq-message-icon",children:"\u26a0\ufe0f"}),e]},"warning-".concat(s)))})]}):(0,m.jsx)("div",{className:"faq-answer empty",children:(0,m.jsx)("p",{children:r("dak.faq.no_data")})})};return j?(0,m.jsx)("div",{className:"faq-accordion loading ".concat(c),children:(0,m.jsxs)("div",{className:"faq-loading",children:[(0,m.jsx)("div",{className:"loading-spinner"}),(0,m.jsx)("p",{children:r("dak.faq.loading_questions")})]})}):N?(0,m.jsx)("div",{className:"faq-accordion error ".concat(c),children:(0,m.jsxs)("div",{className:"faq-error",children:[(0,m.jsx)("h4",{children:r("dak.faq.error_title")}),(0,m.jsx)("p",{children:N}),(0,m.jsx)("button",{onClick:()=>window.location.reload(),className:"btn-secondary",children:r("common.retry")})]})}):0===d.length?(0,m.jsx)("div",{className:"faq-accordion empty ".concat(c),children:(0,m.jsxs)("div",{className:"faq-empty",children:[(0,m.jsx)("h4",{children:r("dak.faq.no_questions_title")}),(0,m.jsx)("p",{children:r("dak.faq.no_questions_message")})]})}):(0,m.jsxs)("div",{className:"faq-accordion ".concat(c),children:[(0,m.jsxs)("div",{className:"faq-accordion-header",children:[(0,m.jsx)("h4",{children:r("dak.faq.available_questions",{count:d.length})}),(0,m.jsx)("p",{children:r("dak.faq.accordion_description")})]}),(0,m.jsx)("div",{className:"faq-accordion-list",children:d.map(e=>{const s=h.has(e.id),n=g.has(e.id);return(0,m.jsxs)("div",{className:"faq-accordion-item ".concat(s?"expanded":""," ").concat(n?"loading":""),children:[(0,m.jsxs)("button",{className:"faq-accordion-toggle",onClick:()=>(async e=>{const s=new Set(h);h.has(e)?s.delete(e):(s.add(e),f.has(e)||await q(e)),p(s)})(e.id),"aria-expanded":s,"aria-controls":"faq-content-".concat(e.id),children:[(0,m.jsxs)("div",{className:"faq-question-info",children:[(0,m.jsx)("h5",{className:"faq-question-title",children:e.title}),(0,m.jsx)("p",{className:"faq-question-description",children:e.description}),(0,m.jsxs)("div",{className:"faq-question-meta",children:[(0,m.jsx)("span",{className:"faq-level",children:e.level}),e.tags&&e.tags.slice(0,3).map(e=>(0,m.jsx)("span",{className:"faq-tag",children:e},e))]})]}),(0,m.jsx)("div",{className:"faq-accordion-icon",children:n?(0,m.jsx)("div",{className:"faq-loading-icon"}):(0,m.jsx)("span",{className:"faq-chevron ".concat(s?"rotated":""),children:"\u25bc"})})]}),s&&(0,m.jsx)("div",{id:"faq-content-".concat(e.id),className:"faq-accordion-content",children:A(e.id)})]},e.id)})})]})};var q=n(95388);const S=e=>{var s,n,l,p;let{initialProfile:f=null,initialRepository:v=null,initialSelectedBranch:b=null,onProfileChange:y=()=>{},onRepositoryChange:w=()=>{},onSelectedBranchChange:S=()=>{}}=e;const{t:A}=(0,i.Bd)(),C=(0,t.zy)(),_=(0,t.Zp)(),{user:D,repo:I,branch:T}=(0,t.g)(),E=(0,d.A)("sgex-mascot.png"),[M,P]=(0,a.useState)(f||(null===(s=C.state)||void 0===s?void 0:s.profile)||null),[R,L]=(0,a.useState)(v||(null===(n=C.state)||void 0===n?void 0:n.repository)||null),[B,F]=(0,a.useState)(!M||!R),[O,H]=(0,a.useState)(null),[K,G]=(0,a.useState)(!1),[W,X]=(0,a.useState)(!1),[z,Q]=(0,a.useState)("core"),[U,Z]=(0,a.useState)(b||(null===(l=C.state)||void 0===l?void 0:l.selectedBranch)||T||null),[Y,J]=(0,a.useState)({}),[V,$]=(0,a.useState)(!1);(0,a.useEffect)(()=>{y(M)},[M,y]),(0,a.useEffect)(()=>{w(R)},[R,w]),(0,a.useEffect)(()=>{S(U)},[U,S]);const ee=e=>{let{component:s,handleComponentClick:n,t:t}=e;const[i,o]=(0,a.useState)(!1),[c,r]=(0,a.useState)(!1),l=(0,d.A)(s.cardImage);return(0,m.jsxs)("div",{className:"component-card ".concat(s.type.toLowerCase()," large-card ").concat(i?"image-loaded":""),onClick:e=>n(e,s),style:{"--component-color":s.color},tabIndex:0,role:"button","aria-label":"".concat(s.name," - ").concat(s.description),onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),n(e,s))},children:[(0,m.jsxs)("div",{className:"component-main",children:[(0,m.jsx)("div",{className:"component-header",children:(0,m.jsxs)("div",{className:"component-image-container",children:[(0,m.jsx)("img",{src:l,alt:(0,q.lm)(t,q.ld.ICON_DAK_COMPONENT,s.name,{name:s.name}),className:"component-card-image",onLoad:()=>{o(!0),r(!1)},onError:()=>{r(!0),o(!1)},style:{display:c?"none":"block"}}),c&&(0,m.jsx)("div",{className:"component-icon",style:{color:s.color},children:s.icon})]})}),(0,m.jsxs)("div",{className:"component-content",children:[(0,m.jsx)("h4",{children:s.name}),(0,m.jsx)("p",{children:s.description})]})]}),(0,m.jsx)("div",{className:"component-meta-section",children:(0,m.jsxs)("div",{className:"component-meta",children:[(0,m.jsx)("div",{className:"file-types",children:s.fileTypes.map(e=>(0,m.jsx)("span",{className:"file-type-tag",children:e},e))}),(0,m.jsxs)("div",{className:"file-count",children:[s.count," files"]})]})})]})};(0,a.useEffect)(()=>{(async()=>{if(M&&R||!D||!I)F(!1);else try{if(F(!0),H(null),!o.A.isAuth()){const e={login:D,name:D.charAt(0).toUpperCase()+D.slice(1),avatar_url:"https://github.com/".concat(D,".png"),type:"User"},s={name:I,full_name:"".concat(D,"/").concat(I),owner:{login:D},default_branch:T||"main",html_url:"https://github.com/".concat(D,"/").concat(I)};return P(e),L(s),Z(T||"main"),void F(!1)}let s=null;try{s=await o.A.getUser(D)}catch(e){return console.error("Error fetching user:",e),void _("/",{state:{warningMessage:"Could not access the requested DAK. User '".concat(D,"' not found or not accessible.")}})}let n=null;try{n=await o.A.getRepository(D,I)}catch(e){return console.error("Error fetching repository:",e),void _("/",{state:{warningMessage:"Could not access the requested DAK. Repository '".concat(D,"/").concat(I,"' not found or not accessible.")}})}if(!await c.A.validateDAKRepository(D,I,T||n.default_branch))return console.log("Repository ".concat(D,"/").concat(I," is not a valid DAK repository")),void _("/",{state:{warningMessage:"Could not access the requested DAK. Repository '".concat(D,"/").concat(I,"' not found or not accessible.")}});if(T)try{await o.A.getBranch(D,I,T),Z(T)}catch(e){console.warn("Branch '".concat(T,"' not found, falling back to default branch")),Z(n.default_branch)}else Z(n.default_branch);P(s),L(n),F(!1)}catch(e){console.error("Error fetching data from URL params:",e),H("Failed to load dashboard data. Please check the URL or try again."),F(!1)}})()},[D,I,T,M,R,_,A]),(0,a.useEffect)(()=>{if(R){const e=r.default.getSelectedBranch(R);if(e)Z(e);else{const e=R.default_branch||"main";Z(e),r.default.setSelectedBranch(R,e)}}},[R,M]);(0,a.useEffect)(()=>{R&&!B&&(async()=>{if(R)try{var e;const s=(null===(e=R.owner)||void 0===e?void 0:e.login)||R.full_name.split("/")[0],n=R.name,a=(await o.A.getIssues(s,n,{state:"all",per_page:100})).filter(e=>!e.pull_request),t=a.filter(e=>"open"===e.state).length,i=a.filter(e=>"closed"===e.state).length;J({total:a.length,open:t,closed:i})}catch(s){console.warn("Could not load issue counts:",s),J({total:0,open:0,closed:0})}})()},[R,B]),(0,a.useEffect)(()=>{(async()=>{if(R&&M)try{var e;const s=await o.A.checkRepositoryWritePermissions((null===(e=R.owner)||void 0===e?void 0:e.login)||R.full_name.split("/")[0],R.name);G(s)}catch(O){console.warn("Could not check write permissions:",O),G(!1)}F(!1)})()},[R,M]),(0,a.useEffect)(()=>{const e=e=>{V&&!e.target.closest(".user-menu-container")&&$(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[V]);const se=[{id:"health-interventions",name:A("dak.healthInterventions"),description:"Clinical guidelines and health intervention specifications that define evidence-based care recommendations",icon:"\ud83d\udcd6",cardImage:"dashboard/dak_interventions.png",type:"L2",color:"#0078d4",fileTypes:["IRIS","Publication"],count:5,editor:"Publication reference manager with IRIS integration"},{id:"generic-personas",name:A("dak.genericPersonas"),description:"Standardized user roles and actor definitions that represent different types of healthcare workers and patients",icon:"\ud83d\udc65",cardImage:"dashboard/dak_personas.png",type:"L2",color:"#107c10",fileTypes:["Actor","Role"],count:8,editor:"Persona definition editor with role-based access specifications"},{id:"user-scenarios",name:A("dak.userScenarios"),description:"Narrative descriptions of how different personas interact with the system in specific healthcare contexts",icon:"\ud83d\udcdd",cardImage:"dashboard/dak_user_scenarios.png",type:"L2",color:"#881798",fileTypes:["Narrative","Use Case"],count:12,editor:"Scenario editor with workflow visualization"},{id:"business-processes",name:A("dak.businessProcesses"),description:"BPMN workflows and business process definitions that model clinical workflows and care pathways",icon:"\ud83d\udd04",cardImage:"dashboard/dak_business_processes.png",type:"L2",color:"#d13438",fileTypes:["BPMN","XML"],count:15,editor:"Graphical BPMN editor with SVG visualization"},{id:"core-data-elements",name:A("dak.coreDataElements"),description:"Essential data structures and terminology needed for clinical data capture and exchange (includes Terminology Services via OCL and Product Master Data via PCMT)",icon:"\ud83d\uddc3\ufe0f",cardImage:"dashboard/dak_core_data_elements.png",type:"L2",color:"#ff8c00",fileTypes:["OCL","Concept","PCMT","Product"],count:Y.total||89,editor:"Data element editor with OCL and PCMT integration"},{id:"decision-support",name:A("dak.decisionSupportLogic"),description:"DMN decision tables and clinical decision support rules that encode clinical logic",icon:"\ud83c\udfaf",cardImage:"dashboard/dak_decision_support_logic.png",type:"L2",color:"#00bcf2",fileTypes:["DMN","XML"],count:24,editor:"DMN decision table editor with validation"},{id:"program-indicators",name:A("dak.programIndicators"),description:"Performance indicators and measurement definitions for monitoring and evaluation",icon:"\ud83d\udcca",cardImage:"dashboard/dak_indicators.png",type:"L2",color:"#498205",fileTypes:["Measure","Logic"],count:18,editor:"Indicator definition editor with measurement logic"},{id:"functional-requirements",name:A("dak.requirements"),description:"System requirements specifications that define capabilities and constraints",icon:"\u2699\ufe0f",cardImage:"dashboard/dak_requirements.png",type:"L2",color:"#6b69d6",fileTypes:["Requirements","Specification"],count:32,editor:"Requirements editor with structured templates"},{id:"test-scenarios",name:A("dak.testScenarios")||"Test Scenarios",description:"Feature files and test scenarios for validating the DAK implementation",icon:"\ud83e\uddea",cardImage:"dashboard/dak_testing.png",type:"L2",color:"#8b5cf6",fileTypes:["Feature","Test"],count:0,editor:"Testing viewer with feature file browser"}],ne=(e,s)=>{var n;const a={profile:M,repository:R,component:s,selectedBranch:U};if("decision-support"===s.id){var t;const s=(null===(t=R.owner)||void 0===t?void 0:t.login)||R.full_name.split("/")[0],n=R.name,i=U?"/decision-support-logic/".concat(s,"/").concat(n,"/").concat(U):"/decision-support-logic/".concat(s,"/").concat(n);return void(0,N.hX)(e,i,_,a)}if("business-processes"===s.id){var i;const s=(null===(i=R.owner)||void 0===i?void 0:i.login)||R.full_name.split("/")[0],n=R.name,t=U?"/business-process-selection/".concat(s,"/").concat(n,"/").concat(U):"/business-process-selection/".concat(s,"/").concat(n);return void(0,N.hX)(e,t,_,a)}if("health-interventions"===s.id){var o;const s=(null===(o=R.owner)||void 0===o?void 0:o.login)||R.full_name.split("/")[0],n=R.name,t=U?"/health-interventions/".concat(s,"/").concat(n,"/").concat(U):"/health-interventions/".concat(s,"/").concat(n);return void(0,N.hX)(e,t,_,a)}if("core-data-elements"===s.id){var c;const s=D||(null===(c=R.owner)||void 0===c?void 0:c.login)||R.full_name.split("/")[0],n=I||R.name,t=U,i=t?"/core-data-dictionary-viewer/".concat(s,"/").concat(n,"/").concat(t):"/core-data-dictionary-viewer/".concat(s,"/").concat(n);return void(0,N.hX)(e,i,_,a)}if("generic-personas"===s.id){var r;const s=(null===(r=R.owner)||void 0===r?void 0:r.login)||R.full_name.split("/")[0],n=R.name,t=U?"/actor-editor/".concat(s,"/").concat(n,"/").concat(U):"/actor-editor/".concat(s,"/").concat(n);return void(0,N.hX)(e,t,_,a)}if("test-scenarios"===s.id){var l;const s=(null===(l=R.owner)||void 0===l?void 0:l.login)||R.full_name.split("/")[0],n=R.name,t=U?"/testing-viewer/".concat(s,"/").concat(n,"/").concat(U):"/testing-viewer/".concat(s,"/").concat(n);return void(0,N.hX)(e,t,_,a)}if(!K)return void X(!0);const d=(null===(n=R.owner)||void 0===n?void 0:n.login)||R.full_name.split("/")[0],m=R.name,u=U?"/".concat(s.id,"/").concat(d,"/").concat(m,"/").concat(U):"/".concat(s.id,"/").concat(d,"/").concat(m);(0,N.hX)(e,u,_,a)};return B?(0,m.jsx)("div",{className:"dak-dashboard loading-state",children:(0,m.jsxs)("div",{className:"loading-content",children:[(0,m.jsx)("h2",{children:"Loading Dashboard..."}),(0,m.jsx)("p",{children:"Fetching repository and user data..."})]})}):O?(0,m.jsx)("div",{className:"dak-dashboard error-state",children:(0,m.jsxs)("div",{className:"error-content",children:[(0,m.jsx)("h2",{children:A("dashboard.errorLoading")}),(0,m.jsx)("p",{children:O}),(0,m.jsxs)("div",{className:"error-actions",children:[(0,m.jsx)("button",{onClick:()=>_("/"),className:"action-btn primary",children:A("navigation.home")}),(0,m.jsx)("button",{onClick:()=>window.location.reload(),className:"action-btn secondary",children:A("common.retry")})]})]})}):M&&R?(0,m.jsxs)("div",{className:"dak-dashboard",children:[(0,m.jsx)("div",{className:"dashboard-content",children:(0,m.jsxs)("div",{className:"dashboard-main",children:[(0,m.jsxs)("div",{className:"dashboard-intro",children:[(0,m.jsx)("h2",{children:A("dak.components")}),(0,m.jsxs)("p",{children:["Select a component to edit content for ",(0,m.jsx)("strong",{children:R.name}),U&&(0,m.jsxs)("span",{children:[" on branch ",(0,m.jsx)("code",{className:"branch-display",children:U})]}),". Components are organized according to the WHO SMART Guidelines framework."]})]}),(0,m.jsx)(j.A,{profile:M,repository:R,selectedBranch:U}),R&&U&&(0,m.jsx)(h.A,{repository:R,selectedBranch:U,hasWriteAccess:K,profile:M}),R&&(0,m.jsx)("div",{className:"discussions-status-container",children:(0,m.jsx)(g,{repository:R,selectedBranch:U})}),(0,m.jsxs)("div",{className:"tab-navigation-fullwidth",children:[(0,m.jsxs)("button",{className:"tab-button-fullwidth ".concat("core"===z?"active":""),onClick:()=>Q("core"),children:[(0,m.jsx)("span",{className:"tab-icon",children:"\u2b50"}),(0,m.jsx)("span",{className:"tab-text",children:"9 Core Components"})]}),(0,m.jsxs)("button",{className:"tab-button-fullwidth ".concat("publications"===z?"active":""),onClick:()=>Q("publications"),children:[(0,m.jsx)("span",{className:"tab-icon",children:"\ud83d\udcda"}),(0,m.jsx)("span",{className:"tab-text",children:"Publications"})]}),(0,m.jsxs)("button",{className:"tab-button-fullwidth ".concat("other"===z?"active":""),onClick:()=>Q("other"),children:[(0,m.jsx)("span",{className:"tab-icon",children:"\ud83d\udd27"}),(0,m.jsx)("span",{className:"tab-text",children:"Other DAK Components"})]}),(0,m.jsxs)("button",{className:"tab-button-fullwidth ".concat("faq"===z?"active":""),onClick:()=>Q("faq"),children:[(0,m.jsx)("span",{className:"tab-icon",children:"\u2753"}),(0,m.jsx)("span",{className:"tab-text",children:"DAK FAQ"})]})]}),"core"===z&&(0,m.jsxs)("div",{className:"components-section active",children:[(0,m.jsxs)("div",{className:"section-header",children:[(0,m.jsx)("h3",{className:"section-title",children:A("dak.components")}),(0,m.jsx)("p",{className:"section-description",children:"Essential components that form the foundation of any WHO SMART Guidelines Digital Adaptation Kit"})]}),(0,m.jsx)("div",{className:"components-grid core-components",children:se.map(e=>(0,m.jsx)(ee,{component:e,handleComponentClick:ne,t:A},e.id))})]}),"other"===z&&(0,m.jsxs)("div",{className:"components-section other-components active",children:[(0,m.jsxs)("div",{className:"section-header",children:[(0,m.jsx)("h3",{className:"section-title",children:"Other DAK Components"}),(0,m.jsx)("p",{className:"section-description",children:"Additional specialized components for advanced DAK functionality and implementation"})]}),(0,m.jsx)("div",{className:"components-grid other-components",children:(0,m.jsxs)("div",{className:"component-card l3",onClick:e=>{var s;const n=(null===(s=R.owner)||void 0===s?void 0:s.login)||R.full_name.split("/")[0],a=R.name,t=U?"/questionnaire-editor/".concat(n,"/").concat(a,"/").concat(U):"/questionnaire-editor/".concat(n,"/").concat(a),i={profile:M,repository:R,component:{id:"questionnaire-editor",name:"FHIR Questionnaires",description:"Structured questionnaires and forms for data collection using FHIR standard"},selectedBranch:U};(0,N.hX)(e,t,_,i)},style:{"--component-color":"#17a2b8"},children:[(0,m.jsx)("div",{className:"component-header",children:(0,m.jsx)("div",{className:"component-icon",style:{color:"#17a2b8"},children:"\ud83d\udccb"})}),(0,m.jsxs)("div",{className:"component-content",children:[(0,m.jsx)("h4",{children:"FHIR Questionnaires"}),(0,m.jsx)("p",{children:"Structured questionnaires and forms for data collection using FHIR Questionnaire standard"}),(0,m.jsxs)("div",{className:"component-meta",children:[(0,m.jsxs)("div",{className:"file-types",children:[(0,m.jsx)("span",{className:"file-type-tag",children:"JSON"}),(0,m.jsx)("span",{className:"file-type-tag",children:"FHIR"})]}),(0,m.jsx)("div",{className:"file-count",children:"questionnaires/"})]})]})]})})]}),"publications"===z&&(0,m.jsx)("div",{className:"components-section publications-section active",children:(0,m.jsx)(x.A,{profile:M,repository:R,selectedBranch:U,hasWriteAccess:K})}),"faq"===z&&(0,m.jsxs)("div",{className:"components-section faq-section active",children:[(0,m.jsxs)("div",{className:"section-header",children:[(0,m.jsx)("h3",{className:"section-title",children:"DAK FAQ System"}),(0,m.jsx)("p",{className:"section-description",children:"Ask questions about this DAK and get automated answers based on repository analysis"})]}),(0,m.jsx)(k,{repository:"".concat(D,"/").concat(I),branch:U||"main",githubService:o.A,filters:{level:"dak"},className:"dak-faq-accordion"}),(0,m.jsxs)("div",{className:"mcp-info",style:{marginTop:"2rem",padding:"1rem",background:"#f8f9fa",borderRadius:"8px"},children:[(0,m.jsx)("h4",{children:"MCP Server API"}),"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("p",{children:"The FAQ system can also be accessed programmatically via the MCP server API:"}),(0,m.jsxs)("ul",{children:[(0,m.jsxs)("li",{children:[(0,m.jsx)("code",{children:"GET http://127.0.0.1:3001/faq/questions/catalog"})," - Get question catalog"]}),(0,m.jsxs)("li",{children:[(0,m.jsx)("code",{children:"POST http://127.0.0.1:3001/faq/questions/execute"})," - Execute questions"]})]})]}):(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("p",{children:"For programmatic access to the FAQ system, you can install and run the MCP server locally:"}),(0,m.jsxs)("div",{style:{background:"#e9ecef",padding:"1rem",borderRadius:"4px",marginBottom:"1rem"},children:[(0,m.jsx)("h5",{children:"Installation Instructions:"}),(0,m.jsxs)("ol",{children:[(0,m.jsxs)("li",{children:["Clone the SGEX repository: ",(0,m.jsx)("code",{children:"git clone https://github.com/litlfred/sgex.git"})]}),(0,m.jsxs)("li",{children:["Navigate to repository: ",(0,m.jsx)("code",{children:"cd sgex"})]}),(0,m.jsxs)("li",{children:["Build MCP server: ",(0,m.jsx)("code",{children:"npm run build-mcp"})]}),(0,m.jsxs)("li",{children:["Start MCP server: ",(0,m.jsx)("code",{children:"npm run run-mcp"})]})]}),(0,m.jsxs)("p",{style:{margin:"0.5rem 0",fontSize:"0.9em",color:"#6c757d"},children:[(0,m.jsx)("strong",{children:"Alternative:"})," For manual setup, navigate to ",(0,m.jsx)("code",{children:"services/dak-faq-mcp"})," and run ",(0,m.jsx)("code",{children:"npm install && npm run build && npm start"})]})]}),(0,m.jsx)("p",{children:"Once running, the MCP server will be available at:"}),(0,m.jsxs)("ul",{children:[(0,m.jsxs)("li",{children:[(0,m.jsx)("code",{children:"GET http://127.0.0.1:3001/faq/questions/catalog"})," - Get question catalog"]}),(0,m.jsxs)("li",{children:[(0,m.jsx)("code",{children:"POST http://127.0.0.1:3001/faq/questions/execute"})," - Execute questions"]})]}),(0,m.jsxs)("p",{children:[(0,m.jsx)("strong",{children:"Note:"})," The MCP server runs locally for security and provides full API access to the DAK FAQ system."]})]})]})]})]})}),W&&(0,m.jsx)("div",{className:"permission-dialog-overlay",children:(0,m.jsxs)("div",{className:"permission-dialog",children:[(0,m.jsxs)("div",{className:"dialog-header",children:[(0,m.jsx)("h3",{children:"Edit Access Required"}),(0,m.jsx)("button",{className:"dialog-close",onClick:()=>X(!1),children:"\xd7"})]}),(0,m.jsxs)("div",{className:"dialog-content",children:[(0,m.jsxs)("div",{className:"dialog-mascot",children:[(0,m.jsx)("img",{src:E,alt:(0,q.lm)(A,q.ld.MASCOT_HELPER,"SGEX Helper"),className:"dialog-mascot-img"}),(0,m.jsxs)("div",{className:"mascot-message",children:[(0,m.jsx)("p",{children:"You need edit permissions to modify DAK components!"}),(0,m.jsx)("p",{children:"Your current token only provides read access to this repository."})]})]}),(0,m.jsxs)("div",{className:"permission-options",children:[(0,m.jsxs)("div",{className:"option-card",children:[(0,m.jsx)("h4",{children:"\ud83d\udd27 Upgrade Your Token"}),(0,m.jsx)("p",{children:"Create a new fine-grained token with write permissions for this repository."}),(0,m.jsxs)("div",{className:"option-buttons",children:[(0,m.jsx)("a",{href:"https://github.com/settings/personal-access-tokens/new",target:"_blank",rel:"noopener noreferrer",className:"btn-primary",children:"Create New Token"}),(0,m.jsx)(u,{helpTopic:"github-token",contextData:{repository:{owner:(null===(p=R.owner)||void 0===p?void 0:p.login)||R.full_name.split("/")[0],name:R.name},requiredScopes:["Contents: Write","Metadata: Read","Pull requests: Write"],permissionMode:"edit",upgradeMode:!0}})]})]}),(0,m.jsxs)("div",{className:"option-card",children:[(0,m.jsx)("h4",{children:"\ud83d\udc41\ufe0f Continue in Read-Only Mode"}),(0,m.jsx)("p",{children:"Browse and view DAK components without editing capabilities."}),(0,m.jsx)("button",{className:"btn-secondary",onClick:()=>X(!1),children:"Continue Read-Only"})]})]})]})]})})]}):(_("/"),(0,m.jsx)("div",{children:"Redirecting..."}))},A=()=>{var e,s,n;const i=(0,t.zy)(),{user:o,repo:c,branch:r}=(0,t.g)(),[l,d]=(0,a.useState)((null===(e=i.state)||void 0===e?void 0:e.profile)||null),[u,h]=(0,a.useState)((null===(s=i.state)||void 0===s?void 0:s.repository)||null),[p,f]=(0,a.useState)((null===(n=i.state)||void 0===n?void 0:n.selectedBranch)||r||null),v={pageId:"dak-dashboard",profile:l,repository:u,selectedDak:u,selectedBranch:p};return(0,m.jsx)(b.Mx,{pageName:"dak-dashboard",contextData:v,children:(0,m.jsx)(S,{initialProfile:l,initialRepository:u,initialSelectedBranch:p,onProfileChange:d,onRepositoryChange:h,onSelectedBranchChange:f})})}}}]);