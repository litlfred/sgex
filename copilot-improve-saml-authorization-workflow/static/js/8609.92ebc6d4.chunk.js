"use strict";(self.webpackChunksgex_workbench=self.webpackChunksgex_workbench||[]).push([[8609],{12101:(e,a,i)=>{i.r(a),i.d(a,{default:()=>p});var n=i(89379),t=i(9950),s=i(18518),o=i(46901),r=i(79610),l=i(53155),c=i(53782),d=i(44414);const p=()=>{var e;const a=(0,s.zy)(),i=(0,s.Zp)(),[p,h]=(0,t.useState)([]),[u,g]=(0,t.useState)(null),[m,v]=(0,t.useState)(!0),[_,b]=(0,t.useState)(null),[x,j]=(0,t.useState)(!0),[y,z]=(0,t.useState)(!1),[N,f]=(0,t.useState)(null),{profile:O,sourceRepository:k,action:H}=a.state||{},w=()=>{switch(H){case"fork":return{title:"Select Destination for Fork",description:'Choose where to create a fork of "'.concat(null===k||void 0===k?void 0:k.name,'".'),buttonText:"Fork Repository",nextRoute:"/dashboard"};case"create":return{title:"Select Destination for New DAK",description:'Choose where to create your new DAK based on "'.concat(null===k||void 0===k?void 0:k.name,'".'),buttonText:"Continue to Configuration",nextRoute:"/dak-configuration"};default:return{title:"Select Organization",description:"Choose an organization for your DAK.",buttonText:"Continue",nextRoute:"/dashboard"}}},W=(0,t.useCallback)(async()=>{v(!0),b(null);try{let a=[];a=o.A.isAuth()?await o.A.getUserOrganizations():await C();try{const e=await o.A.getWHOOrganization(),i=a.findIndex(e=>"WorldHealthOrganization"===e.login);i>=0?a[i]=(0,n.A)((0,n.A)({},a[i]),e):a.unshift(e)}catch(e){console.warn("Could not fetch WHO organization data, using fallback:",e);const i={id:"who-organization",login:"WorldHealthOrganization",display_name:"World Health Organization",description:"The World Health Organization is a specialized agency of the United Nations responsible for international public health.",avatar_url:"https://avatars.githubusercontent.com/u/12261302?s=200&v=4",html_url:"https://github.com/WorldHealthOrganization",type:"Organization",permissions:{can_create_repositories:!0,can_create_private_repositories:!0},plan:{name:"Organization",private_repos:"unlimited"},isWHO:!0};a.some(e=>"WorldHealthOrganization"===e.login)||a.unshift(i)}h(a)}catch(_){console.error("Error fetching organizations:",_),b("Failed to fetch organizations. Please check your connection and try again.");try{const e=await C();h(e)}catch(a){h([{id:"who-organization",login:"WorldHealthOrganization",display_name:"World Health Organization",description:"The World Health Organization is a specialized agency of the United Nations responsible for international public health.",avatar_url:"https://avatars.githubusercontent.com/u/12261302?s=200&v=4",html_url:"https://github.com/WorldHealthOrganization",type:"Organization",permissions:{can_create_repositories:!0,can_create_private_repositories:!0},plan:{name:"Organization",private_repos:"unlimited"},isWHO:!0}])}}finally{v(!1)}},[]),C=async()=>{try{return[await o.A.getWHOOrganization(),{id:1,login:"my-health-org",display_name:"My Health Organization",description:"Healthcare technology organization focused on digital health solutions",avatar_url:"https://avatars.githubusercontent.com/u/1?s=200&v=4",html_url:"https://github.com/my-health-org",type:"Organization",permissions:{can_create_repositories:!0,can_create_private_repositories:!0},plan:{name:"Team",private_repos:10}},{id:2,login:"global-health-initiative",display_name:"Global Health Initiative",description:"International organization working on global health standards",avatar_url:"https://avatars.githubusercontent.com/u/2?s=200&v=4",html_url:"https://github.com/global-health-initiative",type:"Organization",permissions:{can_create_repositories:!0,can_create_private_repositories:!1},plan:{name:"Free",private_repos:0}}]}catch(_){return console.warn("Could not fetch WHO data for mock organizations, using fallback:",_),[{id:"who-organization",login:"WorldHealthOrganization",display_name:"World Health Organization",description:"The World Health Organization is a specialized agency of the United Nations responsible for international public health.",avatar_url:"https://avatars.githubusercontent.com/u/12261302?s=200&v=4",html_url:"https://github.com/WorldHealthOrganization",type:"Organization",permissions:{can_create_repositories:!0,can_create_private_repositories:!0},plan:{name:"Organization",private_repos:"unlimited"},isWHO:!0},{id:1,login:"my-health-org",display_name:"My Health Organization",description:"Healthcare technology organization focused on digital health solutions",avatar_url:"https://avatars.githubusercontent.com/u/1?s=200&v=4",html_url:"https://github.com/my-health-org",type:"Organization",permissions:{can_create_repositories:!0,can_create_private_repositories:!0},plan:{name:"Team",private_repos:10}},{id:2,login:"global-health-initiative",display_name:"Global Health Initiative",description:"International organization working on global health standards",avatar_url:"https://avatars.githubusercontent.com/u/2?s=200&v=4",html_url:"https://github.com/global-health-initiative",type:"Organization",permissions:{can_create_repositories:!0,can_create_private_repositories:!1},plan:{name:"Free",private_repos:0}}]}};(0,t.useEffect)(()=>{O&&k&&H?(r.A.registerModalCallback(e=>{f(e),z(!0)}),W()):i("/")},[O,k,H,i,W]);const A=w(),S=[];return x&&S.push((0,n.A)((0,n.A)({},O),{},{type:"User",display_name:O.name||O.login,description:"Your personal GitHub account",permissions:{can_create_repositories:!0,can_create_private_repositories:!0},isPersonal:!0})),S.push(...p),(0,d.jsxs)(c.Mx,{pageName:"organization-selection",children:[O&&k&&H?(0,d.jsxs)("div",{className:"org-content",children:[(0,d.jsxs)("div",{className:"breadcrumb",children:[(0,d.jsx)("button",{onClick:()=>i("/"),className:"breadcrumb-link",children:"Select Profile"}),(0,d.jsx)("span",{className:"breadcrumb-separator",children:"\u203a"}),(0,d.jsx)("button",{onClick:()=>i("/dak-action",{state:{profile:O}}),className:"breadcrumb-link",children:"Choose DAK Action"}),(0,d.jsx)("span",{className:"breadcrumb-separator",children:"\u203a"}),(0,d.jsx)("button",{onClick:()=>{i("/dak-selection/".concat(O.login),{state:{profile:O,action:H}})},className:"breadcrumb-link",children:"Select DAK"}),(0,d.jsx)("span",{className:"breadcrumb-separator",children:"\u203a"}),(0,d.jsx)("span",{className:"breadcrumb-current",children:"Select Organization"})]}),(0,d.jsxs)("div",{className:"org-main",children:[(0,d.jsxs)("div",{className:"org-intro",children:[(0,d.jsx)("h2",{children:A.title}),(0,d.jsx)("p",{children:A.description}),k&&(0,d.jsxs)("div",{className:"source-repo-info",children:[(0,d.jsx)("span",{className:"repo-label",children:"Source Repository:"}),(0,d.jsxs)("div",{className:"repo-badge",children:[(0,d.jsx)("span",{className:"repo-name",children:k.name}),(0,d.jsxs)("span",{className:"repo-owner",children:["@",null===(e=k.full_name)||void 0===e?void 0:e.split("/")[0]]})]})]})]}),(0,d.jsxs)("div",{className:"options-section",children:[(0,d.jsx)("div",{className:"include-personal",children:(0,d.jsxs)("label",{className:"checkbox-label",children:[(0,d.jsx)("input",{type:"checkbox",checked:x,onChange:e=>j(e.target.checked)}),(0,d.jsx)("span",{children:"Include my personal account as an option"})]})}),m?(0,d.jsxs)("div",{className:"loading",children:[(0,d.jsx)("div",{className:"spinner"}),(0,d.jsx)("p",{children:"Loading organizations..."})]}):_?(0,d.jsxs)("div",{className:"error-state",children:[(0,d.jsx)("h3",{children:"Error loading organizations"}),(0,d.jsx)("p",{children:_}),(0,d.jsx)("button",{onClick:W,className:"retry-btn",children:"Try Again"})]}):0===S.length?(0,d.jsxs)("div",{className:"empty-state",children:[(0,d.jsx)("h3",{children:"No organizations available"}),(0,d.jsx)("p",{children:"Enable personal account option or join organizations to see options here."})]}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{className:"org-grid",children:S.map(e=>{var a,i,n,t;return(0,d.jsxs)("div",{className:"org-card ".concat((null===u||void 0===u?void 0:u.id)===e.id&&(null===u||void 0===u?void 0:u.type)===e.type?"selected":""," ").concat(e.isPersonal?"personal":""," ").concat(e.isWHO?"who-org":""),onClick:()=>(e=>{g(e)})(e),children:[(0,d.jsxs)("div",{className:"org-header-info",children:[(0,d.jsx)("img",{src:e.avatar_url||"https://github.com/".concat(e.login,".png"),alt:"".concat(e.display_name||e.login," avatar"),className:"org-avatar"}),(0,d.jsxs)("div",{className:"org-details",children:[(0,d.jsx)("h3",{children:e.display_name||e.login}),(0,d.jsxs)("p",{className:"org-login",children:["@",e.login]}),e.isPersonal&&(0,d.jsx)("span",{className:"personal-badge",children:"Personal"}),e.isWHO&&(0,d.jsx)("span",{className:"who-badge",children:"WHO Official"})]})]}),(0,d.jsx)("p",{className:"org-description",children:e.description||"No description available"}),(0,d.jsxs)("div",{className:"org-permissions",children:[(0,d.jsxs)("div",{className:"permission-item",children:[(0,d.jsx)("span",{className:"permission-icon ".concat(null!==(a=e.permissions)&&void 0!==a&&a.can_create_repositories?"allowed":"denied"),children:null!==(i=e.permissions)&&void 0!==i&&i.can_create_repositories?"\u2713":"\u2717"}),(0,d.jsx)("span",{children:"Create repositories"})]}),(0,d.jsxs)("div",{className:"permission-item",children:[(0,d.jsx)("span",{className:"permission-icon ".concat(null!==(n=e.permissions)&&void 0!==n&&n.can_create_private_repositories?"allowed":"denied"),children:null!==(t=e.permissions)&&void 0!==t&&t.can_create_private_repositories?"\u2713":"\u2717"}),(0,d.jsx)("span",{children:"Create private repositories"})]})]}),e.plan&&(0,d.jsxs)("div",{className:"org-plan",children:[(0,d.jsxs)("span",{className:"plan-name",children:[e.plan.name," Plan"]}),void 0!==e.plan.private_repos&&(0,d.jsxs)("span",{className:"plan-repos",children:[e.plan.private_repos," private repos"]})]}),(null===u||void 0===u?void 0:u.id)===e.id&&(null===u||void 0===u?void 0:u.type)===e.type&&(0,d.jsx)("div",{className:"selection-indicator",children:(0,d.jsx)("span",{children:"\u2713 Selected"})})]},"".concat(e.type,"-").concat(e.id))})}),(0,d.jsx)("div",{className:"org-footer",children:(0,d.jsx)("button",{className:"continue-btn",onClick:()=>{if(!u)return void alert("Please select an organization to continue");const e=w();"fork"===H?i(e.nextRoute,{state:{profile:O,repository:(0,n.A)((0,n.A)({},k),{},{full_name:"".concat(u.login,"/").concat(k.name),html_url:"https://github.com/".concat(u.login,"/").concat(k.name),owner:u}),sourceRepository:k,destinationOrganization:u,action:H}}):"create"===H&&i(e.nextRoute,{state:{profile:O,templateRepository:k,destinationOrganization:u,action:H}})},disabled:!u,children:A.buttonText})})]})]})]})]}):(0,d.jsx)("div",{children:"Redirecting..."}),(0,d.jsx)(l.A,{isOpen:y,onClose:()=>{z(!1),f(null)},samlInfo:N})]})}}}]);