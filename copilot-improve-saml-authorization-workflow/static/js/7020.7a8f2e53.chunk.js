"use strict";(self.webpackChunksgex_workbench=self.webpackChunksgex_workbench||[]).push([[7020],{81008:(e,s,a)=>{a.r(s),a.d(s,{default:()=>p});var i=a(9950),r=a(18518),t=a(46901),o=a(29473),n=a(79610),c=a(53155),l=a(53782),d=a(44414);const p=()=>{var e;const s=(0,r.zy)(),a=(0,r.Zp)(),{user:p}=(0,r.g)(),[h,g]=(0,i.useState)([]),[u,x]=(0,i.useState)(!0),[m,j]=(0,i.useState)(null),[v,N]=(0,i.useState)(!1),[f,y]=(0,i.useState)(null),[k,w]=(0,i.useState)(null===(e=s.state)||void 0===e?void 0:e.profile);(0,i.useEffect)(()=>{n.A.registerModalCallback(e=>{y(e),N(!0)}),(async()=>{if(p&&!k)try{if(t.A.isAuth()){const e=await t.A.getUser(p);w(e)}else w({login:p,name:p.charAt(0).toUpperCase()+p.slice(1),avatar_url:"https://github.com/".concat(p,".png"),type:"User"})}catch(m){console.error("Error fetching user profile:",m),a("/",{state:{warningMessage:"User '".concat(p,"' not found or not accessible.")}})}})()},[p,k,a]);const A=(0,i.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];x(!0),j(null);try{const a=k.type;if(!e){let e=null;try{e=o.A.getCachedRepositories(k.login,a)}catch(s){console.warn("Error accessing repository cache:",s)}if(e)return console.log("Using cached repositories for ".concat(k.login," (").concat(a,")")),g(e.repositories),void x(!1)}console.log("Fetching fresh repositories for ".concat(k.login," (").concat(a,")"));const i=await t.A.getRepositories(k.login,a);try{o.A.setCachedRepositories(k.login,a,i)}catch(s){console.warn("Error caching repositories:",s)}g(i)}catch(m){console.error("Error fetching repositories:",m),j("Failed to fetch repositories. Please check your connection and try again.")}finally{x(!1)}},[k]);(0,i.useEffect)(()=>{k||p?k&&A():a("/")},[k,p,a,A]);return(0,d.jsxs)(l.Mx,{pageName:"repository-selection",children:[k?(0,d.jsx)("div",{className:"repo-content",children:(0,d.jsx)("div",{className:"repo-main",children:(0,d.jsxs)("div",{className:"repo-selection",children:[(0,d.jsx)("h2",{children:"Select DAK Repository"}),(0,d.jsx)("p",{children:"Choose a repository containing WHO SMART Guidelines Digital Adaptation Kit content:"}),u?(0,d.jsxs)("div",{className:"loading",children:[(0,d.jsx)("div",{className:"spinner"}),(0,d.jsx)("p",{children:"Loading repositories..."})]}):m?(0,d.jsxs)("div",{className:"error-state",children:[(0,d.jsx)("h3",{children:"Error loading repositories"}),(0,d.jsx)("p",{children:m}),(0,d.jsx)("button",{onClick:()=>A(!0),className:"retry-btn",children:"Try Again"})]}):0===h.length?(0,d.jsxs)("div",{className:"empty-state",children:[(0,d.jsx)("h3",{children:"No DAK repositories found"}),(0,d.jsx)("p",{children:"No repositories found with DAK-related topics or keywords. Create a new repository or add topics like 'who', 'smart-guidelines', 'dak', or 'health' to existing repositories."})]}):(0,d.jsx)("div",{className:"repo-grid",children:h.map(e=>{return(0,d.jsxs)("div",{className:"repo-card",onClick:()=>(e=>{a("/dashboard/".concat(e.owner.login,"/").concat(e.name),{state:{profile:k,repository:e}})})(e),children:[(0,d.jsxs)("div",{className:"repo-header-info",children:[(0,d.jsx)("h3",{children:e.name}),(0,d.jsxs)("div",{className:"repo-meta",children:[e.private&&(0,d.jsx)("span",{className:"private-badge",children:"Private"}),e.language&&(0,d.jsx)("span",{className:"language-badge",children:e.language})]})]}),(0,d.jsx)("p",{className:"repo-description",children:e.description||"No description available"}),(0,d.jsxs)("div",{className:"repo-topics",children:[(e.topics||[]).slice(0,3).map(e=>(0,d.jsx)("span",{className:"topic-tag",children:e},e)),(e.topics||[]).length>3&&(0,d.jsxs)("span",{className:"topic-more",children:["+",(e.topics||[]).length-3," more"]})]}),(0,d.jsxs)("div",{className:"repo-stats",children:[(0,d.jsxs)("div",{className:"stat",children:[(0,d.jsx)("span",{className:"stat-icon",children:"\u2b50"}),(0,d.jsx)("span",{children:e.stargazers_count||0})]}),(0,d.jsxs)("div",{className:"stat",children:[(0,d.jsx)("span",{className:"stat-icon",children:"\ud83c\udf74"}),(0,d.jsx)("span",{children:e.forks_count||0})]}),(0,d.jsxs)("div",{className:"stat",children:[(0,d.jsx)("span",{className:"stat-icon",children:"\ud83d\udcc5"}),(0,d.jsxs)("span",{children:["Updated ",(s=e.updated_at,new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}))]})]})]})]},e.id);var s})})]})})}):(0,d.jsx)("div",{children:"Redirecting..."}),(0,d.jsx)(c.A,{isOpen:v,onClose:()=>{N(!1),y(null)},samlInfo:f})]})}}}]);