"use strict";(self.webpackChunksgex_workbench=self.webpackChunksgex_workbench||[]).push([[8322],{93442:(e,t,s)=>{s.r(t),s.d(t,{default:()=>u});var n=s(89379),a=s(9950),i=s(18518),o=s(46901),c=s(57561),l=s(53782),r=s(44414);const d=e=>{let{page:t,onClose:s}=e;if((0,a.useEffect)(()=>{const e=e=>{"Escape"===e.key&&s()};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[s]),!t)return null;const n=t.content?atob(t.content.content):"";return(0,r.jsx)("div",{className:"page-view-modal-overlay",onClick:e=>e.target===e.currentTarget&&(e=>{e.target===e.currentTarget&&s()})(e),role:"presentation",children:(0,r.jsxs)("div",{className:"page-view-modal",role:"dialog","aria-modal":"true",tabIndex:-1,children:[(0,r.jsxs)("div",{className:"page-view-modal-header",children:[(0,r.jsx)("h2",{children:t.title}),(0,r.jsx)("button",{className:"close-btn",onClick:s,"aria-label":"Close page view",children:"\xd7"})]}),(0,r.jsxs)("div",{className:"page-view-modal-content",children:[(0,r.jsxs)("div",{className:"page-info",children:[(0,r.jsx)("span",{className:"page-filename",children:t.filename}),(0,r.jsx)("span",{className:"page-path",children:t.path})]}),(0,r.jsxs)("div",{className:"page-content",children:[(0,r.jsxs)("div",{className:"content-tabs",children:[(0,r.jsx)("button",{className:"tab-btn active",children:"Rendered"}),(0,r.jsx)("button",{className:"tab-btn",onClick:()=>{const e=document.querySelector(".rendered-content"),t=document.querySelector(".raw-content"),s=document.querySelectorAll(".tab-btn");"none"===e.style.display?(e.style.display="block",t.style.display="none",s[0].classList.add("active"),s[1].classList.remove("active")):(e.style.display="none",t.style.display="block",s[0].classList.remove("active"),s[1].classList.add("active"))},children:"Raw Markdown"})]}),(0,r.jsx)("div",{className:"rendered-content",dangerouslySetInnerHTML:{__html:(i=n,i.replace(/^# (.*$)/gim,"<h1>$1</h1>").replace(/^## (.*$)/gim,"<h2>$1</h2>").replace(/^### (.*$)/gim,"<h3>$1</h3>").replace(/^\* (.*$)/gim,"<li>$1</li>").replace(/^- (.*$)/gim,"<li>$1</li>").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`(.*?)`/g,"<code>$1</code>").replace(/\n/g,"<br>"))}}),(0,r.jsx)("div",{className:"raw-content",style:{display:"none"},children:(0,r.jsx)("pre",{children:n})})]})]})]})});var i},h=(0,a.lazy)(()=>Promise.all([s.e(3738),s.e(7845),s.e(2383),s.e(5743)]).then(s.bind(s,25743))),g=e=>{let{page:t,onClose:s,onSave:n}=e;const[i,o]=(0,a.useState)(null!==t&&void 0!==t&&t.content?atob(t.content.content):""),[l,d]=(0,a.useState)(!1);if((0,a.useEffect)(()=>{const e=e=>{"Escape"!==e.key||l||s()};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[s,l]),!t)return null;return(0,r.jsx)("div",{className:"page-edit-modal-overlay",onClick:e=>e.target===e.currentTarget&&(e=>{e.target===e.currentTarget&&s()})(e),role:"presentation",children:(0,r.jsxs)("div",{className:"page-edit-modal",role:"dialog","aria-modal":"true",tabIndex:-1,children:[(0,r.jsxs)("div",{className:"page-edit-modal-header",children:[(0,r.jsxs)("h2",{children:["Edit ",t.title]}),(0,r.jsxs)("div",{className:"header-actions",children:[(0,r.jsx)("button",{className:"btn-secondary",onClick:s,disabled:l,children:"Cancel"}),(0,r.jsx)("button",{className:"btn-primary",onClick:async()=>{d(!0);try{if(!c.A.updateFile(t.path,i,{title:t.title,filename:t.filename,tool:"PageEditor",contentType:"markdown"}))throw new Error("Failed to save to staging ground");n&&await n(t,i,"staged"),s()}catch(e){console.error("Failed to save page:",e),alert("Failed to save page to staging ground. Please try again.")}finally{d(!1)}},disabled:l,children:l?"Staging...":"Stage Changes"})]})]}),(0,r.jsxs)("div",{className:"page-edit-modal-content",children:[(0,r.jsxs)("div",{className:"page-info",children:[(0,r.jsx)("span",{className:"page-filename",children:t.filename}),(0,r.jsx)("span",{className:"page-path",children:t.path})]}),(0,r.jsx)("div",{className:"md-editor-container",children:(0,r.jsx)(a.Suspense,{fallback:(0,r.jsx)("div",{className:"loading-spinner",children:"Loading editor..."}),children:(0,r.jsx)(h,{value:i,onChange:e=>o(e||""),preview:"edit",height:500,visibleDragBar:!1,"data-color-mode":"light",hideToolbar:l})})})]})]})})};var m=s(32675);const u=()=>{const e=(0,i.zy)(),t=(0,i.Zp)(),{profile:s,repository:h,selectedBranch:u}=e.state||{},[p,f]=(0,a.useState)([]),[v,x]=(0,a.useState)(!0),[b,j]=(0,a.useState)(null),[y,w]=(0,a.useState)(!1),[N,k]=(0,a.useState)(!0),[S,A]=(0,a.useState)(null),[E,C]=(0,a.useState)(null);(0,a.useEffect)(()=>{(async()=>{if(o.A.isAuth())return void k(!1);const e=sessionStorage.getItem("github_token")||localStorage.getItem("github_token");if(e){console.log("Restoring GitHub authentication from stored token");o.A.authenticate(e)?console.log("GitHub authentication restored successfully"):(console.warn("Failed to restore GitHub authentication"),sessionStorage.removeItem("github_token"),localStorage.removeItem("github_token"))}else console.warn("No stored GitHub token found");k(!1)})()},[]),(0,a.useEffect)(()=>{N||(async()=>{if(h&&s&&!N)try{var e;const t=await o.A.checkRepositoryWritePermissions((null===(e=h.owner)||void 0===e?void 0:e.login)||h.full_name.split("/")[0],h.name);w(t)}catch(b){console.warn("Could not check write permissions:",b),w(!1)}})()},[h,s,N]),(0,a.useEffect)(()=>{h&&u&&!N&&c.A.initialize(h,u)},[h,u,N]),(0,a.useEffect)(()=>{(async()=>{if(!s||!h)return void t("/");if(N)return;if(!o.A.isAuth())return j("GitHub authentication not available. Please return to the home page and sign in again."),void x(!1);let e=0;for(;e<3;){try{var n;x(!0),j(null);const t=(null===(n=h.owner)||void 0===n?void 0:n.login)||h.full_name.split("/")[0],s=h.name,a=u||"main";if(console.log("Loading pages for ".concat(t,"/").concat(s," on branch: ").concat(a," (attempt ").concat(e+1,")")),console.log("selectedBranch:",u),console.log("GitHub auth status:",o.A.isAuth()),console.log("GitHub octokit:",!!o.A.octokit),!o.A.isAuth()||!o.A.octokit){if(e<2){console.log("GitHub service not ready, waiting..."),await new Promise(e=>setTimeout(e,1e3)),e++;continue}throw new Error("GitHub service not authenticated. Please return to the home page and sign in again.")}const i=await G(t,s,a);if(!i)throw new Error('sushi-config.yaml not found in repository on branch "'.concat(a,'"'));const c=_(i),l=await H(t,s,a,c);f(l);break}catch(b){if(console.error("Failed to load pages:",b),e<2){e++,await new Promise(e=>setTimeout(e,500));continue}j(b.message)}finally{x(!1)}break}})()},[s,h,u,t,N]);const G=async(e,t,s)=>{try{if(!o.A.isAuth()||!o.A.octokit)throw new Error("GitHub service not authenticated");console.log("Fetching sushi-config.yaml from ".concat(e,"/").concat(t," on branch ").concat(s));const{data:n}=await o.A.octokit.rest.repos.getContent({owner:e,repo:t,path:"sushi-config.yaml",ref:s});return"file"===n.type&&n.content?(console.log("Successfully fetched sushi-config.yaml"),atob(n.content)):(console.log("sushi-config.yaml found but no content or not a file"),null)}catch(b){throw console.error("Failed to fetch sushi-config.yaml:",b),404===b.status?new Error('sushi-config.yaml not found in repository on branch "'.concat(s,'"')):403===b.status?new Error("Access denied - insufficient permissions to read repository contents"):401===b.status?new Error("Authentication failed - please check your GitHub token"):o.A.isAuth()?new Error("Failed to fetch sushi-config.yaml: ".concat(b.message)):new Error("GitHub service not authenticated")}},_=e=>{const t=[];try{const s=e.split("\n");let n=!1,a=0;for(let e=0;e<s.length;e++){const i=s[e],o=i.trim();if("pages:"!==o){if(n){const n=i.length-i.trimStart().length;if(o&&n<=a)break;if(o.endsWith(".md:")){const i=o.replace(":","").trim();let c=i;for(let t=e+1;t<s.length;t++){const e=s[t],a=e.trim(),i=e.length-e.trimStart().length;if(a&&i<=n)break;if(a.startsWith("title:")){c=a.replace("title:","").trim();break}}t.push({title:c,filename:i,path:"input/pagecontent/".concat(i),level:Math.floor((n-a)/2)})}else if(o.endsWith(":")&&!o.includes(".md")){const e=o.replace(":","").trim();e&&t.push({title:e,isSection:!0,level:Math.floor((n-a)/2)})}}}else n=!0,a=i.length-i.trimStart().length}}catch(b){console.error("Failed to parse pages from sushi-config.yaml:",b)}return t},H=async(e,t,s,a)=>{const i=[];for(const c of a){if(c.isSection){i.push(c);continue}let a=!1,l=null;try{if(o.A.isAuth()&&o.A.octokit){const{data:n}=await o.A.octokit.rest.repos.getContent({owner:e,repo:t,path:c.path,ref:s});"file"===n.type&&(a=!0,l=n)}}catch(b){a=!1}i.push((0,n.A)((0,n.A)({},c),{},{exists:a,content:l,githubUrl:"https://github.com/".concat(e,"/").concat(t,"/blob/").concat(s,"/").concat(c.path)}))}return i};return(0,a.useEffect)(()=>{s&&h||t("/")},[s,h,t]),s&&h?(0,r.jsx)(l.Mx,{pageName:"pages-manager",children:(0,r.jsxs)("div",{className:"pages-manager",children:[(0,r.jsxs)("div",{className:"pages-content",children:[(0,r.jsx)(m.A,{repository:h,selectedBranch:u,hasWriteAccess:y,profile:s}),(0,r.jsxs)("div",{className:"pages-main",children:[(0,r.jsxs)("div",{className:"pages-intro",children:[(0,r.jsxs)("h2",{children:[(0,r.jsx)("span",{className:"component-icon",style:{color:"#8b5cf6"},children:"\ud83d\udcc4"}),"Pages"]}),(0,r.jsxs)("p",{children:["Published page content and documentation for ",(0,r.jsx)("strong",{children:h.name}),u&&(0,r.jsxs)("span",{children:[" on branch ",(0,r.jsx)("code",{className:"branch-display",children:u})]}),". Pages are defined in ",(0,r.jsx)("code",{children:"sushi-config.yaml"})," and stored as Markdown files in ",(0,r.jsx)("code",{children:"input/pagecontent/"}),"."]})]}),(v||N)&&(0,r.jsxs)("div",{className:"loading-state",children:[(0,r.jsx)("div",{className:"loading-spinner"}),(0,r.jsx)("p",{children:N?"Initializing GitHub authentication...":"Loading pages from sushi-config.yaml..."})]}),b&&(0,r.jsxs)("div",{className:"error-state",children:[(0,r.jsx)("div",{className:"error-icon",children:"\u26a0\ufe0f"}),(0,r.jsxs)("div",{className:"error-content",children:[(0,r.jsx)("h3",{children:"Could not load pages"}),(0,r.jsx)("p",{children:b}),(0,r.jsxs)("div",{className:"error-suggestions",children:[(0,r.jsx)("p",{children:"Make sure:"}),(0,r.jsxs)("ul",{children:[(0,r.jsxs)("li",{children:["The repository contains a ",(0,r.jsx)("code",{children:"sushi-config.yaml"})," file",u&&' on branch "'.concat(u,'"')]}),(0,r.jsxs)("li",{children:["The sushi-config.yaml file has a ",(0,r.jsx)("code",{children:"pages:"})," section"]}),(0,r.jsx)("li",{children:"You have access to view the repository contents"}),u&&"main"!==u&&(0,r.jsxs)("li",{children:['The branch "',u,'" exists and is accessible']})]})]})]})]}),!v&&!N&&!b&&0===p.length&&(0,r.jsxs)("div",{className:"empty-state",children:[(0,r.jsx)("div",{className:"empty-icon",children:"\ud83d\udcc4"}),(0,r.jsx)("h3",{children:"No pages found"}),(0,r.jsx)("p",{children:"This repository doesn't have any pages defined in sushi-config.yaml"}),(0,r.jsx)("div",{className:"empty-actions",children:(0,r.jsx)("a",{href:"https://github.com/".concat(h.full_name,"/blob/").concat(u||"main","/sushi-config.yaml"),target:"_blank",rel:"noopener noreferrer",className:"btn-secondary",children:"View sushi-config.yaml"})})]}),!v&&!N&&!b&&p.length>0&&(0,r.jsxs)("div",{className:"pages-list",children:[(0,r.jsxs)("div",{className:"pages-header-info",children:[(0,r.jsxs)("div",{className:"pages-count",children:[p.filter(e=>!e.isSection).length," pages found"]}),(0,r.jsx)("div",{className:"pages-actions",children:(0,r.jsx)("a",{href:"https://github.com/".concat(h.full_name,"/blob/").concat(u||"main","/sushi-config.yaml"),target:"_blank",rel:"noopener noreferrer",className:"btn-secondary small",children:"View sushi-config.yaml"})})]}),(0,r.jsx)("div",{className:"pages-tree",children:p.map((e,t)=>(0,r.jsx)("div",{className:"page-item ".concat(e.isSection?"section":"page"," level-").concat(e.level),style:{"--indent-level":e.level},children:e.isSection?(0,r.jsxs)("div",{className:"section-header",children:[(0,r.jsx)("span",{className:"section-icon",children:"\ud83d\udcc1"}),(0,r.jsx)("span",{className:"section-title",children:e.title})]}):(0,r.jsxs)("div",{className:"page-row",children:[(0,r.jsxs)("div",{className:"page-info",children:[(0,r.jsxs)("div",{className:"page-title",children:[(0,r.jsx)("span",{className:"page-status ".concat(e.exists?"exists":"missing"),children:e.exists?"\u2705":"\u274c"}),(0,r.jsx)("span",{className:"page-name",children:e.title}),(0,r.jsxs)("span",{className:"page-filename",children:["(",e.filename,")"]})]}),!e.exists&&(0,r.jsx)("div",{className:"page-error",children:"File not found in repository"})]}),(0,r.jsxs)("div",{className:"page-actions",children:[e.exists&&(0,r.jsx)("button",{onClick:()=>(e=>{A(e)})(e),className:"btn-action view",title:"View page content",children:"\ud83d\udc41\ufe0f View"}),(0,r.jsx)("button",{onClick:()=>(e=>{C(e)})(e),className:"btn-action edit",title:"Edit page with WYSIWYG editor",children:"\u270f\ufe0f Edit"}),(0,r.jsx)("a",{href:e.githubUrl,target:"_blank",rel:"noopener noreferrer",className:"btn-action source",title:"View source on GitHub",children:"\ud83d\udd17 Source"})]})]})},t))})]})]})]}),S&&(0,r.jsx)(d,{page:S,onClose:()=>A(null)}),E&&(0,r.jsx)(g,{page:E,onClose:()=>C(null),onSave:async function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"staged";if("staged"!==s){if("direct"===s&&!y)throw new Error("You need write access to save changes. Please upgrade your GitHub token permissions.");if("direct"===s){var n,a,i;const s=(null===(n=h.owner)||void 0===n?void 0:n.login)||h.full_name.split("/")[0],c=u||"main",l=btoa(t),r=null===(a=e.content)||void 0===a?void 0:a.sha;await o.A.octokit.rest.repos.createOrUpdateFileContents({owner:s,repo:h.name,path:e.path,message:"Update ".concat(e.filename," via SGEX Workbench"),content:l,branch:c,sha:r});const d=(null===(i=h.owner)||void 0===i?void 0:i.login)||h.full_name.split("/")[0],g=await G(d,h.name,c);if(g){const e=_(g),t=await H(d,h.name,c,e);f(t)}}}else console.log("Page ".concat(e.filename," has been staged for commit"))}})]})}):(0,r.jsx)(l.Mx,{pageName:"pages-manager",children:(0,r.jsx)("div",{className:"pages-manager",children:(0,r.jsxs)("div",{className:"redirecting-state",children:[(0,r.jsx)("h2",{children:"Redirecting..."}),(0,r.jsx)("p",{children:"Missing required context. Redirecting to home page..."})]})})})}}}]);