"use strict";(self.webpackChunksgex_workbench=self.webpackChunksgex_workbench||[]).push([[3533],{43533:(e,s,t)=>{t.r(s),t.d(s,{default:()=>D});var a=t(89379),n=t(9950),i=t(85001),l=t(29946),c=t(51635),o=t(9627),r=t(6375),d=t(47567),h=t(44414);const m=e=>{let{content:s="",fileName:t="",customStyle:i={},showLineNumbers:l=!1,className:c=""}=e;const[m,u]=(0,n.useState)(!1);(0,n.useEffect)(()=>{const e=()=>{u(document.body.classList.contains("theme-dark"))};e();const s=new MutationObserver(e);return s.observe(document.body,{attributes:!0,attributeFilter:["class"]}),()=>s.disconnect()},[]);const p=m?r.A:d.A,x=(0,a.A)({margin:0,borderRadius:"8px",fontSize:"14px",lineHeight:"1.6",background:"transparent",border:"none"},i);return(0,h.jsxs)("div",{className:"fsh-file-viewer ".concat(c),children:[t&&(0,h.jsxs)("div",{className:"fsh-file-header",children:[(0,h.jsx)("div",{className:"file-icon",children:"\ud83d\udcc4"}),(0,h.jsx)("div",{className:"file-name",children:t}),(0,h.jsx)("div",{className:"file-type",children:"FSH"})]}),(0,h.jsx)("div",{className:"fsh-syntax-container",children:(0,h.jsx)(o.A,{language:"javascript",style:p,customStyle:x,showLineNumbers:l,wrapLines:!0,lineNumberStyle:{minWidth:"3em",paddingRight:"1em",color:m?"rgba(255, 255, 255, 0.6)":"#6c757d",textAlign:"right"},children:s||"// FSH content will appear here..."})}),s&&(0,h.jsx)("div",{className:"fsh-file-footer",children:(0,h.jsxs)("span",{className:"content-info",children:[s.split("\n").length," lines \u2022 ",s.length," characters"]})})]})},u=e=>{let{content:s="",fileName:t="",onChange:i=()=>{},onSave:l=()=>{},readOnly:c=!1,showPreview:m=!0,customStyle:u={},placeholder:p="Enter your FSH content here...",className:x=""}=e;const[j,v]=(0,n.useState)(s),[g,f]=(0,n.useState)(!1),[N,y]=(0,n.useState)(!1),[b,w]=(0,n.useState)(!1),C=(0,n.useRef)(null);(0,n.useEffect)(()=>{const e=()=>{w(document.body.classList.contains("theme-dark"))};e();const s=new MutationObserver(e);return s.observe(document.body,{attributes:!0,attributeFilter:["class"]}),()=>s.disconnect()},[]),(0,n.useEffect)(()=>{s!==j&&(v(s),y(!1))},[s,j]);const S=()=>{l(j),y(!1)},k=()=>{C.current&&(C.current.style.height="auto",C.current.style.height=C.current.scrollHeight+"px")};(0,n.useEffect)(()=>{k()},[j]);const D=b?r.A:d.A,A=(0,a.A)({margin:0,borderRadius:"8px",fontSize:"14px",lineHeight:"1.6",background:"transparent",border:"none",maxHeight:"400px",overflow:"auto"},u);return(0,h.jsxs)("div",{className:"fsh-file-editor ".concat(x," ").concat(g?"editing":"viewing"),children:[t&&(0,h.jsxs)("div",{className:"fsh-editor-header",children:[(0,h.jsxs)("div",{className:"file-info",children:[(0,h.jsx)("div",{className:"file-icon",children:"\ud83d\udcdd"}),(0,h.jsx)("div",{className:"file-name",children:t}),(0,h.jsx)("div",{className:"file-type",children:"FSH"})]}),(0,h.jsxs)("div",{className:"editor-controls",children:[N&&(0,h.jsx)("span",{className:"changes-indicator",children:"\u2022 Unsaved changes"}),!c&&(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("button",{className:"mode-toggle ".concat(g?"active":""),onClick:()=>f(!g),title:g?"Switch to view mode":"Switch to edit mode",children:g?"\ud83d\udc41\ufe0f View":"\u270f\ufe0f Edit"}),N&&(0,h.jsx)("button",{className:"save-btn",onClick:S,title:"Save changes (Ctrl+S)",children:"\ud83d\udcbe Save"})]})]})]}),(0,h.jsx)("div",{className:"fsh-editor-content",children:g&&!c?(0,h.jsxs)("div",{className:"editor-layout",children:[(0,h.jsx)("div",{className:"editor-pane",children:(0,h.jsx)("textarea",{ref:C,value:j,onChange:e=>{const t=e.target.value;v(t),y(t!==s),i(t)},onKeyDown:e=>{if((e.ctrlKey||e.metaKey)&&"s"===e.key&&(e.preventDefault(),N&&!c&&S()),"Tab"===e.key){e.preventDefault();const t=e.target,a=t.selectionStart,n=t.selectionEnd,l="  ",c=j.substring(0,a)+l+j.substring(n);v(c),y(c!==s),i(c),setTimeout(()=>{t.selectionStart=t.selectionEnd=a+l.length},0)}},onInput:k,placeholder:p,className:"fsh-textarea",spellCheck:!1,rows:10})}),m&&(0,h.jsxs)("div",{className:"preview-pane",children:[(0,h.jsx)("div",{className:"preview-header",children:(0,h.jsx)("span",{children:"Preview"})}),(0,h.jsx)("div",{className:"preview-content",children:(0,h.jsx)(o.A,{language:"javascript",style:D,customStyle:A,children:j||"// FSH content preview will appear here..."})})]})]}):(0,h.jsx)("div",{className:"viewer-pane",children:(0,h.jsx)(o.A,{language:"javascript",style:D,customStyle:(0,a.A)((0,a.A)({},A),{},{minHeight:"200px",maxHeight:"none"}),showLineNumbers:!0,wrapLines:!0,lineNumberStyle:{minWidth:"3em",paddingRight:"1em",color:b?"rgba(255, 255, 255, 0.6)":"#6c757d",textAlign:"right"},children:j||"// FSH content will appear here..."})})}),(j||g)&&(0,h.jsxs)("div",{className:"fsh-editor-footer",children:[(0,h.jsxs)("div",{className:"content-stats",children:[(0,h.jsxs)("span",{children:[j.split("\n").length," lines"]}),(0,h.jsx)("span",{children:"\u2022"}),(0,h.jsxs)("span",{children:[j.length," characters"]})]}),(0,h.jsx)("div",{className:"editor-help",children:g&&!c&&(0,h.jsx)("span",{className:"keyboard-hint",children:"Press Tab for indentation \u2022 Ctrl+S to save"})})]})]})},p=e=>{let{isOpen:s,onClose:t,extractionResult:a,sourceModelName:i="Logical Model"}=e;const[l,c]=(0,n.useState)("summary");if(!s||!a)return null;const{success:o,archiMateObject:r,xml:d,error:m}=a,u=()=>{if(d){const e=new Blob([d],{type:"application/xml"}),s=URL.createObjectURL(e),t=document.createElement("a");t.href=s,t.download="".concat(i.replace(/\s+/g,"_"),"_archimate.xml"),document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(s)}};return o?(0,h.jsx)("div",{className:"modal-overlay archimate-modal-overlay",onClick:t,children:(0,h.jsxs)("div",{className:"modal-content archimate-modal large-modal",onClick:e=>e.stopPropagation(),children:[(0,h.jsxs)("div",{className:"modal-header",children:[(0,h.jsx)("h3",{children:"ArchiMate Extraction Results"}),(0,h.jsx)("button",{className:"modal-close",onClick:t,children:"\xd7"})]}),(0,h.jsxs)("div",{className:"modal-body",children:[(0,h.jsxs)("div",{className:"extraction-tabs",children:[(0,h.jsx)("button",{className:"tab-btn ".concat("summary"===l?"active":""),onClick:()=>c("summary"),children:"\ud83d\udcca Summary"}),(0,h.jsx)("button",{className:"tab-btn ".concat("structure"===l?"active":""),onClick:()=>c("structure"),children:"\ud83c\udfd7\ufe0f Structure"}),(0,h.jsx)("button",{className:"tab-btn ".concat("xml"===l?"active":""),onClick:()=>c("xml"),children:"\ud83d\udcc4 XML"})]}),(0,h.jsxs)("div",{className:"tab-content",children:["summary"===l&&(0,h.jsx)("div",{className:"summary-tab",children:(0,h.jsxs)("div",{className:"extraction-summary",children:[(0,h.jsxs)("div",{className:"summary-header",children:[(0,h.jsxs)("h4",{children:["\ud83d\udce6 DataObject: ",r.name]}),(0,h.jsx)("p",{className:"summary-description",children:r.documentation})]}),(0,h.jsxs)("div",{className:"summary-stats",children:[(0,h.jsxs)("div",{className:"stat-card",children:[(0,h.jsx)("div",{className:"stat-value",children:r.elements.length}),(0,h.jsx)("div",{className:"stat-label",children:"Data Attributes"})]}),(0,h.jsxs)("div",{className:"stat-card",children:[(0,h.jsx)("div",{className:"stat-value",children:r.relationships.length}),(0,h.jsx)("div",{className:"stat-label",children:"Relationships"})]}),(0,h.jsxs)("div",{className:"stat-card",children:[(0,h.jsx)("div",{className:"stat-value",children:r.source.type}),(0,h.jsx)("div",{className:"stat-label",children:"Source Type"})]})]}),(0,h.jsxs)("div",{className:"source-info",children:[(0,h.jsx)("h5",{children:"Source Information"}),(0,h.jsxs)("div",{className:"info-grid",children:[(0,h.jsxs)("div",{className:"info-item",children:[(0,h.jsx)("span",{className:"info-label",children:"File:"}),(0,h.jsx)("span",{className:"info-value",children:r.source.fileName})]}),(0,h.jsxs)("div",{className:"info-item",children:[(0,h.jsx)("span",{className:"info-label",children:"Original Name:"}),(0,h.jsx)("span",{className:"info-value",children:r.source.originalName})]}),(0,h.jsxs)("div",{className:"info-item",children:[(0,h.jsx)("span",{className:"info-label",children:"Extracted:"}),(0,h.jsx)("span",{className:"info-value",children:new Date(r.metadata.extractedAt).toLocaleString()})]}),r.metadata.parent&&(0,h.jsxs)("div",{className:"info-item",children:[(0,h.jsx)("span",{className:"info-label",children:"Parent:"}),(0,h.jsx)("span",{className:"info-value",children:r.metadata.parent})]})]})]})]})}),"structure"===l&&(0,h.jsx)("div",{className:"structure-tab",children:(0,h.jsxs)("div",{className:"structure-view",children:[(0,h.jsxs)("h4",{children:["Data Attributes (",r.elements.length,")"]}),(0,h.jsx)("div",{className:"elements-list",children:r.elements.map((e,s)=>(0,h.jsxs)("div",{className:"element-card",children:[(0,h.jsxs)("div",{className:"element-header",children:[(0,h.jsx)("span",{className:"element-name",children:e.name}),(0,h.jsx)("span",{className:"element-type",children:e.dataType}),(0,h.jsx)("span",{className:"element-cardinality",children:e.cardinality})]}),(0,h.jsx)("div",{className:"element-description",children:e.description}),e.constraints&&e.constraints.length>0&&(0,h.jsxs)("div",{className:"element-constraints",children:[(0,h.jsx)("strong",{children:"Constraints:"}),(0,h.jsx)("ul",{children:e.constraints.map((e,s)=>(0,h.jsxs)("li",{children:[e.property,": ",e.value]},s))})]})]},e.id))}),r.relationships.length>0&&(0,h.jsxs)("div",{className:"relationships-section",children:[(0,h.jsxs)("h4",{children:["Relationships (",r.relationships.length,")"]}),(0,h.jsx)("div",{className:"relationships-list",children:r.relationships.map((e,s)=>(0,h.jsxs)("div",{className:"relationship-card",children:[(0,h.jsxs)("div",{className:"relationship-header",children:[(0,h.jsx)("span",{className:"relationship-type",children:e.type}),(0,h.jsx)("span",{className:"relationship-target",children:e.target})]}),(0,h.jsx)("div",{className:"relationship-description",children:e.description})]},e.id))})]})]})}),"xml"===l&&(0,h.jsxs)("div",{className:"xml-tab",children:[(0,h.jsxs)("div",{className:"xml-controls",children:[(0,h.jsx)("button",{className:"btn-secondary",onClick:()=>{d&&navigator.clipboard.writeText(d).then(()=>{alert("ArchiMate XML copied to clipboard!")})},children:"\ud83d\udccb Copy XML"}),(0,h.jsx)("button",{className:"btn-primary",onClick:u,children:"\ud83d\udcbe Download XML"})]}),(0,h.jsx)("div",{className:"xml-content",children:(0,h.jsx)("pre",{children:(0,h.jsx)("code",{children:d})})})]})]})]}),(0,h.jsxs)("div",{className:"modal-footer",children:[(0,h.jsx)("div",{className:"footer-info",children:(0,h.jsxs)("span",{children:["ArchiMate model extracted from ",i]})}),(0,h.jsxs)("div",{className:"footer-actions",children:[(0,h.jsx)("button",{className:"btn-secondary",onClick:u,children:"\ud83d\udcbe Download XML"}),(0,h.jsx)("button",{className:"btn-primary",onClick:t,children:"Close"})]})]})]})}):(0,h.jsx)("div",{className:"modal-overlay archimate-modal-overlay",onClick:t,children:(0,h.jsxs)("div",{className:"modal-content archimate-modal",onClick:e=>e.stopPropagation(),children:[(0,h.jsxs)("div",{className:"modal-header",children:[(0,h.jsx)("h3",{children:"ArchiMate Extraction Failed"}),(0,h.jsx)("button",{className:"modal-close",onClick:t,children:"\xd7"})]}),(0,h.jsx)("div",{className:"modal-body",children:(0,h.jsxs)("div",{className:"error-message",children:[(0,h.jsx)("div",{className:"error-icon",children:"\u26a0\ufe0f"}),(0,h.jsxs)("div",{className:"error-content",children:[(0,h.jsx)("h4",{children:"Extraction Error"}),(0,h.jsxs)("p",{children:["Failed to extract ArchiMate model from ",(0,h.jsx)("strong",{children:i})]}),(0,h.jsx)("div",{className:"error-details",children:(0,h.jsx)("code",{children:m})})]})]})}),(0,h.jsx)("div",{className:"modal-footer",children:(0,h.jsx)("button",{className:"btn-primary",onClick:t,children:"Close"})})]})})},x=e=>{try{console.log("\ud83d\ude80 ArchiMate extraction started for:",(null===e||void 0===e?void 0:e.name)||"unknown model");const{content:s,title:t,description:a,name:n}=e;if(!s)throw new Error("No content provided for extraction");console.log("\ud83d\udcdd Content length:",s.length,"characters");const i=j(s);console.log("\ud83d\udcca Parsed structure:",i);const l=v(i,t,a,n);console.log("\ud83c\udfd7\ufe0f Generated ArchiMate object:",l);const c=y(l);return console.log("\ud83d\udccb Generated XML length:",c.length),{success:!0,archiMateObject:l,xml:c,sourceModel:e}}catch(s){return console.error("\u274c ArchiMate extraction failed:",s),{success:!1,error:s.message,sourceModel:e}}},j=e=>{console.log("\ud83d\udd0d Starting FSH parsing...");const s=e.split("\n");console.log("\ud83d\udcc4 Total lines to parse:",s.length);const t={name:"",title:"",description:"",parent:"",elements:[],rules:[]};for(let a=0;a<s.length;a++){const e=s[a].trim();if(!e||e.startsWith("//"))continue;const n=e.match(/^Logical:\s*(.+)$/);if(n){t.name=n[1].trim();continue}const i=e.match(/^Parent:\s*(.+)$/);if(i){t.parent=i[1].trim();continue}const l=e.match(/^Title:\s*"(.+)"$/);if(l){t.title=l[1].trim();continue}const c=e.match(/^Description:\s*"(.+)"$/);if(c){t.description=c[1].trim();continue}const o=e.match(/^\*\s+([^\s:]+)\s*:\s*([^\s]+)(?:\s+(\d+\.\.\*|\d+\.\.\d+|\d+))?\s*"([^"]*)"(?:\s*"([^"]*)")?/);if(o){const[,e,s,a,n,i]=o;t.elements.push({name:e.trim(),type:s.trim(),cardinality:(null===a||void 0===a?void 0:a.trim())||"0..1",short:n.trim(),definition:(null===i||void 0===i?void 0:i.trim())||n.trim(),constraints:[]});continue}const r=e.match(/^\*\s+([^\s:]+)\s+(.+)$/);if(r&&t.elements.length>0){const[,e,s]=r;t.elements[t.elements.length-1].constraints.push({property:e.trim(),value:s.trim()})}}return console.log("\u2705 FSH parsing completed. Found:",t.elements.length,"elements"),t},v=(e,s,t,a)=>{const n=C(),i=(new Date).toISOString();return{id:n,name:e.title||s||e.name||a.replace(".fsh",""),type:"DataObject",documentation:e.description||t||"Logical model derived from ".concat(a),source:{type:"FHIR FSH Logical Model",fileName:a,originalName:e.name},metadata:{extractedAt:i,parent:e.parent,elementCount:e.elements.length},elements:e.elements.map(e=>({id:C(),name:e.name,type:"DataAttribute",dataType:g(e.type),cardinality:e.cardinality,description:e.definition,shortDescription:e.short,constraints:e.constraints,source:{fhirType:e.type,originalCardinality:e.cardinality}})),relationships:f(e.elements)}},g=e=>e.includes("Reference(")?"Reference":e.includes("CodeableConcept")?"CodeableConcept":e.includes("Coding")?"Coding":e.includes("Identifier")?"Identifier":e.includes("Period")?"Period":e.includes("Quantity")?"Quantity":{string:"String",boolean:"Boolean",integer:"Integer",decimal:"Decimal",date:"Date",dateTime:"DateTime",time:"Time",code:"Code",uri:"URI",url:"URL",canonical:"URI",base64Binary:"Binary",instant:"DateTime",positiveInt:"PositiveInteger",unsignedInt:"UnsignedInteger",id:"Identifier",oid:"OID",uuid:"UUID"}[e]||e,f=e=>{const s=[];return e.forEach(e=>{e.type&&!N(e.type)&&s.push({id:C(),type:"Composition",source:"parent",target:e.name,cardinality:e.cardinality,description:"".concat(e.name," is composed within the logical model")}),e.type.includes("Reference(")&&s.push({id:C(),type:"Aggregation",source:"parent",target:e.name,cardinality:e.cardinality,description:"".concat(e.name," references external resource")})}),s},N=e=>["string","boolean","integer","decimal","date","dateTime","time","code","uri","url","canonical","base64Binary","instant","positiveInt","unsignedInt","id","oid","uuid"].includes(e),y=e=>{const{id:s,name:t,type:a,documentation:n,elements:i,relationships:l}=e;return'<?xml version="1.0" encoding="UTF-8"?>\n<archimate:model \n  xmlns:archimate="http://www.archimatetool.com/archimate" \n  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n  name="'.concat(S(t),'" \n  id="').concat(s,'"\n  version="4.9.0">\n  \n  <documentation>').concat(S(n),'</documentation>\n  \n  \x3c!-- Data Object Element --\x3e\n  <element xsi:type="archimate:DataObject" \n           name="').concat(S(t),'" \n           id="').concat(s,'"\n           documentation="').concat(S(n),'">\n    \n    \x3c!-- Metadata Properties --\x3e\n    <property key="source.type" value="').concat(S(e.source.type),'"/>\n    <property key="source.fileName" value="').concat(S(e.source.fileName),'"/>\n    <property key="extractedAt" value="').concat(e.metadata.extractedAt,'"/>\n    <property key="elementCount" value="').concat(e.metadata.elementCount,'"/>\n    ').concat(e.metadata.parent?'<property key="parent" value="'.concat(S(e.metadata.parent),'"/>'):"","\n  </element>\n  \n  \x3c!-- Data Attributes --\x3e\n").concat(i.map(e=>'  <element xsi:type="archimate:DataObject" \n           name="'.concat(S(e.name),'" \n           id="').concat(e.id,'"\n           documentation="').concat(S(e.description),'">\n    <property key="dataType" value="').concat(S(e.dataType),'"/>\n    <property key="cardinality" value="').concat(S(e.cardinality),'"/>\n    <property key="shortDescription" value="').concat(S(e.shortDescription),'"/>\n    <property key="fhirType" value="').concat(S(e.source.fhirType),'"/>\n  </element>')).join("\n"),"\n  \n  \x3c!-- Relationships --\x3e\n").concat(l.map(e=>'  <relationship xsi:type="archimate:'.concat(e.type,'Relationship" \n              id="').concat(e.id,'"\n              source="').concat("parent"===e.source?s:e.source,'"\n              target="').concat(e.target,'">\n    <documentation>').concat(S(e.description),"</documentation>\n    ").concat(e.cardinality?'<property key="cardinality" value="'.concat(S(e.cardinality),'"/>'):"","\n  </relationship>")).join("\n"),"\n  \n</archimate:model>")},b=e=>{const s=[],t=[];e.forEach(e=>{const a=x(e);a.success?s.push(a):t.push(a)});const a=w(s);return{success:0===t.length,extractedCount:s.length,errorCount:t.length,individualResults:s,errors:t,combinedModel:a,combinedXML:a?y(a):null}},w=e=>{if(0===e.length)return null;const s=C(),t=(new Date).toISOString();return{id:s,name:"Combined Logical Models (".concat(e.length," models)"),type:"DataObject",documentation:"Combined ArchiMate model containing ".concat(e.length," logical models extracted at ").concat(t),source:{type:"Multiple FHIR FSH Logical Models",modelCount:e.length,models:e.map(e=>e.sourceModel.name)},metadata:{extractedAt:t,totalElements:e.reduce((e,s)=>e+s.archiMateObject.elements.length,0),sourceModels:e.length},elements:e.flatMap(e=>e.archiMateObject.elements),relationships:e.flatMap(e=>e.archiMateObject.relationships),subModels:e.map(e=>e.archiMateObject)}},C=()=>"id-"+Math.random().toString(36).substr(2,9)+"-"+Date.now().toString(36),S=e=>"string"!==typeof e?"":e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"),k=()=>{var e,s;const t=(0,i.Zp)(),{profile:o,repository:r,branch:d}=(0,c.oc)(),j=null===o||void 0===o?void 0:o.login,v=null===r||void 0===r?void 0:r.name,[g,f]=(0,n.useState)([]),[N,y]=(0,n.useState)(!0),[w,C]=(0,n.useState)(null),[S,k]=(0,n.useState)(null),[D,A]=(0,n.useState)(""),[M,F]=(0,n.useState)(!1),[H,L]=(0,n.useState)([]),[E,R]=(0,n.useState)(!1),[_,I]=(0,n.useState)(null),[P,O]=(0,n.useState)([]),[T,V]=(0,n.useState)(""),[K,G]=(0,n.useState)(!1),[U,B]=(0,n.useState)(!1),[X,W]=(0,n.useState)("core-data-dictionary"),[$,z]=(0,n.useState)([]),[Q,q]=(0,n.useState)(!1),[Z,J]=(0,n.useState)(null),[Y,ee]=(0,n.useState)(!1),[se,te]=(0,n.useState)(null),[ae,ne]=(0,n.useState)(!1),[ie,le]=(0,n.useState)(null),[ce,oe]=(0,n.useState)(null),re=(0,n.useCallback)(e=>{var s;const t=j||(null===r||void 0===r||null===(s=r.owner)||void 0===s?void 0:s.login)||(null===r||void 0===r?void 0:r.full_name.split("/")[0]),a=v||(null===r||void 0===r?void 0:r.name);return e===((null===r||void 0===r?void 0:r.default_branch)||"main")?"https://".concat(t,".github.io/").concat(a):"https://".concat(t,".github.io/").concat(a,"/branches/").concat(e)},[j,r,v]),de=(0,n.useCallback)(e=>{const s=[],t=e.split("\n");for(let a=0;a<t.length;a++){const e=t[a].trim().match(/^\*\s*#([^\s"]+)\s*"([^"]+)"\s*"([^"]+)"/);if(e){const[,t,a,n]=e;s.push({code:t.trim(),display:a.trim(),definition:n.trim()})}}return s},[]),he=(0,n.useCallback)((e,s)=>{const t=e.split("\n");let a=s.replace(".fsh",""),n="";for(let i=0;i<t.length;i++){const e=t[i].trim(),s=e.match(/^Logical:\s*(.+)$/);if(s){a=s[1].trim();continue}const l=e.match(/^Title:\s*"([^"]+)"/);if(l){a=l[1].trim();continue}const c=e.match(/^Description:\s*"([^"]+)"/);c&&(n=c[1].trim())}return{title:a,description:n,fileName:s}},[]),me=(0,n.useCallback)(async()=>{var e;const s=j||(null===r||void 0===r||null===(e=r.owner)||void 0===e?void 0:e.login)||(null===r||void 0===r?void 0:r.full_name.split("/")[0]),t=v||(null===r||void 0===r?void 0:r.name),n=d;if(s&&t&&n)try{q(!0),J(null);const e=(await l.A.getDirectoryContents(s,t,"input/fsh/models",n)).filter(e=>e.name.endsWith(".fsh")&&"file"===e.type).map(e=>({name:e.name,path:e.path,download_url:e.download_url,html_url:e.html_url})),i=await Promise.all(e.map(async e=>{try{const i=await l.A.getFileContent(s,t,e.path,n),c=he(i,e.name);return(0,a.A)((0,a.A)((0,a.A)({},e),c),{},{content:i})}catch(w){return console.warn("Failed to fetch content for ".concat(e.name,":"),w),(0,a.A)((0,a.A)({},e),{},{title:e.name.replace(".fsh",""),description:"Failed to load model details",content:""})}}));z(i)}catch(i){404===i.status?z([]):(console.error("Error fetching logical models:",i),J("Failed to load logical models. Please check repository access."))}finally{q(!1)}},[j,r,v,d,he]);(0,n.useEffect)(()=>{(async()=>{var e;const s=r,t=d,a=j||(null===r||void 0===r||null===(e=r.owner)||void 0===e?void 0:e.login)||(null===r||void 0===r?void 0:r.full_name.split("/")[0]),n=v||(null===r||void 0===r?void 0:r.name);if(!s&&(!a||!n)||!t)return void y(!1);try{y(!0),C(null);try{const e=(await l.A.getDirectoryContents(a,n,"input/fsh",t)).filter(e=>e.name.endsWith(".fsh")&&"file"===e.type).map(e=>({name:e.name,path:e.path,download_url:e.download_url,html_url:e.html_url}));f(e)}catch(i){if(404!==i.status)throw i;f([])}try{const e=(await l.A.getDirectoryContents(a,n,"input/fsh/codesystems",t)).find(e=>"DAK.fsh"===e.name&&"file"===e.type);if(e){I({name:e.name,path:e.path,download_url:e.download_url,html_url:e.html_url});try{const s=await l.A.getFileContent(a,n,e.path,t),i=de(s);O(i)}catch(c){console.warn("Could not parse DAK.fsh content:",c),O([])}}else I(null),O([])}catch(i){404===i.status?(I(null),O([])):(console.warn("Error fetching DAK.fsh:",i),I(null),O([]))}const e=(await l.A.getBranches(a,n)).map(e=>e.name);L(e.filter(e=>"gh-pages"!==e));const s=e.includes("gh-pages");if(R(s),s){const e=re(t),s=await(async e=>{try{B(!0);const s="".concat(e,"/CodeSystem-DAK.html");return(await fetch(s,{method:"HEAD"})).ok}catch(w){return console.warn("Error checking published DAK:",w),!1}finally{B(!1)}})(e);G(s)}else G(!1)}catch(i){console.error("Error fetching FSH files:",i),C("Failed to load Core Data Dictionary files. Please check repository access.")}finally{y(!1)}})()},[r,d,j,v,re,de]),(0,n.useEffect)(()=>{"logical-models"===X&&me()},[X,me]);const ue=async e=>{try{var s;k(e),A("Loading..."),F(!0);const t=j||(null===r||void 0===r||null===(s=r.owner)||void 0===s?void 0:s.login)||(null===r||void 0===r?void 0:r.full_name.split("/")[0]),a=v||(null===r||void 0===r?void 0:r.name),n=d,i=await l.A.getFileContent(t,a,e.path,n);A(i)}catch(t){console.error("Error fetching file content:",t),A("Error loading file content.")}},pe=()=>{F(!1),k(null),A("")},xe=()=>{ee(!1),te(null)};return o&&r?N?(0,h.jsx)("div",{className:"core-data-dictionary-viewer loading-state",children:(0,h.jsxs)("div",{className:"loading-content",children:[(0,h.jsx)("h2",{children:"Loading Core Data Dictionary..."}),(0,h.jsx)("p",{children:"Fetching FHIR FSH files and repository data..."})]})}):(0,h.jsxs)("div",{className:"core-data-dictionary-viewer",children:[(0,h.jsx)("div",{className:"viewer-content",children:(0,h.jsxs)("div",{className:"viewer-main",children:[(0,h.jsxs)("div",{className:"component-intro",children:[(0,h.jsx)("div",{className:"component-icon",style:{color:"#0078d4"},children:"\ud83d\udcca"}),(0,h.jsxs)("div",{className:"intro-content",children:[(0,h.jsx)("h2",{children:"Core Data Dictionary Viewer"}),(0,h.jsx)("p",{children:"View canonical representations of Component 2 Core Data Dictionary including FHIR CodeSystems, ValueSets, and ConceptMaps stored in FSH format."}),d&&(0,h.jsxs)("div",{className:"branch-info",children:[(0,h.jsx)("strong",{children:"Branch:"})," ",(0,h.jsx)("code",{children:d})]})]})]}),(0,h.jsxs)("div",{className:"section-tabs",children:[(0,h.jsx)("button",{className:"tab-button ".concat("core-data-dictionary"===X?"active":""),onClick:()=>W("core-data-dictionary"),children:"\ud83d\udcca Core Data Dictionary"}),(0,h.jsx)("button",{className:"tab-button ".concat("logical-models"===X?"active":""),onClick:()=>W("logical-models"),children:"\ud83d\uddc2\ufe0f Logical Models"})]}),w&&(0,h.jsxs)("div",{className:"error-message",children:[(0,h.jsx)("h3",{children:"\u26a0\ufe0f Error"}),(0,h.jsx)("p",{children:w})]}),"core-data-dictionary"===X&&(0,h.jsxs)("div",{className:"core-data-dictionary-section",children:[(0,h.jsx)("div",{className:"documentation-section",children:(0,h.jsx)("p",{children:(0,h.jsx)("a",{href:"https://smart.who.int/ig-starter-kit/v1.0.0/",target:"_blank",rel:"noopener noreferrer",className:"documentation-link",children:"\ud83d\udcda WHO IG Starter Kit Documentation \u2197"})})}),(0,h.jsxs)("div",{className:"two-column-layout",children:[(0,h.jsxs)("div",{className:"section standard-dictionaries-section left-column",children:[(0,h.jsx)("h3",{children:"Standard Dictionaries"}),(0,h.jsxs)("div",{className:"subsection",children:[(0,h.jsx)("h4",{children:"Code Systems"}),_&&(0,h.jsxs)("div",{className:"dak-source-section",children:[(0,h.jsx)("h5",{children:"DAK Source File (FSH)"}),(0,h.jsxs)("div",{className:"dak-source-links",children:[(0,h.jsx)("button",{className:"action-btn primary",onClick:()=>ue(_),title:"View DAK.fsh source code with syntax highlighting",children:"\ud83d\udcc4 View Source"}),(0,h.jsx)("a",{href:_.html_url,target:"_blank",rel:"noopener noreferrer",className:"action-btn secondary",title:"View DAK.fsh source on GitHub",children:"\ud83d\udd17 GitHub Source \u2197"})]})]}),E?(0,h.jsxs)("div",{className:"dak-published-section",children:[(0,h.jsx)("h5",{children:"Published CodeSystem"}),U?(0,h.jsx)("p",{className:"checking-published",children:"Checking published version..."}):K?(0,h.jsx)("div",{className:"dictionary-links",children:(0,h.jsx)("a",{href:"".concat(re(d),"/CodeSystem-DAK.html"),target:"_blank",rel:"noopener noreferrer",className:"dictionary-link primary",children:"\ud83d\udcca View Published Core Data Dictionary (DAK) \u2197"})}):(0,h.jsxs)("div",{className:"unpublished-dak",children:[(0,h.jsx)("span",{className:"disabled-link",children:"Core Data Dictionary (DAK)"}),(0,h.jsx)("p",{className:"unpublished-note",children:"\u26a0\ufe0f The published version is not yet available. The CodeSystem-DAK.html file has not been published to GitHub Pages."})]})]}):(0,h.jsx)("p",{className:"no-publication-note",children:"Published CodeSystems will be available once GitHub Pages is configured."})]}),P.length>0&&(0,h.jsxs)("div",{className:"subsection",children:[(0,h.jsxs)("h4",{children:["DAK Concepts (",P.length," total)"]}),(0,h.jsx)("div",{className:"dak-table-controls",children:(0,h.jsx)("input",{type:"text",placeholder:"Search concepts...",value:T,onChange:e=>V(e.target.value),className:"search-input"})}),(0,h.jsx)("div",{className:"dak-concepts-table",children:(0,h.jsxs)("table",{children:[(0,h.jsx)("thead",{children:(0,h.jsxs)("tr",{children:[(0,h.jsx)("th",{children:"Code"}),(0,h.jsx)("th",{children:"Display"}),(0,h.jsx)("th",{children:"Definition"})]})}),(0,h.jsx)("tbody",{children:P.filter(e=>!T||e.code.toLowerCase().includes(T.toLowerCase())||e.display.toLowerCase().includes(T.toLowerCase())||e.definition.toLowerCase().includes(T.toLowerCase())).map((e,s)=>(0,h.jsxs)("tr",{children:[(0,h.jsx)("td",{className:"concept-code",children:e.code}),(0,h.jsx)("td",{className:"concept-display",children:e.display}),(0,h.jsx)("td",{className:"concept-definition",children:e.definition})]},s))})]})})]}),(0,h.jsxs)("div",{className:"subsection",children:[(0,h.jsx)("h4",{children:"Value Sets"}),(0,h.jsxs)("div",{className:"placeholder-links",children:[(0,h.jsx)("span",{className:"placeholder-link",children:"Actors (Coming Soon)"}),(0,h.jsx)("span",{className:"placeholder-link",children:"Workflows (Coming Soon)"}),(0,h.jsx)("span",{className:"placeholder-link",children:"Decision Tables (Coming Soon)"})]})]})]}),E?(0,h.jsxs)("div",{className:"section publications-section right-column",children:[(0,h.jsx)("h3",{children:"Publications"}),(0,h.jsx)("p",{children:"Published FHIR Implementation Guide artifacts generated by the IG Publisher"}),H.sort().map(e=>(0,h.jsxs)("div",{className:"branch-publication",children:[(0,h.jsxs)("h4",{children:["Branch: ",(0,h.jsx)("code",{children:e})]}),(0,h.jsxs)("div",{className:"artifact-links",children:[(0,h.jsx)("a",{href:"".concat(re(e),"/artifacts.html#terminology-code-systems"),target:"_blank",rel:"noopener noreferrer",className:"artifact-link",children:"Code Systems \u2197"}),(0,h.jsx)("a",{href:"".concat(re(e),"/artifacts.html#terminology-value-sets"),target:"_blank",rel:"noopener noreferrer",className:"artifact-link",children:"Value Sets \u2197"}),(0,h.jsx)("a",{href:"".concat(re(e),"/artifacts.html#structures-logical-models"),target:"_blank",rel:"noopener noreferrer",className:"artifact-link",children:"Logical Models \u2197"}),(0,h.jsx)("a",{href:"".concat(re(e),"/artifacts.html#terminology-concept-maps"),target:"_blank",rel:"noopener noreferrer",className:"artifact-link",children:"Concept Maps \u2197"})]})]},e))]}):(0,h.jsxs)("div",{className:"section no-publications-section right-column",children:[(0,h.jsx)("h3",{children:"Publications"}),(0,h.jsxs)("div",{className:"no-gh-pages-message",children:[(0,h.jsx)("p",{children:"\ud83d\udccb No published artifacts available"}),(0,h.jsxs)("p",{children:["This repository does not have a ",(0,h.jsx)("code",{children:"gh-pages"})," branch for publishing FHIR Implementation Guide artifacts."]})]})]})]}),(0,h.jsxs)("div",{className:"section fsh-files-section",children:[(0,h.jsx)("h3",{children:"FHIR FSH Source Files"}),(0,h.jsx)("p",{children:"FHIR Shorthand (FSH) files containing CodeSystems, ValueSets, and ConceptMaps"}),0===g.length?(0,h.jsxs)("div",{className:"no-files-message",children:[(0,h.jsxs)("p",{children:["No FHIR FSH files found in ",(0,h.jsx)("code",{children:"input/fsh/"})," directory."]}),(0,h.jsx)("p",{children:"Core Data Dictionary files should be stored in FSH format in this location."})]}):(0,h.jsx)("div",{className:"fsh-files-grid",children:g.map(e=>(0,h.jsxs)("div",{className:"fsh-file-card",children:[(0,h.jsxs)("div",{className:"file-header",children:[(0,h.jsx)("div",{className:"file-icon",children:"\ud83d\udcc4"}),(0,h.jsx)("div",{className:"file-name",children:e.name})]}),(0,h.jsxs)("div",{className:"file-actions",children:[(0,h.jsx)("button",{className:"action-btn primary",onClick:()=>ue(e),title:"View source code with syntax highlighting",children:"View Source"}),(0,h.jsx)("a",{href:e.html_url,target:"_blank",rel:"noopener noreferrer",className:"action-btn secondary",title:"View source on GitHub",children:"GitHub \u2197"})]})]},e.path))})]})]}),"logical-models"===X&&(0,h.jsxs)("div",{className:"logical-models-section",children:[(0,h.jsxs)("div",{className:"global-tools",children:[(0,h.jsx)("h3",{children:"Global Tools"}),(0,h.jsxs)("div",{className:"global-tools-buttons",children:[(0,h.jsx)("button",{className:"action-btn primary",onClick:async()=>{try{oe("bulk");const e=await b($);le(e),ne(!0),oe(null)}catch(w){console.error("Bulk ArchiMate extraction failed:",w),le({success:!1,error:w.message,sourceModel:{name:"All Models"}}),ne(!0),oe(null)}},disabled:0===$.length||"bulk"===ce,title:"Extract all logical models to ArchiMate DataObjects with relationships",children:"bulk"===ce?"\u23f3 Extracting All...":"\ud83d\udce6 Extract All to ArchiMate (".concat($.length,")")}),(0,h.jsxs)("button",{className:"action-btn secondary",onClick:()=>me(),disabled:Q,title:"Refresh the list of logical models",children:["\ud83d\udd04 ",Q?"Refreshing...":"Refresh All Models"]})]})]}),(0,h.jsxs)("div",{className:"logical-models-list",children:[(0,h.jsx)("h3",{children:"Logical Models"}),(0,h.jsxs)("p",{children:["FHIR Logical Models stored as StructureDefinitions in FSH format under ",(0,h.jsx)("code",{children:"input/fsh/models/"})]}),Q&&(0,h.jsx)("div",{className:"loading-message",children:(0,h.jsx)("p",{children:"\ud83d\udd04 Loading logical models..."})}),Z&&(0,h.jsxs)("div",{className:"error-message",children:[(0,h.jsx)("h4",{children:"\u26a0\ufe0f Error"}),(0,h.jsx)("p",{children:Z})]}),!Q&&!Z&&0===$.length&&(0,h.jsxs)("div",{className:"no-models-message",children:[(0,h.jsxs)("p",{children:["\ud83d\udcc2 No logical models found in ",(0,h.jsx)("code",{children:"input/fsh/models/"})," directory."]}),(0,h.jsxs)("p",{children:["Logical models should be stored as ",(0,h.jsx)("code",{children:"*.fsh"})," files in this location."]})]}),!Q&&$.length>0&&(0,h.jsx)("div",{className:"logical-models-grid",children:$.map(e=>(0,h.jsxs)("div",{className:"logical-model-card",children:[(0,h.jsxs)("div",{className:"model-header",children:[(0,h.jsx)("div",{className:"model-icon",children:"\ud83d\uddc2\ufe0f"}),(0,h.jsxs)("div",{className:"model-info",children:[(0,h.jsx)("div",{className:"model-title",children:e.title}),(0,h.jsx)("div",{className:"model-filename",children:e.name})]})]}),e.description&&(0,h.jsx)("div",{className:"model-description",children:e.description}),(0,h.jsxs)("div",{className:"model-actions",children:[(0,h.jsx)("button",{className:"action-btn primary",onClick:()=>(e=>{k({name:e.name,path:e.path,html_url:e.html_url}),A(e.content),F(!0)})(e),title:"View FSH source with syntax highlighting",children:"\ud83d\udcc4 View"}),(0,h.jsx)("button",{className:"action-btn secondary",onClick:()=>(e=>{te(e),ee(!0)})(e),title:"Edit FSH file with syntax highlighting and validation",children:"\u270f\ufe0f Edit"}),(0,h.jsx)("button",{className:"action-btn tertiary",onClick:()=>(async e=>{try{oe(e.name);const s=await x(e);le(s),ne(!0),oe(null)}catch(w){console.error("ArchiMate extraction failed:",w),le({success:!1,error:w.message,sourceModel:e}),ne(!0),oe(null)}})(e),title:"Extract to ArchiMate DataObject",disabled:ce===e.name,children:ce===e.name?"\u23f3 Extracting...":"\ud83d\udcca Extract to ArchiMate"})]})]},e.path))})]})]})]})}),M&&S&&(0,h.jsx)("div",{className:"modal-overlay",onClick:pe,children:(0,h.jsxs)("div",{className:"modal-content fsh-modal",onClick:e=>e.stopPropagation(),children:[(0,h.jsxs)("div",{className:"modal-header",children:[(0,h.jsx)("h3",{children:"View FSH File"}),(0,h.jsx)("button",{className:"modal-close",onClick:pe,children:"\xd7"})]}),(0,h.jsx)("div",{className:"modal-body",children:(0,h.jsx)(m,{content:D,fileName:S.name,showLineNumbers:!0,className:"modal-fsh-viewer"})}),(0,h.jsxs)("div",{className:"modal-footer",children:[(0,h.jsx)("a",{href:S.html_url,target:"_blank",rel:"noopener noreferrer",className:"btn-secondary",children:"View on GitHub \u2197"}),(0,h.jsx)("button",{className:"btn-primary",onClick:pe,children:"Close"})]})]})}),Y&&se&&(0,h.jsx)("div",{className:"modal-overlay",onClick:xe,children:(0,h.jsxs)("div",{className:"modal-content fsh-modal editor-modal",onClick:e=>e.stopPropagation(),children:[(0,h.jsxs)("div",{className:"modal-header",children:[(0,h.jsx)("h3",{children:"Edit Logical Model"}),(0,h.jsx)("button",{className:"modal-close",onClick:xe,children:"\xd7"})]}),(0,h.jsx)("div",{className:"modal-body",children:(0,h.jsx)(u,{content:se.content,fileName:se.name,onSave:e=>{console.log("Saving logical model:",null===se||void 0===se?void 0:se.name,e),alert("Save functionality will be implemented with proper GitHub integration"),ee(!1),te(null)},showPreview:!0,className:"modal-fsh-editor"})}),(0,h.jsxs)("div",{className:"modal-footer",children:[(0,h.jsx)("a",{href:se.html_url,target:"_blank",rel:"noopener noreferrer",className:"btn-secondary",children:"View on GitHub \u2197"}),(0,h.jsx)("button",{className:"btn-primary",onClick:xe,children:"Close"})]})]})}),(0,h.jsx)(p,{isOpen:ae,onClose:()=>{ne(!1),le(null)},extractionResult:ie,sourceModelName:(null===ie||void 0===ie||null===(e=ie.sourceModel)||void 0===e?void 0:e.title)||(null===ie||void 0===ie||null===(s=ie.sourceModel)||void 0===s?void 0:s.name)||"Logical Model"})]}):(t("/"),(0,h.jsx)("div",{children:"Redirecting..."}))},D=()=>(0,h.jsx)(c.Mx,{pageName:"core-data-dictionary-viewer",children:(0,h.jsx)(k,{})})}}]);