"use strict";(self.webpackChunksgex_workbench=self.webpackChunksgex_workbench||[]).push([[3442],{93442:(e,s,n)=>{n.r(s),n.d(s,{default:()=>u});var t=n(89379),a=n(9950),i=n(85001),o=n(29946),c=n(57561),l=n(90584),r=n(44414);const d=e=>{let{page:s,onClose:n}=e;if(!s)return null;const t=s.content?atob(s.content.content):"";return(0,r.jsx)("div",{className:"page-view-modal-overlay",onClick:e=>{e.target===e.currentTarget&&n()},children:(0,r.jsxs)("div",{className:"page-view-modal",children:[(0,r.jsxs)("div",{className:"page-view-modal-header",children:[(0,r.jsx)("h2",{children:s.title}),(0,r.jsx)("button",{className:"close-btn",onClick:n,"aria-label":"Close page view",children:"\xd7"})]}),(0,r.jsxs)("div",{className:"page-view-modal-content",children:[(0,r.jsxs)("div",{className:"page-info",children:[(0,r.jsx)("span",{className:"page-filename",children:s.filename}),(0,r.jsx)("span",{className:"page-path",children:s.path})]}),(0,r.jsxs)("div",{className:"page-content",children:[(0,r.jsxs)("div",{className:"content-tabs",children:[(0,r.jsx)("button",{className:"tab-btn active",children:"Rendered"}),(0,r.jsx)("button",{className:"tab-btn",onClick:()=>{const e=document.querySelector(".rendered-content"),s=document.querySelector(".raw-content"),n=document.querySelectorAll(".tab-btn");"none"===e.style.display?(e.style.display="block",s.style.display="none",n[0].classList.add("active"),n[1].classList.remove("active")):(e.style.display="none",s.style.display="block",n[0].classList.remove("active"),n[1].classList.add("active"))},children:"Raw Markdown"})]}),(0,r.jsx)("div",{className:"rendered-content",dangerouslySetInnerHTML:{__html:(a=t,a.replace(/^# (.*$)/gim,"<h1>$1</h1>").replace(/^## (.*$)/gim,"<h2>$1</h2>").replace(/^### (.*$)/gim,"<h3>$1</h3>").replace(/^\* (.*$)/gim,"<li>$1</li>").replace(/^- (.*$)/gim,"<li>$1</li>").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`(.*?)`/g,"<code>$1</code>").replace(/\n/g,"<br>"))}}),(0,r.jsx)("div",{className:"raw-content",style:{display:"none"},children:(0,r.jsx)("pre",{children:t})})]})]})]})});var a},h=(0,a.lazy)(()=>Promise.all([n.e(3738),n.e(7845),n.e(2383),n.e(5743)]).then(n.bind(n,25743))),g=e=>{let{page:s,onClose:n,onSave:t}=e;const[i,o]=(0,a.useState)(null!==s&&void 0!==s&&s.content?atob(s.content.content):""),[l,d]=(0,a.useState)(!1);if(!s)return null;return(0,r.jsx)("div",{className:"page-edit-modal-overlay",onClick:e=>{e.target===e.currentTarget&&n()},children:(0,r.jsxs)("div",{className:"page-edit-modal",children:[(0,r.jsxs)("div",{className:"page-edit-modal-header",children:[(0,r.jsxs)("h2",{children:["Edit ",s.title]}),(0,r.jsxs)("div",{className:"header-actions",children:[(0,r.jsx)("button",{className:"btn-secondary",onClick:n,disabled:l,children:"Cancel"}),(0,r.jsx)("button",{className:"btn-primary",onClick:async()=>{d(!0);try{if(!c.A.updateFile(s.path,i,{title:s.title,filename:s.filename,tool:"PageEditor",contentType:"markdown"}))throw new Error("Failed to save to staging ground");t&&await t(s,i,"staged"),n()}catch(e){console.error("Failed to save page:",e),alert("Failed to save page to staging ground. Please try again.")}finally{d(!1)}},disabled:l,children:l?"Staging...":"Stage Changes"})]})]}),(0,r.jsxs)("div",{className:"page-edit-modal-content",children:[(0,r.jsxs)("div",{className:"page-info",children:[(0,r.jsx)("span",{className:"page-filename",children:s.filename}),(0,r.jsx)("span",{className:"page-path",children:s.path})]}),(0,r.jsx)("div",{className:"md-editor-container",children:(0,r.jsx)(a.Suspense,{fallback:(0,r.jsx)("div",{className:"loading-spinner",children:"Loading editor..."}),children:(0,r.jsx)(h,{value:i,onChange:e=>o(e||""),preview:"edit",height:500,visibleDragBar:!1,"data-color-mode":"light",hideToolbar:l})})})]})]})})};var m=n(32675);const u=()=>{const e=(0,i.zy)(),s=(0,i.Zp)(),{profile:n,repository:h,selectedBranch:u}=e.state||{},[p,f]=(0,a.useState)([]),[x,v]=(0,a.useState)(!0),[j,b]=(0,a.useState)(null),[y,N]=(0,a.useState)(!1),[w,k]=(0,a.useState)(!0),[S,A]=(0,a.useState)(null),[C,E]=(0,a.useState)(null);(0,a.useEffect)(()=>{(async()=>{if(o.A.isAuth())return void k(!1);const e=sessionStorage.getItem("github_token")||localStorage.getItem("github_token");if(e){console.log("Restoring GitHub authentication from stored token");o.A.authenticate(e)?console.log("GitHub authentication restored successfully"):(console.warn("Failed to restore GitHub authentication"),sessionStorage.removeItem("github_token"),localStorage.removeItem("github_token"))}else console.warn("No stored GitHub token found");k(!1)})()},[]),(0,a.useEffect)(()=>{w||(async()=>{if(h&&n&&!w)try{var e;const s=await o.A.checkRepositoryWritePermissions((null===(e=h.owner)||void 0===e?void 0:e.login)||h.full_name.split("/")[0],h.name);N(s)}catch(j){console.warn("Could not check write permissions:",j),N(!1)}})()},[h,n,w]),(0,a.useEffect)(()=>{h&&u&&!w&&c.A.initialize(h,u)},[h,u,w]),(0,a.useEffect)(()=>{(async()=>{if(!n||!h)return void s("/");if(w)return;if(!o.A.isAuth())return b("GitHub authentication not available. Please return to the home page and sign in again."),void v(!1);let e=0;for(;e<3;){try{var t;v(!0),b(null);const s=(null===(t=h.owner)||void 0===t?void 0:t.login)||h.full_name.split("/")[0],n=h.name,a=u||"main";if(console.log("Loading pages for ".concat(s,"/").concat(n," on branch: ").concat(a," (attempt ").concat(e+1,")")),console.log("selectedBranch:",u),console.log("GitHub auth status:",o.A.isAuth()),console.log("GitHub octokit:",!!o.A.octokit),!o.A.isAuth()||!o.A.octokit){if(e<2){console.log("GitHub service not ready, waiting..."),await new Promise(e=>setTimeout(e,1e3)),e++;continue}throw new Error("GitHub service not authenticated. Please return to the home page and sign in again.")}const i=await G(s,n,a);if(!i)throw new Error('sushi-config.yaml not found in repository on branch "'.concat(a,'"'));const c=_(i),l=await H(s,n,a,c);f(l);break}catch(j){if(console.error("Failed to load pages:",j),e<2){e++,await new Promise(e=>setTimeout(e,500));continue}b(j.message)}finally{v(!1)}break}})()},[n,h,u,s,w]);const G=async(e,s,n)=>{try{if(!o.A.isAuth())throw new Error("GitHub service not authenticated");console.log("Fetching sushi-config.yaml from ".concat(e,"/").concat(s," on branch ").concat(n));const t=await o.A.getFileContent(e,s,"sushi-config.yaml",n);return t?(console.log("Successfully fetched sushi-config.yaml"),t):(console.log("sushi-config.yaml found but no content"),null)}catch(j){throw console.error("Failed to fetch sushi-config.yaml:",j),j.message.includes("File not found")?new Error('sushi-config.yaml not found in repository on branch "'.concat(n,'"')):j.message.includes("Access denied")?new Error("Access denied - insufficient permissions to read repository contents"):j.message.includes("Authentication failed")?new Error("Authentication failed - please check your GitHub token"):o.A.isAuth()?new Error("Failed to fetch sushi-config.yaml: ".concat(j.message)):new Error("GitHub service not authenticated")}},_=e=>{const s=[];try{const n=e.split("\n");let t=!1,a=0;for(let e=0;e<n.length;e++){const i=n[e],o=i.trim();if("pages:"!==o){if(t){const t=i.length-i.trimStart().length;if(o&&t<=a)break;if(o.endsWith(".md:")){const i=o.replace(":","").trim();let c=i;for(let s=e+1;s<n.length;s++){const e=n[s],a=e.trim(),i=e.length-e.trimStart().length;if(a&&i<=t)break;if(a.startsWith("title:")){c=a.replace("title:","").trim();break}}s.push({title:c,filename:i,path:"input/pagecontent/".concat(i),level:Math.floor((t-a)/2)})}else if(o.endsWith(":")&&!o.includes(".md")){const e=o.replace(":","").trim();e&&s.push({title:e,isSection:!0,level:Math.floor((t-a)/2)})}}}else t=!0,a=i.length-i.trimStart().length}}catch(j){console.error("Failed to parse pages from sushi-config.yaml:",j)}return s},H=async(e,s,n,a)=>{const i=[];for(const c of a){if(c.isSection){i.push(c);continue}let a=!1,l=null;try{if(o.A.isAuth()){const t=await o.A.getFileContent(e,s,c.path,n);t&&(a=!0,l={type:"file",content:btoa(t),path:c.path})}}catch(j){a=!1}i.push((0,t.A)((0,t.A)({},c),{},{exists:a,content:l,githubUrl:"https://github.com/".concat(e,"/").concat(s,"/blob/").concat(n,"/").concat(c.path)}))}return i};return(0,a.useEffect)(()=>{n&&h||s("/")},[n,h,s]),n&&h?(0,r.jsx)(l.Mx,{pageName:"pages-manager",children:(0,r.jsxs)("div",{className:"pages-manager",children:[(0,r.jsxs)("div",{className:"pages-content",children:[(0,r.jsx)(m.A,{repository:h,selectedBranch:u,hasWriteAccess:y,profile:n}),(0,r.jsxs)("div",{className:"pages-main",children:[(0,r.jsxs)("div",{className:"pages-intro",children:[(0,r.jsxs)("h2",{children:[(0,r.jsx)("span",{className:"component-icon",style:{color:"#8b5cf6"},children:"\ud83d\udcc4"}),"Pages"]}),(0,r.jsxs)("p",{children:["Published page content and documentation for ",(0,r.jsx)("strong",{children:h.name}),u&&(0,r.jsxs)("span",{children:[" on branch ",(0,r.jsx)("code",{className:"branch-display",children:u})]}),". Pages are defined in ",(0,r.jsx)("code",{children:"sushi-config.yaml"})," and stored as Markdown files in ",(0,r.jsx)("code",{children:"input/pagecontent/"}),"."]})]}),(x||w)&&(0,r.jsxs)("div",{className:"loading-state",children:[(0,r.jsx)("div",{className:"loading-spinner"}),(0,r.jsx)("p",{children:w?"Initializing GitHub authentication...":"Loading pages from sushi-config.yaml..."})]}),j&&(0,r.jsxs)("div",{className:"error-state",children:[(0,r.jsx)("div",{className:"error-icon",children:"\u26a0\ufe0f"}),(0,r.jsxs)("div",{className:"error-content",children:[(0,r.jsx)("h3",{children:"Could not load pages"}),(0,r.jsx)("p",{children:j}),(0,r.jsxs)("div",{className:"error-suggestions",children:[(0,r.jsx)("p",{children:"Make sure:"}),(0,r.jsxs)("ul",{children:[(0,r.jsxs)("li",{children:["The repository contains a ",(0,r.jsx)("code",{children:"sushi-config.yaml"})," file",u&&' on branch "'.concat(u,'"')]}),(0,r.jsxs)("li",{children:["The sushi-config.yaml file has a ",(0,r.jsx)("code",{children:"pages:"})," section"]}),(0,r.jsx)("li",{children:"You have access to view the repository contents"}),u&&"main"!==u&&(0,r.jsxs)("li",{children:['The branch "',u,'" exists and is accessible']})]})]})]})]}),!x&&!w&&!j&&0===p.length&&(0,r.jsxs)("div",{className:"empty-state",children:[(0,r.jsx)("div",{className:"empty-icon",children:"\ud83d\udcc4"}),(0,r.jsx)("h3",{children:"No pages found"}),(0,r.jsx)("p",{children:"This repository doesn't have any pages defined in sushi-config.yaml"}),(0,r.jsx)("div",{className:"empty-actions",children:(0,r.jsx)("a",{href:"https://github.com/".concat(h.full_name,"/blob/").concat(u||"main","/sushi-config.yaml"),target:"_blank",rel:"noopener noreferrer",className:"btn-secondary",children:"View sushi-config.yaml"})})]}),!x&&!w&&!j&&p.length>0&&(0,r.jsxs)("div",{className:"pages-list",children:[(0,r.jsxs)("div",{className:"pages-header-info",children:[(0,r.jsxs)("div",{className:"pages-count",children:[p.filter(e=>!e.isSection).length," pages found"]}),(0,r.jsx)("div",{className:"pages-actions",children:(0,r.jsx)("a",{href:"https://github.com/".concat(h.full_name,"/blob/").concat(u||"main","/sushi-config.yaml"),target:"_blank",rel:"noopener noreferrer",className:"btn-secondary small",children:"View sushi-config.yaml"})})]}),(0,r.jsx)("div",{className:"pages-tree",children:p.map((e,s)=>(0,r.jsx)("div",{className:"page-item ".concat(e.isSection?"section":"page"," level-").concat(e.level),style:{"--indent-level":e.level},children:e.isSection?(0,r.jsxs)("div",{className:"section-header",children:[(0,r.jsx)("span",{className:"section-icon",children:"\ud83d\udcc1"}),(0,r.jsx)("span",{className:"section-title",children:e.title})]}):(0,r.jsxs)("div",{className:"page-row",children:[(0,r.jsxs)("div",{className:"page-info",children:[(0,r.jsxs)("div",{className:"page-title",children:[(0,r.jsx)("span",{className:"page-status ".concat(e.exists?"exists":"missing"),children:e.exists?"\u2705":"\u274c"}),(0,r.jsx)("span",{className:"page-name",children:e.title}),(0,r.jsxs)("span",{className:"page-filename",children:["(",e.filename,")"]})]}),!e.exists&&(0,r.jsx)("div",{className:"page-error",children:"File not found in repository"})]}),(0,r.jsxs)("div",{className:"page-actions",children:[e.exists&&(0,r.jsx)("button",{onClick:()=>(e=>{A(e)})(e),className:"btn-action view",title:"View page content",children:"\ud83d\udc41\ufe0f View"}),(0,r.jsx)("button",{onClick:()=>(e=>{E(e)})(e),className:"btn-action edit",title:"Edit page with WYSIWYG editor",children:"\u270f\ufe0f Edit"}),(0,r.jsx)("a",{href:e.githubUrl,target:"_blank",rel:"noopener noreferrer",className:"btn-action source",title:"View source on GitHub",children:"\ud83d\udd17 Source"})]})]})},s))})]})]})]}),S&&(0,r.jsx)(d,{page:S,onClose:()=>A(null)}),C&&(0,r.jsx)(g,{page:C,onClose:()=>E(null),onSave:async function(e,s){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"staged";if("staged"!==n){if("direct"===n&&!y)throw new Error("You need write access to save changes. Please upgrade your GitHub token permissions.");if("direct"===n){var t,a,i;const n=(null===(t=h.owner)||void 0===t?void 0:t.login)||h.full_name.split("/")[0],c=u||"main",l=btoa(s),r=null===(a=e.content)||void 0===a?void 0:a.sha;await o.A.octokit.rest.repos.createOrUpdateFileContents({owner:n,repo:h.name,path:e.path,message:"Update ".concat(e.filename," via SGEX Workbench"),content:l,branch:c,sha:r});const d=(null===(i=h.owner)||void 0===i?void 0:i.login)||h.full_name.split("/")[0],g=await G(d,h.name,c);if(g){const e=_(g),s=await H(d,h.name,c,e);f(s)}}}else console.log("Page ".concat(e.filename," has been staged for commit"))}})]})}):(0,r.jsx)(l.Mx,{pageName:"pages-manager",children:(0,r.jsx)("div",{className:"pages-manager",children:(0,r.jsxs)("div",{className:"redirecting-state",children:[(0,r.jsx)("h2",{children:"Redirecting..."}),(0,r.jsx)("p",{children:"Missing required context. Redirecting to home page..."})]})})})}}}]);