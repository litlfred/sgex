"use strict";(self.webpackChunksgex_workbench=self.webpackChunksgex_workbench||[]).push([[5989],{65989:(e,n,s)=>{s.r(n),s.d(n,{default:()=>d});var t=s(9950),i=s(85001),a=s(29946);const c=new class{constructor(){this.cache=new Map,this.maxDepth=5}async detectLogicalModels(e,n,s,t){const i="".concat(n,"/").concat(s,"/").concat(t);if(console.log("\ud83d\ude80 Scanning for logical models in ".concat(i)),this.cache.has(i)){const e=this.cache.get(i);return console.log("\ud83d\udccb Using cached ".concat(e.length," logical models for ").concat(i)),e}try{const e=await this.scanFSHFilesForLogicalModels(n,s,t);return console.log("\ud83d\udcbe Found and caching ".concat(e.length," logical models for ").concat(i),e.map(e=>"".concat(e.id," (").concat(e.title||e.name,")"))),this.cache.set(i,e),e}catch(a){return console.warn("Error detecting logical models:",a),[]}}async scanFSHFilesForLogicalModels(e,n,s){const t=[];try{const c=["input/fsh","input/fsh/logicalmodels","input/fsh/profiles","input/fsh/models"];console.log("\ud83d\udcc2 Scanning FSH directories in ".concat(e,"/").concat(n,"/").concat(s,": ").concat(c.join(", ")));for(const o of c)try{const i=(await a.A.getDirectoryContents(e,n,o,s)).filter(e=>"file"===e.type&&e.name.endsWith(".fsh"));if(i.length>0){console.log("\ud83d\udcc4 Found ".concat(i.length," FSH files in ").concat(o,": ").concat(i.map(e=>e.name).join(", ")));for(const c of i){const i=await a.A.getFileContent(e,n,c.path,s),o=this.parseFSHForLogicalModels(i,c.path);o.length>0&&(console.log("\ud83c\udfaf Found ".concat(o.length," logical models in ").concat(c.path,": ").concat(o.map(e=>e.id).join(", "))),t.push(...o))}}}catch(i){console.debug("Directory ".concat(o," not accessible: ").concat(i.message))}console.log("\u2705 Total logical models discovered: ".concat(t.length),t.map(e=>"".concat(e.id," (").concat(e.title||e.name,")")))}catch(c){console.warn("Error scanning FSH files for logical models:",c)}return t}parseFSHForLogicalModels(e,n){const s=[],t=e.split("\n");let i=null,a=!1;for(let c=0;c<t.length;c++){const e=t[c].trim();if(!e||e.startsWith("//"))continue;const o=e.match(/^Logical:\s*(\S+)/i);if(o){i&&s.push(i),i={id:o[1],name:o[1],title:"",description:"",elements:[],filePath:n,type:"LogicalModel"},a=!0;continue}if(a&&e.match(/^(Profile|Extension|ValueSet|CodeSystem|Instance|Invariant):/i)){i&&(s.push(i),i=null),a=!1;continue}if(!a||!i)continue;e.match(/^Title:\s*/i)?i.title=e.replace(/^Title:\s*/i,"").trim().replace(/"/g,""):e.match(/^Description:\s*/i)?i.description=e.replace(/^Description:\s*/i,"").trim().replace(/"/g,""):e.match(/^Id:\s*/i)&&(i.id=e.replace(/^Id:\s*/i,"").trim());let l=e.match(/^\*\s+(\S+)\s+(\d+)\.\.(\d+|\*)\s+(\S+)\s*"([^"]+)"/);if(l||(l=e.match(/^\*\s+(\S+)\s+(\d+)\.\.(\d+|\*)\s+(\S+)/)),l){const[,e,n,s,t,a=""]=l,c={name:e,path:"".concat(i.id,".").concat(e),min:parseInt(n),max:"*"===s?"*":parseInt(s),type:t,description:a,required:parseInt(n)>0};i.elements.push(c)}}return i&&s.push(i),s}generateQuestionnaireFromLogicalModel(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{questionnaireId:s="questionnaire-".concat(e.id.toLowerCase()),title:t="Questionnaire for ".concat(e.title||e.name),description:i="Auto-generated questionnaire based on ".concat(e.title||e.name," logical model"),prefix:a="q"}=n,c={resourceType:"Questionnaire",id:s,url:"http://example.org/fhir/Questionnaire/".concat(s),version:"1.0.0",name:s,title:t,status:"draft",date:(new Date).toISOString().split("T")[0],publisher:"WHO SMART Guidelines",description:i,meta:{profile:["http://hl7.org/fhir/StructureDefinition/Questionnaire"]},item:[]};c.extension=[{url:"http://smart.who.int/fhir/StructureDefinition/sgex-source-logical-model",valueString:e.id}];let o=1;for(const l of e.elements||[]){const e=this.generateQuestionFromElement(l,o,a);c.item.push(e),o++}return c}generateQuestionFromElement(e,n){const s={linkId:"".concat(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"q","-").concat(n),code:[{system:"http://smart.who.int/fhir/CodeSystem/sgex-logical-model-elements",code:e.name,display:e.description||e.name}],text:e.description||e.name,type:this.mapTypeToQuestionType(e.type),required:e.required||!1};return("*"===e.max||e.max>1)&&(s.repeats=!0),e.description&&e.description!==e.name&&(s.extension=[{url:"http://hl7.org/fhir/StructureDefinition/questionnaire-itemControl",valueCodeableConcept:{coding:[{system:"http://hl7.org/fhir/questionnaire-item-control",code:"help",display:"Help-Button"}]}}]),s}mapTypeToQuestionType(e){return{string:"string",text:"text",boolean:"boolean",integer:"integer",decimal:"decimal",date:"date",dateTime:"dateTime",time:"time",code:"choice",Coding:"choice",CodeableConcept:"choice",Quantity:"quantity",url:"url",uri:"url"}[e]||"string"}clearCache(){this.cache.clear()}getCacheStats(){return{size:this.cache.size,keys:Array.from(this.cache.keys())}}};var o=s(90584),l=s(44414);const r=()=>{const e=(0,i.Zp)(),{profile:n,repository:s,branch:r}=(0,o.oc)(),d=null===n||void 0===n?void 0:n.login,h=null===s||void 0===s?void 0:s.name,[m,u]=(0,t.useState)([]),[p,g]=(0,t.useState)(!0),[f,x]=(0,t.useState)(null),[j,v]=(0,t.useState)(null),[b,y]=(0,t.useState)(""),[N,S]=(0,t.useState)(!1),[C,w]=(0,t.useState)([]),[k,D]=(0,t.useState)(!1),[F,H]=(0,t.useState)(null),[A,_]=(0,t.useState)([]),[I,L]=(0,t.useState)(""),[T,E]=(0,t.useState)(!1),[M,q]=(0,t.useState)(!1),[P,V]=(0,t.useState)([]),[K,G]=(0,t.useState)(!1),Q=(0,t.useCallback)(e=>{var n;const t=d||(null===s||void 0===s||null===(n=s.owner)||void 0===n?void 0:n.login)||(null===s||void 0===s?void 0:s.full_name.split("/")[0]),i=h||(null===s||void 0===s?void 0:s.name);return e===((null===s||void 0===s?void 0:s.default_branch)||"main")?"https://".concat(t,".github.io/").concat(i):"https://".concat(t,".github.io/").concat(i,"/branches/").concat(e)},[d,s,h]),R=(0,t.useCallback)(e=>{const n=[],s=e.split("\n");for(let t=0;t<s.length;t++){const e=s[t].trim().match(/^\*\s*#([^\s"]+)\s*"([^"]+)"\s*"([^"]+)"/);if(e){const[,s,t,i]=e;n.push({code:s.trim(),display:t.trim(),definition:i.trim()})}}return n},[]);(0,t.useEffect)(()=>{(async()=>{var e;const n=s,t=r,i=d||(null===s||void 0===s||null===(e=s.owner)||void 0===e?void 0:e.login)||(null===s||void 0===s?void 0:s.full_name.split("/")[0]),o=h||(null===s||void 0===s?void 0:s.name);if(!n&&(!i||!o)||!t)return void g(!1);try{g(!0),x(null);try{const e=(await a.A.getDirectoryContents(i,o,"input/fsh",t)).filter(e=>e.name.endsWith(".fsh")&&"file"===e.type).map(e=>({name:e.name,path:e.path,download_url:e.download_url,html_url:e.html_url}));u(e)}catch(l){if(404!==l.status)throw l;u([])}try{const e=(await a.A.getDirectoryContents(i,o,"input/fsh/codesystems",t)).find(e=>"DAK.fsh"===e.name&&"file"===e.type);if(e){H({name:e.name,path:e.path,download_url:e.download_url,html_url:e.html_url});try{const n=await a.A.getFileContent(i,o,e.path,t),s=R(n);_(s)}catch(m){console.warn("Could not parse DAK.fsh content:",m),_([])}}else H(null),_([])}catch(l){404===l.status?(H(null),_([])):(console.warn("Error fetching DAK.fsh:",l),H(null),_([]))}const e=(await a.A.getBranches(i,o)).map(e=>e.name);w(e.filter(e=>"gh-pages"!==e));const n=e.includes("gh-pages");if(D(n),n){const e=Q(t),n=await(async e=>{try{q(!0);const n="".concat(e,"/CodeSystem-DAK.html");return(await fetch(n,{method:"HEAD"})).ok}catch(f){return console.warn("Error checking published DAK:",f),!1}finally{q(!1)}})(e);E(n)}G(!0);try{const e=Q(t),n=await c.detectLogicalModels(e,i,o,t);V(n)}catch(f){console.warn("Error detecting logical models:",f),V([])}finally{G(!1)}}catch(l){console.error("Error fetching FSH files:",l),x("Failed to load Core Data Dictionary files. Please check repository access.")}finally{g(!1)}})()},[s,r,d,h,Q,R]);const W=async e=>{try{var n;v(e),y("Loading..."),S(!0);const t=d||(null===s||void 0===s||null===(n=s.owner)||void 0===n?void 0:n.login)||(null===s||void 0===s?void 0:s.full_name.split("/")[0]),i=h||(null===s||void 0===s?void 0:s.name),c=r,o=await a.A.getFileContent(t,i,e.path,c);y(o)}catch(t){console.error("Error fetching file content:",t),y("Error loading file content.")}},B=()=>{S(!1),v(null),y("")};return n&&s?p?(0,l.jsx)("div",{className:"core-data-dictionary-viewer loading-state",children:(0,l.jsxs)("div",{className:"loading-content",children:[(0,l.jsx)("h2",{children:"Loading Core Data Dictionary..."}),(0,l.jsx)("p",{children:"Fetching FHIR FSH files and repository data..."})]})}):(0,l.jsxs)("div",{className:"core-data-dictionary-viewer",children:[(0,l.jsxs)("div",{className:"viewer-header",children:[(0,l.jsxs)("div",{className:"who-branding",children:[(0,l.jsx)("h1",{onClick:()=>{e("/")},className:"clickable-title",children:"SGEX Workbench"}),(0,l.jsx)("p",{className:"subtitle",children:"WHO SMART Guidelines Exchange"})]}),(0,l.jsxs)("div",{className:"context-info",children:[(0,l.jsx)("img",{src:(null===n||void 0===n?void 0:n.avatar_url)||"https://github.com/".concat(d||(null===n||void 0===n?void 0:n.login),".png"),alt:"Profile",className:"context-avatar"}),(0,l.jsxs)("div",{className:"context-details",children:[(0,l.jsx)("span",{className:"context-repo",children:h||(null===s||void 0===s?void 0:s.name)}),(0,l.jsx)("span",{className:"context-component",children:"Core Data Dictionary"})]})]})]}),(0,l.jsxs)("div",{className:"viewer-content",children:[(0,l.jsxs)("div",{className:"breadcrumb",children:[(0,l.jsx)("button",{onClick:()=>e("/"),className:"breadcrumb-link",children:"Select Profile"}),(0,l.jsx)("span",{className:"breadcrumb-separator",children:"\u203a"}),(0,l.jsx)("button",{onClick:()=>e("/dak-selection/".concat(n.login),{state:{profile:n}}),className:"breadcrumb-link",children:"Select Repository"}),(0,l.jsx)("span",{className:"breadcrumb-separator",children:"\u203a"}),(0,l.jsx)("button",{onClick:()=>{if(d&&h){const n=r?"/dashboard/".concat(d,"/").concat(h,"/").concat(r):"/dashboard/".concat(d,"/").concat(h);e(n)}else e("/dashboard",{state:{profile:n,repository:s,branch:r}})},className:"breadcrumb-link",children:"DAK Components"}),(0,l.jsx)("span",{className:"breadcrumb-separator",children:"\u203a"}),(0,l.jsx)("span",{className:"breadcrumb-current",children:"Core Data Dictionary"})]}),(0,l.jsxs)("div",{className:"viewer-main",children:[(0,l.jsxs)("div",{className:"component-intro",children:[(0,l.jsx)("div",{className:"component-icon",style:{color:"#0078d4"},children:"\ud83d\udcca"}),(0,l.jsxs)("div",{className:"intro-content",children:[(0,l.jsx)("h2",{children:"Core Data Dictionary Viewer"}),(0,l.jsx)("p",{children:"View canonical representations of Component 2 Core Data Dictionary including FHIR CodeSystems, ValueSets, and ConceptMaps stored in FSH format."}),r&&(0,l.jsxs)("div",{className:"branch-info",children:[(0,l.jsx)("strong",{children:"Branch:"})," ",(0,l.jsx)("code",{children:r})]})]})]}),f&&(0,l.jsxs)("div",{className:"error-message",children:[(0,l.jsx)("h3",{children:"\u26a0\ufe0f Error"}),(0,l.jsx)("p",{children:f})]}),(0,l.jsx)("div",{className:"documentation-section",children:(0,l.jsx)("p",{children:(0,l.jsx)("a",{href:"https://smart.who.int/ig-starter-kit/v1.0.0/",target:"_blank",rel:"noopener noreferrer",className:"documentation-link",children:"\ud83d\udcda WHO IG Starter Kit Documentation \u2197"})})}),(0,l.jsxs)("div",{className:"two-column-layout",children:[(0,l.jsxs)("div",{className:"section standard-dictionaries-section left-column",children:[(0,l.jsx)("h3",{children:"Standard Dictionaries"}),(0,l.jsxs)("div",{className:"subsection",children:[(0,l.jsx)("h4",{children:"Code Systems"}),F&&(0,l.jsxs)("div",{className:"dak-source-section",children:[(0,l.jsx)("h5",{children:"DAK Source File (FSH)"}),(0,l.jsxs)("div",{className:"dak-source-links",children:[(0,l.jsx)("button",{className:"action-btn primary",onClick:()=>W(F),title:"View DAK.fsh source code with syntax highlighting",children:"\ud83d\udcc4 View Source"}),(0,l.jsx)("a",{href:F.html_url,target:"_blank",rel:"noopener noreferrer",className:"action-btn secondary",title:"View DAK.fsh source on GitHub",children:"\ud83d\udd17 GitHub Source \u2197"})]})]}),k?(0,l.jsxs)("div",{className:"dak-published-section",children:[(0,l.jsx)("h5",{children:"Published CodeSystem"}),M?(0,l.jsx)("p",{className:"checking-published",children:"Checking published version..."}):T?(0,l.jsx)("div",{className:"dictionary-links",children:(0,l.jsx)("a",{href:"".concat(Q(r),"/CodeSystem-DAK.html"),target:"_blank",rel:"noopener noreferrer",className:"dictionary-link primary",children:"\ud83d\udcca View Published Core Data Dictionary (DAK) \u2197"})}):(0,l.jsxs)("div",{className:"unpublished-dak",children:[(0,l.jsx)("span",{className:"disabled-link",children:"Core Data Dictionary (DAK)"}),(0,l.jsx)("p",{className:"unpublished-note",children:"\u26a0\ufe0f The published version is not yet available. The CodeSystem-DAK.html file has not been published to GitHub Pages."})]})]}):(0,l.jsx)("p",{className:"no-publication-note",children:"Published CodeSystems will be available once GitHub Pages is configured."})]}),A.length>0&&(0,l.jsxs)("div",{className:"subsection",children:[(0,l.jsxs)("h4",{children:["DAK Concepts (",A.length," total)"]}),(0,l.jsx)("div",{className:"dak-table-controls",children:(0,l.jsx)("input",{type:"text",placeholder:"Search concepts...",value:I,onChange:e=>L(e.target.value),className:"search-input"})}),(0,l.jsx)("div",{className:"dak-concepts-table",children:(0,l.jsxs)("table",{children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{children:"Code"}),(0,l.jsx)("th",{children:"Display"}),(0,l.jsx)("th",{children:"Definition"})]})}),(0,l.jsx)("tbody",{children:A.filter(e=>!I||e.code.toLowerCase().includes(I.toLowerCase())||e.display.toLowerCase().includes(I.toLowerCase())||e.definition.toLowerCase().includes(I.toLowerCase())).map((e,n)=>(0,l.jsxs)("tr",{children:[(0,l.jsx)("td",{className:"concept-code",children:e.code}),(0,l.jsx)("td",{className:"concept-display",children:e.display}),(0,l.jsx)("td",{className:"concept-definition",children:e.definition})]},n))})]})})]}),(0,l.jsxs)("div",{className:"subsection",children:[(0,l.jsx)("h4",{children:"Value Sets"}),(0,l.jsxs)("div",{className:"placeholder-links",children:[(0,l.jsx)("span",{className:"placeholder-link",children:"Actors (Coming Soon)"}),(0,l.jsx)("span",{className:"placeholder-link",children:"Workflows (Coming Soon)"}),(0,l.jsx)("span",{className:"placeholder-link",children:"Decision Tables (Coming Soon)"})]})]})]}),k?(0,l.jsxs)("div",{className:"section publications-section right-column",children:[(0,l.jsx)("h3",{children:"Publications"}),(0,l.jsx)("p",{children:"Published FHIR Implementation Guide artifacts generated by the IG Publisher"}),C.sort().map(t=>(0,l.jsxs)("div",{className:"branch-publication",children:[(0,l.jsxs)("h4",{children:["Branch: ",(0,l.jsx)("code",{children:t})]}),(0,l.jsxs)("div",{className:"artifact-links",children:[(0,l.jsx)("a",{href:"".concat(Q(t),"/artifacts.html#terminology-code-systems"),target:"_blank",rel:"noopener noreferrer",className:"artifact-link",children:"Code Systems \u2197"}),(0,l.jsx)("a",{href:"".concat(Q(t),"/artifacts.html#terminology-value-sets"),target:"_blank",rel:"noopener noreferrer",className:"artifact-link",children:"Value Sets \u2197"}),(0,l.jsx)("a",{href:"".concat(Q(t),"/artifacts.html#structures-logical-models"),target:"_blank",rel:"noopener noreferrer",className:"artifact-link",children:"Logical Models \u2197"}),P.length>0&&(0,l.jsx)("div",{className:"logical-models-actions",children:K?(0,l.jsx)("span",{className:"loading-indicator",children:"Detecting models..."}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("span",{className:"models-count",children:["(",P.length," detected)"]}),(0,l.jsx)("div",{className:"models-dropdown",children:(0,l.jsxs)("select",{onChange:t=>{const i=P.find(e=>e.id===t.target.value);i&&(async t=>{try{const i=c.generateQuestionnaireFromLogicalModel(t,{questionnaireId:"questionnaire-".concat(t.id.toLowerCase()),title:"Data Collection for ".concat(t.title||t.name),description:"Questionnaire based on ".concat(t.title||t.name," logical model for data collection"),prefix:"lm"}),a=r?"/questionnaire-editor/".concat(d,"/").concat(h,"/").concat(r):"/questionnaire-editor/".concat(d,"/").concat(h);e(a,{state:{profile:n,repository:s,branch:r,prePopulatedQuestionnaire:i,sourceLogicalModel:t}})}catch(f){console.error("Error generating questionnaire from logical model:",f),alert("Error generating questionnaire from logical model. Please try again.")}})(i)},defaultValue:"",className:"model-selector",children:[(0,l.jsx)("option",{value:"",disabled:!0,children:"Draft Questionnaire from..."}),P.map(e=>(0,l.jsx)("option",{value:e.id,children:e.title||e.name},e.id))]})})]})}),(0,l.jsx)("a",{href:"".concat(Q(t),"/artifacts.html#terminology-concept-maps"),target:"_blank",rel:"noopener noreferrer",className:"artifact-link",children:"Concept Maps \u2197"})]})]},t))]}):(0,l.jsxs)("div",{className:"section no-publications-section right-column",children:[(0,l.jsx)("h3",{children:"Publications"}),(0,l.jsxs)("div",{className:"no-gh-pages-message",children:[(0,l.jsx)("p",{children:"\ud83d\udccb No published artifacts available"}),(0,l.jsxs)("p",{children:["This repository does not have a ",(0,l.jsx)("code",{children:"gh-pages"})," branch for publishing FHIR Implementation Guide artifacts."]})]})]})]}),(0,l.jsxs)("div",{className:"section fsh-files-section",children:[(0,l.jsx)("h3",{children:"FHIR FSH Source Files"}),(0,l.jsx)("p",{children:"FHIR Shorthand (FSH) files containing CodeSystems, ValueSets, and ConceptMaps"}),0===m.length?(0,l.jsxs)("div",{className:"no-files-message",children:[(0,l.jsxs)("p",{children:["No FHIR FSH files found in ",(0,l.jsx)("code",{children:"input/fsh/"})," directory."]}),(0,l.jsx)("p",{children:"Core Data Dictionary files should be stored in FSH format in this location."})]}):(0,l.jsx)("div",{className:"fsh-files-grid",children:m.map(e=>(0,l.jsxs)("div",{className:"fsh-file-card",children:[(0,l.jsxs)("div",{className:"file-header",children:[(0,l.jsx)("div",{className:"file-icon",children:"\ud83d\udcc4"}),(0,l.jsx)("div",{className:"file-name",children:e.name})]}),(0,l.jsxs)("div",{className:"file-actions",children:[(0,l.jsx)("button",{className:"action-btn primary",onClick:()=>W(e),title:"View source code with syntax highlighting",children:"View Source"}),(0,l.jsx)("a",{href:e.html_url,target:"_blank",rel:"noopener noreferrer",className:"action-btn secondary",title:"View source on GitHub",children:"GitHub \u2197"})]})]},e.path))})]})]})]}),N&&j&&(0,l.jsx)("div",{className:"modal-overlay",onClick:B,children:(0,l.jsxs)("div",{className:"modal-content",onClick:e=>e.stopPropagation(),children:[(0,l.jsxs)("div",{className:"modal-header",children:[(0,l.jsx)("h3",{children:j.name}),(0,l.jsx)("button",{className:"modal-close",onClick:B,children:"\xd7"})]}),(0,l.jsx)("div",{className:"modal-body",children:(0,l.jsx)("pre",{className:"fsh-code",children:(0,l.jsx)("code",{children:b})})}),(0,l.jsxs)("div",{className:"modal-footer",children:[(0,l.jsx)("a",{href:j.html_url,target:"_blank",rel:"noopener noreferrer",className:"btn-secondary",children:"View on GitHub \u2197"}),(0,l.jsx)("button",{className:"btn-primary",onClick:B,children:"Close"})]})]})})]}):(e("/"),(0,l.jsx)("div",{children:"Redirecting..."}))},d=()=>(0,l.jsx)(o.Mx,{pageName:"core-data-dictionary-viewer",children:(0,l.jsx)(r,{})})}}]);