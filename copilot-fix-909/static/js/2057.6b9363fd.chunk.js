"use strict";(self.webpackChunksgex_workbench=self.webpackChunksgex_workbench||[]).push([[2057],{12057:(e,i,s)=>{s.r(i),s.d(i,{default:()=>m});var n=s(89379),t=s(9950),a=s(90584),r=s(29166),l=s(29946),o=s(57561),d=s(85001),c=s(44414);const u=e=>{var i,s;let{questionnaire:a,onChange:r}=e;const[l,o]=(0,t.useState)(!1),[d]=(0,t.useState)(!1),[u]=(0,t.useState)(null),h=(e,i,s)=>{if(!a.item)return;const t=[...a.item];t[e]=(0,n.A)((0,n.A)({},t[e]),{},{[i]:s});const l=(0,n.A)((0,n.A)({},a),{},{item:t});r(l)},p=(e,i)=>{const s=(0,n.A)((0,n.A)({},a),{},{[e]:i});r(s)},m=function(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e&&0!==e.length?e.map((e,s)=>{const n="".concat(s+1),t=i>0?"".concat("  ".repeat(i)):"";return"group"===e.type?(0,c.jsxs)("div",{className:"preview-group level-".concat(i),children:[(0,c.jsx)("div",{className:"group-header",children:(0,c.jsxs)("h4",{className:"group-title",children:[t,n,". ",e.text,e.required&&(0,c.jsx)("span",{className:"required-asterisk",children:" *"}),e.repeats&&(0,c.jsx)("span",{className:"repeats-indicator",children:" (repeatable)"})]})}),(0,c.jsx)("div",{className:"group-content",children:m(e.item||[],i+1)})]},e.linkId):(0,c.jsxs)("div",{className:"preview-question level-".concat(i),children:[(0,c.jsxs)("label",{className:"preview-question-label",children:[t,n,". ",e.text,e.required&&(0,c.jsx)("span",{className:"required-asterisk",children:" *"}),e.repeats&&(0,c.jsx)("span",{className:"repeats-indicator",children:" (repeatable)"})]}),"string"===e.type&&(0,c.jsx)("input",{type:"text",placeholder:"Text answer",disabled:!0}),"text"===e.type&&(0,c.jsx)("textarea",{placeholder:"Long text answer",disabled:!0,rows:3}),"boolean"===e.type&&(0,c.jsxs)("div",{className:"preview-boolean",children:[(0,c.jsxs)("label",{children:[(0,c.jsx)("input",{type:"radio",disabled:!0})," Yes"]}),(0,c.jsxs)("label",{children:[(0,c.jsx)("input",{type:"radio",disabled:!0})," No"]})]}),"decimal"===e.type&&(0,c.jsx)("input",{type:"number",step:"0.01",placeholder:"Number",disabled:!0}),"integer"===e.type&&(0,c.jsx)("input",{type:"number",step:"1",placeholder:"Integer",disabled:!0}),"date"===e.type&&(0,c.jsx)("input",{type:"date",disabled:!0}),"dateTime"===e.type&&(0,c.jsx)("input",{type:"datetime-local",disabled:!0}),"time"===e.type&&(0,c.jsx)("input",{type:"time",disabled:!0}),"choice"===e.type&&(0,c.jsxs)("select",{disabled:!0,children:[(0,c.jsx)("option",{children:"Select an option..."}),null===(a=e.answerOption)||void 0===a?void 0:a.map((e,i)=>{var s,n;return(0,c.jsx)("option",{value:(null===(s=e.valueCoding)||void 0===s?void 0:s.code)||e.valueString,children:(null===(n=e.valueCoding)||void 0===n?void 0:n.display)||e.valueString||"Option ".concat(i+1)},i)})]}),"open-choice"===e.type&&(0,c.jsxs)("div",{className:"open-choice-container",children:[(0,c.jsxs)("select",{disabled:!0,children:[(0,c.jsx)("option",{children:"Select an option or enter custom..."}),null===(r=e.answerOption)||void 0===r?void 0:r.map((e,i)=>{var s,n;return(0,c.jsx)("option",{value:(null===(s=e.valueCoding)||void 0===s?void 0:s.code)||e.valueString,children:(null===(n=e.valueCoding)||void 0===n?void 0:n.display)||e.valueString||"Option ".concat(i+1)},i)})]}),(0,c.jsx)("input",{type:"text",placeholder:"Or enter custom value",disabled:!0})]}),"quantity"===e.type&&(0,c.jsxs)("div",{className:"quantity-container",children:[(0,c.jsx)("input",{type:"number",step:"0.01",placeholder:"Value",disabled:!0}),(0,c.jsx)("input",{type:"text",placeholder:"Unit",disabled:!0})]}),"url"===e.type&&(0,c.jsx)("input",{type:"url",placeholder:"https://example.com",disabled:!0})]},e.linkId);var a,r}):(0,c.jsx)("p",{className:"no-questions-preview",children:"No questions added yet."})};return(0,c.jsxs)("div",{className:"lforms-visual-editor",children:[(0,c.jsxs)("div",{className:"editor-modes",children:[(0,c.jsx)("button",{className:"mode-toggle ".concat(l?"":"active"),onClick:()=>o(!1),children:"\ud83d\udd27 Build Mode"}),(0,c.jsx)("button",{className:"mode-toggle ".concat(l?"active":""),onClick:()=>o(!0),children:"\ud83d\udc41\ufe0f Preview Mode"})]}),l?(0,c.jsxs)("div",{className:"lforms-preview",children:[(0,c.jsx)("h5",{children:"Enhanced Hierarchical Preview"}),(0,c.jsxs)("div",{className:"enhanced-questionnaire-preview",children:[(0,c.jsxs)("div",{className:"preview-header",children:[(0,c.jsx)("h3",{children:a.title||"Untitled Questionnaire"}),(0,c.jsx)("p",{children:a.description||"No description provided"})]}),(0,c.jsx)("div",{className:"preview-questions",children:m(a.item||[])})]})]}):(0,c.jsxs)("div",{className:"lforms-builder",children:[(0,c.jsxs)("div",{className:"questionnaire-metadata-editor",children:[(0,c.jsx)("h5",{children:"Questionnaire Details"}),(0,c.jsxs)("div",{className:"metadata-grid",children:[(0,c.jsxs)("div",{className:"field-group",children:[(0,c.jsx)("label",{htmlFor:"questionnaire-title",children:"Title:"}),(0,c.jsx)("input",{id:"questionnaire-title",type:"text",value:a.title||"",onChange:e=>p("title",e.target.value),placeholder:"Enter questionnaire title"})]}),(0,c.jsxs)("div",{className:"field-group",children:[(0,c.jsx)("label",{htmlFor:"questionnaire-name",children:"Name:"}),(0,c.jsx)("input",{id:"questionnaire-name",type:"text",value:a.name||"",onChange:e=>p("name",e.target.value),placeholder:"Enter questionnaire name"})]}),(0,c.jsxs)("div",{className:"field-group",children:[(0,c.jsx)("label",{htmlFor:"questionnaire-status",children:"Status:"}),(0,c.jsxs)("select",{id:"questionnaire-status",value:a.status||"draft",onChange:e=>p("status",e.target.value),children:[(0,c.jsx)("option",{value:"draft",children:"Draft"}),(0,c.jsx)("option",{value:"active",children:"Active"}),(0,c.jsx)("option",{value:"retired",children:"Retired"})]})]}),(0,c.jsxs)("div",{className:"field-group",children:[(0,c.jsx)("label",{htmlFor:"questionnaire-publisher",children:"Publisher:"}),(0,c.jsx)("input",{id:"questionnaire-publisher",type:"text",value:a.publisher||"",onChange:e=>p("publisher",e.target.value),placeholder:"Enter publisher"})]})]}),(0,c.jsxs)("div",{className:"field-group",children:[(0,c.jsx)("label",{htmlFor:"questionnaire-description",children:"Description:"}),(0,c.jsx)("textarea",{id:"questionnaire-description",value:a.description||"",onChange:e=>p("description",e.target.value),placeholder:"Enter questionnaire description",rows:3})]})]}),(0,c.jsxs)("div",{className:"questions-builder",children:[(0,c.jsxs)("div",{className:"questions-header",children:[(0,c.jsxs)("h5",{children:["Questions (",(null===(i=a.item)||void 0===i?void 0:i.length)||0,")"]}),(0,c.jsx)("button",{onClick:()=>{var e;const i={linkId:"item-".concat(Date.now()),text:"New Question ".concat(((null===(e=a.item)||void 0===e?void 0:e.length)||0)+1),type:"string",required:!1},s=(0,n.A)((0,n.A)({},a),{},{item:[...a.item||[],i]});r(s)},className:"add-question-btn",children:"+ Add Question"})]}),null===(s=a.item)||void 0===s?void 0:s.map((e,i)=>(0,c.jsxs)("div",{className:"question-editor",children:[(0,c.jsxs)("div",{className:"question-header",children:[(0,c.jsxs)("span",{className:"question-number",children:["Q",i+1]}),(0,c.jsx)("button",{onClick:()=>(e=>{if(!a.item)return;const i=a.item.filter((i,s)=>s!==e),s=(0,n.A)((0,n.A)({},a),{},{item:i});r(s)})(i),className:"remove-question-btn",title:"Remove question",children:"\u2715"})]}),(0,c.jsxs)("div",{className:"question-fields",children:[(0,c.jsxs)("div",{className:"field-group",children:[(0,c.jsx)("label",{htmlFor:"question-text-".concat(i),children:"Question Text:"}),(0,c.jsx)("input",{id:"question-text-".concat(i),type:"text",value:e.text||"",onChange:e=>h(i,"text",e.target.value),placeholder:"Enter question text"})]}),(0,c.jsxs)("div",{className:"field-group",children:[(0,c.jsx)("label",{htmlFor:"question-linkid-".concat(i),children:"Link ID:"}),(0,c.jsx)("input",{id:"question-linkid-".concat(i),type:"text",value:e.linkId||"",onChange:e=>h(i,"linkId",e.target.value),placeholder:"Enter unique ID"})]}),(0,c.jsxs)("div",{className:"field-group",children:[(0,c.jsx)("label",{htmlFor:"question-type-".concat(i),children:"Question Type:"}),(0,c.jsxs)("select",{id:"question-type-".concat(i),value:e.type||"string",onChange:e=>h(i,"type",e.target.value),children:[(0,c.jsx)("option",{value:"string",children:"Short Text"}),(0,c.jsx)("option",{value:"text",children:"Long Text"}),(0,c.jsx)("option",{value:"boolean",children:"Yes/No"}),(0,c.jsx)("option",{value:"decimal",children:"Decimal Number"}),(0,c.jsx)("option",{value:"integer",children:"Integer"}),(0,c.jsx)("option",{value:"date",children:"Date"}),(0,c.jsx)("option",{value:"choice",children:"Single Choice"}),(0,c.jsx)("option",{value:"open-choice",children:"Choice with Other"})]})]}),(0,c.jsx)("div",{className:"field-group checkbox-group",children:(0,c.jsxs)("label",{children:[(0,c.jsx)("input",{type:"checkbox",checked:e.required||!1,onChange:e=>h(i,"required",e.target.checked)}),"Required"]})})]})]},e.linkId)),(!a.item||0===a.item.length)&&(0,c.jsx)("div",{className:"no-questions",children:(0,c.jsx)("p",{children:'No questions yet. Click "Add Question" to get started.'})})]})]})]})},h=()=>{var e;const{repository:i,branch:s,isLoading:h}=(0,a.oc)(),p=(0,d.zy)(),[m,x]=(0,t.useState)([]),[j,v]=(0,t.useState)(null),[g,N]=(0,t.useState)(!0),[y,f]=(0,t.useState)(null),[q,b]=(0,t.useState)(!1),[S,w]=(0,t.useState)(null),[F,C]=(0,t.useState)(null),[k,Q]=(0,t.useState)(!1),[E,T]=(0,t.useState)("visual"),[I,A]=(0,t.useState)(null),[O,H]=(0,t.useState)(!1),[L,R]=(0,t.useState)(""),[D,J]=(0,t.useState)(null),P=i&&s&&!h;if((0,t.useEffect)(()=>{var e;if(null!==(e=p.state)&&void 0!==e&&e.prePopulatedQuestionnaire){const{prePopulatedQuestionnaire:e,sourceLogicalModel:i}=p.state;console.log("Loading pre-populated questionnaire from logical model:",null===i||void 0===i?void 0:i.name),w(e),C(JSON.stringify(e,null,2)),v({name:"".concat(e.id,".json"),displayName:e.name,fullPath:"input/questionnaires/".concat(e.id,".json"),fileType:"JSON",isNew:!0,generatedFromLogicalModel:i}),b(!0),T("visual")}},[p.state]),(0,t.useEffect)(()=>{(async()=>{try{A(null),console.log("Using built-in visual editor"),Q(!0)}catch(y){console.error("Failed to load LForms:",y),A("Failed to load questionnaire editor: ".concat(y.message)),console.log("Using built-in visual editor as fallback"),Q(!0)}})()},[]),(0,t.useEffect)(()=>{(async()=>{if(P)try{console.log("QuestionnaireEditor: Loading questionnaires for",i.name,"branch",s),N(!0),f(null);const e=[],t=[{path:"input/questionnaires",extensions:[".json"],type:"JSON"},{path:"input/fsh/questionnaires",extensions:[".fsh"],type:"FSH"}];for(const a of t)try{const t=(await l.A.getDirectoryContents(i.owner.login,i.name,a.path,s)).filter(e=>"file"===e.type&&a.extensions.some(i=>e.name.endsWith(i))).map(e=>{const i=a.extensions.find(i=>e.name.endsWith(i));return(0,n.A)((0,n.A)({},e),{},{displayName:e.name.replace(i,""),fullPath:"".concat(a.path,"/").concat(e.name),fileType:a.type,extension:i})});e.push(...t)}catch(y){404!==y.status&&console.warn("Error loading from ".concat(a.path,":"),y)}x(e)}catch(y){console.error("Error loading questionnaires:",y),f("Failed to load questionnaires: ".concat(y.message))}finally{N(!1)}else console.log("QuestionnaireEditor: Waiting for PageProvider context...",{repository:!!i,branch:!!s,pageLoading:h})})()},[P,i,s,h]),!i||!s)return(0,c.jsxs)("div",{className:"questionnaire-editor-loading",children:[(0,c.jsx)("div",{className:"loading-spinner"}),(0,c.jsx)("p",{children:"Initializing Questionnaire Editor..."})]});const M=e=>{const i=[/\*\s*title\s*=\s*"([^"]+)"/,/^\s*Title:\s*"?([^"\n]+)"?/m,/Instance:\s*\w+\s*"([^"]+)"/];for(const s of i){const i=e.match(s);if(i)return i[1].trim()}return null},z=e=>{const i=[/\*\s*status\s*=\s*#(\w+)/,/^\s*Status:\s*#?(\w+)/m];for(const s of i){const i=e.match(s);if(i)return i[1]}return null},U=e=>{const i=[/\*\s*name\s*=\s*"([^"]+)"/,/^\s*Name:\s*"?([^"\n]+)"?/m,/Instance:\s*(\w+)/];for(const s of i){const i=e.match(s);if(i)return i[1].trim()}return null},W=e=>{const i=[/\*\s*description\s*=\s*"([^"]+)"/,/^\s*Description:\s*"?([^"\n]+)"?/m,/\/\/\s*(.+)/];for(const s of i){const i=e.match(s);if(i)return i[1].trim()}return null},B=()=>{const e={resourceType:"Questionnaire",id:"questionnaire-".concat(Date.now()),meta:{versionId:"1",lastUpdated:(new Date).toISOString()},url:"http://example.org/Questionnaire/".concat(Date.now()),name:"NewQuestionnaire",title:"New Questionnaire",status:"draft",date:(new Date).toISOString().split("T")[0],publisher:"WHO SMART Guidelines",description:"A new FHIR Questionnaire",item:[{linkId:"1",text:"Sample Question",type:"string",required:!1}]};w(e),C(JSON.stringify(e,null,2)),v({name:"".concat(e.name,".json"),displayName:e.name,fullPath:"input/questionnaires/".concat(e.name,".json"),fileType:"JSON",isNew:!0}),b(!0),T("visual"),console.log("New questionnaire created:",e)},V=S&&F&&JSON.stringify(S,null,2)!==F,Y=()=>{H(!1),R(""),J(null)},_=async()=>{if(j&&L.trim())try{J(null);const e="FSH"===j.fileType?".fsh":".json",i="FSH"===j.fileType?"input/fsh/questionnaires":"input/questionnaires",s="".concat(L.trim()).concat(e),t="".concat(i,"/").concat(s),a=j.fullPath;if(!j.isNew)return void J("Renaming existing questionnaires is not yet supported");{await o.A.renameFile(a,t);const e=(0,n.A)((0,n.A)({},j),{},{name:s,displayName:L.trim(),fullPath:t});if(v(e),S&&"Questionnaire"===S.resourceType){const e=(0,n.A)((0,n.A)({},S),{},{name:L.trim().replace(/[^a-zA-Z0-9]/g,"_"),title:L.trim()});w(e)}console.log("Questionnaire renamed from ".concat(j.displayName," to ").concat(L.trim()))}H(!1),R("")}catch(y){console.error("Error renaming questionnaire:",y),J("Failed to rename questionnaire: ".concat(y.message))}else J("Please enter a valid name")};return P?g&&!q?(0,c.jsx)(a.ox,{pageName:"questionnaire-editor",repository:i,branch:s,children:(0,c.jsxs)("div",{className:"questionnaire-editor-loading",children:[(0,c.jsx)("h2",{children:"Loading Questionnaires..."}),(0,c.jsx)("p",{children:"Fetching questionnaire files from repository..."})]})}):(0,c.jsx)(a.ox,{pageName:"questionnaire-editor",file:j,repository:i,branch:s,content:S?JSON.stringify(S,null,2):null,originalContent:F,hasChanges:V,onSave:(e,t)=>{if(console.log("Questionnaire saved to ".concat(t)),"github"===t){const e=async()=>{try{const e=[],t=[{path:"input/questionnaires",extensions:[".json"],type:"JSON"},{path:"input/fsh/questionnaires",extensions:[".fsh"],type:"FSH"}];for(const a of t)try{const t=(await l.A.getDirectoryContents(i.owner.login,i.name,a.path,s)).filter(e=>"file"===e.type&&a.extensions.some(i=>e.name.endsWith(i))).map(e=>{const i=a.extensions.find(i=>e.name.endsWith(i));return(0,n.A)((0,n.A)({},e),{},{displayName:e.name.replace(i,""),fullPath:"".concat(a.path,"/").concat(e.name),fileType:a.type,extension:i})});e.push(...t)}catch(y){404!==y.status&&console.warn("Error loading from ".concat(a.path,":"),y)}x(e)}catch(y){console.error("Error refreshing questionnaires:",y)}};e()}},showSaveButtons:q,children:(0,c.jsxs)("div",{className:"questionnaire-editor",children:[(0,c.jsxs)("div",{className:"questionnaire-content",children:[y&&(0,c.jsxs)("div",{className:"error-message",children:[(0,c.jsx)("strong",{children:"Error:"})," ",y]}),q?(0,c.jsxs)("div",{className:"questionnaire-editor-container",children:[(0,c.jsxs)("div",{className:"editor-header",children:[(0,c.jsx)("button",{onClick:()=>b(!1),className:"back-to-list",children:"\u2190 Back to List"}),(0,c.jsx)("div",{className:"questionnaire-header-title",children:O?(0,c.jsxs)("div",{className:"rename-section",children:[(0,c.jsx)("input",{type:"text",value:L,onChange:e=>R(e.target.value),className:"rename-input",placeholder:"Enter new name",autoFocus:!0,onKeyPress:e=>{"Enter"===e.key?_():"Escape"===e.key&&Y()}}),(0,c.jsxs)("div",{className:"rename-actions",children:[(0,c.jsx)("button",{className:"rename-confirm-btn",onClick:_,disabled:!L.trim(),children:"\u2713 Save"}),(0,c.jsx)("button",{className:"rename-cancel-btn",onClick:Y,children:"\u2717 Cancel"})]}),D&&(0,c.jsx)("div",{className:"rename-error",children:D})]}):(0,c.jsxs)("div",{className:"title-with-rename",children:[(0,c.jsx)("h2",{children:(null===j||void 0===j?void 0:j.displayName)||"New Questionnaire"}),(null===j||void 0===j?void 0:j.isNew)&&(0,c.jsx)("button",{className:"rename-btn",onClick:()=>{j&&(H(!0),R(j.displayName),J(null))},title:"Rename questionnaire",children:"\u270f\ufe0f Rename"})]})}),(null===j||void 0===j?void 0:j.generatedFromLogicalModel)&&(0,c.jsx)("div",{className:"generation-notice",children:(0,c.jsxs)("div",{className:"notice-content",children:[(0,c.jsx)("strong",{children:"\u2728 Generated from Logical Model:"})," ",j.generatedFromLogicalModel.title||j.generatedFromLogicalModel.name,(0,c.jsx)("p",{className:"notice-description",children:"This questionnaire was automatically generated from the logical model. You can customize the questions, add validation rules, and modify the structure as needed."})]})}),"FSH"!==(null===S||void 0===S?void 0:S.fileType)&&(0,c.jsxs)("div",{className:"edit-mode-toggle",children:[(0,c.jsx)("button",{className:"mode-btn ".concat("visual"===E?"active":""),onClick:()=>T("visual"),children:"\ud83d\udcdd Visual Editor"}),(0,c.jsx)("button",{className:"mode-btn ".concat("json"===E?"active":""),onClick:()=>T("json"),children:" JSON Editor"})]})]}),I&&(0,c.jsxs)("div",{className:"error-message",children:[(0,c.jsx)("strong",{children:"LForms Error:"})," ",I]}),k?(0,c.jsxs)("div",{className:"lforms-container",children:[(0,c.jsxs)("div",{className:"questionnaire-preview",children:[(0,c.jsx)("h4",{children:"Questionnaire Preview"}),(0,c.jsxs)("div",{className:"questionnaire-metadata",children:[(0,c.jsxs)("p",{children:[(0,c.jsx)("strong",{children:"Title:"})," ",(null===S||void 0===S?void 0:S.title)||"Untitled"]}),(0,c.jsxs)("p",{children:[(0,c.jsx)("strong",{children:"Status:"})," ",(null===S||void 0===S?void 0:S.status)||"draft"]}),(0,c.jsxs)("p",{children:[(0,c.jsx)("strong",{children:"Format:"})," ",(null===S||void 0===S?void 0:S.fileType)||"JSON"]}),(0,c.jsxs)("p",{children:[(0,c.jsx)("strong",{children:"Date:"})," ",(null===S||void 0===S?void 0:S.date)||"Not specified"]}),"FSH"!==(null===S||void 0===S?void 0:S.fileType)&&(0,c.jsxs)("p",{children:[(0,c.jsx)("strong",{children:"Items:"})," ",(null===S||void 0===S||null===(e=S.item)||void 0===e?void 0:e.length)||0," questions"]})]})]}),"FSH"===(null===S||void 0===S?void 0:S.fileType)?(0,c.jsxs)("div",{className:"questionnaire-content-editor",children:[(0,c.jsxs)("h4",{children:["FHIR Shorthand Content",(0,c.jsx)("span",{className:"readonly-badge",children:" (Read-Only)"})]}),(0,c.jsxs)("div",{className:"fsh-editor",children:[(0,c.jsx)("textarea",{value:(null===S||void 0===S?void 0:S.rawContent)||"",readOnly:!0,className:"fsh-content",rows:20}),(0,c.jsxs)("div",{className:"fsh-notice",children:[(0,c.jsx)("strong",{children:"\ud83d\udcdd FSH File:"})," This is a FHIR Shorthand questionnaire. Direct editing is not supported yet - please edit the .fsh file directly in your repository."]})]})]}):"visual"===E?(0,c.jsxs)("div",{className:"visual-editor-section",children:[(0,c.jsx)("h4",{children:"Visual Questionnaire Builder"}),(0,c.jsx)("div",{className:"lforms-visual-editor",children:(0,c.jsx)(u,{questionnaire:S,onChange:e=>{w(e)},onError:A})})]}):(0,c.jsxs)("div",{className:"questionnaire-content-editor",children:[(0,c.jsx)("h4",{children:"Raw JSON Content"}),(0,c.jsx)("textarea",{value:JSON.stringify(S,null,2),onChange:e=>{try{const i=JSON.parse(e.target.value);w(i)}catch(y){console.warn("Invalid JSON in editor")}},className:"json-editor",rows:20})]}),(0,c.jsxs)("div",{className:"editor-instructions",children:[(0,c.jsx)("h4",{children:"Editing Instructions:"}),"FSH"===(null===S||void 0===S?void 0:S.fileType)?(0,c.jsxs)("ul",{children:[(0,c.jsx)("li",{children:"This is a FHIR Shorthand (.fsh) questionnaire file"}),(0,c.jsx)("li",{children:"FSH files define questionnaires using a domain-specific language"}),(0,c.jsx)("li",{children:"To edit this questionnaire, modify the .fsh file directly in your repository"}),(0,c.jsx)("li",{children:"FSH files are compiled into JSON during the build process"}),(0,c.jsxs)("li",{children:["Learn more about FHIR Shorthand at ",(0,c.jsx)("a",{href:"https://build.fhir.org/ig/HL7/fhir-shorthand/",target:"_blank",rel:"noopener noreferrer",children:"HL7 FHIR Shorthand"})]})]}):"visual"===E?(0,c.jsxs)("ul",{children:[(0,c.jsx)("li",{children:"Use the visual editor above to build your questionnaire interactively"}),(0,c.jsx)("li",{children:"Add, remove, and modify questions using the form builder interface"}),(0,c.jsx)("li",{children:"Preview your questionnaire as users will see it"}),(0,c.jsx)("li",{children:"Switch to JSON mode to see the raw FHIR Questionnaire structure"}),(0,c.jsx)("li",{children:"Changes are automatically saved as you work"})]}):(0,c.jsxs)("ul",{children:[(0,c.jsx)("li",{children:"Edit the JSON structure above to modify the questionnaire"}),(0,c.jsx)("li",{children:"The preview shows key questionnaire metadata"}),(0,c.jsx)("li",{children:"Changes are automatically detected for saving"}),(0,c.jsx)("li",{children:"Switch to Visual mode for an easier editing experience"}),(0,c.jsx)("li",{children:'Click "Save to Staging" to save changes locally'})]}),(0,c.jsxs)("div",{className:"help-tip",children:[(0,c.jsx)("strong",{children:"\u2728 New:"})," Visual questionnaire editor is now available using LHC-Forms!"]})]})]}):(0,c.jsx)("div",{className:"lforms-loading",children:(0,c.jsx)("p",{children:"Loading questionnaire editor..."})})]}):(0,c.jsxs)("div",{className:"questionnaire-list",children:[(0,c.jsxs)("div",{className:"list-header",children:[(0,c.jsxs)("h2",{children:["Questionnaires (",m.length,")"]}),(0,c.jsx)("button",{onClick:B,className:"btn-primary",disabled:!k,children:"+ Create New Questionnaire"})]}),0===m.length?(0,c.jsxs)("div",{className:"empty-state",children:[(0,c.jsx)("div",{className:"empty-icon",children:"\ud83d\udccb"}),(0,c.jsx)("h3",{children:"No Questionnaires Found"}),(0,c.jsx)("p",{children:"This repository doesn't have any FHIR Questionnaire files yet."}),(0,c.jsx)("p",{children:"Questionnaires can be stored as:"}),(0,c.jsxs)("ul",{style:{textAlign:"left",maxWidth:"400px",margin:"0 auto"},children:[(0,c.jsxs)("li",{children:[(0,c.jsx)("code",{children:"input/questionnaires/*.json"})," - FHIR JSON format"]}),(0,c.jsxs)("li",{children:[(0,c.jsx)("code",{children:"input/fsh/questionnaires/*.fsh"})," - FHIR Shorthand format"]})]}),(0,c.jsx)("button",{onClick:B,className:"btn-primary",disabled:!k,children:"Create Your First Questionnaire"})]}):(0,c.jsx)("div",{className:"questionnaire-grid",children:m.map(e=>(0,c.jsxs)("div",{className:"questionnaire-card",onClick:()=>(async e=>{try{N(!0);const n=await l.A.getFileContent(i.owner.login,i.name,e.fullPath,s);let t;"JSON"===e.fileType?t=JSON.parse(n):"FSH"===e.fileType&&(t={resourceType:"Questionnaire",fileType:"FSH",title:M(n)||e.displayName,status:z(n)||"draft",name:U(n)||e.displayName,description:W(n)||"FHIR Shorthand Questionnaire",rawContent:n,isReadOnly:!0}),w(t),C(n),v(e),b(!0),console.log("Questionnaire loaded:",t)}catch(y){console.error("Error loading questionnaire content:",y),f("Failed to load questionnaire: ".concat(y.message))}finally{N(!1)}})(e),children:[(0,c.jsx)("div",{className:"card-icon",children:"FSH"===e.fileType?"\ud83d\udcdd":"\ud83d\udccb"}),(0,c.jsxs)("div",{className:"card-content",children:[(0,c.jsx)("h3",{children:e.displayName}),(0,c.jsxs)("p",{className:"card-type",children:[e.fileType," Questionnaire"]}),(0,c.jsx)("p",{className:"card-path",children:e.fullPath}),(0,c.jsxs)("p",{className:"card-size",children:[(e.size/1024).toFixed(1)," KB"]})]})]},e.name))})]})]}),(0,c.jsx)(r.A,{pageId:"questionnaire-editor",contextData:{repository:i.name,branch:s,hasQuestionnaires:m.length>0,isEditing:q}})]})}):(0,c.jsx)(a.ox,{pageName:"questionnaire-editor",children:(0,c.jsxs)("div",{className:"questionnaire-editor-loading",children:[(0,c.jsx)("h2",{children:"Initializing Questionnaire Editor..."}),(0,c.jsx)("p",{children:"Loading repository context..."})]})})};class p extends t.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e.message}}componentDidCatch(e,i){console.error("QuestionnaireEditor caught an error:",e,i)}render(){return this.state.hasError?(0,c.jsx)(a.ox,{pageName:"questionnaire-editor",children:(0,c.jsxs)("div",{className:"error-state",children:[(0,c.jsx)("h2",{children:"\u26a0\ufe0f Questionnaire Editor Error"}),(0,c.jsx)("p",{children:"An unexpected error occurred while loading the questionnaire editor."}),(0,c.jsxs)("div",{className:"error-details",children:[(0,c.jsx)("strong",{children:"Error:"})," ",this.state.error]}),(0,c.jsx)("button",{onClick:()=>{this.setState({hasError:!1,error:null}),window.location.reload()},className:"btn-primary",children:"Reload Editor"})]})}):this.props.children}}const m=()=>(0,c.jsx)(p,{children:(0,c.jsx)(h,{})})}}]);