"use strict";(self.webpackChunksgex_workbench=self.webpackChunksgex_workbench||[]).push([[106],{9106:(e,s,a)=>{a.r(s),a.d(s,{default:()=>u});var n=a(89379),i=a(65043),t=a(73537),o=a(93071),l=a(65240),r=a(74117),c=a(5452),d=a(70579);const h=e=>{let{onAuthSuccess:s}=e;const{t:n}=(0,r.Bd)(),[t,o]=(0,i.useState)(""),[l,h]=(0,i.useState)(""),[g,u]=(0,i.useState)(!1),m=c.A.getLogger("PATLogin");i.useEffect(()=>(m.componentMount({hasOnAuthSuccess:!!s}),()=>m.componentUnmount()),[m,s]);return(0,d.jsx)("div",{className:"pat-login",children:(0,d.jsxs)("div",{className:"pat-login-section",children:[(0,d.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),m.userAction("PAT login attempt",{tokenProvided:!!t.trim()}),!t.trim()){return h("Please enter a GitHub Personal Access Token"),void m.warn("PAT login failed - no token provided")}u(!0),h("");const n=Date.now();m.auth("Starting PAT authentication");try{const{Octokit:e}=await Promise.resolve().then(a.bind(a,97036)),i=new e({auth:t.trim()});m.debug("Octokit instance created for PAT validation"),m.apiCall("GET","/user",null);const o=await i.rest.users.getAuthenticated(),l=Date.now()-n;m.apiResponse("GET","/user",o.status,l),m.auth("PAT authentication successful",{username:o.data.login,duration:l}),s(t.trim(),i)}catch(i){const e=Date.now()-n;m.apiError("GET","/user",i),m.auth("PAT authentication failed",{status:i.status,message:i.message,duration:e}),console.error("PAT authentication failed:",i),401===i.status?h("Invalid Personal Access Token. Please check your token and try again."):403===i.status?h("Token doesn't have sufficient permissions. Please ensure your token has 'repo' and 'read:org' scopes."):h("Authentication failed. Please check your connection and try again.")}finally{u(!1)}},className:"pat-form",children:[(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsxs)("label",{htmlFor:"pat-token",children:[n("auth.setupToken"),":"]}),(0,d.jsx)("input",{id:"pat-token",type:"password",value:t,onChange:e=>{o(e.target.value),l&&h("")},placeholder:"ghp_xxxxxxxxxxxxxxxxxxxx",className:"token-input ".concat(l?"error":""),disabled:g,autoComplete:"off"})]}),(0,d.jsx)("button",{type:"submit",className:"github-login-btn",disabled:g||!t.trim(),children:g?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("span",{className:"spinner small"}),n("common.loading"),"..."]}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("span",{className:"github-icon",children:"\ud83d\udd11"}),n("auth.signInWithPAT")]})})]}),l&&(0,d.jsx)("div",{className:"error-message",children:l})]})})};var g=a(76712);const u=()=>{const[e,s]=(0,i.useState)(null),[a,r]=(0,i.useState)([]),[c,u]=(0,i.useState)(!1),[m,x]=(0,i.useState)(!1),[p,v]=(0,i.useState)(null),[j,f]=(0,i.useState)({}),[N,b]=(0,i.useState)(null),k=(0,t.Zp)(),A=(0,t.zy)(),w=(0,i.useCallback)((e,s)=>{if(!o.A.isAuth())return;const a={};if(e){const s=l.A.getCachedRepositories(e.login,"user");s&&s.repositories&&(a["user-".concat(e.login)]=s.repositories.length)}s.forEach(e=>{const s=l.A.getCachedRepositories(e.login,"org");s&&s.repositories&&(a["org-".concat(e.login)]=s.repositories.length)}),f(a)},[]),y=(0,i.useCallback)(async()=>{x(!0),v(null);try{await o.A.checkTokenPermissions();const a=await o.A.getCurrentUser();s(a);let i=[];if(o.A.isAuth())try{i=await o.A.getUserOrganizations()}catch(p){console.error("Error fetching organizations:",p),i=[]}try{const e=await o.A.getWHOOrganization(),s=i.findIndex(e=>"WorldHealthOrganization"===e.login);s>=0?i[s]=(0,n.A)((0,n.A)((0,n.A)({},i[s]),e),{},{isWHO:!0}):i.unshift(e)}catch(e){console.warn("Could not fetch WHO organization data, using fallback:",e);const s={id:"who-organization",login:"WorldHealthOrganization",name:"World Health Organization",description:"The World Health Organization is a specialized agency of the United Nations responsible for international public health.",avatar_url:"https://avatars.githubusercontent.com/u/12261302?s=200&v=4",html_url:"https://github.com/WorldHealthOrganization",type:"Organization",isWHO:!0};i.some(e=>"WorldHealthOrganization"===e.login)?i=i.map(e=>"WorldHealthOrganization"===e.login?(0,n.A)((0,n.A)({},e),{},{isWHO:!0}):e):i.unshift(s)}r(i),w(a,i)}catch(p){console.error("Error fetching user data:",p),v("Failed to fetch user data. Please check your connection and try again."),u(!1),sessionStorage.removeItem("github_token"),localStorage.removeItem("github_token")}finally{x(!1)}},[w]);(0,i.useEffect)(()=>{(()=>{const e=sessionStorage.getItem("github_token")||localStorage.getItem("github_token");if(e){o.A.authenticate(e)?u(!0):(sessionStorage.removeItem("github_token"),localStorage.removeItem("github_token"))}})()},[]),(0,i.useEffect)(()=>{var e;null!==(e=A.state)&&void 0!==e&&e.warningMessage&&(b(A.state.warningMessage),k(A.pathname,{replace:!0,state:{}}))},[A.state,k,A.pathname]),(0,i.useEffect)(()=>{c&&!e&&y()},[c,e,y]);const S=(e,s)=>{sessionStorage.setItem("github_token",e),o.A.authenticateWithOctokit(s),u(!0),v(null),y()},O=e=>{k("/dak-action/".concat(e.login),{state:{profile:e}})},W=()=>{const e={login:"demo-user",name:"Demo User",avatar_url:"https://github.com/github.png",type:"User",isDemo:!0};k("/dak-selection/".concat(e.login),{state:{profile:e,action:"edit"}})},H=()=>{b(null)};return c?(0,d.jsx)(g.Mx,{pageName:"landing",showHeader:!1,children:(0,d.jsxs)("div",{className:"landing-page",children:[(0,d.jsxs)("div",{className:"landing-header",children:[(0,d.jsxs)("div",{className:"who-branding",children:[(0,d.jsx)("h1",{className:"clickable-title",children:"SGEX Workbench"}),(0,d.jsx)("p",{className:"subtitle",children:"WHO SMART Guidelines Exchange"})]}),(0,d.jsxs)("div",{className:"user-info",children:[(0,d.jsx)("img",{src:null===e||void 0===e?void 0:e.avatar_url,alt:"User avatar",className:"user-avatar"}),(0,d.jsx)("span",{children:(null===e||void 0===e?void 0:e.name)||(null===e||void 0===e?void 0:e.login)}),(0,d.jsx)("a",{href:"/sgex/docs/overview",className:"nav-link",children:"\ud83d\udcd6 Documentation"}),(0,d.jsx)("button",{onClick:()=>{o.A.logout(),u(!1),s(null),r([]),v(null)},className:"logout-btn",children:"Logout"})]})]}),(0,d.jsxs)("div",{className:"landing-content",children:[N&&(0,d.jsx)("div",{className:"warning-message",children:(0,d.jsxs)("div",{className:"warning-content",children:[(0,d.jsx)("span",{className:"warning-icon",children:"\u26a0\ufe0f"}),(0,d.jsx)("span",{className:"warning-text",children:N}),(0,d.jsx)("button",{className:"warning-dismiss",onClick:H,"aria-label":"Dismiss warning",children:"\xd7"})]})}),m?(0,d.jsxs)("div",{className:"loading-section",children:[(0,d.jsx)("div",{className:"spinner"}),(0,d.jsx)("p",{children:"Loading profile data..."})]}):(0,d.jsxs)("div",{className:"profile-selection",children:[(0,d.jsx)("h2",{children:"Select Profile or Organization"}),(0,d.jsx)("p",{children:"Choose the GitHub profile or organization containing your DAK repositories:"}),p&&(0,d.jsx)("div",{className:"error-message",children:p}),(0,d.jsxs)("div",{className:"profile-grid",children:[(0,d.jsxs)("div",{className:"profile-card",onClick:()=>O((0,n.A)({type:"user"},e)),children:[(0,d.jsxs)("div",{className:"profile-card-header",children:[(0,d.jsx)("img",{src:null===e||void 0===e?void 0:e.avatar_url,alt:"Personal profile"}),j["user-".concat(null===e||void 0===e?void 0:e.login)]>0&&(0,d.jsx)("div",{className:"dak-count-badge",children:j["user-".concat(null===e||void 0===e?void 0:e.login)]})]}),(0,d.jsx)("h3",{children:(null===e||void 0===e?void 0:e.name)||(null===e||void 0===e?void 0:e.login)}),(0,d.jsx)("p",{children:"Personal repositories"}),(0,d.jsx)("div",{className:"profile-badges",children:(0,d.jsx)("span",{className:"profile-type",children:"Personal"})})]}),a.map(e=>(0,d.jsxs)("div",{className:"profile-card ".concat(e.isWHO?"who-org":""),onClick:()=>O((0,n.A)({type:"org"},e)),children:[(0,d.jsxs)("div",{className:"profile-card-header",children:[(0,d.jsx)("img",{src:e.avatar_url||"https://github.com/".concat(e.login,".png"),alt:"".concat(e.name||e.login," organization")}),j["org-".concat(e.login)]>0&&(0,d.jsx)("div",{className:"dak-count-badge",children:j["org-".concat(e.login)]})]}),(0,d.jsx)("h3",{children:e.name||e.login}),(0,d.jsxs)("p",{children:["@",e.login]}),(0,d.jsxs)("div",{className:"profile-badges",children:[(0,d.jsx)("span",{className:"profile-type",children:"Organization"}),e.isWHO&&(0,d.jsx)("span",{className:"who-badge",children:"WHO Official"})]})]},e.login))]})]})]})]})}):(0,d.jsx)(g.Mx,{pageName:"landing",showHeader:!1,children:(0,d.jsxs)("div",{className:"landing-page",children:[(0,d.jsxs)("div",{className:"landing-header",children:[(0,d.jsxs)("div",{className:"who-branding",children:[(0,d.jsx)("h1",{className:"clickable-title",children:"SGEX Workbench"}),(0,d.jsx)("p",{className:"subtitle",children:"WHO SMART Guidelines Exchange"})]}),(0,d.jsx)("div",{className:"header-nav",children:(0,d.jsx)("a",{href:"/sgex/docs/overview",className:"nav-link",children:"\ud83d\udcd6 Documentation"})})]}),(0,d.jsxs)("div",{className:"landing-content",children:[N&&(0,d.jsx)("div",{className:"warning-message",children:(0,d.jsxs)("div",{className:"warning-content",children:[(0,d.jsx)("span",{className:"warning-icon",children:"\u26a0\ufe0f"}),(0,d.jsx)("span",{className:"warning-text",children:N}),(0,d.jsx)("button",{className:"warning-dismiss",onClick:H,"aria-label":"Dismiss warning",children:"\xd7"})]})}),(0,d.jsxs)("div",{className:"welcome-section",children:[(0,d.jsx)("h2",{children:"Welcome to SGEX Workbench"}),(0,d.jsx)("p",{children:"A browser-based, standards-compliant collaborative editor for WHO SMART Guidelines Digital Adaptation Kits (DAKs)."}),(0,d.jsxs)("div",{className:"auth-section",children:[(0,d.jsx)("p",{children:"Connect your GitHub account to get started:"}),(0,d.jsx)(h,{onAuthSuccess:S}),p&&(0,d.jsx)("div",{className:"error-message",children:p})]}),(0,d.jsxs)("div",{className:"demo-section",children:[(0,d.jsx)("p",{children:"Want to try without authentication?"}),(0,d.jsx)("button",{onClick:W,className:"demo-mode-btn",children:"\ud83c\udfad Try Demo Mode"}),(0,d.jsx)("p",{className:"demo-note",children:"Demo mode showcases the enhanced DAK scanning display with mock data."})]}),(0,d.jsx)("div",{className:"info-section",children:(0,d.jsxs)("p",{children:["Need help getting started? Check out our comprehensive"," ",(0,d.jsx)("a",{href:"/sgex/docs/overview",className:"doc-link",children:"documentation"})," ","to learn more about SGEX Workbench and DAK components."]})})]})]})]})})}}}]);
//# sourceMappingURL=106.8ba4d4b1.chunk.js.map