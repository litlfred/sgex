<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>SGEX Workbench</title>
    <script type="text/javascript">
      // Simplified Single Page Apps for GitHub Pages
      // Based on: https://github.com/rafgraph/spa-github-pages
      // This script takes the current url and converts the path and query
      // string into just a query string, and then redirects the browser
      // to the new url with only a query string and hash fragment
      // Note: this 404.html file must be at least 512 bytes for it to work
      // with Internet Explorer (it is currently > 512 bytes)

      (function(l) {
        var pathSegments = l.pathname.split('/').filter(Boolean);
        
        // For GitHub Pages deployment at https://litlfred.github.io/sgex
        var isGitHubPages = l.hostname === 'litlfred.github.io' || l.hostname.endsWith('.github.io');
        
        if (isGitHubPages && pathSegments.length >= 1 && pathSegments[0] === 'sgex') {
          // GitHub Pages deployment scenarios
          
          if (pathSegments.length >= 2) {
            // Check if second segment looks like a branch deployment or a DAK component
            var secondSegment = pathSegments[1];
            
            // Known DAK components (from routes-config.json)
            var dakComponents = [
              'dashboard', 'testing-viewer', 'core-data-dictionary-viewer',
              'health-interventions', 'actor-editor', 'business-process-selection',
              'bpmn-editor', 'bpmn-viewer', 'bpmn-source', 'decision-support-logic',
              'questionnaire-editor'
            ];
            
            // Known standard components
            var standardComponents = [
              'select_profile', 'dak-action', 'dak-selection', 'organization-selection',
              'dak-configuration', 'repositories', 'test-dashboard', 'docs', 'pages',
              'test-framework', 'test-documentation', 'test-asset-editor'
            ];
            
            var allComponents = dakComponents.concat(standardComponents);
            
            if (allComponents.includes(secondSegment)) {
              // This is a direct component access: /sgex/dashboard/user/repo/branch
              // Redirect to: /sgex/?/dashboard/user/repo/branch
              var redirectPath = '/sgex/';
              var routePath = pathSegments.slice(1).join('/'); // Remove 'sgex' prefix
              
              var newUrl = l.protocol + '//' + l.host + redirectPath + 
                '?/' + routePath.replace(/&/g, '~and~') +
                (l.search ? '&' + l.search.slice(1).replace(/&/g, '~and~') : '') +
                l.hash;
              
              console.log('SPA Routing Redirect (DAK Component):', {
                from: l.pathname,
                to: newUrl,
                component: secondSegment
              });
              
              l.replace(newUrl);
              return;
            } else {
              // This might be a branch deployment: /sgex/main/dashboard/user/repo
              // or unknown path - try branch deployment redirect
              var redirectPath = '/' + pathSegments.slice(0, 2).join('/') + '/';
              var routePath = pathSegments.slice(2).join('/');
              
              if (routePath) {
                var newUrl = l.protocol + '//' + l.host + redirectPath + 
                  '?/' + routePath.replace(/&/g, '~and~') +
                  (l.search ? '&' + l.search.slice(1).replace(/&/g, '~and~') : '') +
                  l.hash;
                
                console.log('SPA Routing Redirect (Branch Deployment):', {
                  from: l.pathname,
                  to: newUrl,
                  branch: secondSegment
                });
                
                l.replace(newUrl);
                return;
              }
            }
          }
          
          // If we get here, it's probably just /sgex/ or /sgex/something-unrecognized
          // Redirect to root: /sgex/
          var newUrl = l.protocol + '//' + l.host + '/sgex/';
          console.log('SPA Routing Redirect (Root):', {
            from: l.pathname,
            to: newUrl
          });
          l.replace(newUrl);
          
        } else {
          // Standalone deployment (not GitHub Pages)
          // Default assumption: this is a root deployment
          var routePath = pathSegments.join('/');
          
          if (routePath) {
            var newUrl = l.protocol + '//' + l.host + '/' +
              '?/' + routePath.replace(/&/g, '~and~') +
              (l.search ? '&' + l.search.slice(1).replace(/&/g, '~and~') : '') +
              l.hash;
            
            console.log('SPA Routing Redirect (Standalone):', {
              from: l.pathname,
              to: newUrl
            });
            
            l.replace(newUrl);
          }
        }
      })(window.location);
    </script>
  </head>
  <body>
    <!-- This 404.html handles SPA routing for GitHub Pages -->
    <!-- It needs to be at the root of gh-pages to work properly -->
    <!-- Supports both deploy branch and main branch scenarios -->
    <!-- For standalone deployments, it works without the GitHub Pages specific logic -->
  </body>
</html>