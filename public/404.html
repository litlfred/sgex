<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>SGEX Workbench</title>
    <!-- Load SGEX centralized routing service -->
    <script>
      // Dynamically determine the correct path to routeConfig.js based on deployment structure
      (function() {
        var pathname = window.location.pathname;
        var configPath = './routeConfig.js'; // Default for root deployment
        
        // For GitHub Pages deployments, calculate relative path to deployment root
        if (pathname.includes('/sgex/')) {
          var sgexIndex = pathname.indexOf('/sgex/');
          var afterSgex = pathname.substring(sgexIndex + 6); // Length of '/sgex/'
          var pathSegments = afterSgex.split('/').filter(Boolean);
          
          if (pathSegments.length > 0) {
            // We're in a subdirectory, need to go back to deployment root
            var levelsBack = pathSegments.length - 1; // -1 because we want to stay in the branch dir
            
            // If we're accessing /sgex/branch/something/else, we need to go back to /sgex/branch/
            if (levelsBack > 0) {
              configPath = '../'.repeat(levelsBack) + 'routeConfig.js';
            }
          }
        }
        
        // Create and append script tag
        var script = document.createElement('script');
        script.src = configPath;
        script.onload = function() {
          // Once routeConfig.js is loaded, perform routing
          if (typeof window.performSGEXRouting === 'function') {
            // Ensure DOM is loaded before performing routing
            if (document.readyState === 'loading') {
              document.addEventListener('DOMContentLoaded', window.performSGEXRouting);
            } else {
              // DOM already loaded, execute immediately
              window.performSGEXRouting();
            }
          } else {
            console.error('SGEX routing function not available after loading routeConfig.js');
            showFallbackErrorPage();
          }
        };
        script.onerror = function() {
          console.error('Failed to load routeConfig.js from', configPath, '- showing fallback error page');
          showFallbackErrorPage();
        };
        document.head.appendChild(script);
        
        // Fallback error page if routeConfig.js fails to load
        function showFallbackErrorPage() {
          var l = window.location;
          var bugReportUrl = 'https://github.com/litlfred/sgex/issues/new?' + 
            'title=' + encodeURIComponent('[URL Routing Error] Failed to load routing configuration') +
            '&body=' + encodeURIComponent(
              'Error: Failed to load routeConfig.js\n\n' +
              'URL: ' + l.href + '\n' +
              'Hostname: ' + l.hostname + '\n' +
              'Path: ' + l.pathname + '\n' +
              'Attempted config path: ' + configPath + '\n\n' +
              'The SGEX routing system could not load its configuration. This may indicate a deployment issue.\n\n' +
              'Please describe what you were trying to do when this error occurred:'
            ) +
            '&labels=' + encodeURIComponent('bug,routing,deployment');

          var errorHTML = '<div style="font-family: Arial, sans-serif; max-width: 600px; margin: 50px auto; padding: 20px; text-align: center;">' +
              '<h1 style="color: #d73527;">SGEX Routing Error</h1>' +
              '<h2>Failed to Load Routing Configuration</h2>' +
              '<p style="background: #f5f5f5; padding: 15px; border-radius: 5px; text-align: left;">The SGEX routing system could not load its configuration file (routeConfig.js). This may indicate a deployment issue or network problem.</p>' +
              '<p><strong>Attempted Path:</strong> ' + configPath + '</p>' +
              '<div style="margin: 30px 0;">' +
                '<a href="https://litlfred.github.io/sgex/" style="background: #0078d4; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px; margin: 5px;">Go to SGEX Home</a>' +
                '<a href="' + bugReportUrl + '" target="_blank" style="background: #d73527; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px; margin: 5px;">Report Bug</a>' +
              '</div>' +
              '<p style="color: #666; font-size: 12px;">If this error persists, please use the "Report Bug" button to help us fix it.</p>' +
            '</div>';

          // Ensure DOM is ready before setting innerHTML
          if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
              document.body.innerHTML = errorHTML;
            });
          } else {
            document.body.innerHTML = errorHTML;
          }
        }
      })();
    </script>
  </head>
  <body>
    <!-- 
    This 404.html file provides centralized routing for SGEX
    All routing logic is now centralized in routeConfig.js
    Supports:
    - GitHub Pages and local deployments  
    - Branch-first patterns: /sgex/:branch/:component/:user/:repo/:branch/:asset
    - Component-first patterns: /sgex/:component/:user/:repo/:branch
    - Dynamic route configuration loading
    - Proper error handling and bug reporting
    
    Note: this file must be at least 512 bytes for Internet Explorer compatibility
    -->
  </body>
</html>