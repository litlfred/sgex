"use strict";(self.webpackChunksgex_workbench=self.webpackChunksgex_workbench||[]).push([[106],{9106:(e,s,a)=>{a.r(s),a.d(s,{default:()=>g});var n=a(5043),i=a(9615),t=a(3071),o=a(5240),l=a(4117),r=a(5452),c=a(579);const d=e=>{let{onAuthSuccess:s}=e;const{t:i}=(0,l.Bd)(),[t,o]=(0,n.useState)(""),[d,h]=(0,n.useState)(""),[g,u]=(0,n.useState)(!1),m=r.A.getLogger("PATLogin");n.useEffect(()=>(m.componentMount({hasOnAuthSuccess:!!s}),()=>m.componentUnmount()),[m,s]);return(0,c.jsx)("div",{className:"pat-login",children:(0,c.jsxs)("div",{className:"pat-login-section",children:[(0,c.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),m.userAction("PAT login attempt",{tokenProvided:!!t.trim()}),!t.trim()){return h("Please enter a GitHub Personal Access Token"),void m.warn("PAT login failed - no token provided")}u(!0),h("");const n=Date.now();m.auth("Starting PAT authentication");try{const{Octokit:e}=await Promise.resolve().then(a.bind(a,7036)),i=new e({auth:t.trim()});m.debug("Octokit instance created for PAT validation"),m.apiCall("GET","/user",null);const o=await i.rest.users.getAuthenticated(),l=Date.now()-n;m.apiResponse("GET","/user",o.status,l),m.auth("PAT authentication successful",{username:o.data.login,duration:l}),s(t.trim(),i)}catch(i){const e=Date.now()-n;m.apiError("GET","/user",i),m.auth("PAT authentication failed",{status:i.status,message:i.message,duration:e}),console.error("PAT authentication failed:",i),401===i.status?h("Invalid Personal Access Token. Please check your token and try again."):403===i.status?h("Token doesn't have sufficient permissions. Please ensure your token has 'repo' and 'read:org' scopes."):h("Authentication failed. Please check your connection and try again.")}finally{u(!1)}},className:"pat-form",children:[(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsxs)("label",{htmlFor:"pat-token",children:[i("auth.setupToken"),":"]}),(0,c.jsx)("input",{id:"pat-token",type:"password",value:t,onChange:e=>{o(e.target.value),d&&h("")},placeholder:"ghp_xxxxxxxxxxxxxxxxxxxx",className:"token-input "+(d?"error":""),disabled:g,autoComplete:"off"})]}),(0,c.jsx)("button",{type:"submit",className:"github-login-btn",disabled:g||!t.trim(),children:g?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("span",{className:"spinner small"}),i("common.loading"),"..."]}):(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("span",{className:"github-icon",children:"\ud83d\udd11"}),i("auth.signInWithPAT")]})})]}),d&&(0,c.jsx)("div",{className:"error-message",children:d})]})})};var h=a(6712);const g=()=>{const[e,s]=(0,n.useState)(null),[a,l]=(0,n.useState)([]),[r,g]=(0,n.useState)(!1),[u,m]=(0,n.useState)(!1),[x,p]=(0,n.useState)(null),[v,j]=(0,n.useState)({}),[f,N]=(0,n.useState)(null),b=(0,i.Zp)(),k=(0,i.zy)(),w=(0,n.useCallback)((e,s)=>{if(!t.A.isAuth())return;const a={};if(e){const s=o.A.getCachedRepositories(e.login,"user");s&&s.repositories&&(a[`user-${e.login}`]=s.repositories.length)}s.forEach(e=>{const s=o.A.getCachedRepositories(e.login,"org");s&&s.repositories&&(a[`org-${e.login}`]=s.repositories.length)}),j(a)},[]),A=(0,n.useCallback)(async()=>{m(!0),p(null);try{await t.A.checkTokenPermissions();const a=await t.A.getCurrentUser();s(a);let n=[];if(t.A.isAuth())try{n=await t.A.getUserOrganizations()}catch(x){console.error("Error fetching organizations:",x),n=[]}try{const e=await t.A.getWHOOrganization(),s=n.findIndex(e=>"WorldHealthOrganization"===e.login);s>=0?n[s]={...n[s],...e,isWHO:!0}:n.unshift(e)}catch(e){console.warn("Could not fetch WHO organization data, using fallback:",e);const s={id:"who-organization",login:"WorldHealthOrganization",name:"World Health Organization",description:"The World Health Organization is a specialized agency of the United Nations responsible for international public health.",avatar_url:"https://avatars.githubusercontent.com/u/12261302?s=200&v=4",html_url:"https://github.com/WorldHealthOrganization",type:"Organization",isWHO:!0};n.some(e=>"WorldHealthOrganization"===e.login)?n=n.map(e=>"WorldHealthOrganization"===e.login?{...e,isWHO:!0}:e):n.unshift(s)}l(n),w(a,n)}catch(x){console.error("Error fetching user data:",x),p("Failed to fetch user data. Please check your connection and try again."),g(!1),sessionStorage.removeItem("github_token"),localStorage.removeItem("github_token")}finally{m(!1)}},[w]);(0,n.useEffect)(()=>{(()=>{const e=sessionStorage.getItem("github_token")||localStorage.getItem("github_token");if(e){t.A.authenticate(e)?g(!0):(sessionStorage.removeItem("github_token"),localStorage.removeItem("github_token"))}})()},[]),(0,n.useEffect)(()=>{var e;null!==(e=k.state)&&void 0!==e&&e.warningMessage&&(N(k.state.warningMessage),b(k.pathname,{replace:!0,state:{}}))},[k.state,b,k.pathname]),(0,n.useEffect)(()=>{r&&!e&&A()},[r,e,A]);const y=(e,s)=>{sessionStorage.setItem("github_token",e),t.A.authenticateWithOctokit(s),g(!0),p(null),A()},S=e=>{b(`/dak-action/${e.login}`,{state:{profile:e}})},O=()=>{const e={login:"demo-user",name:"Demo User",avatar_url:"https://github.com/github.png",type:"User",isDemo:!0};b(`/dak-selection/${e.login}`,{state:{profile:e,action:"edit"}})},W=()=>{N(null)};return r?(0,c.jsx)(h.Mx,{pageName:"landing",showHeader:!1,children:(0,c.jsxs)("div",{className:"landing-page",children:[(0,c.jsxs)("div",{className:"landing-header",children:[(0,c.jsxs)("div",{className:"who-branding",children:[(0,c.jsx)("h1",{className:"clickable-title",children:"SGEX Workbench"}),(0,c.jsx)("p",{className:"subtitle",children:"WHO SMART Guidelines Exchange"})]}),(0,c.jsxs)("div",{className:"user-info",children:[(0,c.jsx)("img",{src:null===e||void 0===e?void 0:e.avatar_url,alt:"User avatar",className:"user-avatar"}),(0,c.jsx)("span",{children:(null===e||void 0===e?void 0:e.name)||(null===e||void 0===e?void 0:e.login)}),(0,c.jsx)("a",{href:"/sgex/docs/overview",className:"nav-link",children:"\ud83d\udcd6 Documentation"}),(0,c.jsx)("button",{onClick:()=>{t.A.logout(),g(!1),s(null),l([]),p(null)},className:"logout-btn",children:"Logout"})]})]}),(0,c.jsxs)("div",{className:"landing-content",children:[f&&(0,c.jsx)("div",{className:"warning-message",children:(0,c.jsxs)("div",{className:"warning-content",children:[(0,c.jsx)("span",{className:"warning-icon",children:"\u26a0\ufe0f"}),(0,c.jsx)("span",{className:"warning-text",children:f}),(0,c.jsx)("button",{className:"warning-dismiss",onClick:W,"aria-label":"Dismiss warning",children:"\xd7"})]})}),u?(0,c.jsxs)("div",{className:"loading-section",children:[(0,c.jsx)("div",{className:"spinner"}),(0,c.jsx)("p",{children:"Loading profile data..."})]}):(0,c.jsxs)("div",{className:"profile-selection",children:[(0,c.jsx)("h2",{children:"Select Profile or Organization"}),(0,c.jsx)("p",{children:"Choose the GitHub profile or organization containing your DAK repositories:"}),x&&(0,c.jsx)("div",{className:"error-message",children:x}),(0,c.jsxs)("div",{className:"profile-grid",children:[(0,c.jsxs)("div",{className:"profile-card",onClick:()=>S({type:"user",...e}),children:[(0,c.jsxs)("div",{className:"profile-card-header",children:[(0,c.jsx)("img",{src:null===e||void 0===e?void 0:e.avatar_url,alt:"Personal profile"}),v[`user-${null===e||void 0===e?void 0:e.login}`]>0&&(0,c.jsx)("div",{className:"dak-count-badge",children:v[`user-${null===e||void 0===e?void 0:e.login}`]})]}),(0,c.jsx)("h3",{children:(null===e||void 0===e?void 0:e.name)||(null===e||void 0===e?void 0:e.login)}),(0,c.jsx)("p",{children:"Personal repositories"}),(0,c.jsx)("div",{className:"profile-badges",children:(0,c.jsx)("span",{className:"profile-type",children:"Personal"})})]}),a.map(e=>(0,c.jsxs)("div",{className:"profile-card "+(e.isWHO?"who-org":""),onClick:()=>S({type:"org",...e}),children:[(0,c.jsxs)("div",{className:"profile-card-header",children:[(0,c.jsx)("img",{src:e.avatar_url||`https://github.com/${e.login}.png`,alt:`${e.name||e.login} organization`}),v[`org-${e.login}`]>0&&(0,c.jsx)("div",{className:"dak-count-badge",children:v[`org-${e.login}`]})]}),(0,c.jsx)("h3",{children:e.name||e.login}),(0,c.jsxs)("p",{children:["@",e.login]}),(0,c.jsxs)("div",{className:"profile-badges",children:[(0,c.jsx)("span",{className:"profile-type",children:"Organization"}),e.isWHO&&(0,c.jsx)("span",{className:"who-badge",children:"WHO Official"})]})]},e.login))]})]})]})]})}):(0,c.jsx)(h.Mx,{pageName:"landing",showHeader:!1,children:(0,c.jsxs)("div",{className:"landing-page",children:[(0,c.jsxs)("div",{className:"landing-header",children:[(0,c.jsxs)("div",{className:"who-branding",children:[(0,c.jsx)("h1",{className:"clickable-title",children:"SGEX Workbench"}),(0,c.jsx)("p",{className:"subtitle",children:"WHO SMART Guidelines Exchange"})]}),(0,c.jsx)("div",{className:"header-nav",children:(0,c.jsx)("a",{href:"/sgex/docs/overview",className:"nav-link",children:"\ud83d\udcd6 Documentation"})})]}),(0,c.jsxs)("div",{className:"landing-content",children:[f&&(0,c.jsx)("div",{className:"warning-message",children:(0,c.jsxs)("div",{className:"warning-content",children:[(0,c.jsx)("span",{className:"warning-icon",children:"\u26a0\ufe0f"}),(0,c.jsx)("span",{className:"warning-text",children:f}),(0,c.jsx)("button",{className:"warning-dismiss",onClick:W,"aria-label":"Dismiss warning",children:"\xd7"})]})}),(0,c.jsxs)("div",{className:"welcome-section",children:[(0,c.jsx)("h2",{children:"Welcome to SGEX Workbench"}),(0,c.jsx)("p",{children:"A browser-based, standards-compliant collaborative editor for WHO SMART Guidelines Digital Adaptation Kits (DAKs)."}),(0,c.jsxs)("div",{className:"auth-section",children:[(0,c.jsx)("p",{children:"Connect your GitHub account to get started:"}),(0,c.jsx)(d,{onAuthSuccess:y}),x&&(0,c.jsx)("div",{className:"error-message",children:x})]}),(0,c.jsxs)("div",{className:"demo-section",children:[(0,c.jsx)("p",{children:"Want to try without authentication?"}),(0,c.jsx)("button",{onClick:O,className:"demo-mode-btn",children:"\ud83c\udfad Try Demo Mode"}),(0,c.jsx)("p",{className:"demo-note",children:"Demo mode showcases the enhanced DAK scanning display with mock data."})]}),(0,c.jsx)("div",{className:"info-section",children:(0,c.jsxs)("p",{children:["Need help getting started? Check out our comprehensive"," ",(0,c.jsx)("a",{href:"/sgex/docs/overview",className:"doc-link",children:"documentation"})," ","to learn more about SGEX Workbench and DAK components."]})})]})]})]})})}}}]);
//# sourceMappingURL=106.a75cc9ed.chunk.js.map