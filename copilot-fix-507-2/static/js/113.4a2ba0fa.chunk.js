"use strict";(self.webpackChunksgex_workbench=self.webpackChunksgex_workbench||[]).push([[113],{4113:(e,s,n)=>{n.r(s),n.d(s,{default:()=>l});var a=n(5043),c=n(9615),i=n(3071),o=n(6712),r=n(579);const l=()=>{const e=(0,c.zy)(),s=(0,c.Zp)(),{profile:n,repository:l,component:t,selectedFile:d,selectedBranch:m}=e.state||{};console.log("BPMNSource: Received selectedBranch =",m);const[h,u]=(0,a.useState)(""),[b,p]=(0,a.useState)(!0),[x,j]=(0,a.useState)(null),[N,v]=(0,a.useState)(!1);(0,a.useEffect)(()=>{(async()=>{if(l&&n)try{var e;const s=n.token&&(null===(e=l.permissions)||void 0===e?void 0:e.push);v(s||!1)}catch(x){console.warn("Could not check write permissions:",x),v(!1)}})()},[l,n]),(0,a.useEffect)(()=>{(async()=>{if(d&&l)try{var e;p(!0),j(null);const s=(null===(e=l.owner)||void 0===e?void 0:e.login)||l.full_name.split("/")[0],n=l.name,a=m||"main";console.log(`Loading BPMN source from ${s}/${n}:${d.path} (ref: ${a})`);const c=await i.A.getFileContent(s,n,d.path,a);console.log("Successfully loaded BPMN source from repository"),u(c),p(!1)}catch(s){console.error("Error loading BPMN source:",s),404===s.status?j("BPMN file not found in the repository. The file may have been moved or deleted."):403===s.status?j("Access denied. This repository may be private and require authentication."):s.message.includes("rate limit")?j("GitHub API rate limit exceeded. Please try again later or authenticate for higher limits."):j(`Failed to load BPMN source: ${s.message}`),p(!1)}})()},[d,l,m]);const f=()=>{s("/business-process-selection",{state:{profile:n,repository:l,component:t,selectedBranch:m}})};return(0,a.useEffect)(()=>{n&&l&&d||s("/")},[n,l,d,s]),n&&l&&d?(0,r.jsx)(o.Mx,{pageName:"bpmn-source",children:(0,r.jsx)("div",{className:"bpmn-source",children:(0,r.jsxs)("div",{className:"source-content",children:[(0,r.jsxs)("div",{className:"breadcrumb",children:[(0,r.jsx)("button",{onClick:()=>s("/"),className:"breadcrumb-link",children:"Select Profile"}),(0,r.jsx)("span",{className:"breadcrumb-separator",children:"\u203a"}),(0,r.jsx)("button",{onClick:()=>s(`/dak-selection/${n.login}`,{state:{profile:n}}),className:"breadcrumb-link",children:"Select Repository"}),(0,r.jsx)("span",{className:"breadcrumb-separator",children:"\u203a"}),(0,r.jsx)("button",{onClick:()=>s("/dashboard",{state:{profile:n,repository:l}}),className:"breadcrumb-link",children:"DAK Components"}),(0,r.jsx)("span",{className:"breadcrumb-separator",children:"\u203a"}),(0,r.jsx)("button",{onClick:f,className:"breadcrumb-link",children:"Business Processes"}),(0,r.jsx)("span",{className:"breadcrumb-separator",children:"\u203a"}),(0,r.jsxs)("span",{className:"breadcrumb-current",children:[d.name," (source)"]})]}),(0,r.jsxs)("div",{className:"source-main",children:[(0,r.jsxs)("div",{className:"source-toolbar",children:[(0,r.jsxs)("div",{className:"toolbar-left",children:[(0,r.jsx)("h3",{children:d.name}),(0,r.jsx)("span",{className:"source-mode-badge",children:"\ud83d\udcc4 XML Source"})]}),(0,r.jsxs)("div",{className:"toolbar-right",children:[(0,r.jsx)("button",{className:"action-btn secondary",onClick:f,children:"\u2190 Back to List"}),(0,r.jsx)("button",{className:"action-btn secondary",onClick:async()=>{try{await navigator.clipboard.writeText(h);const e=document.querySelector(".copy-btn"),s=e.textContent;e.textContent="\u2713 Copied!",setTimeout(()=>{e.textContent=s},2e3)}catch(e){console.error("Failed to copy to clipboard:",e),alert("Failed to copy to clipboard")}},disabled:b,children:"\ud83d\udccb Copy"}),(0,r.jsx)("button",{className:"action-btn secondary",onClick:()=>{const e=new Blob([h],{type:"application/xml"}),s=URL.createObjectURL(e),n=document.createElement("a");n.href=s,n.download=d.name,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(s)},disabled:b,children:"\ud83d\udcbe Download"})]})]}),(0,r.jsx)("div",{className:"source-container",children:b?(0,r.jsxs)("div",{className:"loading-overlay",children:[(0,r.jsx)("div",{className:"spinner"}),(0,r.jsx)("p",{children:"Loading BPMN source code..."})]}):x?(0,r.jsxs)("div",{className:"error-overlay",children:[(0,r.jsxs)("p",{children:["\u274c ",x]}),(0,r.jsx)("button",{className:"action-btn secondary",onClick:()=>window.location.reload(),children:"Retry"})]}):(0,r.jsx)("pre",{className:"source-code",children:(0,r.jsx)("code",{className:"xml-code",children:h})})}),(0,r.jsxs)("div",{className:"source-actions",children:[(0,r.jsxs)("div",{className:"github-links",children:[(0,r.jsx)("h4",{children:"GitHub Actions"}),(0,r.jsxs)("div",{className:"link-buttons",children:[(0,r.jsx)("a",{href:(()=>{var e;const s=(null===(e=l.owner)||void 0===e?void 0:e.login)||l.full_name.split("/")[0],n=m||"main";console.log("BPMNSource GitHub URL: using branch =",n);const a=encodeURIComponent(n),c=`https://github.com/${s}/${l.name}/blob/${a}/${d.path}`;return console.log("BPMNSource GitHub URL generated:",c),c})(),target:"_blank",rel:"noopener noreferrer",className:"action-btn github-view",children:"\ud83d\udc41\ufe0f View on GitHub"}),N&&(0,r.jsx)("a",{href:(()=>{var e;const s=(null===(e=l.owner)||void 0===e?void 0:e.login)||l.full_name.split("/")[0],n=encodeURIComponent(m||"main");return`https://github.com/${s}/${l.name}/edit/${n}/${d.path}`})(),target:"_blank",rel:"noopener noreferrer",className:"action-btn github-edit",children:"\u270f\ufe0f Edit on GitHub"})]})]}),(0,r.jsxs)("div",{className:"file-info",children:[(0,r.jsx)("h4",{children:"File Information"}),(0,r.jsxs)("div",{className:"info-grid",children:[(0,r.jsxs)("div",{className:"info-item",children:[(0,r.jsx)("label",{children:"File Path:"}),(0,r.jsx)("span",{className:"file-path",children:d.path})]}),(0,r.jsxs)("div",{className:"info-item",children:[(0,r.jsx)("label",{children:"File Size:"}),(0,r.jsxs)("span",{children:[(d.size/1024).toFixed(1)," KB"]})]}),(0,r.jsxs)("div",{className:"info-item",children:[(0,r.jsx)("label",{children:"Format:"}),(0,r.jsx)("span",{children:"BPMN 2.0 XML"})]}),(0,r.jsxs)("div",{className:"info-item",children:[(0,r.jsx)("label",{children:"Access Level:"}),(0,r.jsx)("span",{className:"access-badge "+(N?"write":"read"),children:N?"\u270f\ufe0f Edit Access":"\ud83d\udc41\ufe0f Read-Only"})]})]})]})]})]})]})})}):(0,r.jsx)(o.Mx,{pageName:"bpmn-source",children:(0,r.jsx)("div",{className:"bpmn-source",children:(0,r.jsxs)("div",{className:"redirecting-state",children:[(0,r.jsx)("h2",{children:"Redirecting..."}),(0,r.jsx)("p",{children:"Missing required context. Redirecting to home page..."})]})})})}}}]);
//# sourceMappingURL=113.4a2ba0fa.chunk.js.map