"use strict";(self.webpackChunksgex_workbench=self.webpackChunksgex_workbench||[]).push([[42],{2804:(e,i,s)=>{s.r(i),s.d(i,{default:()=>h});var n=s(5043),t=s(9615),a=s(6712),r=s(3672),l=s(3071),o=s(579);const d=e=>{var i,s,t;let{questionnaire:a,onChange:r,onError:l}=e;const[d,c]=(0,n.useState)(!1),h=(e,i,s)=>{if(!a.item)return;const n=[...a.item];n[e]={...n[e],[i]:s};const t={...a,item:n};r(t)},u=(e,i)=>{const s={...a,[e]:i};r(s)};return(0,o.jsxs)("div",{className:"lforms-visual-editor",children:[(0,o.jsxs)("div",{className:"editor-modes",children:[(0,o.jsx)("button",{className:"mode-toggle "+(d?"":"active"),onClick:()=>c(!1),children:"\ud83d\udd27 Build Mode"}),(0,o.jsx)("button",{className:"mode-toggle "+(d?"active":""),onClick:()=>c(!0),children:"\ud83d\udc41\ufe0f Preview Mode"})]}),d?(0,o.jsxs)("div",{className:"lforms-preview",children:[(0,o.jsx)("h5",{children:"Live Preview"}),(0,o.jsxs)("div",{className:"simple-questionnaire-preview",children:[(0,o.jsxs)("div",{className:"preview-header",children:[(0,o.jsx)("h3",{children:a.title||"Untitled Questionnaire"}),(0,o.jsx)("p",{children:a.description||"No description provided"})]}),(0,o.jsx)("div",{className:"preview-questions",children:(null===(i=a.item)||void 0===i?void 0:i.map((e,i)=>(0,o.jsxs)("div",{className:"preview-question",children:[(0,o.jsxs)("label",{className:"preview-question-label",children:[i+1,". ",e.text,e.required&&(0,o.jsx)("span",{className:"required-asterisk",children:" *"})]}),"string"===e.type&&(0,o.jsx)("input",{type:"text",placeholder:"Text answer",disabled:!0}),"text"===e.type&&(0,o.jsx)("textarea",{placeholder:"Long text answer",disabled:!0,rows:3}),"boolean"===e.type&&(0,o.jsxs)("div",{className:"preview-boolean",children:[(0,o.jsxs)("label",{children:[(0,o.jsx)("input",{type:"radio",disabled:!0})," Yes"]}),(0,o.jsxs)("label",{children:[(0,o.jsx)("input",{type:"radio",disabled:!0})," No"]})]}),"decimal"===e.type&&(0,o.jsx)("input",{type:"number",step:"0.01",placeholder:"Number",disabled:!0}),"integer"===e.type&&(0,o.jsx)("input",{type:"number",step:"1",placeholder:"Integer",disabled:!0}),"date"===e.type&&(0,o.jsx)("input",{type:"date",disabled:!0}),"choice"===e.type&&(0,o.jsx)("select",{disabled:!0,children:(0,o.jsx)("option",{children:"Select an option..."})})]},e.linkId)))||(0,o.jsx)("p",{className:"no-questions-preview",children:"No questions added yet."})})]})]}):(0,o.jsxs)("div",{className:"lforms-builder",children:[(0,o.jsxs)("div",{className:"questionnaire-metadata-editor",children:[(0,o.jsx)("h5",{children:"Questionnaire Details"}),(0,o.jsxs)("div",{className:"metadata-grid",children:[(0,o.jsxs)("div",{className:"field-group",children:[(0,o.jsx)("label",{children:"Title:"}),(0,o.jsx)("input",{type:"text",value:a.title||"",onChange:e=>u("title",e.target.value),placeholder:"Enter questionnaire title"})]}),(0,o.jsxs)("div",{className:"field-group",children:[(0,o.jsx)("label",{children:"Name:"}),(0,o.jsx)("input",{type:"text",value:a.name||"",onChange:e=>u("name",e.target.value),placeholder:"Enter questionnaire name"})]}),(0,o.jsxs)("div",{className:"field-group",children:[(0,o.jsx)("label",{children:"Status:"}),(0,o.jsxs)("select",{value:a.status||"draft",onChange:e=>u("status",e.target.value),children:[(0,o.jsx)("option",{value:"draft",children:"Draft"}),(0,o.jsx)("option",{value:"active",children:"Active"}),(0,o.jsx)("option",{value:"retired",children:"Retired"})]})]}),(0,o.jsxs)("div",{className:"field-group",children:[(0,o.jsx)("label",{children:"Publisher:"}),(0,o.jsx)("input",{type:"text",value:a.publisher||"",onChange:e=>u("publisher",e.target.value),placeholder:"Enter publisher"})]})]}),(0,o.jsxs)("div",{className:"field-group",children:[(0,o.jsx)("label",{children:"Description:"}),(0,o.jsx)("textarea",{value:a.description||"",onChange:e=>u("description",e.target.value),placeholder:"Enter questionnaire description",rows:3})]})]}),(0,o.jsxs)("div",{className:"questions-builder",children:[(0,o.jsxs)("div",{className:"questions-header",children:[(0,o.jsxs)("h5",{children:["Questions (",(null===(s=a.item)||void 0===s?void 0:s.length)||0,")"]}),(0,o.jsx)("button",{onClick:()=>{var e;const i={linkId:`item-${Date.now()}`,text:`New Question ${((null===(e=a.item)||void 0===e?void 0:e.length)||0)+1}`,type:"string",required:!1},s={...a,item:[...a.item||[],i]};r(s)},className:"add-question-btn",children:"+ Add Question"})]}),null===(t=a.item)||void 0===t?void 0:t.map((e,i)=>(0,o.jsxs)("div",{className:"question-editor",children:[(0,o.jsxs)("div",{className:"question-header",children:[(0,o.jsxs)("span",{className:"question-number",children:["Q",i+1]}),(0,o.jsx)("button",{onClick:()=>(e=>{if(!a.item)return;const i=a.item.filter((i,s)=>s!==e),s={...a,item:i};r(s)})(i),className:"remove-question-btn",title:"Remove question",children:"\u2715"})]}),(0,o.jsxs)("div",{className:"question-fields",children:[(0,o.jsxs)("div",{className:"field-group",children:[(0,o.jsx)("label",{children:"Question Text:"}),(0,o.jsx)("input",{type:"text",value:e.text||"",onChange:e=>h(i,"text",e.target.value),placeholder:"Enter question text"})]}),(0,o.jsxs)("div",{className:"field-group",children:[(0,o.jsx)("label",{children:"Link ID:"}),(0,o.jsx)("input",{type:"text",value:e.linkId||"",onChange:e=>h(i,"linkId",e.target.value),placeholder:"Enter unique ID"})]}),(0,o.jsxs)("div",{className:"field-group",children:[(0,o.jsx)("label",{children:"Question Type:"}),(0,o.jsxs)("select",{value:e.type||"string",onChange:e=>h(i,"type",e.target.value),children:[(0,o.jsx)("option",{value:"string",children:"Short Text"}),(0,o.jsx)("option",{value:"text",children:"Long Text"}),(0,o.jsx)("option",{value:"boolean",children:"Yes/No"}),(0,o.jsx)("option",{value:"decimal",children:"Decimal Number"}),(0,o.jsx)("option",{value:"integer",children:"Integer"}),(0,o.jsx)("option",{value:"date",children:"Date"}),(0,o.jsx)("option",{value:"choice",children:"Single Choice"}),(0,o.jsx)("option",{value:"open-choice",children:"Choice with Other"})]})]}),(0,o.jsx)("div",{className:"field-group checkbox-group",children:(0,o.jsxs)("label",{children:[(0,o.jsx)("input",{type:"checkbox",checked:e.required||!1,onChange:e=>h(i,"required",e.target.checked)}),"Required"]})})]})]},e.linkId)),(!a.item||0===a.item.length)&&(0,o.jsx)("div",{className:"no-questions",children:(0,o.jsx)("p",{children:'No questions yet. Click "Add Question" to get started.'})})]})]})]})},c=()=>{var e;const i=(0,t.Zp)(),{repository:s,branch:c}=(0,a.oc)(),[h,u]=(0,n.useState)([]),[x,p]=(0,n.useState)(null),[m,j]=(0,n.useState)(!0),[v,g]=(0,n.useState)(null),[N,y]=(0,n.useState)(!1),[f,b]=(0,n.useState)(null),[q,S]=(0,n.useState)(null),[w,C]=(0,n.useState)(!1),[F,Q]=(0,n.useState)("visual"),[k,I]=(0,n.useState)(null);if((0,n.useEffect)(()=>{(async()=>{try{I(null),console.log("Using built-in visual editor"),C(!0)}catch(v){console.error("Failed to load LForms:",v),I(`Failed to load questionnaire editor: ${v.message}`),C(!0)}})()},[]),(0,n.useEffect)(()=>{(async()=>{if(s&&c)try{console.log("QuestionnaireEditor: Loading questionnaires for",s.name,"branch",c),j(!0),g(null);const e=[],i=[{path:"input/questionnaires",extensions:[".json"],type:"JSON"},{path:"input/fsh/questionnaires",extensions:[".fsh"],type:"FSH"}];for(const n of i)try{const i=(await l.A.getDirectoryContents(s.owner.login,s.name,n.path,c)).filter(e=>"file"===e.type&&n.extensions.some(i=>e.name.endsWith(i))).map(e=>{const i=n.extensions.find(i=>e.name.endsWith(i));return{...e,displayName:e.name.replace(i,""),fullPath:`${n.path}/${e.name}`,fileType:n.type,extension:i}});e.push(...i)}catch(v){404!==v.status&&console.warn(`Error loading from ${n.path}:`,v)}u(e)}catch(v){console.error("Error loading questionnaires:",v),g(`Failed to load questionnaires: ${v.message}`)}finally{j(!1)}else console.log("QuestionnaireEditor: Repository or branch not available yet, waiting...",{repository:!!s,branch:!!c})})()},[s,c]),!s||!c)return(0,o.jsxs)("div",{className:"questionnaire-editor-loading",children:[(0,o.jsx)("div",{className:"loading-spinner"}),(0,o.jsx)("p",{children:"Initializing Questionnaire Editor..."})]});const H=e=>{const i=e.match(/\*\s*title\s*=\s*"([^"]+)"/);return i?i[1]:null},T=e=>{const i=e.match(/\*\s*status\s*=\s*#(\w+)/);return i?i[1]:null},E=e=>{const i=e.match(/\*\s*name\s*=\s*"([^"]+)"/);return i?i[1]:null},O=e=>{const i=e.match(/\*\s*description\s*=\s*"([^"]+)"/);return i?i[1]:null},R=()=>{const e={resourceType:"Questionnaire",id:`questionnaire-${Date.now()}`,meta:{versionId:"1",lastUpdated:(new Date).toISOString()},url:`http://example.org/Questionnaire/${Date.now()}`,name:"NewQuestionnaire",title:"New Questionnaire",status:"draft",date:(new Date).toISOString().split("T")[0],publisher:"WHO SMART Guidelines",description:"A new FHIR Questionnaire",item:[{linkId:"1",text:"Sample Question",type:"string",required:!1}]};b(e),S(JSON.stringify(e,null,2)),p({name:`${e.name}.json`,displayName:e.name,fullPath:`input/questionnaires/${e.name}.json`,fileType:"JSON",isNew:!0}),y(!0),Q("visual"),console.log("New questionnaire created:",e)},$=f&&q&&JSON.stringify(f,null,2)!==q;return!m||s&&c?m&&!N?(0,o.jsx)(a.ox,{pageName:"questionnaire-editor",children:(0,o.jsxs)("div",{className:"questionnaire-editor-loading",children:[(0,o.jsx)("h2",{children:"Loading Questionnaires..."}),(0,o.jsx)("p",{children:"Fetching questionnaire files from repository..."})]})}):(0,o.jsx)(a.ox,{pageName:"questionnaire-editor",file:x,repository:s,branch:c,content:f?JSON.stringify(f,null,2):null,originalContent:q,hasChanges:$,onSave:(e,i)=>{if(console.log(`Questionnaire saved to ${i}`),"github"===i){const e=async()=>{try{const e=[],i=[{path:"input/questionnaires",extensions:[".json"],type:"JSON"},{path:"input/fsh/questionnaires",extensions:[".fsh"],type:"FSH"}];for(const n of i)try{const i=(await l.A.getDirectoryContents(s.owner.login,s.name,n.path,c)).filter(e=>"file"===e.type&&n.extensions.some(i=>e.name.endsWith(i))).map(e=>{const i=n.extensions.find(i=>e.name.endsWith(i));return{...e,displayName:e.name.replace(i,""),fullPath:`${n.path}/${e.name}`,fileType:n.type,extension:i}});e.push(...i)}catch(v){404!==v.status&&console.warn(`Error loading from ${n.path}:`,v)}u(e)}catch(v){console.error("Error refreshing questionnaires:",v)}};e()}},showSaveButtons:N,children:(0,o.jsxs)("div",{className:"questionnaire-editor",children:[(0,o.jsx)("div",{className:"questionnaire-header",children:(0,o.jsxs)("div",{className:"header-content",children:[(0,o.jsxs)("div",{className:"breadcrumb",children:[(0,o.jsxs)("button",{onClick:()=>{i(s&&c?`/dashboard/${s.owner.login}/${s.name}/${c}`:"/")},className:"back-link",children:["\u2190 ",s.name]}),(0,o.jsx)("span",{className:"separator",children:"/"}),(0,o.jsx)("span",{children:"Questionnaire Editor"}),c&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("span",{className:"separator",children:"/"}),(0,o.jsx)("span",{className:"branch",children:c})]})]}),(0,o.jsx)("h1",{children:"FHIR Questionnaire Editor"}),(0,o.jsx)("p",{children:"Manage and edit FHIR Questionnaire assets for your DAK"})]})}),(0,o.jsxs)("div",{className:"questionnaire-content",children:[v&&(0,o.jsxs)("div",{className:"error-message",children:[(0,o.jsx)("strong",{children:"Error:"})," ",v]}),N?(0,o.jsxs)("div",{className:"questionnaire-editor-container",children:[(0,o.jsxs)("div",{className:"editor-header",children:[(0,o.jsx)("button",{onClick:()=>y(!1),className:"back-to-list",children:"\u2190 Back to List"}),(0,o.jsx)("h2",{children:(null===x||void 0===x?void 0:x.displayName)||"New Questionnaire"}),"FSH"!==(null===f||void 0===f?void 0:f.fileType)&&(0,o.jsxs)("div",{className:"edit-mode-toggle",children:[(0,o.jsx)("button",{className:"mode-btn "+("visual"===F?"active":""),onClick:()=>Q("visual"),children:"\ud83d\udcdd Visual Editor"}),(0,o.jsx)("button",{className:"mode-btn "+("json"===F?"active":""),onClick:()=>Q("json"),children:" JSON Editor"})]})]}),k&&(0,o.jsxs)("div",{className:"error-message",children:[(0,o.jsx)("strong",{children:"LForms Error:"})," ",k]}),w?(0,o.jsxs)("div",{className:"lforms-container",children:[(0,o.jsxs)("div",{className:"questionnaire-preview",children:[(0,o.jsx)("h4",{children:"Questionnaire Preview"}),(0,o.jsxs)("div",{className:"questionnaire-metadata",children:[(0,o.jsxs)("p",{children:[(0,o.jsx)("strong",{children:"Title:"})," ",(null===f||void 0===f?void 0:f.title)||"Untitled"]}),(0,o.jsxs)("p",{children:[(0,o.jsx)("strong",{children:"Status:"})," ",(null===f||void 0===f?void 0:f.status)||"draft"]}),(0,o.jsxs)("p",{children:[(0,o.jsx)("strong",{children:"Format:"})," ",(null===f||void 0===f?void 0:f.fileType)||"JSON"]}),(0,o.jsxs)("p",{children:[(0,o.jsx)("strong",{children:"Date:"})," ",(null===f||void 0===f?void 0:f.date)||"Not specified"]}),"FSH"!==(null===f||void 0===f?void 0:f.fileType)&&(0,o.jsxs)("p",{children:[(0,o.jsx)("strong",{children:"Items:"})," ",(null===f||void 0===f||null===(e=f.item)||void 0===e?void 0:e.length)||0," questions"]})]})]}),"FSH"===(null===f||void 0===f?void 0:f.fileType)?(0,o.jsxs)("div",{className:"questionnaire-content-editor",children:[(0,o.jsxs)("h4",{children:["FHIR Shorthand Content",(0,o.jsx)("span",{className:"readonly-badge",children:" (Read-Only)"})]}),(0,o.jsxs)("div",{className:"fsh-editor",children:[(0,o.jsx)("textarea",{value:(null===f||void 0===f?void 0:f.rawContent)||"",readOnly:!0,className:"fsh-content",rows:20}),(0,o.jsxs)("div",{className:"fsh-notice",children:[(0,o.jsx)("strong",{children:"\ud83d\udcdd FSH File:"})," This is a FHIR Shorthand questionnaire. Direct editing is not supported yet - please edit the .fsh file directly in your repository."]})]})]}):"visual"===F?(0,o.jsxs)("div",{className:"visual-editor-section",children:[(0,o.jsx)("h4",{children:"Visual Questionnaire Builder"}),(0,o.jsx)("div",{className:"lforms-visual-editor",children:(0,o.jsx)(d,{questionnaire:f,onChange:e=>{b(e)},onError:I})})]}):(0,o.jsxs)("div",{className:"questionnaire-content-editor",children:[(0,o.jsx)("h4",{children:"Raw JSON Content"}),(0,o.jsx)("textarea",{value:JSON.stringify(f,null,2),onChange:e=>{try{const i=JSON.parse(e.target.value);b(i)}catch(v){console.warn("Invalid JSON in editor")}},className:"json-editor",rows:20})]}),(0,o.jsxs)("div",{className:"editor-instructions",children:[(0,o.jsx)("h4",{children:"Editing Instructions:"}),"FSH"===(null===f||void 0===f?void 0:f.fileType)?(0,o.jsxs)("ul",{children:[(0,o.jsx)("li",{children:"This is a FHIR Shorthand (.fsh) questionnaire file"}),(0,o.jsx)("li",{children:"FSH files define questionnaires using a domain-specific language"}),(0,o.jsx)("li",{children:"To edit this questionnaire, modify the .fsh file directly in your repository"}),(0,o.jsx)("li",{children:"FSH files are compiled into JSON during the build process"}),(0,o.jsxs)("li",{children:["Learn more about FHIR Shorthand at ",(0,o.jsx)("a",{href:"https://build.fhir.org/ig/HL7/fhir-shorthand/",target:"_blank",rel:"noopener noreferrer",children:"HL7 FHIR Shorthand"})]})]}):"visual"===F?(0,o.jsxs)("ul",{children:[(0,o.jsx)("li",{children:"Use the visual editor above to build your questionnaire interactively"}),(0,o.jsx)("li",{children:"Add, remove, and modify questions using the form builder interface"}),(0,o.jsx)("li",{children:"Preview your questionnaire as users will see it"}),(0,o.jsx)("li",{children:"Switch to JSON mode to see the raw FHIR Questionnaire structure"}),(0,o.jsx)("li",{children:"Changes are automatically saved as you work"})]}):(0,o.jsxs)("ul",{children:[(0,o.jsx)("li",{children:"Edit the JSON structure above to modify the questionnaire"}),(0,o.jsx)("li",{children:"The preview shows key questionnaire metadata"}),(0,o.jsx)("li",{children:"Changes are automatically detected for saving"}),(0,o.jsx)("li",{children:"Switch to Visual mode for an easier editing experience"}),(0,o.jsx)("li",{children:'Click "Save to Staging" to save changes locally'})]}),(0,o.jsxs)("div",{className:"help-tip",children:[(0,o.jsx)("strong",{children:"\u2728 New:"})," Visual questionnaire editor is now available using LHC-Forms!"]})]})]}):(0,o.jsx)("div",{className:"lforms-loading",children:(0,o.jsx)("p",{children:"Loading questionnaire editor..."})})]}):(0,o.jsxs)("div",{className:"questionnaire-list",children:[(0,o.jsxs)("div",{className:"list-header",children:[(0,o.jsxs)("h2",{children:["Questionnaires (",h.length,")"]}),(0,o.jsx)("button",{onClick:R,className:"btn-primary",disabled:!w,children:"+ Create New Questionnaire"})]}),0===h.length?(0,o.jsxs)("div",{className:"empty-state",children:[(0,o.jsx)("div",{className:"empty-icon",children:"\ud83d\udccb"}),(0,o.jsx)("h3",{children:"No Questionnaires Found"}),(0,o.jsx)("p",{children:"This repository doesn't have any FHIR Questionnaire files yet."}),(0,o.jsx)("p",{children:"Questionnaires can be stored as:"}),(0,o.jsxs)("ul",{style:{textAlign:"left",maxWidth:"400px",margin:"0 auto"},children:[(0,o.jsxs)("li",{children:[(0,o.jsx)("code",{children:"input/questionnaires/*.json"})," - FHIR JSON format"]}),(0,o.jsxs)("li",{children:[(0,o.jsx)("code",{children:"input/fsh/questionnaires/*.fsh"})," - FHIR Shorthand format"]})]}),(0,o.jsx)("button",{onClick:R,className:"btn-primary",disabled:!w,children:"Create Your First Questionnaire"})]}):(0,o.jsx)("div",{className:"questionnaire-grid",children:h.map(e=>(0,o.jsxs)("div",{className:"questionnaire-card",onClick:()=>(async e=>{try{j(!0);const i=await l.A.getFileContent(s.owner.login,s.name,e.fullPath,c);let n;"JSON"===e.fileType?n=JSON.parse(i):"FSH"===e.fileType&&(n={resourceType:"Questionnaire",fileType:"FSH",title:H(i)||e.displayName,status:T(i)||"draft",name:E(i)||e.displayName,description:O(i)||"FHIR Shorthand Questionnaire",rawContent:i,isReadOnly:!0}),b(n),S(i),p(e),y(!0),console.log("Questionnaire loaded:",n)}catch(v){console.error("Error loading questionnaire content:",v),g(`Failed to load questionnaire: ${v.message}`)}finally{j(!1)}})(e),children:[(0,o.jsx)("div",{className:"card-icon",children:"FSH"===e.fileType?"\ud83d\udcdd":"\ud83d\udccb"}),(0,o.jsxs)("div",{className:"card-content",children:[(0,o.jsx)("h3",{children:e.displayName}),(0,o.jsxs)("p",{className:"card-type",children:[e.fileType," Questionnaire"]}),(0,o.jsx)("p",{className:"card-path",children:e.fullPath}),(0,o.jsxs)("p",{className:"card-size",children:[(e.size/1024).toFixed(1)," KB"]})]})]},e.name))})]})]}),(0,o.jsx)(r.A,{pageId:"questionnaire-editor",contextData:{repository:s.name,branch:c,hasQuestionnaires:h.length>0,isEditing:N}})]})}):(0,o.jsx)(a.ox,{pageName:"questionnaire-editor",children:(0,o.jsxs)("div",{className:"questionnaire-editor-loading",children:[(0,o.jsx)("h2",{children:"Initializing Questionnaire Editor..."}),(0,o.jsx)("p",{children:"Loading repository context..."})]})})},h=()=>(0,o.jsx)(a.Mx,{pageName:"questionnaire-editor",children:(0,o.jsx)(c,{})})}}]);
//# sourceMappingURL=42.a6044e03.chunk.js.map