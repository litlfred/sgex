"use strict";(self.webpackChunksgex_workbench=self.webpackChunksgex_workbench||[]).push([[774],{30774:(e,s,t)=>{t.r(s),t.d(s,{default:()=>p});var n=t(89379),a=t(65043),i=t(73537),o=t(50404),c=t(22392),l=t(62148),r=t(85909),d=t(70579);const h=e=>{let{page:s,onClose:t}=e;if(!s)return null;const n=s.content?atob(s.content.content):"";return(0,d.jsx)("div",{className:"page-view-modal-overlay",onClick:e=>{e.target===e.currentTarget&&t()},children:(0,d.jsxs)("div",{className:"page-view-modal",children:[(0,d.jsxs)("div",{className:"page-view-modal-header",children:[(0,d.jsx)("h2",{children:s.title}),(0,d.jsx)("button",{className:"close-btn",onClick:t,"aria-label":"Close page view",children:"\xd7"})]}),(0,d.jsxs)("div",{className:"page-view-modal-content",children:[(0,d.jsxs)("div",{className:"page-info",children:[(0,d.jsx)("span",{className:"page-filename",children:s.filename}),(0,d.jsx)("span",{className:"page-path",children:s.path})]}),(0,d.jsxs)("div",{className:"page-content",children:[(0,d.jsxs)("div",{className:"content-tabs",children:[(0,d.jsx)("button",{className:"tab-btn active",children:"Rendered"}),(0,d.jsx)("button",{className:"tab-btn",onClick:()=>{const e=document.querySelector(".rendered-content"),s=document.querySelector(".raw-content"),t=document.querySelectorAll(".tab-btn");"none"===e.style.display?(e.style.display="block",s.style.display="none",t[0].classList.add("active"),t[1].classList.remove("active")):(e.style.display="none",s.style.display="block",t[0].classList.remove("active"),t[1].classList.add("active"))},children:"Raw Markdown"})]}),(0,d.jsx)("div",{className:"rendered-content",dangerouslySetInnerHTML:{__html:(0,r.LO)(n)}}),(0,d.jsx)("div",{className:"raw-content",style:{display:"none"},children:(0,d.jsx)("pre",{children:n})})]})]})]})})};var g=t(10739);const m=e=>{let{page:s,onClose:t,onSave:n}=e;const[i,o]=(0,a.useState)(null!==s&&void 0!==s&&s.content?atob(s.content.content):""),[l,r]=(0,a.useState)(!1);if(!s)return null;return(0,d.jsx)("div",{className:"page-edit-modal-overlay",onClick:e=>{e.target===e.currentTarget&&t()},children:(0,d.jsxs)("div",{className:"page-edit-modal",children:[(0,d.jsxs)("div",{className:"page-edit-modal-header",children:[(0,d.jsxs)("h2",{children:["Edit ",s.title]}),(0,d.jsxs)("div",{className:"header-actions",children:[(0,d.jsx)("button",{className:"btn-secondary",onClick:t,disabled:l,children:"Cancel"}),(0,d.jsx)("button",{className:"btn-primary",onClick:async()=>{r(!0);try{if(!c.A.updateFile(s.path,i,{title:s.title,filename:s.filename,tool:"PageEditor",contentType:"markdown"}))throw new Error("Failed to save to staging ground");n&&await n(s,i,"staged"),t()}catch(e){console.error("Failed to save page:",e),alert("Failed to save page to staging ground. Please try again.")}finally{r(!1)}},disabled:l,children:l?"Staging...":"Stage Changes"})]})]}),(0,d.jsxs)("div",{className:"page-edit-modal-content",children:[(0,d.jsxs)("div",{className:"page-info",children:[(0,d.jsx)("span",{className:"page-filename",children:s.filename}),(0,d.jsx)("span",{className:"page-path",children:s.path})]}),(0,d.jsx)("div",{className:"md-editor-container",children:(0,d.jsx)(g.Ay,{value:i,onChange:e=>o(e||""),preview:"edit",height:500,visibleDragBar:!1,"data-color-mode":"light",hideToolbar:l})})]})]})})};var u=t(98757);const p=()=>{const e=(0,i.zy)(),s=(0,i.Zp)(),{profile:t,repository:r,selectedBranch:g}=e.state||{},[p,f]=(0,a.useState)([]),[x,v]=(0,a.useState)(!0),[j,b]=(0,a.useState)(null),[y,N]=(0,a.useState)(!1),[w,k]=(0,a.useState)(!0),[A,S]=(0,a.useState)(null),[C,E]=(0,a.useState)(null);(0,a.useEffect)(()=>{(async()=>{if(o.A.isAuth())return void k(!1);const e=sessionStorage.getItem("github_token")||localStorage.getItem("github_token");if(e){console.log("Restoring GitHub authentication from stored token");o.A.authenticate(e)?console.log("GitHub authentication restored successfully"):(console.warn("Failed to restore GitHub authentication"),sessionStorage.removeItem("github_token"),localStorage.removeItem("github_token"))}else console.warn("No stored GitHub token found");k(!1)})()},[]),(0,a.useEffect)(()=>{w||(async()=>{if(r&&t&&!w)try{var e;const s=await o.A.checkRepositoryWritePermissions((null===(e=r.owner)||void 0===e?void 0:e.login)||r.full_name.split("/")[0],r.name);N(s)}catch(j){console.warn("Could not check write permissions:",j),N(!1)}})()},[r,t,w]),(0,a.useEffect)(()=>{r&&g&&!w&&c.A.initialize(r,g)},[r,g,w]),(0,a.useEffect)(()=>{(async()=>{if(!t||!r)return void s("/");if(w)return;if(!o.A.isAuth())return b("GitHub authentication not available. Please return to the home page and sign in again."),void v(!1);let e=0;for(;e<3;){try{var n;v(!0),b(null);const s=(null===(n=r.owner)||void 0===n?void 0:n.login)||r.full_name.split("/")[0],t=r.name,a=g||"main";if(console.log("Loading pages for ".concat(s,"/").concat(t," on branch: ").concat(a," (attempt ").concat(e+1,")")),console.log("selectedBranch:",g),console.log("GitHub auth status:",o.A.isAuth()),console.log("GitHub octokit:",!!o.A.octokit),!o.A.isAuth()||!o.A.octokit){if(e<2){console.log("GitHub service not ready, waiting..."),await new Promise(e=>setTimeout(e,1e3)),e++;continue}throw new Error("GitHub service not authenticated. Please return to the home page and sign in again.")}const i=await G(s,t,a);if(!i)throw new Error('sushi-config.yaml not found in repository on branch "'.concat(a,'"'));const c=_(i),l=await H(s,t,a,c);f(l);break}catch(j){if(console.error("Failed to load pages:",j),e<2){e++,await new Promise(e=>setTimeout(e,500));continue}b(j.message)}finally{v(!1)}break}})()},[t,r,g,s,w]);const G=async(e,s,t)=>{try{if(!o.A.isAuth()||!o.A.octokit)throw new Error("GitHub service not authenticated");console.log("Fetching sushi-config.yaml from ".concat(e,"/").concat(s," on branch ").concat(t));const{data:n}=await o.A.octokit.rest.repos.getContent({owner:e,repo:s,path:"sushi-config.yaml",ref:t});return"file"===n.type&&n.content?(console.log("Successfully fetched sushi-config.yaml"),atob(n.content)):(console.log("sushi-config.yaml found but no content or not a file"),null)}catch(j){throw console.error("Failed to fetch sushi-config.yaml:",j),404===j.status?new Error('sushi-config.yaml not found in repository on branch "'.concat(t,'"')):403===j.status?new Error("Access denied - insufficient permissions to read repository contents"):401===j.status?new Error("Authentication failed - please check your GitHub token"):o.A.isAuth()?new Error("Failed to fetch sushi-config.yaml: ".concat(j.message)):new Error("GitHub service not authenticated")}},_=e=>{const s=[];try{const t=e.split("\n");let n=!1,a=0;for(let e=0;e<t.length;e++){const i=t[e],o=i.trim();if("pages:"!==o){if(n){const n=i.length-i.trimStart().length;if(o&&n<=a)break;if(o.endsWith(".md:")){const i=o.replace(":","").trim();let c=i;for(let s=e+1;s<t.length;s++){const e=t[s],a=e.trim(),i=e.length-e.trimStart().length;if(a&&i<=n)break;if(a.startsWith("title:")){c=a.replace("title:","").trim();break}}s.push({title:c,filename:i,path:"input/pagecontent/".concat(i),level:Math.floor((n-a)/2)})}else if(o.endsWith(":")&&!o.includes(".md")){const e=o.replace(":","").trim();e&&s.push({title:e,isSection:!0,level:Math.floor((n-a)/2)})}}}else n=!0,a=i.length-i.trimStart().length}}catch(j){console.error("Failed to parse pages from sushi-config.yaml:",j)}return s},H=async(e,s,t,a)=>{const i=[];for(const c of a){if(c.isSection){i.push(c);continue}let a=!1,l=null;try{if(o.A.isAuth()&&o.A.octokit){const{data:n}=await o.A.octokit.rest.repos.getContent({owner:e,repo:s,path:c.path,ref:t});"file"===n.type&&(a=!0,l=n)}}catch(j){a=!1}i.push((0,n.A)((0,n.A)({},c),{},{exists:a,content:l,githubUrl:"https://github.com/".concat(e,"/").concat(s,"/blob/").concat(t,"/").concat(c.path)}))}return i};return(0,a.useEffect)(()=>{t&&r||s("/")},[t,r,s]),t&&r?(0,d.jsx)(l.Mx,{pageName:"pages-manager",children:(0,d.jsxs)("div",{className:"pages-manager",children:[(0,d.jsxs)("div",{className:"pages-content",children:[(0,d.jsx)(u.A,{repository:r,selectedBranch:g,hasWriteAccess:y,profile:t}),(0,d.jsxs)("div",{className:"pages-main",children:[(0,d.jsxs)("div",{className:"pages-intro",children:[(0,d.jsxs)("h2",{children:[(0,d.jsx)("span",{className:"component-icon",style:{color:"#8b5cf6"},children:"\ud83d\udcc4"}),"Pages"]}),(0,d.jsxs)("p",{children:["Published page content and documentation for ",(0,d.jsx)("strong",{children:r.name}),g&&(0,d.jsxs)("span",{children:[" on branch ",(0,d.jsx)("code",{className:"branch-display",children:g})]}),". Pages are defined in ",(0,d.jsx)("code",{children:"sushi-config.yaml"})," and stored as Markdown files in ",(0,d.jsx)("code",{children:"input/pagecontent/"}),"."]})]}),(x||w)&&(0,d.jsxs)("div",{className:"loading-state",children:[(0,d.jsx)("div",{className:"loading-spinner"}),(0,d.jsx)("p",{children:w?"Initializing GitHub authentication...":"Loading pages from sushi-config.yaml..."})]}),j&&(0,d.jsxs)("div",{className:"error-state",children:[(0,d.jsx)("div",{className:"error-icon",children:"\u26a0\ufe0f"}),(0,d.jsxs)("div",{className:"error-content",children:[(0,d.jsx)("h3",{children:"Could not load pages"}),(0,d.jsx)("p",{children:j}),(0,d.jsxs)("div",{className:"error-suggestions",children:[(0,d.jsx)("p",{children:"Make sure:"}),(0,d.jsxs)("ul",{children:[(0,d.jsxs)("li",{children:["The repository contains a ",(0,d.jsx)("code",{children:"sushi-config.yaml"})," file",g&&' on branch "'.concat(g,'"')]}),(0,d.jsxs)("li",{children:["The sushi-config.yaml file has a ",(0,d.jsx)("code",{children:"pages:"})," section"]}),(0,d.jsx)("li",{children:"You have access to view the repository contents"}),g&&"main"!==g&&(0,d.jsxs)("li",{children:['The branch "',g,'" exists and is accessible']})]})]})]})]}),!x&&!w&&!j&&0===p.length&&(0,d.jsxs)("div",{className:"empty-state",children:[(0,d.jsx)("div",{className:"empty-icon",children:"\ud83d\udcc4"}),(0,d.jsx)("h3",{children:"No pages found"}),(0,d.jsx)("p",{children:"This repository doesn't have any pages defined in sushi-config.yaml"}),(0,d.jsx)("div",{className:"empty-actions",children:(0,d.jsx)("a",{href:"https://github.com/".concat(r.full_name,"/blob/").concat(g||"main","/sushi-config.yaml"),target:"_blank",rel:"noopener noreferrer",className:"btn-secondary",children:"View sushi-config.yaml"})})]}),!x&&!w&&!j&&p.length>0&&(0,d.jsxs)("div",{className:"pages-list",children:[(0,d.jsxs)("div",{className:"pages-header-info",children:[(0,d.jsxs)("div",{className:"pages-count",children:[p.filter(e=>!e.isSection).length," pages found"]}),(0,d.jsx)("div",{className:"pages-actions",children:(0,d.jsx)("a",{href:"https://github.com/".concat(r.full_name,"/blob/").concat(g||"main","/sushi-config.yaml"),target:"_blank",rel:"noopener noreferrer",className:"btn-secondary small",children:"View sushi-config.yaml"})})]}),(0,d.jsx)("div",{className:"pages-tree",children:p.map((e,s)=>(0,d.jsx)("div",{className:"page-item ".concat(e.isSection?"section":"page"," level-").concat(e.level),style:{"--indent-level":e.level},children:e.isSection?(0,d.jsxs)("div",{className:"section-header",children:[(0,d.jsx)("span",{className:"section-icon",children:"\ud83d\udcc1"}),(0,d.jsx)("span",{className:"section-title",children:e.title})]}):(0,d.jsxs)("div",{className:"page-row",children:[(0,d.jsxs)("div",{className:"page-info",children:[(0,d.jsxs)("div",{className:"page-title",children:[(0,d.jsx)("span",{className:"page-status ".concat(e.exists?"exists":"missing"),children:e.exists?"\u2705":"\u274c"}),(0,d.jsx)("span",{className:"page-name",children:e.title}),(0,d.jsxs)("span",{className:"page-filename",children:["(",e.filename,")"]})]}),!e.exists&&(0,d.jsx)("div",{className:"page-error",children:"File not found in repository"})]}),(0,d.jsxs)("div",{className:"page-actions",children:[e.exists&&(0,d.jsx)("button",{onClick:()=>(e=>{S(e)})(e),className:"btn-action view",title:"View page content",children:"\ud83d\udc41\ufe0f View"}),(0,d.jsx)("button",{onClick:()=>(e=>{E(e)})(e),className:"btn-action edit",title:"Edit page with WYSIWYG editor",children:"\u270f\ufe0f Edit"}),(0,d.jsx)("a",{href:e.githubUrl,target:"_blank",rel:"noopener noreferrer",className:"btn-action source",title:"View source on GitHub",children:"\ud83d\udd17 Source"})]})]})},s))})]})]})]}),A&&(0,d.jsx)(h,{page:A,onClose:()=>S(null)}),C&&(0,d.jsx)(m,{page:C,onClose:()=>E(null),onSave:async function(e,s){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"staged";if("staged"!==t){if("direct"===t&&!y)throw new Error("You need write access to save changes. Please upgrade your GitHub token permissions.");if("direct"===t){var n,a,i;const t=(null===(n=r.owner)||void 0===n?void 0:n.login)||r.full_name.split("/")[0],c=g||"main",l=btoa(s),d=null===(a=e.content)||void 0===a?void 0:a.sha;await o.A.octokit.rest.repos.createOrUpdateFileContents({owner:t,repo:r.name,path:e.path,message:"Update ".concat(e.filename," via SGEX Workbench"),content:l,branch:c,sha:d});const h=(null===(i=r.owner)||void 0===i?void 0:i.login)||r.full_name.split("/")[0],m=await G(h,r.name,c);if(m){const e=_(m),s=await H(h,r.name,c,e);f(s)}}}else console.log("Page ".concat(e.filename," has been staged for commit"))}})]})}):(0,d.jsx)(l.Mx,{pageName:"pages-manager",children:(0,d.jsx)("div",{className:"pages-manager",children:(0,d.jsxs)("div",{className:"redirecting-state",children:[(0,d.jsx)("h2",{children:"Redirecting..."}),(0,d.jsx)("p",{children:"Missing required context. Redirecting to home page..."})]})})})}}}]);
//# sourceMappingURL=774.d940c77e.chunk.js.map