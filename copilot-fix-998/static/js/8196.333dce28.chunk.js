"use strict";(self.webpackChunksgex_workbench=self.webpackChunksgex_workbench||[]).push([[8196],{18196:(e,s,a)=>{a.r(s),a.d(s,{default:()=>u});var n=a(89379),i=a(9950),t=a(46901),r=a(57561),o=a(53782),c=a(29166),l=a(44414);const d=(0,i.lazy)(()=>Promise.all([a.e(3738),a.e(7845),a.e(2383),a.e(5743)]).then(a.bind(a,25743))),h=()=>{const{profile:e,repository:s,branch:a}=(0,o.N5)(),h=null===e||void 0===e?void 0:e.login,u=null===s||void 0===s?void 0:s.name,[p,m]=(0,i.useState)([]),[g,x]=(0,i.useState)(!0),[v,j]=(0,i.useState)(null),[f,b]=(0,i.useState)(null),[N,w]=(0,i.useState)(""),[y,S]=(0,i.useState)(!1),[C,k]=(0,i.useState)(!1),[A,F]=(0,i.useState)(!1),[D,E]=(0,i.useState)(""),[I,P]=(0,i.useState)(""),L=(0,i.useCallback)(async()=>{if(h&&u&&a)try{x(!0),j(null);const e="input/pagecontent",s=(await t.A.getDirectoryContents(h,u,e,a)).filter(e=>"file"===e.type&&e.name.startsWith("userscenario-")&&e.name.endsWith(".md")).map(e=>(0,n.A)((0,n.A)({},e),{},{id:e.name.replace("userscenario-","").replace(".md",""),title:e.name.replace("userscenario-","").replace(".md","").replace(/-/g," "),source:"github"})),i=r.A.getStagingGround().files.filter(e=>e.path.startsWith("input/pagecontent/userscenario-")&&e.path.endsWith(".md")).map(e=>{var s,a,n;const i=e.path.split("/").pop();return{path:e.path,name:i,id:i.replace("userscenario-","").replace(".md",""),title:(null===(s=e.metadata)||void 0===s?void 0:s.scenarioTitle)||i.replace("userscenario-","").replace(".md","").replace(/-/g," "),source:"staging",isNew:(null===(a=e.metadata)||void 0===a?void 0:a.isNew)||!1,lastModified:null===(n=e.metadata)||void 0===n?void 0:n.lastModified}}),o=[...s];i.forEach(e=>{const s=o.findIndex(s=>s.path===e.path);s>=0?o[s]=(0,n.A)((0,n.A)((0,n.A)({},o[s]),e),{},{hasChanges:!0}):o.push(e)}),m(o)}catch(e){console.error("Error loading scenario files:",e),j("Failed to load user scenarios: ".concat(e.message))}finally{x(!1)}},[h,u,a]),G=(0,i.useCallback)(async e=>{if(e)try{let s;if(x(!0),"staging"===e.source||e.hasChanges){const a=r.A.getStagingGround().files.find(s=>s.path===e.path);a&&(s=a.content)}if(!s&&h&&u&&a&&(s=await t.A.getFileContent(h,u,e.path,a)),!s)throw new Error("Could not load scenario content");w(s),b(e)}catch(s){console.error("Error loading scenario content:",s),j("Failed to load scenario: ".concat(s.message))}finally{x(!1)}},[h,u,a]),M=(0,i.useCallback)(async()=>{if(f)try{k(!0);if(!r.A.updateFile(f.path,N,{componentType:"user-scenario",scenarioId:f.id,lastModified:Date.now()}))throw new Error("Failed to save to staging ground");S(!1),j(null),console.log("Scenario saved to staging ground. Use Publications \u2192 Staging Ground to commit to GitHub.")}catch(e){console.error("Error saving scenario:",e),j("Failed to save scenario: ".concat(e.message))}finally{k(!1)}},[f,N]),T=(0,i.useCallback)(async()=>{var e;if(D&&I)try{if(k(!0),!(/^[a-z0-9]+(-[a-z0-9]+)*$/.test(e=D)&&e.length>=3&&e.length<=50))return j("Scenario ID must be lowercase, use hyphens instead of spaces, and contain only letters, numbers, and hyphens."),void k(!1);const n="userscenario-".concat(D,".md"),i="input/pagecontent/".concat(n),o=r.A.getStagingGround();if(o.files.some(e=>e.path===i))return j("A scenario with this ID already exists in staging ground. Please choose a different ID."),void k(!1);if(h&&u&&a)try{return await t.A.getFileContent(h,u,i,a),j("A scenario with this ID already exists in the repository. Please choose a different ID."),void k(!1)}catch(s){}const c="# ".concat(I,"\n\n## Overview\nBrief description of this user scenario.\n\n## Actors\n- Primary actor: [Actor name]\n- Secondary actors: [List other actors if applicable]\n\n## Preconditions\n- [List any preconditions]\n\n## Flow of Events\n1. [Step 1]\n2. [Step 2]\n3. [Continue with the main flow]\n\n## Postconditions\n- [List the expected outcomes]\n\n## Alternative Flows\n### [Alternative Flow Name]\n- [Describe alternative scenarios]\n\n## Exception Flows\n### [Exception Flow Name]\n- [Describe error handling scenarios]\n\n## Notes\n- [Additional notes or considerations]\n");if(!r.A.updateFile(i,c,{componentType:"user-scenario",scenarioId:D,scenarioTitle:I,isNew:!0,createdAt:Date.now()}))throw new Error("Failed to save to staging ground");await L(),F(!1),E(""),P(""),j(null),console.log("New scenario created in staging ground. Use Publications \u2192 Staging Ground to commit to GitHub.")}catch(s){console.error("Error creating scenario:",s),j("Failed to create scenario: ".concat(s.message))}finally{k(!1)}},[D,I,h,u,a,L]);return(0,i.useEffect)(()=>{L()},[L]),(0,i.useEffect)(()=>{if(I){const e=I.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"");E(e)}},[I]),g&&!f?(0,l.jsx)("div",{className:"user-scenarios-container",children:(0,l.jsxs)("div",{className:"loading-container",children:[(0,l.jsx)("div",{className:"loading-spinner"}),(0,l.jsx)("p",{children:"Loading user scenarios..."})]})}):v&&!f?(0,l.jsx)("div",{className:"user-scenarios-container",children:(0,l.jsxs)("div",{className:"error-container",children:[(0,l.jsx)("h2",{children:"Error Loading User Scenarios"}),(0,l.jsx)("p",{children:v}),(0,l.jsx)("button",{onClick:()=>window.location.reload(),children:"Retry"})]})}):(0,l.jsxs)("div",{className:"user-scenarios-container",children:[(0,l.jsxs)("div",{className:"user-scenarios-header",children:[(0,l.jsx)("h1",{children:"User Scenarios"}),(0,l.jsx)("p",{children:"Narrative descriptions of how different personas interact with the system in specific healthcare contexts."}),(0,l.jsx)("div",{className:"header-actions",children:(0,l.jsx)("button",{className:"btn-primary",onClick:()=>F(!0),disabled:C,children:"Create New Scenario"})})]}),(0,l.jsxs)("div",{className:"user-scenarios-content",children:[(0,l.jsxs)("div",{className:"scenarios-sidebar",children:[(0,l.jsxs)("h3",{children:["Available Scenarios (",p.length,")"]}),0===p.length?(0,l.jsxs)("div",{className:"empty-state",children:[(0,l.jsx)("p",{children:"No user scenarios found."}),(0,l.jsx)("p",{children:'Click "Create New Scenario" to get started.'})]}):(0,l.jsx)("div",{className:"scenarios-list",children:p.map(e=>(0,l.jsxs)("div",{className:"scenario-item ".concat((null===f||void 0===f?void 0:f.path)===e.path?"selected":""),onClick:()=>G(e),onKeyDown:s=>{"Enter"!==s.key&&" "!==s.key||(s.preventDefault(),G(e))},role:"button",tabIndex:0,"aria-label":"Select user scenario: ".concat(e.title),children:[(0,l.jsx)("h4",{children:e.title}),(0,l.jsxs)("p",{className:"scenario-id",children:["ID: ",e.id]})]},e.path))})]}),(0,l.jsx)("div",{className:"scenario-editor",children:f?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"editor-header",children:[(0,l.jsx)("h2",{children:f.title}),(0,l.jsx)("div",{className:"editor-actions",children:y?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("button",{className:"btn-secondary",onClick:()=>S(!1),disabled:C,children:"Cancel"}),(0,l.jsx)("button",{className:"btn-primary",onClick:M,disabled:C,children:C?"Saving...":"Save"})]}):(0,l.jsx)("button",{className:"btn-primary",onClick:()=>S(!0),children:"Edit"})})]}),(0,l.jsx)("div",{className:"editor-content",children:y?(0,l.jsx)(i.Suspense,{fallback:(0,l.jsx)("div",{children:"Loading editor..."}),children:(0,l.jsx)(d,{value:N,onChange:w,height:600,"data-color-mode":"light"})}):(0,l.jsx)(i.Suspense,{fallback:(0,l.jsx)("div",{children:"Loading preview..."}),children:(0,l.jsx)(d.Markdown,{source:N,style:{whiteSpace:"pre-wrap"}})})})]}):(0,l.jsx)("div",{className:"editor-placeholder",children:(0,l.jsx)("p",{children:"Select a scenario from the list to view or edit it."})})})]}),A&&(0,l.jsx)("div",{className:"modal-overlay",children:(0,l.jsxs)("div",{className:"modal",children:[(0,l.jsxs)("div",{className:"modal-header",children:[(0,l.jsx)("h3",{children:"Create New User Scenario"}),(0,l.jsx)("button",{className:"modal-close",onClick:()=>F(!1),children:"\xd7"})]}),(0,l.jsxs)("div",{className:"modal-content",children:[(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{htmlFor:"scenario-title",children:"Scenario Title:"}),(0,l.jsx)("input",{id:"scenario-title",type:"text",value:I,onChange:e=>P(e.target.value),placeholder:"e.g., Patient Registration Flow"})]}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{htmlFor:"scenario-id",children:"Scenario ID:"}),(0,l.jsx)("input",{id:"scenario-id",type:"text",value:D,onChange:e=>E(e.target.value),placeholder:"e.g., patient-registration-flow"}),(0,l.jsx)("small",{className:"form-help",children:"ID must be lowercase, use hyphens instead of spaces, and contain only letters, numbers, and hyphens."})]}),v&&(0,l.jsx)("div",{className:"error-message",children:v})]}),(0,l.jsxs)("div",{className:"modal-actions",children:[(0,l.jsx)("button",{className:"btn-secondary",onClick:()=>F(!1),disabled:C,children:"Cancel"}),(0,l.jsx)("button",{className:"btn-primary",onClick:T,disabled:C||!I.trim()||!D.trim(),children:C?"Creating...":"Create Scenario"})]})]})}),v&&f&&(0,l.jsxs)("div",{className:"error-banner",children:[(0,l.jsx)("p",{children:v}),(0,l.jsx)("button",{onClick:()=>j(null),children:"Dismiss"})]}),(0,l.jsx)(c.A,{pageId:"user-scenarios",style:{position:"fixed",bottom:"20px",right:"20px"}})]})},u=()=>(0,l.jsx)(o.Mx,{pageName:"user-scenarios",children:(0,l.jsx)(h,{})})}}]);