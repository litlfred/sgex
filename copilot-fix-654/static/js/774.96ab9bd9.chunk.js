"use strict";(self.webpackChunksgex_workbench=self.webpackChunksgex_workbench||[]).push([[774],{30774:(e,s,t)=>{t.r(s),t.d(s,{default:()=>m});var n=t(65043),a=t(29615),i=t(93071),o=t(22392),l=t(16786),c=t(70579);const r=e=>{let{page:s,onClose:t}=e;if(!s)return null;const n=s.content?atob(s.content.content):"";return(0,c.jsx)("div",{className:"page-view-modal-overlay",onClick:e=>{e.target===e.currentTarget&&t()},children:(0,c.jsxs)("div",{className:"page-view-modal",children:[(0,c.jsxs)("div",{className:"page-view-modal-header",children:[(0,c.jsx)("h2",{children:s.title}),(0,c.jsx)("button",{className:"close-btn",onClick:t,"aria-label":"Close page view",children:"\xd7"})]}),(0,c.jsxs)("div",{className:"page-view-modal-content",children:[(0,c.jsxs)("div",{className:"page-info",children:[(0,c.jsx)("span",{className:"page-filename",children:s.filename}),(0,c.jsx)("span",{className:"page-path",children:s.path})]}),(0,c.jsxs)("div",{className:"page-content",children:[(0,c.jsxs)("div",{className:"content-tabs",children:[(0,c.jsx)("button",{className:"tab-btn active",children:"Rendered"}),(0,c.jsx)("button",{className:"tab-btn",onClick:()=>{const e=document.querySelector(".rendered-content"),s=document.querySelector(".raw-content"),t=document.querySelectorAll(".tab-btn");"none"===e.style.display?(e.style.display="block",s.style.display="none",t[0].classList.add("active"),t[1].classList.remove("active")):(e.style.display="none",s.style.display="block",t[0].classList.remove("active"),t[1].classList.add("active"))},children:"Raw Markdown"})]}),(0,c.jsx)("div",{className:"rendered-content",dangerouslySetInnerHTML:{__html:(a=n,a.replace(/^# (.*$)/gim,"<h1>$1</h1>").replace(/^## (.*$)/gim,"<h2>$1</h2>").replace(/^### (.*$)/gim,"<h3>$1</h3>").replace(/^\* (.*$)/gim,"<li>$1</li>").replace(/^- (.*$)/gim,"<li>$1</li>").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`(.*?)`/g,"<code>$1</code>").replace(/\n/g,"<br>"))}}),(0,c.jsx)("div",{className:"raw-content",style:{display:"none"},children:(0,c.jsx)("pre",{children:n})})]})]})]})});var a};var d=t(98638);const h=e=>{let{page:s,onClose:t,onSave:a}=e;const[i,l]=(0,n.useState)(null!==s&&void 0!==s&&s.content?atob(s.content.content):""),[r,h]=(0,n.useState)(!1);if(!s)return null;return(0,c.jsx)("div",{className:"page-edit-modal-overlay",onClick:e=>{e.target===e.currentTarget&&t()},children:(0,c.jsxs)("div",{className:"page-edit-modal",children:[(0,c.jsxs)("div",{className:"page-edit-modal-header",children:[(0,c.jsxs)("h2",{children:["Edit ",s.title]}),(0,c.jsxs)("div",{className:"header-actions",children:[(0,c.jsx)("button",{className:"btn-secondary",onClick:t,disabled:r,children:"Cancel"}),(0,c.jsx)("button",{className:"btn-primary",onClick:async()=>{h(!0);try{if(!o.A.updateFile(s.path,i,{title:s.title,filename:s.filename,tool:"PageEditor",contentType:"markdown"}))throw new Error("Failed to save to staging ground");a&&await a(s,i,"staged"),t()}catch(e){console.error("Failed to save page:",e),alert("Failed to save page to staging ground. Please try again.")}finally{h(!1)}},disabled:r,children:r?"Staging...":"Stage Changes"})]})]}),(0,c.jsxs)("div",{className:"page-edit-modal-content",children:[(0,c.jsxs)("div",{className:"page-info",children:[(0,c.jsx)("span",{className:"page-filename",children:s.filename}),(0,c.jsx)("span",{className:"page-path",children:s.path})]}),(0,c.jsx)("div",{className:"md-editor-container",children:(0,c.jsx)(d.Ay,{value:i,onChange:e=>l(e||""),preview:"edit",height:500,visibleDragBar:!1,"data-color-mode":"light",hideToolbar:r})})]})]})})};var g=t(98757);const m=()=>{const e=(0,a.zy)(),s=(0,a.Zp)(),{profile:t,repository:d,selectedBranch:m}=e.state||{},[u,p]=(0,n.useState)([]),[f,v]=(0,n.useState)(!0),[x,j]=(0,n.useState)(null),[b,y]=(0,n.useState)(!1),[N,w]=(0,n.useState)(!0),[k,$]=(0,n.useState)(null),[S,A]=(0,n.useState)(null);(0,n.useEffect)(()=>{(async()=>{if(i.A.isAuth())return void w(!1);const e=sessionStorage.getItem("github_token")||localStorage.getItem("github_token");if(e){console.log("Restoring GitHub authentication from stored token");i.A.authenticate(e)?console.log("GitHub authentication restored successfully"):(console.warn("Failed to restore GitHub authentication"),sessionStorage.removeItem("github_token"),localStorage.removeItem("github_token"))}else console.warn("No stored GitHub token found");w(!1)})()},[]),(0,n.useEffect)(()=>{N||(async()=>{if(d&&t&&!N)try{var e;const s=await i.A.checkRepositoryWritePermissions((null===(e=d.owner)||void 0===e?void 0:e.login)||d.full_name.split("/")[0],d.name);y(s)}catch(x){console.warn("Could not check write permissions:",x),y(!1)}})()},[d,t,N]),(0,n.useEffect)(()=>{d&&m&&!N&&o.A.initialize(d,m)},[d,m,N]),(0,n.useEffect)(()=>{(async()=>{if(!t||!d)return void s("/");if(N)return;if(!i.A.isAuth())return j("GitHub authentication not available. Please return to the home page and sign in again."),void v(!1);let e=0;for(;e<3;){try{var n;v(!0),j(null);const s=(null===(n=d.owner)||void 0===n?void 0:n.login)||d.full_name.split("/")[0],t=d.name,a=m||"main";if(console.log(`Loading pages for ${s}/${t} on branch: ${a} (attempt ${e+1})`),console.log("selectedBranch:",m),console.log("GitHub auth status:",i.A.isAuth()),console.log("GitHub octokit:",!!i.A.octokit),!i.A.isAuth()||!i.A.octokit){if(e<2){console.log("GitHub service not ready, waiting..."),await new Promise(e=>setTimeout(e,1e3)),e++;continue}throw new Error("GitHub service not authenticated. Please return to the home page and sign in again.")}const o=await C(s,t,a);if(!o)throw new Error(`sushi-config.yaml not found in repository on branch "${a}"`);const l=E(o),c=await G(s,t,a,l);p(c);break}catch(x){if(console.error("Failed to load pages:",x),e<2){e++,await new Promise(e=>setTimeout(e,500));continue}j(x.message)}finally{v(!1)}break}})()},[t,d,m,s,N]);const C=async(e,s,t)=>{try{if(!i.A.isAuth()||!i.A.octokit)throw new Error("GitHub service not authenticated");console.log(`Fetching sushi-config.yaml from ${e}/${s} on branch ${t}`);const{data:n}=await i.A.octokit.rest.repos.getContent({owner:e,repo:s,path:"sushi-config.yaml",ref:t});return"file"===n.type&&n.content?(console.log("Successfully fetched sushi-config.yaml"),atob(n.content)):(console.log("sushi-config.yaml found but no content or not a file"),null)}catch(x){throw console.error("Failed to fetch sushi-config.yaml:",x),404===x.status?new Error(`sushi-config.yaml not found in repository on branch "${t}"`):403===x.status?new Error("Access denied - insufficient permissions to read repository contents"):401===x.status?new Error("Authentication failed - please check your GitHub token"):i.A.isAuth()?new Error(`Failed to fetch sushi-config.yaml: ${x.message}`):new Error("GitHub service not authenticated")}},E=e=>{const s=[];try{const t=e.split("\n");let n=!1,a=0;for(let e=0;e<t.length;e++){const i=t[e],o=i.trim();if("pages:"!==o){if(n){const n=i.length-i.trimStart().length;if(o&&n<=a)break;if(o.endsWith(".md:")){const i=o.replace(":","").trim();let l=i;for(let s=e+1;s<t.length;s++){const e=t[s],a=e.trim(),i=e.length-e.trimStart().length;if(a&&i<=n)break;if(a.startsWith("title:")){l=a.replace("title:","").trim();break}}s.push({title:l,filename:i,path:`input/pagecontent/${i}`,level:Math.floor((n-a)/2)})}else if(o.endsWith(":")&&!o.includes(".md")){const e=o.replace(":","").trim();e&&s.push({title:e,isSection:!0,level:Math.floor((n-a)/2)})}}}else n=!0,a=i.length-i.trimStart().length}}catch(x){console.error("Failed to parse pages from sushi-config.yaml:",x)}return s},G=async(e,s,t,n)=>{const a=[];for(const o of n){if(o.isSection){a.push(o);continue}let n=!1,l=null;try{if(i.A.isAuth()&&i.A.octokit){const{data:a}=await i.A.octokit.rest.repos.getContent({owner:e,repo:s,path:o.path,ref:t});"file"===a.type&&(n=!0,l=a)}}catch(x){n=!1}a.push({...o,exists:n,content:l,githubUrl:`https://github.com/${e}/${s}/blob/${t}/${o.path}`})}return a};return(0,n.useEffect)(()=>{t&&d||s("/")},[t,d,s]),t&&d?(0,c.jsx)(l.Mx,{pageName:"pages-manager",children:(0,c.jsxs)("div",{className:"pages-manager",children:[(0,c.jsxs)("div",{className:"pages-content",children:[(0,c.jsx)(g.A,{repository:d,selectedBranch:m,hasWriteAccess:b,profile:t}),(0,c.jsxs)("div",{className:"pages-main",children:[(0,c.jsxs)("div",{className:"pages-intro",children:[(0,c.jsxs)("h2",{children:[(0,c.jsx)("span",{className:"component-icon",style:{color:"#8b5cf6"},children:"\ud83d\udcc4"}),"Pages"]}),(0,c.jsxs)("p",{children:["Published page content and documentation for ",(0,c.jsx)("strong",{children:d.name}),m&&(0,c.jsxs)("span",{children:[" on branch ",(0,c.jsx)("code",{className:"branch-display",children:m})]}),". Pages are defined in ",(0,c.jsx)("code",{children:"sushi-config.yaml"})," and stored as Markdown files in ",(0,c.jsx)("code",{children:"input/pagecontent/"}),"."]})]}),(f||N)&&(0,c.jsxs)("div",{className:"loading-state",children:[(0,c.jsx)("div",{className:"loading-spinner"}),(0,c.jsx)("p",{children:N?"Initializing GitHub authentication...":"Loading pages from sushi-config.yaml..."})]}),x&&(0,c.jsxs)("div",{className:"error-state",children:[(0,c.jsx)("div",{className:"error-icon",children:"\u26a0\ufe0f"}),(0,c.jsxs)("div",{className:"error-content",children:[(0,c.jsx)("h3",{children:"Could not load pages"}),(0,c.jsx)("p",{children:x}),(0,c.jsxs)("div",{className:"error-suggestions",children:[(0,c.jsx)("p",{children:"Make sure:"}),(0,c.jsxs)("ul",{children:[(0,c.jsxs)("li",{children:["The repository contains a ",(0,c.jsx)("code",{children:"sushi-config.yaml"})," file",m&&` on branch "${m}"`]}),(0,c.jsxs)("li",{children:["The sushi-config.yaml file has a ",(0,c.jsx)("code",{children:"pages:"})," section"]}),(0,c.jsx)("li",{children:"You have access to view the repository contents"}),m&&"main"!==m&&(0,c.jsxs)("li",{children:['The branch "',m,'" exists and is accessible']})]})]})]})]}),!f&&!N&&!x&&0===u.length&&(0,c.jsxs)("div",{className:"empty-state",children:[(0,c.jsx)("div",{className:"empty-icon",children:"\ud83d\udcc4"}),(0,c.jsx)("h3",{children:"No pages found"}),(0,c.jsx)("p",{children:"This repository doesn't have any pages defined in sushi-config.yaml"}),(0,c.jsx)("div",{className:"empty-actions",children:(0,c.jsx)("a",{href:`https://github.com/${d.full_name}/blob/${m||"main"}/sushi-config.yaml`,target:"_blank",rel:"noopener noreferrer",className:"btn-secondary",children:"View sushi-config.yaml"})})]}),!f&&!N&&!x&&u.length>0&&(0,c.jsxs)("div",{className:"pages-list",children:[(0,c.jsxs)("div",{className:"pages-header-info",children:[(0,c.jsxs)("div",{className:"pages-count",children:[u.filter(e=>!e.isSection).length," pages found"]}),(0,c.jsx)("div",{className:"pages-actions",children:(0,c.jsx)("a",{href:`https://github.com/${d.full_name}/blob/${m||"main"}/sushi-config.yaml`,target:"_blank",rel:"noopener noreferrer",className:"btn-secondary small",children:"View sushi-config.yaml"})})]}),(0,c.jsx)("div",{className:"pages-tree",children:u.map((e,s)=>(0,c.jsx)("div",{className:`page-item ${e.isSection?"section":"page"} level-${e.level}`,style:{"--indent-level":e.level},children:e.isSection?(0,c.jsxs)("div",{className:"section-header",children:[(0,c.jsx)("span",{className:"section-icon",children:"\ud83d\udcc1"}),(0,c.jsx)("span",{className:"section-title",children:e.title})]}):(0,c.jsxs)("div",{className:"page-row",children:[(0,c.jsxs)("div",{className:"page-info",children:[(0,c.jsxs)("div",{className:"page-title",children:[(0,c.jsx)("span",{className:"page-status "+(e.exists?"exists":"missing"),children:e.exists?"\u2705":"\u274c"}),(0,c.jsx)("span",{className:"page-name",children:e.title}),(0,c.jsxs)("span",{className:"page-filename",children:["(",e.filename,")"]})]}),!e.exists&&(0,c.jsx)("div",{className:"page-error",children:"File not found in repository"})]}),(0,c.jsxs)("div",{className:"page-actions",children:[e.exists&&(0,c.jsx)("button",{onClick:()=>(e=>{$(e)})(e),className:"btn-action view",title:"View page content",children:"\ud83d\udc41\ufe0f View"}),(0,c.jsx)("button",{onClick:()=>(e=>{A(e)})(e),className:"btn-action edit",title:"Edit page with WYSIWYG editor",children:"\u270f\ufe0f Edit"}),(0,c.jsx)("a",{href:e.githubUrl,target:"_blank",rel:"noopener noreferrer",className:"btn-action source",title:"View source on GitHub",children:"\ud83d\udd17 Source"})]})]})},s))})]})]})]}),k&&(0,c.jsx)(r,{page:k,onClose:()=>$(null)}),S&&(0,c.jsx)(h,{page:S,onClose:()=>A(null),onSave:async function(e,s){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"staged";if("staged"!==t){if("direct"===t&&!b)throw new Error("You need write access to save changes. Please upgrade your GitHub token permissions.");if("direct"===t){var n,a,o;const t=(null===(n=d.owner)||void 0===n?void 0:n.login)||d.full_name.split("/")[0],l=m||"main",c=btoa(s),r=null===(a=e.content)||void 0===a?void 0:a.sha;await i.A.octokit.rest.repos.createOrUpdateFileContents({owner:t,repo:d.name,path:e.path,message:`Update ${e.filename} via SGEX Workbench`,content:c,branch:l,sha:r});const h=(null===(o=d.owner)||void 0===o?void 0:o.login)||d.full_name.split("/")[0],g=await C(h,d.name,l);if(g){const e=E(g),s=await G(h,d.name,l,e);p(s)}}}else console.log(`Page ${e.filename} has been staged for commit`)}})]})}):(0,c.jsx)(l.Mx,{pageName:"pages-manager",children:(0,c.jsx)("div",{className:"pages-manager",children:(0,c.jsxs)("div",{className:"redirecting-state",children:[(0,c.jsx)("h2",{children:"Redirecting..."}),(0,c.jsx)("p",{children:"Missing required context. Redirecting to home page..."})]})})})}}}]);
//# sourceMappingURL=774.96ab9bd9.chunk.js.map