"use strict";(self.webpackChunksgex_workbench=self.webpackChunksgex_workbench||[]).push([[5453],{55453:(e,n,i)=>{i.r(n),i.d(n,{default:()=>m});var o=i(9950),t=i(18518),l=i(46901),s=i(88498);const r=()=>{var e,n,i;const r=(0,t.zy)(),a=(0,t.Zp)(),{user:d,repo:c,branch:u}=(0,t.g)(),[v,m]=(0,o.useState)((null===(e=r.state)||void 0===e?void 0:e.profile)||null),[p,h]=(0,o.useState)((null===(n=r.state)||void 0===n?void 0:n.repository)||null),[g,w]=(0,o.useState)((null===(i=r.state)||void 0===i?void 0:i.selectedBranch)||u||null),[b,P]=(0,o.useState)(!v||!p),[y,f]=(0,o.useState)(null);return(0,o.useEffect)(()=>{(async()=>{var e,n,i,o,t;if(console.log("\ud83d\udd0d useDAKUrlParams: Starting data fetch analysis:",{urlParams:{user:d,repo:c,branch:u},currentState:{hasProfile:!!v,hasRepository:!!p,profileLogin:null===v||void 0===v?void 0:v.login,repositoryFullName:null===p||void 0===p?void 0:p.full_name,repositoryOwner:null===p||void 0===p||null===(e=p.owner)||void 0===e?void 0:e.login},hasLocationState:!!r.state,locationStateSummary:r.state?{hasProfile:!!r.state.profile,hasRepository:!!r.state.repository,profileLogin:null===(n=r.state.profile)||void 0===n?void 0:n.login,repositoryFullName:null===(i=r.state.repository)||void 0===i?void 0:i.full_name,repositoryOwner:null===(o=r.state.repository)||void 0===o||null===(t=o.owner)||void 0===t?void 0:t.login}:null,isAuthenticated:l.A.isAuth(),needsFetch:(!v||!p)&&d&&c}),v&&p||!d||!c)console.log("\ud83d\udccb useDAKUrlParams: Not fetching from URL params, using existing state:",{hasProfile:!!v,hasRepository:!!p,hasUserParam:!!d,hasRepoParam:!!c,reason:v&&p?"state already populated":"missing URL params"}),P(!1);else{console.log("useDAKUrlParams: Fetching data from URL parameters:",{user:d,repo:c,branch:u,hasProfile:!!v,hasRepository:!!p,hasLocationState:!!r.state,isAuthenticated:l.A.isAuth()});try{if(P(!0),f(null),!l.A.isAuth()){console.log("\ud83d\udeab useDAKUrlParams: Not authenticated, using public access"),console.log("\ud83d\udc40 useDAKUrlParams: Unauthenticated public access, creating public profile");const e={login:d,name:d.charAt(0).toUpperCase()+d.slice(1),avatar_url:"https://github.com/".concat(d,".png"),type:"User"},n={name:c,full_name:"".concat(d,"/").concat(c),owner:{login:d},default_branch:u||"main",html_url:"https://github.com/".concat(d,"/").concat(c)};return console.log("\ud83d\udccb useDAKUrlParams: Setting public access state:",{profile:e,repository:n,selectedBranch:u||"main"}),m(e),h(n),w(u||"main"),void P(!1)}console.log("\ud83d\udd10 useDAKUrlParams: Authenticated, fetching real repository data");let e=null;try{console.log("\ud83d\udd0d useDAKUrlParams: Fetching user profile for: ".concat(d));e=await l.A.getUser(d),console.log("\u2705 useDAKUrlParams: User profile fetched:",{login:e.login,name:e.name,type:e.type})}catch(g){return console.error("\u274c useDAKUrlParams: Error fetching user:",g),void a("/",{state:{warningMessage:"Could not access the requested DAK. User '".concat(d,"' not found or not accessible.")}})}let n=null;try{console.log("useDAKUrlParams: Fetching repository data for ".concat(d,"/").concat(c));n=await l.A.getRepository(d,c),console.log("useDAKUrlParams: Repository data fetched successfully:",{name:n.name,full_name:n.full_name,owner:n.owner,default_branch:n.default_branch})}catch(g){return console.error("useDAKUrlParams: Error fetching repository:",g),void a("/",{state:{warningMessage:"Could not access the requested DAK. Repository '".concat(d,"/").concat(c,"' not found or not accessible.")}})}if(!await s.A.validateDAKRepository(d,c,u||n.default_branch))return console.log("Repository ".concat(d,"/").concat(c," is not a valid DAK repository")),void a("/",{state:{warningMessage:"Could not access the requested DAK. Repository '".concat(d,"/").concat(c,"' not found or not accessible.")}});if(u)try{await l.A.getBranch(d,c,u),w(u)}catch(g){console.warn("Branch '".concat(u,"' not found, falling back to default branch")),w(n.default_branch)}else w(n.default_branch);console.log("useDAKUrlParams: Setting final state:",{profile:{login:e.login,name:e.name,type:e.type},repository:{name:n.name,full_name:n.full_name,owner:n.owner,default_branch:n.default_branch},selectedBranch:u||n.default_branch}),m(e),h(n),P(!1)}catch(g){console.error("Error fetching data from URL params:",g),f("Failed to load DAK data. Please check the URL or try again."),P(!1)}}})()},[d,c,u,v,p,a,r.state]),{profile:v,repository:p,selectedBranch:g,loading:b,error:y,user:d,repo:c,branch:u||g,navigate:a}};var a=i(53782),d=i(1932),c=i(96143),u=i(44414);const v=e=>{let{file:n,repository:i,selectedBranch:t,profile:s}=e;const r=(0,o.useRef)(null),a=(0,o.useRef)(null),[d,v]=(0,o.useState)(!0),[m,p]=(0,o.useState)(null);return(0,o.useEffect)(()=>(n&&i?(console.log("\ud83d\ude80 BPMNPreview: Starting loadPreview for:",n.name),(async()=>{if(!n||!i)return void console.log("\ud83d\udeab BPMNPreview: Missing required props:",{hasFile:!!n,hasRepository:!!i,fileName:null===n||void 0===n?void 0:n.name});const e=function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;r.current?(console.log("\u2705 BPMNPreview: Container found on attempt ".concat(n+1)),o()):n<20?(console.log("\u23f3 BPMNPreview: Container not ready, attempt ".concat(n+1,"/").concat(20)),setTimeout(()=>e(n+1),100)):(console.error("\u274c BPMNPreview: Container never became available"),p("Failed to initialize preview container"),v(!1))},o=async()=>{try{var e,o,s,d;v(!0),p(null),r.current&&(r.current.innerHTML="");const q=(null===(e=i.owner)||void 0===e?void 0:e.login)||i.full_name.split("/")[0],T=i.name,K=t||"main",H=(null===(o=n.path)||void 0===o?void 0:o.includes("demo/"))||(null===(s=n.sha)||void 0===s?void 0:s.startsWith("demo-"));let I;if(console.log("\ud83c\udfac BPMNPreview: Starting preview load for file:",{fileName:n.name,filePath:n.path,owner:q,repoName:T,ref:K,isDemo:H,hasDownloadUrl:!!n.download_url}),H){const e=n.name.replace(".bpmn","").replace(/[-_]/g," ");I='<?xml version="1.0" encoding="UTF-8"?>\n<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" \n                  xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" \n                  xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" \n                  xmlns:di="http://www.omg.org/spec/DD/20100524/DI" \n                  id="Definitions_1" targetNamespace="http://bpmn.io/schema/bpmn">\n  <bpmn:process id="Process_'.concat(n.name.replace(/[^a-zA-Z0-9]/g,"_"),'" isExecutable="false">\n    <bpmn:startEvent id="StartEvent_1" name="Start">\n      <bpmn:outgoing>Flow_1</bpmn:outgoing>\n    </bpmn:startEvent>\n    <bpmn:task id="Task_1" name="').concat(e,'">\n      <bpmn:incoming>Flow_1</bpmn:incoming>\n      <bpmn:outgoing>Flow_2</bpmn:outgoing>\n    </bpmn:task>\n    <bpmn:endEvent id="EndEvent_1" name="End">\n      <bpmn:incoming>Flow_2</bpmn:incoming>\n    </bpmn:endEvent>\n    <bpmn:sequenceFlow id="Flow_1" sourceRef="StartEvent_1" targetRef="Task_1" />\n    <bpmn:sequenceFlow id="Flow_2" sourceRef="Task_1" targetRef="EndEvent_1" />\n  </bpmn:process>\n  <bpmndi:BPMNDiagram id="BPMNDiagram_1">\n    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="Process_').concat(n.name.replace(/[^a-zA-Z0-9]/g,"_"),'">\n      <bpmndi:BPMNShape id="StartEvent_1_di" bpmnElement="StartEvent_1">\n        <dc:Bounds x="152" y="82" width="36" height="36" />\n        <bpmndi:BPMNLabel>\n          <dc:Bounds x="158" y="125" width="24" height="14" />\n        </bpmndi:BPMNLabel>\n      </bpmndi:BPMNShape>\n      <bpmndi:BPMNShape id="Task_1_di" bpmnElement="Task_1">\n        <dc:Bounds x="250" y="60" width="100" height="80" />\n      </bpmndi:BPMNShape>\n      <bpmndi:BPMNShape id="EndEvent_1_di" bpmnElement="EndEvent_1">\n        <dc:Bounds x="402" y="82" width="36" height="36" />\n        <bpmndi:BPMNLabel>\n          <dc:Bounds x="410" y="125" width="20" height="14" />\n        </bpmndi:BPMNLabel>\n      </bpmndi:BPMNShape>\n      <bpmndi:BPMNEdge id="Flow_1_di" bpmnElement="Flow_1">\n        <di:waypoint x="188" y="100" />\n        <di:waypoint x="250" y="100" />\n      </bpmndi:BPMNEdge>\n      <bpmndi:BPMNEdge id="Flow_2_di" bpmnElement="Flow_2">\n        <di:waypoint x="350" y="100" />\n        <di:waypoint x="402" y="100" />\n      </bpmndi:BPMNEdge>\n    </bpmndi:BPMNPlane>\n  </bpmndi:BPMNDiagram>\n</bpmn:definitions>')}else{console.log("\ud83d\udce5 BPMNPreview: Attempting to load real BPMN file content...");try{var u,m;if(console.log("\ud83c\udf10 BPMNPreview: Calling githubService.getFileContent with params:",{owner:q,repoName:T,path:n.path,ref:K}),I=await l.A.getFileContent(q,T,n.path,K),console.log("\u2705 BPMNPreview: Successfully loaded BPMN content, length:",null===(u=I)||void 0===u?void 0:u.length),console.log("\ud83d\udd0d BPMNPreview: Content preview (first 100 chars):",null===(m=I)||void 0===m?void 0:m.substring(0,100)),!I||"string"!==typeof I)throw new Error("Invalid content received: not a string");if(!I.includes("bpmn:definitions")&&!I.includes("<definitions"))throw console.warn("\u26a0\ufe0f BPMNPreview: Content does not appear to be valid BPMN XML"),console.log("\ud83d\udd0d BPMNPreview: Full content received:",I),new Error("Content does not appear to be valid BPMN");console.log("\u2705 BPMNPreview: BPMN content validation passed")}catch(U){console.warn("\u274c BPMNPreview: Could not load BPMN file content:",U.message,U.status),console.error("\ud83d\udd0d BPMNPreview: File loading error details:",{error:U,stack:U.stack,fileName:n.name,filePath:n.path,owner:q,repoName:T,ref:K});const e=n.name.replace(".bpmn","").replace(/[-_]/g," ");console.log("\ud83d\udd04 BPMNPreview: Using fallback BPMN diagram for:",e),I='<?xml version="1.0" encoding="UTF-8"?>\n<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" \n                  xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" \n                  xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" \n                  xmlns:di="http://www.omg.org/spec/DD/20100524/DI" \n                  id="Definitions_1" targetNamespace="http://bpmn.io/schema/bpmn">\n  <bpmn:process id="Process_'.concat(n.name.replace(/[^a-zA-Z0-9]/g,"_"),'" isExecutable="false">\n    <bpmn:startEvent id="StartEvent_1" name="Start">\n      <bpmn:outgoing>Flow_1</bpmn:outgoing>\n    </bpmn:startEvent>\n    <bpmn:task id="Task_1" name="').concat(e,'">\n      <bpmn:incoming>Flow_1</bpmn:incoming>\n      <bpmn:outgoing>Flow_2</bpmn:outgoing>\n    </bpmn:task>\n    <bpmn:endEvent id="EndEvent_1" name="End">\n      <bpmn:incoming>Flow_2</bpmn:incoming>\n    </bpmn:endEvent>\n    <bpmn:sequenceFlow id="Flow_1" sourceRef="StartEvent_1" targetRef="Task_1" />\n    <bpmn:sequenceFlow id="Flow_2" sourceRef="Task_1" targetRef="EndEvent_1" />\n  </bpmn:process>\n  <bpmndi:BPMNDiagram id="BPMNDiagram_1">\n    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="Process_').concat(n.name.replace(/[^a-zA-Z0-9]/g,"_"),'">\n      <bpmndi:BPMNShape id="StartEvent_1_di" bpmnElement="StartEvent_1">\n        <dc:Bounds x="152" y="82" width="36" height="36" />\n        <bpmndi:BPMNLabel>\n          <dc:Bounds x="158" y="125" width="24" height="14" />\n        </bpmndi:BPMNLabel>\n      </bpmndi:BPMNShape>\n      <bpmndi:BPMNShape id="Task_1_di" bpmnElement="Task_1">\n        <dc:Bounds x="250" y="60" width="100" height="80" />\n      </bpmndi:BPMNShape>\n      <bpmndi:BPMNShape id="EndEvent_1_di" bpmnElement="EndEvent_1">\n        <dc:Bounds x="402" y="82" width="36" height="36" />\n        <bpmndi:BPMNLabel>\n          <dc:Bounds x="410" y="125" width="20" height="14" />\n        </bpmndi:BPMNLabel>\n      </bpmndi:BPMNShape>\n      <bpmndi:BPMNEdge id="Flow_1_di" bpmnElement="Flow_1">\n        <di:waypoint x="188" y="100" />\n        <di:waypoint x="250" y="100" />\n      </bpmndi:BPMNEdge>\n      <bpmndi:BPMNEdge id="Flow_2_di" bpmnElement="Flow_2">\n        <di:waypoint x="350" y="100" />\n        <di:waypoint x="402" y="100" />\n      </bpmndi:BPMNEdge>\n    </bpmndi:BPMNPlane>\n  </bpmndi:BPMNDiagram>\n</bpmn:definitions>')}}console.log("\ud83d\udd27 BPMNPreview: Creating BPMN viewer..."),console.log("\ud83d\udd0d BPMNPreview: About to create viewer with BPMN content length:",null===(d=I)||void 0===d?void 0:d.length);const W=await(0,c._Q)();a.current=W,console.log("\u2705 BPMNPreview: BPMN viewer instance created successfully");const V=W.get("eventBus");console.log("\ud83c\udfa7 BPMNPreview: Setting up bpmn-js event listeners..."),V.on("import.done",e=>{var n;console.log("\ud83c\udf89 [BPMN Event] import.done:",{error:e.error,warnings:(null===(n=e.warnings)||void 0===n?void 0:n.length)||0})}),V.on("import.render.start",()=>{console.log("\ud83c\udfa8 [BPMN Event] import.render.start - Rendering began")}),V.on("import.render.complete",e=>{var n,i;console.log("\u2705 [BPMN Event] import.render.complete:",{duration:e.duration||"N/A",error:e.error});const o=W.get("canvas").viewbox(),t=null===(n=r.current)||void 0===n?void 0:n.querySelector("svg");console.log("\ud83d\udcca [Post-Render State]:",{viewbox:o,svgExists:!!t,svgVisibility:t?window.getComputedStyle(t).visibility:"N/A",svgOpacity:t?window.getComputedStyle(t).opacity:"N/A",svgDisplay:t?window.getComputedStyle(t).display:"N/A",svgChildCount:(null===t||void 0===t||null===(i=t.children)||void 0===i?void 0:i.length)||0})}),V.on("canvas.viewbox.changed",e=>{var n,i,o;console.log("\ud83d\udd04 [BPMN Event] canvas.viewbox.changed:",{viewbox:e.viewbox,outer:null===(n=e.viewbox)||void 0===n?void 0:n.outer,inner:null===(i=e.viewbox)||void 0===i?void 0:i.inner,scale:null===(o=e.viewbox)||void 0===o?void 0:o.scale})}),V.on("shape.added",e=>{var n,i,o,t,l,s;console.log("\u2795 [BPMN Event] shape.added:",{id:null===(n=e.element)||void 0===n?void 0:n.id,type:null===(i=e.element)||void 0===i?void 0:i.type,x:null===(o=e.element)||void 0===o?void 0:o.x,y:null===(t=e.element)||void 0===t?void 0:t.y,width:null===(l=e.element)||void 0===l?void 0:l.width,height:null===(s=e.element)||void 0===s?void 0:s.height})}),V.on("elements.changed",e=>{var n;console.log("\ud83d\udd27 [BPMN Event] elements.changed:",{elementCount:(null===(n=e.elements)||void 0===n?void 0:n.length)||0})});try{var h,g,w,b,P,y,f,N,B,M,x,_,S,E,A,F;console.log("\ud83d\udd17 BPMNPreview: Attaching viewer to container..."),console.log("\ud83d\udd0d BPMNPreview: Container element details:",{exists:!!r.current,className:null===(h=r.current)||void 0===h?void 0:h.className,width:null===(g=r.current)||void 0===g?void 0:g.offsetWidth,height:null===(w=r.current)||void 0===w?void 0:w.offsetHeight,parentExists:!(null===(b=r.current)||void 0===b||!b.parentElement)});const e=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e4;return new Promise((i,o)=>{setTimeout(()=>{o(new Error("".concat(e," timeout after ").concat(n,"ms")))},n)})},i=W.attachTo(r.current);await Promise.race([i,e("Viewer attach",5e3)]),console.log("\u2705 BPMNPreview: Successfully attached viewer to container"),console.log("\ud83d\udcca BPMNPreview: Importing BPMN XML..."),console.log("\ud83d\udd0d BPMNPreview: XML content preview (first 200 chars):",null===(P=I)||void 0===P?void 0:P.substring(0,200));const o=Date.now(),t=W.importXML(I),l=await Promise.race([t,e("XML import",15e3)]),s=Date.now()-o;console.log("\u2705 BPMNPreview: Successfully imported BPMN XML in ".concat(s,"ms")),console.log("\ud83d\udcca BPMNPreview: Import result details:",{warnings:(null===l||void 0===l||null===(y=l.warnings)||void 0===y?void 0:y.length)||0,hasWarnings:!(null===l||void 0===l||null===(f=l.warnings)||void 0===f||!f.length),warningDetails:null===l||void 0===l?void 0:l.warnings}),(null===l||void 0===l||null===(N=l.warnings)||void 0===N?void 0:N.length)>0&&console.warn("\u26a0\ufe0f BPMNPreview: Import warnings:",l.warnings),console.log("\ud83c\udfaf BPMNPreview: Fitting to viewport...");const a=W.get("canvas"),d=W.get("elementRegistry");console.log("\ud83d\udd0d BPMNPreview: Canvas service retrieved:",!!a),console.log("\ud83d\udd0d BPMNPreview: ElementRegistry retrieved:",!!d);const c=r.current?window.getComputedStyle(r.current):null;console.log("\ud83d\udce6 BPMNPreview: Container state:",{exists:!!r.current,dimensions:{offsetWidth:null===(B=r.current)||void 0===B?void 0:B.offsetWidth,offsetHeight:null===(M=r.current)||void 0===M?void 0:M.offsetHeight,clientWidth:null===(x=r.current)||void 0===x?void 0:x.clientWidth,clientHeight:null===(_=r.current)||void 0===_?void 0:_.clientHeight},visibility:{display:null===c||void 0===c?void 0:c.display,visibility:null===c||void 0===c?void 0:c.visibility,opacity:null===c||void 0===c?void 0:c.opacity},hasParent:!(null===(S=r.current)||void 0===S||!S.parentElement),isAttached:!!r.current&&document.body.contains(r.current)});const u=null===(E=r.current)||void 0===E?void 0:E.querySelector("svg"),m=u?window.getComputedStyle(u):null;console.log("\ud83d\udcd0 BPMNPreview: SVG state BEFORE zoom:",{exists:!!u,width:null===u||void 0===u?void 0:u.getAttribute("width"),height:null===u||void 0===u?void 0:u.getAttribute("height"),viewBox:null===u||void 0===u?void 0:u.getAttribute("viewBox"),inlineStyle:{display:null===u||void 0===u?void 0:u.style.display,visibility:null===u||void 0===u?void 0:u.style.visibility,opacity:null===u||void 0===u?void 0:u.style.opacity,width:null===u||void 0===u?void 0:u.style.width,height:null===u||void 0===u?void 0:u.style.height},computedStyle:m?{display:m.display,visibility:m.visibility,opacity:m.opacity,position:m.position,top:m.top,left:m.left}:null,childCount:(null===u||void 0===u||null===(A=u.children)||void 0===A?void 0:A.length)||0,transform:null===u||void 0===u||null===(F=u.querySelector("g"))||void 0===F?void 0:F.getAttribute("transform")});const p=async()=>{var e,n;if(console.log("\ud83d\udd04 BPMNPreview: Starting viewport initialization sequence..."),!await async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30;for(let n=0;n<e;n++){const i=d.getAll(),o=i.filter(e=>"bpmn:Process"!==e.type&&"bpmn:Collaboration"!==e.type&&!e.labelTarget);if(console.log("\ud83d\udd0d BPMNPreview: Element check attempt ".concat(n+1,"/").concat(e,":"),{totalElements:i.length,nonRootElements:o.length,elementTypes:[...new Set(i.map(e=>e.type))]}),o.length>0)return console.log("\u2705 BPMNPreview: Found diagram elements:",o.length),!0;await new Promise(e=>requestAnimationFrame(e))}return console.warn("\u26a0\ufe0f BPMNPreview: No diagram elements found after max attempts"),!1}())return console.error("\u274c BPMNPreview: Cannot initialize viewport - no elements found"),!1;const i=await async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30;for(let n=0;n<e;n++){const i=a.viewbox();if(console.log("\ud83d\udd0d BPMNPreview: Viewbox check attempt ".concat(n+1,"/").concat(e,":"),{outer:null===i||void 0===i?void 0:i.outer,inner:null===i||void 0===i?void 0:i.inner,hasValidOuter:!!(null!==i&&void 0!==i&&i.outer&&i.outer.width>0&&i.outer.height>0)}),null!==i&&void 0!==i&&i.outer&&i.outer.width>0&&i.outer.height>0)return console.log("\u2705 BPMNPreview: Canvas viewbox has valid bounds:",i.outer),i;await new Promise(e=>requestAnimationFrame(e))}return console.warn("\u26a0\ufe0f BPMNPreview: Canvas viewbox never got valid bounds"),null}();if(!i)return console.error("\u274c BPMNPreview: Cannot initialize viewport - invalid viewbox"),!1;const o=(null===(e=r.current)||void 0===e?void 0:e.offsetWidth)||0,t=(null===(n=r.current)||void 0===n?void 0:n.offsetHeight)||0;if(0===o||0===t)return console.error("\u274c BPMNPreview: Container has invalid dimensions:",{containerWidth:o,containerHeight:t}),!1;console.log("\ud83d\udcd0 BPMNPreview: Calculating manual viewport..."),console.log("\ud83d\udcca BPMNPreview: Input data:",{containerWidth:o,containerHeight:t,diagramBounds:i.outer});const l=i.outer.width,s=i.outer.height,c=o/(l+40),u=t/(s+40),v=Math.min(c,u,1),m=l*v,p=s*v,h={x:i.outer.x-(o/v-l)/2,y:i.outer.y-(t/v-s)/2,width:o/v,height:t/v};console.log("\ud83d\udcca BPMNPreview: Manual viewport calculated:",{scale:v,scaleX:c,scaleY:u,scaledDimensions:{width:m,height:p},viewbox:h});try{console.log("\ud83c\udfaf BPMNPreview: Attempting automatic fit-viewport..."),a.zoom("fit-viewport"),await new Promise(e=>requestAnimationFrame(e));const e=a.zoom(),n=a.viewbox();return console.log("\u2705 BPMNPreview: Automatic zoom applied:",{zoom:e,viewbox:n,isIdentityMatrix:1===e&&1===(null===n||void 0===n?void 0:n.scale)}),1!==e&&n&&1!==n.scale||(console.warn("\u26a0\ufe0f BPMNPreview: Automatic zoom failed (identity matrix), applying manual viewbox..."),a.viewbox(h),console.log("\u2705 BPMNPreview: Manual viewbox applied")),!0}catch(g){console.error("\u274c BPMNPreview: Zoom operation failed:",g);try{return console.log("\ud83d\udd04 BPMNPreview: Falling back to manual viewbox..."),a.viewbox(h),console.log("\u2705 BPMNPreview: Manual viewbox applied as fallback"),!0}catch(w){return console.error("\u274c BPMNPreview: Manual viewbox also failed:",w),!1}}};requestAnimationFrame(()=>{requestAnimationFrame(async()=>{await p()?console.log("\u2705 BPMNPreview: Viewport initialization completed successfully"):console.error("\u274c BPMNPreview: Viewport initialization failed completely")})});const C=()=>{requestAnimationFrame(()=>{var e;const n=null===(e=r.current)||void 0===e?void 0:e.querySelector("svg"),i=n?window.getComputedStyle(n):null;console.log("\ud83d\udc41\ufe0f BPMNPreview: Checking SVG visibility:",{exists:!!n,inlineStyle:{display:null===n||void 0===n?void 0:n.style.display,visibility:null===n||void 0===n?void 0:n.style.visibility,opacity:null===n||void 0===n?void 0:n.style.opacity},computedStyle:i?{display:i.display,visibility:i.visibility,opacity:i.opacity}:null}),n&&(n.style.opacity&&"0"!==n.style.opacity||(n.style.opacity="1"),"hidden"===n.style.visibility&&(n.style.visibility="visible"),"none"===n.style.display&&(n.style.display="block"),console.log("\u2705 BPMNPreview: SVG visibility ensured"))})};setTimeout(C,100),setTimeout(C,300),setTimeout(()=>{var e,n,i,o,t,l,s,d,c,u,v,m,p,h,g,w,b,P;const y=a.viewbox(),f=a.zoom(),N=null===(e=r.current)||void 0===e?void 0:e.querySelector("svg"),B=(null===N||void 0===N?void 0:N.querySelectorAll("g"))||[],M=(null===N||void 0===N?void 0:N.querySelectorAll("[data-element-id]"))||[],x=(null===N||void 0===N||null===(n=N.querySelector("g.viewport"))||void 0===n?void 0:n.getAttribute("transform"))||"not found",_=N?window.getComputedStyle(N):null;console.log("\ud83d\udd0d BPMNPreview: Final rendering state:",{viewbox:{outer:null===y||void 0===y?void 0:y.outer,inner:null===y||void 0===y?void 0:y.inner,scale:null===y||void 0===y?void 0:y.scale,x:null===y||void 0===y?void 0:y.x,y:null===y||void 0===y?void 0:y.y,width:null===y||void 0===y?void 0:y.width,height:null===y||void 0===y?void 0:y.height},zoom:{level:f,isIdentity:1===f},svg:{exists:!!N,width:null===N||void 0===N?void 0:N.getAttribute("width"),height:null===N||void 0===N?void 0:N.getAttribute("height"),viewBox:null===N||void 0===N?void 0:N.getAttribute("viewBox"),childCount:(null===N||void 0===N||null===(i=N.children)||void 0===i?void 0:i.length)||0,gElementCount:B.length,shapeElementCount:M.length,viewportTransform:x,inlineStyle:{display:null===N||void 0===N?void 0:N.style.display,visibility:null===N||void 0===N?void 0:N.style.visibility,opacity:null===N||void 0===N?void 0:N.style.opacity},computedStyle:_?{display:_.display,visibility:_.visibility,opacity:_.opacity,backgroundColor:_.backgroundColor,fill:_.fill}:null},container:{hasChildren:(null===(o=r.current)||void 0===o||null===(t=o.children)||void 0===t?void 0:t.length)||0,dimensions:{offsetWidth:null===(l=r.current)||void 0===l?void 0:l.offsetWidth,offsetHeight:null===(s=r.current)||void 0===s?void 0:s.offsetHeight,scrollWidth:null===(d=r.current)||void 0===d?void 0:d.scrollWidth,scrollHeight:null===(c=r.current)||void 0===c?void 0:c.scrollHeight},style:{display:null===(u=r.current)||void 0===u?void 0:u.style.display,visibility:null===(v=r.current)||void 0===v?void 0:v.style.visibility,backgroundColor:null===(m=r.current)||void 0===m?void 0:m.style.backgroundColor},computedStyle:r.current?{display:window.getComputedStyle(r.current).display,visibility:window.getComputedStyle(r.current).visibility,backgroundColor:window.getComputedStyle(r.current).backgroundColor}:null},hasElements:(null===y||void 0===y||null===(p=y.inner)||void 0===p?void 0:p.width)>0&&(null===y||void 0===y||null===(h=y.inner)||void 0===h?void 0:h.height)>0,containerHasContent:(null===(g=r.current)||void 0===g||null===(w=g.children)||void 0===w?void 0:w.length)>0,transformIsIdentity:x.includes("matrix(1, 0, 0, 1, 0, 0)")||x.includes("matrix(1,0,0,1,0,0)")}),0===(null===(b=r.current)||void 0===b||null===(P=b.children)||void 0===P?void 0:P.length)?console.error("\u274c BPMNPreview: Container is EMPTY after rendering - CRITICAL ISSUE"):N?0===M.length?console.warn("\u26a0\ufe0f BPMNPreview: SVG exists but has no BPMN shape elements - possible rendering issue"):x.includes("matrix(1, 0, 0, 1, 0, 0)")||x.includes("matrix(1,0,0,1,0,0)")?console.warn("\u26a0\ufe0f BPMNPreview: Viewport transform is identity matrix - zoom may not have worked properly"):console.log("\u2705 BPMNPreview: Diagram appears to be properly rendered with ".concat(M.length," shapes and valid transform")):console.error("\u274c BPMNPreview: No SVG element found after rendering - CRITICAL ISSUE")},1e3),console.log("\ud83c\udf89 BPMNPreview: Successfully rendered preview for: ".concat(n.name)),v(!1)}catch(z){var C,D,k,j,R,L;console.error("\u274c BPMNPreview: Failed to import BPMN XML:",z),console.error("\ud83d\udd0d BPMNPreview: Import error details:",{message:z.message,stack:z.stack,fileName:n.name,xmlLength:null===(C=I)||void 0===C?void 0:C.length,xmlPreview:null===(D=I)||void 0===D?void 0:D.substring(0,300),containerState:{exists:!!r.current,hasChildren:(null===(k=r.current)||void 0===k||null===(j=k.children)||void 0===j?void 0:j.length)||0,clientHeight:null===(R=r.current)||void 0===R?void 0:R.clientHeight,clientWidth:null===(L=r.current)||void 0===L?void 0:L.clientWidth}}),p("Failed to load preview: ".concat(z.message)),v(!1)}}catch(q){console.error("\u274c BPMNPreview: Failed to render BPMN preview:",q.message||q),console.log("\ud83d\udd0d BPMNPreview: Error details:",{fileName:n.name,filePath:n.path,errorMessage:q.message,errorStack:q.stack}),p("Failed to load preview"),v(!1)}};e()})()):(console.log("\u23ed\ufe0f BPMNPreview: Skipping loadPreview, missing props:",{hasFile:!!n,hasRepository:!!i,fileName:null===n||void 0===n?void 0:n.name}),v(!1)),()=>{if(a.current){try{a.current.destroy()}catch(e){console.warn("Error cleaning up BPMN viewer:",e)}a.current=null}}),[n,i,t,s]),(0,u.jsxs)("div",{className:"bpmn-preview",children:[d&&(0,u.jsxs)("div",{className:"preview-loading",children:[(0,u.jsx)("div",{className:"preview-spinner"}),(0,u.jsx)("span",{children:"Loading preview..."})]}),m&&(0,u.jsx)("div",{className:"preview-error",children:(0,u.jsxs)("span",{children:["\u274c ",m]})}),(0,u.jsx)("div",{className:"preview-container",ref:r,style:{display:d||m?"none":"block"}})]})},m=()=>{var e;const n=(0,t.zy)(),i=(0,t.Zp)(),{profile:s,repository:c,selectedBranch:m,loading:p,error:h}=r();console.log("\ud83d\ude80 BusinessProcessSelection: Hook data received:",{hasProfile:!!s,hasRepository:!!c,profileLogin:null===s||void 0===s?void 0:s.login,repositoryName:null===c||void 0===c?void 0:c.name,repositoryFullName:null===c||void 0===c?void 0:c.full_name,repositoryOwner:null===c||void 0===c||null===(e=c.owner)||void 0===e?void 0:e.login,selectedBranch:m,dakLoading:p,dakError:h});const{component:g}=n.state||{},[w,b]=(0,o.useState)([]),[P,y]=(0,o.useState)(!0),[f,N]=(0,o.useState)(null),[B,M]=(0,o.useState)(!1);(0,o.useEffect)(()=>{(async()=>{if(c&&s)try{var e;const n=s.token&&(null===(e=c.permissions)||void 0===e?void 0:e.push);M(n||!1)}catch(f){console.warn("Could not check write permissions:",f),M(!1)}})()},[c,s]),(0,o.useEffect)(()=>{(async()=>{if(c)try{var e,n,o,t;y(!0),N(null),console.log("\ud83d\udcc2 BusinessProcessSelection - Repository object analysis:",{name:c.name,full_name:c.full_name,owner:c.owner,ownerLogin:null===(e=c.owner)||void 0===e?void 0:e.login,isDemo:c.isDemo,html_url:c.html_url,default_branch:c.default_branch}),console.log("\ud83d\udc64 BusinessProcessSelection - Profile object analysis:",{login:null===s||void 0===s?void 0:s.login,name:null===s||void 0===s?void 0:s.name,isDemo:null===s||void 0===s?void 0:s.isDemo,type:null===s||void 0===s?void 0:s.type});const i=(null===(n=c.owner)||void 0===n?void 0:n.login)||c.full_name.split("/")[0],r=c.name,a=m||"main";console.log("\ud83d\udccb BusinessProcessSelection: Derived repository info:",{original_owner_login:null===(o=c.owner)||void 0===o?void 0:o.login,original_full_name:c.full_name,derived_owner:i,derived_repoName:r,selected_ref:a,derivation_method:null!==(t=c.owner)&&void 0!==t&&t.login?"owner.login":"full_name.split"}),console.log("\ud83d\udd0d BusinessProcessSelection: About to fetch BPMN files from ".concat(i,"/").concat(r," (branch: ").concat(a,")")),console.log("BusinessProcessSelection: Final repository access details:",{derivedOwner:i,repositoryName:r,ref:a,fullRepositoryData:{name:c.name,full_name:c.full_name,owner:c.owner,default_branch:c.default_branch}});const d=await l.A.getBpmnFiles(i,r,a);if(console.log("\ud83d\udcca BusinessProcessSelection: Received BPMN files:",{count:d.length,files:d.map(e=>{var n;return{name:e.name,path:e.path,size:e.size,hasDownloadUrl:!!e.download_url,sha:null===(n=e.sha)||void 0===n?void 0:n.substring(0,8)}})}),0===d.length&&null!==s&&void 0!==s&&s.isDemo){console.log("No BPMN files found in demo mode, providing fallback demo files");b([{name:"patient-registration.bpmn",path:"demo/business-processes/patient-registration.bpmn",sha:"demo-sha-1",size:2048,download_url:"#",html_url:"#"},{name:"vaccination-workflow.bpmn",path:"demo/business-processes/vaccination-workflow.bpmn",sha:"demo-sha-2",size:3072,download_url:"#"},{name:"appointment-scheduling.bpmn",path:"demo/business-processes/appointment-scheduling.bpmn",sha:"demo-sha-3",size:1536,download_url:"#"}])}else b(d);y(!1)}catch(a){var r;if(console.error("Failed to fetch BPMN files from repository:",a),null!==s&&void 0!==s&&s.isDemo||null!==(r=a.message)&&void 0!==r&&r.includes("Failed to fetch")){console.log("Providing fallback demo BPMN files");return b([{name:"patient-registration.bpmn",path:"demo/business-processes/patient-registration.bpmn",sha:"demo-sha-1",size:2048,download_url:"#",html_url:"#"},{name:"vaccination-workflow.bpmn",path:"demo/business-processes/vaccination-workflow.bpmn",sha:"demo-sha-2",size:3072,download_url:"#"},{name:"appointment-scheduling.bpmn",path:"demo/business-processes/appointment-scheduling.bpmn",sha:"demo-sha-3",size:1536,download_url:"#"}]),void y(!1)}401===a.status||403===a.status?N("Authentication required to access this repository. Please ensure you have a valid GitHub token with appropriate permissions."):404===a.status?N("Repository or branch not found. Please check the repository name and branch."):N("Failed to load BPMN files from repository: ".concat(a.message)),b([]),y(!1)}else i("/")})()},[s,c,i,m]);return p?(0,u.jsx)("div",{className:"business-process-selection loading-state",children:(0,u.jsxs)("div",{className:"loading-content",children:[(0,u.jsx)("h2",{children:"Loading DAK Data..."}),(0,u.jsx)("p",{children:"Fetching repository and user data..."})]})}):h?(0,u.jsx)("div",{className:"business-process-selection error-state",children:(0,u.jsxs)("div",{className:"error-content",children:[(0,u.jsx)("h2",{children:"Error Loading DAK Data"}),(0,u.jsx)("p",{children:h}),(0,u.jsxs)("div",{className:"error-actions",children:[(0,u.jsx)("button",{onClick:()=>i("/"),className:"action-btn primary",children:"Return to Home"}),(0,u.jsx)("button",{onClick:()=>window.location.reload(),className:"action-btn secondary",children:"Retry"})]})]})}):s&&c?(0,u.jsx)(a.Mx,{pageName:"business-process-selection",children:(0,u.jsx)("div",{className:"business-process-selection",children:(0,u.jsx)("div",{className:"selection-content",children:(0,u.jsxs)("div",{className:"selection-main",children:[(0,u.jsxs)("div",{className:"selection-intro",children:[(0,u.jsx)("h2",{children:"Business Process Files"}),(0,u.jsxs)("p",{children:["Select a BPMN business process file to view, edit, or examine the source code. Files are loaded from ",(0,u.jsx)("code",{children:"input/business-processes/"})," or ",(0,u.jsx)("code",{children:"input/business-process/"})," directories and subdirectories."]})]}),P?(0,u.jsxs)("div",{className:"loading",children:[(0,u.jsx)("div",{className:"spinner"}),(0,u.jsx)("p",{children:"Loading business process files..."})]}):f?(0,u.jsx)("div",{className:"error",children:(0,u.jsxs)("p",{children:["\u274c ",f]})}):0===w.length?(0,u.jsxs)("div",{className:"empty-state",children:[(0,u.jsx)("div",{className:"empty-icon",children:"\ud83d\udccb"}),(0,u.jsx)("h3",{children:"No BPMN Files Found"}),(0,u.jsx)("p",{children:"No .bpmn files were found in the input/business-processes/ or input/business-process/ directories."})]}):(0,u.jsx)("div",{className:"files-grid",children:w.map(e=>(0,u.jsxs)("div",{className:"file-card",children:[(0,u.jsx)(v,{file:e,repository:c,selectedBranch:m,profile:s}),(0,u.jsxs)("div",{className:"file-header",children:[(0,u.jsx)("div",{className:"file-icon",children:"\ud83d\udd04"}),(0,u.jsx)("div",{className:"file-details",children:(0,u.jsxs)("h3",{className:"file-name",children:[e.name," \xb7 ",(e.size/1024).toFixed(1)," KB"]})})]}),(0,u.jsxs)("div",{className:"file-actions",children:[(0,u.jsx)("button",{className:"action-btn view-btn",onClick:n=>((e,n)=>{var o;const t=(null===(o=c.owner)||void 0===o?void 0:o.login)||c.full_name.split("/")[0],l=c.name,r=m||"main",a="/bpmn-viewer/".concat(t,"/").concat(l,"/").concat(r,"/").concat(n.path),u={profile:s,repository:c,component:g,selectedFile:n,selectedBranch:m,mode:"view"};(0,d.hX)(e,a,i,u)})(n,e),title:"View BPMN diagram (read-only)",children:"\ud83d\udc41\ufe0f View"}),(0,u.jsx)("button",{className:"action-btn edit-btn ".concat(B?"":"disabled"),onClick:n=>((e,n)=>{var o;if(!B)return void alert("You need write permissions to edit BPMN files. Please check your GitHub token permissions.");const t=(null===(o=c.owner)||void 0===o?void 0:o.login)||c.full_name.split("/")[0],l=c.name,r=m||"main",a="/bpmn-editor/".concat(t,"/").concat(l,"/").concat(r,"/").concat(n.path),u={profile:s,repository:c,component:g,selectedFile:n,selectedBranch:m,mode:"edit"};(0,d.hX)(e,a,i,u)})(n,e),title:B?"Edit BPMN diagram":"Edit access required",disabled:!B,children:"\u270f\ufe0f Edit"}),(0,u.jsx)("button",{className:"action-btn source-btn",onClick:n=>((e,n)=>{var o;const t=(null===(o=c.owner)||void 0===o?void 0:o.login)||c.full_name.split("/")[0],l=c.name,r=m||"main",a="/bpmn-source/".concat(t,"/").concat(l,"/").concat(r,"/").concat(n.path),u={profile:s,repository:c,component:g,selectedFile:n,selectedBranch:m};(0,d.hX)(e,a,i,u)})(n,e),title:"View XML source code",children:"\ud83d\udcc4 Source"})]})]},e.sha))})]})})})}):(i("/"),(0,u.jsx)("div",{children:"Redirecting..."}))}},96143:(e,n,i)=>{i.d(n,{Cq:()=>t,Ub:()=>l,_Q:()=>s});var o=i(57335);async function t(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new(await(0,o.sN)())(e)}async function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new(await(0,o.uW)())(e)}async function s(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new(await(0,o.M3)())(e)}}}]);