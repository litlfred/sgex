"use strict";(self.webpackChunksgex_workbench=self.webpackChunksgex_workbench||[]).push([[5897],{55897:(e,a,n)=>{n.r(a),n.d(a,{default:()=>m});var i=n(89379),o=n(9950),s=n(85001),t=n(67818),r=n(29946),l=n(29473),c=n(42676),d=n(1932),u=n(63609);const h=e=>{if(!e)return!1;if(!0===e.isSAMLError)return!0;const a=e.message||"",n=a.toLowerCase();return 403===e.status&&(n.includes("saml enforcement")||n.includes("saml single sign-on")||n.includes("saml authorization required")||a.includes("must grant your Personal Access token access to this organization"))},g=e=>"https://github.com/orgs/".concat(e,"/sso");var p=n(44414);const m=()=>{const{t:e}=(0,t.Bd)(),[a,n]=(0,o.useState)(null),[m,f]=(0,o.useState)([]),[A,v]=(0,o.useState)(!1),[x,z]=(0,o.useState)(!1),[j,b]=(0,o.useState)(null),[S,O]=(0,o.useState)({}),[N,w]=(0,o.useState)(null),[L,y]=(0,o.useState)({isOpen:!1,errorInfo:null}),k=(0,s.Zp)(),M=(0,s.zy)(),H=(0,o.useCallback)((e,a)=>{if(!r.A.isAuth())return;const n={};if(e){const a=l.A.getCachedRepositories(e.login,"user");a&&a.repositories&&(n["user-".concat(e.login)]=a.repositories.length)}a.forEach(e=>{const a=l.A.getCachedRepositories(e.login,"org");a&&a.repositories&&(n["org-".concat(e.login)]=a.repositories.length)}),O(n)},[]),W=(0,o.useCallback)(async()=>{z(!0),b(null);try{let a=null;A?(await r.A.checkTokenPermissions(),a=await r.A.getCurrentUser(),n(a)):(a=null,n(null));let o=[];if(A)try{o=await r.A.getUserOrganizations()}catch(j){console.error("Error fetching organizations:",j),o=[]}try{const e=await r.A.getWHOOrganization(),a=o.findIndex(e=>"WorldHealthOrganization"===e.login);a>=0?o[a]=(0,i.A)((0,i.A)((0,i.A)({},o[a]),e),{},{isWHO:!0}):o.unshift(e)}catch(e){console.warn("Could not fetch WHO organization data:",e),h(e)&&(console.log("SAML authorization available for WHO organization"),w("SAML authorization available for WHO organization. Click the organization to authorize access."));const a={id:"who-organization",login:"WorldHealthOrganization",name:"World Health Organization",description:"The World Health Organization is a specialized agency of the United Nations responsible for international public health.",avatar_url:"https://avatars.githubusercontent.com/u/12261302?s=200&v=4",html_url:"https://github.com/WorldHealthOrganization",type:"Organization",isWHO:!0,needsSAMLAuth:h(e)};o.some(e=>"WorldHealthOrganization"===e.login)?o=o.map(a=>"WorldHealthOrganization"===a.login?(0,i.A)((0,i.A)({},a),{},{isWHO:!0,needsSAMLAuth:h(e)}):a):o.unshift(a)}f(o),A&&H(a,o)}catch(j){console.error("Error fetching user data:",j),A?(b("Failed to fetch user data. Please check your connection and try again."),v(!1),r.A.logout()):b("Unable to fetch additional data. Some features may be limited.")}finally{z(!1)}},[H,A]),C=e=>{const a=function(e,a){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{isRequired:i=!1,context:o="access organization data"}=n;return{type:"saml_enforcement",organization:a,isRequired:i,context:o,authorizationURL:g(a),documentationURL:"https://docs.github.com/articles/authenticating-to-a-github-organization-with-saml-single-sign-on/",title:i?"SAML Authorization Required":"SAML Authorization Available",message:i?"Access to ".concat(a," requires SAML authorization to ").concat(o,"."):"Your Personal Access Token can be authorized for ".concat(a," to ").concat(o,"."),instructions:['Click the "Authorize SAML" button to open GitHub\'s authorization page',"Sign in to your organization's SAML identity provider if prompted",'Click "Authorize" to grant your Personal Access Token access to '.concat(a),"Return to SGEX Workbench and retry your action"],severity:i?"error":"warning"}}(new Error("SAML authorization required"),e,{isRequired:!1,context:"access additional organization features"});y({isOpen:!0,errorInfo:a})};(0,o.useEffect)(()=>{(()=>{const e=r.A.initializeFromStoredToken();v(!!e)})()},[]),(0,o.useEffect)(()=>{var e;null!==(e=M.state)&&void 0!==e&&e.warningMessage&&(w(M.state.warningMessage),k(M.pathname,{replace:!0,state:{}}))},[M.state,k,M.pathname]),(0,o.useEffect)(()=>{x||W()},[W,x]);const E=(e,a)=>{if(a.needsSAMLAuth&&A)return e.preventDefault(),void C(a.login);const n={profile:a};(0,d.hX)(e,"/dak-action/".concat(a.login),k,n)};return(0,p.jsxs)(c.Mx,{pageName:"select-profile",children:[x&&!a?(0,p.jsxs)("div",{className:"loading-section",children:[(0,p.jsx)("div",{className:"spinner"}),(0,p.jsx)("p",{children:"Loading profile data..."})]}):(0,p.jsxs)("div",{className:"select-profile-content",children:[N&&(0,p.jsx)("div",{className:"warning-message",children:(0,p.jsxs)("div",{className:"warning-content",children:[(0,p.jsxs)("div",{className:"warning-header",children:[(0,p.jsx)("span",{className:"warning-icon",children:"\u26a0\ufe0f"}),(0,p.jsx)("span",{className:"warning-text",children:N})]}),(0,p.jsx)("button",{className:"warning-dismiss",onClick:()=>{w(null)},"aria-label":"Dismiss warning",children:"\xd7 Dismiss"})]})}),!A&&(0,p.jsx)("div",{className:"auth-status-message",children:(0,p.jsxs)("div",{className:"auth-status-content",children:[(0,p.jsx)("span",{className:"auth-status-icon",children:"\ud83d\udd13"}),(0,p.jsx)("span",{className:"auth-status-text",children:"You are browsing in unauthenticated mode. Some features like saving to GitHub will be disabled, but you can still explore and use local staging."})]})}),x?(0,p.jsxs)("div",{className:"loading-section",children:[(0,p.jsx)("div",{className:"spinner"}),(0,p.jsx)("p",{children:"Loading profile data..."})]}):(0,p.jsxs)("div",{className:"profile-selection",children:[(0,p.jsx)("h2",{children:e("organization.select")}),(0,p.jsxs)("p",{children:[e("organization.personal"),":"]}),j&&(0,p.jsx)("div",{className:"error-message",children:j}),(0,p.jsxs)("div",{className:"profile-grid-horizontal",children:[A&&a&&(0,p.jsxs)("div",{className:"profile-card",onClick:e=>E(e,(0,i.A)({type:"user"},a)),children:[(0,p.jsxs)("div",{className:"profile-card-header",children:[(0,p.jsx)("img",{src:null===a||void 0===a?void 0:a.avatar_url,alt:"Personal profile"}),S["user-".concat(null===a||void 0===a?void 0:a.login)]>0&&(0,p.jsx)("div",{className:"dak-count-badge",children:S["user-".concat(null===a||void 0===a?void 0:a.login)]})]}),(0,p.jsx)("h3",{children:(null===a||void 0===a?void 0:a.name)||(null===a||void 0===a?void 0:a.login)}),(0,p.jsx)("p",{children:"Personal repositories"}),(0,p.jsx)("div",{className:"profile-badges",children:(0,p.jsx)("span",{className:"profile-type",children:"Personal"})})]}),m.map(a=>("WorldHealthOrganization"===a.login&&console.log("WHO Organization Badge Debug:",{orgLogin:a.login,needsSAMLAuth:a.needsSAMLAuth,isAuthenticated:A,shouldShowBadge:a.needsSAMLAuth&&A,orgObject:a}),(0,p.jsxs)("div",{className:"profile-card ".concat(a.isWHO?"who-org":""," ").concat(a.needsSAMLAuth?"needs-saml":""),onClick:e=>E(e,(0,i.A)({type:"org"},a)),children:[(0,p.jsxs)("div",{className:"profile-card-header",children:[(0,p.jsx)("img",{src:a.avatar_url||"https://github.com/".concat(a.login,".png"),alt:"".concat(a.name||a.login," organization")}),S["org-".concat(a.login)]>0&&(0,p.jsx)("div",{className:"dak-count-badge",children:S["org-".concat(a.login)]}),a.needsSAMLAuth&&A&&(0,p.jsx)("div",{className:"saml-indicator",title:"SAML authorization available",children:"\ud83d\udd10"})]}),(0,p.jsx)("h3",{children:a.name||a.login}),(0,p.jsxs)("p",{children:["@",a.login]}),(0,p.jsxs)("div",{className:"profile-badges",children:[(0,p.jsx)("span",{className:"profile-type",children:e("organization.organizations")}),a.isWHO&&(0,p.jsx)("span",{className:"who-badge",children:"WHO Official"}),a.needsSAMLAuth&&A&&(0,p.jsx)("span",{className:"saml-badge",children:"SAML Available"})]})]},a.login)))]})]})]}),(0,p.jsx)(u.A,{isOpen:L.isOpen,onClose:()=>y({isOpen:!1,errorInfo:null}),samlErrorInfo:L.errorInfo,onRetry:()=>{var e;return(async e=>{try{const a=await r.A.getWHOOrganization();f(n=>n.map(n=>n.login===e?(0,i.A)((0,i.A)((0,i.A)({},n),a),{},{needsSAMLAuth:!1}):n)),w(null),y({isOpen:!1,errorInfo:null}),console.log("Successfully authorized SAML for ".concat(e))}catch(j){if(h(j))return void console.log("SAML authorization still pending for ".concat(e,". This is normal - authorization may take a few moments to propagate."));console.error("Unexpected error during SAML authorization verification:",j),y({isOpen:!1,errorInfo:null})}})(null===(e=L.errorInfo)||void 0===e?void 0:e.organization)},onSkip:()=>{y({isOpen:!1,errorInfo:null}),w(null)}})]})}}}]);