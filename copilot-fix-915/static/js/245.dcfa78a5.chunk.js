"use strict";(self.webpackChunksgex_workbench=self.webpackChunksgex_workbench||[]).push([[245],{50245:(e,n,t)=>{t.r(n),t.d(n,{default:()=>c});var i=t(9950),s=t(84699),a=t(38659),r=t(44414);const o=e=>{let{bpmnFile:n,printMode:t=!1}=e;(0,i.useRef)(null);const s=(0,i.useRef)(null),[o,c]=(0,i.useState)(null),[d,p]=(0,i.useState)(!0),[m,h]=(0,i.useState)(null),[u,g]=(0,i.useState)(null);(0,i.useEffect)(()=>(s.current&&(async()=>{try{if(p(!0),h(null),!n.content)throw new Error("No BPMN content provided");const e=new(await(0,a._Q)())({container:s.current,width:"100%",height:"400px"});if(await e.importXML(n.content),c(e),t){const t=v(e,n.content);g(t)}p(!1)}catch(e){console.error("Error initializing BPMN viewer:",e),h(e.message),p(!1)}})(),()=>{o&&o.destroy()}),[n.content,t]);const v=(e,n)=>{try{const n=e.get("canvas").viewbox(),t=60,i=794-2*t,s=1123-2*t,a=Math.ceil(n.width/i),r=Math.ceil(n.height/s),o=[];for(let e=0;e<r;e++)for(let t=0;t<a;t++){const r={x:n.x+t*i,y:n.y+e*s,width:Math.min(i,n.width-t*i),height:Math.min(s,n.height-e*s)};o.push({pageNumber:e*a+t+1,viewport:r,gridPosition:{x:t,y:e}})}return{totalPages:o.length,pages:o,originalViewbox:n}}catch(t){return console.warn("Could not calculate BPMN page layout:",t),{totalPages:1,pages:[{pageNumber:1,viewport:null,gridPosition:{x:0,y:0}}],originalViewbox:null}}};return d?(0,r.jsxs)("div",{className:"bpmn-diagram-container",children:[(0,r.jsx)("div",{className:"bpmn-diagram-title",children:n.name}),(0,r.jsx)("div",{className:"bpmn-loading",children:(0,r.jsx)("p",{children:"Loading BPMN diagram..."})})]}):m?(0,r.jsxs)("div",{className:"bpmn-diagram-container",children:[(0,r.jsx)("div",{className:"bpmn-diagram-title",children:n.name}),(0,r.jsx)("div",{className:"bpmn-error",children:(0,r.jsxs)("p",{children:["Error loading BPMN diagram: ",m]})})]}):t&&u&&u.totalPages>1?(0,r.jsxs)("div",{className:"bpmn-publication",children:[(0,r.jsx)("h4",{children:n.name}),(0,r.jsxs)("p",{children:["This diagram is split across ",u.totalPages," pages for optimal printing."]}),u.pages.map((e,t)=>(0,r.jsxs)("div",{className:"bpmn-page",children:[(0,r.jsxs)("div",{className:"bpmn-page-header",children:[n.name," - Page ",e.pageNumber," of ",u.totalPages]}),(0,r.jsx)(l,{bpmnContent:n.content,viewport:e.viewport,pageNumber:e.pageNumber})]},t))]}):(0,r.jsxs)("div",{className:"bpmn-diagram-container",children:[(0,r.jsx)("div",{className:"bpmn-diagram-title",children:n.name}),(0,r.jsx)("div",{ref:s,className:"bpmn-diagram-viewer"})]})},l=e=>{let{bpmnContent:n,viewport:t,pageNumber:s}=e;const o=(0,i.useRef)(null),[l,c]=(0,i.useState)(null);return(0,i.useEffect)(()=>((async()=>{try{if(!o.current||!n)return;const e=new(await(0,a._Q)())({container:o.current,width:"100%",height:"350px"});if(await e.importXML(n),t){e.get("canvas").viewbox(t)}c(e)}catch(e){console.error("Error initializing BPMN segment viewer:",e)}})(),()=>{l&&l.destroy()}),[n,t]),(0,r.jsx)("div",{className:"bpmn-viewer-segment",children:(0,r.jsx)("div",{ref:o,className:"bpmn-segment-container"})})},c=()=>(0,r.jsx)(s.A,{componentType:"business-processes",renderFunction:(e,n)=>(0,r.jsx)("div",{className:"component-content",children:(0,r.jsxs)("div",{className:"component-section",children:[(0,r.jsx)("h3",{children:"Business Processes and Workflows"}),(0,r.jsx)("p",{children:"This section contains BPMN (Business Process Model and Notation) diagrams that define the clinical workflows and business processes for this Digital Adaptation Kit."}),null!==e&&void 0!==e&&e.bpmnFiles&&e.bpmnFiles.length>0?(0,r.jsx)("div",{className:"bpmn-content",children:e.bpmnFiles.map((e,n)=>(0,r.jsx)(o,{bpmnFile:e,printMode:!0},n))}):(0,r.jsx)("div",{className:"no-content",children:(0,r.jsx)("p",{children:"No BPMN files found in this repository."})})]})}),title:"Business Processes and Workflows",printMode:!0})},84699:(e,n,t)=>{t.d(n,{A:()=>c});var i=t(9950),s=t(85001),a=t(90584),r=t(29946),o=t(44414);const l=async(e,n)=>{try{alert("EPUB generation will be implemented in the next phase. Current focus is on HTML publication views.")}catch(t){console.error("Error generating EPUB:",t),alert("Failed to generate EPUB publication")}},c=e=>{var n,t,c,d;let{componentType:p,renderFunction:m,title:h,printMode:u=!1}=e;const g=(0,s.zy)(),v=(0,a.oc)(),{user:b,repo:x,branch:w}=(0,s.g)(),j=(null===v||void 0===v?void 0:v.profile)||(null===(n=g.state)||void 0===n?void 0:n.profile),N=(null===v||void 0===v?void 0:v.repository)||(null===(t=g.state)||void 0===t?void 0:t.repository),f=(null===v||void 0===v?void 0:v.branch)||w||(null===(c=g.state)||void 0===c?void 0:c.selectedBranch),[y,P]=(0,i.useState)(!0),[M,F]=(0,i.useState)(null),[B,C]=(0,i.useState)(null),[k,E]=(0,i.useState)(null);(0,i.useEffect)(()=>{(async()=>{try{var e,n;if(P(!0),F(null),!j||!N)throw new Error("Missing required profile or repository information");const t=(null===(e=N.owner)||void 0===e?void 0:e.login)||(null===(n=N.full_name)||void 0===n?void 0:n.split("/")[0]),i=N.name,[s,a]=await Promise.allSettled([r.A.getRepository(t,i),r.A.getFileContent(t,i,"sushi-config.yaml",f)]);E({repository:"fulfilled"===s.status?s.value:N,owner:t,repoName:i,branch:f,sushiConfig:"fulfilled"===a.status?a.value:null,generatedAt:(new Date).toISOString(),component:p});let o=null;switch(p){case"business-processes":o=await S(t,i,f);break;case"decision-support":o=await A(t,i,f);break;case"core-data-dictionary":o=await W(t,i,f);break;case"testing":o=await D(t,i,f);break;case"actors":o=await R(t,i,f);break;default:o={message:"Component type not yet implemented"}}C(o),P(!1)}catch(t){console.error("Error loading publication data:",t),F(t.message),P(!1)}})()},[j,N,f,p]);const S=async(e,n,t)=>{try{const s=(await r.A.getDirectoryContents(e,n,"input",t)).filter(e=>e.name.endsWith(".bpmn")).slice(0,5),a=[];for(const o of s)try{const i=await r.A.getFileContent(e,n,o.path,t);a.push({name:o.name,path:o.path,content:i})}catch(i){console.warn("Failed to load BPMN file ".concat(o.path,":"),i)}return{bpmnFiles:a}}catch(i){return console.warn("Error loading business process data:",i),{bpmnFiles:[]}}},A=async(e,n,t)=>{try{const i=await r.A.getDirectoryContents(e,n,"input",t);return{dmnFiles:i.filter(e=>e.name.endsWith(".dmn")).slice(0,5).map(e=>({name:e.name,path:e.path}))}}catch(i){return{dmnFiles:[]}}},W=async(e,n,t)=>{try{const i=await r.A.getDirectoryContents(e,n,"input/profiles",t);return{profiles:i.filter(e=>e.name.endsWith(".json")).slice(0,10).map(e=>({name:e.name,path:e.path}))}}catch(i){return{profiles:[]}}},D=async(e,n,t)=>{try{const i=await r.A.getDirectoryContents(e,n,"input/tests",t);return{testFiles:i.filter(e=>e.name.endsWith(".feature")||e.name.endsWith(".json")).slice(0,10).map(e=>({name:e.name,path:e.path}))}}catch(i){return{testFiles:[]}}},R=async(e,n,t)=>{try{const i=await r.A.getDirectoryContents(e,n,"input/actors",t);return{actorFiles:i.filter(e=>e.name.endsWith(".json")).slice(0,10).map(e=>({name:e.name,path:e.path}))}}catch(i){return{actorFiles:[]}}};return y?(0,o.jsx)(a.Mx,{pageName:"".concat(p,"-publication"),children:(0,o.jsx)("div",{className:"publication-loading",children:(0,o.jsxs)("div",{className:"loading-content",children:[(0,o.jsx)("h3",{children:"Loading Publication..."}),(0,o.jsxs)("p",{children:["Preparing ",h," for publication view..."]})]})})}):M?(0,o.jsx)(a.Mx,{pageName:"".concat(p,"-publication"),children:(0,o.jsx)("div",{className:"publication-error",children:(0,o.jsxs)("div",{className:"error-content",children:[(0,o.jsx)("h3",{children:"Error Loading Publication"}),(0,o.jsx)("p",{children:M})]})})}):(0,o.jsx)(a.Mx,{pageName:"".concat(p,"-publication"),children:(0,o.jsxs)("div",{className:"publication-container ".concat(u?"print-mode":""),children:[(0,o.jsxs)("div",{className:"publication-header",children:[(0,o.jsxs)("div",{className:"publication-title",children:[(0,o.jsx)("h1",{children:h}),(0,o.jsx)("h2",{children:(null===k||void 0===k||null===(d=k.repository)||void 0===d?void 0:d.description)||"WHO SMART Guidelines DAK"})]}),(0,o.jsxs)("div",{className:"publication-meta",children:[(0,o.jsxs)("div",{className:"meta-item",children:[(0,o.jsx)("strong",{children:"Repository:"})," ",null===k||void 0===k?void 0:k.owner,"/",null===k||void 0===k?void 0:k.repoName]}),(0,o.jsxs)("div",{className:"meta-item",children:[(0,o.jsx)("strong",{children:"Branch:"})," ",null===k||void 0===k?void 0:k.branch]}),(0,o.jsxs)("div",{className:"meta-item",children:[(0,o.jsx)("strong",{children:"Generated:"})," ",new Date(null===k||void 0===k?void 0:k.generatedAt).toLocaleString()]})]})]}),(0,o.jsx)("div",{className:"publication-content",children:m&&m(B,k)}),(0,o.jsx)("div",{className:"publication-footer",children:(0,o.jsxs)("div",{className:"footer-content",children:[(0,o.jsx)("p",{children:"Generated by SGeX Workbench - WHO SMART Guidelines Exchange"}),(0,o.jsxs)("p",{children:["Component: ",p," | Repository: ",null===k||void 0===k?void 0:k.owner,"/",null===k||void 0===k?void 0:k.repoName," | Branch: ",null===k||void 0===k?void 0:k.branch]})]})}),!u&&(0,o.jsxs)("div",{className:"publication-controls",children:[(0,o.jsx)("button",{className:"print-button",onClick:()=>window.print(),children:"\ud83d\udda8\ufe0f Print / Save as PDF"}),(0,o.jsx)("button",{className:"epub-button",onClick:()=>l(B,k),children:"\ud83d\udcda Generate EPUB"})]})]})})}}}]);