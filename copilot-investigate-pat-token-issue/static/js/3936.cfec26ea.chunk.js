"use strict";(self.webpackChunksgex_workbench=self.webpackChunksgex_workbench||[]).push([[3936],{43936:(e,t,a)=>{a.r(t),a.d(t,{default:()=>v});var i=a(89379),s=a(9950),n=a(18518),o=a(57561),c=a(3611);const r=new class{constructor(){this.actorSchema=null,this.core=new c.ActorDefinitionCore,this.loadSchema()}async loadSchema(){try{const e=await fetch("".concat("/sgex/copilot-investigate-pat-token-issue","/schemas/actor-definition.json"));this.actorSchema=await e.json()}catch(e){console.warn("Could not load actor definition schema:",e)}}generateFSH(e){var t;if(!e||!e.id)throw new Error("Invalid actor definition: missing required fields");const a=[];return a.push("Profile: ".concat(e.id)),a.push("Parent: ActorDefinition"),a.push("Id: ".concat(e.id)),a.push('Title: "'.concat(this.escapeFSHString(e.name),'"')),a.push('Description: "'.concat(this.escapeFSHString(e.description),'"')),null!==(t=e.metadata)&&void 0!==t&&t.status&&a.push("* status = #".concat(e.metadata.status)),e.type&&a.push("* type = #".concat(e.type)),e.roles&&e.roles.length>0&&e.roles.forEach((e,t)=>{e.system&&a.push("* role[".concat(t,'].coding.system = "').concat(e.system,'"')),a.push("* role[".concat(t,"].coding.code = #").concat(e.code)),a.push("* role[".concat(t,'].coding.display = "').concat(this.escapeFSHString(e.display),'"'))}),e.qualifications&&e.qualifications.length>0&&e.qualifications.forEach((e,t)=>{a.push("* qualification[".concat(t,"].code.coding.code = #").concat(e.code)),a.push("* qualification[".concat(t,'].code.coding.display = "').concat(this.escapeFSHString(e.display),'"')),e.issuer&&a.push("* qualification[".concat(t,'].issuer.display = "').concat(this.escapeFSHString(e.issuer),'"'))}),e.specialties&&e.specialties.length>0&&e.specialties.forEach((e,t)=>{e.system&&a.push("* specialty[".concat(t,'].coding.system = "').concat(e.system,'"')),a.push("* specialty[".concat(t,"].coding.code = #").concat(e.code)),a.push("* specialty[".concat(t,'].coding.display = "').concat(this.escapeFSHString(e.display),'"'))}),e.location&&(e.location.type&&a.push("* location.type = #".concat(e.location.type)),e.location.description&&a.push('* location.description = "'.concat(this.escapeFSHString(e.location.description),'"'))),e.accessLevel&&a.push("* extension[accessLevel].valueCode = #".concat(e.accessLevel)),e.interactions&&e.interactions.length>0&&e.interactions.forEach((e,t)=>{a.push("* extension[interaction][".concat(t,"].extension[type].valueCode = #").concat(e.type)),a.push("* extension[interaction][".concat(t,'].extension[target].valueString = "').concat(this.escapeFSHString(e.target),'"')),e.description&&a.push("* extension[interaction][".concat(t,'].extension[description].valueString = "').concat(this.escapeFSHString(e.description),'"'))}),e.metadata&&(e.metadata.version&&a.push('* version = "'.concat(e.metadata.version,'"')),e.metadata.publisher&&a.push('* publisher = "'.concat(this.escapeFSHString(e.metadata.publisher),'"')),e.metadata.contact&&e.metadata.contact.length>0&&e.metadata.contact.forEach((e,t)=>{e.name&&a.push("* contact[".concat(t,'].name = "').concat(this.escapeFSHString(e.name),'"')),e.email&&(a.push("* contact[".concat(t,"].telecom.system = #email")),a.push("* contact[".concat(t,'].telecom.value = "').concat(e.email,'"')))})),a.join("\n")}escapeFSHString(e){return(0,c.escapeFSHString)(e)}async parseFSH(e){const t=await(0,c.extractFSHMetadata)(e);return{id:t.id||"",name:t.title||t.name||"",description:t.description||"",type:t.type||"person",roles:[],qualifications:[],specialties:[],interactions:[],metadata:{status:t.status||"draft"}}}validateActorDefinition(e){const t=[];return e.id&&e.id.match(/^[a-zA-Z][a-zA-Z0-9_-]*$/)||t.push("ID must start with a letter and contain only letters, numbers, underscores, and hyphens"),e.name&&0!==e.name.trim().length||t.push("Name is required"),e.description&&0!==e.description.trim().length||t.push("Description is required"),e.type||t.push("Actor type is required"),e.roles&&0!==e.roles.length?e.roles.forEach((e,a)=>{e.code&&e.display||t.push("Role ".concat(a+1," must have both code and display name"))}):t.push("At least one role is required"),{isValid:0===t.length,errors:t}}async saveToStagingGround(e){try{const t=this.validateActorDefinition(e);if(!t.isValid)throw new Error("Validation failed: ".concat(t.errors.join(", ")));const a=this.generateFSH(e),i="input/fsh/actors/".concat(e.id,".fsh");if(!o.A.updateFile(i,a,{type:"actor-definition",actorId:e.id,actorName:e.name,lastModified:Date.now(),source:"actor-editor"}))throw new Error("Failed to save to staging ground");return{success:!0,filePath:i,content:a}}catch(t){return console.error("Error saving actor definition:",t),{success:!1,error:t.message}}}getFromStagingGround(e){try{const t=o.A.getStagingGround(),a="input/fsh/actors/".concat(e,".fsh"),i=t.files.find(e=>e.path===a);if(!i)return null;return{actorDefinition:this.parseFSH(i.content),metadata:i.metadata,lastModified:i.timestamp}}catch(t){return console.error("Error loading actor definition from staging ground:",t),null}}listStagedActors(){try{return o.A.getStagingGround().files.filter(e=>{var t;return e.path.startsWith("input/fsh/actors/")&&e.path.endsWith(".fsh")&&"actor-definition"===(null===(t=e.metadata)||void 0===t?void 0:t.type)}).map(e=>{var t,a;return{id:(null===(t=e.metadata)||void 0===t?void 0:t.actorId)||e.path.split("/").pop().replace(".fsh",""),name:(null===(a=e.metadata)||void 0===a?void 0:a.actorName)||"Unknown Actor",filePath:e.path,lastModified:e.timestamp,metadata:e.metadata}}).sort((e,t)=>t.lastModified-e.lastModified)}catch(e){return console.error("Error listing staged actors:",e),[]}}removeFromStagingGround(e){try{const t="input/fsh/actors/".concat(e,".fsh");return o.A.removeFile(t)}catch(t){return console.error("Error removing actor definition:",t),!1}}createEmptyActorDefinition(){return{id:"",name:"",description:"",type:"person",roles:[{code:"",display:"",system:"http://snomed.info/sct"}],qualifications:[],specialties:[],location:{type:"facility",description:""},accessLevel:"standard",interactions:[],constraints:{availability:"",jurisdiction:"",limitations:[]},metadata:{version:"1.0.0",status:"draft",publisher:"",contact:[],tags:[]}}}getActorTemplates(){return[{id:"clinician-template",name:"Healthcare Clinician",description:"A qualified healthcare practitioner who provides direct patient care",type:"practitioner",roles:[{code:"158965000",display:"Medical practitioner",system:"http://snomed.info/sct"}],location:{type:"facility",description:"Healthcare facility or clinic"},accessLevel:"standard"},{id:"nurse-template",name:"Registered Nurse",description:"Licensed nursing professional providing patient care and health education",type:"practitioner",roles:[{code:"224535009",display:"Registered nurse",system:"http://snomed.info/sct"}],location:{type:"facility",description:"Hospital ward, clinic, or community health center"},accessLevel:"standard"},{id:"patient-template",name:"Patient",description:"Individual receiving healthcare services",type:"patient",roles:[{code:"116154003",display:"Patient",system:"http://snomed.info/sct"}],location:{type:"facility",description:"Any healthcare setting where patient receives care"},accessLevel:"read-only"},{id:"admin-template",name:"Healthcare Administrator",description:"Administrative staff managing healthcare operations and data",type:"person",roles:[{code:"394738000",display:"Other related persons",system:"http://snomed.info/sct"}],location:{type:"facility",description:"Administrative offices within healthcare organization"},accessLevel:"administrative"}]}};var l=a(53782),d=a(44414);const h=e=>{let{actorDefinition:t,errors:a,onFieldChange:i}=e;return(0,d.jsxs)("div",{className:"form-section",children:[(0,d.jsx)("h3",{children:"Basic Information"}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"id",children:"Actor ID *"}),(0,d.jsx)("input",{type:"text",id:"id",value:t.id,onChange:e=>i("id",e.target.value),className:a.id?"error":"",placeholder:"e.g., primary-care-physician",pattern:"[a-zA-Z][a-zA-Z0-9_-]*"}),a.id&&(0,d.jsx)("span",{className:"error-text",children:a.id}),(0,d.jsx)("span",{className:"help-text",children:"Unique identifier (letters, numbers, underscores, hyphens only)"})]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"name",children:"Display Name *"}),(0,d.jsx)("input",{type:"text",id:"name",value:t.name,onChange:e=>i("name",e.target.value),className:a.name?"error":"",placeholder:"e.g., Primary Care Physician"}),a.name&&(0,d.jsx)("span",{className:"error-text",children:a.name})]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"description",children:"Description *"}),(0,d.jsx)("textarea",{id:"description",value:t.description,onChange:e=>i("description",e.target.value),className:a.description?"error":"",placeholder:"Detailed description of the actor's role and responsibilities...",rows:4}),a.description&&(0,d.jsx)("span",{className:"error-text",children:a.description})]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"type",children:"Actor Type *"}),(0,d.jsxs)("select",{id:"type",value:t.type,onChange:e=>i("type",e.target.value),className:a.type?"error":"",children:[(0,d.jsx)("option",{value:"person",children:"Person"}),(0,d.jsx)("option",{value:"practitioner",children:"Practitioner"}),(0,d.jsx)("option",{value:"patient",children:"Patient"}),(0,d.jsx)("option",{value:"relatedperson",children:"Related Person"}),(0,d.jsx)("option",{value:"organization",children:"Organization"}),(0,d.jsx)("option",{value:"device",children:"Device"}),(0,d.jsx)("option",{value:"system",children:"System"})]}),a.type&&(0,d.jsx)("span",{className:"error-text",children:a.type})]})]})},m=e=>{let{actorDefinition:t,errors:a,onNestedFieldChange:i,onAddItem:s,onRemoveItem:n}=e;return(0,d.jsxs)("div",{className:"form-section",children:[(0,d.jsx)("h3",{children:"Roles & Qualifications"}),(0,d.jsxs)("div",{className:"subsection",children:[(0,d.jsxs)("div",{className:"subsection-header",children:[(0,d.jsx)("h4",{children:"Roles *"}),(0,d.jsx)("button",{type:"button",onClick:()=>s("roles",{code:"",display:"",system:"http://snomed.info/sct"}),className:"add-btn",children:"+ Add Role"})]}),a.roles&&(0,d.jsx)("span",{className:"error-text",children:a.roles}),t.roles&&t.roles.map((e,t)=>(0,d.jsxs)("div",{className:"array-item",children:[(0,d.jsxs)("div",{className:"array-item-header",children:[(0,d.jsxs)("span",{children:["Role ",t+1]}),(0,d.jsx)("button",{type:"button",onClick:()=>n("roles",t),className:"remove-btn",children:"Remove"})]}),(0,d.jsxs)("div",{className:"form-row",children:[(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"role-code-".concat(t),children:"Code"}),(0,d.jsx)("input",{id:"role-code-".concat(t),type:"text",value:e.code,onChange:e=>i("roles",t,"code",e.target.value),placeholder:"Role code"})]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"role-display-".concat(t),children:"Display Name"}),(0,d.jsx)("input",{id:"role-display-".concat(t),type:"text",value:e.display,onChange:e=>i("roles",t,"display",e.target.value),placeholder:"Human-readable role name"})]})]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"role-system-".concat(t),children:"Code System"}),(0,d.jsx)("input",{id:"role-system-".concat(t),type:"text",value:e.system||"",onChange:e=>i("roles",t,"system",e.target.value),placeholder:"http://snomed.info/sct"})]})]},t))]}),(0,d.jsxs)("div",{className:"subsection",children:[(0,d.jsxs)("div",{className:"subsection-header",children:[(0,d.jsx)("h4",{children:"Qualifications"}),(0,d.jsx)("button",{type:"button",onClick:()=>s("qualifications",{code:"",display:"",issuer:""}),className:"add-btn",children:"+ Add Qualification"})]}),t.qualifications&&t.qualifications.map((e,t)=>(0,d.jsxs)("div",{className:"array-item",children:[(0,d.jsxs)("div",{className:"array-item-header",children:[(0,d.jsxs)("span",{children:["Qualification ",t+1]}),(0,d.jsx)("button",{type:"button",onClick:()=>n("qualifications",t),className:"remove-btn",children:"Remove"})]}),(0,d.jsxs)("div",{className:"form-row",children:[(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"qualification-code-".concat(t),children:"Code"}),(0,d.jsx)("input",{id:"qualification-code-".concat(t),type:"text",value:e.code,onChange:e=>i("qualifications",t,"code",e.target.value),placeholder:"Qualification code"})]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"qualification-display-".concat(t),children:"Display Name"}),(0,d.jsx)("input",{id:"qualification-display-".concat(t),type:"text",value:e.display,onChange:e=>i("qualifications",t,"display",e.target.value),placeholder:"Qualification name"})]})]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"qualification-issuer-".concat(t),children:"Issuing Organization"}),(0,d.jsx)("input",{id:"qualification-issuer-".concat(t),type:"text",value:e.issuer||"",onChange:e=>i("qualifications",t,"issuer",e.target.value),placeholder:"Organization that issued this qualification"})]})]},t))]}),(0,d.jsxs)("div",{className:"subsection",children:[(0,d.jsxs)("div",{className:"subsection-header",children:[(0,d.jsx)("h4",{children:"Specialties"}),(0,d.jsx)("button",{type:"button",onClick:()=>s("specialties",{code:"",display:"",system:"http://snomed.info/sct"}),className:"add-btn",children:"+ Add Specialty"})]}),t.specialties&&t.specialties.map((e,t)=>(0,d.jsxs)("div",{className:"array-item",children:[(0,d.jsxs)("div",{className:"array-item-header",children:[(0,d.jsxs)("span",{children:["Specialty ",t+1]}),(0,d.jsx)("button",{type:"button",onClick:()=>n("specialties",t),className:"remove-btn",children:"Remove"})]}),(0,d.jsxs)("div",{className:"form-row",children:[(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"specialty-code-".concat(t),children:"Code"}),(0,d.jsx)("input",{id:"specialty-code-".concat(t),type:"text",value:e.code,onChange:e=>i("specialties",t,"code",e.target.value),placeholder:"Specialty code"})]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"specialty-display-".concat(t),children:"Display Name"}),(0,d.jsx)("input",{id:"specialty-display-".concat(t),type:"text",value:e.display,onChange:e=>i("specialties",t,"display",e.target.value),placeholder:"Specialty name"})]})]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"specialty-system-".concat(t),children:"Code System"}),(0,d.jsx)("input",{id:"specialty-system-".concat(t),type:"text",value:e.system||"",onChange:e=>i("specialties",t,"system",e.target.value),placeholder:"http://snomed.info/sct"})]})]},t))]})]})},p=e=>{var t,a;let{actorDefinition:s,errors:n,onFieldChange:o,onNestedFieldChange:c,onAddItem:r,onRemoveItem:l}=e;return(0,d.jsxs)("div",{className:"form-section",children:[(0,d.jsx)("h3",{children:"Context & Access"}),(0,d.jsxs)("div",{className:"subsection",children:[(0,d.jsx)("h4",{children:"Typical Location"}),(0,d.jsxs)("div",{className:"form-row",children:[(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"location-type",children:"Location Type"}),(0,d.jsxs)("select",{id:"location-type",value:(null===(t=s.location)||void 0===t?void 0:t.type)||"",onChange:e=>o("location",(0,i.A)((0,i.A)({},s.location),{},{type:e.target.value})),children:[(0,d.jsx)("option",{value:"facility",children:"Healthcare Facility"}),(0,d.jsx)("option",{value:"community",children:"Community"}),(0,d.jsx)("option",{value:"home",children:"Home"}),(0,d.jsx)("option",{value:"mobile",children:"Mobile"}),(0,d.jsx)("option",{value:"virtual",children:"Virtual/Remote"})]})]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"location-description",children:"Description"}),(0,d.jsx)("input",{id:"location-description",type:"text",value:(null===(a=s.location)||void 0===a?void 0:a.description)||"",onChange:e=>o("location",(0,i.A)((0,i.A)({},s.location),{},{description:e.target.value})),placeholder:"Describe the typical location"})]})]})]}),(0,d.jsxs)("div",{className:"subsection",children:[(0,d.jsx)("h4",{children:"System Access Level"}),(0,d.jsx)("div",{className:"form-group",children:(0,d.jsxs)("select",{value:s.accessLevel||"standard",onChange:e=>o("accessLevel",e.target.value),children:[(0,d.jsx)("option",{value:"read-only",children:"Read-Only"}),(0,d.jsx)("option",{value:"standard",children:"Standard"}),(0,d.jsx)("option",{value:"administrative",children:"Administrative"}),(0,d.jsx)("option",{value:"system",children:"System"})]})})]}),(0,d.jsxs)("div",{className:"subsection",children:[(0,d.jsxs)("div",{className:"subsection-header",children:[(0,d.jsx)("h4",{children:"Key Interactions"}),(0,d.jsx)("button",{type:"button",onClick:()=>r("interactions",{type:"reads",target:"",description:""}),className:"add-btn",children:"+ Add Interaction"})]}),s.interactions&&s.interactions.map((e,t)=>(0,d.jsxs)("div",{className:"array-item",children:[(0,d.jsxs)("div",{className:"array-item-header",children:[(0,d.jsxs)("span",{children:["Interaction ",t+1]}),(0,d.jsx)("button",{type:"button",onClick:()=>l("interactions",t),className:"remove-btn",children:"Remove"})]}),(0,d.jsxs)("div",{className:"form-row",children:[(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"interaction-type-".concat(t),children:"Type"}),(0,d.jsxs)("select",{id:"interaction-type-".concat(t),value:e.type,onChange:e=>c("interactions",t,"type",e.target.value),children:[(0,d.jsx)("option",{value:"creates",children:"Creates"}),(0,d.jsx)("option",{value:"reads",children:"Reads"}),(0,d.jsx)("option",{value:"updates",children:"Updates"}),(0,d.jsx)("option",{value:"deletes",children:"Deletes"}),(0,d.jsx)("option",{value:"approves",children:"Approves"}),(0,d.jsx)("option",{value:"reviews",children:"Reviews"}),(0,d.jsx)("option",{value:"monitors",children:"Monitors"})]})]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"interaction-target-".concat(t),children:"Target"}),(0,d.jsx)("input",{id:"interaction-target-".concat(t),type:"text",value:e.target,onChange:e=>c("interactions",t,"target",e.target.value),placeholder:"What the actor interacts with"})]})]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"interaction-description-".concat(t),children:"Description"}),(0,d.jsx)("input",{id:"interaction-description-".concat(t),type:"text",value:e.description||"",onChange:e=>c("interactions",t,"description",e.target.value),placeholder:"Describe this interaction"})]})]},t))]})]})},u=e=>{var t,a,s,n,o,c;let{actorDefinition:r,errors:l,onFieldChange:h,onNestedFieldChange:m,onAddItem:p,onRemoveItem:u}=e;return(0,d.jsxs)("div",{className:"form-section",children:[(0,d.jsx)("h3",{children:"Metadata"}),(0,d.jsxs)("div",{className:"form-row",children:[(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"metadata-version",children:"Version"}),(0,d.jsx)("input",{id:"metadata-version",type:"text",value:(null===(t=r.metadata)||void 0===t?void 0:t.version)||"",onChange:e=>h("metadata",(0,i.A)((0,i.A)({},r.metadata),{},{version:e.target.value})),placeholder:"1.0.0"})]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"metadata-status",children:"Status"}),(0,d.jsxs)("select",{id:"metadata-status",value:(null===(a=r.metadata)||void 0===a?void 0:a.status)||"draft",onChange:e=>h("metadata",(0,i.A)((0,i.A)({},r.metadata),{},{status:e.target.value})),children:[(0,d.jsx)("option",{value:"draft",children:"Draft"}),(0,d.jsx)("option",{value:"active",children:"Active"}),(0,d.jsx)("option",{value:"retired",children:"Retired"})]})]})]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"metadata-publisher",children:"Publisher"}),(0,d.jsx)("input",{id:"metadata-publisher",type:"text",value:(null===(s=r.metadata)||void 0===s?void 0:s.publisher)||"",onChange:e=>h("metadata",(0,i.A)((0,i.A)({},r.metadata),{},{publisher:e.target.value})),placeholder:"Organization or person responsible"})]}),(0,d.jsxs)("div",{className:"subsection",children:[(0,d.jsxs)("div",{className:"subsection-header",children:[(0,d.jsx)("h4",{children:"Contact Information"}),(0,d.jsx)("button",{type:"button",onClick:()=>p("metadata.contact",{name:"",email:""}),className:"add-btn",children:"+ Add Contact"})]}),(null===(n=r.metadata)||void 0===n?void 0:n.contact)&&r.metadata.contact.map((e,t)=>(0,d.jsxs)("div",{className:"array-item",children:[(0,d.jsxs)("div",{className:"array-item-header",children:[(0,d.jsxs)("span",{children:["Contact ",t+1]}),(0,d.jsx)("button",{type:"button",onClick:()=>{const e=[...r.metadata.contact||[]];e.splice(t,1),h("metadata",(0,i.A)((0,i.A)({},r.metadata),{},{contact:e}))},className:"remove-btn",children:"Remove"})]}),(0,d.jsxs)("div",{className:"form-row",children:[(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"contact-name-".concat(t),children:"Name"}),(0,d.jsx)("input",{id:"contact-name-".concat(t),type:"text",value:e.name||"",onChange:a=>{const s=[...r.metadata.contact||[]];s[t]=(0,i.A)((0,i.A)({},e),{},{name:a.target.value}),h("metadata",(0,i.A)((0,i.A)({},r.metadata),{},{contact:s}))},placeholder:"Contact name"})]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"contact-email-".concat(t),children:"Email"}),(0,d.jsx)("input",{id:"contact-email-".concat(t),type:"email",value:e.email||"",onChange:a=>{const s=[...r.metadata.contact||[]];s[t]=(0,i.A)((0,i.A)({},e),{},{email:a.target.value}),h("metadata",(0,i.A)((0,i.A)({},r.metadata),{},{contact:s}))},placeholder:"contact@example.com"})]})]})]},t))]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"metadata-tags",children:"Tags"}),(0,d.jsx)("input",{id:"metadata-tags",type:"text",value:(null===(o=r.metadata)||void 0===o||null===(c=o.tags)||void 0===c?void 0:c.join(", "))||"",onChange:e=>h("metadata",(0,i.A)((0,i.A)({},r.metadata),{},{tags:e.target.value.split(",").map(e=>e.trim()).filter(e=>e)})),placeholder:"Enter tags separated by commas"}),(0,d.jsx)("span",{className:"help-text",children:"Comma-separated tags for categorization"})]})]})},v=()=>{(0,n.Zp)();const e=(0,l.oc)(),t=null,[a,o]=(0,s.useState)(null),[c,v]=(0,s.useState)(!0),[x,g]=(0,s.useState)(!1),[j,y]=(0,s.useState)({}),[f,b]=(0,s.useState)(!1),[N,C]=(0,s.useState)(""),[A,S]=(0,s.useState)([]),[F,w]=(0,s.useState)(!1),[k,q]=(0,s.useState)("basic");(0,s.useEffect)(()=>{const e=e=>{"Escape"===e.key&&f&&b(!1)};if(f)return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[f]);const D=(0,s.useCallback)(async()=>{v(!0);try{o(r.createEmptyActorDefinition());const e=r.listStagedActors();S(e)}catch(e){console.error("Error initializing actor editor:",e),y({initialization:"Failed to initialize editor"})}finally{v(!1)}},[t]);(0,s.useEffect)(()=>{e.error||e.loading||D()},[e.error,e.loading,D]);const H=(0,s.useCallback)((e,t)=>{o(a=>(0,i.A)((0,i.A)({},a),{},{[e]:t})),j[e]&&y(t=>{const a=(0,i.A)({},t);return delete a[e],a})},[j]),E=(0,s.useCallback)((e,t,a,s)=>{o(n=>{const o=(0,i.A)({},n);return o[e]||(o[e]=[]),o[e][t]||(o[e][t]={}),o[e][t][a]=s,o})},[]),R=(0,s.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};o(a=>(0,i.A)((0,i.A)({},a),{},{[e]:[...a[e]||[],t]}))},[]),I=(0,s.useCallback)((e,t)=>{o(a=>(0,i.A)((0,i.A)({},a),{},{[e]:a[e].filter((e,a)=>a!==t)}))},[]),L=(0,s.useCallback)(()=>{const e={};return null!==a&&void 0!==a&&a.id||(e.id="Actor ID is required"),null!==a&&void 0!==a&&a.name||(e.name="Actor name is required"),null!==a&&void 0!==a&&a.description||(e.description="Actor description is required"),null!==a&&void 0!==a&&a.type||(e.type="Actor type is required"),null!==a&&void 0!==a&&a.roles&&a.roles.forEach((t,a)=>{t.code||(e["roles.".concat(a,".code")]="Role code is required"),t.display||(e["roles.".concat(a,".display")]="Role display name is required"),t.system||(e["roles.".concat(a,".system")]="Role system is required")}),null!==a&&void 0!==a&&a.qualifications&&a.qualifications.forEach((t,a)=>{t.code||(e["qualifications.".concat(a,".code")]="Qualification code is required"),t.display||(e["qualifications.".concat(a,".display")]="Qualification display name is required")}),y(e),0===Object.keys(e).length},[a]),P=(0,s.useCallback)(()=>{if(a)try{const e=r.generateFSH(a);C(e)}catch(e){console.error("Error generating FSH preview:",e),y({general:"Failed to generate FSH preview"})}},[a]),z=(0,s.useCallback)(async()=>{if(L()){g(!0);try{r.saveToStagingGround(a,{type:"actor-definition",actorId:a.id,actorName:a.name,branch:V,repository:null===O||void 0===O?void 0:O.name,owner:null===G||void 0===G?void 0:G.login});const e=r.listStagedActors();S(e),y({})}catch(e){console.error("Error saving actor definition:",e),y({general:"Failed to save actor definition"})}finally{g(!1)}}},[a,L,V,O,G]),M=(0,s.useCallback)(e=>{const t=r.getActorTemplates().find(t=>t.id===e);t&&o(t)},[]),T=(0,s.useCallback)(e=>{const t=r.getFromStagingGround(e);t&&(o(t.actorDefinition),w(!1))},[]),Q=(0,s.useCallback)(e=>{if(window.confirm("Are you sure you want to delete this staged actor?")){r.removeFromStagingGround(e);const t=r.listStagedActors();S(t)}},[]);if(e.error)return(0,d.jsx)(l.Mx,{pageName:"actor-editor",children:(0,d.jsx)("div",{className:"actor-editor-container",children:(0,d.jsxs)("div",{className:"error-message",children:[(0,d.jsx)("h2",{children:"Page Context Error"}),(0,d.jsx)("p",{children:e.error}),(0,d.jsx)("p",{children:"This component requires a DAK repository context to function properly."})]})})});if(e.loading)return(0,d.jsx)(l.Mx,{pageName:"actor-editor",children:(0,d.jsx)("div",{className:"actor-editor-container",children:(0,d.jsxs)("div",{className:"loading-message",children:[(0,d.jsx)("h2",{children:"Loading..."}),(0,d.jsx)("p",{children:"Initializing page context..."})]})})});const{profile:G,repository:O,branch:V}=e;return(0,d.jsx)(l.Mx,{pageName:"actor-editor",children:(0,d.jsxs)("div",{className:"actor-editor",children:[G&&O?c?(0,d.jsx)("div",{className:"loading-state",children:(0,d.jsxs)("div",{className:"loading-content",children:[(0,d.jsx)("h2",{children:"Loading Actor Editor..."}),(0,d.jsx)("p",{children:"Initializing editor and loading data..."})]})}):(0,d.jsxs)("div",{className:"editor-content",children:[(0,d.jsxs)("div",{className:"editor-toolbar",children:[(0,d.jsxs)("div",{className:"toolbar-left",children:[(0,d.jsxs)("button",{onClick:()=>w(!F),className:"toolbar-btn",title:"Browse staged actors",children:["\ud83d\udccb Staged Actors (",A.length,")"]}),(0,d.jsx)("button",{onClick:P,className:"toolbar-btn",disabled:!(null!==a&&void 0!==a&&a.id),title:"Preview FSH output",children:"\ud83d\udc41\ufe0f Preview FSH"})]}),(0,d.jsx)("div",{className:"toolbar-right",children:(0,d.jsx)("button",{onClick:z,disabled:x||!(null!==a&&void 0!==a&&a.id),className:"toolbar-btn primary",title:"Save to staging ground",children:x?"\ud83d\udcbe Saving...":"\ud83d\udcbe Save"})})]}),j.general&&(0,d.jsxs)("div",{className:"error-message",children:[(0,d.jsx)("strong",{children:"Error:"})," ",j.general]}),(0,d.jsxs)("div",{className:"editor-layout",children:[F&&(0,d.jsxs)("div",{className:"actor-list-sidebar",children:[(0,d.jsxs)("div",{className:"sidebar-header",children:[(0,d.jsx)("h3",{children:"Staged Actors"}),(0,d.jsx)("button",{onClick:()=>w(!1),className:"close-btn",children:"\u2715"})]}),(0,d.jsxs)("div",{className:"sidebar-content",children:[(0,d.jsxs)("div",{className:"templates-section",children:[(0,d.jsx)("h4",{children:"Templates"}),r.getActorTemplates().map(e=>(0,d.jsxs)("div",{className:"template-item",children:[(0,d.jsx)("span",{className:"template-name",children:e.name}),(0,d.jsx)("button",{onClick:()=>M(e),className:"load-btn",children:"Use"})]},e.id))]}),A.length>0&&(0,d.jsxs)("div",{className:"staged-actors-section",children:[(0,d.jsx)("h4",{children:"Staged Actors"}),A.map(e=>(0,d.jsxs)("div",{className:"staged-actor-item",children:[(0,d.jsxs)("div",{className:"actor-info",children:[(0,d.jsx)("span",{className:"actor-name",children:e.name}),(0,d.jsx)("span",{className:"actor-id",children:e.id}),(0,d.jsx)("span",{className:"actor-modified",children:new Date(e.lastModified).toLocaleDateString()})]}),(0,d.jsxs)("div",{className:"actor-actions",children:[(0,d.jsx)("button",{onClick:()=>T(e.id),className:"load-btn",children:"Edit"}),(0,d.jsx)("button",{onClick:()=>Q(e.id),className:"delete-btn",children:"\ud83d\uddd1\ufe0f"})]})]},e.id))]})]})]}),(0,d.jsx)("div",{className:"main-editor ".concat(F?"with-sidebar":""),children:a&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("div",{className:"editor-tabs",children:[(0,d.jsx)("button",{className:"tab ".concat("basic"===k?"active":""),onClick:()=>q("basic"),children:"Basic Info"}),(0,d.jsx)("button",{className:"tab ".concat("roles"===k?"active":""),onClick:()=>q("roles"),children:"Roles & Qualifications"}),(0,d.jsx)("button",{className:"tab ".concat("context"===k?"active":""),onClick:()=>q("context"),children:"Context & Access"}),(0,d.jsx)("button",{className:"tab ".concat("metadata"===k?"active":""),onClick:()=>q("metadata"),children:"Metadata"})]}),(0,d.jsxs)("div",{className:"tab-content",children:["basic"===k&&(0,d.jsx)(h,{actorDefinition:a,errors:j,onFieldChange:H}),"roles"===k&&(0,d.jsx)(m,{actorDefinition:a,errors:j,onNestedFieldChange:E,onAddItem:R,onRemoveItem:I}),"context"===k&&(0,d.jsx)(p,{actorDefinition:a,errors:j,onFieldChange:H,onNestedFieldChange:E,onAddItem:R,onRemoveItem:I}),"metadata"===k&&(0,d.jsx)(u,{actorDefinition:a,errors:j,onFieldChange:H,onNestedFieldChange:E,onAddItem:R,onRemoveItem:I})]})]})})]})]}):(0,d.jsxs)("div",{className:"redirecting-state",children:[(0,d.jsx)("h2",{children:"Redirecting..."}),(0,d.jsx)("p",{children:"Missing required context. Redirecting to home page..."})]}),f&&(0,d.jsx)("div",{className:"modal-overlay",onClick:e=>{e.target===e.currentTarget&&b(!1)},role:"presentation",children:(0,d.jsxs)("div",{className:"modal-content",role:"dialog","aria-labelledby":"fsh-preview-title","aria-modal":"true",children:[(0,d.jsxs)("div",{className:"modal-header",children:[(0,d.jsx)("h3",{id:"fsh-preview-title",children:"FSH Preview"}),(0,d.jsx)("button",{onClick:()=>b(!1),className:"close-btn",children:"\u2715"})]}),(0,d.jsx)("div",{className:"modal-body",children:(0,d.jsx)("pre",{className:"fsh-preview",children:N})}),(0,d.jsx)("div",{className:"modal-footer",children:(0,d.jsx)("button",{onClick:()=>{navigator.clipboard.writeText(N),alert("FSH copied to clipboard!")},className:"copy-btn",children:"\ud83d\udccb Copy to Clipboard"})})]})})]})})}}}]);