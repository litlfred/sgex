"use strict";(self.webpackChunksgex_workbench=self.webpackChunksgex_workbench||[]).push([[648],{76648:(e,s,a)=>{a.r(s),a.d(s,{default:()=>p});var t=a(65043),n=a(29615),i=a(93071),o=a(65240);const r=JSON.parse('{"eR":[{"id":"who-smart-ig-empty","name":"WHO template SMART Guidelines","description":"Empty WHO SMART Guidelines template for creating new Digital Adaptation Kits","repository":"https://github.com/WorldHealthOrganization/smart-ig-empty","owner":"WorldHealthOrganization","repo":"smart-ig-empty","isDefault":true,"type":"template","tags":["WHO","SMART Guidelines","Template","Empty"],"version":"latest","documentation":"https://github.com/WorldHealthOrganization/smart-ig-empty/blob/main/README.md"}]}');var l=a(76712),c=a(70579);const d=()=>{var e;const s=(0,n.zy)(),a=(0,n.Zp)(),{params:d,profile:p}=(0,l.HX)(),m=null===d||void 0===d?void 0:d.user,h=p||(null===(e=s.state)||void 0===e?void 0:e.profile),u=(0,t.useRef)();u.current=h;const{action:g}=s.state||{},[x,j]=(0,t.useState)([]),[v,N]=(0,t.useState)(null),[b,f]=(0,t.useState)(!0),[y,_]=(0,t.useState)(null),[w,S]=(0,t.useState)(!1),[k,A]=(0,t.useState)(null),[R,C]=(0,t.useState)(new Set),[T,z]=(0,t.useState)(!1);(0,t.useEffect)(()=>{m||h?!m||g?!m||h?m&&h&&h.login!==m?a("/"):!h||m||a(`/dak-selection/${h.login}`,{state:{profile:h,action:g},replace:!0}):a("/"):a(`/dak-action/${m}`,{replace:!0}):a("/")},[m,h,g,a]);const D=e=>{var s,a;if(!e)return null;const t=(null===(s=e.owner)||void 0===s?void 0:s.login)||(null===(a=e.full_name)||void 0===a?void 0:a.split("/")[0]),n=e.name;return t&&n?{user:t,repo:n}:(console.error("Unable to extract user/repo from repository object:",e),null)},M=()=>{switch(g){case"edit":return{title:"Select DAK to Edit",description:"Choose an existing DAK repository that you have permission to modify.",buttonText:"Continue to Edit Components",nextRoute:"/dashboard"};case"fork":return{title:"Select DAK to Fork",description:"Choose the source DAK repository that you want to fork.",buttonText:"Continue to Organization Selection",nextRoute:"/organization-selection"};case"create":return{title:"Select Template DAK",description:"Choose a template repository to use as the base for your new DAK.",buttonText:"Continue to Organization Selection",nextRoute:"/organization-selection",showTemplate:!0};default:return{title:"Select DAK Repository",description:"Choose a DAK repository to work with.",buttonText:"Continue",nextRoute:"/dashboard"}}},$=(0,t.useCallback)(()=>{const e=u.current;if(!e||!e.login)return[];return[{id:1,name:"maternal-health-dak",full_name:`${e.login}/maternal-health-dak`,description:"WHO SMART Guidelines for Maternal Health - Digital Adaptation Kit",html_url:`https://github.com/${e.login}/maternal-health-dak`,topics:["who","smart-guidelines","maternal-health","dak"],language:"FML",stargazers_count:12,forks_count:3,updated_at:"2024-01-15T10:30:00Z",smart_guidelines_compatible:!0},{id:2,name:"immunization-dak",full_name:`${e.login}/immunization-dak`,description:"Digital Adaptation Kit for Immunization Guidelines",html_url:`https://github.com/${e.login}/immunization-dak`,topics:["who","smart-guidelines","immunization","vaccines"],language:"FML",stargazers_count:8,forks_count:2,updated_at:"2024-01-10T14:20:00Z",smart_guidelines_compatible:!0},{id:3,name:"anc-dak",full_name:`${e.login}/anc-dak`,description:"Antenatal Care Digital Adaptation Kit based on WHO guidelines",html_url:`https://github.com/${e.login}/anc-dak`,topics:["who","anc","antenatal-care","smart-guidelines"],language:"FML",stargazers_count:15,forks_count:5,updated_at:"2024-01-12T09:15:00Z",smart_guidelines_compatible:!0},{id:4,name:"regular-health-app",full_name:`${e.login}/regular-health-app`,description:"A regular health application without SMART Guidelines",html_url:`https://github.com/${e.login}/regular-health-app`,topics:["health","app","javascript"],language:"JavaScript",stargazers_count:5,forks_count:1,updated_at:"2024-01-08T16:45:00Z",smart_guidelines_compatible:!1},{id:5,name:"medical-database",full_name:`${e.login}/medical-database`,description:"Medical database with FHIR but not SMART Guidelines",html_url:`https://github.com/${e.login}/medical-database`,topics:["fhir","database","medical"],language:"SQL",stargazers_count:7,forks_count:2,updated_at:"2024-01-05T11:20:00Z",smart_guidelines_compatible:!1}].filter(e=>e.smart_guidelines_compatible)},[]),E=(0,t.useCallback)(async()=>{S(!0),j([]);const e=$(),s=e=>new Promise(s=>setTimeout(s,e));try{for(let a=0;a<e.length;a++){const t=e[a];A({current:a+1,total:e.length,currentRepo:t.name,progress:Math.round((a+1)/e.length*100),completed:!1,started:!0}),C(e=>new Set([...e,t.name])),await s(1e3+1e3*Math.random()),j(e=>[...e,t].sort((e,s)=>e.name.localeCompare(s.name))),A({current:a+1,total:e.length,currentRepo:t.name,progress:Math.round((a+1)/e.length*100),completed:!0}),C(e=>{const s=new Set(e);return s.delete(t.name),s}),await s(300)}console.log("\ud83c\udf89 Demo scanning completed, stopping scanning state"),setTimeout(()=>{S(!1),A(null),C(new Set)},500)}catch(y){console.error("Error in simulated scanning:",y),S(!1),A(null),C(new Set)}},[$]),H=(0,t.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];f(!0),_(null),S(!1),A(null),C(new Set),z(!1);try{let t=[],n=null;if("create"===g)t=r.eR.map((e,s)=>({id:-(s+1),name:e.repo,full_name:`${e.owner}/${e.repo}`,description:e.description,html_url:e.repository,clone_url:`${e.repository}.git`,topics:e.tags.map(e=>e.toLowerCase().replace(/\s+/g,"-")),language:"FML",stargazers_count:15,forks_count:8,updated_at:(new Date).toISOString(),smart_guidelines_compatible:!0,is_template:!0,template_config:e,owner:{login:e.owner,avatar_url:"WorldHealthOrganization"===e.owner?"https://avatars.githubusercontent.com/u/9166906?s=200&v=4":"https://github.com/favicon.ico"}})),t.sort((e,s)=>e.name.localeCompare(s.name)),j(t);else{if(i.A.isAuth()&&!e)try{n=o.A.getCachedRepositories(h.login,"org"===h.type?"org":"user")}catch(s){console.warn("Error accessing repository cache:",s)}if(n&&!e)console.log("Using cached repository data",o.A.getCacheInfo(h.login,"org"===h.type?"org":"user")),t=n.repositories,z(!0),t.sort((e,s)=>e.name.localeCompare(s.name)),j(t);else if(i.A.isAuth()){console.log(e?"\ud83d\udd04 Force rescanning repositories...":"\ud83d\udd0d No cached data, initiating scan..."),S(!0),f(!1),console.log("\ud83d\udcca Starting enhanced scanning display for authenticated user");const s=6e4,n=new Promise((e,a)=>{setTimeout(()=>a(new Error("Scanning timeout - operation took longer than 60 seconds")),s)}),r=i.A.getSmartGuidelinesRepositoriesProgressive(h.login,"org"===h.type?"org":"user",e=>{j(s=>{if(!s.some(s=>s.id===e.id)){return[...s,e].sort((e,s)=>e.name.localeCompare(s.name))}return s})},e=>{console.log("\ud83d\udcca Real scanning progress:",e),A(e),e.started&&!e.completed?(console.log("\ud83d\udd0d Started scanning:",e.currentRepo),C(s=>new Set([...s,e.currentRepo])),A({...e,started:!0,completed:!1})):e.completed?(console.log("\u2705 Completed scanning:",e.currentRepo),A({...e,completed:!0}),setTimeout(()=>{C(s=>{const a=new Set(s);return a.delete(e.currentRepo),a})},200),e.current===e.total&&(console.log("\ud83c\udf89 All repositories scanned, stopping scanning state"),setTimeout(()=>{S(!1),A(null),C(new Set)},500))):0===e.total&&e.completed&&(console.log("\ud83c\udf89 No repositories to scan, stopping scanning state"),setTimeout(()=>{S(!1),A(null),C(new Set)},500))});try{t=await Promise.race([r,n])}catch(a){throw console.error("\u23f0 Scanning timed out:",a.message),S(!1),A(null),C(new Set),new Error("Repository scanning timed out. Please try again or use cached data if available.")}o.A.setCachedRepositories(h.login,"org"===h.type?"org":"user",t);const l=t.sort((e,s)=>e.name.localeCompare(s.name));j(l)}else await E(),t=$(),t.sort((e,s)=>e.name.localeCompare(s.name)),j(t)}}catch(y){console.error("Error fetching repositories:",y),_("Failed to fetch repositories. Please check your connection and try again.");const s=$();s.sort((e,s)=>e.name.localeCompare(s.name)),j(s),S(!1),A(null),C(new Set)}finally{f(!1),i.A.isAuth()||"create"!==g||(S(!1),A(null),C(new Set))}},[h,g]);(0,t.useEffect)(()=>{h&&g&&m&&h.login===m&&H(!1,!1)},[h,g,m,H]);const O=e=>{N(e),"edit"===g&&setTimeout(()=>{const s=D(e);if(s){const t=`/dashboard/${s.user}/${s.repo}`;a(t,{state:{profile:h,repository:e,action:g}})}else{const s=M();a(s.nextRoute,{state:{profile:h,repository:e,action:g}})}},300)},G=()=>{H(!0,!1)},K=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});if(!h||!g||!m||h.login!==m)return(0,c.jsx)("div",{className:"dak-selection",children:(0,c.jsx)("div",{style:{color:"white",textAlign:"center",padding:"2rem"},children:"Redirecting..."})});const F=M();return(0,c.jsx)("div",{className:"dak-selection",children:(0,c.jsx)("div",{className:"selection-content",children:(0,c.jsxs)("div",{className:"selection-main",children:[(0,c.jsx)("div",{className:"selection-header",children:(0,c.jsxs)("div",{className:"selection-title",children:[(0,c.jsx)("h1",{children:F.title}),(0,c.jsx)("p",{className:"selection-subtitle",children:F.description})]})}),(0,c.jsxs)("div",{className:"selection-intro",children:["create"===g&&(0,c.jsxs)("div",{className:"template-notice",children:[(0,c.jsx)("span",{className:"notice-icon",children:"\u2139\ufe0f"}),(0,c.jsx)("span",{children:"You'll create a new repository based on the WHO SMART Guidelines template."})]}),"create"!==g&&i.A.isAuth()&&(0,c.jsx)("div",{className:"cache-controls",children:T?(0,c.jsxs)("div",{className:"cache-info",children:[(0,c.jsx)("span",{className:"cache-icon",children:"\ud83d\udcbe"}),(0,c.jsx)("span",{children:"Using cached data. "}),(0,c.jsx)("button",{onClick:G,className:"rescan-link",disabled:w,children:w?"Scanning...":"Refresh"})]}):(0,c.jsx)("div",{className:"scan-controls",children:!w&&!b&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("button",{onClick:G,className:"rescan-btn",disabled:w,children:"\ud83d\udd04 Rescan Repositories"}),o.A.getCachedRepositories(h.login,"org"===h.type?"org":"user")&&(0,c.jsx)("button",{onClick:()=>{H(!1,!1)},className:"cache-btn",disabled:w,children:"\ud83d\udcbe Use Cached Data"})]})})}),"create"!==g&&!i.A.isAuth()&&!w&&!b&&(0,c.jsx)("div",{className:"demo-controls",children:(0,c.jsxs)("div",{className:"demo-info",children:[(0,c.jsx)("span",{className:"demo-icon",children:"\ud83c\udfad"}),(0,c.jsx)("span",{children:"Not authenticated. "}),(0,c.jsx)("button",{onClick:async()=>{await E()},className:"demo-scan-btn",disabled:w,children:"\u2728 Demo Enhanced Scanning Display"})]})})]}),b?(0,c.jsxs)("div",{className:"loading",children:[(0,c.jsx)("div",{className:"spinner"}),(0,c.jsx)("p",{children:"Loading repositories..."})]}):w?(0,c.jsxs)("div",{className:"scanning-status",children:[(0,c.jsxs)("div",{className:"scanning-header",children:[(0,c.jsx)("div",{className:"spinner"}),(0,c.jsx)("h3",{children:"Scanning repositories for SMART Guidelines compatibility..."})]}),k&&(0,c.jsxs)("div",{className:"progress-container",children:[(0,c.jsx)("div",{className:"progress-bar",children:(0,c.jsx)("div",{className:"progress-fill",style:{width:`${k.progress}%`}})}),(0,c.jsx)("div",{className:"progress-info",children:(0,c.jsx)("div",{className:"unified-scanning-status",children:(0,c.jsxs)("div",{className:"scanning-header-unified",children:[(0,c.jsxs)("div",{className:"progress-stats",children:[(0,c.jsxs)("span",{className:"progress-text",children:[k.current,"/",k.total," repositories"]}),(0,c.jsxs)("span",{className:"progress-percentage",children:[k.progress,"%"]})]}),(0,c.jsxs)("div",{className:"currently-testing-unified",children:[(0,c.jsx)("span",{className:"scanning-icon",children:"\ud83d\udd0d"}),(0,c.jsx)("span",{children:"Currently Testing:"}),(0,c.jsx)("div",{className:"currently-scanning-repos",children:R.size>0?Array.from(R).map(e=>(0,c.jsxs)("div",{className:"scanning-repo-item",children:[(0,c.jsx)("span",{className:"repo-status-indicator",children:"\u26a1"}),(0,c.jsx)("span",{className:"scanning-repo-name",children:e})]},e)):(0,c.jsxs)("div",{className:"scanning-repo-item",children:[(0,c.jsx)("span",{className:"repo-status-indicator",children:"\u23f3"}),(0,c.jsx)("span",{className:"scanning-repo-name",children:"Preparing scan..."})]})})]})]})})}),(0,c.jsxs)("div",{className:"scanning-note",children:[(0,c.jsx)("span",{className:"note-icon",children:"\u26a1"}),(0,c.jsx)("span",{children:"Scanning up to 5 repositories concurrently to improve speed"})]})]}),(0,c.jsxs)("div",{className:"scanning-results",children:[(0,c.jsx)("p",{children:"Found repositories will appear below as they are discovered:"}),(0,c.jsx)("div",{className:"repo-grid",children:x.map(e=>{var s;return(0,c.jsxs)("div",{className:`repo-card ${(null===v||void 0===v?void 0:v.id)===e.id?"selected":""} scanning-found`,onClick:()=>O(e),children:[(0,c.jsxs)("div",{className:"repo-header-info",children:[(0,c.jsxs)("h3",{children:[e.name," ",(0,c.jsx)("span",{className:"new-badge",children:"\u2728 Found"})]}),(0,c.jsxs)("div",{className:"repo-meta",children:[e.is_template&&(0,c.jsx)("span",{className:"template-badge",children:(null===(s=e.template_config)||void 0===s?void 0:s.name)||"Template"}),e.private&&(0,c.jsx)("span",{className:"private-badge",children:"Private"}),e.language&&(0,c.jsx)("span",{className:"language-badge",children:e.language}),e.smart_guidelines_compatible&&(0,c.jsx)("span",{className:"compatible-badge",children:"SMART Guidelines"})]})]}),(0,c.jsx)("p",{className:"repo-description",children:e.description||"No description available"}),(0,c.jsxs)("div",{className:"repo-topics",children:[(e.topics||[]).slice(0,3).map(e=>(0,c.jsx)("span",{className:"topic-tag",children:e},e)),(e.topics||[]).length>3&&(0,c.jsxs)("span",{className:"topic-more",children:["+",(e.topics||[]).length-3," more"]})]}),(0,c.jsxs)("div",{className:"repo-stats",children:[(0,c.jsxs)("div",{className:"stat",children:[(0,c.jsx)("span",{className:"stat-icon",children:"\u2b50"}),(0,c.jsx)("span",{children:e.stargazers_count||0})]}),(0,c.jsxs)("div",{className:"stat",children:[(0,c.jsx)("span",{className:"stat-icon",children:"\ud83c\udf74"}),(0,c.jsx)("span",{children:e.forks_count||0})]}),(0,c.jsxs)("div",{className:"stat",children:[(0,c.jsx)("span",{className:"stat-icon",children:"\ud83d\udcc5"}),(0,c.jsxs)("span",{children:["Updated ",K(e.updated_at)]})]})]}),(null===v||void 0===v?void 0:v.id)===e.id&&(0,c.jsx)("div",{className:"selection-indicator",children:(0,c.jsx)("span",{children:"\u2713 Selected"})})]},e.id)})})]})]}):y?(0,c.jsxs)("div",{className:"error-state",children:[(0,c.jsx)("h3",{children:"Error loading repositories"}),(0,c.jsx)("p",{children:y}),(0,c.jsx)("button",{onClick:H,className:"retry-btn",children:"Try Again"})]}):0===x.length?(0,c.jsxs)("div",{className:"empty-state",children:[(0,c.jsx)("h3",{children:"No repositories found"}),(0,c.jsx)("p",{children:"create"===g?"Unable to load the WHO template repository.":"No DAK repositories found with SMART Guidelines compatibility."})]}):(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("div",{className:"repo-grid",children:x.map(e=>{var s;return(0,c.jsxs)("div",{className:"repo-card "+((null===v||void 0===v?void 0:v.id)===e.id?"selected":""),onClick:()=>O(e),children:[(0,c.jsxs)("div",{className:"repo-header-info",children:[(0,c.jsx)("h3",{children:e.name}),(0,c.jsxs)("div",{className:"repo-meta",children:[e.is_template&&(0,c.jsx)("span",{className:"template-badge",children:(null===(s=e.template_config)||void 0===s?void 0:s.name)||"Template"}),e.private&&(0,c.jsx)("span",{className:"private-badge",children:"Private"}),e.language&&(0,c.jsx)("span",{className:"language-badge",children:e.language}),e.smart_guidelines_compatible&&(0,c.jsx)("span",{className:"compatible-badge",children:"SMART Guidelines"})]})]}),(0,c.jsx)("p",{className:"repo-description",children:e.description||"No description available"}),(0,c.jsxs)("div",{className:"repo-topics",children:[(e.topics||[]).slice(0,3).map(e=>(0,c.jsx)("span",{className:"topic-tag",children:e},e)),(e.topics||[]).length>3&&(0,c.jsxs)("span",{className:"topic-more",children:["+",(e.topics||[]).length-3," more"]})]}),(0,c.jsxs)("div",{className:"repo-stats",children:[(0,c.jsxs)("div",{className:"stat",children:[(0,c.jsx)("span",{className:"stat-icon",children:"\u2b50"}),(0,c.jsx)("span",{children:e.stargazers_count||0})]}),(0,c.jsxs)("div",{className:"stat",children:[(0,c.jsx)("span",{className:"stat-icon",children:"\ud83c\udf74"}),(0,c.jsx)("span",{children:e.forks_count||0})]}),(0,c.jsxs)("div",{className:"stat",children:[(0,c.jsx)("span",{className:"stat-icon",children:"\ud83d\udcc5"}),(0,c.jsxs)("span",{children:["Updated ",K(e.updated_at)]})]})]}),(null===v||void 0===v?void 0:v.id)===e.id&&(0,c.jsx)("div",{className:"selection-indicator",children:(0,c.jsx)("span",{children:"\u2713 Selected"})})]},e.id)})}),(0,c.jsxs)("div",{className:"selection-footer",children:["edit"!==g&&(0,c.jsx)("button",{className:"continue-btn",onClick:()=>{if(!v)return void alert("Please select a repository to continue");const e=M();if("edit"===g){const s=D(v);if(s){const e=`/dashboard/${s.user}/${s.repo}`;a(e,{state:{profile:h,repository:v,action:g}})}else a(e.nextRoute,{state:{profile:h,repository:v,action:g}})}else a(e.nextRoute,{state:{profile:h,sourceRepository:v,action:g}})},disabled:!v,children:F.buttonText}),"edit"===g&&(0,c.jsxs)("div",{className:"direct-selection-note",children:[(0,c.jsx)("span",{className:"note-icon",children:"\ud83d\udca1"}),(0,c.jsx)("span",{children:"Click on a repository above to start editing its components"})]})]})]})]})})})},p=()=>(0,c.jsx)(l.Mx,{pageName:"dak-selection",showHeader:!0,children:(0,c.jsx)(d,{})})}}]);
//# sourceMappingURL=648.4e9b5fb8.chunk.js.map