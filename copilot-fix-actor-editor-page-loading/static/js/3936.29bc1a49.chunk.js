"use strict";(self.webpackChunksgex_workbench=self.webpackChunksgex_workbench||[]).push([[3936],{43936:(e,a,t)=>{t.r(a),t.d(a,{default:()=>x});var s=t(89379),i=t(9950),n=t(69396),o=t(57561),c=t(3611);const r=new class{constructor(){this.actorSchema=null,this.core=new c.ActorDefinitionCore,this.loadSchema()}async loadSchema(){try{const e=await fetch("".concat("/sgex/copilot-fix-actor-editor-page-loading","/schemas/actor-definition.json"));this.actorSchema=await e.json()}catch(e){console.warn("Could not load actor definition schema:",e)}}generateFSH(e){var a;if(!e||!e.id)throw new Error("Invalid actor definition: missing required fields");const t=[];return t.push("Profile: ".concat(e.id)),t.push("Parent: ActorDefinition"),t.push("Id: ".concat(e.id)),t.push('Title: "'.concat(this.escapeFSHString(e.name),'"')),t.push('Description: "'.concat(this.escapeFSHString(e.description),'"')),null!==(a=e.metadata)&&void 0!==a&&a.status&&t.push("* status = #".concat(e.metadata.status)),e.type&&t.push("* type = #".concat(e.type)),e.roles&&e.roles.length>0&&e.roles.forEach((e,a)=>{e.system&&t.push("* role[".concat(a,'].coding.system = "').concat(e.system,'"')),t.push("* role[".concat(a,"].coding.code = #").concat(e.code)),t.push("* role[".concat(a,'].coding.display = "').concat(this.escapeFSHString(e.display),'"'))}),e.qualifications&&e.qualifications.length>0&&e.qualifications.forEach((e,a)=>{t.push("* qualification[".concat(a,"].code.coding.code = #").concat(e.code)),t.push("* qualification[".concat(a,'].code.coding.display = "').concat(this.escapeFSHString(e.display),'"')),e.issuer&&t.push("* qualification[".concat(a,'].issuer.display = "').concat(this.escapeFSHString(e.issuer),'"'))}),e.specialties&&e.specialties.length>0&&e.specialties.forEach((e,a)=>{e.system&&t.push("* specialty[".concat(a,'].coding.system = "').concat(e.system,'"')),t.push("* specialty[".concat(a,"].coding.code = #").concat(e.code)),t.push("* specialty[".concat(a,'].coding.display = "').concat(this.escapeFSHString(e.display),'"'))}),e.location&&(e.location.type&&t.push("* location.type = #".concat(e.location.type)),e.location.description&&t.push('* location.description = "'.concat(this.escapeFSHString(e.location.description),'"'))),e.accessLevel&&t.push("* extension[accessLevel].valueCode = #".concat(e.accessLevel)),e.interactions&&e.interactions.length>0&&e.interactions.forEach((e,a)=>{t.push("* extension[interaction][".concat(a,"].extension[type].valueCode = #").concat(e.type)),t.push("* extension[interaction][".concat(a,'].extension[target].valueString = "').concat(this.escapeFSHString(e.target),'"')),e.description&&t.push("* extension[interaction][".concat(a,'].extension[description].valueString = "').concat(this.escapeFSHString(e.description),'"'))}),e.metadata&&(e.metadata.version&&t.push('* version = "'.concat(e.metadata.version,'"')),e.metadata.publisher&&t.push('* publisher = "'.concat(this.escapeFSHString(e.metadata.publisher),'"')),e.metadata.contact&&e.metadata.contact.length>0&&e.metadata.contact.forEach((e,a)=>{e.name&&t.push("* contact[".concat(a,'].name = "').concat(this.escapeFSHString(e.name),'"')),e.email&&(t.push("* contact[".concat(a,"].telecom.system = #email")),t.push("* contact[".concat(a,'].telecom.value = "').concat(e.email,'"')))})),t.join("\n")}escapeFSHString(e){return(0,c.escapeFSHString)(e)}async parseFSH(e){const a=await(0,c.extractFSHMetadata)(e);return{id:a.id||"",name:a.title||a.name||"",description:a.description||"",type:a.type||"person",roles:[],qualifications:[],specialties:[],interactions:[],metadata:{status:a.status||"draft"}}}validateActorDefinition(e){const a=[];return e.id&&e.id.match(/^[a-zA-Z][a-zA-Z0-9_-]*$/)||a.push("ID must start with a letter and contain only letters, numbers, underscores, and hyphens"),e.name&&0!==e.name.trim().length||a.push("Name is required"),e.description&&0!==e.description.trim().length||a.push("Description is required"),e.type||a.push("Actor type is required"),e.roles&&0!==e.roles.length?e.roles.forEach((e,t)=>{e.code&&e.display||a.push("Role ".concat(t+1," must have both code and display name"))}):a.push("At least one role is required"),{isValid:0===a.length,errors:a}}async saveToStagingGround(e){try{const a=this.validateActorDefinition(e);if(!a.isValid)throw new Error("Validation failed: ".concat(a.errors.join(", ")));const t=this.generateFSH(e),s="input/fsh/actors/".concat(e.id,".fsh");if(!o.A.updateFile(s,t,{type:"actor-definition",actorId:e.id,actorName:e.name,lastModified:Date.now(),source:"actor-editor"}))throw new Error("Failed to save to staging ground");return{success:!0,filePath:s,content:t}}catch(a){return console.error("Error saving actor definition:",a),{success:!1,error:a.message}}}getFromStagingGround(e){try{const a=o.A.getStagingGround(),t="input/fsh/actors/".concat(e,".fsh"),s=a.files.find(e=>e.path===t);if(!s)return null;return{actorDefinition:this.parseFSH(s.content),metadata:s.metadata,lastModified:s.timestamp}}catch(a){return console.error("Error loading actor definition from staging ground:",a),null}}listStagedActors(){try{return o.A.getStagingGround().files.filter(e=>{var a;return e.path.startsWith("input/fsh/actors/")&&e.path.endsWith(".fsh")&&"actor-definition"===(null===(a=e.metadata)||void 0===a?void 0:a.type)}).map(e=>{var a,t;return{id:(null===(a=e.metadata)||void 0===a?void 0:a.actorId)||e.path.split("/").pop().replace(".fsh",""),name:(null===(t=e.metadata)||void 0===t?void 0:t.actorName)||"Unknown Actor",filePath:e.path,lastModified:e.timestamp,metadata:e.metadata}}).sort((e,a)=>a.lastModified-e.lastModified)}catch(e){return console.error("Error listing staged actors:",e),[]}}removeFromStagingGround(e){try{const a="input/fsh/actors/".concat(e,".fsh");return o.A.removeFile(a)}catch(a){return console.error("Error removing actor definition:",a),!1}}createEmptyActorDefinition(){return{id:"",name:"",description:"",type:"person",roles:[{code:"",display:"",system:"http://snomed.info/sct"}],qualifications:[],specialties:[],location:{type:"facility",description:""},accessLevel:"standard",interactions:[],constraints:{availability:"",jurisdiction:"",limitations:[]},metadata:{version:"1.0.0",status:"draft",publisher:"",contact:[],tags:[]}}}getActorTemplates(){return[{id:"clinician-template",name:"Healthcare Clinician",description:"A qualified healthcare practitioner who provides direct patient care",type:"practitioner",roles:[{code:"158965000",display:"Medical practitioner",system:"http://snomed.info/sct"}],location:{type:"facility",description:"Healthcare facility or clinic"},accessLevel:"standard"},{id:"nurse-template",name:"Registered Nurse",description:"Licensed nursing professional providing patient care and health education",type:"practitioner",roles:[{code:"224535009",display:"Registered nurse",system:"http://snomed.info/sct"}],location:{type:"facility",description:"Hospital ward, clinic, or community health center"},accessLevel:"standard"},{id:"patient-template",name:"Patient",description:"Individual receiving healthcare services",type:"patient",roles:[{code:"116154003",display:"Patient",system:"http://snomed.info/sct"}],location:{type:"facility",description:"Any healthcare setting where patient receives care"},accessLevel:"read-only"},{id:"admin-template",name:"Healthcare Administrator",description:"Administrative staff managing healthcare operations and data",type:"person",roles:[{code:"394738000",display:"Other related persons",system:"http://snomed.info/sct"}],location:{type:"facility",description:"Administrative offices within healthcare organization"},accessLevel:"administrative"}]}};var l=t(53782),d=t(44414);const h=e=>{let{actorDefinition:a,errors:t,onFieldChange:s}=e;return(0,d.jsxs)("div",{className:"form-section",children:[(0,d.jsx)("h3",{children:"Basic Information"}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"id",children:"Actor ID *"}),(0,d.jsx)("input",{type:"text",id:"id",value:a.id,onChange:e=>s("id",e.target.value),className:t.id?"error":"",placeholder:"e.g., primary-care-physician",pattern:"[a-zA-Z][a-zA-Z0-9_-]*"}),t.id&&(0,d.jsx)("span",{className:"error-text",children:t.id}),(0,d.jsx)("span",{className:"help-text",children:"Unique identifier (letters, numbers, underscores, hyphens only)"})]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"name",children:"Display Name *"}),(0,d.jsx)("input",{type:"text",id:"name",value:a.name,onChange:e=>s("name",e.target.value),className:t.name?"error":"",placeholder:"e.g., Primary Care Physician"}),t.name&&(0,d.jsx)("span",{className:"error-text",children:t.name})]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"description",children:"Description *"}),(0,d.jsx)("textarea",{id:"description",value:a.description,onChange:e=>s("description",e.target.value),className:t.description?"error":"",placeholder:"Detailed description of the actor's role and responsibilities...",rows:4}),t.description&&(0,d.jsx)("span",{className:"error-text",children:t.description})]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"type",children:"Actor Type *"}),(0,d.jsxs)("select",{id:"type",value:a.type,onChange:e=>s("type",e.target.value),className:t.type?"error":"",children:[(0,d.jsx)("option",{value:"person",children:"Person"}),(0,d.jsx)("option",{value:"practitioner",children:"Practitioner"}),(0,d.jsx)("option",{value:"patient",children:"Patient"}),(0,d.jsx)("option",{value:"relatedperson",children:"Related Person"}),(0,d.jsx)("option",{value:"organization",children:"Organization"}),(0,d.jsx)("option",{value:"device",children:"Device"}),(0,d.jsx)("option",{value:"system",children:"System"})]}),t.type&&(0,d.jsx)("span",{className:"error-text",children:t.type})]})]})},p=e=>{let{actorDefinition:a,errors:t,onNestedFieldChange:s,onAddItem:i,onRemoveItem:n}=e;return(0,d.jsxs)("div",{className:"form-section",children:[(0,d.jsx)("h3",{children:"Roles & Qualifications"}),(0,d.jsxs)("div",{className:"subsection",children:[(0,d.jsxs)("div",{className:"subsection-header",children:[(0,d.jsx)("h4",{children:"Roles *"}),(0,d.jsx)("button",{type:"button",onClick:()=>i("roles",{code:"",display:"",system:"http://snomed.info/sct"}),className:"add-btn",children:"+ Add Role"})]}),t.roles&&(0,d.jsx)("span",{className:"error-text",children:t.roles}),a.roles&&a.roles.map((e,a)=>(0,d.jsxs)("div",{className:"array-item",children:[(0,d.jsxs)("div",{className:"array-item-header",children:[(0,d.jsxs)("span",{children:["Role ",a+1]}),(0,d.jsx)("button",{type:"button",onClick:()=>n("roles",a),className:"remove-btn",children:"Remove"})]}),(0,d.jsxs)("div",{className:"form-row",children:[(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"role-code-".concat(a),children:"Code *"}),(0,d.jsx)("input",{id:"role-code-".concat(a),type:"text",value:e.code,onChange:e=>s("roles",a,"code",e.target.value),className:t["roles.".concat(a,".code")]?"error":"",placeholder:"Role code"}),t["roles.".concat(a,".code")]&&(0,d.jsx)("span",{className:"error-text",children:t["roles.".concat(a,".code")]})]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"role-display-".concat(a),children:"Display Name *"}),(0,d.jsx)("input",{id:"role-display-".concat(a),type:"text",value:e.display,onChange:e=>s("roles",a,"display",e.target.value),className:t["roles.".concat(a,".display")]?"error":"",placeholder:"Human-readable role name"}),t["roles.".concat(a,".display")]&&(0,d.jsx)("span",{className:"error-text",children:t["roles.".concat(a,".display")]})]})]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"role-system-".concat(a),children:"Code System *"}),(0,d.jsx)("input",{id:"role-system-".concat(a),type:"text",value:e.system||"",onChange:e=>s("roles",a,"system",e.target.value),className:t["roles.".concat(a,".system")]?"error":"",placeholder:"http://snomed.info/sct"}),t["roles.".concat(a,".system")]&&(0,d.jsx)("span",{className:"error-text",children:t["roles.".concat(a,".system")]})]})]},a))]}),(0,d.jsxs)("div",{className:"subsection",children:[(0,d.jsxs)("div",{className:"subsection-header",children:[(0,d.jsx)("h4",{children:"Qualifications"}),(0,d.jsx)("button",{type:"button",onClick:()=>i("qualifications",{code:"",display:"",issuer:""}),className:"add-btn",children:"+ Add Qualification"})]}),a.qualifications&&a.qualifications.map((e,a)=>(0,d.jsxs)("div",{className:"array-item",children:[(0,d.jsxs)("div",{className:"array-item-header",children:[(0,d.jsxs)("span",{children:["Qualification ",a+1]}),(0,d.jsx)("button",{type:"button",onClick:()=>n("qualifications",a),className:"remove-btn",children:"Remove"})]}),(0,d.jsxs)("div",{className:"form-row",children:[(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"qualification-code-".concat(a),children:"Code *"}),(0,d.jsx)("input",{id:"qualification-code-".concat(a),type:"text",value:e.code,onChange:e=>s("qualifications",a,"code",e.target.value),className:t["qualifications.".concat(a,".code")]?"error":"",placeholder:"Qualification code"}),t["qualifications.".concat(a,".code")]&&(0,d.jsx)("span",{className:"error-text",children:t["qualifications.".concat(a,".code")]})]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"qualification-display-".concat(a),children:"Display Name *"}),(0,d.jsx)("input",{id:"qualification-display-".concat(a),type:"text",value:e.display,onChange:e=>s("qualifications",a,"display",e.target.value),className:t["qualifications.".concat(a,".display")]?"error":"",placeholder:"Qualification name"}),t["qualifications.".concat(a,".display")]&&(0,d.jsx)("span",{className:"error-text",children:t["qualifications.".concat(a,".display")]})]})]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"qualification-issuer-".concat(a),children:"Issuing Organization"}),(0,d.jsx)("input",{id:"qualification-issuer-".concat(a),type:"text",value:e.issuer||"",onChange:e=>s("qualifications",a,"issuer",e.target.value),placeholder:"Organization that issued this qualification"})]})]},a))]}),(0,d.jsxs)("div",{className:"subsection",children:[(0,d.jsxs)("div",{className:"subsection-header",children:[(0,d.jsx)("h4",{children:"Specialties"}),(0,d.jsx)("button",{type:"button",onClick:()=>i("specialties",{code:"",display:"",system:"http://snomed.info/sct"}),className:"add-btn",children:"+ Add Specialty"})]}),a.specialties&&a.specialties.map((e,a)=>(0,d.jsxs)("div",{className:"array-item",children:[(0,d.jsxs)("div",{className:"array-item-header",children:[(0,d.jsxs)("span",{children:["Specialty ",a+1]}),(0,d.jsx)("button",{type:"button",onClick:()=>n("specialties",a),className:"remove-btn",children:"Remove"})]}),(0,d.jsxs)("div",{className:"form-row",children:[(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"specialty-code-".concat(a),children:"Code"}),(0,d.jsx)("input",{id:"specialty-code-".concat(a),type:"text",value:e.code,onChange:e=>s("specialties",a,"code",e.target.value),placeholder:"Specialty code"})]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"specialty-display-".concat(a),children:"Display Name"}),(0,d.jsx)("input",{id:"specialty-display-".concat(a),type:"text",value:e.display,onChange:e=>s("specialties",a,"display",e.target.value),placeholder:"Specialty name"})]})]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"specialty-system-".concat(a),children:"Code System"}),(0,d.jsx)("input",{id:"specialty-system-".concat(a),type:"text",value:e.system||"",onChange:e=>s("specialties",a,"system",e.target.value),placeholder:"http://snomed.info/sct"})]})]},a))]})]})},m=e=>{var a,t;let{actorDefinition:i,errors:n,onFieldChange:o,onNestedFieldChange:c,onAddItem:r,onRemoveItem:l}=e;return(0,d.jsxs)("div",{className:"form-section",children:[(0,d.jsx)("h3",{children:"Context & Access"}),(0,d.jsxs)("div",{className:"subsection",children:[(0,d.jsx)("h4",{children:"Typical Location"}),(0,d.jsxs)("div",{className:"form-row",children:[(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"location-type",children:"Location Type"}),(0,d.jsxs)("select",{id:"location-type",value:(null===(a=i.location)||void 0===a?void 0:a.type)||"",onChange:e=>o("location",(0,s.A)((0,s.A)({},i.location),{},{type:e.target.value})),children:[(0,d.jsx)("option",{value:"facility",children:"Healthcare Facility"}),(0,d.jsx)("option",{value:"community",children:"Community"}),(0,d.jsx)("option",{value:"home",children:"Home"}),(0,d.jsx)("option",{value:"mobile",children:"Mobile"}),(0,d.jsx)("option",{value:"virtual",children:"Virtual/Remote"})]})]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"location-description",children:"Description"}),(0,d.jsx)("input",{id:"location-description",type:"text",value:(null===(t=i.location)||void 0===t?void 0:t.description)||"",onChange:e=>o("location",(0,s.A)((0,s.A)({},i.location),{},{description:e.target.value})),placeholder:"Describe the typical location"})]})]})]}),(0,d.jsxs)("div",{className:"subsection",children:[(0,d.jsx)("h4",{children:"System Access Level"}),(0,d.jsx)("div",{className:"form-group",children:(0,d.jsxs)("select",{value:i.accessLevel||"standard",onChange:e=>o("accessLevel",e.target.value),children:[(0,d.jsx)("option",{value:"read-only",children:"Read-Only"}),(0,d.jsx)("option",{value:"standard",children:"Standard"}),(0,d.jsx)("option",{value:"administrative",children:"Administrative"}),(0,d.jsx)("option",{value:"system",children:"System"})]})})]}),(0,d.jsxs)("div",{className:"subsection",children:[(0,d.jsxs)("div",{className:"subsection-header",children:[(0,d.jsx)("h4",{children:"Key Interactions"}),(0,d.jsx)("button",{type:"button",onClick:()=>r("interactions",{type:"reads",target:"",description:""}),className:"add-btn",children:"+ Add Interaction"})]}),i.interactions&&i.interactions.map((e,a)=>(0,d.jsxs)("div",{className:"array-item",children:[(0,d.jsxs)("div",{className:"array-item-header",children:[(0,d.jsxs)("span",{children:["Interaction ",a+1]}),(0,d.jsx)("button",{type:"button",onClick:()=>l("interactions",a),className:"remove-btn",children:"Remove"})]}),(0,d.jsxs)("div",{className:"form-row",children:[(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{children:"Type"}),(0,d.jsxs)("select",{value:e.type,onChange:e=>c("interactions",a,"type",e.target.value),children:[(0,d.jsx)("option",{value:"creates",children:"Creates"}),(0,d.jsx)("option",{value:"reads",children:"Reads"}),(0,d.jsx)("option",{value:"updates",children:"Updates"}),(0,d.jsx)("option",{value:"deletes",children:"Deletes"}),(0,d.jsx)("option",{value:"approves",children:"Approves"}),(0,d.jsx)("option",{value:"reviews",children:"Reviews"}),(0,d.jsx)("option",{value:"monitors",children:"Monitors"})]})]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{children:"Target"}),(0,d.jsx)("input",{type:"text",value:e.target,onChange:e=>c("interactions",a,"target",e.target.value),placeholder:"What the actor interacts with"})]})]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{children:"Description"}),(0,d.jsx)("input",{type:"text",value:e.description||"",onChange:e=>c("interactions",a,"description",e.target.value),placeholder:"Describe this interaction"})]})]},a))]})]})},u=e=>{var a,t,i,n,o,c;let{actorDefinition:r,errors:l,onFieldChange:h,onNestedFieldChange:p,onAddItem:m,onRemoveItem:u}=e;return(0,d.jsxs)("div",{className:"form-section",children:[(0,d.jsx)("h3",{children:"Metadata"}),(0,d.jsxs)("div",{className:"form-row",children:[(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{children:"Version"}),(0,d.jsx)("input",{type:"text",value:(null===(a=r.metadata)||void 0===a?void 0:a.version)||"",onChange:e=>h("metadata",(0,s.A)((0,s.A)({},r.metadata),{},{version:e.target.value})),placeholder:"1.0.0"})]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{children:"Status"}),(0,d.jsxs)("select",{value:(null===(t=r.metadata)||void 0===t?void 0:t.status)||"draft",onChange:e=>h("metadata",(0,s.A)((0,s.A)({},r.metadata),{},{status:e.target.value})),children:[(0,d.jsx)("option",{value:"draft",children:"Draft"}),(0,d.jsx)("option",{value:"active",children:"Active"}),(0,d.jsx)("option",{value:"retired",children:"Retired"})]})]})]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{children:"Publisher"}),(0,d.jsx)("input",{type:"text",value:(null===(i=r.metadata)||void 0===i?void 0:i.publisher)||"",onChange:e=>h("metadata",(0,s.A)((0,s.A)({},r.metadata),{},{publisher:e.target.value})),placeholder:"Organization or person responsible"})]}),(0,d.jsxs)("div",{className:"subsection",children:[(0,d.jsxs)("div",{className:"subsection-header",children:[(0,d.jsx)("h4",{children:"Contact Information"}),(0,d.jsx)("button",{type:"button",onClick:()=>m("metadata.contact",{name:"",email:""}),className:"add-btn",children:"+ Add Contact"})]}),(null===(n=r.metadata)||void 0===n?void 0:n.contact)&&r.metadata.contact.map((e,a)=>(0,d.jsxs)("div",{className:"array-item",children:[(0,d.jsxs)("div",{className:"array-item-header",children:[(0,d.jsxs)("span",{children:["Contact ",a+1]}),(0,d.jsx)("button",{type:"button",onClick:()=>{const e=[...r.metadata.contact||[]];e.splice(a,1),h("metadata",(0,s.A)((0,s.A)({},r.metadata),{},{contact:e}))},className:"remove-btn",children:"Remove"})]}),(0,d.jsxs)("div",{className:"form-row",children:[(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{children:"Name"}),(0,d.jsx)("input",{type:"text",value:e.name||"",onChange:t=>{const i=[...r.metadata.contact||[]];i[a]=(0,s.A)((0,s.A)({},e),{},{name:t.target.value}),h("metadata",(0,s.A)((0,s.A)({},r.metadata),{},{contact:i}))},placeholder:"Contact name"})]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{children:"Email"}),(0,d.jsx)("input",{type:"email",value:e.email||"",onChange:t=>{const i=[...r.metadata.contact||[]];i[a]=(0,s.A)((0,s.A)({},e),{},{email:t.target.value}),h("metadata",(0,s.A)((0,s.A)({},r.metadata),{},{contact:i}))},placeholder:"contact@example.com"})]})]})]},a))]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{children:"Tags"}),(0,d.jsx)("input",{type:"text",value:(null===(o=r.metadata)||void 0===o||null===(c=o.tags)||void 0===c?void 0:c.join(", "))||"",onChange:e=>h("metadata",(0,s.A)((0,s.A)({},r.metadata),{},{tags:e.target.value.split(",").map(e=>e.trim()).filter(e=>e)})),placeholder:"Enter tags separated by commas"}),(0,d.jsx)("span",{className:"help-text",children:"Comma-separated tags for categorization"})]})]})},v=()=>{(0,n.Zp)();const{profile:e,repository:a,branch:t,loading:o,error:c}=(0,l.N5)(),v=null,[x,g]=(0,i.useState)(null),[j,y]=(0,i.useState)(!0),[f,b]=(0,i.useState)(!1),[N,C]=(0,i.useState)({}),[A,S]=(0,i.useState)(!1),[F,w]=(0,i.useState)(""),[q,k]=(0,i.useState)([]),[D,R]=(0,i.useState)(!1),[H,I]=(0,i.useState)("basic"),[E,P]=(0,i.useState)(""),L=(0,i.useCallback)(async()=>{y(!0);try{g(r.createEmptyActorDefinition());const e=r.listStagedActors();k(e)}catch(e){console.error("Error initializing actor editor:",e),C({initialization:"Failed to initialize editor"})}finally{y(!1)}},[v]);(0,i.useEffect)(()=>{o||c||L()},[o,c,L]);const T=(0,i.useCallback)((e,a)=>{g(t=>(0,s.A)((0,s.A)({},t),{},{[e]:a})),N[e]&&C(a=>{const t=(0,s.A)({},a);return delete t[e],t})},[N]),z=(0,i.useCallback)((e,a,t,i)=>{g(n=>{const o=(0,s.A)({},n);return o[e]||(o[e]=[]),o[e][a]||(o[e][a]={}),o[e][a][t]=i,o});const n="".concat(e,".").concat(a,".").concat(t);N[n]&&C(e=>{const a=(0,s.A)({},e);return delete a[n],a})},[N]),M=(0,i.useCallback)(function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};g(t=>(0,s.A)((0,s.A)({},t),{},{[e]:[...t[e]||[],a]}))},[]),Q=(0,i.useCallback)((e,a)=>{g(t=>(0,s.A)((0,s.A)({},t),{},{[e]:t[e].filter((e,t)=>t!==a)}))},[]),G=(0,i.useCallback)(()=>{const e={};return null!==x&&void 0!==x&&x.id||(e.id="Actor ID is required"),null!==x&&void 0!==x&&x.name||(e.name="Actor name is required"),null!==x&&void 0!==x&&x.description||(e.description="Actor description is required"),null!==x&&void 0!==x&&x.type||(e.type="Actor type is required"),null!==x&&void 0!==x&&x.roles&&x.roles.forEach((a,t)=>{a.code||(e["roles.".concat(t,".code")]="Role code is required"),a.display||(e["roles.".concat(t,".display")]="Role display name is required"),a.system||(e["roles.".concat(t,".system")]="Role system is required")}),null!==x&&void 0!==x&&x.qualifications&&x.qualifications.forEach((a,t)=>{a.code||(e["qualifications.".concat(t,".code")]="Qualification code is required"),a.display||(e["qualifications.".concat(t,".display")]="Qualification display name is required")}),C(e),0===Object.keys(e).length},[x]),O=(0,i.useCallback)(()=>{if(x)try{const e=r.generateFSH(x);w(e),S(!0)}catch(e){console.error("Error generating FSH preview:",e),C({general:"Failed to generate FSH preview: "+e.message})}},[x]),U=(0,i.useCallback)(async()=>{console.log("handleSave called with actorDefinition:",x);const e=G();if(console.log("Form validation result:",e,"Errors:",N),!e){console.log("Form validation failed - showing errors");const e=Object.keys(N).filter(e=>"general"!==e),a=e.length;let t="Please fix ".concat(a," validation error").concat(1!==a?"s":""," before saving:\n");const i=e.filter(e=>!e.includes(".")),n=e.filter(e=>e.includes("."));if(i.length>0&&(t+="\n\u2022 Basic fields: "+i.map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(", ")),n.length>0){const e=n.filter(e=>e.startsWith("roles.")),a=n.filter(e=>e.startsWith("qualifications."));e.length>0&&(t+="\n\u2022 Role fields are missing or invalid (check the Roles tab)"),a.length>0&&(t+="\n\u2022 Qualification fields are missing or invalid (check the Roles tab)")}return t+="\n\nLook for red highlighted fields and error messages below each field.",void C(e=>(0,s.A)((0,s.A)({},e),{},{general:t}))}b(!0),C({}),P("");try{console.log("Calling saveToStagingGround...");const e=await r.saveToStagingGround(x);if(console.log("Save result:",e),e.success){const e=r.listStagedActors();console.log("Staged actors after save:",e),k(e),P('\u2705 Saved "'.concat(x.name,'" to staging ground')),setTimeout(()=>P(""),3e3)}else console.error("Save failed:",e.error),C({general:e.error||"Failed to save actor definition"})}catch(a){console.error("Error saving actor definition:",a),C({general:"Failed to save actor definition: "+a.message})}finally{b(!1)}},[x,G,N]),V=(0,i.useCallback)(e=>{const a=r.getActorTemplates().find(a=>a.id===e);a&&g(a)},[]),W=(0,i.useCallback)(e=>{const a=r.getFromStagingGround(e);a&&(g(a.actorDefinition),R(!1))},[]),Z=(0,i.useCallback)(e=>{if(window.confirm("Are you sure you want to delete this staged actor?")){r.removeFromStagingGround(e);const a=r.listStagedActors();k(a)}},[]);return c?(0,d.jsx)("div",{className:"actor-editor-container",children:(0,d.jsxs)("div",{className:"error-message",children:[(0,d.jsx)("h2",{children:"Page Context Error"}),(0,d.jsx)("p",{children:c}),(0,d.jsx)("p",{children:"This component requires a DAK repository context to function properly."})]})}):o?(0,d.jsx)("div",{className:"actor-editor-container",children:(0,d.jsxs)("div",{className:"loading-message",children:[(0,d.jsx)("h2",{children:"Loading..."}),(0,d.jsx)("p",{children:"Initializing page context..."})]})}):(0,d.jsxs)("div",{className:"actor-editor",children:[j?(0,d.jsx)("div",{className:"loading-state",children:(0,d.jsxs)("div",{className:"loading-content",children:[(0,d.jsx)("h2",{children:"Loading Actor Editor..."}),(0,d.jsx)("p",{children:"Initializing editor and loading data..."})]})}):(0,d.jsxs)("div",{className:"editor-content",children:[(0,d.jsxs)("div",{className:"editor-toolbar",children:[(0,d.jsxs)("div",{className:"toolbar-left",children:[(0,d.jsxs)("button",{onClick:()=>R(!D),className:"toolbar-btn",title:"Browse staged actors",children:["\ud83d\udccb Staged Actors (",q.length,")"]}),(0,d.jsx)("button",{onClick:O,className:"toolbar-btn",disabled:!(null!==x&&void 0!==x&&x.id),title:"Preview FSH output",children:"\ud83d\udc41\ufe0f Preview FSH"})]}),(0,d.jsx)("div",{className:"toolbar-right",children:(0,d.jsx)("button",{onClick:U,disabled:f||!(null!==x&&void 0!==x&&x.id),className:"toolbar-btn primary",title:"Save to staging ground",children:f?"\ud83d\udcbe Saving...":"\ud83d\udcbe Save"})})]}),E&&(0,d.jsx)("div",{className:"success-message",style:{padding:"10px",marginTop:"10px",backgroundColor:"#d4edda",color:"#155724",border:"1px solid #c3e6cb",borderRadius:"4px"},children:E}),N.general&&(0,d.jsxs)("div",{className:"error-message",children:[(0,d.jsx)("strong",{children:"Error:"})," ",N.general]}),(0,d.jsxs)("div",{className:"editor-layout",children:[D&&(0,d.jsxs)("div",{className:"actor-list-sidebar",children:[(0,d.jsxs)("div",{className:"sidebar-header",children:[(0,d.jsx)("h3",{children:"Staged Actors"}),(0,d.jsx)("button",{onClick:()=>R(!1),className:"close-btn",children:"\u2715"})]}),(0,d.jsxs)("div",{className:"sidebar-content",children:[(0,d.jsxs)("div",{className:"templates-section",children:[(0,d.jsx)("h4",{children:"Templates"}),r.getActorTemplates().map(e=>(0,d.jsxs)("div",{className:"template-item",children:[(0,d.jsx)("span",{className:"template-name",children:e.name}),(0,d.jsx)("button",{onClick:()=>V(e),className:"load-btn",children:"Use"})]},e.id))]}),q.length>0&&(0,d.jsxs)("div",{className:"staged-actors-section",children:[(0,d.jsx)("h4",{children:"Staged Actors"}),q.map(e=>(0,d.jsxs)("div",{className:"staged-actor-item",children:[(0,d.jsxs)("div",{className:"actor-info",children:[(0,d.jsx)("span",{className:"actor-name",children:e.name}),(0,d.jsx)("span",{className:"actor-id",children:e.id}),(0,d.jsx)("span",{className:"actor-modified",children:new Date(e.lastModified).toLocaleDateString()})]}),(0,d.jsxs)("div",{className:"actor-actions",children:[(0,d.jsx)("button",{onClick:()=>W(e.id),className:"load-btn",children:"Edit"}),(0,d.jsx)("button",{onClick:()=>Z(e.id),className:"delete-btn",children:"\ud83d\uddd1\ufe0f"})]})]},e.id))]})]})]}),(0,d.jsx)("div",{className:"main-editor ".concat(D?"with-sidebar":""),children:x&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("div",{className:"editor-tabs",children:[(0,d.jsx)("button",{className:"tab ".concat("basic"===H?"active":""),onClick:()=>I("basic"),children:"Basic Info"}),(0,d.jsx)("button",{className:"tab ".concat("roles"===H?"active":""),onClick:()=>I("roles"),children:"Roles & Qualifications"}),(0,d.jsx)("button",{className:"tab ".concat("context"===H?"active":""),onClick:()=>I("context"),children:"Context & Access"}),(0,d.jsx)("button",{className:"tab ".concat("metadata"===H?"active":""),onClick:()=>I("metadata"),children:"Metadata"})]}),(0,d.jsxs)("div",{className:"tab-content",children:["basic"===H&&(0,d.jsx)(h,{actorDefinition:x,errors:N,onFieldChange:T}),"roles"===H&&(0,d.jsx)(p,{actorDefinition:x,errors:N,onNestedFieldChange:z,onAddItem:M,onRemoveItem:Q}),"context"===H&&(0,d.jsx)(m,{actorDefinition:x,errors:N,onFieldChange:T,onNestedFieldChange:z,onAddItem:M,onRemoveItem:Q}),"metadata"===H&&(0,d.jsx)(u,{actorDefinition:x,errors:N,onFieldChange:T,onNestedFieldChange:z,onAddItem:M,onRemoveItem:Q})]})]})})]})]}),A&&(0,d.jsx)("div",{className:"modal-overlay",onClick:()=>S(!1),role:"presentation",children:(0,d.jsxs)("div",{className:"modal-content",onClick:e=>e.stopPropagation(),role:"dialog","aria-labelledby":"fsh-preview-title","aria-modal":"true",children:[(0,d.jsxs)("div",{className:"modal-header",children:[(0,d.jsx)("h3",{id:"fsh-preview-title",children:"FSH Preview"}),(0,d.jsx)("button",{onClick:()=>S(!1),className:"close-btn",children:"\u2715"})]}),(0,d.jsx)("div",{className:"modal-body",children:(0,d.jsx)("pre",{className:"fsh-preview",children:F})}),(0,d.jsx)("div",{className:"modal-footer",children:(0,d.jsx)("button",{onClick:()=>{navigator.clipboard.writeText(F),alert("FSH copied to clipboard!")},className:"copy-btn",children:"\ud83d\udccb Copy to Clipboard"})})]})})]})},x=()=>(0,d.jsx)(l.Mx,{pageName:"actor-editor",children:(0,d.jsx)(v,{})})}}]);