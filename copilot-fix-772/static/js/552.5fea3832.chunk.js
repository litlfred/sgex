"use strict";(self.webpackChunksgex_workbench=self.webpackChunksgex_workbench||[]).push([[552],{18552:(e,a,s)=>{s.r(a),s.d(a,{default:()=>h});var n=s(89379),t=s(9950),i=s(91018),o=s(29946),r=s(29473),l=s(37210),c=s(83111),d=s(44414);const h=()=>{const[e,a]=(0,t.useState)(null),[s,h]=(0,t.useState)([]),[u,g]=(0,t.useState)(!1),[m,p]=(0,t.useState)(!1),[x,v]=(0,t.useState)(null),[j,f]=(0,t.useState)({}),[N,b]=(0,t.useState)(null),k=(0,i.Zp)(),A=(0,i.zy)(),w=(0,t.useCallback)((e,a)=>{if(!o.A.isAuth())return;const s={};if(e){const a=r.A.getCachedRepositories(e.login,"user");a&&a.repositories&&(s["user-".concat(e.login)]=a.repositories.length)}a.forEach(e=>{const a=r.A.getCachedRepositories(e.login,"org");a&&a.repositories&&(s["org-".concat(e.login)]=a.repositories.length)}),f(s)},[]),y=(0,t.useCallback)(async()=>{p(!0),v(null);try{await o.A.checkTokenPermissions();const s=await o.A.getCurrentUser();a(s);let t=[];if(o.A.isAuth())try{t=await o.A.getUserOrganizations()}catch(x){console.error("Error fetching organizations:",x),t=[]}try{const e=await o.A.getWHOOrganization(),a=t.findIndex(e=>"WorldHealthOrganization"===e.login);a>=0?t[a]=(0,n.A)((0,n.A)((0,n.A)({},t[a]),e),{},{isWHO:!0}):t.unshift(e)}catch(e){console.warn("Could not fetch WHO organization data, using fallback:",e);const a={id:"who-organization",login:"WorldHealthOrganization",name:"World Health Organization",description:"The World Health Organization is a specialized agency of the United Nations responsible for international public health.",avatar_url:"https://avatars.githubusercontent.com/u/12261302?s=200&v=4",html_url:"https://github.com/WorldHealthOrganization",type:"Organization",isWHO:!0};t.some(e=>"WorldHealthOrganization"===e.login)?t=t.map(e=>"WorldHealthOrganization"===e.login?(0,n.A)((0,n.A)({},e),{},{isWHO:!0}):e):t.unshift(a)}h(t),w(s,t)}catch(x){console.error("Error fetching user data:",x),v("Failed to fetch user data. Please check your connection and try again."),g(!1),sessionStorage.removeItem("github_token"),localStorage.removeItem("github_token")}finally{p(!1)}},[w]);(0,t.useEffect)(()=>{(()=>{const e=sessionStorage.getItem("github_token")||localStorage.getItem("github_token");if(e){o.A.authenticate(e)?g(!0):(sessionStorage.removeItem("github_token"),localStorage.removeItem("github_token"))}})()},[]),(0,t.useEffect)(()=>{var e;null!==(e=A.state)&&void 0!==e&&e.warningMessage&&(b(A.state.warningMessage),k(A.pathname,{replace:!0,state:{}}))},[A.state,k,A.pathname]),(0,t.useEffect)(()=>{u&&!e&&y()},[u,e,y]);const S=e=>{k("/dak-action/".concat(e.login),{state:{profile:e}})},O=()=>{b(null)};return(0,d.jsx)(c.Mx,{pageName:"landing",showHeader:!1,children:(0,d.jsxs)("div",{className:"landing-page",children:[(0,d.jsxs)("div",{className:"landing-header",children:[(0,d.jsxs)("div",{className:"who-branding",children:[(0,d.jsx)("h1",{className:"clickable-title",children:"SGEX Workbench"}),(0,d.jsx)("p",{className:"subtitle",children:"WHO SMART Guidelines Exchange"})]}),u?(0,d.jsxs)("div",{className:"user-info",children:[(0,d.jsx)("img",{src:null===e||void 0===e?void 0:e.avatar_url,alt:"User avatar",className:"user-avatar"}),(0,d.jsx)("span",{children:(null===e||void 0===e?void 0:e.name)||(null===e||void 0===e?void 0:e.login)}),(0,d.jsx)("a",{href:"/sgex/docs/overview",className:"nav-link",children:"\ud83d\udcd6 Documentation"}),(0,d.jsx)("button",{onClick:()=>{o.A.logout(),g(!1),a(null),h([]),v(null)},className:"logout-btn",children:"Logout"})]}):(0,d.jsx)("div",{className:"header-nav",children:(0,d.jsx)("a",{href:"/sgex/docs/overview",className:"nav-link",children:"\ud83d\udcd6 Documentation"})})]}),(0,d.jsx)("div",{className:"landing-content",children:u?(0,d.jsxs)(d.Fragment,{children:[N&&(0,d.jsx)("div",{className:"warning-message",children:(0,d.jsxs)("div",{className:"warning-content",children:[(0,d.jsx)("span",{className:"warning-icon",children:"\u26a0\ufe0f"}),(0,d.jsx)("span",{className:"warning-text",children:N}),(0,d.jsx)("button",{className:"warning-dismiss",onClick:O,"aria-label":"Dismiss warning",children:"\xd7"})]})}),m?(0,d.jsxs)("div",{className:"loading-section",children:[(0,d.jsx)("div",{className:"spinner"}),(0,d.jsx)("p",{children:"Loading profile data..."})]}):(0,d.jsxs)("div",{className:"profile-selection",children:[(0,d.jsx)("h2",{children:"Select Profile or Organization"}),(0,d.jsx)("p",{children:"Choose the GitHub profile or organization containing your DAK repositories:"}),x&&(0,d.jsx)("div",{className:"error-message",children:x}),(0,d.jsxs)("div",{className:"profile-grid",children:[(0,d.jsxs)("div",{className:"profile-card",onClick:()=>S((0,n.A)({type:"user"},e)),children:[(0,d.jsxs)("div",{className:"profile-card-header",children:[(0,d.jsx)("img",{src:null===e||void 0===e?void 0:e.avatar_url,alt:"Personal profile"}),j["user-".concat(null===e||void 0===e?void 0:e.login)]>0&&(0,d.jsx)("div",{className:"dak-count-badge",children:j["user-".concat(null===e||void 0===e?void 0:e.login)]})]}),(0,d.jsx)("h3",{children:(null===e||void 0===e?void 0:e.name)||(null===e||void 0===e?void 0:e.login)}),(0,d.jsx)("p",{children:"Personal repositories"}),(0,d.jsx)("div",{className:"profile-badges",children:(0,d.jsx)("span",{className:"profile-type",children:"Personal"})})]}),s.map(e=>(0,d.jsxs)("div",{className:"profile-card ".concat(e.isWHO?"who-org":""),onClick:()=>S((0,n.A)({type:"org"},e)),children:[(0,d.jsxs)("div",{className:"profile-card-header",children:[(0,d.jsx)("img",{src:e.avatar_url||"https://github.com/".concat(e.login,".png"),alt:"".concat(e.name||e.login," organization")}),j["org-".concat(e.login)]>0&&(0,d.jsx)("div",{className:"dak-count-badge",children:j["org-".concat(e.login)]})]}),(0,d.jsx)("h3",{children:e.name||e.login}),(0,d.jsxs)("p",{children:["@",e.login]}),(0,d.jsxs)("div",{className:"profile-badges",children:[(0,d.jsx)("span",{className:"profile-type",children:"Organization"}),e.isWHO&&(0,d.jsx)("span",{className:"who-badge",children:"WHO Official"})]})]},e.login))]})]})]}):(0,d.jsxs)(d.Fragment,{children:[N&&(0,d.jsx)("div",{className:"warning-message",children:(0,d.jsxs)("div",{className:"warning-content",children:[(0,d.jsx)("span",{className:"warning-icon",children:"\u26a0\ufe0f"}),(0,d.jsx)("span",{className:"warning-text",children:N}),(0,d.jsx)("button",{className:"warning-dismiss",onClick:O,"aria-label":"Dismiss warning",children:"\xd7"})]})}),(0,d.jsxs)("div",{className:"welcome-section",children:[(0,d.jsx)("h2",{children:"Welcome to SGEX Workbench"}),(0,d.jsx)("p",{children:"A browser-based, standards-compliant collaborative editor for WHO SMART Guidelines Digital Adaptation Kits (DAKs)."}),(0,d.jsxs)("div",{className:"auth-section",children:[(0,d.jsx)("p",{children:"Connect your GitHub account to get started:"}),(0,d.jsx)(l.A,{onAuthSuccess:(e,a)=>{sessionStorage.setItem("github_token",e),o.A.authenticateWithOctokit(a),g(!0),v(null),y()}}),x&&(0,d.jsx)("div",{className:"error-message",children:x})]}),(0,d.jsxs)("div",{className:"demo-section",children:[(0,d.jsx)("p",{children:"Want to try without authentication?"}),(0,d.jsx)("button",{onClick:()=>{const e={login:"demo-user",name:"Demo User",avatar_url:"https://github.com/github.png",type:"User",isDemo:!0};k("/dak-selection/".concat(e.login),{state:{profile:e,action:"edit"}})},className:"demo-mode-btn",children:"\ud83c\udfad Try Demo Mode"}),(0,d.jsx)("p",{className:"demo-note",children:"Demo mode showcases the enhanced DAK scanning display with mock data."})]}),(0,d.jsx)("div",{className:"info-section",children:(0,d.jsxs)("p",{children:["Need help getting started? Check out our comprehensive"," ",(0,d.jsx)("a",{href:"/sgex/docs/overview",className:"doc-link",children:"documentation"})," ","to learn more about SGEX Workbench and DAK components."]})})]})]})})]})})}},37210:(e,a,s)=>{s.d(a,{A:()=>r});var n=s(9950),t=s(67818),i=s(85571),o=s(44414);const r=e=>{let{onAuthSuccess:a}=e;const{t:r}=(0,t.Bd)(),[l,c]=(0,n.useState)(""),[d,h]=(0,n.useState)(""),[u,g]=(0,n.useState)(""),[m,p]=(0,n.useState)(!1),x=i.A.getLogger("PATLogin");n.useEffect(()=>(x.componentMount({hasOnAuthSuccess:!!a}),()=>x.componentUnmount()),[x,a]);return(0,o.jsx)("div",{className:"pat-login",children:(0,o.jsxs)("div",{className:"pat-login-section",children:[(0,o.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),x.userAction("PAT login attempt",{tokenProvided:!!l.trim()}),!l.trim()){return g("Please enter a GitHub Personal Access Token"),void x.warn("PAT login failed - no token provided")}p(!0),g("");const n=Date.now();x.auth("Starting PAT authentication");try{const{Octokit:e}=await s.e(112).then(s.bind(s,10112)),t=new e({auth:l.trim()});x.debug("Octokit instance created for PAT validation"),x.apiCall("GET","/user",null);const i=await t.rest.users.getAuthenticated(),o=Date.now()-n;x.apiResponse("GET","/user",i.status,o),x.auth("PAT authentication successful",{username:i.data.login,duration:o}),a(l.trim(),t)}catch(t){const e=Date.now()-n;x.apiError("GET","/user",t),x.auth("PAT authentication failed",{status:t.status,message:t.message,duration:e}),console.error("PAT authentication failed:",t),401===t.status?g("Invalid Personal Access Token. Please check your token and try again."):403===t.status?g("Token doesn't have sufficient permissions. Please ensure your token has 'repo' and 'read:org' scopes."):g("Authentication failed. Please check your connection and try again.")}finally{p(!1)}},className:"pat-form",children:[(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{htmlFor:"token-name",children:"Token Name (optional):"}),(0,o.jsx)("input",{id:"token-name",type:"text",value:d,onChange:e=>{h(e.target.value),u&&g("")},placeholder:"e.g., SGEX Access Token",className:"token-name-input",disabled:m,autoComplete:"username"})]}),(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsxs)("label",{htmlFor:"pat-token",children:[r("auth.setupToken"),":"]}),(0,o.jsx)("input",{id:"pat-token",type:"password",value:l,onChange:e=>{c(e.target.value),u&&g("")},placeholder:"ghp_xxxxxxxxxxxxxxxxxxxx",className:"token-input ".concat(u?"error":""),disabled:m,autoComplete:"current-password"})]}),(0,o.jsx)("button",{type:"submit",className:"github-login-btn",disabled:m||!l.trim(),children:m?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("span",{className:"spinner small"}),r("common.loading"),"..."]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("span",{className:"github-icon",children:"\ud83d\udd11"}),r("auth.signInWithPAT")]})})]}),u&&(0,o.jsx)("div",{className:"error-message",children:u})]})})}}}]);