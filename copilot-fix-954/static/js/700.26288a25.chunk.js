"use strict";(self.webpackChunksgex_workbench=self.webpackChunksgex_workbench||[]).push([[700],{98700:(a,e,s)=>{s.r(e),s.d(e,{default:()=>g});var i=s(89379),n=s(9950),l=s(85001),t=s(67818),o=s(29946),r=s(29473),c=s(90973),d=s(1932),h=s(44414);const g=()=>{const{t:a}=(0,t.Bd)(),[e,s]=(0,n.useState)(null),[g,u]=(0,n.useState)([]),[p,m]=(0,n.useState)(!1),[x,f]=(0,n.useState)(!1),[j,v]=(0,n.useState)(null),[N,b]=(0,n.useState)({}),[w,z]=(0,n.useState)(null),k=(0,l.Zp)(),O=(0,l.zy)(),A=(0,n.useCallback)((a,e)=>{if(!o.A.isAuth())return;const s={};if(a){const e=r.A.getCachedRepositories(a.login,"user");e&&e.repositories&&(s["user-".concat(a.login)]=e.repositories.length)}e.forEach(a=>{const e=r.A.getCachedRepositories(a.login,"org");e&&e.repositories&&(s["org-".concat(a.login)]=e.repositories.length)}),b(s)},[]),y=(0,n.useCallback)(async()=>{f(!0),v(null);try{let e=null;p?(await o.A.checkTokenPermissions(),e=await o.A.getCurrentUser(),s(e)):(e=null,s(null));let n=[];if(p)try{n=await o.A.getUserOrganizations()}catch(j){console.error("Error fetching organizations:",j),n=[]}try{const a=await o.A.getWHOOrganization(),e=n.findIndex(a=>"WorldHealthOrganization"===a.login);e>=0?n[e]=(0,i.A)((0,i.A)((0,i.A)({},n[e]),a),{},{isWHO:!0}):n.unshift(a)}catch(a){console.warn("Could not fetch WHO organization data, using fallback:",a);const e={id:"who-organization",login:"WorldHealthOrganization",name:"World Health Organization",description:"The World Health Organization is a specialized agency of the United Nations responsible for international public health.",avatar_url:"https://avatars.githubusercontent.com/u/12261302?s=200&v=4",html_url:"https://github.com/WorldHealthOrganization",type:"Organization",isWHO:!0};n.some(a=>"WorldHealthOrganization"===a.login)?n=n.map(a=>"WorldHealthOrganization"===a.login?(0,i.A)((0,i.A)({},a),{},{isWHO:!0}):a):n.unshift(e)}u(n),p&&A(e,n)}catch(j){console.error("Error fetching user data:",j),p?(v("Failed to fetch user data. Please check your connection and try again."),m(!1),o.A.logout()):v("Unable to fetch additional data. Some features may be limited.")}finally{f(!1)}},[A,p]);(0,n.useEffect)(()=>{(()=>{const a=o.A.initializeFromStoredToken();m(!!a)})()},[]),(0,n.useEffect)(()=>{var a;null!==(a=O.state)&&void 0!==a&&a.warningMessage&&(z(O.state.warningMessage),k(O.pathname,{replace:!0,state:{}}))},[O.state,k,O.pathname]),(0,n.useEffect)(()=>{e||y()},[e,y]);const H=(a,e)=>{const s={profile:e};(0,d.hX)(a,"/dak-action/".concat(e.login),k,s)};return(0,h.jsx)(c.Mx,{pageName:"select-profile",children:x&&!e?(0,h.jsxs)("div",{className:"loading-section",children:[(0,h.jsx)("div",{className:"spinner"}),(0,h.jsx)("p",{children:"Loading profile data..."})]}):(0,h.jsxs)("div",{className:"select-profile-content",children:[w&&(0,h.jsx)("div",{className:"warning-message",children:(0,h.jsxs)("div",{className:"warning-content",children:[(0,h.jsxs)("div",{className:"warning-header",children:[(0,h.jsx)("span",{className:"warning-icon",children:"\u26a0\ufe0f"}),(0,h.jsx)("span",{className:"warning-text",children:w})]}),(0,h.jsx)("button",{className:"warning-dismiss",onClick:()=>{z(null)},"aria-label":"Dismiss warning",children:"\xd7 Dismiss"})]})}),!p&&(0,h.jsx)("div",{className:"auth-status-message",children:(0,h.jsxs)("div",{className:"auth-status-content",children:[(0,h.jsx)("span",{className:"auth-status-icon",children:"\ud83d\udd13"}),(0,h.jsx)("span",{className:"auth-status-text",children:"You are browsing in unauthenticated mode. Some features like saving to GitHub will be disabled, but you can still explore and use local staging."})]})}),x?(0,h.jsxs)("div",{className:"loading-section",children:[(0,h.jsx)("div",{className:"spinner"}),(0,h.jsx)("p",{children:"Loading profile data..."})]}):(0,h.jsxs)("div",{className:"profile-selection",children:[(0,h.jsx)("h2",{children:a("organization.select")}),(0,h.jsxs)("p",{children:[a("organization.personal"),":"]}),j&&(0,h.jsx)("div",{className:"error-message",children:j}),(0,h.jsxs)("div",{className:"profile-grid-horizontal",children:[p&&e&&(0,h.jsxs)("div",{className:"profile-card",onClick:a=>H(a,(0,i.A)({type:"user"},e)),children:[(0,h.jsxs)("div",{className:"profile-card-header",children:[(0,h.jsx)("img",{src:null===e||void 0===e?void 0:e.avatar_url,alt:"Personal profile"}),N["user-".concat(null===e||void 0===e?void 0:e.login)]>0&&(0,h.jsx)("div",{className:"dak-count-badge",children:N["user-".concat(null===e||void 0===e?void 0:e.login)]})]}),(0,h.jsx)("h3",{children:(null===e||void 0===e?void 0:e.name)||(null===e||void 0===e?void 0:e.login)}),(0,h.jsx)("p",{children:"Personal repositories"}),(0,h.jsx)("div",{className:"profile-badges",children:(0,h.jsx)("span",{className:"profile-type",children:"Personal"})})]}),g.map(e=>(0,h.jsxs)("div",{className:"profile-card ".concat(e.isWHO?"who-org":""),onClick:a=>H(a,(0,i.A)({type:"org"},e)),children:[(0,h.jsxs)("div",{className:"profile-card-header",children:[(0,h.jsx)("img",{src:e.avatar_url||"https://github.com/".concat(e.login,".png"),alt:"".concat(e.name||e.login," organization")}),N["org-".concat(e.login)]>0&&(0,h.jsx)("div",{className:"dak-count-badge",children:N["org-".concat(e.login)]})]}),(0,h.jsx)("h3",{children:e.name||e.login}),(0,h.jsxs)("p",{children:["@",e.login]}),(0,h.jsxs)("div",{className:"profile-badges",children:[(0,h.jsx)("span",{className:"profile-type",children:a("organization.organizations")}),e.isWHO&&(0,h.jsx)("span",{className:"who-badge",children:"WHO Official"})]})]},e.login))]})]})]})})}}}]);