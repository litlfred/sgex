"use strict";(self.webpackChunksgex_workbench=self.webpackChunksgex_workbench||[]).push([[160],{13333:(e,s,a)=>{a.d(s,{hX:()=>i});const i=function(e,s,a){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if((e=>!!(null!==e&&void 0!==e&&e.ctrlKey||null!==e&&void 0!==e&&e.metaKey))(e)){const e=(e=>{const s="/sgex/copilot-fix-717",a=window.location.origin,i=e.startsWith("/")?e.slice(1):e;if(!s)return"".concat(a,"/").concat(i);const n=s.endsWith("/")?s:s+"/";return"".concat(a).concat(n).concat(i)})(s);window.open(e,"_blank","noopener,noreferrer")}else i?a(s,{state:i}):a(s)}},74160:(e,s,a)=>{a.r(s),a.d(s,{default:()=>C});var i=a(65043),n=a(74117),t=a(62148),o=a(50404),r=a(88691),l=a(98757),c=a(22392),d=a(89379),m=a(55661),h=a(77003),u=a.n(h),p=a(80483),g=a.n(p);const v=a(8336).A.getSchema("sushi-config-original");const f=new class{constructor(){this.validators=new Map,this.initializeSchemaValidator(),this.initializeDefaultValidators()}initializeSchemaValidator(){this.ajv=new(u())({allErrors:!0,verbose:!0}),g()(this.ajv),this.sushiConfigValidator=this.ajv.compile(v)}initializeDefaultValidators(){this.addValidator("xml","xml-well-formed",{level:"error",description:"XML files must be well-formed",validator:this.validateXMLWellFormed.bind(this)}),this.addValidator("bpmn","xml-well-formed",{level:"error",description:"BPMN files must be well-formed XML",validator:this.validateXMLWellFormed.bind(this)}),this.addValidator("bpmn","bpmn-namespace",{level:"error",description:"BPMN files must use correct BPMN 2.0 namespace",validator:this.validateBPMNNamespace.bind(this)}),this.addValidator("bpmn","has-start-event",{level:"warning",description:"BPMN process should have at least one start event",validator:this.validateBPMNStartEvent.bind(this)}),this.addValidator("dmn","xml-well-formed",{level:"error",description:"DMN files must be well-formed XML",validator:this.validateXMLWellFormed.bind(this)}),this.addValidator("dmn","dmn-namespace",{level:"error",description:"DMN files must use correct DMN 1.3 namespace",validator:this.validateDMNNamespace.bind(this)}),this.addValidator("json","json-valid",{level:"error",description:"JSON files must be valid JSON",validator:this.validateJSONSyntax.bind(this)}),this.addValidator("json","fhir-resource-type",{level:"info",description:"FHIR resources should have valid resourceType",validator:this.validateFHIRResourceType.bind(this)}),this.addValidator("*","file-size-limit",{level:"warning",description:"Files should be under 1MB for optimal performance",validator:this.validateFileSize.bind(this)}),this.addValidator("*","filename-conventions",{level:"info",description:"Files should follow naming conventions",validator:this.validateFilenameConventions.bind(this)}),this.addValidator("yaml","sushi-config-valid",{level:"error",description:"sushi-config.yaml must be valid and contain required fields",validator:this.validateSushiConfig.bind(this)})}addValidator(e,s,a){this.validators.has(e)||this.validators.set(e,new Map),this.validators.get(e).set(s,a)}removeValidator(e,s){this.validators.has(e)&&this.validators.get(e).delete(s)}async validateFile(e,s){const a=[],i=this.getFileExtension(e),n=this.getFileName(e),t=this.validators.get(i)||new Map,o=this.validators.get("*")||new Map;for(const[l,c]of t)try{const i=await c.validator(e,s,n);i&&a.push((0,d.A)({validatorId:l,level:c.level,description:c.description},i))}catch(r){a.push({validatorId:l,level:"error",description:"Validator execution failed",message:r.message,filePath:e})}for(const[l,c]of o)try{const i=await c.validator(e,s,n);i&&a.push((0,d.A)({validatorId:l,level:c.level,description:c.description},i))}catch(r){a.push({validatorId:l,level:"error",description:"Validator execution failed",message:r.message,filePath:e})}return a}async validateStagingGround(e){const s={summary:{error:0,warning:0,info:0},files:{},validatedAt:Date.now()};for(const a of e.files){const e=await this.validateFile(a.path,a.content);s.files[a.path]=e,e.forEach(e=>{"error"===e.level?s.summary.error++:"warning"===e.level?s.summary.warning++:"info"===e.level&&s.summary.info++})}return s}async canSave(e){return 0===(await this.validateStagingGround(e)).summary.error}async validateXMLWellFormed(e,s){try{const a=new DOMParser,i=a.parseFromString(s,"text/xml").querySelector("parsererror");return i?{message:"XML is not well-formed: "+i.textContent,filePath:e}:null}catch(a){return{message:"Failed to parse XML: "+a.message,filePath:e}}}async validateBPMNNamespace(e,s){return s.includes('xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL"')?null:{message:"BPMN file missing correct BPMN 2.0 namespace declaration",filePath:e,suggestion:'Add xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" to root element'}}async validateBPMNStartEvent(e,s){return s.includes("<startEvent")||s.includes("<bpmn:startEvent")?null:{message:"BPMN process should contain at least one start event",filePath:e,suggestion:"Add a start event to begin the process flow"}}async validateDMNNamespace(e,s){return s.includes('xmlns:dmn="https://www.omg.org/spec/DMN/20191111/MODEL/"')?null:{message:"DMN file missing correct DMN 1.3 namespace declaration",filePath:e,suggestion:'Add xmlns:dmn="https://www.omg.org/spec/DMN/20191111/MODEL/" to root element'}}async validateJSONSyntax(e,s){try{return JSON.parse(s),null}catch(a){return{message:"Invalid JSON syntax: "+a.message,filePath:e}}}async validateFHIRResourceType(e,s){try{const a=JSON.parse(s),i=["StructureDefinition","ValueSet","CodeSystem","ConceptMap","Questionnaire","PlanDefinition","ActivityDefinition","Measure","Library","ImplementationGuide","Bundle","Patient","Practitioner"];return a.resourceType&&!i.includes(a.resourceType)?{message:"Unknown FHIR resourceType: ".concat(a.resourceType),filePath:e,suggestion:"Verify the resourceType is correct for FHIR R4"}:null}catch(a){return null}}async validateFileSize(e,s){const a=new Blob([s]).size;return a>1048576?{message:"File size (".concat((a/1024/1024).toFixed(1),"MB) exceeds recommended limit of 1MB"),filePath:e,suggestion:"Consider breaking large files into smaller components"}:null}async validateFilenameConventions(e,s){const a=this.getFileName(e),i=[];return a.includes(" ")&&i.push("avoid spaces in filenames"),/[<>:"|?*]/.test(a)&&i.push('avoid special characters (<>:"|?*)'),a.length>100&&i.push("filename is very long (>100 characters)"),i.length>0?{message:"Filename convention issues: ".concat(i.join(", ")),filePath:e,suggestion:"Use lowercase letters, numbers, hyphens, and underscores"}:null}async validateSushiConfig(e,s){if(!e.endsWith("sushi-config.yaml"))return null;try{let i;try{i=m.Ay.load(s)}catch(a){return{message:"Invalid YAML syntax: ".concat(a.message),filePath:e,suggestion:"Fix YAML syntax errors and ensure proper indentation"}}if(!i||"object"!==typeof i)return{message:"sushi-config.yaml must contain a valid YAML object",filePath:e,suggestion:"Ensure the file contains proper YAML object structure"};if(!this.sushiConfigValidator(i)){const s=this.sushiConfigValidator.errors,a=s.map(e=>{var s,a;const i=e.instancePath?e.instancePath.replace("/",""):(null===(s=e.params)||void 0===s?void 0:s.missingProperty)||"root";let n="".concat(i,": ").concat(e.message);return null!==(a=e.params)&&void 0!==a&&a.allowedValues&&(n+=" (allowed: ".concat(e.params.allowedValues.join(", "),")")),n});return{message:"sushi-config.yaml validation errors: ".concat(a.join("; ")),filePath:e,suggestion:"Review the sushi-config.yaml specification at https://fshschool.org/docs/sushi/configuration/",details:s}}const n=this.validateWHOSmartGuidelines(i);return n||null}catch(i){return{message:"Failed to validate sushi-config.yaml: "+i.message,filePath:e,suggestion:"Check file format and content structure"}}}validateWHOSmartGuidelines(e){const s=[];return e.dependencies&&e.dependencies["smart.who.int.base"]||s.push("missing smart.who.int.base dependency (required for WHO DAK compliance)"),e.canonical&&e.canonical.includes("smart.who.int")&&(e.id.startsWith("smart.who.int")||s.push('id should start with "smart.who.int" when using WHO canonical URL')),e.canonical&&e.canonical.includes("smart.who.int")&&(e.publisher&&e.publisher.toLowerCase().includes("world health organization")||s.push('publisher should include "World Health Organization" for WHO guidelines'),e.jurisdiction&&Array.isArray(e.jurisdiction)||s.push("jurisdiction should be specified for WHO guidelines")),s.length>0?{message:"WHO SMART Guidelines compliance issues: ".concat(s.join(", ")),filePath:"sushi-config.yaml",suggestion:"Ensure compliance with WHO SMART Guidelines requirements"}:null}getFileExtension(e){const s=e.split(".");return s.length>1?s[s.length-1].toLowerCase():""}getFileName(e){return e.split("/").pop()||e}formatValidationResults(e){const s={canSave:0===e.summary.error,summary:e.summary,files:[]};return Object.entries(e.files).forEach(e=>{let[a,i]=e;i.length>0&&s.files.push({path:a,issues:i.map(e=>({level:e.level,message:e.message,description:e.description,suggestion:e.suggestion}))})}),s}getValidationSummary(e){return{error:e.summary.error,warning:e.summary.warning,info:e.summary.info,canSave:0===e.summary.error,hasIssues:e.summary.error+e.summary.warning+e.summary.info>0}}};var x=a(70579);const j=e=>{var s,a;let{isOpen:n,onClose:t,stagingGround:r,validation:l,repository:d,selectedBranch:m,hasWriteAccess:h,onSaveSuccess:u}=e;const[p,g]=(0,i.useState)(""),[v,j]=(0,i.useState)(!1),[N,b]=(0,i.useState)(!1),[w,k]=(0,i.useState)(null),[y,S]=(0,i.useState)(!1);if((0,i.useEffect)(()=>{n&&(g((null===r||void 0===r?void 0:r.message)||""),j(!1),b(!1),k(null),S(!1))},[n,r]),!n)return null;const C=l?f.getValidationSummary(l):null,A=!C||(C.canSave||v),M=!!C&&C.error>0,P=e=>409===e.status?"Conflict detected. The branch has been updated since you started. Please refresh and try again.":403===e.status?"Permission denied. Check that your token has write access to this repository.":404===e.status?"Repository or branch not found. Please verify the repository exists and you have access.":e.message?e.message:"An unexpected error occurred while saving. Please try again.",_=e=>{switch(e){case"error":return"\ud83d\udd34";case"warning":return"\ud83d\udfe1";case"info":return"\ud83d\udfe2";default:return"\u2753"}};return(0,x.jsx)("div",{className:"save-dialog-overlay",children:(0,x.jsxs)("div",{className:"save-dialog",children:[(0,x.jsxs)("div",{className:"dialog-header",children:[(0,x.jsx)("h3",{children:"\ud83d\udcbe Save Changes"}),(0,x.jsx)("button",{className:"dialog-close",onClick:t,disabled:N,children:"\xd7"})]}),(0,x.jsxs)("div",{className:"dialog-content",children:[(0,x.jsxs)("div",{className:"save-summary",children:[(0,x.jsxs)("h4",{children:["Files to be committed (",(null===r||void 0===r||null===(s=r.files)||void 0===s?void 0:s.length)||0,"):"]}),(0,x.jsx)("div",{className:"files-list",children:null===r||void 0===r||null===(a=r.files)||void 0===a?void 0:a.map((e,s)=>(0,x.jsxs)("div",{className:"file-item",children:[(0,x.jsx)("span",{className:"file-icon",children:"\ud83d\udcc4"}),(0,x.jsx)("span",{className:"file-path",children:e.path}),(0,x.jsxs)("span",{className:"file-size",children:[(new Blob([e.content]).size/1024).toFixed(1)," KB"]}),(0,x.jsx)("button",{className:"remove-file-btn",onClick:s=>{var a;s.stopPropagation(),a=e.path,window.confirm('Are you sure you want to remove "'.concat(a,'" from staging? This cannot be undone.'))&&c.A.removeFile(a)},title:"Remove ".concat(e.path," from staging"),disabled:N,children:"\ud83d\uddd1\ufe0f"})]},s))})]}),C&&(0,x.jsxs)("div",{className:"validation-section",children:[(0,x.jsx)("div",{className:"validation-summary ".concat(C.hasIssues?"has-issues":"clean"),onClick:()=>S(!y),children:(0,x.jsxs)("div",{className:"validation-header",children:[(0,x.jsx)("h4",{children:"\ud83d\udea6 Validation Status"}),(0,x.jsxs)("div",{className:"validation-badges",children:[C.error>0&&(0,x.jsxs)("span",{className:"validation-badge error",children:["\ud83d\udd34 ",C.error]}),C.warning>0&&(0,x.jsxs)("span",{className:"validation-badge warning",children:["\ud83d\udfe1 ",C.warning]}),C.info>0&&(0,x.jsxs)("span",{className:"validation-badge info",children:["\ud83d\udfe2 ",C.info]}),!C.hasIssues&&(0,x.jsx)("span",{className:"validation-badge success",children:"\u2705 All clear"})]}),(0,x.jsx)("span",{className:"expand-icon ".concat(y?"expanded":""),children:"\u25bc"})]})}),y&&l&&(0,x.jsx)("div",{className:"validation-details",children:Object.entries(l.files).map(e=>{let[s,a]=e;return a.length>0&&(0,x.jsxs)("div",{className:"file-validation",children:[(0,x.jsxs)("h5",{children:["\ud83d\udcc4 ",s]}),(0,x.jsx)("div",{className:"validation-issues",children:a.map((e,s)=>(0,x.jsxs)("div",{className:"validation-issue ".concat(e.level),children:[(0,x.jsx)("span",{className:"issue-icon",children:_(e.level)}),(0,x.jsxs)("div",{className:"issue-content",children:[(0,x.jsx)("div",{className:"issue-message",children:e.message}),e.suggestion&&(0,x.jsxs)("div",{className:"issue-suggestion",children:["\ud83d\udca1 ",e.suggestion]})]})]},s))})]},s)})}),M&&(0,x.jsxs)("div",{className:"override-section",children:[(0,x.jsxs)("label",{className:"override-checkbox",children:[(0,x.jsx)("input",{type:"checkbox",checked:v,onChange:e=>j(e.target.checked)}),(0,x.jsx)("span",{className:"checkmark"}),"Override validation errors and save anyway"]}),(0,x.jsx)("p",{className:"override-warning",children:"\u26a0\ufe0f Saving with validation errors may cause issues with your DAK. Only enable this if you're sure about your changes."})]})]}),(0,x.jsxs)("div",{className:"commit-message-section",children:[(0,x.jsx)("label",{htmlFor:"commit-message",children:(0,x.jsx)("h4",{children:"\u270d\ufe0f Commit Message"})}),(0,x.jsx)("textarea",{id:"commit-message",className:"commit-message-input",value:p,onChange:e=>g(e.target.value),placeholder:"Describe your changes...",rows:3,disabled:N,required:!0}),(0,x.jsx)("div",{className:"commit-tips",children:(0,x.jsxs)("p",{children:["\ud83d\udca1 ",(0,x.jsx)("strong",{children:"Tip:"})," Write a clear, descriptive message about what you changed and why."]})})]}),w&&(0,x.jsx)("div",{className:"error-section",children:(0,x.jsxs)("div",{className:"error-message",children:[(0,x.jsx)("span",{className:"error-icon",children:"\u274c"}),w]})}),(0,x.jsxs)("div",{className:"repo-info",children:[(0,x.jsxs)("div",{className:"info-item",children:[(0,x.jsx)("span",{className:"info-label",children:"Repository:"}),(0,x.jsx)("span",{className:"info-value",children:null===d||void 0===d?void 0:d.full_name})]}),(0,x.jsxs)("div",{className:"info-item",children:[(0,x.jsx)("span",{className:"info-label",children:"Branch:"}),(0,x.jsx)("span",{className:"info-value",children:m})]}),(0,x.jsxs)("div",{className:"info-item",children:[(0,x.jsx)("span",{className:"info-label",children:"Access:"}),(0,x.jsx)("span",{className:"info-value ".concat(h?"write":"read"),children:h?"\u270f\ufe0f Write":"\ud83d\udc41\ufe0f Read-only"})]})]})]}),(0,x.jsxs)("div",{className:"dialog-actions",children:[(0,x.jsx)("button",{className:"action-btn secondary",onClick:t,disabled:N,children:"Cancel"}),(0,x.jsx)("button",{className:"action-btn primary",onClick:async()=>{if(p.trim())if(h)if(!M||v){b(!0),k(null);try{var e;const s=(null===(e=d.owner)||void 0===e?void 0:e.login)||d.full_name.split("/")[0];if(d.isDemo||d.owner&&"demo-user"===d.owner.login)return await new Promise(e=>setTimeout(e,2e3)),void u({sha:"demo-commit-sha",message:p,url:"https://github.com/".concat(d.full_name,"/commit/demo-commit-sha")});const a=await o.A.createCommit(s,d.name,m,p.trim(),r.files);u({sha:a.sha,message:p,url:a.html_url})}catch(s){console.error("Error saving changes:",s),k(P(s))}finally{b(!1)}}else k("Cannot save with validation errors. Enable override option to proceed anyway.");else k("You need write permissions to save changes");else k("Commit message is required")},disabled:!A||!p.trim()||N||!h,children:N?(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)("span",{className:"saving-spinner",children:"\u23f3"}),"Saving..."]}):(0,x.jsx)(x.Fragment,{children:"\ud83d\udcbe Save Changes"})})]})]})})},N=e=>{let{repository:s,selectedBranch:a,hasWriteAccess:n,profile:t}=e;const[o,r]=(0,i.useState)(null),[l,d]=(0,i.useState)(null),[m,h]=(0,i.useState)(!1),[u,p]=(0,i.useState)(null),[g,v]=(0,i.useState)(!1),N=(0,i.useCallback)(async()=>{h(!0),p(null);try{const e=c.A.getStagingGround();r(e),e.files.length>0&&await b(e)}catch(e){p("Failed to load staging ground data"),console.error("Error loading staging ground:",e)}finally{h(!1)}},[]);(0,i.useEffect)(()=>{if(s&&a){c.A.initialize(s,a),N();return c.A.addListener(e=>{r(e),b(e)})}},[s,a,N]);const b=async e=>{if(e&&0!==e.files.length)try{const s=await f.validateStagingGround(e);d(s)}catch(s){console.error("Error validating staging ground:",s),d(null)}else d(null)},w=l?f.getValidationSummary(l):{error:0,warning:0,info:0,canSave:!0},k=o&&o.files.length>0,y=o?o.files.length:0;return(0,x.jsxs)("div",{className:"staging-ground-section",children:[(0,x.jsxs)("div",{className:"section-header",children:[(0,x.jsxs)("h3",{className:"section-title",children:[(0,x.jsx)("span",{className:"section-icon",children:"\ud83d\udcdd"}),"Staging Ground",k&&(0,x.jsxs)("span",{className:"files-badge",children:[y," file",1!==y?"s":""]})]}),(0,x.jsx)("p",{className:"section-description",children:"Changes made through DAK component editors are staged here before being committed to the repository. Review and commit your changes when ready."})]}),(0,x.jsx)("div",{className:"staging-content",children:m?(0,x.jsxs)("div",{className:"loading-indicator",children:[(0,x.jsx)("span",{className:"loading-spinner",children:"\u23f3"}),"Loading staging ground..."]}):u?(0,x.jsxs)("div",{className:"error-message",children:[(0,x.jsx)("span",{className:"error-icon",children:"\u26a0\ufe0f"}),u]}):(0,x.jsxs)(x.Fragment,{children:[(0,x.jsxs)("div",{className:"staging-status-bar",children:[(0,x.jsx)("div",{className:"status-indicators",children:(0,x.jsxs)("div",{className:"validation-stoplight",children:[(0,x.jsxs)("div",{className:"stoplight-indicator error ".concat(0===w.error?"lit":""),children:["\ud83d\udd34",w.error>0&&(0,x.jsx)("span",{className:"indicator-badge",children:w.error})]}),(0,x.jsxs)("div",{className:"stoplight-indicator warning ".concat(0===w.warning?"lit":""),children:["\ud83d\udfe1",w.warning>0&&(0,x.jsx)("span",{className:"indicator-badge",children:w.warning})]}),(0,x.jsxs)("div",{className:"stoplight-indicator info ".concat(0===w.info?"lit":""),children:["\ud83d\udfe2",w.info>0&&(0,x.jsx)("span",{className:"indicator-badge",children:w.info})]})]})}),(0,x.jsx)("button",{className:"save-btn ".concat(k&&w.canSave?"":"disabled"),onClick:()=>{n?v(!0):alert("You need write permissions to save changes to this repository.")},disabled:!k||!n,title:k?n?w.canSave?"Save changes to repository":"Fix validation errors first":"Write access required":"No changes to save",children:"\ud83d\udcbe Save Changes"})]}),(0,x.jsxs)("div",{className:"staging-files-section",children:[(0,x.jsx)("h4",{children:"\ud83d\udcc1 Changed Files"}),k?(0,x.jsxs)("div",{className:"changed-files",children:[(o&&o.files?o.files.map(e=>({path:e.path,size:new Blob([e.content]).size,lastModified:e.timestamp})):[]).map((e,s)=>(0,x.jsxs)("div",{className:"file-item",children:[(0,x.jsxs)("div",{className:"file-info",children:[(0,x.jsx)("span",{className:"file-icon",children:"\ud83d\udcc4"}),(0,x.jsx)("span",{className:"file-path",children:e.path})]}),(0,x.jsxs)("div",{className:"file-meta",children:[(0,x.jsxs)("span",{className:"file-size",children:[(e.size/1024).toFixed(1)," KB"]}),(0,x.jsx)("span",{className:"file-time",children:new Date(e.lastModified).toLocaleTimeString()}),(0,x.jsx)("button",{className:"remove-file-btn",onClick:s=>{var a;s.stopPropagation(),a=e.path,window.confirm('Are you sure you want to remove "'.concat(a,'" from staging? This cannot be undone.'))&&c.A.removeFile(a)},title:"Remove ".concat(e.path," from staging"),children:"\ud83d\uddd1\ufe0f"})]})]},s)),(0,x.jsx)("div",{className:"file-actions",children:(0,x.jsx)("button",{className:"action-btn secondary small",onClick:()=>{window.confirm("Are you sure you want to discard all changes? This cannot be undone.")&&c.A.clearStagingGround()},children:"\ud83d\uddd1\ufe0f Clear All Changes"})})]}):(0,x.jsxs)("div",{className:"no-changes",children:[(0,x.jsx)("p",{children:"No changes in staging ground"}),(0,x.jsx)("p",{className:"help-text",children:"Changes made through DAK component editors will appear here before being saved to the repository."})]})]}),k&&o.message&&(0,x.jsxs)("div",{className:"commit-message-section",children:[(0,x.jsx)("h4",{children:"\u270d\ufe0f Commit Message"}),(0,x.jsx)("div",{className:"commit-preview",children:(0,x.jsx)("p",{children:o.message})})]})]})}),(0,x.jsx)(j,{isOpen:g,onClose:()=>v(!1),stagingGround:o,validation:l,repository:s,selectedBranch:a,hasWriteAccess:n,onSaveSuccess:e=>{v(!1),c.A.clearStagingGround(),alert("Changes saved successfully! Commit: ".concat(e.sha.substring(0,7)))}})]})},b=e=>{var s;let{profile:a,repository:n,selectedBranch:t,hasWriteAccess:r}=e;const[l,c]=(0,i.useState)([]),[d,m]=(0,i.useState)([]),[h,u]=(0,i.useState)({}),[p,g]=(0,i.useState)(!0),[v,f]=(0,i.useState)(null),j=(null===(s=n.owner)||void 0===s?void 0:s.login)||n.full_name.split("/")[0],b=n.name;(0,i.useEffect)(()=>{(async()=>{try{if(g(!0),f(null),null!==a&&void 0!==a&&a.isDemo){c([{name:"main",commit:{sha:"abc123"}},{name:"feature/updates",commit:{sha:"def456"}},{name:"dev",commit:{sha:"ghi789"}}]);m([{id:"pages-build",name:"Deploy to GitHub Pages",triggers:["push","manual"]}]);const e={main:{status:"completed",conclusion:"success",html_url:"https://github.com/".concat(j,"/").concat(b,"/actions/runs/123456"),updated_at:(new Date).toISOString()},"feature/updates":{status:"completed",conclusion:"action_required",html_url:"https://github.com/".concat(j,"/").concat(b,"/actions/runs/123457"),updated_at:(new Date).toISOString()},dev:{status:"completed",conclusion:"failure",html_url:"https://github.com/".concat(j,"/").concat(b,"/actions/runs/123458"),updated_at:(new Date).toISOString()}};return u(e),void g(!1)}const s=(await o.A.getBranches(j,b)).filter(e=>"gh-pages"!==e.name);c(s);const i=await o.A.getWorkflows(j,b);m(i);const n=i.find(e=>e.name.toLowerCase().includes("build")||e.name.toLowerCase().includes("publish")||e.name.toLowerCase().includes("pages"));if(n&&n.id){const a={};for(const i of s)try{const e=await o.A.getWorkflowRunsForWorkflow(j,b,n.id,{branch:i.name,per_page:1});e.length>0&&(a[i.name]=e[0])}catch(e){console.warn("Could not fetch workflow runs for branch ".concat(i.name,":"),e)}u(a)}else n&&!n.id&&console.warn("Found workflow but missing ID:",n);g(!1)}catch(e){console.error("Error fetching publication data:",e),f("Failed to load publication data"),g(!1)}})()},[j,b,null===a||void 0===a?void 0:a.isDemo]);return p?(0,x.jsx)("div",{className:"publications-loading",children:(0,x.jsxs)("div",{className:"loading-content",children:[(0,x.jsx)("h3",{children:"Loading Publications..."}),(0,x.jsx)("p",{children:"Fetching branch and workflow information..."})]})}):v?(0,x.jsx)("div",{className:"publications-error",children:(0,x.jsxs)("div",{className:"error-content",children:[(0,x.jsx)("h3",{children:"Error Loading Publications"}),(0,x.jsx)("p",{children:v})]})}):(0,x.jsxs)("div",{className:"publications-section",children:[(0,x.jsx)(N,{repository:n,selectedBranch:t,hasWriteAccess:r,profile:a}),(0,x.jsxs)("div",{className:"section-header",children:[(0,x.jsx)("h3",{className:"section-title",children:"Published DAK Content"}),(0,x.jsx)("p",{className:"section-description",children:"Access published Implementation Guide content for this DAK repository. Each branch is published automatically via GitHub Actions to GitHub Pages."})]}),(0,x.jsx)("div",{className:"publications-grid",children:l.map(e=>{const s=e.name===n.default_branch||"main"===e.name,i=(t=e.name)===n.default_branch||"main"===t?"https://".concat(j,".github.io/").concat(b,"/"):"https://".concat(j,".github.io/").concat(b,"/branches/").concat(t,"/");var t;const l=(e=>{const s=h[e];if(!s)return{icon:"\u26aa",title:"No recent workflow runs",link:null};const a=s.status,i=s.conclusion;return"in_progress"===a||"queued"===a?{icon:"\ud83d\udd04",title:"Workflow running",link:s.html_url,className:"running"}:"success"===i?{icon:"\u2705",title:"Last build successful",link:s.html_url,className:"success"}:"failure"===i?{icon:"\u274c",title:"Last build failed",link:s.html_url,className:"failure"}:"action_required"===i?{icon:"\u23f3",title:"Workflow requires approval",link:s.html_url,className:"approval-required"}:{icon:"\u26a0\ufe0f",title:"Build ".concat(i||a),link:s.html_url,className:"warning"}})(e.name);return(0,x.jsxs)("div",{className:"publication-card ".concat(s?"main-branch":""),children:[(0,x.jsxs)("div",{className:"publication-header",children:[(0,x.jsxs)("div",{className:"branch-info",children:[(0,x.jsx)("span",{className:"branch-icon",children:"\ud83c\udf3f"}),(0,x.jsx)("span",{className:"branch-name",children:e.name}),s&&(0,x.jsx)("span",{className:"main-badge",children:"MAIN"})]}),(0,x.jsx)("div",{className:"workflow-status",children:l.link?(0,x.jsx)("a",{href:l.link,target:"_blank",rel:"noopener noreferrer",className:"status-icon ".concat(l.className||""),title:l.title,children:l.icon}):(0,x.jsx)("span",{className:"status-icon ".concat(l.className||""),title:l.title,children:l.icon})})]}),(0,x.jsxs)("div",{className:"publication-content",children:[(0,x.jsxs)("div",{className:"publication-url",children:[(0,x.jsx)("label",{children:"Published at:"}),(0,x.jsxs)("a",{href:i,target:"_blank",rel:"noopener noreferrer",className:"publication-link",children:[i,(0,x.jsx)("span",{className:"external-link",children:"\u2197"})]})]}),(0,x.jsxs)("div",{className:"publication-actions",children:[(0,x.jsx)("button",{className:"restart-workflow-btn",onClick:()=>(async e=>{if(null!==a&&void 0!==a&&a.isDemo)return void alert("Demo Mode: Workflow restart simulated for branch: ".concat(e));const s=d.find(e=>e.name.toLowerCase().includes("build")||e.name.toLowerCase().includes("publish")||e.name.toLowerCase().includes("pages"));if(s){if(!s.id)return alert("Workflow found but missing ID - cannot restart"),void console.warn("Workflow missing ID:",s);try{await o.A.triggerWorkflow(j,b,s.id,e),alert("Workflow restarted for branch: ".concat(e)),setTimeout(()=>{window.location.reload()},2e3)}catch(i){console.error("Error restarting workflow:",i),alert("Failed to restart workflow. Please check your permissions.")}}else alert("No suitable workflow found to restart")})(e.name),disabled:!r,title:r?"Restart build workflow for this branch":"Write permissions required",children:"\ud83d\udd04 Rebuild"}),(0,x.jsx)("a",{href:"https://github.com/".concat(j,"/").concat(b,"/tree/").concat(e.name),target:"_blank",rel:"noopener noreferrer",className:"view-source-btn",title:"View source code for this branch",children:"\ud83d\udc41\ufe0f View Source"})]})]})]},e.name)})}),0===l.length&&(0,x.jsx)("div",{className:"no-branches",children:(0,x.jsx)("p",{children:"No publishable branches found (excluding gh-pages)."})})]})};var w=a(73537),k=a(13333);const y=e=>{let{profile:s,repository:a,selectedBranch:n}=e;const t=(0,w.Zp)(),[r,l]=(0,i.useState)(!1),[c,d]=(0,i.useState)([]),[m,h]=(0,i.useState)(!0),[u,p]=(0,i.useState)(null),[g,v]=(0,i.useState)(null),f=i.useCallback(()=>a?"sgex_fork_status_".concat(a.full_name):null,[a]);(0,i.useEffect)(()=>{const e=f();if(e){const s=sessionStorage.getItem(e);null!==s&&l(JSON.parse(s))}},[f]);(0,i.useEffect)(()=>{(async()=>{if(a){h(!0),p(null);try{let s=a;if(!a.parent&&(!0===a.fork||void 0===a.fork))try{s=await o.A.getRepository(a.owner.login,a.name)}catch(e){console.warn("Could not fetch full repository details:",e)}s.fork&&s.parent&&v(s.parent);const i=await o.A.getRepositoryForks(a.owner.login,a.name);d(i)}catch(s){console.error("Error fetching repository information:",s),p(s.message)}finally{h(!1)}}})()},[a]);const j=e=>{const s=e.owner.login,a=e.name,i=e.default_branch||"main";return"/dashboard/".concat(s,"/").concat(a,"/").concat(i)},N=e=>{if(!g)return;const s=j(g),a={profile:{login:g.owner.login,name:g.owner.login,avatar_url:g.owner.avatar_url,type:g.owner.type},repository:g,selectedBranch:g.default_branch||"main"};(0,k.hX)(e,s,t,a)};return!a||m?(0,x.jsx)("div",{className:"fork-status-bar loading",children:(0,x.jsxs)("div",{className:"fork-status-header",children:[(0,x.jsxs)("div",{className:"fork-badge-placeholder",children:[(0,x.jsx)("span",{className:"fork-icon",children:"\ud83c\udf74"}),(0,x.jsx)("span",{className:"fork-count",children:"..."})]}),(0,x.jsx)("span",{className:"fork-status-title",children:"Loading repository info..."})]})}):u?(0,x.jsx)("div",{className:"fork-status-bar error",children:(0,x.jsxs)("div",{className:"fork-status-header",children:[(0,x.jsxs)("div",{className:"fork-badge",children:[(0,x.jsx)("span",{className:"fork-icon",children:"\ud83c\udf74"}),(0,x.jsx)("span",{className:"fork-count",children:"?"})]}),(0,x.jsx)("span",{className:"fork-status-title",children:"Unable to load repository info"})]})}):(0,x.jsxs)("div",{className:"fork-status-bar ".concat(r?"expanded":"collapsed"),children:[(0,x.jsxs)("div",{className:"fork-status-header",onClick:()=>{const e=!r;l(e);const s=f();s&&sessionStorage.setItem(s,JSON.stringify(e))},children:[(0,x.jsxs)("div",{className:"fork-badge",children:[(0,x.jsx)("span",{className:"fork-icon",children:"\ud83c\udf74"}),(0,x.jsx)("span",{className:"fork-count",children:c.length})]}),(0,x.jsx)("span",{className:"fork-status-title",children:g?(0,x.jsxs)(x.Fragment,{children:["Fork of"," ",(0,x.jsxs)("span",{className:"parent-repo-link",onClick:e=>{e.stopPropagation(),N(e)},children:[g.owner.login,"/",g.name]}),c.length>0&&(0,x.jsxs)(x.Fragment,{children:[" \u2022 ",c.length," fork",1!==c.length?"s":""]})]}):(0,x.jsxs)(x.Fragment,{children:[c.length," fork",1!==c.length?"s":""," of ",(null===a||void 0===a?void 0:a.name)||"repository"]})}),(0,x.jsx)("button",{className:"fork-toggle-btn","aria-label":r?"Collapse":"Expand",children:(0,x.jsx)("span",{className:"toggle-icon ".concat(r?"expanded":""),children:"\u25bc"})})]}),r&&(0,x.jsxs)("div",{className:"fork-list",children:[g&&(0,x.jsxs)("div",{className:"parent-section",children:[(0,x.jsx)("h4",{className:"section-title",children:"Parent Repository"}),(0,x.jsxs)("div",{className:"fork-item parent-item",onClick:e=>N(e),children:[(0,x.jsx)("div",{className:"fork-avatar",children:(0,x.jsx)("img",{src:g.owner.avatar_url,alt:g.owner.login,className:"fork-owner-avatar"})}),(0,x.jsxs)("div",{className:"fork-info",children:[(0,x.jsxs)("div",{className:"fork-name",children:[(0,x.jsxs)("strong",{children:[g.owner.login,"/",g.name]}),(0,x.jsx)("span",{className:"parent-badge",children:"Parent"})]}),(0,x.jsx)("div",{className:"fork-description",children:g.description||"No description available"}),(0,x.jsxs)("div",{className:"fork-stats",children:[(0,x.jsxs)("span",{className:"fork-stat",children:["\u2b50 ",g.stargazers_count]}),(0,x.jsxs)("span",{className:"fork-stat",children:["\ud83d\udcdd ",g.open_issues_count," issues"]}),(0,x.jsxs)("span",{className:"fork-stat",children:["\ud83d\udcc5 Updated ",new Date(g.updated_at).toLocaleDateString()]})]})]}),(0,x.jsx)("div",{className:"fork-actions",children:(0,x.jsx)("span",{className:"fork-link-hint",children:"Click to view DAK \u2192"})})]})]}),0===c.length?!g&&(0,x.jsx)("div",{className:"no-forks",children:(0,x.jsx)("p",{children:"No forks found for this repository."})}):(0,x.jsxs)("div",{className:"forks-section",children:[g&&(0,x.jsxs)("h4",{className:"section-title",children:["Forks (",c.length,")"]}),(0,x.jsx)("div",{className:"fork-items",children:c.map(e=>(0,x.jsxs)("div",{className:"fork-item",onClick:s=>((e,s)=>{const a=j(s),i={profile:{login:s.owner.login,name:s.owner.login,avatar_url:s.owner.avatar_url,type:s.owner.type},repository:s,selectedBranch:s.default_branch||"main"};(0,k.hX)(e,a,t,i)})(s,e),children:[(0,x.jsx)("div",{className:"fork-avatar",children:(0,x.jsx)("img",{src:e.owner.avatar_url,alt:e.owner.login,className:"fork-owner-avatar"})}),(0,x.jsxs)("div",{className:"fork-info",children:[(0,x.jsx)("div",{className:"fork-name",children:(0,x.jsxs)("strong",{children:[e.owner.login,"/",e.name]})}),(0,x.jsx)("div",{className:"fork-description",children:e.description||"No description available"}),(0,x.jsxs)("div",{className:"fork-stats",children:[(0,x.jsxs)("span",{className:"fork-stat",children:["\u2b50 ",e.stargazers_count]}),(0,x.jsxs)("span",{className:"fork-stat",children:["\ud83d\udcdd ",e.open_issues_count," issues"]}),(0,x.jsxs)("span",{className:"fork-stat",children:["\ud83d\udcc5 Updated ",new Date(e.updated_at).toLocaleDateString()]})]})]}),(0,x.jsx)("div",{className:"fork-actions",children:(0,x.jsx)("span",{className:"fork-link-hint",children:"Click to view DAK \u2192"})})]},e.id))})]})]})]})},S=()=>{const{t:e}=(0,n.Bd)(),{profile:s,repository:a,branch:c,navigate:d}=(0,t.oc)(),[m,h]=(0,i.useState)(!1),[u,p]=(0,i.useState)(!1),[g,v]=(0,i.useState)("core"),[f,j]=(0,i.useState)({}),[N,w]=(0,i.useState)(0);(0,i.useEffect)(()=>{(async()=>{if(a&&o.A.isAuth())try{const e=await o.A.checkRepositoryWritePermissions(a.owner.login,a.name);h(e)}catch(e){console.error("Error checking repository permissions:",e),h(!1)}else h(!1)})()},[a]),(0,i.useEffect)(()=>{s&&a&&c&&r.default.setBranchContext(s.login,a.name,c)},[s,a,c]),(0,i.useEffect)(()=>{(async()=>{if(a&&o.A.isAuth())try{const e=await o.A.getIssues(a.owner.login,a.name),s={};e.forEach(e=>{e.labels.forEach(e=>{s[e.name]=(s[e.name]||0)+1})}),j(s)}catch(e){console.warn("Could not fetch issue counts:",e)}})()},[a]),(0,i.useEffect)(()=>{const e=new MutationObserver(e=>{e.forEach(e=>{"attributes"===e.type&&"class"===e.attributeName&&w(e=>e+1)})});return e.observe(document.body,{attributes:!0,attributeFilter:["class"]}),()=>{e.disconnect()}},[]);const k=e=>{s&&a&&d("/".concat(e,"/").concat(s.login,"/").concat(a.name,"/").concat(c),{state:{profile:s,repository:a,selectedBranch:c}})},S=e=>{const s=document.body.classList.contains("theme-dark"),a="/sgex/copilot-fix-717",i="dak_".concat(e.replace(/[-]/g,"_"),".png"),n="dashboard/".concat(s?i.replace(".png","_grey_tabby.png"):i);return a?"".concat(a,"/").concat(n):"/".concat(n)},C=i.useMemo(()=>[{id:"health-interventions",title:e("dak.component.healthInterventions.name"),description:e("dak.component.healthInterventions.description"),mascotCard:S("interventions"),path:"health-interventions",level:e("dak.level.core"),color:"#0078d4"},{id:"generic-personas",title:e("dak.component.genericPersonas.name"),description:e("dak.component.genericPersonas.description"),mascotCard:S("personas"),path:"actor-editor",level:e("dak.level.core"),color:"#107c10"},{id:"user-scenarios",title:e("dak.component.userScenarios.name"),description:e("dak.component.userScenarios.description"),mascotCard:S("user_scenarios"),path:"user-scenarios",level:e("dak.level.core"),color:"#881798"},{id:"business-processes",title:e("dak.component.businessProcesses.name"),description:e("dak.component.businessProcesses.description"),mascotCard:S("business_processes"),path:"business-process-selection",level:e("dak.level.core"),color:"#d13438"},{id:"core-data-elements",title:e("dak.component.coreDataElements.name"),description:e("dak.component.coreDataElements.description"),mascotCard:S("core_data_elements"),path:"core-data-dictionary-viewer",level:e("dak.level.core"),color:"#ff8c00"},{id:"decision-support",title:e("dak.component.decisionSupportLogic.name"),description:e("dak.component.decisionSupportLogic.description"),mascotCard:S("decision_support_logic"),path:"decision-support-logic",level:e("dak.level.core"),color:"#00bcf2"},{id:"program-indicators",title:e("dak.component.programIndicators.name"),description:e("dak.component.programIndicators.description"),mascotCard:S("indicators"),path:"program-indicators",level:e("dak.level.core"),color:"#498205"},{id:"functional-requirements",title:e("dak.component.requirements.name"),description:e("dak.component.requirements.description"),mascotCard:S("requirements"),path:"functional-requirements",level:e("dak.level.core"),color:"#6b69d6"},{id:"testing",title:e("dak.component.testing.name"),description:e("dak.component.testing.description"),mascotCard:S("testing"),path:"testing-viewer",level:e("dak.level.core"),color:"#8b5cf6"},{id:"terminology",title:e("dak.component.terminology.name"),description:e("dak.component.terminology.description"),icon:"\ud83c\udff7\ufe0f",path:"terminology",level:e("dak.level.technical"),color:"#ff8c00"},{id:"profiles",title:e("dak.component.profiles.name"),description:e("dak.component.profiles.description"),icon:"\ud83d\udd27",path:"profiles",level:e("dak.level.technical"),color:"#00bcf2"},{id:"extensions",title:e("dak.component.extensions.name"),description:e("dak.component.extensions.description"),icon:"\ud83e\udde9",path:"extensions",level:e("dak.level.technical"),color:"#498205"},{id:"test-data",title:e("dak.component.testData.name"),description:e("dak.component.testData.description"),icon:"\ud83e\uddea",path:"test-data",level:e("dak.level.technical"),color:"#8b5cf6"},{id:"questionnaire-editor",title:e("dak.component.questionnaireEditor.name"),description:e("dak.component.questionnaireEditor.description"),icon:"\ud83d\udccb",path:"questionnaire-editor",level:e("dak.level.technical"),color:"#17a2b8"}],[N,e]),A=C.filter(s=>s.level.includes(e("dak.level.core"))),M=C.filter(s=>s.level.includes(e("dak.level.technical")));return(0,x.jsxs)("div",{className:"dak-dashboard",children:[(0,x.jsx)("div",{className:"dashboard-header",children:(0,x.jsxs)("div",{className:"dashboard-title",children:[(0,x.jsxs)("h1",{children:[null===a||void 0===a?void 0:a.name," Dashboard"]}),(0,x.jsxs)("p",{className:"dashboard-subtitle",children:["Digital Adaptation Kit for ",(null===s||void 0===s?void 0:s.name)||(null===s||void 0===s?void 0:s.login)]})]})}),(0,x.jsx)(y,{profile:s,repository:a,selectedBranch:c}),a&&(0,x.jsx)(l.A,{repository:a,profile:s,selectedBranch:c,issueCounts:f}),(0,x.jsxs)("div",{className:"tab-navigation",children:[(0,x.jsxs)("button",{className:"tab-button ".concat("core"===g?"active":""),onClick:()=>v("core"),children:[(0,x.jsx)("span",{className:"tab-icon",children:"\u2b50"}),(0,x.jsx)("span",{className:"tab-text",children:"9 Core Components"})]}),(0,x.jsxs)("button",{className:"tab-button ".concat("additional"===g?"active":""),onClick:()=>v("additional"),children:[(0,x.jsx)("span",{className:"tab-icon",children:"\ud83d\udd27"}),(0,x.jsxs)("span",{className:"tab-text",children:["Additional Components (",M.length,")"]})]}),(0,x.jsxs)("button",{className:"tab-button ".concat("publications"===g?"active":""),onClick:()=>v("publications"),children:[(0,x.jsx)("span",{className:"tab-icon",children:"\ud83d\udcda"}),(0,x.jsx)("span",{className:"tab-text",children:"Publications"})]})]}),(0,x.jsxs)("div",{className:"dashboard-content",children:["core"===g&&(0,x.jsx)("div",{className:"components-grid core-components",children:A.map(e=>(0,x.jsxs)("div",{className:"component-card",onClick:()=>k(e.path),children:[(0,x.jsx)("div",{className:"component-mascot",children:(0,x.jsx)("img",{src:e.mascotCard,alt:"".concat(e.title," mascot"),className:"mascot-card-image"})}),(0,x.jsx)("p",{children:e.description}),f[e.id]>0&&(0,x.jsxs)("div",{className:"issue-badge",children:[f[e.id]," issues"]})]},e.id))}),"additional"===g&&(0,x.jsx)("div",{className:"components-grid additional-components",children:M.map(e=>(0,x.jsxs)("div",{className:"component-card",onClick:()=>k(e.path),children:[e.mascotCard?(0,x.jsx)("div",{className:"component-mascot",children:(0,x.jsx)("img",{src:e.mascotCard,alt:"".concat(e.title," mascot"),className:"mascot-card-image"})}):(0,x.jsx)("div",{className:"component-icon",children:e.icon}),(0,x.jsx)("h3",{children:e.title}),(0,x.jsx)("p",{children:e.description}),f[e.id]>0&&(0,x.jsxs)("div",{className:"issue-badge",children:[f[e.id]," issues"]})]},e.id))}),"publications"===g&&(0,x.jsx)("div",{className:"publications-section",children:(0,x.jsx)(b,{repository:a,profile:s,selectedBranch:c,onNavigate:()=>{s&&a&&d("/publications/".concat(s.login,"/").concat(a.name,"/").concat(c),{state:{profile:s,repository:a,selectedBranch:c}})}})})]}),u&&(0,x.jsxs)("div",{className:"permission-dialog",children:[(0,x.jsx)("div",{className:"dialog-overlay",onClick:()=>p(!1)}),(0,x.jsxs)("div",{className:"dialog-content",children:[(0,x.jsx)("h3",{children:"Repository Permissions"}),(0,x.jsxs)("p",{children:["You have ",m?"write":"read-only"," access to this repository.",!m&&" You can view content but cannot make changes."]}),(0,x.jsx)("button",{onClick:()=>p(!1),children:"Got it"})]})]})]})},C=()=>(0,x.jsx)(t.Mx,{pageName:"dashboard",children:(0,x.jsx)(S,{})})}}]);
//# sourceMappingURL=160.9cf7e31a.chunk.js.map