"use strict";(self.webpackChunksgex_workbench=self.webpackChunksgex_workbench||[]).push([[602],{20602:(e,s,a)=>{a.r(s),a.d(s,{default:()=>h});var n=a(89379),r=a(9950),t=a(10827),i=a(29946),c=a(53782),o=a(29166),l=a(44414);const d=()=>{const e=(0,t.Zp)(),{profile:s,repository:a,branch:d}=(0,c.N5)(),h=null===s||void 0===s?void 0:s.login,m=null===a||void 0===a?void 0:a.name,[u,p]=(0,r.useState)([]),[f,g]=(0,r.useState)(!0),[x,j]=(0,r.useState)(null),[N,v]=(0,r.useState)(null),[b,y]=(0,r.useState)(""),[w,C]=(0,r.useState)(!1),[k,I]=(0,r.useState)([]),[P,S]=(0,r.useState)(!1),[A,F]=(0,r.useState)([]),[L,W]=(0,r.useState)(""),[E,q]=(0,r.useState)(!1),[D,M]=(0,r.useState)(!1),_=(0,r.useCallback)(e=>{var s;const n=h||(null===a||void 0===a||null===(s=a.owner)||void 0===s?void 0:s.login)||(null===a||void 0===a?void 0:a.full_name.split("/")[0]),r=m||(null===a||void 0===a?void 0:a.name);return e===((null===a||void 0===a?void 0:a.default_branch)||"main")?"https://".concat(n,".github.io/").concat(r):"https://".concat(n,".github.io/").concat(r,"/branches/").concat(e)},[h,a,m]),H=(0,r.useCallback)((e,s)=>{const a={id:s.replace(".fsh",""),title:"",description:"",fileName:s,content:e},n=e.split("\n");for(const r of n){const e=r.trim();if(e.startsWith("Instance:")){const s=e.match(/Instance:\s*([^\s]+)/);s&&(a.id=s[1])}if(e.startsWith("* title =")||e.startsWith("* title=")){const s=e.match(/\* title\s*=\s*"([^"]+)"/);s&&(a.title=s[1])}if(e.startsWith("* description =")||e.startsWith("* description=")){const s=e.match(/\* description\s*=\s*"([^"]+)"/);s&&(a.description=s[1])}e.startsWith("//")&&!a.title&&(a.title=e.replace("//","").trim())}return a.title||(a.title=a.id||s.replace(".fsh","")),a},[]),R=(0,r.useCallback)(async()=>{if(h&&m&&d)try{g(!0),j(null),console.log("ProgramIndicators: Fetching measures from ".concat(h,"/").concat(m,"/").concat(d));let r="input/fsh/measures",t=[];try{t=(await i.A.getDirectoryContents(h,m,r,d)).filter(e=>"file"===e.type&&(e.name.endsWith(".fsh")||e.name.endsWith(".cql")))}catch(e){console.log("ProgramIndicators: input/fsh/measures directory not found, trying alternative paths...");const a=["input/fsh","input/measures","measures","fsh/measures"];for(const n of a)try{const e=(await i.A.getDirectoryContents(h,m,n,d)).filter(e=>"file"===e.type&&(e.name.toLowerCase().includes("measure")||e.name.toLowerCase().includes("indicator"))&&(e.name.endsWith(".fsh")||e.name.endsWith(".cql")));if(e.length>0){t=e,r=n;break}}catch(s){console.log("ProgramIndicators: Alternative path ".concat(n," not found"))}}console.log("ProgramIndicators: Found ".concat(t.length," measure files in ").concat(r)),p(t.map(e=>(0,n.A)((0,n.A)({},e),{},{path:"".concat(r,"/").concat(e.name)})));const c=[];for(const e of t)try{const s=await i.A.getFileContent(h,m,"".concat(r,"/").concat(e.name),d),a=H(s,e.name);c.push(a)}catch(a){console.warn("ProgramIndicators: Failed to parse measure file ".concat(e.name,":"),a),c.push({id:e.name.replace(/\.(fsh|cql)$/,""),title:e.name.replace(/\.(fsh|cql)$/,""),description:"Measure file: ".concat(e.name),fileName:e.name,content:"",parseError:!0})}F(c)}catch(x){console.error("ProgramIndicators: Error fetching measure files:",x),j("Failed to fetch measure files: ".concat(x.message))}finally{g(!1)}else console.log("ProgramIndicators: Missing required data:",{user:h,repo:m,branch:d})},[h,m,d,H]),T=(0,r.useCallback)(async()=>{if(h&&m&&d)try{M(!0);const e=_(d),s=await fetch("".concat(e,"/index.html"),{method:"HEAD"});q(s.ok)}catch(x){console.log("ProgramIndicators: No published IG found"),q(!1)}finally{M(!1)}},[h,m,d,_]),$=(0,r.useCallback)(async()=>{if(h&&m)try{const e=await i.A.listBranches(h,m);I(e),S(e.some(e=>"gh-pages"===e.name))}catch(x){console.warn("ProgramIndicators: Failed to fetch branches:",x)}},[h,m]),B=A.filter(e=>e.title.toLowerCase().includes(L.toLowerCase())||e.description.toLowerCase().includes(L.toLowerCase())||e.id.toLowerCase().includes(L.toLowerCase()));return(0,r.useEffect)(()=>{h&&m&&d&&(R(),$(),T())},[h,m,d,R,$,T]),f?(0,l.jsx)("div",{className:"program-indicators loading-state",children:(0,l.jsxs)("div",{className:"loading-content",children:[(0,l.jsx)("h2",{children:"Loading Program Indicators..."}),(0,l.jsx)("p",{children:"Fetching measure files from repository..."})]})}):x?(0,l.jsx)("div",{className:"program-indicators error-state",children:(0,l.jsxs)("div",{className:"error-content",children:[(0,l.jsx)("h2",{children:"Error Loading Program Indicators"}),(0,l.jsx)("p",{children:x}),(0,l.jsxs)("div",{className:"error-actions",children:[(0,l.jsx)("button",{onClick:()=>e("/"),className:"action-btn primary",children:"Return Home"}),(0,l.jsx)("button",{onClick:()=>window.location.reload(),className:"action-btn secondary",children:"Retry"})]})]})}):(0,l.jsxs)("div",{className:"program-indicators",children:[(0,l.jsx)("div",{className:"viewer-header",children:(0,l.jsxs)("div",{className:"header-content",children:[(0,l.jsxs)("div",{className:"header-info",children:[(0,l.jsx)("h1",{children:"\ud83d\udcca Program Indicators & Measures"}),(0,l.jsx)("p",{className:"header-subtitle",children:"Performance indicators and measurement definitions for monitoring and evaluation"}),(0,l.jsxs)("div",{className:"repository-info",children:[(0,l.jsxs)("span",{className:"repo-badge",children:["\ud83d\udcc1 ",h,"/",m]}),(0,l.jsxs)("span",{className:"branch-badge",children:["\ud83c\udf3f ",d]}),(0,l.jsxs)("span",{className:"count-badge",children:["\ud83d\udcca ",A.length," measure",1!==A.length?"s":""]})]})]}),E&&(0,l.jsx)("div",{className:"published-ig-link",children:(0,l.jsx)("a",{href:"".concat(_(d),"/artifacts.html#structures-measures"),target:"_blank",rel:"noopener noreferrer",className:"action-btn secondary",children:"\ud83d\udccb View Published Measures"})})]})}),(0,l.jsxs)("div",{className:"viewer-content",children:[(0,l.jsx)("div",{className:"search-section",children:(0,l.jsxs)("div",{className:"search-bar",children:[(0,l.jsx)("input",{type:"text",placeholder:"Search measures by title, description, or ID...",value:L,onChange:e=>W(e.target.value),className:"search-input"}),(0,l.jsx)("span",{className:"search-icon",children:"\ud83d\udd0d"})]})}),0===B.length?(0,l.jsx)("div",{className:"no-measures",children:(0,l.jsxs)("div",{className:"no-measures-content",children:[(0,l.jsx)("h3",{children:"\ud83d\udcca No Program Indicators Found"}),(0,l.jsx)("p",{children:0===A.length?"This repository doesn't contain any measure files in the expected locations.":"No measures match your search criteria."}),0===A.length&&(0,l.jsxs)("div",{className:"help-text",children:[(0,l.jsx)("p",{children:"Expected locations for measure files:"}),(0,l.jsxs)("ul",{children:[(0,l.jsx)("li",{children:(0,l.jsx)("code",{children:"input/fsh/measures/"})}),(0,l.jsxs)("li",{children:[(0,l.jsx)("code",{children:"input/fsh/"})," (with measure-related files)"]}),(0,l.jsx)("li",{children:(0,l.jsx)("code",{children:"input/measures/"})})]})]})]})}):(0,l.jsx)("div",{className:"measures-grid",children:B.map((e,s)=>(0,l.jsxs)("div",{className:"measure-card",onClick:()=>(async e=>{try{if(v(e),e.content&&!e.parseError)y(e.content);else{const s=await i.A.getFileContent(h,m,e.fileName,d);y(s)}C(!0)}catch(x){console.error("ProgramIndicators: Error loading file content:",x),j("Failed to load file content: ".concat(x.message))}})(e),children:[(0,l.jsxs)("div",{className:"measure-header",children:[(0,l.jsx)("h3",{className:"measure-title",children:e.title}),(0,l.jsx)("span",{className:"measure-id",children:e.id})]}),e.description&&(0,l.jsx)("p",{className:"measure-description",children:e.description}),(0,l.jsxs)("div",{className:"measure-meta",children:[(0,l.jsxs)("span",{className:"file-name",children:["\ud83d\udcc4 ",e.fileName]}),e.parseError&&(0,l.jsx)("span",{className:"parse-warning",children:"\u26a0\ufe0f Parse error"})]})]},s))})]}),w&&N&&(0,l.jsx)("div",{className:"file-modal-overlay",onClick:()=>C(!1),children:(0,l.jsxs)("div",{className:"file-modal",onClick:e=>e.stopPropagation(),children:[(0,l.jsxs)("div",{className:"modal-header",children:[(0,l.jsxs)("h3",{children:["\ud83d\udcca ",N.title]}),(0,l.jsx)("button",{onClick:()=>C(!1),className:"close-btn",children:"\u2715"})]}),(0,l.jsxs)("div",{className:"modal-content",children:[(0,l.jsxs)("div",{className:"file-info",children:[(0,l.jsxs)("span",{className:"file-name",children:["\ud83d\udcc4 ",N.fileName]}),(0,l.jsxs)("span",{className:"measure-id",children:["ID: ",N.id]})]}),(0,l.jsx)("pre",{className:"file-content",children:b})]})]})}),(0,l.jsx)(o.A,{pageId:"program-indicators",helpTopics:["program-indicators-overview","viewing-measure-files","searching-measures"]})]})},h=()=>(0,l.jsx)(c.Mx,{pageName:"program-indicators",children:(0,l.jsx)(d,{})})}}]);