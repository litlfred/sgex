"use strict";(self.webpackChunksgex_workbench=self.webpackChunksgex_workbench||[]).push([[602],{20602:(e,s,a)=>{a.r(s),a.d(s,{default:()=>m});var i=a(89379),n=a(9950),r=a(69396),t=a(46901),o=a(53782),c=a(29166),l=a(44414);const d=()=>{const e=(0,r.Zp)(),{profile:s,repository:a,branch:d,error:m}=(0,o.N5)(),{user:h,repo:u,branch:p}=(0,r.g)(),x=(null===s||void 0===s?void 0:s.login)||h,g=(null===a||void 0===a?void 0:a.name)||u,f=d||p||"main",[j,N]=(0,n.useState)([]),[v,y]=(0,n.useState)(!0),[b,w]=(0,n.useState)(null),[C,k]=(0,n.useState)(null),[I,P]=(0,n.useState)(""),[S,A]=(0,n.useState)(!1),[T,F]=(0,n.useState)([]),[M,E]=(0,n.useState)(!1),[W,L]=(0,n.useState)([]),[D,R]=(0,n.useState)(""),[q,H]=(0,n.useState)(!1),[_,G]=(0,n.useState)(!1),[z,O]=(0,n.useState)(!1),[Z,U]=(0,n.useState)(""),[V,Y]=(0,n.useState)(!1);(0,n.useEffect)(()=>{(async()=>{if(a&&s)try{var e;const s=t.A.isAuth(),i=(null===(e=a.permissions)||void 0===e?void 0:e.push)||!1;Y(s&&i)}catch(b){console.warn("Could not check write permissions:",b),Y(!1)}else Y(!1)})()},[a,s]);const $=(0,n.useCallback)(e=>{var s;const i=x||(null===a||void 0===a||null===(s=a.owner)||void 0===s?void 0:s.login)||(null===a||void 0===a?void 0:a.full_name.split("/")[0]),n=g||(null===a||void 0===a?void 0:a.name);return e===((null===a||void 0===a?void 0:a.default_branch)||"main")?"https://".concat(i,".github.io/").concat(n):"https://".concat(i,".github.io/").concat(n,"/branches/").concat(e)},[x,a,g]),B=(0,n.useCallback)((e,s)=>{const a={id:s.replace(".fsh",""),title:"",description:"",fileName:s,content:e},i=e.split("\n");for(const n of i){const e=n.trim();if(e.startsWith("Instance:")){const s=e.match(/Instance:\s*([^\s]+)/);s&&(a.id=s[1])}if(e.startsWith("* title =")||e.startsWith("* title=")){const s=e.match(/\* title\s*=\s*"([^"]+)"/);s&&(a.title=s[1])}if(e.startsWith("* description =")||e.startsWith("* description=")){const s=e.match(/\* description\s*=\s*"([^"]+)"/);s&&(a.description=s[1])}e.startsWith("//")&&!a.title&&(a.title=e.replace("//","").trim())}return a.title||(a.title=a.id||s.replace(".fsh","")),a},[]),K=(0,n.useCallback)(async()=>{if(x&&g&&f)try{y(!0),w(null),console.log("ProgramIndicators: Fetching measures from ".concat(x,"/").concat(g,"/").concat(f));let n="input/fsh/measures",r=[];try{r=(await t.A.getDirectoryContents(x,g,n,f)).filter(e=>"file"===e.type&&(e.name.endsWith(".fsh")||e.name.endsWith(".cql")))}catch(e){console.log("ProgramIndicators: input/fsh/measures directory not found, trying alternative paths...");const a=["input/fsh","input/measures","measures","fsh/measures"];for(const i of a)try{const e=(await t.A.getDirectoryContents(x,g,i,f)).filter(e=>"file"===e.type&&(e.name.toLowerCase().includes("measure")||e.name.toLowerCase().includes("indicator"))&&(e.name.endsWith(".fsh")||e.name.endsWith(".cql")));if(e.length>0){r=e,n=i;break}}catch(s){console.log("ProgramIndicators: Alternative path ".concat(i," not found"))}}console.log("ProgramIndicators: Found ".concat(r.length," measure files in ").concat(n)),N(r.map(e=>(0,i.A)((0,i.A)({},e),{},{path:"".concat(n,"/").concat(e.name)})));const o=[];for(const e of r)try{const s=await t.A.getFileContent(x,g,"".concat(n,"/").concat(e.name),f),a=B(s,e.name);o.push(a)}catch(a){console.warn("ProgramIndicators: Failed to parse measure file ".concat(e.name,":"),a),o.push({id:e.name.replace(/\.(fsh|cql)$/,""),title:e.name.replace(/\.(fsh|cql)$/,""),description:"Measure file: ".concat(e.name),fileName:e.name,content:"",parseError:!0})}L(o)}catch(b){console.error("ProgramIndicators: Error fetching measure files:",b),b.message.includes("not found")||b.message.includes("not accessible")?w("Unable to access repository. This may be due to network issues, rate limiting, or repository permissions. Please try again later."):w("Failed to fetch measure files: ".concat(b.message))}finally{y(!1)}else console.log("ProgramIndicators: Missing required data:",{user:x,repo:g,branch:f})},[x,g,f,B]),J=(0,n.useCallback)(async()=>{if(x&&g&&f)try{G(!0);const e=$(f),s=await fetch("".concat(e,"/index.html"),{method:"HEAD"});H(s.ok)}catch(b){console.log("ProgramIndicators: No published IG found"),H(!1)}finally{G(!1)}},[x,g,f,$]),Q=(0,n.useCallback)(async()=>{if(x&&g)try{const e=await t.A.listBranches(x,g);F(e),E(e.some(e=>"gh-pages"===e.name))}catch(b){console.warn("ProgramIndicators: Failed to fetch branches:",b)}},[x,g]),X=()=>{V?O(!0):alert("You need write access to this repository to create new measures.")},ee=()=>{if(!Z.trim())return void alert("Please enter a measure name");const e=Z.trim().replace(/[^a-zA-Z0-9-_]/g,""),s="".concat(e),a=Z.trim(),i="Instance: ".concat(s,'\nInstanceOf: Measure\nUsage: #definition\nTitle: "').concat(a,'"\nDescription: "Performance indicator for ').concat(a,'"\n* status = #draft\n* experimental = true\n* date = "').concat((new Date).toISOString().split("T")[0],'"\n* publisher = "WHO SMART Guidelines"\n* type = #process\n* scoring = #proportion\n\n* group.population[+].code = http://terminology.hl7.org/CodeSystem/measure-population#initial-population\n* group.population[=].description = "Initial population"\n* group.population[=].criteria.language = #text/cql\n* group.population[=].criteria.expression = "Initial Population"\n\n* group.population[+].code = http://terminology.hl7.org/CodeSystem/measure-population#numerator\n* group.population[=].description = "Numerator"\n* group.population[=].criteria.language = #text/cql\n* group.population[=].criteria.expression = "Numerator"\n\n* group.population[+].code = http://terminology.hl7.org/CodeSystem/measure-population#denominator\n* group.population[=].description = "Denominator"\n* group.population[=].criteria.language = #text/cql\n* group.population[=].criteria.expression = "Denominator"\n');k({id:s,title:a,fileName:"".concat(e,".fsh"),description:"Performance indicator for ".concat(a),content:i,isNew:!0}),P(i),O(!1),U(""),A(!0)},se=W.filter(e=>e.title.toLowerCase().includes(D.toLowerCase())||e.description.toLowerCase().includes(D.toLowerCase())||e.id.toLowerCase().includes(D.toLowerCase()));return(0,n.useEffect)(()=>{x&&g&&f&&(K(),Q(),J())},[x,g,f,K,Q,J]),v?(0,l.jsx)("div",{className:"program-indicators loading-state",children:(0,l.jsxs)("div",{className:"loading-content",children:[(0,l.jsx)("h2",{children:"Loading Program Indicators..."}),(0,l.jsx)("p",{children:"Fetching measure files from repository..."}),m&&(0,l.jsxs)("div",{className:"page-error-notice",children:[(0,l.jsxs)("p",{children:[(0,l.jsx)("strong",{children:"Repository Access:"})," ",m]}),(0,l.jsx)("p",{children:"Attempting to access repository directly..."})]})]})}):b?(0,l.jsx)("div",{className:"program-indicators error-state",children:(0,l.jsxs)("div",{className:"error-content",children:[(0,l.jsx)("h2",{children:"Error Loading Program Indicators"}),(0,l.jsx)("p",{children:b}),m&&(0,l.jsxs)("div",{className:"page-error-details",children:[(0,l.jsx)("h3",{children:"Repository Access Issue"}),(0,l.jsx)("p",{children:m}),(0,l.jsx)("p",{children:"This may be due to:"}),(0,l.jsxs)("ul",{children:[(0,l.jsx)("li",{children:"Network connectivity issues"}),(0,l.jsx)("li",{children:"GitHub API rate limiting"}),(0,l.jsx)("li",{children:"Repository access permissions"}),(0,l.jsx)("li",{children:"Temporary service unavailability"})]})]}),(0,l.jsxs)("div",{className:"error-actions",children:[(0,l.jsx)("button",{onClick:()=>e("/"),className:"action-btn primary",children:"Return Home"}),(0,l.jsx)("button",{onClick:()=>window.location.reload(),className:"action-btn secondary",children:"Retry"})]})]})}):(0,l.jsxs)("div",{className:"program-indicators",children:[(0,l.jsx)("div",{className:"viewer-header",children:(0,l.jsxs)("div",{className:"header-content",children:[(0,l.jsxs)("div",{className:"header-info",children:[(0,l.jsx)("h1",{children:"\ud83d\udcca Program Indicators & Measures"}),(0,l.jsx)("p",{className:"header-subtitle",children:"Performance indicators and measurement definitions for monitoring and evaluation"}),(0,l.jsxs)("div",{className:"repository-info",children:[(0,l.jsxs)("span",{className:"repo-badge",children:["\ud83d\udcc1 ",x,"/",g]}),(0,l.jsxs)("span",{className:"branch-badge",children:["\ud83c\udf3f ",f]}),(0,l.jsxs)("span",{className:"count-badge",children:["\ud83d\udcca ",W.length," measure",1!==W.length?"s":""]})]})]}),q&&(0,l.jsx)("div",{className:"published-ig-link",children:(0,l.jsx)("a",{href:"".concat($(f),"/artifacts.html#structures-measures"),target:"_blank",rel:"noopener noreferrer",className:"action-btn secondary",children:"\ud83d\udccb View Published Measures"})}),V&&(0,l.jsx)("div",{className:"create-measure-section",children:(0,l.jsx)("button",{onClick:X,className:"action-btn primary create-btn",title:"Create a new measure file",children:"\u2795 Create New Measure"})})]})}),(0,l.jsxs)("div",{className:"viewer-content",children:[(0,l.jsx)("div",{className:"search-section",children:(0,l.jsxs)("div",{className:"search-bar",children:[(0,l.jsx)("input",{type:"text",placeholder:"Search measures by title, description, or ID...",value:D,onChange:e=>R(e.target.value),className:"search-input"}),(0,l.jsx)("span",{className:"search-icon",children:"\ud83d\udd0d"})]})}),0===se.length?(0,l.jsx)("div",{className:"no-measures",children:(0,l.jsxs)("div",{className:"no-measures-content",children:[(0,l.jsx)("h3",{children:"\ud83d\udcca No Program Indicators Found"}),(0,l.jsx)("p",{children:0===W.length?"This repository doesn't contain any measure files in the expected locations.":"No measures match your search criteria."}),0===W.length&&(0,l.jsxs)("div",{className:"help-text",children:[(0,l.jsx)("p",{children:"Expected locations for measure files:"}),(0,l.jsxs)("ul",{children:[(0,l.jsx)("li",{children:(0,l.jsx)("code",{children:"input/fsh/measures/"})}),(0,l.jsxs)("li",{children:[(0,l.jsx)("code",{children:"input/fsh/"})," (with measure-related files)"]}),(0,l.jsx)("li",{children:(0,l.jsx)("code",{children:"input/measures/"})})]}),V&&(0,l.jsx)("button",{onClick:X,className:"action-btn primary",style:{marginTop:"1rem"},children:"\u2795 Create Your First Measure"})]})]})}):(0,l.jsx)("div",{className:"measures-grid",children:se.map((e,s)=>(0,l.jsxs)("div",{className:"measure-card",onClick:()=>(async e=>{try{if(k(e),e.content&&!e.parseError)P(e.content);else{const s=await t.A.getFileContent(x,g,e.fileName,f);P(s)}A(!0)}catch(b){console.error("ProgramIndicators: Error loading file content:",b),w("Failed to load file content: ".concat(b.message))}})(e),children:[(0,l.jsxs)("div",{className:"measure-header",children:[(0,l.jsx)("h3",{className:"measure-title",children:e.title}),(0,l.jsx)("span",{className:"measure-id",children:e.id})]}),e.description&&(0,l.jsx)("p",{className:"measure-description",children:e.description}),(0,l.jsxs)("div",{className:"measure-meta",children:[(0,l.jsxs)("span",{className:"file-name",children:["\ud83d\udcc4 ",e.fileName]}),e.parseError&&(0,l.jsx)("span",{className:"parse-warning",children:"\u26a0\ufe0f Parse error"})]})]},s))})]}),z&&(0,l.jsx)("div",{className:"file-modal-overlay",onClick:()=>O(!1),children:(0,l.jsxs)("div",{className:"file-modal create-modal",onClick:e=>e.stopPropagation(),children:[(0,l.jsxs)("div",{className:"modal-header",children:[(0,l.jsx)("h3",{children:"\u2795 Create New Measure"}),(0,l.jsx)("button",{onClick:()=>O(!1),className:"close-btn",children:"\u2715"})]}),(0,l.jsx)("div",{className:"modal-content",children:(0,l.jsxs)("div",{className:"create-form",children:[(0,l.jsx)("label",{htmlFor:"measure-name",children:"Measure Name:"}),(0,l.jsx)("input",{id:"measure-name",type:"text",placeholder:"e.g., HIV Testing Coverage",value:Z,onChange:e=>U(e.target.value),onKeyPress:e=>{"Enter"===e.key&&ee()},className:"measure-name-input",autoFocus:!0}),(0,l.jsxs)("div",{className:"create-form-help",children:[(0,l.jsx)("p",{children:"This will create a new FHIR Measure file in FSH (FHIR Shorthand) format."}),(0,l.jsxs)("p",{children:["The file will be saved as: ",(0,l.jsxs)("code",{children:["input/fsh/measures/",Z.trim().replace(/[^a-zA-Z0-9-_]/g,"")||"measure-name",".fsh"]})]})]}),(0,l.jsxs)("div",{className:"create-form-actions",children:[(0,l.jsx)("button",{onClick:ee,className:"action-btn primary",disabled:!Z.trim(),children:"Create Measure Template"}),(0,l.jsx)("button",{onClick:()=>O(!1),className:"action-btn secondary",children:"Cancel"})]})]})})]})}),S&&C&&(0,l.jsx)("div",{className:"file-modal-overlay",onClick:()=>A(!1),children:(0,l.jsxs)("div",{className:"file-modal",onClick:e=>e.stopPropagation(),children:[(0,l.jsxs)("div",{className:"modal-header",children:[(0,l.jsxs)("h3",{children:["\ud83d\udcca ",C.title]}),(0,l.jsx)("button",{onClick:()=>A(!1),className:"close-btn",children:"\u2715"})]}),(0,l.jsxs)("div",{className:"modal-content",children:[(0,l.jsxs)("div",{className:"file-info",children:[(0,l.jsxs)("span",{className:"file-name",children:["\ud83d\udcc4 ",C.fileName]}),(0,l.jsxs)("span",{className:"measure-id",children:["ID: ",C.id]}),C.isNew&&(0,l.jsx)("span",{className:"new-badge",children:"\u2728 New"})]}),C.isNew&&(0,l.jsxs)("div",{className:"new-measure-notice",children:[(0,l.jsx)("p",{children:(0,l.jsx)("strong",{children:"Template Generated"})}),(0,l.jsx)("p",{children:"This is a template for your new measure. To save this measure to your repository:"}),(0,l.jsxs)("ol",{children:[(0,l.jsx)("li",{children:"Review and customize the template below"}),(0,l.jsx)("li",{children:"Copy the content"}),(0,l.jsxs)("li",{children:["Create a new file at ",(0,l.jsxs)("code",{children:["input/fsh/measures/",C.fileName]})]}),(0,l.jsx)("li",{children:"Paste and save the content"})]}),(0,l.jsx)("div",{className:"notice-actions",children:(0,l.jsx)("button",{onClick:()=>{navigator.clipboard.writeText(I),alert("Template copied to clipboard!")},className:"action-btn primary",children:"\ud83d\udccb Copy Template"})})]}),(0,l.jsx)("pre",{className:"file-content",children:I})]})]})}),(0,l.jsx)(c.A,{pageId:"program-indicators",helpTopics:["program-indicators-overview","viewing-measure-files","searching-measures"]})]})},m=()=>(0,l.jsx)(o.Mx,{pageName:"program-indicators",children:(0,l.jsx)(d,{})})}}]);