"use strict";(self.webpackChunksgex_workbench=self.webpackChunksgex_workbench||[]).push([[602],{20602:(e,s,a)=>{a.r(s),a.d(s,{default:()=>h});var r=a(89379),i=a(9950),n=a(10827),t=a(29946),c=a(53782),o=a(29166),l=a(44414);const d=()=>{const e=(0,n.Zp)(),{profile:s,repository:a,branch:d,error:h}=(0,c.N5)(),{user:m,repo:u,branch:p}=(0,n.g)(),f=(null===s||void 0===s?void 0:s.login)||m,x=(null===a||void 0===a?void 0:a.name)||u,g=d||p||"main",[j,v]=(0,i.useState)([]),[N,y]=(0,i.useState)(!0),[b,w]=(0,i.useState)(null),[C,k]=(0,i.useState)(null),[I,P]=(0,i.useState)(""),[A,S]=(0,i.useState)(!1),[F,L]=(0,i.useState)([]),[W,E]=(0,i.useState)(!1),[q,D]=(0,i.useState)([]),[M,R]=(0,i.useState)(""),[T,_]=(0,i.useState)(!1),[H,G]=(0,i.useState)(!1),$=(0,i.useCallback)(e=>{var s;const r=f||(null===a||void 0===a||null===(s=a.owner)||void 0===s?void 0:s.login)||(null===a||void 0===a?void 0:a.full_name.split("/")[0]),i=x||(null===a||void 0===a?void 0:a.name);return e===((null===a||void 0===a?void 0:a.default_branch)||"main")?"https://".concat(r,".github.io/").concat(i):"https://".concat(r,".github.io/").concat(i,"/branches/").concat(e)},[f,a,x]),B=(0,i.useCallback)((e,s)=>{const a={id:s.replace(".fsh",""),title:"",description:"",fileName:s,content:e},r=e.split("\n");for(const i of r){const e=i.trim();if(e.startsWith("Instance:")){const s=e.match(/Instance:\s*([^\s]+)/);s&&(a.id=s[1])}if(e.startsWith("* title =")||e.startsWith("* title=")){const s=e.match(/\* title\s*=\s*"([^"]+)"/);s&&(a.title=s[1])}if(e.startsWith("* description =")||e.startsWith("* description=")){const s=e.match(/\* description\s*=\s*"([^"]+)"/);s&&(a.description=s[1])}e.startsWith("//")&&!a.title&&(a.title=e.replace("//","").trim())}return a.title||(a.title=a.id||s.replace(".fsh","")),a},[]),U=(0,i.useCallback)(async()=>{if(f&&x&&g)try{y(!0),w(null),console.log("ProgramIndicators: Fetching measures from ".concat(f,"/").concat(x,"/").concat(g));let i="input/fsh/measures",n=[];try{n=(await t.A.getDirectoryContents(f,x,i,g)).filter(e=>"file"===e.type&&(e.name.endsWith(".fsh")||e.name.endsWith(".cql")))}catch(e){console.log("ProgramIndicators: input/fsh/measures directory not found, trying alternative paths...");const a=["input/fsh","input/measures","measures","fsh/measures"];for(const r of a)try{const e=(await t.A.getDirectoryContents(f,x,r,g)).filter(e=>"file"===e.type&&(e.name.toLowerCase().includes("measure")||e.name.toLowerCase().includes("indicator"))&&(e.name.endsWith(".fsh")||e.name.endsWith(".cql")));if(e.length>0){n=e,i=r;break}}catch(s){console.log("ProgramIndicators: Alternative path ".concat(r," not found"))}}console.log("ProgramIndicators: Found ".concat(n.length," measure files in ").concat(i)),v(n.map(e=>(0,r.A)((0,r.A)({},e),{},{path:"".concat(i,"/").concat(e.name)})));const c=[];for(const e of n)try{const s=await t.A.getFileContent(f,x,"".concat(i,"/").concat(e.name),g),a=B(s,e.name);c.push(a)}catch(a){console.warn("ProgramIndicators: Failed to parse measure file ".concat(e.name,":"),a),c.push({id:e.name.replace(/\.(fsh|cql)$/,""),title:e.name.replace(/\.(fsh|cql)$/,""),description:"Measure file: ".concat(e.name),fileName:e.name,content:"",parseError:!0})}D(c)}catch(b){console.error("ProgramIndicators: Error fetching measure files:",b),b.message.includes("not found")||b.message.includes("not accessible")?w("Unable to access repository. This may be due to network issues, rate limiting, or repository permissions. Please try again later."):w("Failed to fetch measure files: ".concat(b.message))}finally{y(!1)}else console.log("ProgramIndicators: Missing required data:",{user:f,repo:x,branch:g})},[f,x,g,B]),V=(0,i.useCallback)(async()=>{if(f&&x&&g)try{G(!0);const e=$(g),s=await fetch("".concat(e,"/index.html"),{method:"HEAD"});_(s.ok)}catch(b){console.log("ProgramIndicators: No published IG found"),_(!1)}finally{G(!1)}},[f,x,g,$]),Z=(0,i.useCallback)(async()=>{if(f&&x)try{const e=await t.A.listBranches(f,x);L(e),E(e.some(e=>"gh-pages"===e.name))}catch(b){console.warn("ProgramIndicators: Failed to fetch branches:",b)}},[f,x]),z=q.filter(e=>e.title.toLowerCase().includes(M.toLowerCase())||e.description.toLowerCase().includes(M.toLowerCase())||e.id.toLowerCase().includes(M.toLowerCase()));return(0,i.useEffect)(()=>{f&&x&&g&&(U(),Z(),V())},[f,x,g,U,Z,V]),N?(0,l.jsx)("div",{className:"program-indicators loading-state",children:(0,l.jsxs)("div",{className:"loading-content",children:[(0,l.jsx)("h2",{children:"Loading Program Indicators..."}),(0,l.jsx)("p",{children:"Fetching measure files from repository..."}),h&&(0,l.jsxs)("div",{className:"page-error-notice",children:[(0,l.jsxs)("p",{children:[(0,l.jsx)("strong",{children:"Repository Access:"})," ",h]}),(0,l.jsx)("p",{children:"Attempting to access repository directly..."})]})]})}):b?(0,l.jsx)("div",{className:"program-indicators error-state",children:(0,l.jsxs)("div",{className:"error-content",children:[(0,l.jsx)("h2",{children:"Error Loading Program Indicators"}),(0,l.jsx)("p",{children:b}),h&&(0,l.jsxs)("div",{className:"page-error-details",children:[(0,l.jsx)("h3",{children:"Repository Access Issue"}),(0,l.jsx)("p",{children:h}),(0,l.jsx)("p",{children:"This may be due to:"}),(0,l.jsxs)("ul",{children:[(0,l.jsx)("li",{children:"Network connectivity issues"}),(0,l.jsx)("li",{children:"GitHub API rate limiting"}),(0,l.jsx)("li",{children:"Repository access permissions"}),(0,l.jsx)("li",{children:"Temporary service unavailability"})]})]}),(0,l.jsxs)("div",{className:"error-actions",children:[(0,l.jsx)("button",{onClick:()=>e("/"),className:"action-btn primary",children:"Return Home"}),(0,l.jsx)("button",{onClick:()=>window.location.reload(),className:"action-btn secondary",children:"Retry"})]})]})}):(0,l.jsxs)("div",{className:"program-indicators",children:[(0,l.jsx)("div",{className:"viewer-header",children:(0,l.jsxs)("div",{className:"header-content",children:[(0,l.jsxs)("div",{className:"header-info",children:[(0,l.jsx)("h1",{children:"\ud83d\udcca Program Indicators & Measures"}),(0,l.jsx)("p",{className:"header-subtitle",children:"Performance indicators and measurement definitions for monitoring and evaluation"}),(0,l.jsxs)("div",{className:"repository-info",children:[(0,l.jsxs)("span",{className:"repo-badge",children:["\ud83d\udcc1 ",f,"/",x]}),(0,l.jsxs)("span",{className:"branch-badge",children:["\ud83c\udf3f ",g]}),(0,l.jsxs)("span",{className:"count-badge",children:["\ud83d\udcca ",q.length," measure",1!==q.length?"s":""]})]})]}),T&&(0,l.jsx)("div",{className:"published-ig-link",children:(0,l.jsx)("a",{href:"".concat($(g),"/artifacts.html#structures-measures"),target:"_blank",rel:"noopener noreferrer",className:"action-btn secondary",children:"\ud83d\udccb View Published Measures"})})]})}),(0,l.jsxs)("div",{className:"viewer-content",children:[(0,l.jsx)("div",{className:"search-section",children:(0,l.jsxs)("div",{className:"search-bar",children:[(0,l.jsx)("input",{type:"text",placeholder:"Search measures by title, description, or ID...",value:M,onChange:e=>R(e.target.value),className:"search-input"}),(0,l.jsx)("span",{className:"search-icon",children:"\ud83d\udd0d"})]})}),0===z.length?(0,l.jsx)("div",{className:"no-measures",children:(0,l.jsxs)("div",{className:"no-measures-content",children:[(0,l.jsx)("h3",{children:"\ud83d\udcca No Program Indicators Found"}),(0,l.jsx)("p",{children:0===q.length?"This repository doesn't contain any measure files in the expected locations.":"No measures match your search criteria."}),0===q.length&&(0,l.jsxs)("div",{className:"help-text",children:[(0,l.jsx)("p",{children:"Expected locations for measure files:"}),(0,l.jsxs)("ul",{children:[(0,l.jsx)("li",{children:(0,l.jsx)("code",{children:"input/fsh/measures/"})}),(0,l.jsxs)("li",{children:[(0,l.jsx)("code",{children:"input/fsh/"})," (with measure-related files)"]}),(0,l.jsx)("li",{children:(0,l.jsx)("code",{children:"input/measures/"})})]})]})]})}):(0,l.jsx)("div",{className:"measures-grid",children:z.map((e,s)=>(0,l.jsxs)("div",{className:"measure-card",onClick:()=>(async e=>{try{if(k(e),e.content&&!e.parseError)P(e.content);else{const s=await t.A.getFileContent(f,x,e.fileName,g);P(s)}S(!0)}catch(b){console.error("ProgramIndicators: Error loading file content:",b),w("Failed to load file content: ".concat(b.message))}})(e),children:[(0,l.jsxs)("div",{className:"measure-header",children:[(0,l.jsx)("h3",{className:"measure-title",children:e.title}),(0,l.jsx)("span",{className:"measure-id",children:e.id})]}),e.description&&(0,l.jsx)("p",{className:"measure-description",children:e.description}),(0,l.jsxs)("div",{className:"measure-meta",children:[(0,l.jsxs)("span",{className:"file-name",children:["\ud83d\udcc4 ",e.fileName]}),e.parseError&&(0,l.jsx)("span",{className:"parse-warning",children:"\u26a0\ufe0f Parse error"})]})]},s))})]}),A&&C&&(0,l.jsx)("div",{className:"file-modal-overlay",onClick:()=>S(!1),children:(0,l.jsxs)("div",{className:"file-modal",onClick:e=>e.stopPropagation(),children:[(0,l.jsxs)("div",{className:"modal-header",children:[(0,l.jsxs)("h3",{children:["\ud83d\udcca ",C.title]}),(0,l.jsx)("button",{onClick:()=>S(!1),className:"close-btn",children:"\u2715"})]}),(0,l.jsxs)("div",{className:"modal-content",children:[(0,l.jsxs)("div",{className:"file-info",children:[(0,l.jsxs)("span",{className:"file-name",children:["\ud83d\udcc4 ",C.fileName]}),(0,l.jsxs)("span",{className:"measure-id",children:["ID: ",C.id]})]}),(0,l.jsx)("pre",{className:"file-content",children:I})]})]})}),(0,l.jsx)(o.A,{pageId:"program-indicators",helpTopics:["program-indicators-overview","viewing-measure-files","searching-measures"]})]})},h=()=>(0,l.jsx)(c.Mx,{pageName:"program-indicators",children:(0,l.jsx)(d,{})})}}]);