"use strict";(self.webpackChunksgex_workbench=self.webpackChunksgex_workbench||[]).push([[602],{20602:(e,s,a)=>{a.r(s),a.d(s,{default:()=>m});var i=a(89379),n=a(9950),t=a(69396),r=a(46901),c=a(53782),o=a(29166),l=a(44414);const d=()=>{const e=(0,t.Zp)(),{profile:s,repository:a,branch:d,error:m}=(0,c.N5)(),{user:h,repo:u,branch:p}=(0,t.g)(),f=(null===s||void 0===s?void 0:s.login)||h,g=(null===a||void 0===a?void 0:a.name)||u,x=d||p||"main",[j,N]=(0,n.useState)([]),[v,b]=(0,n.useState)(!0),[y,w]=(0,n.useState)(null),[C,I]=(0,n.useState)(null),[k,P]=(0,n.useState)(""),[A,T]=(0,n.useState)(!1),[W,D]=(0,n.useState)([]),[S,O]=(0,n.useState)(!1),[F,M]=(0,n.useState)([]),[E,H]=(0,n.useState)(""),[L,R]=(0,n.useState)(!1),[_,q]=(0,n.useState)(!1),[G,z]=(0,n.useState)(!1),[Z,U]=(0,n.useState)(""),[V,Y]=(0,n.useState)(!1);(0,n.useEffect)(()=>{(async()=>{if(a&&s)try{var e;const s=r.A.isAuth(),i=(null===(e=a.permissions)||void 0===e?void 0:e.push)||!1;Y(s&&i)}catch(y){console.warn("Could not check write permissions:",y),Y(!1)}else Y(!1)})()},[a,s]);const $=(0,n.useCallback)(e=>{var s;const i=f||(null===a||void 0===a||null===(s=a.owner)||void 0===s?void 0:s.login)||(null===a||void 0===a?void 0:a.full_name.split("/")[0]),n=g||(null===a||void 0===a?void 0:a.name);return e===((null===a||void 0===a?void 0:a.default_branch)||"main")?"https://".concat(i,".github.io/").concat(n):"https://".concat(i,".github.io/").concat(n,"/branches/").concat(e)},[f,a,g]),B=(0,n.useCallback)((e,s)=>{const a={id:s.replace(".fsh",""),title:"",description:"",name:"",definition:"",numerator:"",denominator:"",disaggregation:"",fileName:s,content:e,instanceOf:""},i=e.split("\n");for(const n of i){const e=n.trim();if(e.startsWith("Instance:")){const s=e.match(/Instance:\s*([^\s]+)/);s&&(a.id=s[1])}if(e.startsWith("InstanceOf:")){const s=e.match(/InstanceOf:\s*([^\s]+)/);s&&(a.instanceOf=s[1])}if(e.startsWith("Title:")){const s=e.match(/Title:\s*"([^"]+)"/);s&&(a.title=s[1])}if(e.startsWith("Description:")){const s=e.match(/Description:\s*"([^"]+)"/);s&&(a.description=s[1])}if(e.startsWith("* name =")){const s=e.match(/\* name\s*=\s*"([^"]+)"/);s&&(a.name=s[1],a.title||(a.title=s[1]))}if(e.startsWith("* definition =")){const s=e.match(/\* definition\s*=\s*"([^"]+)"/);s&&(a.definition=s[1])}if(e.startsWith("* numerator =")){const s=e.match(/\* numerator\s*=\s*"([^"]+)"/);s&&(a.numerator=s[1])}if(e.startsWith("* denominator =")){const s=e.match(/\* denominator\s*=\s*"([^"]+)"/);s&&(a.denominator=s[1])}if(e.startsWith("* disaggregation =")){const s=e.match(/\* disaggregation\s*=\s*"([^"]+)"/);s&&(a.disaggregation=s[1])}if(e.startsWith("* title =")||e.startsWith("* title=")){const s=e.match(/\* title\s*=\s*"([^"]+)"/);s&&!a.title&&(a.title=s[1])}e.startsWith("//")&&!a.title&&(a.title=e.replace("//","").trim())}return a.title||(a.title=a.name||a.id||s.replace(".fsh","")),!a.description&&a.definition&&(a.description=a.definition),a},[]),K=(0,n.useCallback)(async()=>{if(f&&g&&x)try{b(!0),w(null),console.log("ProgramIndicators: Fetching measures from ".concat(f,"/").concat(g,"/").concat(x));let n="input/fsh/measures",t=[];try{t=(await r.A.getDirectoryContents(f,g,n,x)).filter(e=>"file"===e.type&&(e.name.endsWith(".fsh")||e.name.endsWith(".cql")))}catch(e){console.log("ProgramIndicators: input/fsh/measures directory not found, trying alternative paths...");const a=["input/fsh","input/measures","measures","fsh/measures"];for(const i of a)try{const e=(await r.A.getDirectoryContents(f,g,i,x)).filter(e=>"file"===e.type&&(e.name.toLowerCase().includes("measure")||e.name.toLowerCase().includes("indicator"))&&(e.name.endsWith(".fsh")||e.name.endsWith(".cql")));if(e.length>0){t=e,n=i;break}}catch(s){console.log("ProgramIndicators: Alternative path ".concat(i," not found"))}}console.log("ProgramIndicators: Found ".concat(t.length," measure files in ").concat(n)),N(t.map(e=>(0,i.A)((0,i.A)({},e),{},{path:"".concat(n,"/").concat(e.name)})));const c=[];for(const e of t)try{const s=await r.A.getFileContent(f,g,"".concat(n,"/").concat(e.name),x),a=B(s,e.name);c.push(a)}catch(a){console.warn("ProgramIndicators: Failed to parse measure file ".concat(e.name,":"),a),c.push({id:e.name.replace(/\.(fsh|cql)$/,""),title:e.name.replace(/\.(fsh|cql)$/,""),description:"Measure file: ".concat(e.name),fileName:e.name,content:"",parseError:!0})}M(c)}catch(y){console.error("ProgramIndicators: Error fetching measure files:",y),y.message.includes("not found")||y.message.includes("not accessible")?w("Unable to access repository. This may be due to network issues, rate limiting, or repository permissions. Please try again later."):w("Failed to fetch measure files: ".concat(y.message))}finally{b(!1)}else console.log("ProgramIndicators: Missing required data:",{user:f,repo:g,branch:x})},[f,g,x,B]),J=(0,n.useCallback)(async()=>{if(f&&g&&x)try{q(!0);const e=$(x),s=await fetch("".concat(e,"/index.html"),{method:"HEAD"});R(s.ok)}catch(y){console.log("ProgramIndicators: No published IG found"),R(!1)}finally{q(!1)}},[f,g,x,$]),Q=(0,n.useCallback)(async()=>{if(f&&g)try{const e=await r.A.listBranches(f,g);D(e),O(e.some(e=>"gh-pages"===e.name))}catch(y){console.warn("ProgramIndicators: Failed to fetch branches:",y)}},[f,g]),X=()=>{V?z(!0):alert("You need write access to this repository to create new measures.")},ee=()=>{if(!Z.trim())return void alert("Please enter a measure name");const e=Z.trim().replace(/[^a-zA-Z0-9-_]/g,""),s="".concat(e),a=Z.trim(),i="Instance: ".concat(s,'\nInstanceOf: ProgramIndicator\nUsage: #definition\nTitle: "').concat(a,'"\nDescription: "Program indicator for ').concat(a,'"\n\n* id = "').concat(s,'"\n* name = "').concat(a,'"\n* definition = "Definition of what the indicator measures - describe the specific aspect of program performance this indicator tracks"\n* numerator = "Description of the numerator calculation - define what is counted in the numerator"\n* denominator = "Description of the denominator calculation - define the total population or comparison group"\n* disaggregation = "Description of how the indicator should be disaggregated - e.g., by age, sex, location, time period"\n\n// Optional: Add description with more context\n// * description = "Extended description of the indicator purpose and usage"\n\n// Optional: Add references to related Health Interventions\n// * references[+] = "HealthInterventionID1"\n// * references[+] = "HealthInterventionID2"\n');I({id:s,title:a,fileName:"".concat(e,".fsh"),description:"Program indicator for ".concat(a),content:i,isNew:!0}),P(i),z(!1),U(""),T(!0)},se=F.filter(e=>e.title.toLowerCase().includes(E.toLowerCase())||e.description.toLowerCase().includes(E.toLowerCase())||e.id.toLowerCase().includes(E.toLowerCase()));return(0,n.useEffect)(()=>{f&&g&&x&&(K(),Q(),J())},[f,g,x,K,Q,J]),v?(0,l.jsx)("div",{className:"program-indicators loading-state",children:(0,l.jsxs)("div",{className:"loading-content",children:[(0,l.jsx)("h2",{children:"Loading Program Indicators..."}),(0,l.jsx)("p",{children:"Fetching measure files from repository..."}),m&&(0,l.jsxs)("div",{className:"page-error-notice",children:[(0,l.jsxs)("p",{children:[(0,l.jsx)("strong",{children:"Repository Access:"})," ",m]}),(0,l.jsx)("p",{children:"Attempting to access repository directly..."})]})]})}):y?(0,l.jsx)("div",{className:"program-indicators error-state",children:(0,l.jsxs)("div",{className:"error-content",children:[(0,l.jsx)("h2",{children:"Error Loading Program Indicators"}),(0,l.jsx)("p",{children:y}),m&&(0,l.jsxs)("div",{className:"page-error-details",children:[(0,l.jsx)("h3",{children:"Repository Access Issue"}),(0,l.jsx)("p",{children:m}),(0,l.jsx)("p",{children:"This may be due to:"}),(0,l.jsxs)("ul",{children:[(0,l.jsx)("li",{children:"Network connectivity issues"}),(0,l.jsx)("li",{children:"GitHub API rate limiting"}),(0,l.jsx)("li",{children:"Repository access permissions"}),(0,l.jsx)("li",{children:"Temporary service unavailability"})]})]}),(0,l.jsxs)("div",{className:"error-actions",children:[(0,l.jsx)("button",{onClick:()=>e("/"),className:"action-btn primary",children:"Return Home"}),(0,l.jsx)("button",{onClick:()=>window.location.reload(),className:"action-btn secondary",children:"Retry"})]})]})}):(0,l.jsxs)("div",{className:"program-indicators",children:[(0,l.jsx)("div",{className:"viewer-header",children:(0,l.jsxs)("div",{className:"header-content",children:[(0,l.jsxs)("div",{className:"header-info",children:[(0,l.jsx)("h1",{children:"\ud83d\udcca Program Indicators & Measures"}),(0,l.jsx)("p",{className:"header-subtitle",children:"Performance indicators and measurement definitions for monitoring and evaluation"}),(0,l.jsxs)("div",{className:"repository-info",children:[(0,l.jsxs)("span",{className:"repo-badge",children:["\ud83d\udcc1 ",f,"/",g]}),(0,l.jsxs)("span",{className:"branch-badge",children:["\ud83c\udf3f ",x]}),(0,l.jsxs)("span",{className:"count-badge",children:["\ud83d\udcca ",F.length," measure",1!==F.length?"s":""]})]})]}),L&&(0,l.jsx)("div",{className:"published-ig-link",children:(0,l.jsx)("a",{href:"".concat($(x),"/artifacts.html#structures-measures"),target:"_blank",rel:"noopener noreferrer",className:"action-btn secondary",children:"\ud83d\udccb View Published Measures"})}),V&&(0,l.jsx)("div",{className:"create-measure-section",children:(0,l.jsx)("button",{onClick:X,className:"action-btn primary create-btn",title:"Create a new measure file",children:"\u2795 Create New Measure"})})]})}),(0,l.jsxs)("div",{className:"viewer-content",children:[(0,l.jsx)("div",{className:"search-section",children:(0,l.jsxs)("div",{className:"search-bar",children:[(0,l.jsx)("input",{type:"text",placeholder:"Search measures by title, description, or ID...",value:E,onChange:e=>H(e.target.value),className:"search-input"}),(0,l.jsx)("span",{className:"search-icon",children:"\ud83d\udd0d"})]})}),0===se.length?(0,l.jsx)("div",{className:"no-measures",children:(0,l.jsxs)("div",{className:"no-measures-content",children:[(0,l.jsx)("h3",{children:"\ud83d\udcca No Program Indicators Found"}),(0,l.jsx)("p",{children:0===F.length?"This repository doesn't contain any measure files in the expected locations.":"No measures match your search criteria."}),0===F.length&&(0,l.jsxs)("div",{className:"help-text",children:[(0,l.jsx)("p",{children:"Expected locations for measure files:"}),(0,l.jsxs)("ul",{children:[(0,l.jsx)("li",{children:(0,l.jsx)("code",{children:"input/fsh/measures/"})}),(0,l.jsxs)("li",{children:[(0,l.jsx)("code",{children:"input/fsh/"})," (with measure-related files)"]}),(0,l.jsx)("li",{children:(0,l.jsx)("code",{children:"input/measures/"})})]}),V&&(0,l.jsx)("button",{onClick:X,className:"action-btn primary",style:{marginTop:"1rem"},children:"\u2795 Create Your First Measure"})]})]})}):(0,l.jsx)("div",{className:"measures-grid",children:se.map((e,s)=>(0,l.jsxs)("div",{className:"measure-card",onClick:()=>(async e=>{try{if(I(e),e.content&&!e.parseError)P(e.content);else{const s=await r.A.getFileContent(f,g,e.fileName,x);P(s)}T(!0)}catch(y){console.error("ProgramIndicators: Error loading file content:",y),w("Failed to load file content: ".concat(y.message))}})(e),children:[(0,l.jsxs)("div",{className:"measure-header",children:[(0,l.jsx)("h3",{className:"measure-title",children:e.title}),(0,l.jsx)("span",{className:"measure-id",children:e.id}),e.instanceOf&&(0,l.jsx)("span",{className:"instance-badge",children:e.instanceOf})]}),e.description&&(0,l.jsx)("p",{className:"measure-description",children:e.description}),"ProgramIndicator"===e.instanceOf&&(0,l.jsxs)("div",{className:"indicator-details",children:[e.numerator&&(0,l.jsxs)("div",{className:"indicator-field",children:[(0,l.jsx)("strong",{children:"Numerator:"})," ",e.numerator.substring(0,100),e.numerator.length>100?"...":""]}),e.denominator&&(0,l.jsxs)("div",{className:"indicator-field",children:[(0,l.jsx)("strong",{children:"Denominator:"})," ",e.denominator.substring(0,100),e.denominator.length>100?"...":""]})]}),(0,l.jsxs)("div",{className:"measure-meta",children:[(0,l.jsxs)("span",{className:"file-name",children:["\ud83d\udcc4 ",e.fileName]}),e.parseError&&(0,l.jsx)("span",{className:"parse-warning",children:"\u26a0\ufe0f Parse error"})]})]},s))})]}),G&&(0,l.jsx)("div",{className:"file-modal-overlay",onClick:()=>z(!1),children:(0,l.jsxs)("div",{className:"file-modal create-modal",onClick:e=>e.stopPropagation(),children:[(0,l.jsxs)("div",{className:"modal-header",children:[(0,l.jsx)("h3",{children:"\u2795 Create New Measure"}),(0,l.jsx)("button",{onClick:()=>z(!1),className:"close-btn",children:"\u2715"})]}),(0,l.jsx)("div",{className:"modal-content",children:(0,l.jsxs)("div",{className:"create-form",children:[(0,l.jsx)("label",{htmlFor:"measure-name",children:"Measure Name:"}),(0,l.jsx)("input",{id:"measure-name",type:"text",placeholder:"e.g., HIV Testing Coverage",value:Z,onChange:e=>U(e.target.value),onKeyPress:e=>{"Enter"===e.key&&ee()},className:"measure-name-input",autoFocus:!0}),(0,l.jsxs)("div",{className:"create-form-help",children:[(0,l.jsx)("p",{children:"This will create a new Program Indicator using the WHO SMART Guidelines ProgramIndicator logical model."}),(0,l.jsxs)("p",{children:["The file will be saved as: ",(0,l.jsxs)("code",{children:["input/fsh/measures/",Z.trim().replace(/[^a-zA-Z0-9-_]/g,"")||"measure-name",".fsh"]})]}),(0,l.jsxs)("p",{className:"model-reference",children:["Model: ",(0,l.jsx)("a",{href:"https://github.com/WorldHealthOrganization/smart-base/blob/main/input/fsh/models/ProgramIndicator.fsh",target:"_blank",rel:"noopener noreferrer",children:"ProgramIndicator"})]})]}),(0,l.jsxs)("div",{className:"create-form-actions",children:[(0,l.jsx)("button",{onClick:ee,className:"action-btn primary",disabled:!Z.trim(),children:"Create Measure Template"}),(0,l.jsx)("button",{onClick:()=>z(!1),className:"action-btn secondary",children:"Cancel"})]})]})})]})}),A&&C&&(0,l.jsx)("div",{className:"file-modal-overlay",onClick:()=>T(!1),children:(0,l.jsxs)("div",{className:"file-modal",onClick:e=>e.stopPropagation(),children:[(0,l.jsxs)("div",{className:"modal-header",children:[(0,l.jsxs)("h3",{children:["\ud83d\udcca ",C.title]}),(0,l.jsx)("button",{onClick:()=>T(!1),className:"close-btn",children:"\u2715"})]}),(0,l.jsxs)("div",{className:"modal-content",children:[(0,l.jsxs)("div",{className:"file-info",children:[(0,l.jsxs)("span",{className:"file-name",children:["\ud83d\udcc4 ",C.fileName]}),(0,l.jsxs)("span",{className:"measure-id",children:["ID: ",C.id]}),C.instanceOf&&(0,l.jsx)("span",{className:"instance-badge",children:C.instanceOf}),C.isNew&&(0,l.jsx)("span",{className:"new-badge",children:"\u2728 New"})]}),"ProgramIndicator"===C.instanceOf&&!C.isNew&&(0,l.jsxs)("div",{className:"program-indicator-details",children:[C.name&&(0,l.jsxs)("div",{className:"indicator-detail-field",children:[(0,l.jsx)("strong",{children:"Name:"})," ",C.name]}),C.definition&&(0,l.jsxs)("div",{className:"indicator-detail-field",children:[(0,l.jsx)("strong",{children:"Definition:"})," ",C.definition]}),C.numerator&&(0,l.jsxs)("div",{className:"indicator-detail-field",children:[(0,l.jsx)("strong",{children:"Numerator:"})," ",C.numerator]}),C.denominator&&(0,l.jsxs)("div",{className:"indicator-detail-field",children:[(0,l.jsx)("strong",{children:"Denominator:"})," ",C.denominator]}),C.disaggregation&&(0,l.jsxs)("div",{className:"indicator-detail-field",children:[(0,l.jsx)("strong",{children:"Disaggregation:"})," ",C.disaggregation]})]}),C.isNew&&(0,l.jsxs)("div",{className:"new-measure-notice",children:[(0,l.jsx)("p",{children:(0,l.jsx)("strong",{children:"WHO ProgramIndicator Template Generated"})}),(0,l.jsx)("p",{children:"This template follows the WHO SMART Guidelines ProgramIndicator logical model from smart-base. To save this indicator to your repository:"}),(0,l.jsxs)("ol",{children:[(0,l.jsx)("li",{children:"Review and customize the template below"}),(0,l.jsx)("li",{children:"Fill in the required fields (name, definition, numerator, denominator, disaggregation)"}),(0,l.jsx)("li",{children:"Copy the content"}),(0,l.jsxs)("li",{children:["Create a new file at ",(0,l.jsxs)("code",{children:["input/fsh/measures/",C.fileName]})]}),(0,l.jsx)("li",{children:"Paste and save the content"})]}),(0,l.jsx)("div",{className:"notice-actions",children:(0,l.jsx)("button",{onClick:()=>{navigator.clipboard.writeText(k),alert("Template copied to clipboard!")},className:"action-btn primary",children:"\ud83d\udccb Copy Template"})})]}),(0,l.jsx)("pre",{className:"file-content",children:k})]})]})}),(0,l.jsx)(o.A,{pageId:"program-indicators",helpTopics:["program-indicators-overview","viewing-measure-files","searching-measures"]})]})},m=()=>(0,l.jsx)(c.Mx,{pageName:"program-indicators",children:(0,l.jsx)(d,{})})}}]);