"use strict";(self.webpackChunksgex_workbench=self.webpackChunksgex_workbench||[]).push([[2907],{52907:(e,s,t)=>{t.r(s),t.d(s,{default:()=>m});var a=t(89379),r=t(9950),i=t(85001),n=t(85571),o=t(94074);const l=new class{constructor(){this.logger=void 0,this.integrations=new Map,this.logger=n.A.getLogger("DAKLocalIntegrationService"),this.initializeIntegrations()}initializeIntegrations(){[{componentName:"DAKDashboard",supportedServiceTypes:["github","local"],localFallbacks:["dashboard","overview"],requiredPermissions:["read"]},{componentName:"CoreDataDictionaryViewer",supportedServiceTypes:["github","local"],localFallbacks:["input/core-data-elements.json","core-data.json"],requiredPermissions:["read"]},{componentName:"BPMNViewer",supportedServiceTypes:["github","local"],localFallbacks:["input/business-processes.bpmn","processes.bpmn"],requiredPermissions:["read"]},{componentName:"BPMNEditor",supportedServiceTypes:["github","local"],localFallbacks:["input/business-processes.bpmn","processes.bpmn"],requiredPermissions:["read","write"]},{componentName:"QuestionnaireEditor",supportedServiceTypes:["github","local"],localFallbacks:["input/questionnaires","forms"],requiredPermissions:["read","write"]},{componentName:"DecisionSupportLogicView",supportedServiceTypes:["github","local"],localFallbacks:["input/decision-logic","decision-tables"],requiredPermissions:["read"]},{componentName:"TestingViewer",supportedServiceTypes:["github","local"],localFallbacks:["input/tests","tests"],requiredPermissions:["read"]}].forEach(e=>{this.integrations.set(e.componentName,e)}),this.logger.debug("DAK integrations initialized",{componentCount:this.integrations.size})}isComponentCompatible(e,s){const t=this.integrations.get(e);return t?t.supportedServiceTypes.includes(s):(this.logger.warn("Unknown component",{componentName:e}),!1)}getCurrentRepositoryService(){return o.A.getCurrentService()}switchRepositoryService(e){return this.logger.debug("Switching repository service for DAK integration",{serviceType:e}),o.A.switchToService(e)}getLocalFallbackPaths(e){const s=this.integrations.get(e);return(null===s||void 0===s?void 0:s.localFallbacks)||[]}createRepositoryContext(e,s,t){const a=this.getCurrentRepositoryService();return{service:a,serviceType:a.serviceType,user:e,repo:s,branch:t||"main",isLocal:"local"===a.serviceType,isGitHub:"github"===a.serviceType}}async validateLocalRepositoryForComponent(e,s,t){this.logger.debug("Validating local repository for component",{componentName:e,owner:s,repo:t});const a=this.getCurrentRepositoryService();if("local"!==a.serviceType)return{isValid:!0};const r=this.integrations.get(e);if(!r)return{isValid:!1,recommendations:["Unknown component type"]};const i=r.localFallbacks||[],n=[],o=[];for(const m of i)try{await a.getFileContent(s,t,m),n.push(m)}catch(d){o.push(m)}try{(await a.validateDAKRepository(s,t)).isDak||o.push("sushi-config.yaml")}catch(d){o.push("sushi-config.yaml")}const l=n.length>0||0===i.length,c=[];return o.includes("sushi-config.yaml")&&c.push("Add sushi-config.yaml with smart.who.int.base dependency for DAK compliance"),0===n.length&&i.length>0&&c.push("Consider adding one of: ".concat(i.join(", "))),{isValid:l,missingFiles:o.length>0?o:void 0,foundFiles:n.length>0?n:void 0,recommendations:c.length>0?c:void 0}}getIntegrationStatus(){const e=o.A.getServiceType(),s=[],t=[],a=[];return this.integrations.forEach((a,r)=>{a.supportedServiceTypes.includes(e)?s.push(r):t.push(r)}),"local"===e?(a.push("Ensure local repositories contain necessary DAK files"),a.push("Use File System Access API compatible browser")):a.push("Ensure GitHub token has appropriate permissions"),{currentServiceType:e,supportedComponents:s,unsupportedComponents:t,recommendations:a}}async readFileWithFallback(e,s,t){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];const r=this.getCurrentRepositoryService();try{return{content:await r.getFileContent(e,s,t),actualPath:t}}catch(i){this.logger.debug("Primary path failed, trying fallbacks",{primaryPath:t,error:i})}for(const n of a)try{const t=await r.getFileContent(e,s,n);return this.logger.debug("Found content at fallback path",{fallbackPath:n}),{content:t,actualPath:n}}catch(i){this.logger.debug("Fallback path failed",{fallbackPath:n,error:i})}return this.logger.warn("No files found at any path",{primaryPath:t,fallbackPaths:a}),null}getSupportedOperations(){return"local"===this.getCurrentRepositoryService().serviceType?{canRead:!0,canWrite:!0,canCommit:!1,canBranch:!1,canCollaborate:!1,hasHistory:!1}:{canRead:!0,canWrite:!0,canCommit:!0,canBranch:!0,canCollaborate:!0,hasHistory:!0}}};var c=t(65531),d=t(44414);const m=()=>{const e=(0,i.Zp)(),{user:s,repo:t,branch:n}=(0,i.g)(),[o,m]=(0,r.useState)(null),[p,h]=(0,r.useState)(null),[u,g]=(0,r.useState)({}),[x,b]=(0,r.useState)(null),[y,v]=(0,r.useState)("DAKDashboard"),[j,f]=(0,r.useState)(null),[N,w]=(0,r.useState)(!1),[k,C]=(0,r.useState)(null);(0,r.useEffect)(()=>{F(),s&&t&&S()},[s,t,n]);const F=()=>{const e=l.getIntegrationStatus();m(e);const s=l.getSupportedOperations();b(s)},S=()=>{if(s&&t){const e=l.createRepositoryContext(s,t,n);h(e)}},D=["DAKDashboard","CoreDataDictionaryViewer","BPMNViewer","BPMNEditor","QuestionnaireEditor","DecisionSupportLogicView","TestingViewer"];return(0,d.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-blue-50 py-8",children:(0,d.jsxs)("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,d.jsxs)("div",{className:"text-center mb-8",children:[(0,d.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"DAK Local Integration Demo"}),(0,d.jsx)("p",{className:"text-gray-600 max-w-3xl mx-auto",children:"Explore how DAK components integrate with local repository service. Test component compatibility, file reading, and validation features."}),(0,d.jsxs)("div",{className:"mt-4 flex items-center justify-center space-x-4",children:[(0,d.jsx)("button",{onClick:()=>e("/"),className:"text-blue-600 hover:text-blue-800 text-sm font-medium",children:"\u2190 Back to Main Dashboard"}),(0,d.jsx)("button",{onClick:()=>e("/local-repository-demo"),className:"text-blue-600 hover:text-blue-800 text-sm font-medium",children:"Local Repository Demo \u2192"})]})]}),(0,d.jsx)("div",{className:"mb-8",children:(0,d.jsx)(c.A,{onServiceChange:(e,a)=>{F(),s&&t&&S(),g({}),f(null),C(null)}})}),p&&(0,d.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-8",children:[(0,d.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Repository Context"}),(0,d.jsxs)("div",{className:"grid md:grid-cols-2 gap-4 text-sm",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("span",{className:"text-gray-600",children:"Service Type:"}),(0,d.jsx)("span",{className:"ml-2 font-medium",children:p.serviceType})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("span",{className:"text-gray-600",children:"Repository:"}),(0,d.jsxs)("span",{className:"ml-2 font-medium",children:[p.user,"/",p.repo]})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("span",{className:"text-gray-600",children:"Branch:"}),(0,d.jsx)("span",{className:"ml-2 font-medium",children:p.branch})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("span",{className:"text-gray-600",children:"Mode:"}),(0,d.jsx)("span",{className:"ml-2 font-medium ".concat(p.isLocal?"text-green-600":"text-blue-600"),children:p.isLocal?"Local":"GitHub"})]})]})]}),!p&&(0,d.jsx)("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4 mb-8",children:(0,d.jsxs)("p",{className:"text-amber-800 text-sm",children:[(0,d.jsx)("strong",{children:"Note:"})," For full demonstration, visit this page with repository parameters:",(0,d.jsx)("code",{className:"ml-1 bg-amber-100 px-1 rounded",children:"/dak-local-integration-demo/user/repo/branch"})]})}),o&&(0,d.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-8",children:[(0,d.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Integration Status"}),(0,d.jsxs)("div",{className:"grid lg:grid-cols-2 gap-6",children:[(0,d.jsxs)("div",{children:[(0,d.jsxs)("h3",{className:"text-lg font-medium text-gray-900 mb-3",children:["Supported Components (",o.supportedComponents.length,")"]}),(0,d.jsx)("div",{className:"space-y-1",children:o.supportedComponents.map(e=>(0,d.jsxs)("div",{className:"flex items-center text-sm",children:[(0,d.jsx)("span",{className:"w-2 h-2 bg-green-400 rounded-full mr-2"}),e]},e))})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-3",children:"Recommendations"}),(0,d.jsx)("ul",{className:"space-y-1 text-sm text-gray-600",children:o.recommendations.map((e,s)=>(0,d.jsxs)("li",{className:"flex items-start",children:[(0,d.jsx)("span",{className:"text-blue-500 mr-2",children:"\u2022"}),e]},s))})]})]})]}),x&&(0,d.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-8",children:[(0,d.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Supported Operations"}),(0,d.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:Object.entries(x).map(e=>{let[s,t]=e;return(0,d.jsxs)("div",{className:"flex items-center",children:[(0,d.jsx)("span",{className:"w-2 h-2 rounded-full mr-2 ".concat(t?"bg-green-400":"bg-gray-300")}),(0,d.jsx)("span",{className:"text-sm ".concat(t?"text-gray-900":"text-gray-500"),children:s.replace(/([A-Z])/g," $1").toLowerCase()})]},s)})})]}),(0,d.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-8",children:[(0,d.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Component Validation"}),(0,d.jsxs)("div",{className:"grid lg:grid-cols-2 gap-6",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-3",children:"Test Component Compatibility"}),(0,d.jsx)("div",{className:"space-y-3",children:D.map(e=>(0,d.jsxs)("div",{className:"flex items-center justify-between p-3 border border-gray-200 rounded-md",children:[(0,d.jsxs)("div",{className:"flex items-center",children:[(0,d.jsx)("span",{className:"w-2 h-2 rounded-full mr-3 ".concat(null!==o&&void 0!==o&&o.supportedComponents.includes(e)?"bg-green-400":"bg-gray-300")}),(0,d.jsx)("span",{className:"text-sm font-medium",children:e})]}),(0,d.jsx)("button",{onClick:()=>(async e=>{if(s&&t){w(!0),C(null);try{const r=await l.validateLocalRepositoryForComponent(e,s,t);g(s=>(0,a.A)((0,a.A)({},s),{},{[e]:r}))}catch(r){C("Validation failed: ".concat(r.message))}finally{w(!1)}}else C("Please provide user and repo parameters in the URL")})(e),disabled:N||!s||!t,className:"px-3 py-1 text-xs font-medium text-blue-600 bg-blue-50 rounded-md hover:bg-blue-100 disabled:bg-gray-100 disabled:text-gray-400 disabled:cursor-not-allowed",children:"Validate"})]},e))})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-3",children:"Validation Results"}),0===Object.keys(u).length?(0,d.jsx)("div",{className:"p-4 border-2 border-dashed border-gray-300 rounded-md text-center text-gray-500",children:(0,d.jsx)("p",{className:"text-sm",children:'Click "Validate" to test component compatibility'})}):(0,d.jsx)("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:Object.entries(u).map(e=>{let[s,t]=e;return(0,d.jsxs)("div",{className:"p-3 border rounded-md ".concat(t.isValid?"border-green-200 bg-green-50":"border-red-200 bg-red-50"),children:[(0,d.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,d.jsx)("span",{className:"text-sm font-medium",children:s}),(0,d.jsx)("span",{className:"text-xs font-medium ".concat(t.isValid?"text-green-600":"text-red-600"),children:t.isValid?"Valid":"Invalid"})]}),t.foundFiles&&(0,d.jsxs)("div",{className:"text-xs text-green-700 mb-1",children:["Found: ",t.foundFiles.join(", ")]}),t.missingFiles&&(0,d.jsxs)("div",{className:"text-xs text-red-700 mb-1",children:["Missing: ",t.missingFiles.join(", ")]}),t.recommendations&&(0,d.jsx)("div",{className:"text-xs text-gray-600",children:t.recommendations.join("; ")})]},s)})})]})]})]}),(0,d.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-8",children:[(0,d.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"File Reading with Fallback"}),(0,d.jsxs)("div",{className:"grid lg:grid-cols-2 gap-6",children:[(0,d.jsxs)("div",{children:[(0,d.jsxs)("div",{className:"mb-4",children:[(0,d.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Component for Fallback Paths"}),(0,d.jsx)("select",{value:y,onChange:e=>v(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:D.map(e=>(0,d.jsx)("option",{value:e,children:e},e))})]}),(0,d.jsxs)("div",{className:"mb-4",children:[(0,d.jsxs)("p",{className:"text-sm text-gray-600 mb-2",children:["Fallback paths for ",y,":"]}),(0,d.jsx)("ul",{className:"text-xs text-gray-500 space-y-1",children:l.getLocalFallbackPaths(y).map((e,s)=>(0,d.jsxs)("li",{children:["\u2022 ",e]},s))})]}),(0,d.jsx)("button",{onClick:async()=>{if(s&&t){w(!0),C(null);try{const e=l.getLocalFallbackPaths(y),a=await l.readFileWithFallback(s,t,"README.md",["readme.md","README.txt",...e]);f(a)}catch(e){C("File reading failed: ".concat(e.message))}finally{w(!1)}}else C("Please provide user and repo parameters in the URL")},disabled:N||!s||!t,className:"w-full px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-blue-500",children:N?"Reading...":"Test File Reading"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-3",children:"File Content"}),j?(0,d.jsxs)("div",{className:"border border-gray-200 rounded-md",children:[(0,d.jsxs)("div",{className:"px-3 py-2 bg-gray-50 border-b border-gray-200 text-xs text-gray-600",children:["Found at: ",j.actualPath]}),(0,d.jsxs)("pre",{className:"p-4 text-xs text-gray-800 overflow-auto max-h-48 bg-white",children:[j.content.substring(0,1e3),j.content.length>1e3&&"\n... (truncated)"]})]}):(0,d.jsx)("div",{className:"p-4 border-2 border-dashed border-gray-300 rounded-md text-center text-gray-500",children:(0,d.jsx)("p",{className:"text-sm",children:'Click "Test File Reading" to read files with fallback'})})]})]})]}),k&&(0,d.jsx)("div",{className:"p-4 bg-red-50 border border-red-200 rounded-md mb-8",children:(0,d.jsx)("p",{className:"text-sm text-red-800",children:k})}),(0,d.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:[(0,d.jsx)("h2",{className:"text-lg font-semibold text-blue-900 mb-3",children:"\ud83d\udc31 About DAK Local Integration"}),(0,d.jsxs)("div",{className:"space-y-3 text-sm text-blue-800",children:[(0,d.jsxs)("p",{children:[(0,d.jsx)("strong",{children:"Purpose:"})," This service enables seamless integration between DAK components and local repository service, allowing offline DAK development workflows."]}),(0,d.jsxs)("p",{children:[(0,d.jsx)("strong",{children:"Features:"})," Component compatibility checking, file reading with fallbacks, repository validation, and service-specific operation support."]}),(0,d.jsxs)("p",{children:[(0,d.jsx)("strong",{children:"Usage:"})," DAK components automatically use this service to determine available operations and adapt their behavior based on the current repository service type."]})]})]})]})})}}}]);