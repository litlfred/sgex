"use strict";(self.webpackChunksgex_workbench=self.webpackChunksgex_workbench||[]).push([[432],{45432:(e,s,c)=>{c.r(s),c.d(s,{default:()=>r});var n=c(9950),a=c(85001),o=c(29946),t=c(96481),i=c(44414);const r=()=>{const e=(0,a.zy)(),s=(0,a.Zp)(),{profile:c,repository:r,component:l,selectedFile:d,selectedBranch:m}=e.state||{};console.log("BPMNSource: Received selectedBranch =",m);const[h,u]=(0,n.useState)(""),[b,p]=(0,n.useState)(!0),[x,j]=(0,n.useState)(null),[N,v]=(0,n.useState)(!1);(0,n.useEffect)(()=>{(async()=>{if(r&&c)try{var e;const s=c.token&&(null===(e=r.permissions)||void 0===e?void 0:e.push);v(s||!1)}catch(x){console.warn("Could not check write permissions:",x),v(!1)}})()},[r,c]),(0,n.useEffect)(()=>{(async()=>{if(d&&r)try{var e;p(!0),j(null);const s=(null===(e=r.owner)||void 0===e?void 0:e.login)||r.full_name.split("/")[0],c=r.name,n=m||"main";console.log("Loading BPMN source from ".concat(s,"/").concat(c,":").concat(d.path," (ref: ").concat(n,")"));const a=await o.A.getFileContent(s,c,d.path,n);console.log("Successfully loaded BPMN source from repository"),u(a),p(!1)}catch(s){console.error("Error loading BPMN source:",s),404===s.status?j("BPMN file not found in the repository. The file may have been moved or deleted."):403===s.status?j("Access denied. This repository may be private and require authentication."):s.message.includes("rate limit")?j("GitHub API rate limit exceeded. Please try again later or authenticate for higher limits."):j("Failed to load BPMN source: ".concat(s.message)),p(!1)}})()},[d,r,m]);const f=()=>{s("/business-process-selection",{state:{profile:c,repository:r,component:l,selectedBranch:m}})};return(0,n.useEffect)(()=>{c&&r&&d||s("/")},[c,r,d,s]),(0,i.jsx)(t.Mx,{pageName:"bpmn-source",children:(0,i.jsx)("div",{className:"bpmn-source",children:c&&r&&d?(0,i.jsxs)("div",{className:"source-content",children:[(0,i.jsxs)("div",{className:"breadcrumb",children:[(0,i.jsx)("button",{onClick:()=>s("/"),className:"breadcrumb-link",children:"Select Profile"}),(0,i.jsx)("span",{className:"breadcrumb-separator",children:"\u203a"}),(0,i.jsx)("button",{onClick:()=>s("/dak-selection/".concat(c.login),{state:{profile:c}}),className:"breadcrumb-link",children:"Select Repository"}),(0,i.jsx)("span",{className:"breadcrumb-separator",children:"\u203a"}),(0,i.jsx)("button",{onClick:()=>s("/dashboard",{state:{profile:c,repository:r}}),className:"breadcrumb-link",children:"DAK Components"}),(0,i.jsx)("span",{className:"breadcrumb-separator",children:"\u203a"}),(0,i.jsx)("button",{onClick:f,className:"breadcrumb-link",children:"Business Processes"}),(0,i.jsx)("span",{className:"breadcrumb-separator",children:"\u203a"}),(0,i.jsxs)("span",{className:"breadcrumb-current",children:[d.name," (source)"]})]}),(0,i.jsxs)("div",{className:"source-main",children:[(0,i.jsxs)("div",{className:"source-toolbar",children:[(0,i.jsxs)("div",{className:"toolbar-left",children:[(0,i.jsx)("h3",{children:d.name}),(0,i.jsx)("span",{className:"source-mode-badge",children:"\ud83d\udcc4 XML Source"})]}),(0,i.jsxs)("div",{className:"toolbar-right",children:[(0,i.jsx)("button",{className:"action-btn secondary",onClick:f,children:"\u2190 Back to List"}),(0,i.jsx)("button",{className:"action-btn secondary",onClick:async()=>{try{await navigator.clipboard.writeText(h);const e=document.querySelector(".copy-btn"),s=e.textContent;e.textContent="\u2713 Copied!",setTimeout(()=>{e.textContent=s},2e3)}catch(e){console.error("Failed to copy to clipboard:",e),alert("Failed to copy to clipboard")}},disabled:b,children:"\ud83d\udccb Copy"}),(0,i.jsx)("button",{className:"action-btn secondary",onClick:()=>{const e=new Blob([h],{type:"application/xml"}),s=URL.createObjectURL(e),c=document.createElement("a");c.href=s,c.download=d.name,document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(s)},disabled:b,children:"\ud83d\udcbe Download"})]})]}),(0,i.jsx)("div",{className:"source-container",children:b?(0,i.jsxs)("div",{className:"loading-overlay",children:[(0,i.jsx)("div",{className:"spinner"}),(0,i.jsx)("p",{children:"Loading BPMN source code..."})]}):x?(0,i.jsxs)("div",{className:"error-overlay",children:[(0,i.jsxs)("p",{children:["\u274c ",x]}),(0,i.jsx)("button",{className:"action-btn secondary",onClick:()=>window.location.reload(),children:"Retry"})]}):(0,i.jsx)("pre",{className:"source-code",children:(0,i.jsx)("code",{className:"xml-code",children:h})})}),(0,i.jsxs)("div",{className:"source-actions",children:[(0,i.jsxs)("div",{className:"github-links",children:[(0,i.jsx)("h4",{children:"GitHub Actions"}),(0,i.jsxs)("div",{className:"link-buttons",children:[(0,i.jsx)("a",{href:(()=>{var e;const s=(null===(e=r.owner)||void 0===e?void 0:e.login)||r.full_name.split("/")[0],c=m||"main";console.log("BPMNSource GitHub URL: using branch =",c);const n=encodeURIComponent(c),a="https://github.com/".concat(s,"/").concat(r.name,"/blob/").concat(n,"/").concat(d.path);return console.log("BPMNSource GitHub URL generated:",a),a})(),target:"_blank",rel:"noopener noreferrer",className:"action-btn github-view",children:"\ud83d\udc41\ufe0f View on GitHub"}),N&&(0,i.jsx)("a",{href:(()=>{var e;const s=(null===(e=r.owner)||void 0===e?void 0:e.login)||r.full_name.split("/")[0],c=encodeURIComponent(m||"main");return"https://github.com/".concat(s,"/").concat(r.name,"/edit/").concat(c,"/").concat(d.path)})(),target:"_blank",rel:"noopener noreferrer",className:"action-btn github-edit",children:"\u270f\ufe0f Edit on GitHub"})]})]}),(0,i.jsxs)("div",{className:"file-info",children:[(0,i.jsx)("h4",{children:"File Information"}),(0,i.jsxs)("div",{className:"info-grid",children:[(0,i.jsxs)("div",{className:"info-item",children:[(0,i.jsx)("label",{children:"File Path:"}),(0,i.jsx)("span",{className:"file-path",children:d.path})]}),(0,i.jsxs)("div",{className:"info-item",children:[(0,i.jsx)("label",{children:"File Size:"}),(0,i.jsxs)("span",{children:[(d.size/1024).toFixed(1)," KB"]})]}),(0,i.jsxs)("div",{className:"info-item",children:[(0,i.jsx)("label",{children:"Format:"}),(0,i.jsx)("span",{children:"BPMN 2.0 XML"})]}),(0,i.jsxs)("div",{className:"info-item",children:[(0,i.jsx)("label",{children:"Access Level:"}),(0,i.jsx)("span",{className:"access-badge ".concat(N?"write":"read"),children:N?"\u270f\ufe0f Edit Access":"\ud83d\udc41\ufe0f Read-Only"})]})]})]})]})]})]}):(0,i.jsxs)("div",{className:"redirecting-state",children:[(0,i.jsx)("h2",{children:"Redirecting..."}),(0,i.jsx)("p",{children:"Missing required context. Redirecting to home page..."})]})})})}}}]);