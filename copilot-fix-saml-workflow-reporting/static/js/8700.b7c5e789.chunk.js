"use strict";(self.webpackChunksgex_workbench=self.webpackChunksgex_workbench||[]).push([[8700],{53155:(e,a,s)=>{s.d(a,{A:()=>l});var i=s(9950),n=s(85571),o=s(44414);const l=e=>{let{isOpen:a,onClose:s,samlInfo:l}=e;const t=n.A.getLogger("SAMLAuthModal");if((0,i.useEffect)(()=>(a&&l&&t.componentMount({organization:l.organization,repository:l.repository}),()=>{a&&t.componentUnmount()}),[t,a,l]),!a||!l)return null;const{organization:r,repository:c,authorizationUrl:d}=l,h=()=>{t.userAction("SAML modal closed",{organization:r}),s()};return(0,o.jsx)("div",{className:"saml-modal-overlay",onClick:h,role:"dialog","aria-modal":"true","aria-labelledby":"saml-modal-title",children:(0,o.jsxs)("div",{className:"saml-modal",onClick:e=>e.stopPropagation(),role:"document",children:[(0,o.jsxs)("div",{className:"saml-modal-header",children:[(0,o.jsx)("h2",{id:"saml-modal-title",children:"\ud83d\udd10 SAML SSO Authorization Required"}),(0,o.jsx)("button",{onClick:h,className:"close-button","aria-label":"Close",children:"\xd7"})]}),(0,o.jsxs)("div",{className:"saml-modal-content",children:[(0,o.jsxs)("div",{className:"saml-info-section",children:[(0,o.jsx)("div",{className:"saml-icon",children:(0,o.jsx)("span",{role:"img","aria-label":"lock",children:"\ud83d\udd12"})}),(0,o.jsx)("h3",{children:"Organization Access Required"}),(0,o.jsxs)("p",{className:"saml-description",children:["Your Personal Access Token needs SAML SSO authorization to access the"," ",(0,o.jsx)("strong",{children:r})," organization",c?" and the ".concat(c," repository"):"","."]})]}),(0,o.jsxs)("div",{className:"saml-steps-section",children:[(0,o.jsx)("h4",{children:"How to authorize your token:"}),(0,o.jsxs)("ol",{className:"saml-steps",children:[(0,o.jsxs)("li",{children:[(0,o.jsx)("strong",{children:'Click "Authorize on GitHub"'})," below to open the authorization page"]}),(0,o.jsxs)("li",{children:[(0,o.jsx)("strong",{children:"Review the permissions"})," requested by the organization"]}),(0,o.jsxs)("li",{children:[(0,o.jsx)("strong",{children:'Click "Authorize"'})," to grant your token access"]}),(0,o.jsxs)("li",{children:[(0,o.jsx)("strong",{children:"Return to this page"})," and refresh or try your action again"]})]})]}),(0,o.jsxs)("div",{className:"saml-note",children:[(0,o.jsx)("span",{className:"note-icon",children:"\u2139\ufe0f"}),(0,o.jsx)("p",{children:"This is a GitHub security feature for organizations using SAML SSO. You only need to authorize once per organization per token."})]}),(0,o.jsxs)("div",{className:"saml-modal-actions",children:[(0,o.jsx)("button",{onClick:()=>{t.userAction("Authorize SAML clicked",{organization:r,authorizationUrl:d}),window.open(d,"_blank","noopener,noreferrer"),t.info("SAML authorization page opened",{organization:r,instruction:"User should authorize their PAT on GitHub and then refresh"})},className:"saml-authorize-btn",children:"\ud83d\udd13 Authorize on GitHub"}),(0,o.jsx)("button",{onClick:h,className:"saml-cancel-btn",children:"Later"})]})]})]})})}},98700:(e,a,s)=>{s.r(a),s.d(a,{default:()=>m});var i=s(89379),n=s(9950),o=s(69396),l=s(67818),t=s(46901),r=s(29473),c=s(78952),d=s(53155),h=s(53782),u=s(1932),g=s(44414);const m=()=>{const{t:e}=(0,l.Bd)(),[a,s]=(0,n.useState)(null),[m,p]=(0,n.useState)([]),[x,j]=(0,n.useState)(!1),[f,v]=(0,n.useState)(!1),[z,N]=(0,n.useState)(null),[b,A]=(0,n.useState)({}),[k,y]=(0,n.useState)(null),[w,O]=(0,n.useState)(!1),[S,C]=(0,n.useState)(null),H=(0,o.Zp)(),W=(0,o.zy)(),M=(0,n.useCallback)((e,a)=>{if(!t.A.isAuth())return;const s={};if(e){const a=r.A.getCachedRepositories(e.login,"user");a&&a.repositories&&(s["user-".concat(e.login)]=a.repositories.length)}a.forEach(e=>{const a=r.A.getCachedRepositories(e.login,"org");a&&a.repositories&&(s["org-".concat(e.login)]=a.repositories.length)}),A(s)},[]),L=(0,n.useCallback)(async()=>{v(!0),N(null);try{let a=null;x?(await t.A.checkTokenPermissions(),a=await t.A.getCurrentUser(),s(a)):(a=null,s(null));let n=[];if(x)try{n=await t.A.getUserOrganizations()}catch(z){console.error("Error fetching organizations:",z),n=[]}try{const e=await t.A.getWHOOrganization(),a=n.findIndex(e=>"WorldHealthOrganization"===e.login);a>=0?n[a]=(0,i.A)((0,i.A)((0,i.A)({},n[a]),e),{},{isWHO:!0}):n.unshift(e)}catch(e){console.warn("Could not fetch WHO organization data, using fallback:",e);const a={id:"who-organization",login:"WorldHealthOrganization",name:"World Health Organization",description:"The World Health Organization is a specialized agency of the United Nations responsible for international public health.",avatar_url:"https://avatars.githubusercontent.com/u/12261302?s=200&v=4",html_url:"https://github.com/WorldHealthOrganization",type:"Organization",isWHO:!0};n.some(e=>"WorldHealthOrganization"===e.login)?n=n.map(e=>"WorldHealthOrganization"===e.login?(0,i.A)((0,i.A)({},e),{},{isWHO:!0}):e):n.unshift(a)}p(n),x&&M(a,n)}catch(z){console.error("Error fetching user data:",z),x?(N("Failed to fetch user data. Please check your connection and try again."),j(!1),t.A.logout()):N("Unable to fetch additional data. Some features may be limited.")}finally{v(!1)}},[M,x]);(0,n.useEffect)(()=>{(()=>{const e=t.A.initializeFromStoredToken();j(!!e)})()},[]),(0,n.useEffect)(()=>{c.A.registerModalCallback(e=>{C(e),O(!0)})},[]),(0,n.useEffect)(()=>{var e;null!==(e=W.state)&&void 0!==e&&e.warningMessage&&(y(W.state.warningMessage),H(W.pathname,{replace:!0,state:{}}))},[W.state,H,W.pathname]),(0,n.useEffect)(()=>{a||L()},[a,L]);const E=(e,a)=>{const s={profile:a};(0,u.hX)(e,"/dak-action/".concat(a.login),H,s)};return(0,g.jsxs)(h.Mx,{pageName:"select-profile",children:[f&&!a?(0,g.jsxs)("div",{className:"loading-section",children:[(0,g.jsx)("div",{className:"spinner"}),(0,g.jsx)("p",{children:"Loading profile data..."})]}):(0,g.jsxs)("div",{className:"select-profile-content",children:[k&&(0,g.jsx)("div",{className:"warning-message",children:(0,g.jsxs)("div",{className:"warning-content",children:[(0,g.jsxs)("div",{className:"warning-header",children:[(0,g.jsx)("span",{className:"warning-icon",children:"\u26a0\ufe0f"}),(0,g.jsx)("span",{className:"warning-text",children:k})]}),(0,g.jsx)("button",{className:"warning-dismiss",onClick:()=>{y(null)},"aria-label":"Dismiss warning",children:"\xd7 Dismiss"})]})}),!x&&(0,g.jsx)("div",{className:"auth-status-message",children:(0,g.jsxs)("div",{className:"auth-status-content",children:[(0,g.jsx)("span",{className:"auth-status-icon",children:"\ud83d\udd13"}),(0,g.jsx)("span",{className:"auth-status-text",children:"You are browsing in unauthenticated mode. Some features like saving to GitHub will be disabled, but you can still explore and use local staging."})]})}),f?(0,g.jsxs)("div",{className:"loading-section",children:[(0,g.jsx)("div",{className:"spinner"}),(0,g.jsx)("p",{children:"Loading profile data..."})]}):(0,g.jsxs)("div",{className:"profile-selection",children:[(0,g.jsx)("h2",{children:e("organization.select")}),(0,g.jsxs)("p",{children:[e("organization.personal"),":"]}),z&&(0,g.jsx)("div",{className:"error-message",children:z}),(0,g.jsxs)("div",{className:"profile-grid-horizontal",children:[x&&a&&(0,g.jsxs)("div",{className:"profile-card",onClick:e=>E(e,(0,i.A)({type:"user"},a)),children:[(0,g.jsxs)("div",{className:"profile-card-header",children:[(0,g.jsx)("img",{src:null===a||void 0===a?void 0:a.avatar_url,alt:"Personal profile"}),b["user-".concat(null===a||void 0===a?void 0:a.login)]>0&&(0,g.jsx)("div",{className:"dak-count-badge",children:b["user-".concat(null===a||void 0===a?void 0:a.login)]})]}),(0,g.jsx)("h3",{children:(null===a||void 0===a?void 0:a.name)||(null===a||void 0===a?void 0:a.login)}),(0,g.jsx)("p",{children:"Personal repositories"}),(0,g.jsx)("div",{className:"profile-badges",children:(0,g.jsx)("span",{className:"profile-type",children:"Personal"})})]}),m.map(a=>(0,g.jsxs)("div",{className:"profile-card ".concat(a.isWHO?"who-org":""),onClick:e=>E(e,(0,i.A)({type:"org"},a)),children:[(0,g.jsxs)("div",{className:"profile-card-header",children:[(0,g.jsx)("img",{src:a.avatar_url||"https://github.com/".concat(a.login,".png"),alt:"".concat(a.name||a.login," organization")}),b["org-".concat(a.login)]>0&&(0,g.jsx)("div",{className:"dak-count-badge",children:b["org-".concat(a.login)]})]}),(0,g.jsx)("h3",{children:a.name||a.login}),(0,g.jsxs)("p",{children:["@",a.login]}),(0,g.jsxs)("div",{className:"profile-badges",children:[(0,g.jsx)("span",{className:"profile-type",children:e("organization.organizations")}),a.isWHO&&(0,g.jsx)("span",{className:"who-badge",children:"WHO Official"})]})]},a.login))]})]})]}),(0,g.jsx)(d.A,{isOpen:w,onClose:()=>{O(!1),C(null)},samlInfo:S})]})}}}]);