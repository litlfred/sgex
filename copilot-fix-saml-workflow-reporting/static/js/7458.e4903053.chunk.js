"use strict";(self.webpackChunksgex_workbench=self.webpackChunksgex_workbench||[]).push([[7458],{27458:(e,a,s)=>{s.r(a),s.d(a,{default:()=>p});var n=s(89379),i=s(9950),t=s(69396),o=s(67818),r=s(46901),l=s(29473),c=(s(78723),s(78952)),d=s(37210),h=s(53155),u=s(53782),m=s(1932),g=s(44414);const p=()=>{const{t:e}=(0,o.Bd)(),[a,s]=(0,i.useState)(null),[p,x]=(0,i.useState)([]),[j,v]=(0,i.useState)(!1),[f,A]=(0,i.useState)(!1),[N,b]=(0,i.useState)(null),[k,z]=(0,i.useState)({}),[w,y]=(0,i.useState)(null),[S,C]=(0,i.useState)(!1),[O,T]=(0,i.useState)(null),P=(0,t.Zp)(),H=(0,t.zy)(),W=(0,i.useCallback)((e,a)=>{if(!r.A.isAuth())return;const s={};if(e){const a=l.A.getCachedRepositories(e.login,"user");a&&a.repositories&&(s["user-".concat(e.login)]=a.repositories.length)}a.forEach(e=>{const a=l.A.getCachedRepositories(e.login,"org");a&&a.repositories&&(s["org-".concat(e.login)]=a.repositories.length)}),z(s)},[]),M=(0,i.useCallback)(async()=>{A(!0),b(null);try{await r.A.checkTokenPermissions();const a=await r.A.getCurrentUser();s(a);let i=[];if(r.A.isAuth())try{i=await r.A.getUserOrganizations()}catch(N){console.error("Error fetching organizations:",N),i=[]}try{const e=await r.A.getWHOOrganization(),a=i.findIndex(e=>"WorldHealthOrganization"===e.login);a>=0?i[a]=(0,n.A)((0,n.A)((0,n.A)({},i[a]),e),{},{isWHO:!0}):i.unshift(e)}catch(e){console.warn("Could not fetch WHO organization data, using fallback:",e);const a={id:"who-organization",login:"WorldHealthOrganization",name:"World Health Organization",description:"The World Health Organization is a specialized agency of the United Nations responsible for international public health.",avatar_url:"https://avatars.githubusercontent.com/u/12261302?s=200&v=4",html_url:"https://github.com/WorldHealthOrganization",type:"Organization",isWHO:!0};i.some(e=>"WorldHealthOrganization"===e.login)?i=i.map(e=>"WorldHealthOrganization"===e.login?(0,n.A)((0,n.A)({},e),{},{isWHO:!0}):e):i.unshift(a)}x(i),W(a,i)}catch(N){console.error("Error fetching user data:",N),b("Failed to fetch user data. Please check your connection and try again."),v(!1),r.A.logout()}finally{A(!1)}},[W]);(0,i.useEffect)(()=>{r.A.initializeFromStoredToken()&&v(!0)},[]),(0,i.useEffect)(()=>{c.A.registerModalCallback(e=>{T(e),C(!0)})},[]),(0,i.useEffect)(()=>{var e;null!==(e=H.state)&&void 0!==e&&e.warningMessage&&(y(H.state.warningMessage),P(H.pathname,{replace:!0,state:{}}))},[H.state,P,H.pathname]),(0,i.useEffect)(()=>{j&&!a&&M()},[j,a,M]);const E=(e,a)=>{r.A.authenticateWithOctokit(a),r.A.authenticate(e),v(!0),b(null),M()},D=(e,a)=>{const s={profile:a};(0,m.hX)(e,"/dak-action/".concat(a.login),P,s)},L=e=>{const a={login:"demo-user",name:"Demo User",avatar_url:"https://github.com/github.png",type:"User",isDemo:!0},s={profile:a,action:"edit"};(0,m.hX)(e,"/dak-selection/".concat(a.login),P,s)},U=()=>{y(null)};return j?(0,g.jsxs)(u.Mx,{pageName:"landing-authenticated",children:[(0,g.jsxs)("div",{className:"landing-content",children:[w&&(0,g.jsx)("div",{className:"warning-message",children:(0,g.jsxs)("div",{className:"warning-content",children:[(0,g.jsx)("span",{className:"warning-icon",children:"\u26a0\ufe0f"}),(0,g.jsx)("span",{className:"warning-text",children:w}),(0,g.jsx)("button",{className:"warning-dismiss",onClick:U,"aria-label":"Dismiss warning",children:"\xd7"})]})}),f?(0,g.jsxs)("div",{className:"loading-section",children:[(0,g.jsx)("div",{className:"spinner"}),(0,g.jsx)("p",{children:"Loading profile data..."})]}):(0,g.jsxs)("div",{className:"profile-selection",children:[(0,g.jsx)("h2",{children:e("organization.select")}),(0,g.jsxs)("p",{children:[e("organization.personal"),":"]}),N&&(0,g.jsx)("div",{className:"error-message",children:N}),(0,g.jsxs)("div",{className:"profile-grid",children:[(0,g.jsxs)("div",{className:"profile-card",onClick:e=>D(e,(0,n.A)({type:"user"},a)),children:[(0,g.jsxs)("div",{className:"profile-card-header",children:[(0,g.jsx)("img",{src:null===a||void 0===a?void 0:a.avatar_url,alt:"Personal profile"}),k["user-".concat(null===a||void 0===a?void 0:a.login)]>0&&(0,g.jsx)("div",{className:"dak-count-badge",children:k["user-".concat(null===a||void 0===a?void 0:a.login)]})]}),(0,g.jsx)("h3",{children:(null===a||void 0===a?void 0:a.name)||(null===a||void 0===a?void 0:a.login)}),(0,g.jsx)("p",{children:"Personal repositories"}),(0,g.jsx)("div",{className:"profile-badges",children:(0,g.jsx)("span",{className:"profile-type",children:"Personal"})})]}),p.map(a=>(0,g.jsxs)("div",{className:"profile-card ".concat(a.isWHO?"who-org":""),onClick:e=>D(e,(0,n.A)({type:"org"},a)),children:[(0,g.jsxs)("div",{className:"profile-card-header",children:[(0,g.jsx)("img",{src:a.avatar_url||"https://github.com/".concat(a.login,".png"),alt:"".concat(a.name||a.login," organization")}),k["org-".concat(a.login)]>0&&(0,g.jsx)("div",{className:"dak-count-badge",children:k["org-".concat(a.login)]})]}),(0,g.jsx)("h3",{children:a.name||a.login}),(0,g.jsxs)("p",{children:["@",a.login]}),(0,g.jsxs)("div",{className:"profile-badges",children:[(0,g.jsx)("span",{className:"profile-type",children:e("organization.organizations")}),a.isWHO&&(0,g.jsx)("span",{className:"who-badge",children:"WHO Official"})]})]},a.login))]})]})]}),(0,g.jsx)(h.A,{isOpen:S,onClose:()=>{C(!1),T(null)},samlInfo:O})]}):(0,g.jsx)(u.Mx,{pageName:"landing-unauthenticated",children:(0,g.jsxs)("div",{className:"landing-content",children:[w&&(0,g.jsx)("div",{className:"warning-message",children:(0,g.jsxs)("div",{className:"warning-content",children:[(0,g.jsx)("span",{className:"warning-icon",children:"\u26a0\ufe0f"}),(0,g.jsx)("span",{className:"warning-text",children:w}),(0,g.jsx)("button",{className:"warning-dismiss",onClick:U,"aria-label":"Dismiss warning",children:"\xd7"})]})}),(0,g.jsxs)("div",{className:"welcome-section",children:[(0,g.jsx)("h2",{children:e("landing.welcome")}),(0,g.jsx)("p",{children:e("app.description")}),(0,g.jsxs)("div",{className:"auth-section",children:[(0,g.jsxs)("p",{children:[e("auth.signInWithPAT"),":"]}),(0,g.jsx)(d.A,{onAuthSuccess:E}),N&&(0,g.jsx)("div",{className:"error-message",children:N})]}),(0,g.jsxs)("div",{className:"demo-section",children:[(0,g.jsx)("p",{children:"Want to try without authentication?"}),(0,g.jsx)("button",{onClick:L,className:"demo-mode-btn",children:"\ud83c\udfad Try Demo Mode"}),(0,g.jsx)("p",{className:"demo-note",children:"Demo mode showcases the enhanced DAK scanning display with mock data."})]}),(0,g.jsx)("div",{className:"info-section",children:(0,g.jsx)("p",{children:"Need help getting started? Use the help mascot (bottom-right corner) to access comprehensive documentation and learn more about SGEX Workbench and DAK components."})})]})]})})}},37210:(e,a,s)=>{s.d(a,{A:()=>r});var n=s(9950),i=s(67818),t=s(85571),o=s(44414);const r=e=>{let{onAuthSuccess:a}=e;const{t:r}=(0,i.Bd)(),[l,c]=(0,n.useState)(""),[d,h]=(0,n.useState)(""),[u,m]=(0,n.useState)(""),[g,p]=(0,n.useState)(!1),x=t.A.getLogger("PATLogin");n.useEffect(()=>(x.componentMount({hasOnAuthSuccess:!!a}),()=>x.componentUnmount()),[x,a]);return(0,o.jsx)("div",{className:"pat-login",children:(0,o.jsxs)("div",{className:"pat-login-section",children:[(0,o.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),x.userAction("PAT login attempt",{tokenProvided:!!l.trim()}),!l.trim()){return m("Please enter a GitHub Personal Access Token"),void x.warn("PAT login failed - no token provided")}p(!0),m("");const n=Date.now();x.auth("Starting PAT authentication");try{const{Octokit:e}=await s.e(112).then(s.bind(s,10112)),i=new e({auth:l.trim()});x.debug("Octokit instance created for PAT validation"),x.apiCall("GET","/user",null);const t=await i.rest.users.getAuthenticated(),o=Date.now()-n;x.apiResponse("GET","/user",t.status,o),x.auth("PAT authentication successful",{username:t.data.login,duration:o}),a(l.trim(),i)}catch(i){const e=Date.now()-n;x.apiError("GET","/user",i),x.auth("PAT authentication failed",{status:i.status,message:i.message,duration:e}),console.error("PAT authentication failed:",i),401===i.status?m("Invalid Personal Access Token. Please check your token and try again."):403===i.status?m("Token doesn't have sufficient permissions. Please ensure your token has 'repo' and 'read:org' scopes."):m("Authentication failed. Please check your connection and try again.")}finally{p(!1)}},className:"pat-form",children:[(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{htmlFor:"token-name",children:"Token Name (optional):"}),(0,o.jsx)("input",{id:"token-name",type:"text",value:d,onChange:e=>{h(e.target.value),u&&m("")},placeholder:"e.g., SGEX Access Token",className:"token-name-input",disabled:g,autoComplete:"username"})]}),(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsxs)("label",{htmlFor:"pat-token",children:[r("auth.setupToken"),":"]}),(0,o.jsx)("input",{id:"pat-token",type:"password",value:l,onChange:e=>{c(e.target.value),u&&m("")},placeholder:"ghp_xxxxxxxxxxxxxxxxxxxx",className:"token-input ".concat(u?"error":""),disabled:g,autoComplete:"current-password"})]}),(0,o.jsx)("button",{type:"submit",className:"github-login-btn",disabled:g||!l.trim(),children:g?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("span",{className:"spinner small"}),r("common.loading"),"..."]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("span",{className:"github-icon",children:"\ud83d\udd11"}),r("auth.signInWithPAT")]})})]}),u&&(0,o.jsx)("div",{className:"error-message",children:u})]})})}},53155:(e,a,s)=>{s.d(a,{A:()=>o});var n=s(9950),i=s(85571),t=s(44414);const o=e=>{let{isOpen:a,onClose:s,samlInfo:o}=e;const r=i.A.getLogger("SAMLAuthModal");if((0,n.useEffect)(()=>(a&&o&&r.componentMount({organization:o.organization,repository:o.repository}),()=>{a&&r.componentUnmount()}),[r,a,o]),!a||!o)return null;const{organization:l,repository:c,authorizationUrl:d}=o,h=()=>{r.userAction("SAML modal closed",{organization:l}),s()};return(0,t.jsx)("div",{className:"saml-modal-overlay",onClick:h,role:"dialog","aria-modal":"true","aria-labelledby":"saml-modal-title",children:(0,t.jsxs)("div",{className:"saml-modal",onClick:e=>e.stopPropagation(),role:"document",children:[(0,t.jsxs)("div",{className:"saml-modal-header",children:[(0,t.jsx)("h2",{id:"saml-modal-title",children:"\ud83d\udd10 SAML SSO Authorization Required"}),(0,t.jsx)("button",{onClick:h,className:"close-button","aria-label":"Close",children:"\xd7"})]}),(0,t.jsxs)("div",{className:"saml-modal-content",children:[(0,t.jsxs)("div",{className:"saml-info-section",children:[(0,t.jsx)("div",{className:"saml-icon",children:(0,t.jsx)("span",{role:"img","aria-label":"lock",children:"\ud83d\udd12"})}),(0,t.jsx)("h3",{children:"Organization Access Required"}),(0,t.jsxs)("p",{className:"saml-description",children:["Your Personal Access Token needs SAML SSO authorization to access the"," ",(0,t.jsx)("strong",{children:l})," organization",c?" and the ".concat(c," repository"):"","."]})]}),(0,t.jsxs)("div",{className:"saml-steps-section",children:[(0,t.jsx)("h4",{children:"How to authorize your token:"}),(0,t.jsxs)("ol",{className:"saml-steps",children:[(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:'Click "Authorize on GitHub"'})," below to open the authorization page"]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Review the permissions"})," requested by the organization"]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:'Click "Authorize"'})," to grant your token access"]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Return to this page"})," and refresh or try your action again"]})]})]}),(0,t.jsxs)("div",{className:"saml-note",children:[(0,t.jsx)("span",{className:"note-icon",children:"\u2139\ufe0f"}),(0,t.jsx)("p",{children:"This is a GitHub security feature for organizations using SAML SSO. You only need to authorize once per organization per token."})]}),(0,t.jsxs)("div",{className:"saml-modal-actions",children:[(0,t.jsx)("button",{onClick:()=>{r.userAction("Authorize SAML clicked",{organization:l,authorizationUrl:d}),window.open(d,"_blank","noopener,noreferrer"),r.info("SAML authorization page opened",{organization:l,instruction:"User should authorize their PAT on GitHub and then refresh"})},className:"saml-authorize-btn",children:"\ud83d\udd13 Authorize on GitHub"}),(0,t.jsx)("button",{onClick:h,className:"saml-cancel-btn",children:"Later"})]})]})]})})}}}]);