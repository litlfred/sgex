"use strict";(self.webpackChunksgex_workbench=self.webpackChunksgex_workbench||[]).push([[4270],{57323:(e,n,s)=>{s.r(n),s.d(n,{default:()=>p});var a=s(89379),i=s(9950),t=s(85001),c=s(29946),l=s(51635),o=s(85606),r=s(67802),d=s(57561),h=s(44414);const m=()=>{const e=(0,t.Zp)(),{profile:n,repository:s,branch:m}=(0,l.oc)(),[p,u]=(0,i.useState)(!0),[x,j]=(0,i.useState)(null),[f,v]=(0,i.useState)([]),[N,b]=(0,i.useState)([]),[g,y]=(0,i.useState)(null),[w,C]=(0,i.useState)(null),[L,k]=(0,i.useState)("indicators");(0,i.useEffect)(()=>{const e=async()=>{try{var e;const n=(null===(e=s.owner)||void 0===e?void 0:e.login)||s.full_name.split("/")[0],a=s.name,i=(await c.A.getDirectoryContents(n,a,"input/cql",m)).filter(e=>e.name.endsWith(".cql")&&"file"===e.type),t=await Promise.all(i.map(async e=>{try{const s=await c.A.getFileContent(n,a,e.path,m),i=s.match(/context\s+(\w+)/i),t=i?i[1]:"Patient";return"Population"===t?{name:e.name,path:e.path,size:e.size,sha:e.sha,downloadUrl:e.download_url,githubUrl:"https://github.com/".concat(n,"/").concat(a,"/blob/").concat(m,"/").concat(e.path),content:s,context:t}:null}catch(x){return console.warn("Failed to load content for ".concat(e.name,":"),x),null}}));v(t.filter(e=>null!==e))}catch(x){console.warn("No Population context CQL files found:",x),v([])}},n=async()=>{try{var e;const n=(null===(e=s.owner)||void 0===e?void 0:e.login)||s.full_name.split("/")[0],i=s.name,t=["input/fsh/measures","input/fsh/indicators","input/resources/measures"],l=[];for(const e of t)try{const s=(await c.A.getDirectoryContents(n,i,e,m)).filter(e=>(e.name.endsWith(".fsh")||e.name.endsWith(".json"))&&"file"===e.type);for(const e of s)try{const s=await c.A.getFileContent(n,i,e.path,m),t=P(e.name,s);t&&l.push((0,a.A)((0,a.A)({},t),{},{file:e.name,path:e.path,githubUrl:"https://github.com/".concat(n,"/").concat(i,"/blob/").concat(m,"/").concat(e.path)}))}catch(x){console.warn("Failed to load indicator file ".concat(e.name,":"),x)}}catch(x){continue}b(l)}catch(x){console.warn("No indicator definitions found:",x),b([])}},i=async()=>{try{var e;const n=(null===(e=s.owner)||void 0===e?void 0:e.login)||s.full_name.split("/")[0],a=s.name,i=await c.A.getFileContent(n,a,"input/fsh/codesystems/DAK.fsh",m),t=F(i);C(t),r.A.loadDataDictionary(t)}catch(x){console.warn("Data dictionary not found:",x),C(null)}};(async()=>{if(s&&m)try{u(!0),await e(),await n(),await i()}catch(a){console.error("Error loading program indicators data:",a),j("Failed to load program indicators data.")}finally{u(!1)}})()},[s,m]);const P=(e,n)=>{try{return e.endsWith(".fsh")?q(n):e.endsWith(".json")?Q(n):null}catch(x){return console.warn("Failed to parse indicator ".concat(e,":"),x),null}},q=e=>{const n=e.split("\n");let s={};for(const a of n){const e=a.trim(),n=e.match(/^\* title = "([^"]+)"/);n&&(s.title=n[1]);const i=e.match(/^\* description = "([^"]+)"/);i&&(s.description=i[1]);const t=e.match(/^\* library = "([^"]+)"/);t&&(s.library=t[1])}return Object.keys(s).length>0?s:null},Q=e=>{try{var n,s,a;const i=JSON.parse(e);return{title:i.title||i.name,description:i.description,library:null===(n=i.library)||void 0===n||null===(s=n[0])||void 0===s?void 0:s.reference,status:i.status,type:null===(a=i.type)||void 0===a?void 0:a.map(e=>{var n,s;return null===(n=e.coding)||void 0===n||null===(s=n[0])||void 0===s?void 0:s.display}).join(", ")}}catch(x){return null}},F=e=>{const n=[],s=e.split("\n");for(const a of s){const e=a.trim().match(/^\* #([^\s]+)\s+"([^"]+)"/);e&&n.push({Code:e[1],Display:e[2]})}return{concepts:n}};return p?(0,h.jsx)("div",{className:"program-indicators-view loading-state",children:(0,h.jsxs)("div",{className:"loading-content",children:[(0,h.jsx)("h2",{children:"Loading Program Indicators..."}),(0,h.jsx)("p",{children:"Fetching indicator definitions and CQL files..."})]})}):x?(0,h.jsx)("div",{className:"program-indicators-view error-state",children:(0,h.jsxs)("div",{className:"error-content",children:[(0,h.jsx)("h2",{children:"Error Loading Program Indicators"}),(0,h.jsx)("p",{children:x}),(0,h.jsxs)("div",{className:"error-actions",children:[(0,h.jsx)("button",{onClick:()=>e("/"),className:"action-btn primary",children:"Return to Home"}),(0,h.jsx)("button",{onClick:()=>window.location.reload(),className:"action-btn secondary",children:"Retry"})]})]})}):(0,h.jsx)("div",{className:"program-indicators-view",children:(0,h.jsxs)("div",{className:"view-content",children:[(0,h.jsxs)("div",{className:"view-main",children:[(0,h.jsxs)("div",{className:"view-intro",children:[(0,h.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"1rem",marginBottom:"1rem"},children:[(0,h.jsx)("h2",{children:"\ud83d\udcca Program Indicators"}),(0,h.jsxs)("div",{className:"artifact-badges",children:[(0,h.jsx)("span",{className:"artifact-badge indicators",children:"\ud83d\udcc8 Indicators"}),(0,h.jsx)("span",{className:"dak-component-badge",children:"\ud83d\udcca Population Measures"})]})]}),(0,h.jsxs)("p",{children:["Manage program indicators and population-level measures for",s?" ".concat(s.name):" this DAK",". Create and edit CQL with Population context for calculating program performance metrics."]})]}),(0,h.jsxs)("div",{className:"section-tabs",children:[(0,h.jsxs)("button",{className:"tab-button ".concat("indicators"===L?"active":""),onClick:()=>k("indicators"),children:[(0,h.jsx)("span",{className:"tab-icon",children:"\ud83d\udcc8"}),(0,h.jsx)("span",{className:"tab-text",children:"Indicator Definitions"}),N.length>0&&(0,h.jsx)("span",{className:"tab-badge",children:N.length})]}),(0,h.jsxs)("button",{className:"tab-button ".concat("cql"===L?"active":""),onClick:()=>k("cql"),children:[(0,h.jsx)("span",{className:"tab-icon",children:"\ud83d\udcdc"}),(0,h.jsx)("span",{className:"tab-text",children:"Population CQL"}),f.length>0&&(0,h.jsx)("span",{className:"tab-badge",children:f.length})]})]}),"indicators"===L&&(0,h.jsxs)("div",{className:"components-section indicators-section active",children:[(0,h.jsxs)("div",{className:"section-header",children:[(0,h.jsx)("h3",{className:"section-title",children:"\ud83d\udcc8 Indicator Definitions"}),(0,h.jsx)("p",{className:"section-description",children:"FHIR Measure resources and indicator definitions for program monitoring"})]}),(0,h.jsxs)("div",{className:"indicators-grid",children:[N.map((e,n)=>(0,h.jsxs)("div",{className:"indicator-card",children:[(0,h.jsxs)("div",{className:"indicator-header",children:[(0,h.jsx)("h4",{children:e.title||e.file}),(0,h.jsxs)("div",{className:"indicator-meta",children:[(0,h.jsx)("span",{className:"indicator-type",children:e.type||"Measure"}),(0,h.jsx)("span",{className:"indicator-status",children:e.status||"draft"})]})]}),e.description&&(0,h.jsx)("div",{className:"indicator-description",children:e.description}),e.library&&(0,h.jsxs)("div",{className:"indicator-library",children:[(0,h.jsx)("strong",{children:"Library:"})," ",e.library]}),(0,h.jsx)("div",{className:"indicator-actions",children:(0,h.jsx)("a",{href:e.githubUrl,target:"_blank",rel:"noopener noreferrer",className:"action-btn secondary",title:"View on GitHub",children:"\ud83d\udd17 GitHub"})})]},n)),0===N.length&&(0,h.jsxs)("div",{className:"no-indicators",children:[(0,h.jsx)("p",{children:"No indicator definitions found."}),(0,h.jsx)("p",{children:"Indicators should be defined in input/fsh/measures/ or input/resources/measures/"})]})]})]}),"cql"===L&&(0,h.jsxs)("div",{className:"components-section population-cql-section active",children:[(0,h.jsxs)("div",{className:"section-header",children:[(0,h.jsx)("h3",{className:"section-title",children:"\ud83d\udcdc Population CQL Files"}),(0,h.jsx)("p",{className:"section-description",children:"CQL files with Population context for indicator calculations and population measures"})]}),g?(0,h.jsxs)("div",{className:"cql-editor-container",children:[(0,h.jsxs)("div",{className:"cql-editor-header",children:[(0,h.jsx)("button",{onClick:()=>y(null),className:"back-btn",children:"\u2190 Back to CQL Files"}),(0,h.jsx)("h4",{children:g.name}),(0,h.jsx)("span",{className:"context-badge population",children:"Population Context"})]}),(0,h.jsx)(o.A,{file:g,content:g.content,repository:s,branch:m,dataDictionary:w,onLibraryClick:e=>(e=>{const n=f.find(n=>{const s=n.name.replace(".cql","");return s===e||s.toLowerCase().includes(e.toLowerCase())||n.content.includes("library ".concat(e))});n?(y(n),alert("Navigating to library: ".concat(e))):alert('Library "'.concat(e,'" not found in current CQL files. You may need to check external dependencies or ensure the file is in the input/cql directory.'))})(e),onSave:(e,n)=>{"staging"===n&&(d.A.updateFile(g.path,e,{tool:"Population CQL Editor",type:"cql",context:"Population"}),alert("Population CQL file saved to staging ground"))}})]}):(0,h.jsx)("div",{className:"cql-files-grid",children:(0,h.jsxs)("div",{className:"cql-files-list",children:[f.map((e,n)=>(0,h.jsxs)("div",{className:"cql-file-card population-context",children:[(0,h.jsxs)("div",{className:"file-header",children:[(0,h.jsx)("h5",{children:e.name}),(0,h.jsxs)("div",{className:"file-meta",children:[(0,h.jsxs)("span",{className:"file-size",children:[Math.round(e.size/1024),"KB"]}),(0,h.jsx)("span",{className:"file-context population",children:e.context})]})]}),(0,h.jsx)("div",{className:"file-preview",children:(0,h.jsxs)("code",{children:[e.content.substring(0,200),"..."]})}),(0,h.jsxs)("div",{className:"file-actions",children:[(0,h.jsx)("button",{onClick:()=>y(e),className:"action-btn primary",title:"Edit Population CQL file",children:"\ud83d\udcdd Edit"}),(0,h.jsx)("a",{href:e.githubUrl,target:"_blank",rel:"noopener noreferrer",className:"action-btn secondary",title:"View on GitHub",children:"\ud83d\udd17 GitHub"})]})]},n)),0===f.length&&(0,h.jsxs)("div",{className:"no-files",children:[(0,h.jsx)("p",{children:"No Population context CQL files found."}),(0,h.jsx)("p",{children:'Create CQL files with "context Population" in the input/cql/ directory for indicator calculations.'})]})]})})]})]}),(0,h.jsx)("div",{className:"diagram-info",children:(0,h.jsxs)("div",{className:"condensed-file-info",children:[(0,h.jsxs)("div",{className:"condensed-info-item",children:[(0,h.jsx)("span",{className:"label",children:"\ud83d\udcca"}),(0,h.jsx)("span",{className:"value",children:"Program Indicators"})]}),(0,h.jsxs)("div",{className:"condensed-info-item",children:[(0,h.jsx)("span",{className:"label",children:"\ud83d\udcc1"}),(0,h.jsx)("span",{className:"value",children:(null===s||void 0===s?void 0:s.name)||"Repository"})]}),(0,h.jsxs)("div",{className:"condensed-info-item",children:[(0,h.jsx)("span",{className:"label",children:"\ud83c\udf3f"}),(0,h.jsx)("span",{className:"value",children:m||"main"})]}),(0,h.jsxs)("div",{className:"condensed-info-item",children:[(0,h.jsx)("span",{className:"label",children:"\ud83d\udcc8"}),(0,h.jsxs)("span",{className:"value",children:[N.length," Indicators"]})]}),(0,h.jsxs)("div",{className:"condensed-info-item",children:[(0,h.jsx)("span",{className:"label",children:"\ud83d\udcdc"}),(0,h.jsxs)("span",{className:"value",children:[f.length," CQL Files"]})]})]})})]})})},p=()=>(0,h.jsx)(l.Mx,{pageName:"program-indicators",children:(0,h.jsx)(m,{})})}}]);