"use strict";(self.webpackChunksgex_workbench=self.webpackChunksgex_workbench||[]).push([[5773],{25773:(e,a,s)=>{s.r(a),s.d(a,{default:()=>h});var n=s(89379),i=s(65043),t=s(73537),o=s(50404),l=s(65240),r=s(74155),c=s(62148),d=s(70579);const h=()=>{const[e,a]=(0,i.useState)(null),[s,h]=(0,i.useState)([]),[u,g]=(0,i.useState)(!1),[m,x]=(0,i.useState)(!1),[p,v]=(0,i.useState)(null),[j,N]=(0,i.useState)({}),[f,b]=(0,i.useState)(null),k=(0,t.Zp)(),A=(0,t.zy)(),w=(0,i.useCallback)((e,a)=>{if(!o.A.isAuth())return;const s={};if(e){const a=l.A.getCachedRepositories(e.login,"user");a&&a.repositories&&(s["user-".concat(e.login)]=a.repositories.length)}a.forEach(e=>{const a=l.A.getCachedRepositories(e.login,"org");a&&a.repositories&&(s["org-".concat(e.login)]=a.repositories.length)}),N(s)},[]),S=(0,i.useCallback)(async()=>{x(!0),v(null);try{await o.A.checkTokenPermissions();const s=await o.A.getCurrentUser();a(s);let i=[];if(o.A.isAuth())try{i=await o.A.getUserOrganizations()}catch(p){console.error("Error fetching organizations:",p),i=[]}try{const e=await o.A.getWHOOrganization(),a=i.findIndex(e=>"WorldHealthOrganization"===e.login);a>=0?i[a]=(0,n.A)((0,n.A)((0,n.A)({},i[a]),e),{},{isWHO:!0}):i.unshift(e)}catch(e){console.warn("Could not fetch WHO organization data, using fallback:",e);const a={id:"who-organization",login:"WorldHealthOrganization",name:"World Health Organization",description:"The World Health Organization is a specialized agency of the United Nations responsible for international public health.",avatar_url:"https://avatars.githubusercontent.com/u/12261302?s=200&v=4",html_url:"https://github.com/WorldHealthOrganization",type:"Organization",isWHO:!0};i.some(e=>"WorldHealthOrganization"===e.login)?i=i.map(e=>"WorldHealthOrganization"===e.login?(0,n.A)((0,n.A)({},e),{},{isWHO:!0}):e):i.unshift(a)}h(i),w(s,i)}catch(p){console.error("Error fetching user data:",p),v("Failed to fetch user data. Please check your connection and try again."),g(!1),sessionStorage.removeItem("github_token"),localStorage.removeItem("github_token")}finally{x(!1)}},[w]);(0,i.useEffect)(()=>{(()=>{const e=sessionStorage.getItem("github_token")||localStorage.getItem("github_token");if(e){o.A.authenticate(e)?g(!0):(sessionStorage.removeItem("github_token"),localStorage.removeItem("github_token"))}})()},[]),(0,i.useEffect)(()=>{var e;null!==(e=A.state)&&void 0!==e&&e.warningMessage&&(b(A.state.warningMessage),k(A.pathname,{replace:!0,state:{}}))},[A.state,k,A.pathname]),(0,i.useEffect)(()=>{u&&!e&&S()},[u,e,S]);const y=(e,a)=>{sessionStorage.setItem("github_token",e),o.A.authenticateWithOctokit(a),g(!0),v(null),S()},O=e=>{k("/dak-action/".concat(e.login),{state:{profile:e}})},W=()=>{const e={login:"demo-user",name:"Demo User",avatar_url:"https://github.com/github.png",type:"User",isDemo:!0};k("/dak-selection/".concat(e.login),{state:{profile:e,action:"edit"}})},T=()=>{b(null)};return u?(0,d.jsx)(c.Mx,{pageName:"landing",showHeader:!1,children:(0,d.jsxs)("div",{className:"landing-page",children:[(0,d.jsxs)("div",{className:"landing-header",children:[(0,d.jsxs)("div",{className:"who-branding",children:[(0,d.jsx)("h1",{className:"clickable-title",children:"SGEX Workbench"}),(0,d.jsx)("p",{className:"subtitle",children:"WHO SMART Guidelines Exchange"})]}),(0,d.jsxs)("div",{className:"user-info",children:[(0,d.jsx)("img",{src:null===e||void 0===e?void 0:e.avatar_url,alt:"User avatar",className:"user-avatar"}),(0,d.jsx)("span",{children:(null===e||void 0===e?void 0:e.name)||(null===e||void 0===e?void 0:e.login)}),(0,d.jsx)("a",{href:"/sgex/docs/overview",className:"nav-link",children:"\ud83d\udcd6 Documentation"}),(0,d.jsx)("button",{onClick:()=>{o.A.logout(),g(!1),a(null),h([]),v(null)},className:"logout-btn",children:"Logout"})]})]}),(0,d.jsxs)("div",{className:"landing-content",children:[f&&(0,d.jsx)("div",{className:"warning-message",children:(0,d.jsxs)("div",{className:"warning-content",children:[(0,d.jsx)("span",{className:"warning-icon",children:"\u26a0\ufe0f"}),(0,d.jsx)("span",{className:"warning-text",children:f}),(0,d.jsx)("button",{className:"warning-dismiss",onClick:T,"aria-label":"Dismiss warning",children:"\xd7"})]})}),m?(0,d.jsxs)("div",{className:"loading-section",children:[(0,d.jsx)("div",{className:"spinner"}),(0,d.jsx)("p",{children:"Loading profile data..."})]}):(0,d.jsxs)("div",{className:"profile-selection",children:[(0,d.jsx)("h2",{children:"Select Profile or Organization"}),(0,d.jsx)("p",{children:"Choose the GitHub profile or organization containing your DAK repositories:"}),p&&(0,d.jsx)("div",{className:"error-message",children:p}),(0,d.jsxs)("div",{className:"profile-grid",children:[(0,d.jsxs)("div",{className:"profile-card",onClick:()=>O((0,n.A)({type:"user"},e)),children:[(0,d.jsxs)("div",{className:"profile-card-header",children:[(0,d.jsx)("img",{src:null===e||void 0===e?void 0:e.avatar_url,alt:"Personal profile"}),j["user-".concat(null===e||void 0===e?void 0:e.login)]>0&&(0,d.jsx)("div",{className:"dak-count-badge",children:j["user-".concat(null===e||void 0===e?void 0:e.login)]})]}),(0,d.jsx)("h3",{children:(null===e||void 0===e?void 0:e.name)||(null===e||void 0===e?void 0:e.login)}),(0,d.jsx)("p",{children:"Personal repositories"}),(0,d.jsx)("div",{className:"profile-badges",children:(0,d.jsx)("span",{className:"profile-type",children:"Personal"})})]}),s.map(e=>(0,d.jsxs)("div",{className:"profile-card ".concat(e.isWHO?"who-org":""),onClick:()=>O((0,n.A)({type:"org"},e)),children:[(0,d.jsxs)("div",{className:"profile-card-header",children:[(0,d.jsx)("img",{src:e.avatar_url||"https://github.com/".concat(e.login,".png"),alt:"".concat(e.name||e.login," organization")}),j["org-".concat(e.login)]>0&&(0,d.jsx)("div",{className:"dak-count-badge",children:j["org-".concat(e.login)]})]}),(0,d.jsx)("h3",{children:e.name||e.login}),(0,d.jsxs)("p",{children:["@",e.login]}),(0,d.jsxs)("div",{className:"profile-badges",children:[(0,d.jsx)("span",{className:"profile-type",children:"Organization"}),e.isWHO&&(0,d.jsx)("span",{className:"who-badge",children:"WHO Official"})]})]},e.login))]})]})]})]})}):(0,d.jsx)(c.Mx,{pageName:"landing",showHeader:!1,children:(0,d.jsxs)("div",{className:"landing-page",children:[(0,d.jsxs)("div",{className:"landing-header",children:[(0,d.jsxs)("div",{className:"who-branding",children:[(0,d.jsx)("h1",{className:"clickable-title",children:"SGEX Workbench"}),(0,d.jsx)("p",{className:"subtitle",children:"WHO SMART Guidelines Exchange"})]}),(0,d.jsx)("div",{className:"header-nav",children:(0,d.jsx)("a",{href:"/sgex/docs/overview",className:"nav-link",children:"\ud83d\udcd6 Documentation"})})]}),(0,d.jsxs)("div",{className:"landing-content",children:[f&&(0,d.jsx)("div",{className:"warning-message",children:(0,d.jsxs)("div",{className:"warning-content",children:[(0,d.jsx)("span",{className:"warning-icon",children:"\u26a0\ufe0f"}),(0,d.jsx)("span",{className:"warning-text",children:f}),(0,d.jsx)("button",{className:"warning-dismiss",onClick:T,"aria-label":"Dismiss warning",children:"\xd7"})]})}),(0,d.jsxs)("div",{className:"welcome-section",children:[(0,d.jsx)("h2",{children:"Welcome to SGEX Workbench"}),(0,d.jsx)("p",{children:"A browser-based, standards-compliant collaborative editor for WHO SMART Guidelines Digital Adaptation Kits (DAKs)."}),(0,d.jsxs)("div",{className:"auth-section",children:[(0,d.jsx)("p",{children:"Connect your GitHub account to get started:"}),(0,d.jsx)(r.A,{onAuthSuccess:y}),p&&(0,d.jsx)("div",{className:"error-message",children:p})]}),(0,d.jsxs)("div",{className:"demo-section",children:[(0,d.jsx)("p",{children:"Want to try without authentication?"}),(0,d.jsx)("button",{onClick:W,className:"demo-mode-btn",children:"\ud83c\udfad Try Demo Mode"}),(0,d.jsx)("p",{className:"demo-note",children:"Demo mode showcases the enhanced DAK scanning display with mock data."})]}),(0,d.jsx)("div",{className:"info-section",children:(0,d.jsxs)("p",{children:["Need help getting started? Check out our comprehensive"," ",(0,d.jsx)("a",{href:"/sgex/docs/overview",className:"doc-link",children:"documentation"})," ","to learn more about SGEX Workbench and DAK components."]})})]})]})]})})}},74155:(e,a,s)=>{s.d(a,{A:()=>l});var n=s(65043),i=s(74117),t=s(5452),o=s(70579);const l=e=>{let{onAuthSuccess:a}=e;const{t:l}=(0,i.Bd)(),[r,c]=(0,n.useState)(""),[d,h]=(0,n.useState)(""),[u,g]=(0,n.useState)(""),[m,x]=(0,n.useState)(!1),p=t.A.getLogger("PATLogin");n.useEffect(()=>(p.componentMount({hasOnAuthSuccess:!!a}),()=>p.componentUnmount()),[p,a]);return(0,o.jsx)("div",{className:"pat-login",children:(0,o.jsxs)("div",{className:"pat-login-section",children:[(0,o.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),p.userAction("PAT login attempt",{tokenProvided:!!r.trim()}),!r.trim()){return g("Please enter a GitHub Personal Access Token"),void p.warn("PAT login failed - no token provided")}x(!0),g("");const n=Date.now();p.auth("Starting PAT authentication");try{const{Octokit:e}=await s.e(7036).then(s.bind(s,97036)),i=new e({auth:r.trim()});p.debug("Octokit instance created for PAT validation"),p.apiCall("GET","/user",null);const t=await i.rest.users.getAuthenticated(),o=Date.now()-n;p.apiResponse("GET","/user",t.status,o),p.auth("PAT authentication successful",{username:t.data.login,duration:o}),a(r.trim(),i)}catch(i){const e=Date.now()-n;p.apiError("GET","/user",i),p.auth("PAT authentication failed",{status:i.status,message:i.message,duration:e}),console.error("PAT authentication failed:",i),401===i.status?g("Invalid Personal Access Token. Please check your token and try again."):403===i.status?g("Token doesn't have sufficient permissions. Please ensure your token has 'repo' and 'read:org' scopes."):g("Authentication failed. Please check your connection and try again.")}finally{x(!1)}},className:"pat-form",children:[(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{htmlFor:"token-name",children:"Token Name (optional):"}),(0,o.jsx)("input",{id:"token-name",type:"text",value:d,onChange:e=>{h(e.target.value),u&&g("")},placeholder:"e.g., SGEX Access Token",className:"token-name-input",disabled:m,autoComplete:"username"})]}),(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsxs)("label",{htmlFor:"pat-token",children:[l("auth.setupToken"),":"]}),(0,o.jsx)("input",{id:"pat-token",type:"password",value:r,onChange:e=>{c(e.target.value),u&&g("")},placeholder:"ghp_xxxxxxxxxxxxxxxxxxxx",className:"token-input ".concat(u?"error":""),disabled:m,autoComplete:"current-password"})]}),(0,o.jsx)("button",{type:"submit",className:"github-login-btn",disabled:m||!r.trim(),children:m?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("span",{className:"spinner small"}),l("common.loading"),"..."]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("span",{className:"github-icon",children:"\ud83d\udd11"}),l("auth.signInWithPAT")]})})]}),u&&(0,o.jsx)("div",{className:"error-message",children:u})]})})}}}]);
//# sourceMappingURL=5773.2389915c.chunk.js.map