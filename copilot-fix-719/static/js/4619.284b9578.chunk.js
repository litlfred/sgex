"use strict";(self.webpackChunksgex_workbench=self.webpackChunksgex_workbench||[]).push([[4619],{4619:(e,t,s)=>{s.d(t,{A:()=>l});var r=s(89379),a=s(9950),n=s(67818),i=s(87018),o=s(7082),c=s(44414);const l=e=>{let{questionId:t,parameters:s={},githubService:l=null,assetFiles:u=[],showRawData:d=!1,className:h=""}=e;const{t:p,i18n:m}=(0,n.Bd)(),[g,f]=(0,a.useState)(null),[y,w]=(0,a.useState)(!1),[b,v]=(0,a.useState)(null),x=(0,a.useCallback)(async()=>{if(t&&l){w(!0),v(null);try{const e={questionId:t,parameters:(0,r.A)((0,r.A)({},s),{},{locale:m.language.replace("-","_")||"en_US"}),assetFiles:u},a={githubService:l},n=await i.A.executeQuestion(e,a);f(n)}catch(e){v(e.message)}finally{w(!1)}}},[t,s,l,u,m.language]);(0,a.useEffect)(()=>{x()},[x]);return y?(0,c.jsxs)("div",{className:"faq-answer loading ".concat(h),children:[(0,c.jsx)("div",{className:"faq-loading-spinner"}),(0,c.jsx)("p",{children:p("dak.faq.loading")})]}):b?(0,c.jsxs)("div",{className:"faq-answer error ".concat(h),children:[(0,c.jsx)("h4",{children:p("dak.faq.error_title")}),(0,c.jsx)("p",{className:"faq-error-message",children:b}),(0,c.jsx)("button",{onClick:x,className:"faq-retry-button",children:p("dak.faq.retry")})]}):g?(0,c.jsxs)("div",{className:"faq-answer success ".concat(h),children:[(()=>{return null!==g&&void 0!==g&&g.narrative?(0,c.jsx)("div",{className:"faq-narrative",dangerouslySetInnerHTML:{__html:(e=g.narrative,o.default.sanitize(e,{ALLOWED_TAGS:["h1","h2","h3","h4","h5","h6","p","div","span","ul","ol","li","strong","em","code","pre","time","small"],ALLOWED_ATTR:["class","datetime"]}))}}):null;var e})(),(()=>{const e=(null===g||void 0===g?void 0:g.warnings)||[],t=(null===g||void 0===g?void 0:g.errors)||[];return 0===e.length&&0===t.length?null:(0,c.jsxs)("div",{className:"faq-messages",children:[t.map((e,t)=>(0,c.jsxs)("div",{className:"faq-message faq-error",children:[(0,c.jsx)("span",{className:"faq-message-icon",children:"\u26a0\ufe0f"}),e]},"error-".concat(t))),e.map((e,t)=>(0,c.jsxs)("div",{className:"faq-message faq-warning",children:[(0,c.jsx)("span",{className:"faq-message-icon",children:"\u26a0\ufe0f"}),e]},"warning-".concat(t)))]})})(),d&&null!==g&&void 0!==g&&g.structured?(0,c.jsxs)("details",{className:"faq-structured-data",children:[(0,c.jsx)("summary",{children:p("dak.faq.structured_data")}),(0,c.jsx)("pre",{children:JSON.stringify(g.structured,null,2)})]}):null,d&&null!==g&&void 0!==g&&g.meta?(0,c.jsxs)("details",{className:"faq-metadata",children:[(0,c.jsx)("summary",{children:p("dak.faq.metadata")}),(0,c.jsx)("pre",{children:JSON.stringify(g.meta,null,2)})]}):null]}):(0,c.jsx)("div",{className:"faq-answer empty ".concat(h),children:(0,c.jsx)("p",{children:p("dak.faq.no_data")})})}},49162:(e,t,s)=>{s.d(t,{Q5:()=>a,hI:()=>n,kv:()=>c,q_:()=>i,uC:()=>o,x:()=>r});const r={DAK:"dak",COMPONENT:"component",ASSET:"asset"};class a{constructor(e){let{id:t,level:s,title:r,description:a,parameters:n=[],tags:i=[],version:o="1.0.0",isTemplate:c=!1,componentTypes:l=[],assetTypes:u=[]}=e;this.id=t,this.level=s,this.title=r,this.description=a,this.parameters=n,this.tags=i,this.version=o,this.isTemplate=c,this.componentTypes=l,this.assetTypes=u}}class n{constructor(e){let{name:t,type:s="string",required:r=!1,description:a="",defaultValue:n=null,validation:i={}}=e;this.name=t,this.type=s,this.required=r,this.description=a,this.defaultValue=n,this.validation=i}}class i{constructor(e){let{repository:t,locale:s="en_US",branch:r="main",user:a=null,assetFile:n=null,componentType:i=null,storage:o=null}=e;this.repository=t,this.locale=s,this.branch=r,this.user=a,this.assetFile=n,this.componentType=i,this.storage=o}}class o{constructor(e){let{structured:t={},narrative:s="",warnings:r=[],errors:a=[],meta:n={}}=e;this.structured=t,this.narrative=s,this.warnings=r,this.errors=a,this.meta=n}}class c{constructor(e){let{scope:t="repository",key:s="",ttl:r=3600,dependencies:a=[]}=e;this.scope=t,this.key=s,this.ttl=r,this.dependencies=a}}},87018:(e,t,s)=>{s.d(t,{A:()=>u});var r=s(89379),a=s(49162),n=s(16558);const i=new class{constructor(){this.registry=null,this.loaded=!1}loadFromYaml(e){try{this.registry=n.default.load(e),this.loaded=!0}catch(t){throw new Error("Failed to parse parameter registry YAML: ".concat(t.message))}}getParameters(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!this.loaded||!this.registry)throw new Error("Parameter registry not loaded");const s=[];if(this.registry.defaults)for(const[r,i]of Object.entries(this.registry.defaults))s.push(new a.hI({name:r,type:i.type,required:i.required||!1,description:i.description||"",defaultValue:i.default||null,validation:i.validation||{}}));if(this.registry[e])if(t&&this.registry[e][t])for(const[i,o]of Object.entries(this.registry[e][t]))s.push(new a.hI((0,r.A)({name:i},o)));else if(!t)for(const[i,o]of Object.entries(this.registry[e]))"object"===typeof o&&o.type&&s.push(new a.hI((0,r.A)({name:i},o)));const n=new Map;return s.forEach(e=>{n.set(e.name,e)}),Array.from(n.values())}validateParameters(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=this.getParameters(t,s),a={},n=[];for(const i of r){const t=e[i.name];if(i.required&&(void 0===t||null===t)){n.push("Required parameter '".concat(i.name,"' is missing"));continue}const s=void 0!==t?t:i.defaultValue;if(null!==s&&void 0!==s){const e=this.validateParameterType(s,i);if(e){n.push("Parameter '".concat(i.name,"': ").concat(e));continue}const t=this.validateParameterCustom(s,i);if(t){n.push("Parameter '".concat(i.name,"': ").concat(t));continue}}a[i.name]=s}for(const i of Object.keys(e))r.find(e=>e.name===i)||n.push("Unknown parameter '".concat(i,"'"));return{normalized:a,errors:n,isValid:0===n.length}}validateParameterType(e,t){const s=t.type,r=typeof e;switch(s){case"string":if("string"!==r)return"Expected string, got ".concat(r);break;case"boolean":if("boolean"!==r)return"Expected boolean, got ".concat(r);break;case"number":if("number"!==r||isNaN(e))return"Expected number, got ".concat(r);break;case"array":if(!Array.isArray(e))return"Expected array, got ".concat(r);break;case"object":if("object"!==r||Array.isArray(e))return"Expected object, got ".concat(r);break;default:return"Unknown type: ".concat(s)}return null}validateParameterCustom(e,t){if(!t.validation)return null;const s=t.validation;if(s.pattern&&"string"===typeof e){if(!new RegExp(s.pattern).test(e))return"Value does not match pattern ".concat(s.pattern)}return s.enum&&Array.isArray(s.enum)&&!s.enum.includes(e)?"Value must be one of: ".concat(s.enum.join(", ")):void 0!==s.minLength&&"string"===typeof e&&e.length<s.minLength?"String must be at least ".concat(s.minLength," characters"):void 0!==s.maxLength&&"string"===typeof e&&e.length>s.maxLength?"String must be at most ".concat(s.maxLength," characters"):void 0!==s.min&&"number"===typeof e&&e<s.min?"Number must be at least ".concat(s.min):void 0!==s.max&&"number"===typeof e&&e>s.max?"Number must be at most ".concat(s.max):null}getParameterSchema(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const s=this.getParameters(e,t),r={},a=[];for(const n of s){const e={type:n.type,description:n.description};null!==n.defaultValue&&(e.default=n.defaultValue),n.validation&&Object.assign(e,n.validation),r[n.name]=e,n.required&&a.push(n.name)}return{type:"object",properties:r,required:a}}};i.loadFromYaml('\ndefaults:\n  repository:\n    type: string\n    required: true\n    description: "Repository context (always required)"\n  locale:\n    type: string\n    required: false\n    default: "en_US"\n    description: "Locale for responses"\n  branch:\n    type: string\n    required: false\n    default: "main"\n    description: "Git branch context"\n\ndak:\n\ncomponent:\n  businessProcess:\n    componentType:\n      type: string\n      required: true\n      default: "businessProcess"\n      description: "Type of component being analyzed"\n\nasset:\n  lesson:\n    assetFile:\n      type: string\n      required: true\n      description: "Relative path to the lesson file"\n');const o=i;class c{async readFile(e){throw new Error("readFile must be implemented by subclass")}async fileExists(e){throw new Error("fileExists must be implemented by subclass")}async listFiles(e){throw new Error("listFiles must be implemented by subclass")}async getFileInfo(e){throw new Error("getFileInfo must be implemented by subclass")}}class l extends c{constructor(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"main";super(),this.githubService=e,this.repository=t,this.branch=s,this.cache=new Map}parseRepository(e){if("string"===typeof e){if(e.includes("github.com")){const t=e.match(/github\.com\/([^/]+)\/([^/?#]+)/);if(t)return{owner:t[1],repo:t[2].replace(/\.git$/,"")}}const t=e.split("/");if(2===t.length)return{owner:t[0],repo:t[1]}}throw new Error("Invalid repository format: ".concat(e))}async readFile(e){const t="".concat(this.repository,":").concat(this.branch,":").concat(e);if(this.cache.has(t))return this.cache.get(t);try{const{owner:s,repo:r}=this.parseRepository(this.repository),a=await this.githubService.getFileContent(s,r,e,this.branch),n=Buffer.from(a.content,"base64");return this.cache.set(t,n),n}catch(s){throw new Error("Failed to read file ".concat(e,": ").concat(s.message))}}async fileExists(e){try{return await this.readFile(e),!0}catch(t){return!1}}async listFiles(e){try{const{owner:t,repo:s}=this.parseRepository(this.repository),r=(await this.githubService.getRepositoryTree(t,s,this.branch,!0)).tree.filter(e=>"blob"===e.type).map(e=>e.path);if(e.includes("*")||e.includes("?")){const t=e.replace(/\./g,"\\.").replace(/\*/g,".*").replace(/\?/g,"."),s=new RegExp("^".concat(t,"$"));return r.filter(e=>s.test(e))}return r.filter(t=>t.startsWith(e))}catch(t){throw new Error("Failed to list files: ".concat(t.message))}}async getFileInfo(e){try{const{owner:t,repo:s}=this.parseRepository(this.repository),r=await this.githubService.getFileContent(t,s,e,this.branch);return{size:Buffer.from(r.content,"base64").length,sha:r.sha,path:r.path,type:r.type,url:r.html_url}}catch(t){throw new Error("Failed to get file info for ".concat(e,": ").concat(t.message))}}}const u=new class{constructor(){this.questionRegistry=new Map,this.initialized=!1}async initialize(){if(!this.initialized)try{await this.loadQuestions(),this.initialized=!0}catch(e){throw new Error("Failed to initialize FAQ engine: ".concat(e.message))}}async loadQuestions(){const e=[{id:"dak-name",module:()=>s.e(399).then(s.bind(s,30399))},{id:"dak-version",module:()=>s.e(3714).then(s.bind(s,33714))},{id:"business-process-workflows",module:()=>s.e(7076).then(s.bind(s,97076))},{id:"decision-table-inputs",module:()=>s.e(5619).then(s.bind(s,85619))}];for(const s of e)try{const e=await s.module();e.metadata&&e.execute?this.questionRegistry.set(s.id,{metadata:e.metadata,execute:e.execute,Render:e.Render||null}):console.warn("Question ".concat(s.id," is missing required exports (metadata, execute)"))}catch(t){console.error("Failed to load question ".concat(s.id,":"),t)}}getCatalog(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.initialized)throw new Error("FAQ engine not initialized");let t=Array.from(this.questionRegistry.values()).map(e=>e.metadata);return e.level&&(t=t.filter(t=>t.level===e.level)),e.tags&&Array.isArray(e.tags)&&(t=t.filter(t=>e.tags.some(e=>t.tags.includes(e)))),e.componentType&&(t=t.filter(t=>!t.componentTypes||0===t.componentTypes.length||t.componentTypes.includes(e.componentType))),e.assetType&&(t=t.filter(t=>!t.assetTypes||0===t.assetTypes.length||t.assetTypes.includes(e.assetType))),t}async executeBatch(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.initialized||await this.initialize();const s=[];for(const n of e)try{const e=await this.executeQuestion(n,t);s.push({questionId:n.questionId,success:!0,result:e})}catch(r){s.push({questionId:n.questionId,success:!1,error:r.message,result:new a.uC({structured:{},narrative:this.getErrorNarrative(n.locale||"en_US",r.message),errors:[r.message],meta:{}})})}return s}async executeQuestion(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{questionId:s,parameters:n={},assetFiles:i=[]}=e,c=this.questionRegistry.get(s);if(!c)throw new Error("Question not found: ".concat(s));if(c.metadata.isTemplate&&i.length>0)return await this.executeTemplateQuestion(c,e,t);const l=o.validateParameters(n,c.metadata.level,this.getQuestionType(c.metadata));if(!l.isValid)throw new Error("Parameter validation failed: ".concat(l.errors.join(", ")));const u=this.createStorage(l.normalized,t),d=new a.q_({repository:l.normalized.repository,locale:l.normalized.locale||"en_US",branch:l.normalized.branch||"main",user:t.user||null,assetFile:l.normalized.assetFile||null,componentType:l.normalized.componentType||null,storage:u}),h=(0,r.A)((0,r.A)({},l.normalized),{},{storage:u,context:d});return await c.execute(h)}async executeTemplateQuestion(e,t,s){const{parameters:n={},assetFiles:i=[]}=t,c=[],l=[],u=[];for(const m of i)try{const t=(0,r.A)((0,r.A)({},n),{},{assetFile:m}),i=o.validateParameters(t,e.metadata.level,this.getQuestionType(e.metadata));if(!i.isValid){u.push("Asset ".concat(m,": ").concat(i.errors.join(", ")));continue}const d=this.createStorage(i.normalized,s),h=new a.q_({repository:i.normalized.repository,locale:i.normalized.locale||"en_US",branch:i.normalized.branch||"main",user:s.user||null,assetFile:m,componentType:i.normalized.componentType||null,storage:d}),p=(0,r.A)((0,r.A)({},i.normalized),{},{storage:d,context:h}),g=await e.execute(p);c.push({assetFile:m,result:g}),g.warnings&&l.push(...g.warnings),g.errors&&u.push(...g.errors)}catch(p){u.push("Asset ".concat(m,": ").concat(p.message))}const d={assets:c.map(e=>(0,r.A)({assetFile:e.assetFile},e.result.structured)),summary:{totalAssets:i.length,successfulAssets:c.length,failedAssets:i.length-c.length}},h=this.aggregateNarratives(c,t.locale||"en_US");return new a.uC({structured:d,narrative:h,warnings:l,errors:u,meta:{isAggregated:!0,questionId:e.metadata.id,assetCount:i.length}})}createStorage(e,t){if(t.githubService)return new l(t.githubService,e.repository,e.branch||"main");throw new Error("Local storage not implemented in web context")}getQuestionType(e){return e.componentTypes&&e.componentTypes.length>0?e.componentTypes[0]:e.assetTypes&&e.assetTypes.length>0?e.assetTypes[0]:null}aggregateNarratives(e,t){if(0===e.length)return"<h4>No Results</h4><p>No assets were processed successfully.</p>";let s="<h4>Asset Analysis Results</h4>";s+="<p>Processed ".concat(e.length," asset(s):</p>"),s+="<ul>";for(const{assetFile:r,result:a}of e)s+="<li><strong>".concat(r,"</strong>"),a.errors&&a.errors.length>0?s+=' <span class="error">('.concat(a.errors.length," error(s))</span>"):a.warnings&&a.warnings.length>0?s+=' <span class="warning">('.concat(a.warnings.length," warning(s))</span>"):s+=' <span class="success">\u2713</span>',s+="</li>";return s+="</ul>",s}getErrorNarrative(e,t){const s={en_US:'<h4>Error</h4><p class="error">An error occurred while executing the question: '.concat(t,"</p>"),fr_FR:"<h4>Erreur</h4><p class=\"error\">Une erreur s'est produite lors de l'ex\xe9cution de la question: ".concat(t,"</p>"),es_ES:'<h4>Error</h4><p class="error">Ocurri\xf3 un error al ejecutar la pregunta: '.concat(t,"</p>")};return s[e]||s.en_US}normalizeLocale(e){if(!e)return"en_US";const t=e.replace("-","_");if(["en_US","fr_FR","es_ES","ar_AR","zh_CN","ru_RU"].includes(t))return t;return{en:"en_US",fr:"fr_FR",es:"es_ES",ar:"ar_AR",zh:"zh_CN",ru:"ru_RU"}[t.split("_")[0]]||"en_US"}}}}]);