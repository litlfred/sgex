"use strict";(self.webpackChunksgex_workbench=self.webpackChunksgex_workbench||[]).push([[997],{20997:(e,a,n)=>{n.r(a),n.d(a,{default:()=>g});var s=n(89379),t=n(65043),i=n(75439),o=n(74117),r=n(93071),l=n(65240),c=(n(68598),n(74155)),d=n(98714),h=n(13333),u=n(70579);const g=()=>{const{t:e}=(0,o.Bd)(),[a,n]=(0,t.useState)(null),[g,m]=(0,t.useState)([]),[p,x]=(0,t.useState)(!1),[j,v]=(0,t.useState)(!1),[f,N]=(0,t.useState)(null),[k,A]=(0,t.useState)({}),[b,w]=(0,t.useState)(null),y=(0,i.Zp)(),O=(0,i.zy)(),T=(0,t.useCallback)((e,a)=>{if(!r.A.isAuth())return;const n={};if(e){const a=l.A.getCachedRepositories(e.login,"user");a&&a.repositories&&(n["user-".concat(e.login)]=a.repositories.length)}a.forEach(e=>{const a=l.A.getCachedRepositories(e.login,"org");a&&a.repositories&&(n["org-".concat(e.login)]=a.repositories.length)}),A(n)},[]),P=(0,t.useCallback)(async()=>{v(!0),N(null);try{await r.A.checkTokenPermissions();const a=await r.A.getCurrentUser();n(a);let t=[];if(r.A.isAuth())try{t=await r.A.getUserOrganizations()}catch(f){console.error("Error fetching organizations:",f),t=[]}try{const e=await r.A.getWHOOrganization(),a=t.findIndex(e=>"WorldHealthOrganization"===e.login);a>=0?t[a]=(0,s.A)((0,s.A)((0,s.A)({},t[a]),e),{},{isWHO:!0}):t.unshift(e)}catch(e){console.warn("Could not fetch WHO organization data, using fallback:",e);const a={id:"who-organization",login:"WorldHealthOrganization",name:"World Health Organization",description:"The World Health Organization is a specialized agency of the United Nations responsible for international public health.",avatar_url:"https://avatars.githubusercontent.com/u/12261302?s=200&v=4",html_url:"https://github.com/WorldHealthOrganization",type:"Organization",isWHO:!0};t.some(e=>"WorldHealthOrganization"===e.login)?t=t.map(e=>"WorldHealthOrganization"===e.login?(0,s.A)((0,s.A)({},e),{},{isWHO:!0}):e):t.unshift(a)}m(t),T(a,t)}catch(f){console.error("Error fetching user data:",f),N("Failed to fetch user data. Please check your connection and try again."),x(!1),r.A.logout()}finally{v(!1)}},[T]);(0,t.useEffect)(()=>{r.A.initializeFromStoredToken()&&x(!0)},[]),(0,t.useEffect)(()=>{var e;null!==(e=O.state)&&void 0!==e&&e.warningMessage&&(w(O.state.warningMessage),y(O.pathname,{replace:!0,state:{}}))},[O.state,y,O.pathname]),(0,t.useEffect)(()=>{p&&!a&&P()},[p,a,P]);const z=(e,a)=>{r.A.authenticateWithOctokit(a),r.A.authenticate(e),x(!0),N(null),P()},W=(e,a)=>{const n={profile:a};(0,h.hX)(e,"/dak-action/".concat(a.login),y,n)},S=e=>{const a={login:"demo-user",name:"Demo User",avatar_url:"https://github.com/github.png",type:"User",isDemo:!0},n={profile:a,action:"edit"};(0,h.hX)(e,"/dak-selection/".concat(a.login),y,n)},C=()=>{w(null)};return p?(0,u.jsx)(d.Mx,{pageName:"landing-authenticated",children:(0,u.jsxs)("div",{className:"landing-content",children:[b&&(0,u.jsx)("div",{className:"warning-message",children:(0,u.jsxs)("div",{className:"warning-content",children:[(0,u.jsx)("span",{className:"warning-icon",children:"\u26a0\ufe0f"}),(0,u.jsx)("span",{className:"warning-text",children:b}),(0,u.jsx)("button",{className:"warning-dismiss",onClick:C,"aria-label":"Dismiss warning",children:"\xd7"})]})}),j?(0,u.jsxs)("div",{className:"loading-section",children:[(0,u.jsx)("div",{className:"spinner"}),(0,u.jsx)("p",{children:"Loading profile data..."})]}):(0,u.jsxs)("div",{className:"profile-selection",children:[(0,u.jsx)("h2",{children:e("organization.select")}),(0,u.jsxs)("p",{children:[e("organization.personal"),":"]}),f&&(0,u.jsx)("div",{className:"error-message",children:f}),(0,u.jsxs)("div",{className:"profile-grid",children:[(0,u.jsxs)("div",{className:"profile-card",onClick:e=>W(e,(0,s.A)({type:"user"},a)),children:[(0,u.jsxs)("div",{className:"profile-card-header",children:[(0,u.jsx)("img",{src:null===a||void 0===a?void 0:a.avatar_url,alt:"Personal profile"}),k["user-".concat(null===a||void 0===a?void 0:a.login)]>0&&(0,u.jsx)("div",{className:"dak-count-badge",children:k["user-".concat(null===a||void 0===a?void 0:a.login)]})]}),(0,u.jsx)("h3",{children:(null===a||void 0===a?void 0:a.name)||(null===a||void 0===a?void 0:a.login)}),(0,u.jsx)("p",{children:"Personal repositories"}),(0,u.jsx)("div",{className:"profile-badges",children:(0,u.jsx)("span",{className:"profile-type",children:"Personal"})})]}),g.map(a=>(0,u.jsxs)("div",{className:"profile-card ".concat(a.isWHO?"who-org":""),onClick:e=>W(e,(0,s.A)({type:"org"},a)),children:[(0,u.jsxs)("div",{className:"profile-card-header",children:[(0,u.jsx)("img",{src:a.avatar_url||"https://github.com/".concat(a.login,".png"),alt:"".concat(a.name||a.login," organization")}),k["org-".concat(a.login)]>0&&(0,u.jsx)("div",{className:"dak-count-badge",children:k["org-".concat(a.login)]})]}),(0,u.jsx)("h3",{children:a.name||a.login}),(0,u.jsxs)("p",{children:["@",a.login]}),(0,u.jsxs)("div",{className:"profile-badges",children:[(0,u.jsx)("span",{className:"profile-type",children:e("organization.organizations")}),a.isWHO&&(0,u.jsx)("span",{className:"who-badge",children:"WHO Official"})]})]},a.login))]})]})]})}):(0,u.jsx)(d.Mx,{pageName:"landing-unauthenticated",children:(0,u.jsxs)("div",{className:"landing-content",children:[b&&(0,u.jsx)("div",{className:"warning-message",children:(0,u.jsxs)("div",{className:"warning-content",children:[(0,u.jsx)("span",{className:"warning-icon",children:"\u26a0\ufe0f"}),(0,u.jsx)("span",{className:"warning-text",children:b}),(0,u.jsx)("button",{className:"warning-dismiss",onClick:C,"aria-label":"Dismiss warning",children:"\xd7"})]})}),(0,u.jsxs)("div",{className:"welcome-section",children:[(0,u.jsx)("h2",{children:e("landing.welcome")}),(0,u.jsx)("p",{children:e("app.description")}),(0,u.jsxs)("div",{className:"auth-section",children:[(0,u.jsxs)("p",{children:[e("auth.signInWithPAT"),":"]}),(0,u.jsx)(c.A,{onAuthSuccess:z}),f&&(0,u.jsx)("div",{className:"error-message",children:f})]}),(0,u.jsxs)("div",{className:"demo-section",children:[(0,u.jsx)("p",{children:"Want to try without authentication?"}),(0,u.jsx)("button",{onClick:S,className:"demo-mode-btn",children:"\ud83c\udfad Try Demo Mode"}),(0,u.jsx)("p",{className:"demo-note",children:"Demo mode showcases the enhanced DAK scanning display with mock data."})]}),(0,u.jsx)("div",{className:"info-section",children:(0,u.jsx)("p",{children:"Need help getting started? Use the help mascot (bottom-right corner) to access comprehensive documentation and learn more about SGEX Workbench and DAK components."})})]})]})})}},74155:(e,a,n)=>{n.d(a,{A:()=>r});var s=n(65043),t=n(74117),i=n(5452),o=n(70579);const r=e=>{let{onAuthSuccess:a}=e;const{t:r}=(0,t.Bd)(),[l,c]=(0,s.useState)(""),[d,h]=(0,s.useState)(""),[u,g]=(0,s.useState)(""),[m,p]=(0,s.useState)(!1),x=i.A.getLogger("PATLogin");s.useEffect(()=>(x.componentMount({hasOnAuthSuccess:!!a}),()=>x.componentUnmount()),[x,a]);return(0,o.jsx)("div",{className:"pat-login",children:(0,o.jsxs)("div",{className:"pat-login-section",children:[(0,o.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),x.userAction("PAT login attempt",{tokenProvided:!!l.trim()}),!l.trim()){return g("Please enter a GitHub Personal Access Token"),void x.warn("PAT login failed - no token provided")}p(!0),g("");const s=Date.now();x.auth("Starting PAT authentication");try{const{Octokit:e}=await n.e(7036).then(n.bind(n,97036)),t=new e({auth:l.trim()});x.debug("Octokit instance created for PAT validation"),x.apiCall("GET","/user",null);const i=await t.rest.users.getAuthenticated(),o=Date.now()-s;x.apiResponse("GET","/user",i.status,o),x.auth("PAT authentication successful",{username:i.data.login,duration:o}),a(l.trim(),t)}catch(t){const e=Date.now()-s;x.apiError("GET","/user",t),x.auth("PAT authentication failed",{status:t.status,message:t.message,duration:e}),console.error("PAT authentication failed:",t),401===t.status?g("Invalid Personal Access Token. Please check your token and try again."):403===t.status?g("Token doesn't have sufficient permissions. Please ensure your token has 'repo' and 'read:org' scopes."):g("Authentication failed. Please check your connection and try again.")}finally{p(!1)}},className:"pat-form",children:[(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{htmlFor:"token-name",children:"Token Name (optional):"}),(0,o.jsx)("input",{id:"token-name",type:"text",value:d,onChange:e=>{h(e.target.value),u&&g("")},placeholder:"e.g., SGEX Access Token",className:"token-name-input",disabled:m,autoComplete:"username"})]}),(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsxs)("label",{htmlFor:"pat-token",children:[r("auth.setupToken"),":"]}),(0,o.jsx)("input",{id:"pat-token",type:"password",value:l,onChange:e=>{c(e.target.value),u&&g("")},placeholder:"ghp_xxxxxxxxxxxxxxxxxxxx",className:"token-input ".concat(u?"error":""),disabled:m,autoComplete:"current-password"})]}),(0,o.jsx)("button",{type:"submit",className:"github-login-btn",disabled:m||!l.trim(),children:m?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("span",{className:"spinner small"}),r("common.loading"),"..."]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("span",{className:"github-icon",children:"\ud83d\udd11"}),r("auth.signInWithPAT")]})})]}),u&&(0,o.jsx)("div",{className:"error-message",children:u})]})})}}}]);
//# sourceMappingURL=997.29f72842.chunk.js.map