{"version":3,"file":"static/js/784.eaf8537c.chunk.js","mappings":"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","sources":["../node_modules/bpmn-js/lib/util/LabelUtil.js","../node_modules/diagram-js/lib/features/interaction-events/InteractionEvents.js","../node_modules/diagram-js/lib/features/interaction-events/index.js","../node_modules/min-dash/dist/index.esm.js","../node_modules/diagram-js/lib/core/ElementFactory.js","../node_modules/ids/node_modules/hat/index.js","../node_modules/ids/index.js","../node_modules/object-refs/dist/index.js","../node_modules/diagram-js/lib/model/index.js","../node_modules/diagram-js/lib/util/Cursor.js","../node_modules/inherits-browser/index.js","../node_modules/diagram-js/lib/util/GraphicsUtil.js","../node_modules/diagram-js/lib/util/Platform.js","../node_modules/diagram-js/lib/util/Event.js","../node_modules/didi/lib/util.js","../node_modules/didi/lib/annotation.js","../node_modules/didi/lib/injector.js","../node_modules/diagram-js/lib/draw/DefaultRenderer.js","../node_modules/diagram-js/lib/draw/index.js","../node_modules/diagram-js/lib/draw/Styles.js","../node_modules/diagram-js/lib/core/Canvas.js","../node_modules/diagram-js/lib/core/ElementRegistry.js","../node_modules/diagram-js/lib/core/EventBus.js","../node_modules/diagram-js/lib/core/GraphicsFactory.js","../node_modules/diagram-js/lib/core/index.js","../node_modules/diagram-js/lib/Diagram.js","../node_modules/moddle/lib/base.js","../node_modules/moddle/lib/factory.js","../node_modules/moddle/lib/types.js","../node_modules/moddle/lib/ns.js","../node_modules/moddle/lib/descriptor-builder.js","../node_modules/moddle/lib/registry.js","../node_modules/moddle/lib/properties.js","../node_modules/moddle/lib/moddle.js","../node_modules/saxen/lib/decode.js","../node_modules/saxen/lib/parser.js","../node_modules/moddle-xml/lib/common.js","../node_modules/moddle-xml/lib/read.js","../node_modules/moddle-xml/lib/write.js","../node_modules/bpmn-moddle/lib/bpmn-moddle.js","../node_modules/bpmn-moddle/lib/simple.js","../node_modules/bpmn-js/lib/import/BpmnTreeWalker.js","../node_modules/bpmn-js/lib/import/Importer.js","../node_modules/bpmn-js/lib/util/PoweredByUtil.js","../node_modules/bpmn-js/lib/BaseViewer.js","../node_modules/bpmn-js/lib/util/DrilldownUtil.js","../node_modules/bpmn-js/lib/import/Util.js","../node_modules/bpmn-js/lib/draw/BpmnRenderUtil.js","../node_modules/bpmn-js/lib/draw/BpmnRenderer.js","../node_modules/diagram-js/lib/util/Text.js","../node_modules/bpmn-js/lib/draw/TextRenderer.js","../node_modules/bpmn-js/lib/draw/PathMap.js","../node_modules/bpmn-js/lib/draw/index.js","../node_modules/bpmn-js/lib/import/BpmnImporter.js","../node_modules/bpmn-js/lib/import/index.js","../node_modules/bpmn-js/lib/core/index.js","../node_modules/diagram-js/lib/features/root-elements/RootElementsBehavior.js","../node_modules/diagram-js/lib/features/root-elements/index.js","../node_modules/bpmn-js/lib/features/drilldown/DrilldownBreadcrumbs.js","../node_modules/bpmn-js/lib/features/drilldown/DrilldownCentering.js","../node_modules/bpmn-js/lib/features/drilldown/SubprocessCompatibility.js","../node_modules/bpmn-js/lib/features/drilldown/DrilldownOverlayBehavior.js","../node_modules/bpmn-js/lib/features/drilldown/index.js","../node_modules/bpmn-js/lib/Viewer.js","../node_modules/diagram-js/lib/util/ModelUtil.js","../node_modules/diagram-js/lib/util/Collections.js","../node_modules/min-dom/node_modules/min-dash/dist/index.esm.js","../node_modules/min-dom/lib/style.js","../node_modules/min-dom/lib/attr.js","../node_modules/min-dom/lib/classes.js","../node_modules/min-dom/lib/clear.js","../node_modules/min-dom/lib/closest.js","../node_modules/min-dom/node_modules/component-event/index.js","../node_modules/min-dom/lib/delegate.js","../node_modules/min-dom/node_modules/domify/index.js","../node_modules/min-dom/lib/matches.js","../node_modules/min-dom/lib/query.js","../node_modules/min-dom/lib/remove.js","../node_modules/tiny-svg/dist/index.esm.js","../node_modules/diagram-js/lib/util/EscapeUtil.js","../node_modules/bpmn-js/lib/NavigatedViewer.js","../node_modules/diagram-js/lib/util/Geometry.js","../node_modules/diagram-js/lib/util/SvgTransformUtil.js","../node_modules/diagram-js/lib/i18n/translate/index.js","../node_modules/diagram-js/lib/i18n/translate/translate.js","../node_modules/bpmn-js/lib/util/CompatibilityUtil.js","../node_modules/diagram-js/lib/features/selection/Selection.js","../node_modules/diagram-js/lib/features/selection/SelectionVisuals.js","../node_modules/diagram-js/lib/features/selection/SelectionBehavior.js","../node_modules/diagram-js/lib/features/selection/index.js","../node_modules/diagram-js/lib/util/Math.js","../node_modules/diagram-js/lib/navigation/zoomscroll/ZoomUtil.js","../node_modules/diagram-js/lib/navigation/zoomscroll/ZoomScroll.js","../node_modules/diagram-js/lib/navigation/zoomscroll/index.js","../node_modules/diagram-js/lib/features/keyboard/KeyboardUtil.js","../node_modules/bpmn-js/lib/util/DiUtil.js","../node_modules/diagram-js/lib/util/IdGenerator.js","../node_modules/diagram-js/lib/util/PositionUtil.js","../node_modules/diagram-js/lib/features/overlays/Overlays.js","../node_modules/diagram-js/lib/features/overlays/index.js","../node_modules/diagram-js/lib/util/Elements.js","../node_modules/diagram-js/lib/command/CommandInterceptor.js","../node_modules/diagram-js/lib/util/RenderUtil.js","../node_modules/diagram-js/lib/features/keyboard/Keyboard.js","../node_modules/diagram-js/lib/features/keyboard/index.js","../node_modules/diagram-js/lib/features/keyboard/KeyboardBindings.js","../node_modules/diagram-js/lib/features/change-support/ChangeSupport.js","../node_modules/diagram-js/lib/features/change-support/index.js","../node_modules/path-intersection/intersect.js","../node_modules/diagram-js/lib/util/Mouse.js","../node_modules/diagram-js/lib/navigation/movecanvas/MoveCanvas.js","../node_modules/diagram-js/lib/navigation/movecanvas/index.js","../node_modules/bpmn-js/lib/util/ModelUtil.js","../node_modules/diagram-js/lib/util/ClickTrap.js","../node_modules/diagram-js/lib/navigation/keyboard-move/KeyboardMove.js","../node_modules/diagram-js/lib/navigation/keyboard-move/index.js","../node_modules/diagram-js/lib/layout/LayoutUtil.js","../node_modules/diagram-js/lib/draw/BaseRenderer.js"],"sourcesContent":["import {\r\n  assign\r\n} from 'min-dash';\r\n\r\nimport { is } from './ModelUtil';\r\n\r\nimport { isLabel } from 'diagram-js/lib/util/ModelUtil';\r\n\r\nexport { isLabel } from 'diagram-js/lib/util/ModelUtil';\r\n\r\n/**\r\n * @typedef {import('diagram-js/lib/util/Types').Point} Point\r\n * @typedef {import('diagram-js/lib/util/Types').Rect} Rect\r\n *\r\n * @typedef {import('../model/Types').Element} Element\r\n * @typedef {import('../model/Types').ModdleElement} ModdleElement\r\n */\r\n\r\nexport var DEFAULT_LABEL_SIZE = {\r\n  width: 90,\r\n  height: 20\r\n};\r\n\r\nexport var FLOW_LABEL_INDENT = 15;\r\n\r\n\r\n/**\r\n * Return true if the given semantic has an external label.\r\n *\r\n * @param {Element} semantic\r\n *\r\n * @return {boolean}\r\n */\r\nexport function isLabelExternal(semantic) {\r\n  return is(semantic, 'bpmn:Event') ||\r\n         is(semantic, 'bpmn:Gateway') ||\r\n         is(semantic, 'bpmn:DataStoreReference') ||\r\n         is(semantic, 'bpmn:DataObjectReference') ||\r\n         is(semantic, 'bpmn:DataInput') ||\r\n         is(semantic, 'bpmn:DataOutput') ||\r\n         is(semantic, 'bpmn:SequenceFlow') ||\r\n         is(semantic, 'bpmn:MessageFlow') ||\r\n         is(semantic, 'bpmn:Group');\r\n}\r\n\r\n/**\r\n * Return true if the given element has an external label.\r\n *\r\n * @param {Element} element\r\n *\r\n * @return {boolean}\r\n */\r\nexport function hasExternalLabel(element) {\r\n  return isLabel(element.label);\r\n}\r\n\r\n/**\r\n * Get the position of a sequence flow label.\r\n *\r\n * @param  {Point[]} waypoints\r\n *\r\n * @return {Point}\r\n */\r\nexport function getFlowLabelPosition(waypoints) {\r\n\r\n  // get the waypoints mid\r\n  var mid = waypoints.length / 2 - 1;\r\n\r\n  var first = waypoints[Math.floor(mid)];\r\n  var second = waypoints[Math.ceil(mid + 0.01)];\r\n\r\n  // get position\r\n  var position = getWaypointsMid(waypoints);\r\n\r\n  // calculate angle\r\n  var angle = Math.atan((second.y - first.y) / (second.x - first.x));\r\n\r\n  var x = position.x,\r\n      y = position.y;\r\n\r\n  if (Math.abs(angle) < Math.PI / 2) {\r\n    y -= FLOW_LABEL_INDENT;\r\n  } else {\r\n    x += FLOW_LABEL_INDENT;\r\n  }\r\n\r\n  return { x: x, y: y };\r\n}\r\n\r\n\r\n/**\r\n * Get the middle of a number of waypoints.\r\n *\r\n * @param  {Point[]} waypoints\r\n *\r\n * @return {Point}\r\n */\r\nexport function getWaypointsMid(waypoints) {\r\n\r\n  var mid = waypoints.length / 2 - 1;\r\n\r\n  var first = waypoints[Math.floor(mid)];\r\n  var second = waypoints[Math.ceil(mid + 0.01)];\r\n\r\n  return {\r\n    x: first.x + (second.x - first.x) / 2,\r\n    y: first.y + (second.y - first.y) / 2\r\n  };\r\n}\r\n\r\n/**\r\n * Get the middle of the external label of an element.\r\n *\r\n * @param {Element} element\r\n *\r\n * @return {Point}\r\n */\r\nexport function getExternalLabelMid(element) {\r\n\r\n  if (element.waypoints) {\r\n    return getFlowLabelPosition(element.waypoints);\r\n  } else if (is(element, 'bpmn:Group')) {\r\n    return {\r\n      x: element.x + element.width / 2,\r\n      y: element.y + DEFAULT_LABEL_SIZE.height / 2\r\n    };\r\n  } else {\r\n    return {\r\n      x: element.x + element.width / 2,\r\n      y: element.y + element.height + DEFAULT_LABEL_SIZE.height / 2\r\n    };\r\n  }\r\n}\r\n\r\n\r\n/**\r\n * Return the bounds of an elements label, parsed from the elements DI or\r\n * generated from its bounds.\r\n *\r\n * @param {ModdleElement} di\r\n * @param {Element} element\r\n *\r\n * @return {Rect}\r\n */\r\nexport function getExternalLabelBounds(di, element) {\r\n\r\n  var mid,\r\n      size,\r\n      bounds,\r\n      label = di.label;\r\n\r\n  if (label && label.bounds) {\r\n    bounds = label.bounds;\r\n\r\n    size = {\r\n      width: Math.max(DEFAULT_LABEL_SIZE.width, bounds.width),\r\n      height: bounds.height\r\n    };\r\n\r\n    mid = {\r\n      x: bounds.x + bounds.width / 2,\r\n      y: bounds.y + bounds.height / 2\r\n    };\r\n  } else {\r\n\r\n    mid = getExternalLabelMid(element);\r\n\r\n    size = DEFAULT_LABEL_SIZE;\r\n  }\r\n\r\n  return assign({\r\n    x: mid.x - size.width / 2,\r\n    y: mid.y - size.height / 2\r\n  }, size);\r\n}\r\n\r\n/**\r\n * @param {ModdleElement} semantic\r\n *\r\n * @returns {string}\r\n */\r\nfunction getLabelAttr(semantic) {\r\n  if (\r\n    is(semantic, 'bpmn:FlowElement') ||\r\n    is(semantic, 'bpmn:Participant') ||\r\n    is(semantic, 'bpmn:Lane') ||\r\n    is(semantic, 'bpmn:SequenceFlow') ||\r\n    is(semantic, 'bpmn:MessageFlow') ||\r\n    is(semantic, 'bpmn:DataInput') ||\r\n    is(semantic, 'bpmn:DataOutput')\r\n  ) {\r\n    return 'name';\r\n  }\r\n\r\n  if (is(semantic, 'bpmn:TextAnnotation')) {\r\n    return 'text';\r\n  }\r\n\r\n  if (is(semantic, 'bpmn:Group')) {\r\n    return 'categoryValueRef';\r\n  }\r\n}\r\n\r\n/**\r\n * @param {ModdleElement} semantic\r\n *\r\n * @returns {string}\r\n */\r\nfunction getCategoryValue(semantic) {\r\n  var categoryValueRef = semantic['categoryValueRef'];\r\n\r\n  if (!categoryValueRef) {\r\n    return '';\r\n  }\r\n\r\n\r\n  return categoryValueRef.value || '';\r\n}\r\n\r\n/**\r\n * @param {Element} element\r\n *\r\n * @return {string}\r\n */\r\nexport function getLabel(element) {\r\n  var semantic = element.businessObject,\r\n      attr = getLabelAttr(semantic);\r\n\r\n  if (attr) {\r\n\r\n    if (attr === 'categoryValueRef') {\r\n\r\n      return getCategoryValue(semantic);\r\n    }\r\n\r\n    return semantic[attr] || '';\r\n  }\r\n}\r\n\r\n\r\n/**\r\n * @param {Element} element\r\n * @param {string} text\r\n *\r\n * @return {Element}\r\n */\r\nexport function setLabel(element, text) {\r\n  var semantic = element.businessObject,\r\n      attr = getLabelAttr(semantic);\r\n\r\n  if (attr) {\r\n\r\n    if (attr === 'categoryValueRef') {\r\n      if (!semantic[attr]) {\r\n        return element;\r\n      }\r\n\r\n      semantic[attr].value = text;\r\n    } else {\r\n      semantic[attr] = text;\r\n    }\r\n\r\n  }\r\n\r\n  return element;\r\n}\r\n","import {\n  forEach,\n  assign\n} from 'min-dash';\n\nimport {\n  delegate as domDelegate,\n  query as domQuery,\n  queryAll as domQueryAll\n} from 'min-dom';\n\nimport {\n  isPrimaryButton,\n  isAuxiliaryButton\n} from '../../util/Mouse';\n\nimport {\n  append as svgAppend,\n  attr as svgAttr,\n  create as svgCreate,\n  remove as svgRemove\n} from 'tiny-svg';\n\nimport {\n  createLine,\n  updateLine\n} from '../../util/RenderUtil';\n\n/**\n * @typedef {import('../../model/Types').Element} Element\n *\n * @typedef {import('../../core/ElementRegistry').default} ElementRegistry\n * @typedef {import('../../core/EventBus').default} EventBus\n * @typedef {import('../../draw/Styles').default} Styles\n *\n * @typedef {import('../../util/Types').Point} Point\n */\n\nfunction allowAll(event) { return true; }\n\nfunction allowPrimaryAndAuxiliary(event) {\n  return isPrimaryButton(event) || isAuxiliaryButton(event);\n}\n\nvar LOW_PRIORITY = 500;\n\n\n/**\n * A plugin that provides interaction events for diagram elements.\n *\n * It emits the following events:\n *\n *   * element.click\n *   * element.contextmenu\n *   * element.dblclick\n *   * element.hover\n *   * element.mousedown\n *   * element.mousemove\n *   * element.mouseup\n *   * element.out\n *\n * Each event is a tuple { element, gfx, originalEvent }.\n *\n * Canceling the event via Event#preventDefault()\n * prevents the original DOM operation.\n *\n * @param {EventBus} eventBus\n * @param {ElementRegistry} elementRegistry\n * @param {Styles} styles\n */\nexport default function InteractionEvents(eventBus, elementRegistry, styles) {\n\n  var self = this;\n\n  /**\n   * Fire an interaction event.\n   *\n   * @param {string} type local event name, e.g. element.click.\n   * @param {MouseEvent|TouchEvent} event native event\n   * @param {Element} [element] the diagram element to emit the event on;\n   *                                   defaults to the event target\n   */\n  function fire(type, event, element) {\n\n    if (isIgnored(type, event)) {\n      return;\n    }\n\n    var target, gfx, returnValue;\n\n    if (!element) {\n      target = event.delegateTarget || event.target;\n\n      if (target) {\n        gfx = target;\n        element = elementRegistry.get(gfx);\n      }\n    } else {\n      gfx = elementRegistry.getGraphics(element);\n    }\n\n    if (!gfx || !element) {\n      return;\n    }\n\n    returnValue = eventBus.fire(type, {\n      element: element,\n      gfx: gfx,\n      originalEvent: event\n    });\n\n    if (returnValue === false) {\n      event.stopPropagation();\n      event.preventDefault();\n    }\n  }\n\n  // TODO(nikku): document this\n  var handlers = {};\n\n  function mouseHandler(localEventName) {\n    return handlers[localEventName];\n  }\n\n  function isIgnored(localEventName, event) {\n\n    var filter = ignoredFilters[localEventName] || isPrimaryButton;\n\n    // only react on left mouse button interactions\n    // except for interaction events that are enabled\n    // for secundary mouse button\n    return !filter(event);\n  }\n\n  var bindings = {\n    click: 'element.click',\n    contextmenu: 'element.contextmenu',\n    dblclick: 'element.dblclick',\n    mousedown: 'element.mousedown',\n    mousemove: 'element.mousemove',\n    mouseover: 'element.hover',\n    mouseout: 'element.out',\n    mouseup: 'element.mouseup',\n  };\n\n  var ignoredFilters = {\n    'element.contextmenu': allowAll,\n    'element.mousedown': allowPrimaryAndAuxiliary,\n    'element.mouseup': allowPrimaryAndAuxiliary,\n    'element.click': allowPrimaryAndAuxiliary,\n    'element.dblclick': allowPrimaryAndAuxiliary\n  };\n\n\n  // manual event trigger //////////\n\n  /**\n   * Trigger an interaction event (based on a native dom event)\n   * on the target shape or connection.\n   *\n   * @param {string} eventName the name of the triggered DOM event\n   * @param {MouseEvent|TouchEvent} event\n   * @param {Element} targetElement\n   */\n  function triggerMouseEvent(eventName, event, targetElement) {\n\n    // i.e. element.mousedown...\n    var localEventName = bindings[eventName];\n\n    if (!localEventName) {\n      throw new Error('unmapped DOM event name <' + eventName + '>');\n    }\n\n    return fire(localEventName, event, targetElement);\n  }\n\n\n  var ELEMENT_SELECTOR = 'svg, .djs-element';\n\n  // event handling ///////\n\n  function registerEvent(node, event, localEvent, ignoredFilter) {\n\n    var handler = handlers[localEvent] = function(event) {\n      fire(localEvent, event);\n    };\n\n    if (ignoredFilter) {\n      ignoredFilters[localEvent] = ignoredFilter;\n    }\n\n    handler.$delegate = domDelegate.bind(node, ELEMENT_SELECTOR, event, handler);\n  }\n\n  function unregisterEvent(node, event, localEvent) {\n\n    var handler = mouseHandler(localEvent);\n\n    if (!handler) {\n      return;\n    }\n\n    domDelegate.unbind(node, event, handler.$delegate);\n  }\n\n  function registerEvents(svg) {\n    forEach(bindings, function(val, key) {\n      registerEvent(svg, key, val);\n    });\n  }\n\n  function unregisterEvents(svg) {\n    forEach(bindings, function(val, key) {\n      unregisterEvent(svg, key, val);\n    });\n  }\n\n  eventBus.on('canvas.destroy', function(event) {\n    unregisterEvents(event.svg);\n  });\n\n  eventBus.on('canvas.init', function(event) {\n    registerEvents(event.svg);\n  });\n\n\n  // hit box updating ////////////////\n\n  eventBus.on([ 'shape.added', 'connection.added' ], function(event) {\n    var element = event.element,\n        gfx = event.gfx;\n\n    eventBus.fire('interactionEvents.createHit', { element: element, gfx: gfx });\n  });\n\n  // Update djs-hit on change.\n  // A low priortity is necessary, because djs-hit of labels has to be updated\n  // after the label bounds have been updated in the renderer.\n  eventBus.on([\n    'shape.changed',\n    'connection.changed'\n  ], LOW_PRIORITY, function(event) {\n\n    var element = event.element,\n        gfx = event.gfx;\n\n    eventBus.fire('interactionEvents.updateHit', { element: element, gfx: gfx });\n  });\n\n  eventBus.on('interactionEvents.createHit', LOW_PRIORITY, function(event) {\n    var element = event.element,\n        gfx = event.gfx;\n\n    self.createDefaultHit(element, gfx);\n  });\n\n  eventBus.on('interactionEvents.updateHit', function(event) {\n    var element = event.element,\n        gfx = event.gfx;\n\n    self.updateDefaultHit(element, gfx);\n  });\n\n\n  // hit styles ////////////\n\n  var STROKE_HIT_STYLE = createHitStyle('djs-hit djs-hit-stroke');\n\n  var CLICK_STROKE_HIT_STYLE = createHitStyle('djs-hit djs-hit-click-stroke');\n\n  var ALL_HIT_STYLE = createHitStyle('djs-hit djs-hit-all');\n\n  var NO_MOVE_HIT_STYLE = createHitStyle('djs-hit djs-hit-no-move');\n\n  var HIT_TYPES = {\n    'all': ALL_HIT_STYLE,\n    'click-stroke': CLICK_STROKE_HIT_STYLE,\n    'stroke': STROKE_HIT_STYLE,\n    'no-move': NO_MOVE_HIT_STYLE\n  };\n\n  function createHitStyle(classNames, attrs) {\n\n    attrs = assign({\n      stroke: 'white',\n      strokeWidth: 15\n    }, attrs || {});\n\n    return styles.cls(classNames, [ 'no-fill', 'no-border' ], attrs);\n  }\n\n\n  // style helpers ///////////////\n\n  function applyStyle(hit, type) {\n\n    var attrs = HIT_TYPES[type];\n\n    if (!attrs) {\n      throw new Error('invalid hit type <' + type + '>');\n    }\n\n    svgAttr(hit, attrs);\n\n    return hit;\n  }\n\n  function appendHit(gfx, hit) {\n    svgAppend(gfx, hit);\n  }\n\n\n  // API\n\n  /**\n   * Remove hints on the given graphics.\n   *\n   * @param {SVGElement} gfx\n   */\n  this.removeHits = function(gfx) {\n    var hits = domQueryAll('.djs-hit', gfx);\n\n    forEach(hits, svgRemove);\n  };\n\n  /**\n   * Create default hit for the given element.\n   *\n   * @param {Element} element\n   * @param {SVGElement} gfx\n   *\n   * @return {SVGElement} created hit\n   */\n  this.createDefaultHit = function(element, gfx) {\n    var waypoints = element.waypoints,\n        isFrame = element.isFrame,\n        boxType;\n\n    if (waypoints) {\n      return this.createWaypointsHit(gfx, waypoints);\n    } else {\n\n      boxType = isFrame ? 'stroke' : 'all';\n\n      return this.createBoxHit(gfx, boxType, {\n        width: element.width,\n        height: element.height\n      });\n    }\n  };\n\n  /**\n   * Create hits for the given waypoints.\n   *\n   * @param {SVGElement} gfx\n   * @param {Point[]} waypoints\n   *\n   * @return {SVGElement}\n   */\n  this.createWaypointsHit = function(gfx, waypoints) {\n\n    var hit = createLine(waypoints);\n\n    applyStyle(hit, 'stroke');\n\n    appendHit(gfx, hit);\n\n    return hit;\n  };\n\n  /**\n   * Create hits for a box.\n   *\n   * @param {SVGElement} gfx\n   * @param {string} type\n   * @param {Object} attrs\n   *\n   * @return {SVGElement}\n   */\n  this.createBoxHit = function(gfx, type, attrs) {\n\n    attrs = assign({\n      x: 0,\n      y: 0\n    }, attrs);\n\n    var hit = svgCreate('rect');\n\n    applyStyle(hit, type);\n\n    svgAttr(hit, attrs);\n\n    appendHit(gfx, hit);\n\n    return hit;\n  };\n\n  /**\n   * Update default hit of the element.\n   *\n   * @param {Element} element\n   * @param {SVGElement} gfx\n   *\n   * @return {SVGElement} updated hit\n   */\n  this.updateDefaultHit = function(element, gfx) {\n\n    var hit = domQuery('.djs-hit', gfx);\n\n    if (!hit) {\n      return;\n    }\n\n    if (element.waypoints) {\n      updateLine(hit, element.waypoints);\n    } else {\n      svgAttr(hit, {\n        width: element.width,\n        height: element.height\n      });\n    }\n\n    return hit;\n  };\n\n  this.fire = fire;\n\n  this.triggerMouseEvent = triggerMouseEvent;\n\n  this.mouseHandler = mouseHandler;\n\n  this.registerEvent = registerEvent;\n  this.unregisterEvent = unregisterEvent;\n}\n\n\nInteractionEvents.$inject = [\n  'eventBus',\n  'elementRegistry',\n  'styles'\n];\n\n\n/**\n * An event indicating that the mouse hovered over an element\n *\n * @event element.hover\n *\n * @type {Object}\n * @property {Element} element\n * @property {SVGElement} gfx\n * @property {Event} originalEvent\n */\n\n/**\n * An event indicating that the mouse has left an element\n *\n * @event element.out\n *\n * @type {Object}\n * @property {Element} element\n * @property {SVGElement} gfx\n * @property {Event} originalEvent\n */\n\n/**\n * An event indicating that the mouse has clicked an element\n *\n * @event element.click\n *\n * @type {Object}\n * @property {Element} element\n * @property {SVGElement} gfx\n * @property {Event} originalEvent\n */\n\n/**\n * An event indicating that the mouse has double clicked an element\n *\n * @event element.dblclick\n *\n * @type {Object}\n * @property {Element} element\n * @property {SVGElement} gfx\n * @property {Event} originalEvent\n */\n\n/**\n * An event indicating that the mouse has gone down on an element.\n *\n * @event element.mousedown\n *\n * @type {Object}\n * @property {Element} element\n * @property {SVGElement} gfx\n * @property {Event} originalEvent\n */\n\n/**\n * An event indicating that the mouse has gone up on an element.\n *\n * @event element.mouseup\n *\n * @type {Object}\n * @property {Element} element\n * @property {SVGElement} gfx\n * @property {Event} originalEvent\n */\n\n/**\n * An event indicating that the context menu action is triggered\n * via mouse or touch controls.\n *\n * @event element.contextmenu\n *\n * @type {Object}\n * @property {Element} element\n * @property {SVGElement} gfx\n * @property {Event} originalEvent\n */","import InteractionEvents from './InteractionEvents';\n\n\n/**\n * @type { import('didi').ModuleDeclaration }\n */\nexport default {\n  __init__: [ 'interactionEvents' ],\n  interactionEvents: [ 'type', InteractionEvents ]\n};","/**\n * Flatten array, one level deep.\n *\n * @template T\n *\n * @param {T[][] | T[] | null} [arr]\n *\n * @return {T[]}\n */\nfunction flatten(arr) {\n  return Array.prototype.concat.apply([], arr);\n}\n\nconst nativeToString = Object.prototype.toString;\nconst nativeHasOwnProperty = Object.prototype.hasOwnProperty;\n\nfunction isUndefined(obj) {\n  return obj === undefined;\n}\n\nfunction isDefined(obj) {\n  return obj !== undefined;\n}\n\nfunction isNil(obj) {\n  return obj == null;\n}\n\nfunction isArray(obj) {\n  return nativeToString.call(obj) === '[object Array]';\n}\n\nfunction isObject(obj) {\n  return nativeToString.call(obj) === '[object Object]';\n}\n\nfunction isNumber(obj) {\n  return nativeToString.call(obj) === '[object Number]';\n}\n\n/**\n * @param {any} obj\n *\n * @return {boolean}\n */\nfunction isFunction(obj) {\n  const tag = nativeToString.call(obj);\n\n  return (\n    tag === '[object Function]' ||\n    tag === '[object AsyncFunction]' ||\n    tag === '[object GeneratorFunction]' ||\n    tag === '[object AsyncGeneratorFunction]' ||\n    tag === '[object Proxy]'\n  );\n}\n\nfunction isString(obj) {\n  return nativeToString.call(obj) === '[object String]';\n}\n\n\n/**\n * Ensure collection is an array.\n *\n * @param {Object} obj\n */\nfunction ensureArray(obj) {\n\n  if (isArray(obj)) {\n    return;\n  }\n\n  throw new Error('must supply array');\n}\n\n/**\n * Return true, if target owns a property with the given key.\n *\n * @param {Object} target\n * @param {String} key\n *\n * @return {Boolean}\n */\nfunction has(target, key) {\n  return !isNil(target) && nativeHasOwnProperty.call(target, key);\n}\n\n/**\n * @template T\n * @typedef { (\n *   ((e: T) => boolean) |\n *   ((e: T, idx: number) => boolean) |\n *   ((e: T, key: string) => boolean) |\n *   string |\n *   number\n * ) } Matcher\n */\n\n/**\n * @template T\n * @template U\n *\n * @typedef { (\n *   ((e: T) => U) | string | number\n * ) } Extractor\n */\n\n\n/**\n * @template T\n * @typedef { (val: T, key: any) => boolean } MatchFn\n */\n\n/**\n * @template T\n * @typedef { T[] } ArrayCollection\n */\n\n/**\n * @template T\n * @typedef { { [key: string]: T } } StringKeyValueCollection\n */\n\n/**\n * @template T\n * @typedef { { [key: number]: T } } NumberKeyValueCollection\n */\n\n/**\n * @template T\n * @typedef { StringKeyValueCollection<T> | NumberKeyValueCollection<T> } KeyValueCollection\n */\n\n/**\n * @template T\n * @typedef { KeyValueCollection<T> | ArrayCollection<T> } Collection\n */\n\n/**\n * Find element in collection.\n *\n * @template T\n * @param {Collection<T>} collection\n * @param {Matcher<T>} matcher\n *\n * @return {Object}\n */\nfunction find(collection, matcher) {\n\n  const matchFn = toMatcher(matcher);\n\n  let match;\n\n  forEach(collection, function(val, key) {\n    if (matchFn(val, key)) {\n      match = val;\n\n      return false;\n    }\n  });\n\n  return match;\n\n}\n\n\n/**\n * Find element index in collection.\n *\n * @template T\n * @param {Collection<T>} collection\n * @param {Matcher<T>} matcher\n *\n * @return {number | string | undefined}\n */\nfunction findIndex(collection, matcher) {\n\n  const matchFn = toMatcher(matcher);\n\n  let idx = isArray(collection) ? -1 : undefined;\n\n  forEach(collection, function(val, key) {\n    if (matchFn(val, key)) {\n      idx = key;\n\n      return false;\n    }\n  });\n\n  return idx;\n}\n\n\n/**\n * Filter elements in collection.\n *\n * @template T\n * @param {Collection<T>} collection\n * @param {Matcher<T>} matcher\n *\n * @return {T[]} result\n */\nfunction filter(collection, matcher) {\n\n  const matchFn = toMatcher(matcher);\n\n  let result = [];\n\n  forEach(collection, function(val, key) {\n    if (matchFn(val, key)) {\n      result.push(val);\n    }\n  });\n\n  return result;\n}\n\n\n/**\n * Iterate over collection; returning something\n * (non-undefined) will stop iteration.\n *\n * @template T\n * @param {Collection<T>} collection\n * @param { ((item: T, idx: number) => (boolean|void)) | ((item: T, key: string) => (boolean|void)) } iterator\n *\n * @return {T} return result that stopped the iteration\n */\nfunction forEach(collection, iterator) {\n\n  let val,\n      result;\n\n  if (isUndefined(collection)) {\n    return;\n  }\n\n  const convertKey = isArray(collection) ? toNum : identity;\n\n  for (let key in collection) {\n\n    if (has(collection, key)) {\n      val = collection[key];\n\n      result = iterator(val, convertKey(key));\n\n      if (result === false) {\n        return val;\n      }\n    }\n  }\n}\n\n/**\n * Return collection without element.\n *\n * @template T\n * @param {ArrayCollection<T>} arr\n * @param {Matcher<T>} matcher\n *\n * @return {T[]}\n */\nfunction without(arr, matcher) {\n\n  if (isUndefined(arr)) {\n    return [];\n  }\n\n  ensureArray(arr);\n\n  const matchFn = toMatcher(matcher);\n\n  return arr.filter(function(el, idx) {\n    return !matchFn(el, idx);\n  });\n\n}\n\n\n/**\n * Reduce collection, returning a single result.\n *\n * @template T\n * @template V\n *\n * @param {Collection<T>} collection\n * @param {(result: V, entry: T, index: any) => V} iterator\n * @param {V} result\n *\n * @return {V} result returned from last iterator\n */\nfunction reduce(collection, iterator, result) {\n\n  forEach(collection, function(value, idx) {\n    result = iterator(result, value, idx);\n  });\n\n  return result;\n}\n\n\n/**\n * Return true if every element in the collection\n * matches the criteria.\n *\n * @param  {Object|Array} collection\n * @param  {Function} matcher\n *\n * @return {Boolean}\n */\nfunction every(collection, matcher) {\n\n  return !!reduce(collection, function(matches, val, key) {\n    return matches && matcher(val, key);\n  }, true);\n}\n\n\n/**\n * Return true if some elements in the collection\n * match the criteria.\n *\n * @param  {Object|Array} collection\n * @param  {Function} matcher\n *\n * @return {Boolean}\n */\nfunction some(collection, matcher) {\n\n  return !!find(collection, matcher);\n}\n\n\n/**\n * Transform a collection into another collection\n * by piping each member through the given fn.\n *\n * @param  {Object|Array}   collection\n * @param  {Function} fn\n *\n * @return {Array} transformed collection\n */\nfunction map(collection, fn) {\n\n  let result = [];\n\n  forEach(collection, function(val, key) {\n    result.push(fn(val, key));\n  });\n\n  return result;\n}\n\n\n/**\n * Get the collections keys.\n *\n * @param  {Object|Array} collection\n *\n * @return {Array}\n */\nfunction keys(collection) {\n  return collection && Object.keys(collection) || [];\n}\n\n\n/**\n * Shorthand for `keys(o).length`.\n *\n * @param  {Object|Array} collection\n *\n * @return {Number}\n */\nfunction size(collection) {\n  return keys(collection).length;\n}\n\n\n/**\n * Get the values in the collection.\n *\n * @param  {Object|Array} collection\n *\n * @return {Array}\n */\nfunction values(collection) {\n  return map(collection, (val) => val);\n}\n\n\n/**\n * Group collection members by attribute.\n *\n * @param {Object|Array} collection\n * @param {Extractor} extractor\n *\n * @return {Object} map with { attrValue => [ a, b, c ] }\n */\nfunction groupBy(collection, extractor, grouped = {}) {\n\n  extractor = toExtractor(extractor);\n\n  forEach(collection, function(val) {\n    let discriminator = extractor(val) || '_';\n\n    let group = grouped[discriminator];\n\n    if (!group) {\n      group = grouped[discriminator] = [];\n    }\n\n    group.push(val);\n  });\n\n  return grouped;\n}\n\n\nfunction uniqueBy(extractor, ...collections) {\n\n  extractor = toExtractor(extractor);\n\n  let grouped = {};\n\n  forEach(collections, (c) => groupBy(c, extractor, grouped));\n\n  let result = map(grouped, function(val, key) {\n    return val[0];\n  });\n\n  return result;\n}\n\n\nconst unionBy = uniqueBy;\n\n\n\n/**\n * Sort collection by criteria.\n *\n * @template T\n *\n * @param {Collection<T>} collection\n * @param {Extractor<T, number | string>} extractor\n *\n * @return {Array}\n */\nfunction sortBy(collection, extractor) {\n\n  extractor = toExtractor(extractor);\n\n  let sorted = [];\n\n  forEach(collection, function(value, key) {\n    let disc = extractor(value, key);\n\n    let entry = {\n      d: disc,\n      v: value\n    };\n\n    for (var idx = 0; idx < sorted.length; idx++) {\n      let { d } = sorted[idx];\n\n      if (disc < d) {\n        sorted.splice(idx, 0, entry);\n        return;\n      }\n    }\n\n    // not inserted, append (!)\n    sorted.push(entry);\n  });\n\n  return map(sorted, (e) => e.v);\n}\n\n\n/**\n * Create an object pattern matcher.\n *\n * @example\n *\n * ```javascript\n * const matcher = matchPattern({ id: 1 });\n *\n * let element = find(elements, matcher);\n * ```\n *\n * @template T\n *\n * @param {T} pattern\n *\n * @return { (el: any) =>  boolean } matcherFn\n */\nfunction matchPattern(pattern) {\n\n  return function(el) {\n\n    return every(pattern, function(val, key) {\n      return el[key] === val;\n    });\n\n  };\n}\n\n\n/**\n * @param {string | ((e: any) => any) } extractor\n *\n * @return { (e: any) => any }\n */\nfunction toExtractor(extractor) {\n\n  /**\n   * @satisfies { (e: any) => any }\n   */\n  return isFunction(extractor) ? extractor : (e) => {\n\n    // @ts-ignore: just works\n    return e[extractor];\n  };\n}\n\n\n/**\n * @template T\n * @param {Matcher<T>} matcher\n *\n * @return {MatchFn<T>}\n */\nfunction toMatcher(matcher) {\n  return isFunction(matcher) ? matcher : (e) => {\n    return e === matcher;\n  };\n}\n\n\nfunction identity(arg) {\n  return arg;\n}\n\nfunction toNum(arg) {\n  return Number(arg);\n}\n\n/* global setTimeout clearTimeout */\n\n/**\n * @typedef { {\n *   (...args: any[]): any;\n *   flush: () => void;\n *   cancel: () => void;\n * } } DebouncedFunction\n */\n\n/**\n * Debounce fn, calling it only once if the given time\n * elapsed between calls.\n *\n * Lodash-style the function exposes methods to `#clear`\n * and `#flush` to control internal behavior.\n *\n * @param  {Function} fn\n * @param  {Number} timeout\n *\n * @return {DebouncedFunction} debounced function\n */\nfunction debounce(fn, timeout) {\n\n  let timer;\n\n  let lastArgs;\n  let lastThis;\n\n  let lastNow;\n\n  function fire(force) {\n\n    let now = Date.now();\n\n    let scheduledDiff = force ? 0 : (lastNow + timeout) - now;\n\n    if (scheduledDiff > 0) {\n      return schedule(scheduledDiff);\n    }\n\n    fn.apply(lastThis, lastArgs);\n\n    clear();\n  }\n\n  function schedule(timeout) {\n    timer = setTimeout(fire, timeout);\n  }\n\n  function clear() {\n    if (timer) {\n      clearTimeout(timer);\n    }\n\n    timer = lastNow = lastArgs = lastThis = undefined;\n  }\n\n  function flush() {\n    if (timer) {\n      fire(true);\n    }\n\n    clear();\n  }\n\n  /**\n   * @type { DebouncedFunction }\n   */\n  function callback(...args) {\n    lastNow = Date.now();\n\n    lastArgs = args;\n    lastThis = this;\n\n    // ensure an execution is scheduled\n    if (!timer) {\n      schedule(timeout);\n    }\n  }\n\n  callback.flush = flush;\n  callback.cancel = clear;\n\n  return callback;\n}\n\n/**\n * Throttle fn, calling at most once\n * in the given interval.\n *\n * @param  {Function} fn\n * @param  {Number} interval\n *\n * @return {Function} throttled function\n */\nfunction throttle(fn, interval) {\n  let throttling = false;\n\n  return function(...args) {\n\n    if (throttling) {\n      return;\n    }\n\n    fn(...args);\n    throttling = true;\n\n    setTimeout(() => {\n      throttling = false;\n    }, interval);\n  };\n}\n\n/**\n * Bind function against target <this>.\n *\n * @param  {Function} fn\n * @param  {Object}   target\n *\n * @return {Function} bound function\n */\nfunction bind(fn, target) {\n  return fn.bind(target);\n}\n\n/**\n * Convenience wrapper for `Object.assign`.\n *\n * @param {Object} target\n * @param {...Object} others\n *\n * @return {Object} the target\n */\nfunction assign(target, ...others) {\n  return Object.assign(target, ...others);\n}\n\n/**\n * Sets a nested property of a given object to the specified value.\n *\n * This mutates the object and returns it.\n *\n * @template T\n *\n * @param {T} target The target of the set operation.\n * @param {(string|number)[]} path The path to the nested value.\n * @param {any} value The value to set.\n *\n * @return {T}\n */\nfunction set(target, path, value) {\n\n  let currentTarget = target;\n\n  forEach(path, function(key, idx) {\n\n    if (typeof key !== 'number' && typeof key !== 'string') {\n      throw new Error('illegal key type: ' + typeof key + '. Key should be of type number or string.');\n    }\n\n    if (key === 'constructor') {\n      throw new Error('illegal key: constructor');\n    }\n\n    if (key === '__proto__') {\n      throw new Error('illegal key: __proto__');\n    }\n\n    let nextKey = path[idx + 1];\n    let nextTarget = currentTarget[key];\n\n    if (isDefined(nextKey) && isNil(nextTarget)) {\n      nextTarget = currentTarget[key] = isNaN(+nextKey) ? {} : [];\n    }\n\n    if (isUndefined(nextKey)) {\n      if (isUndefined(value)) {\n        delete currentTarget[key];\n      } else {\n        currentTarget[key] = value;\n      }\n    } else {\n      currentTarget = nextTarget;\n    }\n  });\n\n  return target;\n}\n\n\n/**\n * Gets a nested property of a given object.\n *\n * @param {Object} target The target of the get operation.\n * @param {(string|number)[]} path The path to the nested value.\n * @param {any} [defaultValue] The value to return if no value exists.\n *\n * @return {any}\n */\nfunction get(target, path, defaultValue) {\n\n  let currentTarget = target;\n\n  forEach(path, function(key) {\n\n    // accessing nil property yields <undefined>\n    if (isNil(currentTarget)) {\n      currentTarget = undefined;\n\n      return false;\n    }\n\n    currentTarget = currentTarget[key];\n  });\n\n  return isUndefined(currentTarget) ? defaultValue : currentTarget;\n}\n\n/**\n * Pick properties from the given target.\n *\n * @template T\n * @template {any[]} V\n *\n * @param {T} target\n * @param {V} properties\n *\n * @return Pick<T, V>\n */\nfunction pick(target, properties) {\n\n  let result = {};\n\n  let obj = Object(target);\n\n  forEach(properties, function(prop) {\n\n    if (prop in obj) {\n      result[prop] = target[prop];\n    }\n  });\n\n  return result;\n}\n\n/**\n * Pick all target properties, excluding the given ones.\n *\n * @template T\n * @template {any[]} V\n *\n * @param {T} target\n * @param {V} properties\n *\n * @return {Omit<T, V>} target\n */\nfunction omit(target, properties) {\n\n  let result = {};\n\n  let obj = Object(target);\n\n  forEach(obj, function(prop, key) {\n\n    if (properties.indexOf(key) === -1) {\n      result[key] = prop;\n    }\n  });\n\n  return result;\n}\n\n/**\n * Recursively merge `...sources` into given target.\n *\n * Does support merging objects; does not support merging arrays.\n *\n * @param {Object} target\n * @param {...Object} sources\n *\n * @return {Object} the target\n */\nfunction merge(target, ...sources) {\n\n  if (!sources.length) {\n    return target;\n  }\n\n  forEach(sources, function(source) {\n\n    // skip non-obj sources, i.e. null\n    if (!source || !isObject(source)) {\n      return;\n    }\n\n    forEach(source, function(sourceVal, key) {\n\n      if (key === '__proto__') {\n        return;\n      }\n\n      let targetVal = target[key];\n\n      if (isObject(sourceVal)) {\n\n        if (!isObject(targetVal)) {\n\n          // override target[key] with object\n          targetVal = {};\n        }\n\n        target[key] = merge(targetVal, sourceVal);\n      } else {\n        target[key] = sourceVal;\n      }\n\n    });\n  });\n\n  return target;\n}\n\nexport { assign, bind, debounce, ensureArray, every, filter, find, findIndex, flatten, forEach, get, groupBy, has, isArray, isDefined, isFunction, isNil, isNumber, isObject, isString, isUndefined, keys, map, matchPattern, merge, omit, pick, reduce, set, size, some, sortBy, throttle, unionBy, uniqueBy, values, without };\n","import {\n  create\n} from '../model';\n\nimport { assign } from 'min-dash';\n\n/**\n * @typedef {import('../model/Types').Element} Element\n * @typedef {import('../model/Types').Connection} Connection\n * @typedef {import('../model/Types').Label} Label\n * @typedef {import('../model/Types').Root} Root\n * @typedef {import('../model/Types').Shape} Shape\n */\n\n/**\n * A factory for model elements.\n *\n * @template {Connection} [T=Connection]\n * @template {Label} [U=Label]\n * @template {Root} [V=Root]\n * @template {Shape} [W=Shape]\n */\nexport default function ElementFactory() {\n  this._uid = 12;\n}\n\n/**\n * Create a root element.\n *\n * @param {Partial<Root>} [attrs]\n *\n * @return {V} The created root element.\n */\nElementFactory.prototype.createRoot = function(attrs) {\n  return this.create('root', attrs);\n};\n\n/**\n * Create a label.\n *\n * @param {Partial<Label>} [attrs]\n *\n * @return {U} The created label.\n */\nElementFactory.prototype.createLabel = function(attrs) {\n  return this.create('label', attrs);\n};\n\n/**\n * Create a shape.\n *\n * @param {Partial<Shape>} [attrs]\n *\n * @return {W} The created shape.\n */\nElementFactory.prototype.createShape = function(attrs) {\n  return this.create('shape', attrs);\n};\n\n/**\n * Create a connection.\n *\n * @param {Partial<Connection>} [attrs]\n *\n * @return {T} The created connection.\n */\nElementFactory.prototype.createConnection = function(attrs) {\n  return this.create('connection', attrs);\n};\n\n/**\n * Create a root element.\n *\n * @overlord\n * @param {'root'} type\n * @param {Partial<Root>} [attrs]\n * @return {V}\n */\n/**\n * Create a shape.\n *\n * @overlord\n * @param {'shape'} type\n * @param {Partial<Shape>} [attrs]\n * @return {W}\n */\n/**\n * Create a connection.\n *\n * @overlord\n * @param {'connection'} type\n * @param {Partial<Connection>} [attrs]\n * @return {T}\n */\n/**\n * Create a label.\n *\n * @param {'label'} type\n * @param {Partial<Label>} [attrs]\n * @return {U}\n */\nElementFactory.prototype.create = function(type, attrs) {\n\n  attrs = assign({}, attrs || {});\n\n  if (!attrs.id) {\n    attrs.id = type + '_' + (this._uid++);\n  }\n\n  return create(type, attrs);\n};","var hat = module.exports = function (bits, base) {\n    if (!base) base = 16;\n    if (bits === undefined) bits = 128;\n    if (bits <= 0) return '0';\n    \n    var digits = Math.log(Math.pow(2, bits)) / Math.log(base);\n    for (var i = 2; digits === Infinity; i *= 2) {\n        digits = Math.log(Math.pow(2, bits / i)) / Math.log(base) * i;\n    }\n    \n    var rem = digits - Math.floor(digits);\n    \n    var res = '';\n    \n    for (var i = 0; i < Math.floor(digits); i++) {\n        var x = Math.floor(Math.random() * base).toString(base);\n        res = x + res;\n    }\n    \n    if (rem) {\n        var b = Math.pow(base, rem);\n        var x = Math.floor(Math.random() * b).toString(base);\n        res = x + res;\n    }\n    \n    var parsed = parseInt(res, base);\n    if (parsed !== Infinity && parsed >= Math.pow(2, bits)) {\n        return hat(bits, base)\n    }\n    else return res;\n};\n\nhat.rack = function (bits, base, expandBy) {\n    var fn = function (data) {\n        var iters = 0;\n        do {\n            if (iters ++ > 10) {\n                if (expandBy) bits += expandBy;\n                else throw new Error('too many ID collisions, use more bits')\n            }\n            \n            var id = hat(bits, base);\n        } while (Object.hasOwnProperty.call(hats, id));\n        \n        hats[id] = data;\n        return id;\n    };\n    var hats = fn.hats = {};\n    \n    fn.get = function (id) {\n        return fn.hats[id];\n    };\n    \n    fn.set = function (id, value) {\n        fn.hats[id] = value;\n        return fn;\n    };\n    \n    fn.bits = bits || 128;\n    fn.base = base || 16;\n    return fn;\n};\n","import hat from 'hat';\n\n\n/**\n * Create a new id generator / cache instance.\n *\n * You may optionally provide a seed that is used internally.\n *\n * @param {Seed} seed\n */\nexport default function Ids(seed) {\n\n  if (!(this instanceof Ids)) {\n    return new Ids(seed);\n  }\n\n  seed = seed || [ 128, 36, 1 ];\n  this._seed = seed.length ? hat.rack(seed[0], seed[1], seed[2]) : seed;\n}\n\n/**\n * Generate a next id.\n *\n * @param {Object} [element] element to bind the id to\n *\n * @return {String} id\n */\nIds.prototype.next = function(element) {\n  return this._seed(element || true);\n};\n\n/**\n * Generate a next id with a given prefix.\n *\n * @param {Object} [element] element to bind the id to\n *\n * @return {String} id\n */\nIds.prototype.nextPrefixed = function(prefix, element) {\n  var id;\n\n  do {\n    id = prefix + this.next(true);\n  } while (this.assigned(id));\n\n  // claim {prefix}{random}\n  this.claim(id, element);\n\n  // return\n  return id;\n};\n\n/**\n * Manually claim an existing id.\n *\n * @param {String} id\n * @param {String} [element] element the id is claimed by\n */\nIds.prototype.claim = function(id, element) {\n  this._seed.set(id, element || true);\n};\n\n/**\n * Returns true if the given id has already been assigned.\n *\n * @param  {String} id\n * @return {Boolean}\n */\nIds.prototype.assigned = function(id) {\n  return this._seed.get(id) || false;\n};\n\n/**\n * Unclaim an id.\n *\n * @param  {String} id the id to unclaim\n */\nIds.prototype.unclaim = function(id) {\n  delete this._seed.hats[id];\n};\n\n\n/**\n * Clear all claimed ids.\n */\nIds.prototype.clear = function() {\n\n  var hats = this._seed.hats,\n      id;\n\n  for (id in hats) {\n    this.unclaim(id);\n  }\n};","/**\n * Extends a collection with {@link Refs} aware methods\n *\n * @param {Array<Object>} collection\n * @param {Refs} refs instance\n * @param {Object} property represented by the collection\n * @param {Object} target object the collection is attached to\n *\n * @return {RefsCollection<Object>} the extended array\n */\nfunction extend(collection, refs, property, target) {\n  var inverseProperty = property.inverse;\n\n  /**\n   * Removes the given element from the array and returns it.\n   *\n   * @method RefsCollection#remove\n   *\n   * @param {Object} element the element to remove\n   */\n  Object.defineProperty(collection, 'remove', {\n    value: function (element) {\n      var idx = this.indexOf(element);\n      if (idx !== -1) {\n        this.splice(idx, 1);\n\n        // unset inverse\n        refs.unset(element, inverseProperty, target);\n      }\n      return element;\n    }\n  });\n\n  /**\n   * Returns true if the collection contains the given element\n   *\n   * @method RefsCollection#contains\n   *\n   * @param {Object} element the element to check for\n   */\n  Object.defineProperty(collection, 'contains', {\n    value: function (element) {\n      return this.indexOf(element) !== -1;\n    }\n  });\n\n  /**\n   * Adds an element to the array, unless it exists already (set semantics).\n   *\n   * @method RefsCollection#add\n   *\n   * @param {Object} element the element to add\n   * @param {Number} optional index to add element to\n   *                 (possibly moving other elements around)\n   */\n  Object.defineProperty(collection, 'add', {\n    value: function (element, idx) {\n      var currentIdx = this.indexOf(element);\n      if (typeof idx === 'undefined') {\n        if (currentIdx !== -1) {\n          // element already in collection (!)\n          return;\n        }\n\n        // add to end of array, as no idx is specified\n        idx = this.length;\n      }\n\n      // handle already in collection\n      if (currentIdx !== -1) {\n        // remove element from currentIdx\n        this.splice(currentIdx, 1);\n      }\n\n      // add element at idx\n      this.splice(idx, 0, element);\n      if (currentIdx === -1) {\n        // set inverse, unless element was\n        // in collection already\n        refs.set(element, inverseProperty, target);\n      }\n    }\n  });\n\n  // a simple marker, identifying this element\n  // as being a refs collection\n  Object.defineProperty(collection, '__refs_collection', {\n    value: true\n  });\n  return collection;\n}\n\n/**\n * Checks if a given collection is extended\n *\n * @param {Array<Object>} collection\n *\n * @return {boolean}\n */\nfunction isExtended(collection) {\n  return collection.__refs_collection === true;\n}\n\nvar collection = {\n  __proto__: null,\n  extend: extend,\n  isExtended: isExtended\n};\n\nfunction hasOwnProperty(e, property) {\n  return Object.prototype.hasOwnProperty.call(e, property.name || property);\n}\nfunction defineCollectionProperty(ref, property, target) {\n  var collection = extend(target[property.name] || [], ref, property, target);\n  Object.defineProperty(target, property.name, {\n    enumerable: property.enumerable,\n    value: collection\n  });\n  if (collection.length) {\n    collection.forEach(function (o) {\n      ref.set(o, property.inverse, target);\n    });\n  }\n}\nfunction defineProperty(ref, property, target) {\n  var inverseProperty = property.inverse;\n  var _value = target[property.name];\n  Object.defineProperty(target, property.name, {\n    configurable: property.configurable,\n    enumerable: property.enumerable,\n    get: function () {\n      return _value;\n    },\n    set: function (value) {\n      // return if we already performed all changes\n      if (value === _value) {\n        return;\n      }\n      var old = _value;\n\n      // temporary set null\n      _value = null;\n      if (old) {\n        ref.unset(old, inverseProperty, target);\n      }\n\n      // set new value\n      _value = value;\n\n      // set inverse value\n      ref.set(_value, inverseProperty, target);\n    }\n  });\n}\n\n/**\n * Creates a new references object defining two inversly related\n * attribute descriptors a and b.\n *\n * <p>\n *   When bound to an object using {@link Refs#bind} the references\n *   get activated and ensure that add and remove operations are applied\n *   reversely, too.\n * </p>\n *\n * <p>\n *   For attributes represented as collections {@link Refs} provides the\n *   {@link RefsCollection#add}, {@link RefsCollection#remove} and {@link RefsCollection#contains} extensions\n *   that must be used to properly hook into the inverse change mechanism.\n * </p>\n *\n * @class Refs\n *\n * @classdesc A bi-directional reference between two attributes.\n *\n * @param {Refs.AttributeDescriptor} a property descriptor\n * @param {Refs.AttributeDescriptor} b property descriptor\n *\n * @example\n *\n * var refs = Refs({ name: 'wheels', collection: true, enumerable: true }, { name: 'car' });\n *\n * var car = { name: 'toyota' };\n * var wheels = [{ pos: 'front-left' }, { pos: 'front-right' }];\n *\n * refs.bind(car, 'wheels');\n *\n * car.wheels // []\n * car.wheels.add(wheels[0]);\n * car.wheels.add(wheels[1]);\n *\n * car.wheels // [{ pos: 'front-left' }, { pos: 'front-right' }]\n *\n * wheels[0].car // { name: 'toyota' };\n * car.wheels.remove(wheels[0]);\n *\n * wheels[0].car // undefined\n */\nfunction Refs(a, b) {\n  if (!(this instanceof Refs)) {\n    return new Refs(a, b);\n  }\n\n  // link\n  a.inverse = b;\n  b.inverse = a;\n  this.props = {};\n  this.props[a.name] = a;\n  this.props[b.name] = b;\n}\n\n/**\n * Binds one side of a bi-directional reference to a\n * target object.\n *\n * @memberOf Refs\n *\n * @param  {Object} target\n * @param  {String} property\n */\nRefs.prototype.bind = function (target, property) {\n  if (typeof property === 'string') {\n    if (!this.props[property]) {\n      throw new Error('no property <' + property + '> in ref');\n    }\n    property = this.props[property];\n  }\n  if (property.collection) {\n    defineCollectionProperty(this, property, target);\n  } else {\n    defineProperty(this, property, target);\n  }\n};\nRefs.prototype.ensureRefsCollection = function (target, property) {\n  var collection = target[property.name];\n  if (!isExtended(collection)) {\n    defineCollectionProperty(this, property, target);\n  }\n  return collection;\n};\nRefs.prototype.ensureBound = function (target, property) {\n  if (!hasOwnProperty(target, property)) {\n    this.bind(target, property);\n  }\n};\nRefs.prototype.unset = function (target, property, value) {\n  if (target) {\n    this.ensureBound(target, property);\n    if (property.collection) {\n      this.ensureRefsCollection(target, property).remove(value);\n    } else {\n      target[property.name] = undefined;\n    }\n  }\n};\nRefs.prototype.set = function (target, property, value) {\n  if (target) {\n    this.ensureBound(target, property);\n    if (property.collection) {\n      this.ensureRefsCollection(target, property).add(value);\n    } else {\n      target[property.name] = value;\n    }\n  }\n};\n\n/**\n * An attribute descriptor to be used specify an attribute in a {@link Refs} instance\n *\n * @typedef {Object} Refs.AttributeDescriptor\n * @property {String} name\n * @property {boolean} [collection=false]\n * @property {boolean} [enumerable=false]\n */\n\nexport { collection as Collection, Refs };\n","import { assign } from 'min-dash';\nimport inherits from 'inherits-browser';\n\nimport { Refs } from 'object-refs';\n\nvar parentRefs = new Refs({ name: 'children', enumerable: true, collection: true }, { name: 'parent' }),\n    labelRefs = new Refs({ name: 'labels', enumerable: true, collection: true }, { name: 'labelTarget' }),\n    attacherRefs = new Refs({ name: 'attachers', collection: true }, { name: 'host' }),\n    outgoingRefs = new Refs({ name: 'outgoing', collection: true }, { name: 'source' }),\n    incomingRefs = new Refs({ name: 'incoming', collection: true }, { name: 'target' });\n\n/**\n * @typedef {import('./Types').Element} Element\n * @typedef {import('./Types').Shape} Shape\n * @typedef {import('./Types').Root} Root\n * @typedef {import('./Types').Label} Label\n * @typedef {import('./Types').Connection} Connection\n */\n\n/**\n * The basic graphical representation\n *\n * @class\n * @constructor\n */\nfunction ElementImpl() {\n\n  /**\n   * The object that backs up the shape\n   *\n   * @name Element#businessObject\n   * @type Object\n   */\n  Object.defineProperty(this, 'businessObject', {\n    writable: true\n  });\n\n\n  /**\n   * Single label support, will mapped to multi label array\n   *\n   * @name Element#label\n   * @type Object\n   */\n  Object.defineProperty(this, 'label', {\n    get: function() {\n      return this.labels[0];\n    },\n    set: function(newLabel) {\n\n      var label = this.label,\n          labels = this.labels;\n\n      if (!newLabel && label) {\n        labels.remove(label);\n      } else {\n        labels.add(newLabel, 0);\n      }\n    }\n  });\n\n  /**\n   * The parent shape\n   *\n   * @name Element#parent\n   * @type Shape\n   */\n  parentRefs.bind(this, 'parent');\n\n  /**\n   * The list of labels\n   *\n   * @name Element#labels\n   * @type Label\n   */\n  labelRefs.bind(this, 'labels');\n\n  /**\n   * The list of outgoing connections\n   *\n   * @name Element#outgoing\n   * @type Array<Connection>\n   */\n  outgoingRefs.bind(this, 'outgoing');\n\n  /**\n   * The list of incoming connections\n   *\n   * @name Element#incoming\n   * @type Array<Connection>\n   */\n  incomingRefs.bind(this, 'incoming');\n}\n\n\n/**\n * A graphical object\n *\n * @class\n * @constructor\n *\n * @extends ElementImpl\n */\nfunction ShapeImpl() {\n  ElementImpl.call(this);\n\n  /**\n   * Indicates frame shapes\n   *\n   * @name ShapeImpl#isFrame\n   * @type boolean\n   */\n\n  /**\n   * The list of children\n   *\n   * @name ShapeImpl#children\n   * @type Element[]\n   */\n  parentRefs.bind(this, 'children');\n\n  /**\n   * @name ShapeImpl#host\n   * @type Shape\n   */\n  attacherRefs.bind(this, 'host');\n\n  /**\n   * @name ShapeImpl#attachers\n   * @type Shape\n   */\n  attacherRefs.bind(this, 'attachers');\n}\n\ninherits(ShapeImpl, ElementImpl);\n\n\n/**\n * A root graphical object\n *\n * @class\n * @constructor\n *\n * @extends ElementImpl\n */\nfunction RootImpl() {\n  ElementImpl.call(this);\n\n  /**\n   * The list of children\n   *\n   * @name RootImpl#children\n   * @type Element[]\n   */\n  parentRefs.bind(this, 'children');\n}\n\ninherits(RootImpl, ShapeImpl);\n\n\n/**\n * A label for an element\n *\n * @class\n * @constructor\n *\n * @extends ShapeImpl\n */\nfunction LabelImpl() {\n  ShapeImpl.call(this);\n\n  /**\n   * The labeled element\n   *\n   * @name LabelImpl#labelTarget\n   * @type Element\n   */\n  labelRefs.bind(this, 'labelTarget');\n}\n\ninherits(LabelImpl, ShapeImpl);\n\n\n/**\n * A connection between two elements\n *\n * @class\n * @constructor\n *\n * @extends ElementImpl\n */\nfunction ConnectionImpl() {\n  ElementImpl.call(this);\n\n  /**\n   * The element this connection originates from\n   *\n   * @name ConnectionImpl#source\n   * @type Element\n   */\n  outgoingRefs.bind(this, 'source');\n\n  /**\n   * The element this connection points to\n   *\n   * @name ConnectionImpl#target\n   * @type Element\n   */\n  incomingRefs.bind(this, 'target');\n}\n\ninherits(ConnectionImpl, ElementImpl);\n\n\nvar types = {\n  connection: ConnectionImpl,\n  shape: ShapeImpl,\n  label: LabelImpl,\n  root: RootImpl\n};\n\n/**\n * Creates a root element.\n *\n * @overlord\n *\n * @example\n *\n * ```javascript\n * import * as Model from 'diagram-js/lib/model';\n *\n * const root = Model.create('root', {\n *   x: 100,\n *   y: 100,\n *   width: 100,\n *   height: 100\n * });\n * ```\n *\n * @param {'root'} type\n * @param {any} [attrs]\n *\n * @return {Root}\n */\n\n/**\n * Creates a connection.\n *\n * @overlord\n *\n * @example\n *\n * ```javascript\n * import * as Model from 'diagram-js/lib/model';\n *\n * const connection = Model.create('connection', {\n *   waypoints: [\n *     { x: 100, y: 100 },\n *     { x: 200, y: 100 }\n *   ]\n * });\n * ```\n *\n * @param {'connection'} type\n * @param {any} [attrs]\n *\n * @return {Connection}\n */\n\n/**\n * Creates a shape.\n *\n * @overlord\n *\n * @example\n *\n * ```javascript\n * import * as Model from 'diagram-js/lib/model';\n *\n * const shape = Model.create('shape', {\n *   x: 100,\n *   y: 100,\n *   width: 100,\n *   height: 100\n * });\n * ```\n *\n * @param {'shape'} type\n * @param {any} [attrs]\n *\n * @return {Shape}\n */\n\n/**\n * Creates a label.\n *\n * @example\n *\n * ```javascript\n * import * as Model from 'diagram-js/lib/model';\n *\n * const label = Model.create('label', {\n *   x: 100,\n *   y: 100,\n *   width: 100,\n *   height: 100,\n *   labelTarget: shape\n * });\n * ```\n *\n * @param {'label'} type\n * @param {Object} [attrs]\n *\n * @return {Label}\n */\nexport function create(type, attrs) {\n  var Type = types[type];\n  if (!Type) {\n    throw new Error('unknown type: <' + type + '>');\n  }\n  return assign(new Type(), attrs);\n}\n\n/**\n * Checks whether an object is a model instance.\n *\n * @param {any} obj\n *\n * @return {boolean}\n */\nexport function isModelElement(obj) {\n  return obj instanceof ElementImpl;\n}","import {\n  classes as domClasses\n} from 'min-dom';\n\nvar CURSOR_CLS_PATTERN = /^djs-cursor-.*$/;\n\n/**\n * @param {string} mode\n */\nexport function set(mode) {\n  var classes = domClasses(document.body);\n\n  classes.removeMatching(CURSOR_CLS_PATTERN);\n\n  if (mode) {\n    classes.add('djs-cursor-' + mode);\n  }\n}\n\nexport function unset() {\n  set(null);\n}\n\n/**\n * @param {string} mode\n *\n * @return {boolean}\n */\nexport function has(mode) {\n  var classes = domClasses(document.body);\n\n  return classes.has('djs-cursor-' + mode);\n}\n","export default function inherits(ctor, superCtor) {\n  if (superCtor) {\n    ctor.super_ = superCtor\n    ctor.prototype = Object.create(superCtor.prototype, {\n      constructor: {\n        value: ctor,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    })\n  }\n};","/**\n * SVGs for elements are generated by the {@link GraphicsFactory}.\n *\n * This utility gives quick access to the important semantic\n * parts of an element.\n */\n\n/**\n * Returns the visual part of a diagram element.\n *\n * @param {SVGElement} gfx\n *\n * @return {SVGElement}\n */\nexport function getVisual(gfx) {\n  return gfx.childNodes[0];\n}\n\n/**\n * Returns the children for a given diagram element.\n *\n * @param {SVGElement} gfx\n * @return {SVGElement}\n */\nexport function getChildren(gfx) {\n  return gfx.parentNode.childNodes[1];\n}","export function isMac() {\n  return (/mac/i).test(navigator.platform);\n}","/**\n * @typedef {import('../util/Types').Point} Point\n */\n\nfunction __stopPropagation(event) {\n  if (!event || typeof event.stopPropagation !== 'function') {\n    return;\n  }\n\n  event.stopPropagation();\n}\n\n/**\n * @param {import('../core/EventBus').Event} event\n *\n * @return {Event}\n */\nexport function getOriginal(event) {\n  return event.originalEvent || event.srcEvent;\n}\n\n/**\n * @param {Event|import('../core/EventBus').Event} event\n */\nexport function stopPropagation(event) {\n  __stopPropagation(event);\n  __stopPropagation(getOriginal(event));\n}\n\n/**\n * @param {Event} event\n *\n * @return {Point|null}\n */\nexport function toPoint(event) {\n\n  if (event.pointers && event.pointers.length) {\n    event = event.pointers[0];\n  }\n\n  if (event.touches && event.touches.length) {\n    event = event.touches[0];\n  }\n\n  return event ? {\n    x: event.clientX,\n    y: event.clientY\n  } : null;\n}","const CLASS_PATTERN = /^class[ {]/;\n\n\n/**\n * @param {function} fn\n *\n * @return {boolean}\n */\nexport function isClass(fn) {\n  return CLASS_PATTERN.test(fn.toString());\n}\n\n/**\n * @param {any} obj\n *\n * @return {boolean}\n */\nexport function isArray(obj) {\n  return Array.isArray(obj);\n}\n\n/**\n * @param {any} obj\n * @param {string} prop\n *\n * @return {boolean}\n */\nexport function hasOwnProp(obj, prop) {\n  return Object.prototype.hasOwnProperty.call(obj, prop);\n}","import {\n  isArray,\n  isClass\n} from './util.js';\n\n/**\n * @typedef {import('./index.js').InjectAnnotated } InjectAnnotated\n */\n\n/**\n * @template T\n *\n * @params {[...string[], T] | ...string[], T} args\n *\n * @return {T & InjectAnnotated}\n */\nexport function annotate(...args) {\n\n  if (args.length === 1 && isArray(args[0])) {\n    args = args[0];\n  }\n\n  args = [ ...args ];\n\n  const fn = args.pop();\n\n  fn.$inject = args;\n\n  return fn;\n}\n\n\n// Current limitations:\n// - can't put into \"function arg\" comments\n// function /* (no parenthesis like this) */ (){}\n// function abc( /* xx (no parenthesis like this) */ a, b) {}\n//\n// Just put the comment before function or inside:\n// /* (((this is fine))) */ function(a, b) {}\n// function abc(a) { /* (((this is fine))) */}\n//\n// - can't reliably auto-annotate constructor; we'll match the\n// first constructor(...) pattern found which may be the one\n// of a nested class, too.\n\nconst CONSTRUCTOR_ARGS = /constructor\\s*[^(]*\\(\\s*([^)]*)\\)/m;\nconst FN_ARGS = /^(?:async\\s+)?(?:function\\s*[^(]*)?(?:\\(\\s*([^)]*)\\)|(\\w+))/m;\nconst FN_ARG = /\\/\\*([^*]*)\\*\\//m;\n\n/**\n * @param {unknown} fn\n *\n * @return {string[]}\n */\nexport function parseAnnotations(fn) {\n\n  if (typeof fn !== 'function') {\n    throw new Error(`Cannot annotate \"${fn}\". Expected a function!`);\n  }\n\n  const match = fn.toString().match(isClass(fn) ? CONSTRUCTOR_ARGS : FN_ARGS);\n\n  // may parse class without constructor\n  if (!match) {\n    return [];\n  }\n\n  const args = match[1] || match[2];\n\n  return args && args.split(',').map(arg => {\n    const argMatch = arg.match(FN_ARG);\n    return (argMatch && argMatch[1] || arg).trim();\n  }) || [];\n}","import {\n  parseAnnotations,\n  annotate\n} from './annotation.js';\n\nimport {\n  isArray,\n  hasOwnProp\n} from './util.js';\n\n/**\n * @typedef { import('./index.js').ModuleDeclaration } ModuleDeclaration\n * @typedef { import('./index.js').ModuleDefinition } ModuleDefinition\n * @typedef { import('./index.js').InjectorContext } InjectorContext\n *\n * @typedef { import('./index.js').TypedDeclaration<any, any> } TypedDeclaration\n */\n\n/**\n * Create a new injector with the given modules.\n *\n * @param {ModuleDefinition[]} modules\n * @param {InjectorContext} [_parent]\n */\nexport default function Injector(modules, _parent) {\n\n  const parent = _parent || /** @type InjectorContext */ ({\n    get: function(name, strict) {\n      currentlyResolving.push(name);\n\n      if (strict === false) {\n        return null;\n      } else {\n        throw error(`No provider for \"${ name }\"!`);\n      }\n    }\n  });\n\n  const currentlyResolving = [];\n  const providers = this._providers = Object.create(parent._providers || null);\n  const instances = this._instances = Object.create(null);\n\n  const self = instances.injector = this;\n\n  const error = function(msg) {\n    const stack = currentlyResolving.join(' -> ');\n    currentlyResolving.length = 0;\n    return new Error(stack ? `${ msg } (Resolving: ${ stack })` : msg);\n  };\n\n  /**\n   * Return a named service.\n   *\n   * @param {string} name\n   * @param {boolean} [strict=true] if false, resolve missing services to null\n   *\n   * @return {any}\n   */\n  function get(name, strict) {\n    if (!providers[name] && name.includes('.')) {\n\n      const parts = name.split('.');\n      let pivot = get(/** @type { string } */ (parts.shift()));\n\n      while (parts.length) {\n        pivot = pivot[/** @type { string } */ (parts.shift())];\n      }\n\n      return pivot;\n    }\n\n    if (hasOwnProp(instances, name)) {\n      return instances[name];\n    }\n\n    if (hasOwnProp(providers, name)) {\n      if (currentlyResolving.indexOf(name) !== -1) {\n        currentlyResolving.push(name);\n        throw error('Cannot resolve circular dependency!');\n      }\n\n      currentlyResolving.push(name);\n      instances[name] = providers[name][0](providers[name][1]);\n      currentlyResolving.pop();\n\n      return instances[name];\n    }\n\n    return parent.get(name, strict);\n  }\n\n  function fnDef(fn, locals) {\n\n    if (typeof locals === 'undefined') {\n      locals = {};\n    }\n\n    if (typeof fn !== 'function') {\n      if (isArray(fn)) {\n        fn = annotate(fn.slice());\n      } else {\n        throw error(`Cannot invoke \"${ fn }\". Expected a function!`);\n      }\n    }\n\n    /**\n     * @type {string[]}\n     */\n    const inject = fn.$inject || parseAnnotations(fn);\n    const dependencies = inject.map(dep => {\n      if (hasOwnProp(locals, dep)) {\n        return locals[dep];\n      } else {\n        return get(dep);\n      }\n    });\n\n    return {\n      fn: fn,\n      dependencies\n    };\n  }\n\n  /**\n   * Instantiate the given type, injecting dependencies.\n   *\n   * @template T\n   *\n   * @param { Function | [...string[], Function ]} type\n   *\n   * @return T\n   */\n  function instantiate(type) {\n    const {\n      fn,\n      dependencies\n    } = fnDef(type);\n\n    // instantiate var args constructor\n    const Constructor = Function.prototype.bind.call(fn, null, ...dependencies);\n\n    return new Constructor();\n  }\n\n  /**\n   * Invoke the given function, injecting dependencies. Return the result.\n   *\n   * @template T\n   *\n   * @param { Function | [...string[], Function ]} func\n   * @param { Object } [context]\n   * @param { Object } [locals]\n   *\n   * @return {T} invocation result\n   */\n  function invoke(func, context, locals) {\n    const {\n      fn,\n      dependencies\n    } = fnDef(func, locals);\n\n    return fn.apply(context, dependencies);\n  }\n\n  /**\n   * @param {Injector} childInjector\n   *\n   * @return {Function}\n   */\n  function createPrivateInjectorFactory(childInjector) {\n    return annotate(key => childInjector.get(key));\n  }\n\n  /**\n   * @param {ModuleDefinition[]} modules\n   * @param {string[]} [forceNewInstances]\n   *\n   * @return {Injector}\n   */\n  function createChild(modules, forceNewInstances) {\n    if (forceNewInstances && forceNewInstances.length) {\n      const fromParentModule = Object.create(null);\n      const matchedScopes = Object.create(null);\n\n      const privateInjectorsCache = [];\n      const privateChildInjectors = [];\n      const privateChildFactories = [];\n\n      let provider;\n      let cacheIdx;\n      let privateChildInjector;\n      let privateChildInjectorFactory;\n\n      for (let name in providers) {\n        provider = providers[name];\n\n        if (forceNewInstances.indexOf(name) !== -1) {\n          if (provider[2] === 'private') {\n            cacheIdx = privateInjectorsCache.indexOf(provider[3]);\n            if (cacheIdx === -1) {\n              privateChildInjector = provider[3].createChild([], forceNewInstances);\n              privateChildInjectorFactory = createPrivateInjectorFactory(privateChildInjector);\n              privateInjectorsCache.push(provider[3]);\n              privateChildInjectors.push(privateChildInjector);\n              privateChildFactories.push(privateChildInjectorFactory);\n              fromParentModule[name] = [ privateChildInjectorFactory, name, 'private', privateChildInjector ];\n            } else {\n              fromParentModule[name] = [ privateChildFactories[cacheIdx], name, 'private', privateChildInjectors[cacheIdx] ];\n            }\n          } else {\n            fromParentModule[name] = [ provider[2], provider[1] ];\n          }\n          matchedScopes[name] = true;\n        }\n\n        if ((provider[2] === 'factory' || provider[2] === 'type') && provider[1].$scope) {\n          /* jshint -W083 */\n          forceNewInstances.forEach(scope => {\n            if (provider[1].$scope.indexOf(scope) !== -1) {\n              fromParentModule[name] = [ provider[2], provider[1] ];\n              matchedScopes[scope] = true;\n            }\n          });\n        }\n      }\n\n      forceNewInstances.forEach(scope => {\n        if (!matchedScopes[scope]) {\n          throw new Error('No provider for \"' + scope + '\". Cannot use provider from the parent!');\n        }\n      });\n\n      modules.unshift(fromParentModule);\n    }\n\n    return new Injector(modules, self);\n  }\n\n  const factoryMap = {\n    factory: invoke,\n    type: instantiate,\n    value: function(value) {\n      return value;\n    }\n  };\n\n  /**\n   * @param {ModuleDefinition} moduleDefinition\n   * @param {Injector} injector\n   */\n  function createInitializer(moduleDefinition, injector) {\n\n    const initializers = moduleDefinition.__init__ || [];\n\n    return function() {\n      initializers.forEach(initializer => {\n\n        // eagerly resolve component (fn or string)\n        if (typeof initializer === 'string') {\n          injector.get(initializer);\n        } else {\n          injector.invoke(initializer);\n        }\n      });\n    };\n  }\n\n  /**\n   * @param {ModuleDefinition} moduleDefinition\n   */\n  function loadModule(moduleDefinition) {\n\n    const moduleExports = moduleDefinition.__exports__;\n\n    // private module\n    if (moduleExports) {\n      const nestedModules = moduleDefinition.__modules__;\n\n      const clonedModule = Object.keys(moduleDefinition).reduce((clonedModule, key) => {\n\n        if (key !== '__exports__' && key !== '__modules__' && key !== '__init__' && key !== '__depends__') {\n          clonedModule[key] = moduleDefinition[key];\n        }\n\n        return clonedModule;\n      }, Object.create(null));\n\n      const childModules = (nestedModules || []).concat(clonedModule);\n\n      const privateInjector = createChild(childModules);\n      const getFromPrivateInjector = annotate(function(key) {\n        return privateInjector.get(key);\n      });\n\n      moduleExports.forEach(function(key) {\n        providers[key] = [ getFromPrivateInjector, key, 'private', privateInjector ];\n      });\n\n      // ensure child injector initializes\n      const initializers = (moduleDefinition.__init__ || []).slice();\n\n      initializers.unshift(function() {\n        privateInjector.init();\n      });\n\n      moduleDefinition = Object.assign({}, moduleDefinition, {\n        __init__: initializers\n      });\n\n      return createInitializer(moduleDefinition, privateInjector);\n    }\n\n    // normal module\n    Object.keys(moduleDefinition).forEach(function(key) {\n\n      if (key === '__init__' || key === '__depends__') {\n        return;\n      }\n\n      const typeDeclaration = /** @type { TypedDeclaration } */ (\n        moduleDefinition[key]\n      );\n\n      if (typeDeclaration[2] === 'private') {\n        providers[key] = typeDeclaration;\n        return;\n      }\n\n      const type = typeDeclaration[0];\n      const value = typeDeclaration[1];\n\n      providers[key] = [ factoryMap[type], arrayUnwrap(type, value), type ];\n    });\n\n    return createInitializer(moduleDefinition, self);\n  }\n\n  /**\n   * @param {ModuleDefinition[]} moduleDefinitions\n   * @param {ModuleDefinition} moduleDefinition\n   *\n   * @return {ModuleDefinition[]}\n   */\n  function resolveDependencies(moduleDefinitions, moduleDefinition) {\n\n    if (moduleDefinitions.indexOf(moduleDefinition) !== -1) {\n      return moduleDefinitions;\n    }\n\n    moduleDefinitions = (moduleDefinition.__depends__ || []).reduce(resolveDependencies, moduleDefinitions);\n\n    if (moduleDefinitions.indexOf(moduleDefinition) !== -1) {\n      return moduleDefinitions;\n    }\n\n    return moduleDefinitions.concat(moduleDefinition);\n  }\n\n  /**\n   * @param {ModuleDefinition[]} moduleDefinitions\n   *\n   * @return { () => void } initializerFn\n   */\n  function bootstrap(moduleDefinitions) {\n\n    const initializers = moduleDefinitions\n      .reduce(resolveDependencies, [])\n      .map(loadModule);\n\n    let initialized = false;\n\n    return function() {\n\n      if (initialized) {\n        return;\n      }\n\n      initialized = true;\n\n      initializers.forEach(initializer => initializer());\n    };\n  }\n\n  // public API\n  this.get = get;\n  this.invoke = invoke;\n  this.instantiate = instantiate;\n  this.createChild = createChild;\n\n  // setup\n  this.init = bootstrap(modules);\n}\n\n\n// helpers ///////////////\n\nfunction arrayUnwrap(type, value) {\n  if (type !== 'value' && isArray(value)) {\n    value = annotate(value.slice());\n  }\n\n  return value;\n}","import inherits from 'inherits-browser';\n\nimport BaseRenderer from './BaseRenderer';\n\nimport {\n  componentsToPath,\n  createLine\n} from '../util/RenderUtil';\n\nimport {\n  append as svgAppend,\n  attr as svgAttr,\n  create as svgCreate\n} from 'tiny-svg';\n\nimport { assign } from 'min-dash';\n\nimport {\n  isFrameElement\n} from '../util/Elements';\n\n/**\n * @typedef {import('../core/EventBus').default} EventBus\n * @typedef {import('./Styles').default} Styles\n */\n\n// apply default renderer with lowest possible priority\n// so that it only kicks in if noone else could render\nvar DEFAULT_RENDER_PRIORITY = 1;\n\n/**\n * The default renderer used for shapes and connections.\n *\n * @param {EventBus} eventBus\n * @param {Styles} styles\n */\nexport default function DefaultRenderer(eventBus, styles) {\n\n  BaseRenderer.call(this, eventBus, DEFAULT_RENDER_PRIORITY);\n\n  this.CONNECTION_STYLE = styles.style([ 'no-fill' ], { strokeWidth: 5, stroke: 'fuchsia' });\n  this.SHAPE_STYLE = styles.style({ fill: 'white', stroke: 'fuchsia', strokeWidth: 2 });\n  this.FRAME_STYLE = styles.style([ 'no-fill' ], { stroke: 'fuchsia', strokeDasharray: 4, strokeWidth: 2 });\n}\n\ninherits(DefaultRenderer, BaseRenderer);\n\n\n/**\n * @private\n */\nDefaultRenderer.prototype.canRender = function() {\n  return true;\n};\n\n/**\n * @private\n */\nDefaultRenderer.prototype.drawShape = function drawShape(visuals, element, attrs) {\n  var rect = svgCreate('rect');\n\n  svgAttr(rect, {\n    x: 0,\n    y: 0,\n    width: element.width || 0,\n    height: element.height || 0\n  });\n\n  if (isFrameElement(element)) {\n    svgAttr(rect, assign({}, this.FRAME_STYLE, attrs || {}));\n  } else {\n    svgAttr(rect, assign({}, this.SHAPE_STYLE, attrs || {}));\n  }\n\n  svgAppend(visuals, rect);\n\n  return rect;\n};\n\n/**\n * @private\n */\nDefaultRenderer.prototype.drawConnection = function drawConnection(visuals, connection, attrs) {\n\n  var line = createLine(connection.waypoints, assign({}, this.CONNECTION_STYLE, attrs || {}));\n  svgAppend(visuals, line);\n\n  return line;\n};\n\n/**\n * @private\n */\nDefaultRenderer.prototype.getShapePath = function getShapePath(shape) {\n\n  var x = shape.x,\n      y = shape.y,\n      width = shape.width,\n      height = shape.height;\n\n  var shapePath = [\n    [ 'M', x, y ],\n    [ 'l', width, 0 ],\n    [ 'l', 0, height ],\n    [ 'l', -width, 0 ],\n    [ 'z' ]\n  ];\n\n  return componentsToPath(shapePath);\n};\n\n/**\n * @private\n */\nDefaultRenderer.prototype.getConnectionPath = function getConnectionPath(connection) {\n  var waypoints = connection.waypoints;\n\n  var idx, point, connectionPath = [];\n\n  for (idx = 0; (point = waypoints[idx]); idx++) {\n\n    // take invisible docking into account\n    // when creating the path\n    point = point.original || point;\n\n    connectionPath.push([ idx === 0 ? 'M' : 'L', point.x, point.y ]);\n  }\n\n  return componentsToPath(connectionPath);\n};\n\nDefaultRenderer.$inject = [ 'eventBus', 'styles' ];\n","import DefaultRenderer from './DefaultRenderer';\nimport Styles from './Styles';\n\n/**\n * @type { import('didi').ModuleDeclaration }\n */\nexport default {\n  __init__: [ 'defaultRenderer' ],\n  defaultRenderer: [ 'type', DefaultRenderer ],\n  styles: [ 'type', Styles ]\n};\n","import {\n  isArray,\n  assign,\n  reduce\n} from 'min-dash';\n\n\n/**\n * A component that manages shape styles\n */\nexport default function Styles() {\n\n  var defaultTraits = {\n\n    'no-fill': {\n      fill: 'none'\n    },\n    'no-border': {\n      strokeOpacity: 0.0\n    },\n    'no-events': {\n      pointerEvents: 'none'\n    }\n  };\n\n  var self = this;\n\n  /**\n   * Builds a style definition from a className, a list of traits and an object\n   * of additional attributes.\n   *\n   * @param {string} className\n   * @param {string[]} [traits]\n   * @param {Object} [additionalAttrs]\n   *\n   * @return {Object} the style definition\n   */\n  this.cls = function(className, traits, additionalAttrs) {\n    var attrs = this.style(traits, additionalAttrs);\n\n    return assign(attrs, { 'class': className });\n  };\n\n  /**\n   * Builds a style definition from a list of traits and an object of additional\n   * attributes.\n   *\n   * @param {string[]} [traits]\n   * @param {Object} additionalAttrs\n   *\n   * @return {Object} the style definition\n   */\n  this.style = function(traits, additionalAttrs) {\n\n    if (!isArray(traits) && !additionalAttrs) {\n      additionalAttrs = traits;\n      traits = [];\n    }\n\n    var attrs = reduce(traits, function(attrs, t) {\n      return assign(attrs, defaultTraits[t] || {});\n    }, {});\n\n    return additionalAttrs ? assign(attrs, additionalAttrs) : attrs;\n  };\n\n\n  /**\n   * Computes a style definition from a list of traits and an object of\n   * additional attributes, with custom style definition object.\n   *\n   * @param {Object} custom\n   * @param {string[]} [traits]\n   * @param {Object} defaultStyles\n   *\n   * @return {Object} the style definition\n   */\n  this.computeStyle = function(custom, traits, defaultStyles) {\n    if (!isArray(traits)) {\n      defaultStyles = traits;\n      traits = [];\n    }\n\n    return self.style(traits || [], assign({}, defaultStyles, custom || {}));\n  };\n}\n","import {\n  isNumber,\n  assign,\n  forEach,\n  every,\n  debounce,\n  bind,\n  reduce,\n  find\n} from 'min-dash';\n\nimport {\n  assignStyle,\n  attr as domAttr\n} from 'min-dom';\n\nimport {\n  add as collectionAdd,\n  remove as collectionRemove\n} from '../util/Collections';\n\nimport {\n  getType,\n  getBBox as getBoundingBox\n} from '../util/Elements';\n\nimport { asTRBL } from '../layout/LayoutUtil';\n\nimport {\n  append as svgAppend,\n  attr as svgAttr,\n  classes as svgClasses,\n  create as svgCreate,\n  transform as svgTransform,\n  remove as svgRemove\n} from 'tiny-svg';\n\nimport { createMatrix as createMatrix } from 'tiny-svg';\n\n\n/**\n * @typedef {import('./Types').ConnectionLike} ConnectionLike\n * @typedef {import('./Types').RootLike} RootLike\n * @typedef {import('./Types').ParentLike } ParentLike\n * @typedef {import('./Types').ShapeLike} ShapeLike\n *\n * @typedef { {\n *   container?: HTMLElement;\n *   deferUpdate?: boolean;\n *   width?: number;\n *   height?: number;\n *   autoFocus?: boolean;\n * } } CanvasConfig\n * @typedef { {\n *   group: SVGElement;\n *   index: number;\n *   visible: boolean;\n * } } CanvasLayer\n * @typedef { {\n *   [key: string]: CanvasLayer;\n * } } CanvasLayers\n * @typedef { {\n *   rootElement: ShapeLike;\n *   layer: CanvasLayer;\n * } } CanvasPlane\n * @typedef { {\n *   scale: number;\n *   inner: Rect;\n *   outer: Dimensions;\n * } & Rect } CanvasViewbox\n *\n * @typedef {import('./ElementRegistry').default} ElementRegistry\n * @typedef {import('./EventBus').default} EventBus\n * @typedef {import('./GraphicsFactory').default} GraphicsFactory\n *\n * @typedef {import('../util/Types').Dimensions} Dimensions\n * @typedef {import('../util/Types').Point} Point\n * @typedef {import('../util/Types').Rect} Rect\n * @typedef {import('../util/Types').RectTRBL} RectTRBL\n * @typedef {import('../util/Types').ScrollDelta} ScrollDelta\n */\n\nfunction round(number, resolution) {\n  return Math.round(number * resolution) / resolution;\n}\n\nfunction ensurePx(number) {\n  return isNumber(number) ? number + 'px' : number;\n}\n\nfunction findRoot(element) {\n  while (element.parent) {\n    element = element.parent;\n  }\n\n  return element;\n}\n\n/**\n * Creates a HTML container element for a SVG element with\n * the given configuration\n *\n * @param {CanvasConfig} options\n *\n * @return {HTMLElement} the container element\n */\nfunction createContainer(options) {\n\n  options = assign({}, { width: '100%', height: '100%' }, options);\n\n  const container = options.container || document.body;\n\n  // create a <div> around the svg element with the respective size\n  // this way we can always get the correct container size\n  // (this is impossible for <svg> elements at the moment)\n  const parent = document.createElement('div');\n  parent.setAttribute('class', 'djs-container djs-parent');\n\n  assignStyle(parent, {\n    position: 'relative',\n    overflow: 'hidden',\n    width: ensurePx(options.width),\n    height: ensurePx(options.height)\n  });\n\n  container.appendChild(parent);\n\n  return parent;\n}\n\nfunction createGroup(parent, cls, childIndex) {\n  const group = svgCreate('g');\n  svgClasses(group).add(cls);\n\n  const index = childIndex !== undefined ? childIndex : parent.childNodes.length - 1;\n\n  // must ensure second argument is node or _null_\n  // cf. https://developer.mozilla.org/en-US/docs/Web/API/Node/insertBefore\n  parent.insertBefore(group, parent.childNodes[index] || null);\n\n  return group;\n}\n\nconst BASE_LAYER = 'base';\n\n// render plane contents behind utility layers\nconst PLANE_LAYER_INDEX = 0;\nconst UTILITY_LAYER_INDEX = 1;\n\n\nconst REQUIRED_MODEL_ATTRS = {\n  shape: [ 'x', 'y', 'width', 'height' ],\n  connection: [ 'waypoints' ]\n};\n\n/**\n * The main drawing canvas.\n *\n * @class\n * @constructor\n *\n * @emits Canvas#canvas.init\n *\n * @param {CanvasConfig|null} config\n * @param {EventBus} eventBus\n * @param {GraphicsFactory} graphicsFactory\n * @param {ElementRegistry} elementRegistry\n */\nexport default function Canvas(config, eventBus, graphicsFactory, elementRegistry) {\n  this._eventBus = eventBus;\n  this._elementRegistry = elementRegistry;\n  this._graphicsFactory = graphicsFactory;\n\n  /**\n   * @type {number}\n   */\n  this._rootsIdx = 0;\n\n  /**\n   * @type {CanvasLayers}\n   */\n  this._layers = {};\n\n  /**\n   * @type {CanvasPlane[]}\n   */\n  this._planes = [];\n\n  /**\n   * @type {RootLike|null}\n   */\n  this._rootElement = null;\n\n  /**\n   * @type {boolean}\n   */\n  this._focused = false;\n\n  this._init(config || {});\n}\n\nCanvas.$inject = [\n  'config.canvas',\n  'eventBus',\n  'graphicsFactory',\n  'elementRegistry'\n];\n\n/**\n * Creates a <svg> element that is wrapped into a <div>.\n * This way we are always able to correctly figure out the size of the svg element\n * by querying the parent node.\n\n * (It is not possible to get the size of a svg element cross browser @ 2014-04-01)\n\n * <div class=\"djs-container\" style=\"width: {desired-width}, height: {desired-height}\">\n *   <svg width=\"100%\" height=\"100%\">\n *    ...\n *   </svg>\n * </div>\n *\n * @param {CanvasConfig} config\n */\nCanvas.prototype._init = function(config) {\n  const eventBus = this._eventBus;\n\n  // html container\n  const container = this._container = createContainer(config);\n\n  const svg = this._svg = svgCreate('svg');\n\n  svgAttr(svg, {\n    width: '100%',\n    height: '100%'\n  });\n\n  domAttr(svg, 'tabindex', 0);\n\n  config.autoFocus && eventBus.on('element.hover', () => {\n    this.restoreFocus();\n  });\n\n  eventBus.on('element.mousedown', 500, (event) => {\n    this.focus();\n  });\n\n  svg.addEventListener('focusin', () => {\n    this._setFocused(true);\n  });\n\n  svg.addEventListener('focusout', () => {\n    this._setFocused(false);\n  });\n\n  svgAppend(container, svg);\n\n  const viewport = this._viewport = createGroup(svg, 'viewport');\n\n  // debounce canvas.viewbox.changed events when deferUpdate is set\n  // to help with potential performance issues\n  if (config.deferUpdate) {\n    this._viewboxChanged = debounce(bind(this._viewboxChanged, this), 300);\n  }\n\n  eventBus.on('diagram.init', () => {\n\n    /**\n     * An event indicating that the canvas is ready to be drawn on.\n     *\n     * @memberOf Canvas\n     *\n     * @event canvas.init\n     *\n     * @type {Object}\n     * @property {SVGElement} svg the created svg element\n     * @property {SVGElement} viewport the direct parent of diagram elements and shapes\n     */\n    eventBus.fire('canvas.init', {\n      svg: svg,\n      viewport: viewport\n    });\n\n  });\n\n  // reset viewbox on shape changes to\n  // recompute the viewbox\n  eventBus.on([\n    'shape.added',\n    'connection.added',\n    'shape.removed',\n    'connection.removed',\n    'elements.changed',\n    'root.set'\n  ], () => {\n    delete this._cachedViewbox;\n  });\n\n  eventBus.on('diagram.destroy', 500, this._destroy, this);\n  eventBus.on('diagram.clear', 500, this._clear, this);\n};\n\nCanvas.prototype._destroy = function() {\n  this._eventBus.fire('canvas.destroy', {\n    svg: this._svg,\n    viewport: this._viewport\n  });\n\n  const parent = this._container.parentNode;\n\n  if (parent) {\n    parent.removeChild(this._container);\n  }\n\n  delete this._svg;\n  delete this._container;\n  delete this._layers;\n  delete this._planes;\n  delete this._rootElement;\n  delete this._viewport;\n};\n\nCanvas.prototype._setFocused = function(focused) {\n\n  if (focused == this._focused) {\n    return;\n  }\n\n  this._focused = focused;\n\n  this._eventBus.fire('canvas.focus.changed', { focused });\n};\n\nCanvas.prototype._clear = function() {\n\n  const allElements = this._elementRegistry.getAll();\n\n  // remove all elements\n  allElements.forEach(element => {\n    const type = getType(element);\n\n    if (type === 'root') {\n      this.removeRootElement(element);\n    } else {\n      this._removeElement(element, type);\n    }\n  });\n\n  // remove all planes\n  this._planes = [];\n  this._rootElement = null;\n\n  // force recomputation of view box\n  delete this._cachedViewbox;\n};\n\n/**\n * Sets focus on the canvas SVG element.\n */\nCanvas.prototype.focus = function() {\n  this._svg.focus({ preventScroll: true });\n\n  this._setFocused(true);\n};\n\n/**\n* Sets focus on the canvas SVG element if `document.body` is currently focused.\n*/\nCanvas.prototype.restoreFocus = function() {\n  if (document.activeElement === document.body) {\n    this.focus();\n  }\n};\n\n/**\n* Returns true if the canvas is focused.\n*\n* @return {boolean}\n*/\nCanvas.prototype.isFocused = function() {\n  return this._focused;\n};\n\n/**\n * Returns the default layer on which\n * all elements are drawn.\n *\n * @return {SVGElement}  The SVG element of the layer.\n */\nCanvas.prototype.getDefaultLayer = function() {\n  return this.getLayer(BASE_LAYER, PLANE_LAYER_INDEX);\n};\n\n/**\n * Returns a layer that is used to draw elements\n * or annotations on it.\n *\n * Non-existing layers retrieved through this method\n * will be created. During creation, the optional index\n * may be used to create layers below or above existing layers.\n * A layer with a certain index is always created above all\n * existing layers with the same index.\n *\n * @param {string} name The name of the layer.\n * @param {number} [index] The index of the layer.\n *\n * @return {SVGElement} The SVG element of the layer.\n */\nCanvas.prototype.getLayer = function(name, index) {\n\n  if (!name) {\n    throw new Error('must specify a name');\n  }\n\n  let layer = this._layers[name];\n\n  if (!layer) {\n    layer = this._layers[name] = this._createLayer(name, index);\n  }\n\n  // throw an error if layer creation / retrival is\n  // requested on different index\n  if (typeof index !== 'undefined' && layer.index !== index) {\n    throw new Error('layer <' + name + '> already created at index <' + index + '>');\n  }\n\n  return layer.group;\n};\n\n/**\n * For a given index, return the number of layers that have a higher index and\n * are visible.\n *\n * This is used to determine the node a layer should be inserted at.\n *\n * @param {number} index\n *\n * @return {number}\n */\nCanvas.prototype._getChildIndex = function(index) {\n  return reduce(this._layers, function(childIndex, layer) {\n    if (layer.visible && index >= layer.index) {\n      childIndex++;\n    }\n\n    return childIndex;\n  }, 0);\n};\n\n/**\n * Creates a given layer and returns it.\n *\n * @param {string} name\n * @param {number} [index=0]\n *\n * @return {CanvasLayer}\n */\nCanvas.prototype._createLayer = function(name, index) {\n\n  if (typeof index === 'undefined') {\n    index = UTILITY_LAYER_INDEX;\n  }\n\n  const childIndex = this._getChildIndex(index);\n\n  return {\n    group: createGroup(this._viewport, 'layer-' + name, childIndex),\n    index: index,\n    visible: true\n  };\n};\n\n\n/**\n * Shows a given layer.\n *\n * @param {string} name The name of the layer.\n *\n * @return {SVGElement} The SVG element of the layer.\n */\nCanvas.prototype.showLayer = function(name) {\n\n  if (!name) {\n    throw new Error('must specify a name');\n  }\n\n  const layer = this._layers[name];\n\n  if (!layer) {\n    throw new Error('layer <' + name + '> does not exist');\n  }\n\n  const viewport = this._viewport;\n  const group = layer.group;\n  const index = layer.index;\n\n  if (layer.visible) {\n    return group;\n  }\n\n  const childIndex = this._getChildIndex(index);\n\n  viewport.insertBefore(group, viewport.childNodes[childIndex] || null);\n\n  layer.visible = true;\n\n  return group;\n};\n\n/**\n * Hides a given layer.\n *\n * @param {string} name The name of the layer.\n *\n * @return {SVGElement} The SVG element of the layer.\n */\nCanvas.prototype.hideLayer = function(name) {\n\n  if (!name) {\n    throw new Error('must specify a name');\n  }\n\n  const layer = this._layers[name];\n\n  if (!layer) {\n    throw new Error('layer <' + name + '> does not exist');\n  }\n\n  const group = layer.group;\n\n  if (!layer.visible) {\n    return group;\n  }\n\n  svgRemove(group);\n\n  layer.visible = false;\n\n  return group;\n};\n\n\nCanvas.prototype._removeLayer = function(name) {\n\n  const layer = this._layers[name];\n\n  if (layer) {\n    delete this._layers[name];\n\n    svgRemove(layer.group);\n  }\n};\n\n/**\n * Returns the currently active layer. Can be null.\n *\n * @return {CanvasLayer|null} The active layer of `null`.\n */\nCanvas.prototype.getActiveLayer = function() {\n  const plane = this._findPlaneForRoot(this.getRootElement());\n\n  if (!plane) {\n    return null;\n  }\n\n  return plane.layer;\n};\n\n\n/**\n * Returns the plane which contains the given element.\n *\n * @param {ShapeLike|ConnectionLike|string} element The element or its ID.\n *\n * @return {RootLike|undefined} The root of the element.\n */\nCanvas.prototype.findRoot = function(element) {\n  if (typeof element === 'string') {\n    element = this._elementRegistry.get(element);\n  }\n\n  if (!element) {\n    return;\n  }\n\n  const plane = this._findPlaneForRoot(\n    findRoot(element)\n  ) || {};\n\n  return plane.rootElement;\n};\n\n/**\n * Return a list of all root elements on the diagram.\n *\n * @return {(RootLike)[]} The list of root elements.\n */\nCanvas.prototype.getRootElements = function() {\n  return this._planes.map(function(plane) {\n    return plane.rootElement;\n  });\n};\n\nCanvas.prototype._findPlaneForRoot = function(rootElement) {\n  return find(this._planes, function(plane) {\n    return plane.rootElement === rootElement;\n  });\n};\n\n\n/**\n * Returns the html element that encloses the\n * drawing canvas.\n *\n * @return {HTMLElement} The HTML element of the container.\n */\nCanvas.prototype.getContainer = function() {\n  return this._container;\n};\n\n\n// markers //////////////////////\n\nCanvas.prototype._updateMarker = function(element, marker, add) {\n  let container;\n\n  if (!element.id) {\n    element = this._elementRegistry.get(element);\n  }\n\n  element.markers = element.markers || new Set();\n\n  // we need to access all\n  container = this._elementRegistry._elements[element.id];\n\n  if (!container) {\n    return;\n  }\n\n  forEach([ container.gfx, container.secondaryGfx ], function(gfx) {\n    if (gfx) {\n\n      // invoke either addClass or removeClass based on mode\n      if (add) {\n        element.markers.add(marker);\n        svgClasses(gfx).add(marker);\n      } else {\n        element.markers.delete(marker);\n        svgClasses(gfx).remove(marker);\n      }\n    }\n  });\n\n  /**\n   * An event indicating that a marker has been updated for an element\n   *\n   * @event element.marker.update\n   * @type {Object}\n   * @property {Element} element the shape\n   * @property {SVGElement} gfx the graphical representation of the shape\n   * @property {string} marker\n   * @property {boolean} add true if the marker was added, false if it got removed\n   */\n  this._eventBus.fire('element.marker.update', { element: element, gfx: container.gfx, marker: marker, add: !!add });\n};\n\n\n/**\n * Adds a marker to an element (basically a css class).\n *\n * Fires the element.marker.update event, making it possible to\n * integrate extension into the marker life-cycle, too.\n *\n * @example\n *\n * ```javascript\n * canvas.addMarker('foo', 'some-marker');\n *\n * const fooGfx = canvas.getGraphics('foo');\n *\n * fooGfx; // <g class=\"... some-marker\"> ... </g>\n * ```\n *\n * @param {ShapeLike|ConnectionLike|string} element The element or its ID.\n * @param {string} marker The marker.\n */\nCanvas.prototype.addMarker = function(element, marker) {\n  this._updateMarker(element, marker, true);\n};\n\n\n/**\n * Remove a marker from an element.\n *\n * Fires the element.marker.update event, making it possible to\n * integrate extension into the marker life-cycle, too.\n *\n * @param {ShapeLike|ConnectionLike|string} element The element or its ID.\n * @param {string} marker The marker.\n */\nCanvas.prototype.removeMarker = function(element, marker) {\n  this._updateMarker(element, marker, false);\n};\n\n/**\n * Check whether an element has a given marker.\n *\n * @param {ShapeLike|ConnectionLike|string} element The element or its ID.\n * @param {string} marker The marker.\n */\nCanvas.prototype.hasMarker = function(element, marker) {\n  if (!element.id) {\n    element = this._elementRegistry.get(element);\n  }\n\n  if (!element.markers) {\n    return false;\n  }\n\n  return element.markers.has(marker);\n};\n\n/**\n * Toggles a marker on an element.\n *\n * Fires the element.marker.update event, making it possible to\n * integrate extension into the marker life-cycle, too.\n *\n * @param {ShapeLike|ConnectionLike|string} element The element or its ID.\n * @param {string} marker The marker.\n */\nCanvas.prototype.toggleMarker = function(element, marker) {\n  if (this.hasMarker(element, marker)) {\n    this.removeMarker(element, marker);\n  } else {\n    this.addMarker(element, marker);\n  }\n};\n\n/**\n * Returns the current root element.\n *\n * Supports two different modes for handling root elements:\n *\n * 1. if no root element has been added before, an implicit root will be added\n * and returned. This is used in applications that don't require explicit\n * root elements.\n *\n * 2. when root elements have been added before calling `getRootElement`,\n * root elements can be null. This is used for applications that want to manage\n * root elements themselves.\n *\n * @return {RootLike} The current root element.\n */\nCanvas.prototype.getRootElement = function() {\n  const rootElement = this._rootElement;\n\n  // can return null if root elements are present but none was set yet\n  if (rootElement || this._planes.length) {\n    return rootElement;\n  }\n\n  return this.setRootElement(this.addRootElement(null));\n};\n\n/**\n * Adds a given root element and returns it.\n *\n * @param {RootLike} [rootElement] The root element to be added.\n *\n * @return {RootLike} The added root element or an implicit root element.\n */\nCanvas.prototype.addRootElement = function(rootElement) {\n  const idx = this._rootsIdx++;\n\n  if (!rootElement) {\n    rootElement = {\n      id: '__implicitroot_' + idx,\n      children: [],\n      isImplicit: true\n    };\n  }\n\n  const layerName = rootElement.layer = 'root-' + idx;\n\n  this._ensureValid('root', rootElement);\n\n  const layer = this.getLayer(layerName, PLANE_LAYER_INDEX);\n\n  this.hideLayer(layerName);\n\n  this._addRoot(rootElement, layer);\n\n  this._planes.push({\n    rootElement: rootElement,\n    layer: layer\n  });\n\n  return rootElement;\n};\n\n/**\n * Removes a given root element and returns it.\n *\n * @param {RootLike|string} rootElement element or element ID\n *\n * @return {RootLike|undefined} removed element\n */\nCanvas.prototype.removeRootElement = function(rootElement) {\n\n  if (typeof rootElement === 'string') {\n    rootElement = this._elementRegistry.get(rootElement);\n  }\n\n  const plane = this._findPlaneForRoot(rootElement);\n\n  if (!plane) {\n    return;\n  }\n\n  // hook up life-cycle events\n  this._removeRoot(rootElement);\n\n  // clean up layer\n  this._removeLayer(rootElement.layer);\n\n  // clean up plane\n  this._planes = this._planes.filter(function(plane) {\n    return plane.rootElement !== rootElement;\n  });\n\n  // clean up active root\n  if (this._rootElement === rootElement) {\n    this._rootElement = null;\n  }\n\n  return rootElement;\n};\n\n\n/**\n * Sets a given element as the new root element for the canvas\n * and returns the new root element.\n *\n * @param {RootLike} rootElement The root element to be set.\n *\n * @return {RootLike} The set root element.\n */\nCanvas.prototype.setRootElement = function(rootElement) {\n\n  if (rootElement === this._rootElement) {\n    return rootElement;\n  }\n\n  let plane;\n\n  if (!rootElement) {\n    throw new Error('rootElement required');\n  }\n\n  plane = this._findPlaneForRoot(rootElement);\n\n  // give set add semantics for backwards compatibility\n  if (!plane) {\n    rootElement = this.addRootElement(rootElement);\n  }\n\n  this._setRoot(rootElement);\n\n  return rootElement;\n};\n\n\nCanvas.prototype._removeRoot = function(element) {\n  const elementRegistry = this._elementRegistry,\n        eventBus = this._eventBus;\n\n  // simulate element remove event sequence\n  eventBus.fire('root.remove', { element: element });\n  eventBus.fire('root.removed', { element: element });\n\n  elementRegistry.remove(element);\n};\n\n\nCanvas.prototype._addRoot = function(element, gfx) {\n  const elementRegistry = this._elementRegistry,\n        eventBus = this._eventBus;\n\n  // resemble element add event sequence\n  eventBus.fire('root.add', { element: element });\n\n  elementRegistry.add(element, gfx);\n\n  eventBus.fire('root.added', { element: element, gfx: gfx });\n};\n\n\nCanvas.prototype._setRoot = function(rootElement, layer) {\n\n  const currentRoot = this._rootElement;\n\n  if (currentRoot) {\n\n    // un-associate previous root element <svg>\n    this._elementRegistry.updateGraphics(currentRoot, null, true);\n\n    // hide previous layer\n    this.hideLayer(currentRoot.layer);\n  }\n\n  if (rootElement) {\n\n    if (!layer) {\n      layer = this._findPlaneForRoot(rootElement).layer;\n    }\n\n    // associate element with <svg>\n    this._elementRegistry.updateGraphics(rootElement, this._svg, true);\n\n    // show root layer\n    this.showLayer(rootElement.layer);\n  }\n\n  this._rootElement = rootElement;\n\n  this._eventBus.fire('root.set', { element: rootElement });\n};\n\nCanvas.prototype._ensureValid = function(type, element) {\n  if (!element.id) {\n    throw new Error('element must have an id');\n  }\n\n  if (this._elementRegistry.get(element.id)) {\n    throw new Error('element <' + element.id + '> already exists');\n  }\n\n  const requiredAttrs = REQUIRED_MODEL_ATTRS[type];\n\n  const valid = every(requiredAttrs, function(attr) {\n    return typeof element[attr] !== 'undefined';\n  });\n\n  if (!valid) {\n    throw new Error(\n      'must supply { ' + requiredAttrs.join(', ') + ' } with ' + type);\n  }\n};\n\nCanvas.prototype._setParent = function(element, parent, parentIndex) {\n  collectionAdd(parent.children, element, parentIndex);\n  element.parent = parent;\n};\n\n/**\n * Adds an element to the canvas.\n *\n * This wires the parent <-> child relationship between the element and\n * a explicitly specified parent or an implicit root element.\n *\n * During add it emits the events\n *\n *  * <{type}.add> (element, parent)\n *  * <{type}.added> (element, gfx)\n *\n * Extensions may hook into these events to perform their magic.\n *\n * @param {string} type\n * @param {ConnectionLike|ShapeLike} element\n * @param {ShapeLike} [parent]\n * @param {number} [parentIndex]\n *\n * @return {ConnectionLike|ShapeLike} The added element.\n */\nCanvas.prototype._addElement = function(type, element, parent, parentIndex) {\n\n  parent = parent || this.getRootElement();\n\n  const eventBus = this._eventBus,\n        graphicsFactory = this._graphicsFactory;\n\n  this._ensureValid(type, element);\n\n  eventBus.fire(type + '.add', { element: element, parent: parent });\n\n  this._setParent(element, parent, parentIndex);\n\n  // create graphics\n  const gfx = graphicsFactory.create(type, element, parentIndex);\n\n  this._elementRegistry.add(element, gfx);\n\n  // update its visual\n  graphicsFactory.update(type, element, gfx);\n\n  eventBus.fire(type + '.added', { element: element, gfx: gfx });\n\n  return element;\n};\n\n/**\n * Adds a shape to the canvas.\n *\n * @param {ShapeLike} shape The shape to be added\n * @param {ParentLike} [parent] The shape's parent.\n * @param {number} [parentIndex] The index at which to add the shape to the parent's children.\n *\n * @return {ShapeLike} The added shape.\n */\nCanvas.prototype.addShape = function(shape, parent, parentIndex) {\n  return this._addElement('shape', shape, parent, parentIndex);\n};\n\n/**\n * Adds a connection to the canvas.\n *\n * @param {ConnectionLike} connection The connection to be added.\n * @param {ParentLike} [parent] The connection's parent.\n * @param {number} [parentIndex] The index at which to add the connection to the parent's children.\n *\n * @return {ConnectionLike} The added connection.\n */\nCanvas.prototype.addConnection = function(connection, parent, parentIndex) {\n  return this._addElement('connection', connection, parent, parentIndex);\n};\n\n\n/**\n * Internal remove element\n */\nCanvas.prototype._removeElement = function(element, type) {\n\n  const elementRegistry = this._elementRegistry,\n        graphicsFactory = this._graphicsFactory,\n        eventBus = this._eventBus;\n\n  element = elementRegistry.get(element.id || element);\n\n  if (!element) {\n\n    // element was removed already\n    return;\n  }\n\n  eventBus.fire(type + '.remove', { element: element });\n\n  graphicsFactory.remove(element);\n\n  // unset parent <-> child relationship\n  collectionRemove(element.parent && element.parent.children, element);\n  element.parent = null;\n\n  eventBus.fire(type + '.removed', { element: element });\n\n  elementRegistry.remove(element);\n\n  return element;\n};\n\n\n/**\n * Removes a shape from the canvas.\n *\n * @fires ShapeRemoveEvent\n * @fires ShapeRemovedEvent\n *\n * @param {ShapeLike|string} shape The shape or its ID.\n *\n * @return {ShapeLike} The removed shape.\n */\nCanvas.prototype.removeShape = function(shape) {\n\n  /**\n   * An event indicating that a shape is about to be removed from the canvas.\n   *\n   * @memberOf Canvas\n   *\n   * @event ShapeRemoveEvent\n   * @type {Object}\n   * @property {ShapeLike} element The shape.\n   * @property {SVGElement} gfx The graphical element.\n   */\n\n  /**\n   * An event indicating that a shape has been removed from the canvas.\n   *\n   * @memberOf Canvas\n   *\n   * @event ShapeRemovedEvent\n   * @type {Object}\n   * @property {ShapeLike} element The shape.\n   * @property {SVGElement} gfx The graphical element.\n   */\n  return this._removeElement(shape, 'shape');\n};\n\n\n/**\n * Removes a connection from the canvas.\n *\n * @fires ConnectionRemoveEvent\n * @fires ConnectionRemovedEvent\n *\n * @param {ConnectionLike|string} connection The connection or its ID.\n *\n * @return {ConnectionLike} The removed connection.\n */\nCanvas.prototype.removeConnection = function(connection) {\n\n  /**\n   * An event indicating that a connection is about to be removed from the canvas.\n   *\n   * @memberOf Canvas\n   *\n   * @event ConnectionRemoveEvent\n   * @type {Object}\n   * @property {ConnectionLike} element The connection.\n   * @property {SVGElement} gfx The graphical element.\n   */\n\n  /**\n   * An event indicating that a connection has been removed from the canvas.\n   *\n   * @memberOf Canvas\n   *\n   * @event ConnectionRemovedEvent\n   * @type {Object}\n   * @property {ConnectionLike} element The connection.\n   * @property {SVGElement} gfx The graphical element.\n   */\n  return this._removeElement(connection, 'connection');\n};\n\n\n/**\n * Returns the graphical element of an element.\n *\n * @param {ShapeLike|ConnectionLike|string} element The element or its ID.\n * @param {boolean} [secondary=false] Whether to return the secondary graphical element.\n *\n * @return {SVGElement} The graphical element.\n */\nCanvas.prototype.getGraphics = function(element, secondary) {\n  return this._elementRegistry.getGraphics(element, secondary);\n};\n\n\n/**\n * Perform a viewbox update via a given change function.\n *\n * @param {Function} changeFn\n */\nCanvas.prototype._changeViewbox = function(changeFn) {\n\n  // notify others of the upcoming viewbox change\n  this._eventBus.fire('canvas.viewbox.changing');\n\n  // perform actual change\n  changeFn.apply(this);\n\n  // reset the cached viewbox so that\n  // a new get operation on viewbox or zoom\n  // triggers a viewbox re-computation\n  this._cachedViewbox = null;\n\n  // notify others of the change; this step\n  // may or may not be debounced\n  this._viewboxChanged();\n};\n\nCanvas.prototype._viewboxChanged = function() {\n  this._eventBus.fire('canvas.viewbox.changed', { viewbox: this.viewbox() });\n};\n\n\n/**\n * Gets or sets the view box of the canvas, i.e. the\n * area that is currently displayed.\n *\n * The getter may return a cached viewbox (if it is currently\n * changing). To force a recomputation, pass `false` as the first argument.\n *\n * @example\n *\n * ```javascript\n * canvas.viewbox({ x: 100, y: 100, width: 500, height: 500 })\n *\n * // sets the visible area of the diagram to (100|100) -> (600|100)\n * // and and scales it according to the diagram width\n *\n * const viewbox = canvas.viewbox(); // pass `false` to force recomputing the box.\n *\n * console.log(viewbox);\n * // {\n * //   inner: Dimensions,\n * //   outer: Dimensions,\n * //   scale,\n * //   x, y,\n * //   width, height\n * // }\n *\n * // if the current diagram is zoomed and scrolled, you may reset it to the\n * // default zoom via this method, too:\n *\n * const zoomedAndScrolledViewbox = canvas.viewbox();\n *\n * canvas.viewbox({\n *   x: 0,\n *   y: 0,\n *   width: zoomedAndScrolledViewbox.outer.width,\n *   height: zoomedAndScrolledViewbox.outer.height\n * });\n * ```\n *\n * @param {Rect} [box] The viewbox to be set.\n *\n * @return {CanvasViewbox} The set viewbox.\n */\nCanvas.prototype.viewbox = function(box) {\n\n  if (box === undefined && this._cachedViewbox) {\n    return structuredClone(this._cachedViewbox);\n  }\n\n  const viewport = this._viewport,\n        outerBox = this.getSize();\n  let innerBox,\n      matrix,\n      activeLayer,\n      transform,\n      scale,\n      x, y;\n\n  if (!box) {\n\n    // compute the inner box based on the\n    // diagrams active layer. This allows us to exclude\n    // external components, such as overlays\n\n    activeLayer = this._rootElement ? this.getActiveLayer() : null;\n    innerBox = activeLayer && activeLayer.getBBox() || {};\n\n    transform = svgTransform(viewport);\n    matrix = transform ? transform.matrix : createMatrix();\n    scale = round(matrix.a, 1000);\n\n    x = round(-matrix.e || 0, 1000);\n    y = round(-matrix.f || 0, 1000);\n\n    box = this._cachedViewbox = {\n      x: x ? x / scale : 0,\n      y: y ? y / scale : 0,\n      width: outerBox.width / scale,\n      height: outerBox.height / scale,\n      scale: scale,\n      inner: {\n        width: innerBox.width || 0,\n        height: innerBox.height || 0,\n        x: innerBox.x || 0,\n        y: innerBox.y || 0\n      },\n      outer: outerBox\n    };\n\n    return box;\n  } else {\n\n    this._changeViewbox(function() {\n      scale = Math.min(outerBox.width / box.width, outerBox.height / box.height);\n\n      const matrix = this._svg.createSVGMatrix()\n        .scale(scale)\n        .translate(-box.x, -box.y);\n\n      svgTransform(viewport, matrix);\n    });\n  }\n\n  return box;\n};\n\n\n/**\n * Gets or sets the scroll of the canvas.\n *\n * @param {ScrollDelta} [delta] The scroll to be set.\n *\n * @return {Point}\n */\nCanvas.prototype.scroll = function(delta) {\n\n  const node = this._viewport;\n  let matrix = node.getCTM();\n\n  if (delta) {\n    this._changeViewbox(function() {\n      delta = assign({ dx: 0, dy: 0 }, delta || {});\n\n      matrix = this._svg.createSVGMatrix().translate(delta.dx, delta.dy).multiply(matrix);\n\n      setCTM(node, matrix);\n    });\n  }\n\n  return { x: matrix.e, y: matrix.f };\n};\n\n/**\n * Scrolls the viewbox to contain the given element.\n * Optionally specify a padding to be applied to the edges.\n *\n * @param {ShapeLike|ConnectionLike|string} element The element to scroll to or its ID.\n * @param {RectTRBL|number} [padding=100] The padding to be applied. Can also specify top, bottom, left and right.\n */\nCanvas.prototype.scrollToElement = function(element, padding) {\n  let defaultPadding = 100;\n\n  if (typeof element === 'string') {\n    element = this._elementRegistry.get(element);\n  }\n\n  // set to correct rootElement\n  const rootElement = this.findRoot(element);\n\n  if (rootElement !== this.getRootElement()) {\n    this.setRootElement(rootElement);\n  }\n\n  // element is rootElement, do not change viewport\n  if (rootElement === element) {\n    return;\n  }\n\n  if (!padding) {\n    padding = {};\n  }\n  if (typeof padding === 'number') {\n    defaultPadding = padding;\n  }\n\n  padding = {\n    top: padding.top || defaultPadding,\n    right: padding.right || defaultPadding,\n    bottom: padding.bottom || defaultPadding,\n    left: padding.left || defaultPadding\n  };\n\n  const elementBounds = getBoundingBox(element),\n        elementTrbl = asTRBL(elementBounds),\n        viewboxBounds = this.viewbox(),\n        zoom = this.zoom();\n  let dx, dy;\n\n  // shrink viewboxBounds with padding\n  viewboxBounds.y += padding.top / zoom;\n  viewboxBounds.x += padding.left / zoom;\n  viewboxBounds.width -= (padding.right + padding.left) / zoom;\n  viewboxBounds.height -= (padding.bottom + padding.top) / zoom;\n\n  const viewboxTrbl = asTRBL(viewboxBounds);\n\n  const canFit = elementBounds.width < viewboxBounds.width && elementBounds.height < viewboxBounds.height;\n\n  if (!canFit) {\n\n    // top-left when element can't fit\n    dx = elementBounds.x - viewboxBounds.x;\n    dy = elementBounds.y - viewboxBounds.y;\n\n  } else {\n\n    const dRight = Math.max(0, elementTrbl.right - viewboxTrbl.right),\n          dLeft = Math.min(0, elementTrbl.left - viewboxTrbl.left),\n          dBottom = Math.max(0, elementTrbl.bottom - viewboxTrbl.bottom),\n          dTop = Math.min(0, elementTrbl.top - viewboxTrbl.top);\n\n    dx = dRight || dLeft;\n    dy = dBottom || dTop;\n\n  }\n\n  this.scroll({ dx: -dx * zoom, dy: -dy * zoom });\n};\n\n/**\n * Gets or sets the current zoom of the canvas, optionally zooming to the\n * specified position.\n *\n * The getter may return a cached zoom level. Call it with `false` as the first\n * argument to force recomputation of the current level.\n *\n * @param {number|'fit-viewport'} [newScale] The new zoom level, either a number,\n * i.e. 0.9, or `fit-viewport` to adjust the size to fit the current viewport.\n * @param {Point} [center] The reference point { x: ..., y: ...} to zoom to.\n *\n * @return {number} The set zoom level.\n */\nCanvas.prototype.zoom = function(newScale, center) {\n\n  if (!newScale) {\n    return this.viewbox(newScale).scale;\n  }\n\n  if (newScale === 'fit-viewport') {\n    return this._fitViewport(center);\n  }\n\n  let outer,\n      matrix;\n\n  this._changeViewbox(function() {\n\n    if (typeof center !== 'object') {\n      outer = this.viewbox().outer;\n\n      center = {\n        x: outer.width / 2,\n        y: outer.height / 2\n      };\n    }\n\n    matrix = this._setZoom(newScale, center);\n  });\n\n  return round(matrix.a, 1000);\n};\n\nfunction setCTM(node, m) {\n  const mstr = 'matrix(' + m.a + ',' + m.b + ',' + m.c + ',' + m.d + ',' + m.e + ',' + m.f + ')';\n  node.setAttribute('transform', mstr);\n}\n\nCanvas.prototype._fitViewport = function(center) {\n\n  const vbox = this.viewbox(),\n        outer = vbox.outer,\n        inner = vbox.inner;\n  let newScale,\n      newViewbox;\n\n  // display the complete diagram without zooming in.\n  // instead of relying on internal zoom, we perform a\n  // hard reset on the canvas viewbox to realize this\n  //\n  // if diagram does not need to be zoomed in, we focus it around\n  // the diagram origin instead\n\n  if (inner.x >= 0 &&\n      inner.y >= 0 &&\n      inner.x + inner.width <= outer.width &&\n      inner.y + inner.height <= outer.height &&\n      !center) {\n\n    newViewbox = {\n      x: 0,\n      y: 0,\n      width: Math.max(inner.width + inner.x, outer.width),\n      height: Math.max(inner.height + inner.y, outer.height)\n    };\n  } else {\n\n    newScale = Math.min(1, outer.width / inner.width, outer.height / inner.height);\n    newViewbox = {\n      x: inner.x + (center ? inner.width / 2 - outer.width / newScale / 2 : 0),\n      y: inner.y + (center ? inner.height / 2 - outer.height / newScale / 2 : 0),\n      width: outer.width / newScale,\n      height: outer.height / newScale\n    };\n  }\n\n  this.viewbox(newViewbox);\n\n  return this.viewbox(false).scale;\n};\n\n\nCanvas.prototype._setZoom = function(scale, center) {\n\n  const svg = this._svg,\n        viewport = this._viewport;\n\n  const matrix = svg.createSVGMatrix();\n  const point = svg.createSVGPoint();\n\n  let centerPoint,\n      originalPoint,\n      currentMatrix,\n      scaleMatrix,\n      newMatrix;\n\n  currentMatrix = viewport.getCTM();\n\n  const currentScale = currentMatrix.a;\n\n  if (center) {\n    centerPoint = assign(point, center);\n\n    // revert applied viewport transformations\n    originalPoint = centerPoint.matrixTransform(currentMatrix.inverse());\n\n    // create scale matrix\n    scaleMatrix = matrix\n      .translate(originalPoint.x, originalPoint.y)\n      .scale(1 / currentScale * scale)\n      .translate(-originalPoint.x, -originalPoint.y);\n\n    newMatrix = currentMatrix.multiply(scaleMatrix);\n  } else {\n    newMatrix = matrix.scale(scale);\n  }\n\n  setCTM(this._viewport, newMatrix);\n\n  return newMatrix;\n};\n\n\n/**\n * Returns the size of the canvas.\n *\n * @return {Dimensions} The size of the canvas.\n */\nCanvas.prototype.getSize = function() {\n  return {\n    width: this._container.clientWidth,\n    height: this._container.clientHeight\n  };\n};\n\n\n/**\n * Returns the absolute bounding box of an element.\n *\n * The absolute bounding box may be used to display overlays in the callers\n * (browser) coordinate system rather than the zoomed in/out canvas coordinates.\n *\n * @param {ShapeLike|ConnectionLike} element The element.\n *\n * @return {Rect} The element's absolute bounding box.\n */\nCanvas.prototype.getAbsoluteBBox = function(element) {\n  const vbox = this.viewbox();\n  let bbox;\n\n  // connection\n  // use svg bbox\n  if (element.waypoints) {\n    const gfx = this.getGraphics(element);\n\n    bbox = gfx.getBBox();\n  }\n\n  // shapes\n  // use data\n  else {\n    bbox = element;\n  }\n\n  const x = bbox.x * vbox.scale - vbox.x * vbox.scale;\n  const y = bbox.y * vbox.scale - vbox.y * vbox.scale;\n\n  const width = bbox.width * vbox.scale;\n  const height = bbox.height * vbox.scale;\n\n  return {\n    x: x,\n    y: y,\n    width: width,\n    height: height\n  };\n};\n\n/**\n * Fires an event so other modules can react to the canvas resizing.\n */\nCanvas.prototype.resized = function() {\n\n  // force recomputation of view box\n  delete this._cachedViewbox;\n\n  this._eventBus.fire('canvas.resized');\n};\n","var ELEMENT_ID = 'data-element-id';\n\nimport { attr as svgAttr } from 'tiny-svg';\n\n/**\n * @typedef {import('./Types').ElementLike} ElementLike\n *\n * @typedef {import('./EventBus').default} EventBus\n *\n * @typedef { (element: ElementLike, gfx: SVGElement) => boolean|any } ElementRegistryFilterCallback\n * @typedef { (element: ElementLike, gfx: SVGElement) => any } ElementRegistryForEachCallback\n */\n\n/**\n * A registry that keeps track of all shapes in the diagram.\n *\n * @class\n * @constructor\n *\n * @param {EventBus} eventBus\n */\nexport default function ElementRegistry(eventBus) {\n\n  /**\n   * @type { {\n   *   [id: string]: {\n   *     element: ElementLike;\n   *     gfx?: SVGElement;\n   *     secondaryGfx?: SVGElement;\n   *   }\n   * } }\n   */\n  this._elements = {};\n\n  this._eventBus = eventBus;\n}\n\nElementRegistry.$inject = [ 'eventBus' ];\n\n/**\n * Add an element and its graphical representation(s) to the registry.\n *\n * @param {ElementLike} element The element to be added.\n * @param {SVGElement} gfx The primary graphical representation.\n * @param {SVGElement} [secondaryGfx] The secondary graphical representation.\n */\nElementRegistry.prototype.add = function(element, gfx, secondaryGfx) {\n\n  var id = element.id;\n\n  this._validateId(id);\n\n  // associate dom node with element\n  svgAttr(gfx, ELEMENT_ID, id);\n\n  if (secondaryGfx) {\n    svgAttr(secondaryGfx, ELEMENT_ID, id);\n  }\n\n  this._elements[id] = { element: element, gfx: gfx, secondaryGfx: secondaryGfx };\n};\n\n/**\n * Remove an element from the registry.\n *\n * @param {ElementLike|string} element\n */\nElementRegistry.prototype.remove = function(element) {\n  var elements = this._elements,\n      id = element.id || element,\n      container = id && elements[id];\n\n  if (container) {\n\n    // unset element id on gfx\n    svgAttr(container.gfx, ELEMENT_ID, '');\n\n    if (container.secondaryGfx) {\n      svgAttr(container.secondaryGfx, ELEMENT_ID, '');\n    }\n\n    delete elements[id];\n  }\n};\n\n/**\n * Update an elements ID.\n *\n * @param {ElementLike|string} element The element or its ID.\n * @param {string} newId The new ID.\n */\nElementRegistry.prototype.updateId = function(element, newId) {\n\n  this._validateId(newId);\n\n  if (typeof element === 'string') {\n    element = this.get(element);\n  }\n\n  this._eventBus.fire('element.updateId', {\n    element: element,\n    newId: newId\n  });\n\n  var gfx = this.getGraphics(element),\n      secondaryGfx = this.getGraphics(element, true);\n\n  this.remove(element);\n\n  element.id = newId;\n\n  this.add(element, gfx, secondaryGfx);\n};\n\n/**\n * Update the graphical representation of an element.\n *\n * @param {ElementLike|string} filter The element or its ID.\n * @param {SVGElement} gfx The new graphical representation.\n * @param {boolean} [secondary=false] Whether to update the secondary graphical representation.\n */\nElementRegistry.prototype.updateGraphics = function(filter, gfx, secondary) {\n  var id = filter.id || filter;\n\n  var container = this._elements[id];\n\n  if (secondary) {\n    container.secondaryGfx = gfx;\n  } else {\n    container.gfx = gfx;\n  }\n\n  if (gfx) {\n    svgAttr(gfx, ELEMENT_ID, id);\n  }\n\n  return gfx;\n};\n\n/**\n * Get the element with the given ID or graphical representation.\n *\n * @example\n *\n * ```javascript\n * elementRegistry.get('SomeElementId_1');\n *\n * elementRegistry.get(gfx);\n * ```\n *\n * @param {string|SVGElement} filter The elements ID or graphical representation.\n *\n * @return {ElementLike|undefined} The element.\n */\nElementRegistry.prototype.get = function(filter) {\n  var id;\n\n  if (typeof filter === 'string') {\n    id = filter;\n  } else {\n    id = filter && svgAttr(filter, ELEMENT_ID);\n  }\n\n  var container = this._elements[id];\n  return container && container.element;\n};\n\n/**\n * Return all elements that match a given filter function.\n *\n * @param {ElementRegistryFilterCallback} fn The filter function.\n *\n * @return {ElementLike[]} The matching elements.\n */\nElementRegistry.prototype.filter = function(fn) {\n\n  var filtered = [];\n\n  this.forEach(function(element, gfx) {\n    if (fn(element, gfx)) {\n      filtered.push(element);\n    }\n  });\n\n  return filtered;\n};\n\n/**\n * Return the first element that matches the given filter function.\n *\n * @param {ElementRegistryFilterCallback} fn The filter function.\n *\n * @return {ElementLike|undefined} The matching element.\n */\nElementRegistry.prototype.find = function(fn) {\n  var map = this._elements,\n      keys = Object.keys(map);\n\n  for (var i = 0; i < keys.length; i++) {\n    var id = keys[i],\n        container = map[id],\n        element = container.element,\n        gfx = container.gfx;\n\n    if (fn(element, gfx)) {\n      return element;\n    }\n  }\n};\n\n/**\n * Get all elements.\n *\n * @return {ElementLike[]} All elements.\n */\nElementRegistry.prototype.getAll = function() {\n  return this.filter(function(e) { return e; });\n};\n\n/**\n * Execute a given function for each element.\n *\n * @param {ElementRegistryForEachCallback} fn The function to execute.\n */\nElementRegistry.prototype.forEach = function(fn) {\n\n  var map = this._elements;\n\n  Object.keys(map).forEach(function(id) {\n    var container = map[id],\n        element = container.element,\n        gfx = container.gfx;\n\n    return fn(element, gfx);\n  });\n};\n\n/**\n * Return the graphical representation of an element.\n *\n * @example\n *\n * ```javascript\n * elementRegistry.getGraphics('SomeElementId_1');\n *\n * elementRegistry.getGraphics(rootElement); // <g ...>\n *\n * elementRegistry.getGraphics(rootElement, true); // <svg ...>\n * ```\n *\n * @param {ElementLike|string} filter The element or its ID.\n * @param {boolean} [secondary=false] Whether to return the secondary graphical representation.\n *\n * @return {SVGElement} The graphical representation.\n */\nElementRegistry.prototype.getGraphics = function(filter, secondary) {\n  var id = filter.id || filter;\n\n  var container = this._elements[id];\n  return container && (secondary ? container.secondaryGfx : container.gfx);\n};\n\n/**\n * Validate an ID and throw an error if invalid.\n *\n * @param {string} id\n *\n * @throws {Error} Error indicating that the ID is invalid or already assigned.\n */\nElementRegistry.prototype._validateId = function(id) {\n  if (!id) {\n    throw new Error('element must have an id');\n  }\n\n  if (this._elements[id]) {\n    throw new Error('element with id ' + id + ' already added');\n  }\n};\n","import {\n  isFunction,\n  isArray,\n  isNumber,\n  bind,\n  assign\n} from 'min-dash';\n\nvar FN_REF = '__fn';\n\nvar DEFAULT_PRIORITY = 1000;\n\nvar slice = Array.prototype.slice;\n\n/**\n * @typedef { {\n *   stopPropagation(): void;\n *   preventDefault(): void;\n *   cancelBubble: boolean;\n *   defaultPrevented: boolean;\n *   returnValue: any;\n * } } Event\n */\n\n/**\n * @template E\n *\n * @typedef { (event: E & Event, ...any) => any } EventBusEventCallback\n */\n\n/**\n * @typedef { {\n *  priority: number;\n *  next: EventBusListener | null;\n *  callback: EventBusEventCallback<any>;\n * } } EventBusListener\n */\n\n/**\n * A general purpose event bus.\n *\n * This component is used to communicate across a diagram instance.\n * Other parts of a diagram can use it to listen to and broadcast events.\n *\n *\n * ## Registering for Events\n *\n * The event bus provides the {@link EventBus#on} and {@link EventBus#once}\n * methods to register for events. {@link EventBus#off} can be used to\n * remove event registrations. Listeners receive an instance of {@link Event}\n * as the first argument. It allows them to hook into the event execution.\n *\n * ```javascript\n *\n * // listen for event\n * eventBus.on('foo', function(event) {\n *\n *   // access event type\n *   event.type; // 'foo'\n *\n *   // stop propagation to other listeners\n *   event.stopPropagation();\n *\n *   // prevent event default\n *   event.preventDefault();\n * });\n *\n * // listen for event with custom payload\n * eventBus.on('bar', function(event, payload) {\n *   console.log(payload);\n * });\n *\n * // listen for event returning value\n * eventBus.on('foobar', function(event) {\n *\n *   // stop event propagation + prevent default\n *   return false;\n *\n *   // stop event propagation + return custom result\n *   return {\n *     complex: 'listening result'\n *   };\n * });\n *\n *\n * // listen with custom priority (default=1000, higher is better)\n * eventBus.on('priorityfoo', 1500, function(event) {\n *   console.log('invoked first!');\n * });\n *\n *\n * // listen for event and pass the context (`this`)\n * eventBus.on('foobar', function(event) {\n *   this.foo();\n * }, this);\n * ```\n *\n *\n * ## Emitting Events\n *\n * Events can be emitted via the event bus using {@link EventBus#fire}.\n *\n * ```javascript\n *\n * // false indicates that the default action\n * // was prevented by listeners\n * if (eventBus.fire('foo') === false) {\n *   console.log('default has been prevented!');\n * };\n *\n *\n * // custom args + return value listener\n * eventBus.on('sum', function(event, a, b) {\n *   return a + b;\n * });\n *\n * // you can pass custom arguments + retrieve result values.\n * var sum = eventBus.fire('sum', 1, 2);\n * console.log(sum); // 3\n * ```\n *\n * @template [EventMap=null]\n */\nexport default function EventBus() {\n\n  /**\n   * @type { Record<string, EventBusListener> }\n   */\n  this._listeners = {};\n\n  // cleanup on destroy on lowest priority to allow\n  // message passing until the bitter end\n  this.on('diagram.destroy', 1, this._destroy, this);\n}\n\n/**\n * @overlord\n *\n * Register an event listener for events with the given name.\n *\n * The callback will be invoked with `event, ...additionalArguments`\n * that have been passed to {@link EventBus#fire}.\n *\n * Returning false from a listener will prevent the events default action\n * (if any is specified). To stop an event from being processed further in\n * other listeners execute {@link Event#stopPropagation}.\n *\n * Returning anything but `undefined` from a listener will stop the listener propagation.\n *\n * @template T\n *\n * @param {string|string[]} events to subscribe to\n * @param {number} [priority=1000] listen priority\n * @param {EventBusEventCallback<T>} callback\n * @param {any} [that] callback context\n */\n/**\n * Register an event listener for events with the given name.\n *\n * The callback will be invoked with `event, ...additionalArguments`\n * that have been passed to {@link EventBus#fire}.\n *\n * Returning false from a listener will prevent the events default action\n * (if any is specified). To stop an event from being processed further in\n * other listeners execute {@link Event#stopPropagation}.\n *\n * Returning anything but `undefined` from a listener will stop the listener propagation.\n *\n * @template {keyof EventMap} EventName\n *\n * @param {EventName} events to subscribe to\n * @param {number} [priority=1000] listen priority\n * @param {EventBusEventCallback<EventMap[EventName]>} callback\n * @param {any} [that] callback context\n */\nEventBus.prototype.on = function(events, priority, callback, that) {\n\n  events = isArray(events) ? events : [ events ];\n\n  if (isFunction(priority)) {\n    that = callback;\n    callback = priority;\n    priority = DEFAULT_PRIORITY;\n  }\n\n  if (!isNumber(priority)) {\n    throw new Error('priority must be a number');\n  }\n\n  var actualCallback = callback;\n\n  if (that) {\n    actualCallback = bind(callback, that);\n\n    // make sure we remember and are able to remove\n    // bound callbacks via {@link #off} using the original\n    // callback\n    actualCallback[FN_REF] = callback[FN_REF] || callback;\n  }\n\n  var self = this;\n\n  events.forEach(function(e) {\n    self._addListener(e, {\n      priority: priority,\n      callback: actualCallback,\n      next: null\n    });\n  });\n};\n\n/**\n * @overlord\n *\n * Register an event listener that is called only once.\n *\n * @template T\n *\n * @param {string|string[]} events to subscribe to\n * @param {number} [priority=1000] the listen priority\n * @param {EventBusEventCallback<T>} callback\n * @param {any} [that] callback context\n */\n/**\n * Register an event listener that is called only once.\n *\n * @template {keyof EventMap} EventName\n *\n * @param {EventName} events to subscribe to\n * @param {number} [priority=1000] listen priority\n * @param {EventBusEventCallback<EventMap[EventName]>} callback\n * @param {any} [that] callback context\n */\nEventBus.prototype.once = function(events, priority, callback, that) {\n  var self = this;\n\n  if (isFunction(priority)) {\n    that = callback;\n    callback = priority;\n    priority = DEFAULT_PRIORITY;\n  }\n\n  if (!isNumber(priority)) {\n    throw new Error('priority must be a number');\n  }\n\n  function wrappedCallback() {\n    wrappedCallback.__isTomb = true;\n\n    var result = callback.apply(that, arguments);\n\n    self.off(events, wrappedCallback);\n\n    return result;\n  }\n\n  // make sure we remember and are able to remove\n  // bound callbacks via {@link #off} using the original\n  // callback\n  wrappedCallback[FN_REF] = callback;\n\n  this.on(events, priority, wrappedCallback);\n};\n\n\n/**\n * Removes event listeners by event and callback.\n *\n * If no callback is given, all listeners for a given event name are being removed.\n *\n * @param {string|string[]} events\n * @param {EventBusEventCallback<unknown>} [callback]\n */\nEventBus.prototype.off = function(events, callback) {\n\n  events = isArray(events) ? events : [ events ];\n\n  var self = this;\n\n  events.forEach(function(event) {\n    self._removeListener(event, callback);\n  });\n\n};\n\n\n/**\n * Create an event recognized be the event bus.\n *\n * @param {Object} data Event data.\n *\n * @return {Event} An event that will be recognized by the event bus.\n */\nEventBus.prototype.createEvent = function(data) {\n  var event = new InternalEvent();\n\n  event.init(data);\n\n  return event;\n};\n\n\n/**\n * Fires an event.\n *\n * @example\n *\n * ```javascript\n * // fire event by name\n * events.fire('foo');\n *\n * // fire event object with nested type\n * var event = { type: 'foo' };\n * events.fire(event);\n *\n * // fire event with explicit type\n * var event = { x: 10, y: 20 };\n * events.fire('element.moved', event);\n *\n * // pass additional arguments to the event\n * events.on('foo', function(event, bar) {\n *   alert(bar);\n * });\n *\n * events.fire({ type: 'foo' }, 'I am bar!');\n * ```\n *\n * @param {string} [type] event type\n * @param {Object} [data] event or event data\n * @param {...any} [args] additional arguments the callback will be called with.\n *\n * @return {any} The return value. Will be set to `false` if the default was prevented.\n */\nEventBus.prototype.fire = function(type, data) {\n  var event,\n      firstListener,\n      returnValue,\n      args;\n\n  args = slice.call(arguments);\n\n  if (typeof type === 'object') {\n    data = type;\n    type = data.type;\n  }\n\n  if (!type) {\n    throw new Error('no event type specified');\n  }\n\n  firstListener = this._listeners[type];\n\n  if (!firstListener) {\n    return;\n  }\n\n  // we make sure we fire instances of our home made\n  // events here. We wrap them only once, though\n  if (data instanceof InternalEvent) {\n\n    // we are fine, we alread have an event\n    event = data;\n  } else {\n    event = this.createEvent(data);\n  }\n\n  // ensure we pass the event as the first parameter\n  args[0] = event;\n\n  // original event type (in case we delegate)\n  var originalType = event.type;\n\n  // update event type before delegation\n  if (type !== originalType) {\n    event.type = type;\n  }\n\n  try {\n    returnValue = this._invokeListeners(event, args, firstListener);\n  } finally {\n\n    // reset event type after delegation\n    if (type !== originalType) {\n      event.type = originalType;\n    }\n  }\n\n  // set the return value to false if the event default\n  // got prevented and no other return value exists\n  if (returnValue === undefined && event.defaultPrevented) {\n    returnValue = false;\n  }\n\n  return returnValue;\n};\n\n/**\n * Handle an error by firing an event.\n *\n * @param {Error} error The error to be handled.\n *\n * @return {boolean} Whether the error was handled.\n */\nEventBus.prototype.handleError = function(error) {\n  return this.fire('error', { error: error }) === false;\n};\n\n\nEventBus.prototype._destroy = function() {\n  this._listeners = {};\n};\n\n/**\n * @param {Event} event\n * @param {any[]} args\n * @param {EventBusListener} listener\n *\n * @return {any}\n */\nEventBus.prototype._invokeListeners = function(event, args, listener) {\n\n  var returnValue;\n\n  while (listener) {\n\n    // handle stopped propagation\n    if (event.cancelBubble) {\n      break;\n    }\n\n    returnValue = this._invokeListener(event, args, listener);\n\n    listener = listener.next;\n  }\n\n  return returnValue;\n};\n\n/**\n * @param {Event} event\n * @param {any[]} args\n * @param {EventBusListener} listener\n *\n * @return {any}\n */\nEventBus.prototype._invokeListener = function(event, args, listener) {\n\n  var returnValue;\n\n  if (listener.callback.__isTomb) {\n    return returnValue;\n  }\n\n  try {\n\n    // returning false prevents the default action\n    returnValue = invokeFunction(listener.callback, args);\n\n    // stop propagation on return value\n    if (returnValue !== undefined) {\n      event.returnValue = returnValue;\n      event.stopPropagation();\n    }\n\n    // prevent default on return false\n    if (returnValue === false) {\n      event.preventDefault();\n    }\n  } catch (error) {\n    if (!this.handleError(error)) {\n      console.error('unhandled error in event listener', error);\n\n      throw error;\n    }\n  }\n\n  return returnValue;\n};\n\n/**\n * Add new listener with a certain priority to the list\n * of listeners (for the given event).\n *\n * The semantics of listener registration / listener execution are\n * first register, first serve: New listeners will always be inserted\n * after existing listeners with the same priority.\n *\n * Example: Inserting two listeners with priority 1000 and 1300\n *\n *    * before: [ 1500, 1500, 1000, 1000 ]\n *    * after: [ 1500, 1500, (new=1300), 1000, 1000, (new=1000) ]\n *\n * @param {string} event\n * @param {EventBusListener} newListener\n */\nEventBus.prototype._addListener = function(event, newListener) {\n\n  var listener = this._getListeners(event),\n      previousListener;\n\n  // no prior listeners\n  if (!listener) {\n    this._setListeners(event, newListener);\n\n    return;\n  }\n\n  // ensure we order listeners by priority from\n  // 0 (high) to n > 0 (low)\n  while (listener) {\n\n    if (listener.priority < newListener.priority) {\n\n      newListener.next = listener;\n\n      if (previousListener) {\n        previousListener.next = newListener;\n      } else {\n        this._setListeners(event, newListener);\n      }\n\n      return;\n    }\n\n    previousListener = listener;\n    listener = listener.next;\n  }\n\n  // add new listener to back\n  previousListener.next = newListener;\n};\n\n\n/**\n * @param {string} name\n *\n * @return {EventBusListener}\n */\nEventBus.prototype._getListeners = function(name) {\n  return this._listeners[name];\n};\n\n/**\n * @param {string} name\n * @param {EventBusListener} listener\n */\nEventBus.prototype._setListeners = function(name, listener) {\n  this._listeners[name] = listener;\n};\n\nEventBus.prototype._removeListener = function(event, callback) {\n\n  var listener = this._getListeners(event),\n      nextListener,\n      previousListener,\n      listenerCallback;\n\n  if (!callback) {\n\n    // clear listeners\n    this._setListeners(event, null);\n\n    return;\n  }\n\n  while (listener) {\n\n    nextListener = listener.next;\n\n    listenerCallback = listener.callback;\n\n    if (listenerCallback === callback || listenerCallback[FN_REF] === callback) {\n      if (previousListener) {\n        previousListener.next = nextListener;\n      } else {\n\n        // new first listener\n        this._setListeners(event, nextListener);\n      }\n    }\n\n    previousListener = listener;\n    listener = nextListener;\n  }\n};\n\n/**\n * A event that is emitted via the event bus.\n */\nfunction InternalEvent() { }\n\nInternalEvent.prototype.stopPropagation = function() {\n  this.cancelBubble = true;\n};\n\nInternalEvent.prototype.preventDefault = function() {\n  this.defaultPrevented = true;\n};\n\nInternalEvent.prototype.init = function(data) {\n  assign(this, data || {});\n};\n\n\n/**\n * Invoke function. Be fast...\n *\n * @param {Function} fn\n * @param {any[]} args\n *\n * @return {any}\n */\nfunction invokeFunction(fn, args) {\n  return fn.apply(null, args);\n}\n","import {\n  forEach,\n  reduce\n} from 'min-dash';\n\nimport {\n  getChildren,\n  getVisual\n} from '../util/GraphicsUtil';\n\nimport { translate } from '../util/SvgTransformUtil';\n\nimport { clear as domClear } from 'min-dom';\n\nimport {\n  append as svgAppend,\n  attr as svgAttr,\n  classes as svgClasses,\n  create as svgCreate,\n  remove as svgRemove\n} from 'tiny-svg';\n\nimport {\n  isFrameElement\n} from '../util/Elements';\n\n/**\n * @typedef {import('./Types').ConnectionLike} ConnectionLike\n * @typedef {import('./Types').ElementLike} ElementLike\n * @typedef {import('./Types').ShapeLike} ShapeLike\n *\n * @typedef {import('./ElementRegistry').default} ElementRegistry\n * @typedef {import('./EventBus').default} EventBus\n */\n\n/**\n * A factory that creates graphical elements.\n *\n * @param {EventBus} eventBus\n * @param {ElementRegistry} elementRegistry\n */\nexport default function GraphicsFactory(eventBus, elementRegistry) {\n  this._eventBus = eventBus;\n  this._elementRegistry = elementRegistry;\n}\n\nGraphicsFactory.$inject = [ 'eventBus' , 'elementRegistry' ];\n\n/**\n * @param { { parent?: any } } element\n * @return {SVGElement}\n */\nGraphicsFactory.prototype._getChildrenContainer = function(element) {\n\n  var gfx = this._elementRegistry.getGraphics(element);\n\n  var childrenGfx;\n\n  // root element\n  if (!element.parent) {\n    childrenGfx = gfx;\n  } else {\n    childrenGfx = getChildren(gfx);\n    if (!childrenGfx) {\n      childrenGfx = svgCreate('g');\n      svgClasses(childrenGfx).add('djs-children');\n\n      svgAppend(gfx.parentNode, childrenGfx);\n    }\n  }\n\n  return childrenGfx;\n};\n\n/**\n * Clears the graphical representation of the element and returns the\n * cleared visual (the <g class=\"djs-visual\" /> element).\n */\nGraphicsFactory.prototype._clear = function(gfx) {\n  var visual = getVisual(gfx);\n\n  domClear(visual);\n\n  return visual;\n};\n\n/**\n * Creates a gfx container for shapes and connections\n *\n * The layout is as follows:\n *\n * <g class=\"djs-group\">\n *\n *   <!-- the gfx -->\n *   <g class=\"djs-element djs-(shape|connection|frame)\">\n *     <g class=\"djs-visual\">\n *       <!-- the renderer draws in here -->\n *     </g>\n *\n *     <!-- extensions (overlays, click box, ...) goes here\n *   </g>\n *\n *   <!-- the gfx child nodes -->\n *   <g class=\"djs-children\"></g>\n * </g>\n *\n * @param {string} type the type of the element, i.e. shape | connection\n * @param {SVGElement} childrenGfx\n * @param {number} [parentIndex] position to create container in parent\n * @param {boolean} [isFrame] is frame element\n *\n * @return {SVGElement}\n */\nGraphicsFactory.prototype._createContainer = function(\n    type, childrenGfx, parentIndex, isFrame\n) {\n  var outerGfx = svgCreate('g');\n  svgClasses(outerGfx).add('djs-group');\n\n  // insert node at position\n  if (typeof parentIndex !== 'undefined') {\n    prependTo(outerGfx, childrenGfx, childrenGfx.childNodes[parentIndex]);\n  } else {\n    svgAppend(childrenGfx, outerGfx);\n  }\n\n  var gfx = svgCreate('g');\n  svgClasses(gfx).add('djs-element');\n  svgClasses(gfx).add('djs-' + type);\n\n  if (isFrame) {\n    svgClasses(gfx).add('djs-frame');\n  }\n\n  svgAppend(outerGfx, gfx);\n\n  // create visual\n  var visual = svgCreate('g');\n  svgClasses(visual).add('djs-visual');\n\n  svgAppend(gfx, visual);\n\n  return gfx;\n};\n\n/**\n * Create a graphical element.\n *\n * @param { 'shape' | 'connection' | 'label' | 'root' } type The type of the element.\n * @param {ElementLike} element The element.\n * @param {number} [parentIndex] The index at which to add the graphical element to its parent's children.\n *\n * @return {SVGElement} The graphical element.\n */\nGraphicsFactory.prototype.create = function(type, element, parentIndex) {\n  var childrenGfx = this._getChildrenContainer(element.parent);\n  return this._createContainer(type, childrenGfx, parentIndex, isFrameElement(element));\n};\n\n/**\n * Update the containments of the given elements.\n *\n * @param {ElementLike[]} elements The elements.\n */\nGraphicsFactory.prototype.updateContainments = function(elements) {\n\n  var self = this,\n      elementRegistry = this._elementRegistry,\n      parents;\n\n  parents = reduce(elements, function(map, e) {\n\n    if (e.parent) {\n      map[e.parent.id] = e.parent;\n    }\n\n    return map;\n  }, {});\n\n  // update all parents of changed and reorganized their children\n  // in the correct order (as indicated in our model)\n  forEach(parents, function(parent) {\n\n    var children = parent.children;\n\n    if (!children) {\n      return;\n    }\n\n    var childrenGfx = self._getChildrenContainer(parent);\n\n    forEach(children.slice().reverse(), function(child) {\n      var childGfx = elementRegistry.getGraphics(child);\n\n      prependTo(childGfx.parentNode, childrenGfx);\n    });\n  });\n};\n\n/**\n * Draw a shape.\n *\n * @param {SVGElement} visual The graphical element.\n * @param {ShapeLike} element The shape.\n * @param {Object} attrs Optional attributes.\n *\n * @return {SVGElement}\n */\nGraphicsFactory.prototype.drawShape = function(visual, element, attrs = {}) {\n  var eventBus = this._eventBus;\n\n  return eventBus.fire('render.shape', { gfx: visual, element, attrs });\n};\n\n/**\n * Get the path of a shape.\n *\n * @param {ShapeLike} element The shape.\n *\n * @return {string} The path of the shape.\n */\nGraphicsFactory.prototype.getShapePath = function(element) {\n  var eventBus = this._eventBus;\n\n  return eventBus.fire('render.getShapePath', element);\n};\n\n/**\n * Draw a connection.\n *\n * @param {SVGElement} visual The graphical element.\n * @param {ConnectionLike} element The connection.\n * @param {Object} attrs Optional attributes.\n *\n * @return {SVGElement}\n */\nGraphicsFactory.prototype.drawConnection = function(visual, element, attrs = {}) {\n  var eventBus = this._eventBus;\n\n  return eventBus.fire('render.connection', { gfx: visual, element, attrs });\n};\n\n/**\n * Get the path of a connection.\n *\n * @param {ConnectionLike} connection The connection.\n *\n * @return {string} The path of the connection.\n */\nGraphicsFactory.prototype.getConnectionPath = function(connection) {\n  var eventBus = this._eventBus;\n\n  return eventBus.fire('render.getConnectionPath', connection);\n};\n\n/**\n * Update an elements graphical representation.\n *\n * @param {'shape'|'connection'} type\n * @param {ElementLike} element\n * @param {SVGElement} gfx\n */\nGraphicsFactory.prototype.update = function(type, element, gfx) {\n\n  // do NOT update root element\n  if (!element.parent) {\n    return;\n  }\n\n  var visual = this._clear(gfx);\n\n  // redraw\n  if (type === 'shape') {\n    this.drawShape(visual, element);\n\n    // update positioning\n    translate(gfx, element.x, element.y);\n  } else if (type === 'connection') {\n    this.drawConnection(visual, element);\n  } else {\n    throw new Error('unknown type: ' + type);\n  }\n\n  if (element.hidden) {\n    svgAttr(gfx, 'display', 'none');\n  } else {\n    svgAttr(gfx, 'display', 'block');\n  }\n};\n\n/**\n * Remove a graphical element.\n *\n * @param {ElementLike} element The element.\n */\nGraphicsFactory.prototype.remove = function(element) {\n  var gfx = this._elementRegistry.getGraphics(element);\n\n  // remove\n  svgRemove(gfx.parentNode);\n};\n\n\n// helpers //////////\n\nfunction prependTo(newNode, parentNode, siblingNode) {\n  var node = siblingNode || parentNode.firstChild;\n\n  // do not prepend node to itself to prevent IE from crashing\n  // https://github.com/bpmn-io/bpmn-js/issues/746\n  if (newNode === node) {\n    return;\n  }\n\n  parentNode.insertBefore(newNode, node);\n}\n","import DrawModule from '../draw';\n\nimport Canvas from './Canvas';\nimport ElementRegistry from './ElementRegistry';\nimport ElementFactory from './ElementFactory';\nimport EventBus from './EventBus';\nimport GraphicsFactory from './GraphicsFactory';\n\n/**\n * @type { import('didi').ModuleDeclaration }\n */\nexport default {\n  __depends__: [ DrawModule ],\n  __init__: [ 'canvas' ],\n  canvas: [ 'type', Canvas ],\n  elementRegistry: [ 'type', ElementRegistry ],\n  elementFactory: [ 'type', ElementFactory ],\n  eventBus: [ 'type', EventBus ],\n  graphicsFactory: [ 'type', GraphicsFactory ]\n};","import { Injector } from 'didi';\n\nimport CoreModule from './core';\n\n/**\n * @typedef {import('didi').InjectionContext} InjectionContext\n * @typedef {import('didi').LocalsMap} LocalsMap\n * @typedef {import('didi').ModuleDeclaration} ModuleDeclaration\n *\n * @typedef { {\n *   modules?: ModuleDeclaration[];\n * } & Record<string, any> } DiagramOptions\n */\n\n/**\n * @template T\n * @typedef {import('didi').FactoryFunction<T>} FactoryFunction\n */\n\n/**\n * @template T\n * @typedef {import('didi').ArrayFunc<T>} ArrayFunc\n */\n\n/**\n * Bootstrap an injector from a list of modules, instantiating a number of default components\n *\n * @param {ModuleDeclaration[]} modules\n *\n * @return {Injector} a injector to use to access the components\n */\nfunction bootstrap(modules) {\n  var injector = new Injector(modules);\n\n  injector.init();\n\n  return injector;\n}\n\n/**\n * Creates an injector from passed options.\n *\n * @template ServiceMap\n * @param {DiagramOptions} [options]\n *\n * @return {Injector<ServiceMap>}\n */\nfunction createInjector(options) {\n\n  options = options || {};\n\n  /**\n   * @type { ModuleDeclaration }\n   */\n  var configModule = {\n    'config': [ 'value', options ]\n  };\n\n  var modules = [ configModule, CoreModule ].concat(options.modules || []);\n\n  return bootstrap(modules);\n}\n\n\n/**\n * The main diagram-js entry point that bootstraps the diagram with the given\n * configuration.\n *\n * To register extensions with the diagram, pass them as Array<Module> to the constructor.\n *\n * @class\n * @constructor\n * @template [ServiceMap=null]\n *\n * @example Creating a plug-in that logs whenever a shape is added to the canvas.\n *\n * ```javascript\n * // plug-in implementation\n * function MyLoggingPlugin(eventBus) {\n *   eventBus.on('shape.added', function(event) {\n *     console.log('shape ', event.shape, ' was added to the diagram');\n *   });\n * }\n *\n * // export as module\n * export default {\n *   __init__: [ 'myLoggingPlugin' ],\n *     myLoggingPlugin: [ 'type', MyLoggingPlugin ]\n * };\n * ```\n *\n * Use the plug-in in a Diagram instance:\n *\n * ```javascript\n * import MyLoggingModule from 'path-to-my-logging-plugin';\n *\n * var diagram = new Diagram({\n *   modules: [\n *     MyLoggingModule\n *   ]\n * });\n *\n * diagram.invoke([ 'canvas', function(canvas) {\n *   // add shape to drawing canvas\n *   canvas.addShape({ x: 10, y: 10 });\n * });\n *\n * // 'shape ... was added to the diagram' logged to console\n * ```\n *\n * @param {DiagramOptions} [options]\n * @param {Injector<ServiceMap>} [injector] An (optional) injector to bootstrap the diagram with.\n */\nexport default function Diagram(options, injector) {\n\n  /**\n   * @type {Injector<ServiceMap>}\n   */\n  this._injector = injector || createInjector(options);\n\n  // init\n\n  /**\n   * An event indicating that all plug-ins are loaded.\n   *\n   * Use this event to fire other events to interested plug-ins\n   *\n   * @memberOf Diagram\n   *\n   * @event diagram.init\n   *\n   * @example\n   *\n   * ```javascript\n   * eventBus.on('diagram.init', function() {\n   *   eventBus.fire('my-custom-event', { foo: 'BAR' });\n   * });\n   * ```\n   *\n   * @type {Object}\n   */\n  this.get('eventBus').fire('diagram.init');\n}\n\n/**\n * @overlord\n *\n * Resolves a diagram service.\n *\n * @template T\n *\n * @param {string} name The name of the service to get.\n *\n * @return {T}\n */\n/**\n * @overlord\n *\n * Resolves a diagram service.\n *\n * @template T\n *\n * @param {string} name The name of the service to get.\n * @param {true} strict If false, resolve missing services to null.\n *\n * @return {T}\n */\n/**\n * @overlord\n *\n * Resolves a diagram service.\n *\n * @template T\n *\n * @param {string} name The name of the service to get.\n * @param {boolean} strict If false, resolve missing services to null.\n *\n * @return {T|null}\n */\n/**\n * Resolves a diagram service.\n *\n * @template {keyof ServiceMap} Name\n *\n * @param {Name} name The name of the service to get.\n *\n * @return {ServiceMap[Name]}\n */\nDiagram.prototype.get = function(name, strict) {\n  return this._injector.get(name, strict);\n};\n\n/**\n * @overlord\n *\n * Invoke the given function, injecting dependencies. Return the result.\n *\n * @template T\n *\n * @param {FactoryFunction<T>} func\n * @param {InjectionContext} [context]\n * @param {LocalsMap} [locals]\n *\n * @return {T}\n */\n/**\n * Invoke the given function, injecting dependencies provided in\n * array notation. Return the result.\n *\n * @template T\n *\n * @param {ArrayFunc<T>} func function to be invoked\n * @param {InjectionContext} [context] context of the invocation\n * @param {LocalsMap} [locals] locals provided\n *\n * @return {T}\n */\nDiagram.prototype.invoke = function(func, context, locals) {\n  return this._injector.invoke(func, context, locals);\n};\n\n/**\n * Destroys the diagram\n */\nDiagram.prototype.destroy = function() {\n  this.get('eventBus').fire('diagram.destroy');\n};\n\n/**\n * Clear the diagram, removing all contents.\n */\nDiagram.prototype.clear = function() {\n  this.get('eventBus').fire('diagram.clear');\n};\n","/**\n * Moddle base element.\n */\nexport default function Base() { }\n\nBase.prototype.get = function(name) {\n  return this.$model.properties.get(this, name);\n};\n\nBase.prototype.set = function(name, value) {\n  this.$model.properties.set(this, name, value);\n};","import {\n  forEach,\n  bind\n} from 'min-dash';\n\nimport Base from './base.js';\n\n/**\n * A model element factory.\n *\n * @param {Moddle} model\n * @param {Properties} properties\n */\nexport default function Factory(model, properties) {\n  this.model = model;\n  this.properties = properties;\n}\n\n\nFactory.prototype.createType = function(descriptor) {\n\n  var model = this.model;\n\n  var props = this.properties,\n      prototype = Object.create(Base.prototype);\n\n  // initialize default values\n  forEach(descriptor.properties, function(p) {\n    if (!p.isMany && p.default !== undefined) {\n      prototype[p.name] = p.default;\n    }\n  });\n\n  props.defineModel(prototype, model);\n  props.defineDescriptor(prototype, descriptor);\n\n  var name = descriptor.ns.name;\n\n  /**\n   * The new type constructor\n   */\n  function ModdleElement(attrs) {\n    props.define(this, '$type', { value: name, enumerable: true });\n    props.define(this, '$attrs', { value: {} });\n    props.define(this, '$parent', { writable: true });\n\n    forEach(attrs, bind(function(val, key) {\n      this.set(key, val);\n    }, this));\n  }\n\n  ModdleElement.prototype = prototype;\n\n  ModdleElement.hasType = prototype.$instanceOf = this.model.hasType;\n\n  // static links\n  props.defineModel(ModdleElement, model);\n  props.defineDescriptor(ModdleElement, descriptor);\n\n  return ModdleElement;\n};","/**\n * Built-in moddle types\n */\nvar BUILTINS = {\n  String: true,\n  Boolean: true,\n  Integer: true,\n  Real: true,\n  Element: true\n};\n\n/**\n * Converters for built in types from string representations\n */\nvar TYPE_CONVERTERS = {\n  String: function(s) { return s; },\n  Boolean: function(s) { return s === 'true'; },\n  Integer: function(s) { return parseInt(s, 10); },\n  Real: function(s) { return parseFloat(s); }\n};\n\n/**\n * Convert a type to its real representation\n */\nexport function coerceType(type, value) {\n\n  var converter = TYPE_CONVERTERS[type];\n\n  if (converter) {\n    return converter(value);\n  } else {\n    return value;\n  }\n}\n\n/**\n * Return whether the given type is built-in\n */\nexport function isBuiltIn(type) {\n  return !!BUILTINS[type];\n}\n\n/**\n * Return whether the given type is simple\n */\nexport function isSimple(type) {\n  return !!TYPE_CONVERTERS[type];\n}","/**\n * Parses a namespaced attribute name of the form (ns:)localName to an object,\n * given a default prefix to assume in case no explicit namespace is given.\n *\n * @param {String} name\n * @param {String} [defaultPrefix] the default prefix to take, if none is present.\n *\n * @return {Object} the parsed name\n */\nexport function parseName(name, defaultPrefix) {\n  var parts = name.split(/:/),\n      localName, prefix;\n\n  // no prefix (i.e. only local name)\n  if (parts.length === 1) {\n    localName = name;\n    prefix = defaultPrefix;\n  }\n\n  // prefix + local name\n  else if (parts.length === 2) {\n    localName = parts[1];\n    prefix = parts[0];\n  }\n\n  else {\n    throw new Error('expected <prefix:localName> or <localName>, got ' + name);\n  }\n\n  name = (prefix ? prefix + ':' : '') + localName;\n\n  return {\n    name: name,\n    prefix: prefix,\n    localName: localName\n  };\n}","import {\n  pick,\n  assign,\n  forEach,\n  bind\n} from 'min-dash';\n\nimport {\n  parseName as parseNameNs\n} from './ns.js';\n\n\n/**\n * A utility to build element descriptors.\n */\nexport default function DescriptorBuilder(nameNs) {\n  this.ns = nameNs;\n  this.name = nameNs.name;\n  this.allTypes = [];\n  this.allTypesByName = {};\n  this.properties = [];\n  this.propertiesByName = {};\n}\n\n\nDescriptorBuilder.prototype.build = function() {\n  return pick(this, [\n    'ns',\n    'name',\n    'allTypes',\n    'allTypesByName',\n    'properties',\n    'propertiesByName',\n    'bodyProperty',\n    'idProperty'\n  ]);\n};\n\n/**\n * Add property at given index.\n *\n * @param {Object} p\n * @param {Number} [idx]\n * @param {Boolean} [validate=true]\n */\nDescriptorBuilder.prototype.addProperty = function(p, idx, validate) {\n\n  if (typeof idx === 'boolean') {\n    validate = idx;\n    idx = undefined;\n  }\n\n  this.addNamedProperty(p, validate !== false);\n\n  var properties = this.properties;\n\n  if (idx !== undefined) {\n    properties.splice(idx, 0, p);\n  } else {\n    properties.push(p);\n  }\n};\n\n\nDescriptorBuilder.prototype.replaceProperty = function(oldProperty, newProperty, replace) {\n  var oldNameNs = oldProperty.ns;\n\n  var props = this.properties,\n      propertiesByName = this.propertiesByName,\n      rename = oldProperty.name !== newProperty.name;\n\n  if (oldProperty.isId) {\n    if (!newProperty.isId) {\n      throw new Error(\n        'property <' + newProperty.ns.name + '> must be id property ' +\n        'to refine <' + oldProperty.ns.name + '>');\n    }\n\n    this.setIdProperty(newProperty, false);\n  }\n\n  if (oldProperty.isBody) {\n\n    if (!newProperty.isBody) {\n      throw new Error(\n        'property <' + newProperty.ns.name + '> must be body property ' +\n        'to refine <' + oldProperty.ns.name + '>');\n    }\n\n    // TODO: Check compatibility\n    this.setBodyProperty(newProperty, false);\n  }\n\n  // validate existence and get location of old property\n  var idx = props.indexOf(oldProperty);\n  if (idx === -1) {\n    throw new Error('property <' + oldNameNs.name + '> not found in property list');\n  }\n\n  // remove old property\n  props.splice(idx, 1);\n\n  // replacing the named property is intentional\n  //\n  //  * validate only if this is a \"rename\" operation\n  //  * add at specific index unless we \"replace\"\n  //\n  this.addProperty(newProperty, replace ? undefined : idx, rename);\n\n  // make new property available under old name\n  propertiesByName[oldNameNs.name] = propertiesByName[oldNameNs.localName] = newProperty;\n};\n\n\nDescriptorBuilder.prototype.redefineProperty = function(p, targetPropertyName, replace) {\n\n  var nsPrefix = p.ns.prefix;\n  var parts = targetPropertyName.split('#');\n\n  var name = parseNameNs(parts[0], nsPrefix);\n  var attrName = parseNameNs(parts[1], name.prefix).name;\n\n  var redefinedProperty = this.propertiesByName[attrName];\n  if (!redefinedProperty) {\n    throw new Error('refined property <' + attrName + '> not found');\n  } else {\n    this.replaceProperty(redefinedProperty, p, replace);\n  }\n\n  delete p.redefines;\n};\n\nDescriptorBuilder.prototype.addNamedProperty = function(p, validate) {\n  var ns = p.ns,\n      propsByName = this.propertiesByName;\n\n  if (validate) {\n    this.assertNotDefined(p, ns.name);\n    this.assertNotDefined(p, ns.localName);\n  }\n\n  propsByName[ns.name] = propsByName[ns.localName] = p;\n};\n\nDescriptorBuilder.prototype.removeNamedProperty = function(p) {\n  var ns = p.ns,\n      propsByName = this.propertiesByName;\n\n  delete propsByName[ns.name];\n  delete propsByName[ns.localName];\n};\n\nDescriptorBuilder.prototype.setBodyProperty = function(p, validate) {\n\n  if (validate && this.bodyProperty) {\n    throw new Error(\n      'body property defined multiple times ' +\n      '(<' + this.bodyProperty.ns.name + '>, <' + p.ns.name + '>)');\n  }\n\n  this.bodyProperty = p;\n};\n\nDescriptorBuilder.prototype.setIdProperty = function(p, validate) {\n\n  if (validate && this.idProperty) {\n    throw new Error(\n      'id property defined multiple times ' +\n      '(<' + this.idProperty.ns.name + '>, <' + p.ns.name + '>)');\n  }\n\n  this.idProperty = p;\n};\n\nDescriptorBuilder.prototype.assertNotTrait = function(typeDescriptor) {\n\n  const _extends = typeDescriptor.extends || [];\n\n  if (_extends.length) {\n    throw new Error(\n      `cannot create <${ typeDescriptor.name }> extending <${ typeDescriptor.extends }>`\n    );\n  }\n};\n\nDescriptorBuilder.prototype.assertNotDefined = function(p, name) {\n  var propertyName = p.name,\n      definedProperty = this.propertiesByName[propertyName];\n\n  if (definedProperty) {\n    throw new Error(\n      'property <' + propertyName + '> already defined; ' +\n      'override of <' + definedProperty.definedBy.ns.name + '#' + definedProperty.ns.name + '> by ' +\n      '<' + p.definedBy.ns.name + '#' + p.ns.name + '> not allowed without redefines');\n  }\n};\n\nDescriptorBuilder.prototype.hasProperty = function(name) {\n  return this.propertiesByName[name];\n};\n\nDescriptorBuilder.prototype.addTrait = function(t, inherited) {\n\n  if (inherited) {\n    this.assertNotTrait(t);\n  }\n\n  var typesByName = this.allTypesByName,\n      types = this.allTypes;\n\n  var typeName = t.name;\n\n  if (typeName in typesByName) {\n    return;\n  }\n\n  forEach(t.properties, bind(function(p) {\n\n    // clone property to allow extensions\n    p = assign({}, p, {\n      name: p.ns.localName,\n      inherited: inherited\n    });\n\n    Object.defineProperty(p, 'definedBy', {\n      value: t\n    });\n\n    var replaces = p.replaces,\n        redefines = p.redefines;\n\n    // add replace/redefine support\n    if (replaces || redefines) {\n      this.redefineProperty(p, replaces || redefines, replaces);\n    } else {\n      if (p.isBody) {\n        this.setBodyProperty(p);\n      }\n      if (p.isId) {\n        this.setIdProperty(p);\n      }\n      this.addProperty(p);\n    }\n  }, this));\n\n  types.push(t);\n  typesByName[typeName] = t;\n};","import {\n  assign,\n  forEach,\n  bind\n} from 'min-dash';\n\nimport {\n  isBuiltIn as isBuiltInType\n} from './types.js';\n\nimport DescriptorBuilder from './descriptor-builder.js';\n\nimport {\n  parseName as parseNameNs\n} from './ns.js';\n\n\n/**\n * A registry of Moddle packages.\n *\n * @param {Array<Package>} packages\n * @param {Properties} properties\n */\nexport default function Registry(packages, properties) {\n  this.packageMap = {};\n  this.typeMap = {};\n\n  this.packages = [];\n\n  this.properties = properties;\n\n  forEach(packages, bind(this.registerPackage, this));\n}\n\n\nRegistry.prototype.getPackage = function(uriOrPrefix) {\n  return this.packageMap[uriOrPrefix];\n};\n\nRegistry.prototype.getPackages = function() {\n  return this.packages;\n};\n\n\nRegistry.prototype.registerPackage = function(pkg) {\n\n  // copy package\n  pkg = assign({}, pkg);\n\n  var pkgMap = this.packageMap;\n\n  ensureAvailable(pkgMap, pkg, 'prefix');\n  ensureAvailable(pkgMap, pkg, 'uri');\n\n  // register types\n  forEach(pkg.types, bind(function(descriptor) {\n    this.registerType(descriptor, pkg);\n  }, this));\n\n  pkgMap[pkg.uri] = pkgMap[pkg.prefix] = pkg;\n  this.packages.push(pkg);\n};\n\n\n/**\n * Register a type from a specific package with us\n */\nRegistry.prototype.registerType = function(type, pkg) {\n\n  type = assign({}, type, {\n    superClass: (type.superClass || []).slice(),\n    extends: (type.extends || []).slice(),\n    properties: (type.properties || []).slice(),\n    meta: assign(({}, type.meta || {}))\n  });\n\n  var ns = parseNameNs(type.name, pkg.prefix),\n      name = ns.name,\n      propertiesByName = {};\n\n  // parse properties\n  forEach(type.properties, bind(function(p) {\n\n    // namespace property names\n    var propertyNs = parseNameNs(p.name, ns.prefix),\n        propertyName = propertyNs.name;\n\n    // namespace property types\n    if (!isBuiltInType(p.type)) {\n      p.type = parseNameNs(p.type, propertyNs.prefix).name;\n    }\n\n    assign(p, {\n      ns: propertyNs,\n      name: propertyName\n    });\n\n    propertiesByName[propertyName] = p;\n  }, this));\n\n  // update ns + name\n  assign(type, {\n    ns: ns,\n    name: name,\n    propertiesByName: propertiesByName\n  });\n\n  forEach(type.extends, bind(function(extendsName) {\n    var extendsNameNs = parseNameNs(extendsName, ns.prefix);\n\n    var extended = this.typeMap[extendsNameNs.name];\n\n    extended.traits = extended.traits || [];\n    extended.traits.push(name);\n  }, this));\n\n  // link to package\n  this.definePackage(type, pkg);\n\n  // register\n  this.typeMap[name] = type;\n};\n\n\n/**\n * Traverse the type hierarchy from bottom to top,\n * calling iterator with (type, inherited) for all elements in\n * the inheritance chain.\n *\n * @param {Object} nsName\n * @param {Function} iterator\n * @param {Boolean} [trait=false]\n */\nRegistry.prototype.mapTypes = function(nsName, iterator, trait) {\n\n  var type = isBuiltInType(nsName.name) ? { name: nsName.name } : this.typeMap[nsName.name];\n\n  var self = this;\n\n  /**\n   * Traverse the selected super type or trait\n   *\n   * @param {String} cls\n   * @param {Boolean} [trait=false]\n   */\n  function traverse(cls, trait) {\n    var parentNs = parseNameNs(cls, isBuiltInType(cls) ? '' : nsName.prefix);\n    self.mapTypes(parentNs, iterator, trait);\n  }\n\n  /**\n   * Traverse the selected trait.\n   *\n   * @param {String} cls\n   */\n  function traverseTrait(cls) {\n    return traverse(cls, true);\n  }\n\n  /**\n   * Traverse the selected super type\n   *\n   * @param {String} cls\n   */\n  function traverseSuper(cls) {\n    return traverse(cls, false);\n  }\n\n  if (!type) {\n    throw new Error('unknown type <' + nsName.name + '>');\n  }\n\n  forEach(type.superClass, trait ? traverseTrait : traverseSuper);\n\n  // call iterator with (type, inherited=!trait)\n  iterator(type, !trait);\n\n  forEach(type.traits, traverseTrait);\n};\n\n\n/**\n * Returns the effective descriptor for a type.\n *\n * @param  {String} type the namespaced name (ns:localName) of the type\n *\n * @return {Descriptor} the resulting effective descriptor\n */\nRegistry.prototype.getEffectiveDescriptor = function(name) {\n\n  var nsName = parseNameNs(name);\n\n  var builder = new DescriptorBuilder(nsName);\n\n  this.mapTypes(nsName, function(type, inherited) {\n    builder.addTrait(type, inherited);\n  });\n\n  var descriptor = builder.build();\n\n  // define package link\n  this.definePackage(descriptor, descriptor.allTypes[descriptor.allTypes.length - 1].$pkg);\n\n  return descriptor;\n};\n\n\nRegistry.prototype.definePackage = function(target, pkg) {\n  this.properties.define(target, '$pkg', { value: pkg });\n};\n\n\n\n// helpers ////////////////////////////\n\nfunction ensureAvailable(packageMap, pkg, identifierKey) {\n\n  var value = pkg[identifierKey];\n\n  if (value in packageMap) {\n    throw new Error('package with ' + identifierKey + ' <' + value + '> already defined');\n  }\n}\n","import {\n  assign,\n  isString\n} from 'min-dash';\n\n/**\n * A utility that gets and sets properties of model elements.\n *\n * @param {Model} model\n */\nexport default function Properties(model) {\n  this.model = model;\n}\n\n\n/**\n * Sets a named property on the target element.\n * If the value is undefined, the property gets deleted.\n *\n * @param {Object} target\n * @param {String} name\n * @param {Object} value\n */\nProperties.prototype.set = function(target, name, value) {\n\n  if (!isString(name) || !name.length) {\n    throw new TypeError('property name must be a non-empty string');\n  }\n\n  var property = this.getProperty(target, name);\n\n  var propertyName = property && property.name;\n\n  if (isUndefined(value)) {\n\n    // unset the property, if the specified value is undefined;\n    // delete from $attrs (for extensions) or the target itself\n    if (property) {\n      delete target[propertyName];\n    } else {\n      delete target.$attrs[stripGlobal(name)];\n    }\n  } else {\n\n    // set the property, defining well defined properties on the fly\n    // or simply updating them in target.$attrs (for extensions)\n    if (property) {\n      if (propertyName in target) {\n        target[propertyName] = value;\n      } else {\n        defineProperty(target, property, value);\n      }\n    } else {\n      target.$attrs[stripGlobal(name)] = value;\n    }\n  }\n};\n\n/**\n * Returns the named property of the given element\n *\n * @param  {Object} target\n * @param  {String} name\n *\n * @return {Object}\n */\nProperties.prototype.get = function(target, name) {\n\n  var property = this.getProperty(target, name);\n\n  if (!property) {\n    return target.$attrs[stripGlobal(name)];\n  }\n\n  var propertyName = property.name;\n\n  // check if access to collection property and lazily initialize it\n  if (!target[propertyName] && property.isMany) {\n    defineProperty(target, property, []);\n  }\n\n  return target[propertyName];\n};\n\n\n/**\n * Define a property on the target element\n *\n * @param  {Object} target\n * @param  {String} name\n * @param  {Object} options\n */\nProperties.prototype.define = function(target, name, options) {\n\n  if (!options.writable) {\n\n    var value = options.value;\n\n    // use getters for read-only variables to support ES6 proxies\n    // cf. https://github.com/bpmn-io/internal-docs/issues/386\n    options = assign({}, options, {\n      get: function() { return value; }\n    });\n\n    delete options.value;\n  }\n\n  Object.defineProperty(target, name, options);\n};\n\n\n/**\n * Define the descriptor for an element\n */\nProperties.prototype.defineDescriptor = function(target, descriptor) {\n  this.define(target, '$descriptor', { value: descriptor });\n};\n\n/**\n * Define the model for an element\n */\nProperties.prototype.defineModel = function(target, model) {\n  this.define(target, '$model', { value: model });\n};\n\n/**\n * Return property with the given name on the element.\n *\n * @param {any} target\n * @param {string} name\n *\n * @return {object | null} property\n */\nProperties.prototype.getProperty = function(target, name) {\n\n  var model = this.model;\n\n  var property = model.getPropertyDescriptor(target, name);\n\n  if (property) {\n    return property;\n  }\n\n  if (name.includes(':')) {\n    return null;\n  }\n\n  const strict = model.config.strict;\n\n  if (typeof strict !== 'undefined') {\n    const error = new TypeError(`unknown property <${ name }> on <${ target.$type }>`);\n\n    if (strict) {\n      throw error;\n    } else {\n\n      // eslint-disable-next-line no-undef\n      typeof console !== 'undefined' && console.warn(error);\n    }\n  }\n\n  return null;\n};\n\nfunction isUndefined(val) {\n  return typeof val === 'undefined';\n}\n\nfunction defineProperty(target, property, value) {\n  Object.defineProperty(target, property.name, {\n    enumerable: !property.isReference,\n    writable: true,\n    value: value,\n    configurable: true\n  });\n}\n\nfunction stripGlobal(name) {\n  return name.replace(/^:/, '');\n}","import {\n  isString,\n  isObject,\n  forEach,\n  set\n} from 'min-dash';\n\nimport Factory from './factory.js';\nimport Registry from './registry.js';\nimport Properties from './properties.js';\n\nimport {\n  parseName as parseNameNs\n} from './ns.js';\n\n\n// Moddle implementation /////////////////////////////////////////////////\n\n/**\n * @class Moddle\n *\n * A model that can be used to create elements of a specific type.\n *\n * @example\n *\n * var Moddle = require('moddle');\n *\n * var pkg = {\n *   name: 'mypackage',\n *   prefix: 'my',\n *   types: [\n *     { name: 'Root' }\n *   ]\n * };\n *\n * var moddle = new Moddle([pkg]);\n *\n * @param {Array<Package>} packages the packages to contain\n *\n * @param { { strict?: boolean } } [config] moddle configuration\n */\nexport default function Moddle(packages, config = {}) {\n\n  this.properties = new Properties(this);\n\n  this.factory = new Factory(this, this.properties);\n  this.registry = new Registry(packages, this.properties);\n\n  this.typeCache = {};\n\n  this.config = config;\n}\n\n\n/**\n * Create an instance of the specified type.\n *\n * @method Moddle#create\n *\n * @example\n *\n * var foo = moddle.create('my:Foo');\n * var bar = moddle.create('my:Bar', { id: 'BAR_1' });\n *\n * @param  {String|Object} descriptor the type descriptor or name know to the model\n * @param  {Object} attrs   a number of attributes to initialize the model instance with\n * @return {Object}         model instance\n */\nModdle.prototype.create = function(descriptor, attrs) {\n  var Type = this.getType(descriptor);\n\n  if (!Type) {\n    throw new Error('unknown type <' + descriptor + '>');\n  }\n\n  return new Type(attrs);\n};\n\n\n/**\n * Returns the type representing a given descriptor\n *\n * @method Moddle#getType\n *\n * @example\n *\n * var Foo = moddle.getType('my:Foo');\n * var foo = new Foo({ 'id' : 'FOO_1' });\n *\n * @param  {String|Object} descriptor the type descriptor or name know to the model\n * @return {Object}         the type representing the descriptor\n */\nModdle.prototype.getType = function(descriptor) {\n\n  var cache = this.typeCache;\n\n  var name = isString(descriptor) ? descriptor : descriptor.ns.name;\n\n  var type = cache[name];\n\n  if (!type) {\n    descriptor = this.registry.getEffectiveDescriptor(name);\n    type = cache[name] = this.factory.createType(descriptor);\n  }\n\n  return type;\n};\n\n\n/**\n * Creates an any-element type to be used within model instances.\n *\n * This can be used to create custom elements that lie outside the meta-model.\n * The created element contains all the meta-data required to serialize it\n * as part of meta-model elements.\n *\n * @method Moddle#createAny\n *\n * @example\n *\n * var foo = moddle.createAny('vendor:Foo', 'http://vendor', {\n *   value: 'bar'\n * });\n *\n * var container = moddle.create('my:Container', 'http://my', {\n *   any: [ foo ]\n * });\n *\n * // go ahead and serialize the stuff\n *\n *\n * @param  {String} name  the name of the element\n * @param  {String} nsUri the namespace uri of the element\n * @param  {Object} [properties] a map of properties to initialize the instance with\n * @return {Object} the any type instance\n */\nModdle.prototype.createAny = function(name, nsUri, properties) {\n\n  var nameNs = parseNameNs(name);\n\n  var element = {\n    $type: name,\n    $instanceOf: function(type) {\n      return type === this.$type;\n    },\n    get: function(key) {\n      return this[key];\n    },\n    set: function(key, value) {\n      set(this, [ key ], value);\n    }\n  };\n\n  var descriptor = {\n    name: name,\n    isGeneric: true,\n    ns: {\n      prefix: nameNs.prefix,\n      localName: nameNs.localName,\n      uri: nsUri\n    }\n  };\n\n  this.properties.defineDescriptor(element, descriptor);\n  this.properties.defineModel(element, this);\n  this.properties.define(element, 'get', { enumerable: false, writable: true });\n  this.properties.define(element, 'set', { enumerable: false, writable: true });\n  this.properties.define(element, '$parent', { enumerable: false, writable: true });\n  this.properties.define(element, '$instanceOf', { enumerable: false, writable: true });\n\n  forEach(properties, function(a, key) {\n    if (isObject(a) && a.value !== undefined) {\n      element[a.name] = a.value;\n    } else {\n      element[key] = a;\n    }\n  });\n\n  return element;\n};\n\n/**\n * Returns a registered package by uri or prefix\n *\n * @return {Object} the package\n */\nModdle.prototype.getPackage = function(uriOrPrefix) {\n  return this.registry.getPackage(uriOrPrefix);\n};\n\n/**\n * Returns a snapshot of all known packages\n *\n * @return {Object} the package\n */\nModdle.prototype.getPackages = function() {\n  return this.registry.getPackages();\n};\n\n/**\n * Returns the descriptor for an element\n */\nModdle.prototype.getElementDescriptor = function(element) {\n  return element.$descriptor;\n};\n\n/**\n * Returns true if the given descriptor or instance\n * represents the given type.\n *\n * May be applied to this, if element is omitted.\n */\nModdle.prototype.hasType = function(element, type) {\n  if (type === undefined) {\n    type = element;\n    element = this;\n  }\n\n  var descriptor = element.$model.getElementDescriptor(element);\n\n  return (type in descriptor.allTypesByName);\n};\n\n/**\n * Returns the descriptor of an elements named property\n */\nModdle.prototype.getPropertyDescriptor = function(element, property) {\n  return this.getElementDescriptor(element).propertiesByName[property];\n};\n\n/**\n * Returns a mapped type's descriptor\n */\nModdle.prototype.getTypeDescriptor = function(type) {\n  return this.registry.typeMap[type];\n};","var fromCharCode = String.fromCharCode;\n\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\n\nvar ENTITY_PATTERN = /&#(\\d+);|&#x([0-9a-f]+);|&(\\w+);/ig;\n\nvar ENTITY_MAPPING = {\n  'amp': '&',\n  'apos': '\\'',\n  'gt': '>',\n  'lt': '<',\n  'quot': '\"'\n};\n\n// map UPPERCASE variants of supported special chars\nObject.keys(ENTITY_MAPPING).forEach(function(k) {\n  ENTITY_MAPPING[k.toUpperCase()] = ENTITY_MAPPING[k];\n});\n\n\nfunction replaceEntities(_, d, x, z) {\n\n  // reserved names, i.e. &nbsp;\n  if (z) {\n    if (hasOwnProperty.call(ENTITY_MAPPING, z)) {\n      return ENTITY_MAPPING[z];\n    } else {\n\n      // fall back to original value\n      return '&' + z + ';';\n    }\n  }\n\n  // decimal encoded char\n  if (d) {\n    return fromCharCode(d);\n  }\n\n  // hex encoded char\n  return fromCharCode(parseInt(x, 16));\n}\n\n\n/**\n * A basic entity decoder that can decode a minimal\n * sub-set of reserved names (&amp;) as well as\n * hex (&#xaaf;) and decimal (&#1231;) encoded characters.\n *\n * @param {string} s\n *\n * @return {string} decoded string\n */\nexport default function decodeEntities(s) {\n  if (s.length > 3 && s.indexOf('&') !== -1) {\n    return s.replace(ENTITY_PATTERN, replaceEntities);\n  }\n\n  return s;\n}","import decodeEntities from './decode.js';\n\nvar NON_WHITESPACE_OUTSIDE_ROOT_NODE = 'non-whitespace outside of root node';\n\nfunction error(msg) {\n  return new Error(msg);\n}\n\nfunction missingNamespaceForPrefix(prefix) {\n  return 'missing namespace for prefix <' + prefix + '>';\n}\n\nfunction getter(getFn) {\n  return {\n    'get': getFn,\n    'enumerable': true\n  };\n}\n\nfunction cloneNsMatrix(nsMatrix) {\n  var clone = {}, key;\n  for (key in nsMatrix) {\n    clone[key] = nsMatrix[key];\n  }\n  return clone;\n}\n\nfunction uriPrefix(prefix) {\n  return prefix + '$uri';\n}\n\nfunction buildNsMatrix(nsUriToPrefix) {\n  var nsMatrix = {},\n      uri,\n      prefix;\n\n  for (uri in nsUriToPrefix) {\n    prefix = nsUriToPrefix[uri];\n    nsMatrix[prefix] = prefix;\n    nsMatrix[uriPrefix(prefix)] = uri;\n  }\n\n  return nsMatrix;\n}\n\nfunction noopGetContext() {\n  return { line: 0, column: 0 };\n}\n\nfunction throwFunc(err) {\n  throw err;\n}\n\n/**\n * Creates a new parser with the given options.\n *\n * @constructor\n *\n * @param  {!Object<string, ?>=} options\n */\nexport default function Parser(options) {\n\n  if (!this) {\n    return new Parser(options);\n  }\n\n  var proxy = options && options['proxy'];\n\n  var onText,\n      onOpenTag,\n      onCloseTag,\n      onCDATA,\n      onError = throwFunc,\n      onWarning,\n      onComment,\n      onQuestion,\n      onAttention;\n\n  var getContext = noopGetContext;\n\n  /**\n   * Do we need to parse the current elements attributes for namespaces?\n   *\n   * @type {boolean}\n   */\n  var maybeNS = false;\n\n  /**\n   * Do we process namespaces at all?\n   *\n   * @type {boolean}\n   */\n  var isNamespace = false;\n\n  /**\n   * The caught error returned on parse end\n   *\n   * @type {Error}\n   */\n  var returnError = null;\n\n  /**\n   * Should we stop parsing?\n   *\n   * @type {boolean}\n   */\n  var parseStop = false;\n\n  /**\n   * A map of { uri: prefix } used by the parser.\n   *\n   * This map will ensure we can normalize prefixes during processing;\n   * for each uri, only one prefix will be exposed to the handlers.\n   *\n   * @type {!Object<string, string>}}\n   */\n  var nsUriToPrefix;\n\n  /**\n   * Handle parse error.\n   *\n   * @param  {string|Error} err\n   */\n  function handleError(err) {\n    if (!(err instanceof Error)) {\n      err = error(err);\n    }\n\n    returnError = err;\n\n    onError(err, getContext);\n  }\n\n  /**\n   * Handle parse error.\n   *\n   * @param  {string|Error} err\n   */\n  function handleWarning(err) {\n\n    if (!onWarning) {\n      return;\n    }\n\n    if (!(err instanceof Error)) {\n      err = error(err);\n    }\n\n    onWarning(err, getContext);\n  }\n\n  /**\n   * Register parse listener.\n   *\n   * @param  {string}   name\n   * @param  {Function} cb\n   *\n   * @return {Parser}\n   */\n  this['on'] = function(name, cb) {\n\n    if (typeof cb !== 'function') {\n      throw error('required args <name, cb>');\n    }\n\n    switch (name) {\n    case 'openTag': onOpenTag = cb; break;\n    case 'text': onText = cb; break;\n    case 'closeTag': onCloseTag = cb; break;\n    case 'error': onError = cb; break;\n    case 'warn': onWarning = cb; break;\n    case 'cdata': onCDATA = cb; break;\n    case 'attention': onAttention = cb; break; // <!XXXXX zzzz=\"eeee\">\n    case 'question': onQuestion = cb; break; // <? ....  ?>\n    case 'comment': onComment = cb; break;\n    default:\n      throw error('unsupported event: ' + name);\n    }\n\n    return this;\n  };\n\n  /**\n   * Set the namespace to prefix mapping.\n   *\n   * @example\n   *\n   * parser.ns({\n   *   'http://foo': 'foo',\n   *   'http://bar': 'bar'\n   * });\n   *\n   * @param  {!Object<string, string>} nsMap\n   *\n   * @return {Parser}\n   */\n  this['ns'] = function(nsMap) {\n\n    if (typeof nsMap === 'undefined') {\n      nsMap = {};\n    }\n\n    if (typeof nsMap !== 'object') {\n      throw error('required args <nsMap={}>');\n    }\n\n    var _nsUriToPrefix = {}, k;\n\n    for (k in nsMap) {\n      _nsUriToPrefix[k] = nsMap[k];\n    }\n\n    isNamespace = true;\n    nsUriToPrefix = _nsUriToPrefix;\n\n    return this;\n  };\n\n  /**\n   * Parse xml string.\n   *\n   * @param  {string} xml\n   *\n   * @return {Error} returnError, if not thrown\n   */\n  this['parse'] = function(xml) {\n    if (typeof xml !== 'string') {\n      throw error('required args <xml=string>');\n    }\n\n    returnError = null;\n\n    parse(xml);\n\n    getContext = noopGetContext;\n    parseStop = false;\n\n    return returnError;\n  };\n\n  /**\n   * Stop parsing.\n   */\n  this['stop'] = function() {\n    parseStop = true;\n  };\n\n  /**\n   * Parse string, invoking configured listeners on element.\n   *\n   * @param  {string} xml\n   */\n  function parse(xml) {\n    var nsMatrixStack = isNamespace ? [] : null,\n        nsMatrix = isNamespace ? buildNsMatrix(nsUriToPrefix) : null,\n        _nsMatrix,\n        nodeStack = [],\n        anonymousNsCount = 0,\n        tagStart = false,\n        tagEnd = false,\n        i = 0, j = 0,\n        x, y, q, w, v,\n        xmlns,\n        elementName,\n        _elementName,\n        elementProxy\n        ;\n\n    var attrsString = '',\n        attrsStart = 0,\n        cachedAttrs // false = parsed with errors, null = needs parsing\n        ;\n\n    /**\n     * Parse attributes on demand and returns the parsed attributes.\n     *\n     * Return semantics: (1) `false` on attribute parse error,\n     * (2) object hash on extracted attrs.\n     *\n     * @return {boolean|Object}\n     */\n    function getAttrs() {\n      if (cachedAttrs !== null) {\n        return cachedAttrs;\n      }\n\n      var nsUri,\n          nsUriPrefix,\n          nsName,\n          defaultAlias = isNamespace && nsMatrix['xmlns'],\n          attrList = isNamespace && maybeNS ? [] : null,\n          i = attrsStart,\n          s = attrsString,\n          l = s.length,\n          hasNewMatrix,\n          newalias,\n          value,\n          alias,\n          name,\n          attrs = {},\n          seenAttrs = {},\n          skipAttr,\n          w,\n          j;\n\n      parseAttr:\n      for (; i < l; i++) {\n        skipAttr = false;\n        w = s.charCodeAt(i);\n\n        if (w === 32 || (w < 14 && w > 8)) { // WHITESPACE={ \\f\\n\\r\\t\\v}\n          continue;\n        }\n\n        // wait for non whitespace character\n        if (w < 65 || w > 122 || (w > 90 && w < 97)) {\n          if (w !== 95 && w !== 58) { // char 95\"_\" 58\":\"\n            handleWarning('illegal first char attribute name');\n            skipAttr = true;\n          }\n        }\n\n        // parse attribute name\n        for (j = i + 1; j < l; j++) {\n          w = s.charCodeAt(j);\n\n          if (\n            w > 96 && w < 123 ||\n            w > 64 && w < 91 ||\n            w > 47 && w < 59 ||\n            w === 46 || // '.'\n            w === 45 || // '-'\n            w === 95 // '_'\n          ) {\n            continue;\n          }\n\n          // unexpected whitespace\n          if (w === 32 || (w < 14 && w > 8)) { // WHITESPACE\n            handleWarning('missing attribute value');\n            i = j;\n\n            continue parseAttr;\n          }\n\n          // expected \"=\"\n          if (w === 61) { // \"=\" == 61\n            break;\n          }\n\n          handleWarning('illegal attribute name char');\n          skipAttr = true;\n        }\n\n        name = s.substring(i, j);\n\n        if (name === 'xmlns:xmlns') {\n          handleWarning('illegal declaration of xmlns');\n          skipAttr = true;\n        }\n\n        w = s.charCodeAt(j + 1);\n\n        if (w === 34) { // '\"'\n          j = s.indexOf('\"', i = j + 2);\n\n          if (j === -1) {\n            j = s.indexOf('\\'', i);\n\n            if (j !== -1) {\n              handleWarning('attribute value quote missmatch');\n              skipAttr = true;\n            }\n          }\n\n        } else if (w === 39) { // \"'\"\n          j = s.indexOf('\\'', i = j + 2);\n\n          if (j === -1) {\n            j = s.indexOf('\"', i);\n\n            if (j !== -1) {\n              handleWarning('attribute value quote missmatch');\n              skipAttr = true;\n            }\n          }\n\n        } else {\n          handleWarning('missing attribute value quotes');\n          skipAttr = true;\n\n          // skip to next space\n          for (j = j + 1; j < l; j++) {\n            w = s.charCodeAt(j + 1);\n\n            if (w === 32 || (w < 14 && w > 8)) { // WHITESPACE\n              break;\n            }\n          }\n\n        }\n\n        if (j === -1) {\n          handleWarning('missing closing quotes');\n\n          j = l;\n          skipAttr = true;\n        }\n\n        if (!skipAttr) {\n          value = s.substring(i, j);\n        }\n\n        i = j;\n\n        // ensure SPACE follows attribute\n        // skip illegal content otherwise\n        // example a=\"b\"c\n        for (; j + 1 < l; j++) {\n          w = s.charCodeAt(j + 1);\n\n          if (w === 32 || (w < 14 && w > 8)) { // WHITESPACE\n            break;\n          }\n\n          // FIRST ILLEGAL CHAR\n          if (i === j) {\n            handleWarning('illegal character after attribute end');\n            skipAttr = true;\n          }\n        }\n\n        // advance cursor to next attribute\n        i = j + 1;\n\n        if (skipAttr) {\n          continue parseAttr;\n        }\n\n        // check attribute re-declaration\n        if (name in seenAttrs) {\n          handleWarning('attribute <' + name + '> already defined');\n          continue;\n        }\n\n        seenAttrs[name] = true;\n\n        if (!isNamespace) {\n          attrs[name] = value;\n          continue;\n        }\n\n        // try to extract namespace information\n        if (maybeNS) {\n          newalias = (\n            name === 'xmlns'\n              ? 'xmlns'\n              : (name.charCodeAt(0) === 120 && name.substr(0, 6) === 'xmlns:')\n                ? name.substr(6)\n                : null\n          );\n\n          // handle xmlns(:alias) assignment\n          if (newalias !== null) {\n            nsUri = decodeEntities(value);\n            nsUriPrefix = uriPrefix(newalias);\n\n            alias = nsUriToPrefix[nsUri];\n\n            if (!alias) {\n\n              // no prefix defined or prefix collision\n              if (\n                (newalias === 'xmlns') ||\n                (nsUriPrefix in nsMatrix && nsMatrix[nsUriPrefix] !== nsUri)\n              ) {\n\n                // alocate free ns prefix\n                do {\n                  alias = 'ns' + (anonymousNsCount++);\n                } while (typeof nsMatrix[alias] !== 'undefined');\n              } else {\n                alias = newalias;\n              }\n\n              nsUriToPrefix[nsUri] = alias;\n            }\n\n            if (nsMatrix[newalias] !== alias) {\n              if (!hasNewMatrix) {\n                nsMatrix = cloneNsMatrix(nsMatrix);\n                hasNewMatrix = true;\n              }\n\n              nsMatrix[newalias] = alias;\n              if (newalias === 'xmlns') {\n                nsMatrix[uriPrefix(alias)] = nsUri;\n                defaultAlias = alias;\n              }\n\n              nsMatrix[nsUriPrefix] = nsUri;\n            }\n\n            // expose xmlns(:asd)=\"...\" in attributes\n            attrs[name] = value;\n            continue;\n          }\n\n          // collect attributes until all namespace\n          // declarations are processed\n          attrList.push(name, value);\n          continue;\n\n        } /** end if (maybeNs) */\n\n        // handle attributes on element without\n        // namespace declarations\n        w = name.indexOf(':');\n        if (w === -1) {\n          attrs[name] = value;\n          continue;\n        }\n\n        // normalize ns attribute name\n        if (!(nsName = nsMatrix[name.substring(0, w)])) {\n          handleWarning(missingNamespaceForPrefix(name.substring(0, w)));\n          continue;\n        }\n\n        name = defaultAlias === nsName\n          ? name.substr(w + 1)\n          : nsName + name.substr(w);\n\n        // end: normalize ns attribute name\n\n        attrs[name] = value;\n      }\n\n\n      // handle deferred, possibly namespaced attributes\n      if (maybeNS) {\n\n        // normalize captured attributes\n        for (i = 0, l = attrList.length; i < l; i++) {\n\n          name = attrList[i++];\n          value = attrList[i];\n\n          w = name.indexOf(':');\n\n          if (w !== -1) {\n\n            // normalize ns attribute name\n            if (!(nsName = nsMatrix[name.substring(0, w)])) {\n              handleWarning(missingNamespaceForPrefix(name.substring(0, w)));\n              continue;\n            }\n\n            name = defaultAlias === nsName\n              ? name.substr(w + 1)\n              : nsName + name.substr(w);\n\n            // end: normalize ns attribute name\n          }\n\n          attrs[name] = value;\n        }\n\n        // end: normalize captured attributes\n      }\n\n      return cachedAttrs = attrs;\n    }\n\n    /**\n     * Extract the parse context { line, column, part }\n     * from the current parser position.\n     *\n     * @return {Object} parse context\n     */\n    function getParseContext() {\n      var splitsRe = /(\\r\\n|\\r|\\n)/g;\n\n      var line = 0;\n      var column = 0;\n      var startOfLine = 0;\n      var endOfLine = j;\n      var match;\n      var data;\n\n      while (i >= startOfLine) {\n\n        match = splitsRe.exec(xml);\n\n        if (!match) {\n          break;\n        }\n\n        // end of line = (break idx + break chars)\n        endOfLine = match[0].length + match.index;\n\n        if (endOfLine > i) {\n          break;\n        }\n\n        // advance to next line\n        line += 1;\n\n        startOfLine = endOfLine;\n      }\n\n      // EOF errors\n      if (i == -1) {\n        column = endOfLine;\n        data = xml.substring(j);\n      } else\n\n      // start errors\n      if (j === 0) {\n        data = xml.substring(j, i);\n      }\n\n      // other errors\n      else {\n        column = i - startOfLine;\n        data = (j == -1 ? xml.substring(i) : xml.substring(i, j + 1));\n      }\n\n      return {\n        'data': data,\n        'line': line,\n        'column': column\n      };\n    }\n\n    getContext = getParseContext;\n\n\n    if (proxy) {\n      elementProxy = Object.create({}, {\n        'name': getter(function() {\n          return elementName;\n        }),\n        'originalName': getter(function() {\n          return _elementName;\n        }),\n        'attrs': getter(getAttrs),\n        'ns': getter(function() {\n          return nsMatrix;\n        })\n      });\n    }\n\n    // actual parse logic\n    while (j !== -1) {\n\n      if (xml.charCodeAt(j) === 60) { // \"<\"\n        i = j;\n      } else {\n        i = xml.indexOf('<', j);\n      }\n\n      // parse end\n      if (i === -1) {\n        if (nodeStack.length) {\n          return handleError('unexpected end of file');\n        }\n\n        if (j === 0) {\n          return handleError('missing start tag');\n        }\n\n        if (j < xml.length) {\n          if (xml.substring(j).trim()) {\n            handleWarning(NON_WHITESPACE_OUTSIDE_ROOT_NODE);\n          }\n        }\n\n        return;\n      }\n\n      // parse text\n      if (j !== i) {\n\n        if (nodeStack.length) {\n          if (onText) {\n            onText(xml.substring(j, i), decodeEntities, getContext);\n\n            if (parseStop) {\n              return;\n            }\n          }\n        } else {\n          if (xml.substring(j, i).trim()) {\n            handleWarning(NON_WHITESPACE_OUTSIDE_ROOT_NODE);\n\n            if (parseStop) {\n              return;\n            }\n          }\n        }\n      }\n\n      w = xml.charCodeAt(i + 1);\n\n      // parse comments + CDATA\n      if (w === 33) { // \"!\"\n        q = xml.charCodeAt(i + 2);\n\n        // CDATA section\n        if (q === 91 && xml.substr(i + 3, 6) === 'CDATA[') { // 91 == \"[\"\n          j = xml.indexOf(']]>', i);\n          if (j === -1) {\n            return handleError('unclosed cdata');\n          }\n\n          if (onCDATA) {\n            onCDATA(xml.substring(i + 9, j), getContext);\n            if (parseStop) {\n              return;\n            }\n          }\n\n          j += 3;\n          continue;\n        }\n\n        // comment\n        if (q === 45 && xml.charCodeAt(i + 3) === 45) { // 45 == \"-\"\n          j = xml.indexOf('-->', i);\n          if (j === -1) {\n            return handleError('unclosed comment');\n          }\n\n\n          if (onComment) {\n            onComment(xml.substring(i + 4, j), decodeEntities, getContext);\n            if (parseStop) {\n              return;\n            }\n          }\n\n          j += 3;\n          continue;\n        }\n      }\n\n      // parse question <? ... ?>\n      if (w === 63) { // \"?\"\n        j = xml.indexOf('?>', i);\n        if (j === -1) {\n          return handleError('unclosed question');\n        }\n\n        if (onQuestion) {\n          onQuestion(xml.substring(i, j + 2), getContext);\n          if (parseStop) {\n            return;\n          }\n        }\n\n        j += 2;\n        continue;\n      }\n\n      // find matching closing tag for attention or standard tags\n      // for that we must skip through attribute values\n      // (enclosed in single or double quotes)\n      for (x = i + 1; ; x++) {\n        v = xml.charCodeAt(x);\n        if (isNaN(v)) {\n          j = -1;\n          return handleError('unclosed tag');\n        }\n\n        // [10] AttValue ::= '\"' ([^<&\"] | Reference)* '\"' | \"'\" ([^<&'] | Reference)* \"'\"\n        // skips the quoted string\n        // (double quotes) does not appear in a literal enclosed by (double quotes)\n        // (single quote) does not appear in a literal enclosed by (single quote)\n        if (v === 34) { //  '\"'\n          q = xml.indexOf('\"', x + 1);\n          x = q !== -1 ? q : x;\n        } else if (v === 39) { // \"'\"\n          q = xml.indexOf(\"'\", x + 1);\n          x = q !== -1 ? q : x;\n        } else if (v === 62) { // '>'\n          j = x;\n          break;\n        }\n      }\n\n\n      // parse attention <! ...>\n      // previously comment and CDATA have already been parsed\n      if (w === 33) { // \"!\"\n\n        if (onAttention) {\n          onAttention(xml.substring(i, j + 1), decodeEntities, getContext);\n          if (parseStop) {\n            return;\n          }\n        }\n\n        j += 1;\n        continue;\n      }\n\n      // don't process attributes;\n      // there are none\n      cachedAttrs = {};\n\n      // if (xml.charCodeAt(i+1) === 47) { // </...\n      if (w === 47) { // </...\n        tagStart = false;\n        tagEnd = true;\n\n        if (!nodeStack.length) {\n          return handleError('missing open tag');\n        }\n\n        // verify open <-> close tag match\n        x = elementName = nodeStack.pop();\n        q = i + 2 + x.length;\n\n        if (xml.substring(i + 2, q) !== x) {\n          return handleError('closing tag mismatch');\n        }\n\n        // verify chars in close tag\n        for (; q < j; q++) {\n          w = xml.charCodeAt(q);\n\n          if (w === 32 || (w > 8 && w < 14)) { // \\f\\n\\r\\t\\v space\n            continue;\n          }\n\n          return handleError('close tag');\n        }\n\n      } else {\n        if (xml.charCodeAt(j - 1) === 47) { // .../>\n          x = elementName = xml.substring(i + 1, j - 1);\n\n          tagStart = true;\n          tagEnd = true;\n\n        } else {\n          x = elementName = xml.substring(i + 1, j);\n\n          tagStart = true;\n          tagEnd = false;\n        }\n\n        if (!(w > 96 && w < 123 || w > 64 && w < 91 || w === 95 || w === 58)) { // char 95\"_\" 58\":\"\n          return handleError('illegal first char nodeName');\n        }\n\n        for (q = 1, y = x.length; q < y; q++) {\n          w = x.charCodeAt(q);\n\n          if (w > 96 && w < 123 || w > 64 && w < 91 || w > 47 && w < 59 || w === 45 || w === 95 || w == 46) {\n            continue;\n          }\n\n          if (w === 32 || (w < 14 && w > 8)) { // \\f\\n\\r\\t\\v space\n            elementName = x.substring(0, q);\n\n            // maybe there are attributes\n            cachedAttrs = null;\n            break;\n          }\n\n          return handleError('invalid nodeName');\n        }\n\n        if (!tagEnd) {\n          nodeStack.push(elementName);\n        }\n      }\n\n      if (isNamespace) {\n\n        _nsMatrix = nsMatrix;\n\n        if (tagStart) {\n\n          // remember old namespace\n          // unless we're self-closing\n          if (!tagEnd) {\n            nsMatrixStack.push(_nsMatrix);\n          }\n\n          if (cachedAttrs === null) {\n\n            // quick check, whether there may be namespace\n            // declarations on the node; if that is the case\n            // we need to eagerly parse the node attributes\n            if ((maybeNS = x.indexOf('xmlns', q) !== -1)) {\n              attrsStart = q;\n              attrsString = x;\n\n              getAttrs();\n\n              maybeNS = false;\n            }\n          }\n        }\n\n        _elementName = elementName;\n\n        w = elementName.indexOf(':');\n        if (w !== -1) {\n          xmlns = nsMatrix[elementName.substring(0, w)];\n\n          // prefix given; namespace must exist\n          if (!xmlns) {\n            return handleError('missing namespace on <' + _elementName + '>');\n          }\n\n          elementName = elementName.substr(w + 1);\n        } else {\n          xmlns = nsMatrix['xmlns'];\n\n          // if no default namespace is defined,\n          // we'll import the element as anonymous.\n          //\n          // it is up to users to correct that to the document defined\n          // targetNamespace, or whatever their undersanding of the\n          // XML spec mandates.\n        }\n\n        // adjust namespace prefixs as configured\n        if (xmlns) {\n          elementName = xmlns + ':' + elementName;\n        }\n\n      }\n\n      if (tagStart) {\n        attrsStart = q;\n        attrsString = x;\n\n        if (onOpenTag) {\n          if (proxy) {\n            onOpenTag(elementProxy, decodeEntities, tagEnd, getContext);\n          } else {\n            onOpenTag(elementName, getAttrs, decodeEntities, tagEnd, getContext);\n          }\n\n          if (parseStop) {\n            return;\n          }\n        }\n\n      }\n\n      if (tagEnd) {\n\n        if (onCloseTag) {\n          onCloseTag(proxy ? elementProxy : elementName, decodeEntities, tagStart, getContext);\n\n          if (parseStop) {\n            return;\n          }\n        }\n\n        // restore old namespace\n        if (isNamespace) {\n          if (!tagStart) {\n            nsMatrix = nsMatrixStack.pop();\n          } else {\n            nsMatrix = _nsMatrix;\n          }\n        }\n      }\n\n      j += 1;\n    }\n  } /** end parse */\n\n}","export function hasLowerCaseAlias(pkg) {\n  return pkg.xml && pkg.xml.tagAlias === 'lowerCase';\n}\n\nexport var DEFAULT_NS_MAP = {\n  'xsi': 'http://www.w3.org/2001/XMLSchema-instance',\n  'xml': 'http://www.w3.org/XML/1998/namespace'\n};\n\nexport var SERIALIZE_PROPERTY = 'property';\n\nexport function getSerialization(element) {\n  return element.xml && element.xml.serialize;\n}\n\nexport function getSerializationType(element) {\n  const type = getSerialization(element);\n\n  return type !== SERIALIZE_PROPERTY && (type || null);\n}","import {\n  forEach,\n  find,\n  assign\n} from 'min-dash';\n\nimport {\n  Parser as SaxParser\n} from 'saxen';\n\nimport {\n  Moddle,\n  parseNameNS,\n  coerceType,\n  isSimpleType\n} from 'moddle';\n\nimport {\n  DEFAULT_NS_MAP,\n  getSerializationType,\n  hasLowerCaseAlias\n} from './common.js';\n\nfunction capitalize(str) {\n  return str.charAt(0).toUpperCase() + str.slice(1);\n}\n\nfunction aliasToName(aliasNs, pkg) {\n\n  if (!hasLowerCaseAlias(pkg)) {\n    return aliasNs.name;\n  }\n\n  return aliasNs.prefix + ':' + capitalize(aliasNs.localName);\n}\n\n/**\n * Un-prefix a potentially prefixed type name.\n *\n * @param {NsName} nameNs\n * @param {Object} [pkg]\n *\n * @return {string}\n */\nfunction prefixedToName(nameNs, pkg) {\n\n  var name = nameNs.name,\n      localName = nameNs.localName;\n\n  var typePrefix = pkg && pkg.xml && pkg.xml.typePrefix;\n\n  if (typePrefix && localName.indexOf(typePrefix) === 0) {\n    return nameNs.prefix + ':' + localName.slice(typePrefix.length);\n  } else {\n    return name;\n  }\n}\n\nfunction normalizeTypeName(name, nsMap, model) {\n\n  // normalize against actual NS\n  const nameNs = parseNameNS(name, nsMap.xmlns);\n\n  const normalizedName = `${ nsMap[nameNs.prefix] || nameNs.prefix }:${ nameNs.localName }`;\n\n  const normalizedNameNs = parseNameNS(normalizedName);\n\n  // determine actual type name, based on package-defined prefix\n  var pkg = model.getPackage(normalizedNameNs.prefix);\n\n  return prefixedToName(normalizedNameNs, pkg);\n}\n\nfunction error(message) {\n  return new Error(message);\n}\n\n/**\n * Get the moddle descriptor for a given instance or type.\n *\n * @param  {ModdleElement|Function} element\n *\n * @return {Object} the moddle descriptor\n */\nfunction getModdleDescriptor(element) {\n  return element.$descriptor;\n}\n\n\n/**\n * A parse context.\n *\n * @class\n *\n * @param {Object} options\n * @param {ElementHandler} options.rootHandler the root handler for parsing a document\n * @param {boolean} [options.lax=false] whether or not to ignore invalid elements\n */\nexport function Context(options) {\n\n  /**\n   * @property {ElementHandler} rootHandler\n   */\n\n  /**\n   * @property {Boolean} lax\n   */\n\n  assign(this, options);\n\n  this.elementsById = {};\n  this.references = [];\n  this.warnings = [];\n\n  /**\n   * Add an unresolved reference.\n   *\n   * @param {Object} reference\n   */\n  this.addReference = function(reference) {\n    this.references.push(reference);\n  };\n\n  /**\n   * Add a processed element.\n   *\n   * @param {ModdleElement} element\n   */\n  this.addElement = function(element) {\n\n    if (!element) {\n      throw error('expected element');\n    }\n\n    var elementsById = this.elementsById;\n\n    var descriptor = getModdleDescriptor(element);\n\n    var idProperty = descriptor.idProperty,\n        id;\n\n    if (idProperty) {\n      id = element.get(idProperty.name);\n\n      if (id) {\n\n        // for QName validation as per http://www.w3.org/TR/REC-xml/#NT-NameChar\n        if (!/^([a-z][\\w-.]*:)?[a-z_][\\w-.]*$/i.test(id)) {\n          throw new Error('illegal ID <' + id + '>');\n        }\n\n        if (elementsById[id]) {\n          throw error('duplicate ID <' + id + '>');\n        }\n\n        elementsById[id] = element;\n      }\n    }\n  };\n\n  /**\n   * Add an import warning.\n   *\n   * @param {Object} warning\n   * @param {String} warning.message\n   * @param {Error} [warning.error]\n   */\n  this.addWarning = function(warning) {\n    this.warnings.push(warning);\n  };\n}\n\nfunction BaseHandler() {}\n\nBaseHandler.prototype.handleEnd = function() {};\nBaseHandler.prototype.handleText = function() {};\nBaseHandler.prototype.handleNode = function() {};\n\n\n/**\n * A simple pass through handler that does nothing except for\n * ignoring all input it receives.\n *\n * This is used to ignore unknown elements and\n * attributes.\n */\nfunction NoopHandler() { }\n\nNoopHandler.prototype = Object.create(BaseHandler.prototype);\n\nNoopHandler.prototype.handleNode = function() {\n  return this;\n};\n\nfunction BodyHandler() {}\n\nBodyHandler.prototype = Object.create(BaseHandler.prototype);\n\nBodyHandler.prototype.handleText = function(text) {\n  this.body = (this.body || '') + text;\n};\n\nfunction ReferenceHandler(property, context) {\n  this.property = property;\n  this.context = context;\n}\n\nReferenceHandler.prototype = Object.create(BodyHandler.prototype);\n\nReferenceHandler.prototype.handleNode = function(node) {\n\n  if (this.element) {\n    throw error('expected no sub nodes');\n  } else {\n    this.element = this.createReference(node);\n  }\n\n  return this;\n};\n\nReferenceHandler.prototype.handleEnd = function() {\n  this.element.id = this.body;\n};\n\nReferenceHandler.prototype.createReference = function(node) {\n  return {\n    property: this.property.ns.name,\n    id: ''\n  };\n};\n\nfunction ValueHandler(propertyDesc, element) {\n  this.element = element;\n  this.propertyDesc = propertyDesc;\n}\n\nValueHandler.prototype = Object.create(BodyHandler.prototype);\n\nValueHandler.prototype.handleEnd = function() {\n\n  var value = this.body || '',\n      element = this.element,\n      propertyDesc = this.propertyDesc;\n\n  value = coerceType(propertyDesc.type, value);\n\n  if (propertyDesc.isMany) {\n    element.get(propertyDesc.name).push(value);\n  } else {\n    element.set(propertyDesc.name, value);\n  }\n};\n\n\nfunction BaseElementHandler() {}\n\nBaseElementHandler.prototype = Object.create(BodyHandler.prototype);\n\nBaseElementHandler.prototype.handleNode = function(node) {\n  var parser = this,\n      element = this.element;\n\n  if (!element) {\n    element = this.element = this.createElement(node);\n\n    this.context.addElement(element);\n  } else {\n    parser = this.handleChild(node);\n  }\n\n  return parser;\n};\n\n/**\n * @class Reader.ElementHandler\n *\n */\nexport function ElementHandler(model, typeName, context) {\n  this.model = model;\n  this.type = model.getType(typeName);\n  this.context = context;\n}\n\nElementHandler.prototype = Object.create(BaseElementHandler.prototype);\n\nElementHandler.prototype.addReference = function(reference) {\n  this.context.addReference(reference);\n};\n\nElementHandler.prototype.handleText = function(text) {\n\n  var element = this.element,\n      descriptor = getModdleDescriptor(element),\n      bodyProperty = descriptor.bodyProperty;\n\n  if (!bodyProperty) {\n    throw error('unexpected body text <' + text + '>');\n  }\n\n  BodyHandler.prototype.handleText.call(this, text);\n};\n\nElementHandler.prototype.handleEnd = function() {\n\n  var value = this.body,\n      element = this.element,\n      descriptor = getModdleDescriptor(element),\n      bodyProperty = descriptor.bodyProperty;\n\n  if (bodyProperty && value !== undefined) {\n    value = coerceType(bodyProperty.type, value);\n    element.set(bodyProperty.name, value);\n  }\n};\n\n/**\n * Create an instance of the model from the given node.\n *\n * @param  {Element} node the xml node\n */\nElementHandler.prototype.createElement = function(node) {\n  var attributes = node.attributes,\n      Type = this.type,\n      descriptor = getModdleDescriptor(Type),\n      context = this.context,\n      instance = new Type({}),\n      model = this.model,\n      propNameNs;\n\n  forEach(attributes, function(value, name) {\n\n    var prop = descriptor.propertiesByName[name],\n        values;\n\n    if (prop && prop.isReference) {\n\n      if (!prop.isMany) {\n        context.addReference({\n          element: instance,\n          property: prop.ns.name,\n          id: value\n        });\n      } else {\n\n        // IDREFS: parse references as whitespace-separated list\n        values = value.split(' ');\n\n        forEach(values, function(v) {\n          context.addReference({\n            element: instance,\n            property: prop.ns.name,\n            id: v\n          });\n        });\n      }\n\n    } else {\n      if (prop) {\n        value = coerceType(prop.type, value);\n      } else if (name === 'xmlns') {\n        name = ':' + name;\n      } else {\n        propNameNs = parseNameNS(name, descriptor.ns.prefix);\n\n        // check whether attribute is defined in a well-known namespace\n        // if that is the case we emit a warning to indicate potential misuse\n        if (model.getPackage(propNameNs.prefix)) {\n\n          context.addWarning({\n            message: 'unknown attribute <' + name + '>',\n            element: instance,\n            property: name,\n            value: value\n          });\n        }\n      }\n\n      instance.set(name, value);\n    }\n  });\n\n  return instance;\n};\n\nElementHandler.prototype.getPropertyForNode = function(node) {\n\n  var name = node.name;\n  var nameNs = parseNameNS(name);\n\n  var type = this.type,\n      model = this.model,\n      descriptor = getModdleDescriptor(type);\n\n  var propertyName = nameNs.name,\n      property = descriptor.propertiesByName[propertyName];\n\n  // search for properties by name first\n\n  if (property && !property.isAttr) {\n\n    const serializationType = getSerializationType(property);\n\n    if (serializationType) {\n      const elementTypeName = node.attributes[serializationType];\n\n      // type is optional, if it does not exists the\n      // default type is assumed\n      if (elementTypeName) {\n\n        // convert the prefix used to the mapped form, but also\n        // take possible type prefixes from XML\n        // into account, i.e.: xsi:type=\"t{ActualType}\",\n        const normalizedTypeName = normalizeTypeName(elementTypeName, node.ns, model);\n\n        const elementType = model.getType(normalizedTypeName);\n\n        return assign({}, property, {\n          effectiveType: getModdleDescriptor(elementType).name\n        });\n      }\n    }\n\n    // search for properties by name first\n    return property;\n  }\n\n  var pkg = model.getPackage(nameNs.prefix);\n\n  if (pkg) {\n    const elementTypeName = aliasToName(nameNs, pkg);\n    const elementType = model.getType(elementTypeName);\n\n    // search for collection members later\n    property = find(descriptor.properties, function(p) {\n      return !p.isVirtual && !p.isReference && !p.isAttribute && elementType.hasType(p.type);\n    });\n\n    if (property) {\n      return assign({}, property, {\n        effectiveType: getModdleDescriptor(elementType).name\n      });\n    }\n  } else {\n\n    // parse unknown element (maybe extension)\n    property = find(descriptor.properties, function(p) {\n      return !p.isReference && !p.isAttribute && p.type === 'Element';\n    });\n\n    if (property) {\n      return property;\n    }\n  }\n\n  throw error('unrecognized element <' + nameNs.name + '>');\n};\n\nElementHandler.prototype.toString = function() {\n  return 'ElementDescriptor[' + getModdleDescriptor(this.type).name + ']';\n};\n\nElementHandler.prototype.valueHandler = function(propertyDesc, element) {\n  return new ValueHandler(propertyDesc, element);\n};\n\nElementHandler.prototype.referenceHandler = function(propertyDesc) {\n  return new ReferenceHandler(propertyDesc, this.context);\n};\n\nElementHandler.prototype.handler = function(type) {\n  if (type === 'Element') {\n    return new GenericElementHandler(this.model, type, this.context);\n  } else {\n    return new ElementHandler(this.model, type, this.context);\n  }\n};\n\n/**\n * Handle the child element parsing\n *\n * @param  {Element} node the xml node\n */\nElementHandler.prototype.handleChild = function(node) {\n  var propertyDesc, type, element, childHandler;\n\n  propertyDesc = this.getPropertyForNode(node);\n  element = this.element;\n\n  type = propertyDesc.effectiveType || propertyDesc.type;\n\n  if (isSimpleType(type)) {\n    return this.valueHandler(propertyDesc, element);\n  }\n\n  if (propertyDesc.isReference) {\n    childHandler = this.referenceHandler(propertyDesc).handleNode(node);\n  } else {\n    childHandler = this.handler(type).handleNode(node);\n  }\n\n  var newElement = childHandler.element;\n\n  // child handles may decide to skip elements\n  // by not returning anything\n  if (newElement !== undefined) {\n\n    if (propertyDesc.isMany) {\n      element.get(propertyDesc.name).push(newElement);\n    } else {\n      element.set(propertyDesc.name, newElement);\n    }\n\n    if (propertyDesc.isReference) {\n      assign(newElement, {\n        element: element\n      });\n\n      this.context.addReference(newElement);\n    } else {\n\n      // establish child -> parent relationship\n      newElement.$parent = element;\n    }\n  }\n\n  return childHandler;\n};\n\n/**\n * An element handler that performs special validation\n * to ensure the node it gets initialized with matches\n * the handlers type (namespace wise).\n *\n * @param {Moddle} model\n * @param {String} typeName\n * @param {Context} context\n */\nfunction RootElementHandler(model, typeName, context) {\n  ElementHandler.call(this, model, typeName, context);\n}\n\nRootElementHandler.prototype = Object.create(ElementHandler.prototype);\n\nRootElementHandler.prototype.createElement = function(node) {\n\n  var name = node.name,\n      nameNs = parseNameNS(name),\n      model = this.model,\n      type = this.type,\n      pkg = model.getPackage(nameNs.prefix),\n      typeName = pkg && aliasToName(nameNs, pkg) || name;\n\n  // verify the correct namespace if we parse\n  // the first element in the handler tree\n  //\n  // this ensures we don't mistakenly import wrong namespace elements\n  if (!type.hasType(typeName)) {\n    throw error('unexpected element <' + node.originalName + '>');\n  }\n\n  return ElementHandler.prototype.createElement.call(this, node);\n};\n\n\nfunction GenericElementHandler(model, typeName, context) {\n  this.model = model;\n  this.context = context;\n}\n\nGenericElementHandler.prototype = Object.create(BaseElementHandler.prototype);\n\nGenericElementHandler.prototype.createElement = function(node) {\n\n  var name = node.name,\n      ns = parseNameNS(name),\n      prefix = ns.prefix,\n      uri = node.ns[prefix + '$uri'],\n      attributes = node.attributes;\n\n  return this.model.createAny(name, uri, attributes);\n};\n\nGenericElementHandler.prototype.handleChild = function(node) {\n\n  var handler = new GenericElementHandler(this.model, 'Element', this.context).handleNode(node),\n      element = this.element;\n\n  var newElement = handler.element,\n      children;\n\n  if (newElement !== undefined) {\n    children = element.$children = element.$children || [];\n    children.push(newElement);\n\n    // establish child -> parent relationship\n    newElement.$parent = element;\n  }\n\n  return handler;\n};\n\nGenericElementHandler.prototype.handleEnd = function() {\n  if (this.body) {\n    this.element.$body = this.body;\n  }\n};\n\n/**\n * A reader for a meta-model\n *\n * @param {Object} options\n * @param {Model} options.model used to read xml files\n * @param {Boolean} options.lax whether to make parse errors warnings\n */\nexport function Reader(options) {\n\n  if (options instanceof Moddle) {\n    options = {\n      model: options\n    };\n  }\n\n  assign(this, { lax: false }, options);\n}\n\n/**\n * The fromXML result.\n *\n * @typedef {Object} ParseResult\n *\n * @property {ModdleElement} rootElement\n * @property {Array<Object>} references\n * @property {Array<Error>} warnings\n * @property {Object} elementsById - a mapping containing each ID -> ModdleElement\n */\n\n/**\n * The fromXML result.\n *\n * @typedef {Error} ParseError\n *\n * @property {Array<Error>} warnings\n */\n\n/**\n * Parse the given XML into a moddle document tree.\n *\n * @param {String} xml\n * @param {ElementHandler|Object} options or rootHandler\n *\n * @returns {Promise<ParseResult, ParseError>}\n */\nReader.prototype.fromXML = function(xml, options, done) {\n\n  var rootHandler = options.rootHandler;\n\n  if (options instanceof ElementHandler) {\n\n    // root handler passed via (xml, { rootHandler: ElementHandler }, ...)\n    rootHandler = options;\n    options = {};\n  } else {\n    if (typeof options === 'string') {\n\n      // rootHandler passed via (xml, 'someString', ...)\n      rootHandler = this.handler(options);\n      options = {};\n    } else if (typeof rootHandler === 'string') {\n\n      // rootHandler passed via (xml, { rootHandler: 'someString' }, ...)\n      rootHandler = this.handler(rootHandler);\n    }\n  }\n\n  var model = this.model,\n      lax = this.lax;\n\n  var context = new Context(assign({}, options, { rootHandler: rootHandler })),\n      parser = new SaxParser({ proxy: true }),\n      stack = createStack();\n\n  rootHandler.context = context;\n\n  // push root handler\n  stack.push(rootHandler);\n\n\n  /**\n   * Handle error.\n   *\n   * @param  {Error} err\n   * @param  {Function} getContext\n   * @param  {boolean} lax\n   *\n   * @return {boolean} true if handled\n   */\n  function handleError(err, getContext, lax) {\n\n    var ctx = getContext();\n\n    var line = ctx.line,\n        column = ctx.column,\n        data = ctx.data;\n\n    // we receive the full context data here,\n    // for elements trim down the information\n    // to the tag name, only\n    if (data.charAt(0) === '<' && data.indexOf(' ') !== -1) {\n      data = data.slice(0, data.indexOf(' ')) + '>';\n    }\n\n    var message =\n      'unparsable content ' + (data ? data + ' ' : '') + 'detected\\n\\t' +\n        'line: ' + line + '\\n\\t' +\n        'column: ' + column + '\\n\\t' +\n        'nested error: ' + err.message;\n\n    if (lax) {\n      context.addWarning({\n        message: message,\n        error: err\n      });\n\n      return true;\n    } else {\n      throw error(message);\n    }\n  }\n\n  function handleWarning(err, getContext) {\n\n    // just like handling errors in <lax=true> mode\n    return handleError(err, getContext, true);\n  }\n\n  /**\n   * Resolve collected references on parse end.\n   */\n  function resolveReferences() {\n\n    var elementsById = context.elementsById;\n    var references = context.references;\n\n    var i, r;\n\n    for (i = 0; (r = references[i]); i++) {\n      var element = r.element;\n      var reference = elementsById[r.id];\n      var property = getModdleDescriptor(element).propertiesByName[r.property];\n\n      if (!reference) {\n        context.addWarning({\n          message: 'unresolved reference <' + r.id + '>',\n          element: r.element,\n          property: r.property,\n          value: r.id\n        });\n      }\n\n      if (property.isMany) {\n        var collection = element.get(property.name),\n            idx = collection.indexOf(r);\n\n        // we replace an existing place holder (idx != -1) or\n        // append to the collection instead\n        if (idx === -1) {\n          idx = collection.length;\n        }\n\n        if (!reference) {\n\n          // remove unresolvable reference\n          collection.splice(idx, 1);\n        } else {\n\n          // add or update reference in collection\n          collection[idx] = reference;\n        }\n      } else {\n        element.set(property.name, reference);\n      }\n    }\n  }\n\n  function handleClose() {\n    stack.pop().handleEnd();\n  }\n\n  var PREAMBLE_START_PATTERN = /^<\\?xml /i;\n\n  var ENCODING_PATTERN = / encoding=\"([^\"]+)\"/i;\n\n  var UTF_8_PATTERN = /^utf-8$/i;\n\n  function handleQuestion(question) {\n\n    if (!PREAMBLE_START_PATTERN.test(question)) {\n      return;\n    }\n\n    var match = ENCODING_PATTERN.exec(question);\n    var encoding = match && match[1];\n\n    if (!encoding || UTF_8_PATTERN.test(encoding)) {\n      return;\n    }\n\n    context.addWarning({\n      message:\n        'unsupported document encoding <' + encoding + '>, ' +\n        'falling back to UTF-8'\n    });\n  }\n\n  function handleOpen(node, getContext) {\n    var handler = stack.peek();\n\n    try {\n      stack.push(handler.handleNode(node));\n    } catch (err) {\n\n      if (handleError(err, getContext, lax)) {\n        stack.push(new NoopHandler());\n      }\n    }\n  }\n\n  function handleCData(text, getContext) {\n\n    try {\n      stack.peek().handleText(text);\n    } catch (err) {\n      handleWarning(err, getContext);\n    }\n  }\n\n  function handleText(text, getContext) {\n\n    // strip whitespace only nodes, i.e. before\n    // <!CDATA[ ... ]> sections and in between tags\n\n    if (!text.trim()) {\n      return;\n    }\n\n    handleCData(text, getContext);\n  }\n\n  var uriMap = model.getPackages().reduce(function(uriMap, p) {\n    uriMap[p.uri] = p.prefix;\n\n    return uriMap;\n  }, Object.entries(DEFAULT_NS_MAP).reduce(function(map, [ prefix, url ]) {\n    map[url] = prefix;\n\n    return map;\n  }, model.config && model.config.nsMap || {}));\n\n  parser\n    .ns(uriMap)\n    .on('openTag', function(obj, decodeStr, selfClosing, getContext) {\n\n      // gracefully handle unparsable attributes (attrs=false)\n      var attrs = obj.attrs || {};\n\n      var decodedAttrs = Object.keys(attrs).reduce(function(d, key) {\n        var value = decodeStr(attrs[key]);\n\n        d[key] = value;\n\n        return d;\n      }, {});\n\n      var node = {\n        name: obj.name,\n        originalName: obj.originalName,\n        attributes: decodedAttrs,\n        ns: obj.ns\n      };\n\n      handleOpen(node, getContext);\n    })\n    .on('question', handleQuestion)\n    .on('closeTag', handleClose)\n    .on('cdata', handleCData)\n    .on('text', function(text, decodeEntities, getContext) {\n      handleText(decodeEntities(text), getContext);\n    })\n    .on('error', handleError)\n    .on('warn', handleWarning);\n\n  // async XML parsing to make sure the execution environment\n  // (node or brower) is kept responsive and that certain optimization\n  // strategies can kick in.\n  return new Promise(function(resolve, reject) {\n\n    var err;\n\n    try {\n      parser.parse(xml);\n\n      resolveReferences();\n    } catch (e) {\n      err = e;\n    }\n\n    var rootElement = rootHandler.element;\n\n    if (!err && !rootElement) {\n      err = error('failed to parse document as <' + rootHandler.type.$descriptor.name + '>');\n    }\n\n    var warnings = context.warnings;\n    var references = context.references;\n    var elementsById = context.elementsById;\n\n    if (err) {\n      err.warnings = warnings;\n\n      return reject(err);\n    } else {\n      return resolve({\n        rootElement: rootElement,\n        elementsById: elementsById,\n        references: references,\n        warnings: warnings\n      });\n    }\n  });\n};\n\nReader.prototype.handler = function(name) {\n  return new RootElementHandler(this.model, name);\n};\n\n\n// helpers //////////////////////////\n\nfunction createStack() {\n  var stack = [];\n\n  Object.defineProperty(stack, 'peek', {\n    value: function() {\n      return this[this.length - 1];\n    }\n  });\n\n  return stack;\n}\n","import {\n  forEach,\n  isString,\n  filter,\n  assign,\n  has,\n  findIndex\n} from 'min-dash';\n\nimport {\n  isSimpleType,\n  parseNameNS\n} from 'moddle';\n\nimport {\n  hasLowerCaseAlias,\n  getSerialization,\n  SERIALIZE_PROPERTY,\n  DEFAULT_NS_MAP\n} from './common.js';\n\nvar XML_PREAMBLE = '<?xml version=\"1.0\" encoding=\"UTF-8\"?>\\n';\n\nvar ESCAPE_ATTR_CHARS = /<|>|'|\"|&|\\n\\r|\\n/g;\nvar ESCAPE_CHARS = /<|>|&/g;\n\n\nexport function Namespaces(parent) {\n\n  this.prefixMap = {};\n  this.uriMap = {};\n  this.used = {};\n\n  this.wellknown = [];\n  this.custom = [];\n  this.parent = parent;\n\n  this.defaultPrefixMap = parent && parent.defaultPrefixMap || {};\n}\n\nNamespaces.prototype.mapDefaultPrefixes = function(defaultPrefixMap) {\n  this.defaultPrefixMap = defaultPrefixMap;\n};\n\nNamespaces.prototype.defaultUriByPrefix = function(prefix) {\n  return this.defaultPrefixMap[prefix];\n};\n\nNamespaces.prototype.byUri = function(uri) {\n  return this.uriMap[uri] || (\n    this.parent && this.parent.byUri(uri)\n  );\n};\n\nNamespaces.prototype.add = function(ns, isWellknown) {\n\n  this.uriMap[ns.uri] = ns;\n\n  if (isWellknown) {\n    this.wellknown.push(ns);\n  } else {\n    this.custom.push(ns);\n  }\n\n  this.mapPrefix(ns.prefix, ns.uri);\n};\n\nNamespaces.prototype.uriByPrefix = function(prefix) {\n  return this.prefixMap[prefix || 'xmlns'] || (\n    this.parent && this.parent.uriByPrefix(prefix)\n  );\n};\n\nNamespaces.prototype.mapPrefix = function(prefix, uri) {\n  this.prefixMap[prefix || 'xmlns'] = uri;\n};\n\nNamespaces.prototype.getNSKey = function(ns) {\n  return (ns.prefix !== undefined) ? (ns.uri + '|' + ns.prefix) : ns.uri;\n};\n\nNamespaces.prototype.logUsed = function(ns) {\n\n  var uri = ns.uri;\n  var nsKey = this.getNSKey(ns);\n\n  this.used[nsKey] = this.byUri(uri);\n\n  // Inform parent recursively about the usage of this NS\n  if (this.parent) {\n    this.parent.logUsed(ns);\n  }\n};\n\nNamespaces.prototype.getUsed = function(ns) {\n\n  var allNs = [].concat(this.wellknown, this.custom);\n\n  return allNs.filter(ns => {\n    var nsKey = this.getNSKey(ns);\n\n    return this.used[nsKey];\n  });\n};\n\n\nfunction lower(string) {\n  return string.charAt(0).toLowerCase() + string.slice(1);\n}\n\nfunction nameToAlias(name, pkg) {\n  if (hasLowerCaseAlias(pkg)) {\n    return lower(name);\n  } else {\n    return name;\n  }\n}\n\nfunction inherits(ctor, superCtor) {\n  ctor.super_ = superCtor;\n  ctor.prototype = Object.create(superCtor.prototype, {\n    constructor: {\n      value: ctor,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n}\n\nfunction nsName(ns) {\n  if (isString(ns)) {\n    return ns;\n  } else {\n    return (ns.prefix ? ns.prefix + ':' : '') + ns.localName;\n  }\n}\n\nfunction getNsAttrs(namespaces) {\n\n  return namespaces.getUsed().filter(function(ns) {\n\n    // do not serialize built in <xml> namespace\n    return ns.prefix !== 'xml';\n  }).map(function(ns) {\n    var name = 'xmlns' + (ns.prefix ? ':' + ns.prefix : '');\n    return { name: name, value: ns.uri };\n  });\n\n}\n\nfunction getElementNs(ns, descriptor) {\n  if (descriptor.isGeneric) {\n    return assign({ localName: descriptor.ns.localName }, ns);\n  } else {\n    return assign({ localName: nameToAlias(descriptor.ns.localName, descriptor.$pkg) }, ns);\n  }\n}\n\nfunction getPropertyNs(ns, descriptor) {\n  return assign({ localName: descriptor.ns.localName }, ns);\n}\n\nfunction getSerializableProperties(element) {\n  var descriptor = element.$descriptor;\n\n  return filter(descriptor.properties, function(p) {\n    var name = p.name;\n\n    if (p.isVirtual) {\n      return false;\n    }\n\n    // do not serialize defaults\n    if (!has(element, name)) {\n      return false;\n    }\n\n    var value = element[name];\n\n    // do not serialize default equals\n    if (value === p.default) {\n      return false;\n    }\n\n    // do not serialize null properties\n    if (value === null) {\n      return false;\n    }\n\n    return p.isMany ? value.length : true;\n  });\n}\n\nvar ESCAPE_ATTR_MAP = {\n  '\\n': '#10',\n  '\\n\\r': '#10',\n  '\"': '#34',\n  '\\'': '#39',\n  '<': '#60',\n  '>': '#62',\n  '&': '#38'\n};\n\nvar ESCAPE_MAP = {\n  '<': 'lt',\n  '>': 'gt',\n  '&': 'amp'\n};\n\nfunction escape(str, charPattern, replaceMap) {\n\n  // ensure we are handling strings here\n  str = isString(str) ? str : '' + str;\n\n  return str.replace(charPattern, function(s) {\n    return '&' + replaceMap[s] + ';';\n  });\n}\n\n/**\n * Escape a string attribute to not contain any bad values (line breaks, '\"', ...)\n *\n * @param {String} str the string to escape\n * @return {String} the escaped string\n */\nfunction escapeAttr(str) {\n  return escape(str, ESCAPE_ATTR_CHARS, ESCAPE_ATTR_MAP);\n}\n\nfunction escapeBody(str) {\n  return escape(str, ESCAPE_CHARS, ESCAPE_MAP);\n}\n\nfunction filterAttributes(props) {\n  return filter(props, function(p) { return p.isAttr; });\n}\n\nfunction filterContained(props) {\n  return filter(props, function(p) { return !p.isAttr; });\n}\n\n\nfunction ReferenceSerializer(tagName) {\n  this.tagName = tagName;\n}\n\nReferenceSerializer.prototype.build = function(element) {\n  this.element = element;\n  return this;\n};\n\nReferenceSerializer.prototype.serializeTo = function(writer) {\n  writer\n    .appendIndent()\n    .append('<' + this.tagName + '>' + this.element.id + '</' + this.tagName + '>')\n    .appendNewLine();\n};\n\nfunction BodySerializer() {}\n\nBodySerializer.prototype.serializeValue =\nBodySerializer.prototype.serializeTo = function(writer) {\n  writer.append(\n    this.escape\n      ? escapeBody(this.value)\n      : this.value\n  );\n};\n\nBodySerializer.prototype.build = function(prop, value) {\n  this.value = value;\n\n  if (prop.type === 'String' && value.search(ESCAPE_CHARS) !== -1) {\n    this.escape = true;\n  }\n\n  return this;\n};\n\nfunction ValueSerializer(tagName) {\n  this.tagName = tagName;\n}\n\ninherits(ValueSerializer, BodySerializer);\n\nValueSerializer.prototype.serializeTo = function(writer) {\n\n  writer\n    .appendIndent()\n    .append('<' + this.tagName + '>');\n\n  this.serializeValue(writer);\n\n  writer\n    .append('</' + this.tagName + '>')\n    .appendNewLine();\n};\n\nfunction ElementSerializer(parent, propertyDescriptor) {\n  this.body = [];\n  this.attrs = [];\n\n  this.parent = parent;\n  this.propertyDescriptor = propertyDescriptor;\n}\n\nElementSerializer.prototype.build = function(element) {\n  this.element = element;\n\n  var elementDescriptor = element.$descriptor,\n      propertyDescriptor = this.propertyDescriptor;\n\n  var otherAttrs,\n      properties;\n\n  var isGeneric = elementDescriptor.isGeneric;\n\n  if (isGeneric) {\n    otherAttrs = this.parseGenericNsAttributes(element);\n  } else {\n    otherAttrs = this.parseNsAttributes(element);\n  }\n\n  if (propertyDescriptor) {\n    this.ns = this.nsPropertyTagName(propertyDescriptor);\n  } else {\n    this.ns = this.nsTagName(elementDescriptor);\n  }\n\n  // compute tag name\n  this.tagName = this.addTagName(this.ns);\n\n  if (isGeneric) {\n    this.parseGenericContainments(element);\n  } else {\n    properties = getSerializableProperties(element);\n\n    this.parseAttributes(filterAttributes(properties));\n    this.parseContainments(filterContained(properties));\n  }\n\n  this.parseGenericAttributes(element, otherAttrs);\n\n  return this;\n};\n\nElementSerializer.prototype.nsTagName = function(descriptor) {\n  var effectiveNs = this.logNamespaceUsed(descriptor.ns);\n  return getElementNs(effectiveNs, descriptor);\n};\n\nElementSerializer.prototype.nsPropertyTagName = function(descriptor) {\n  var effectiveNs = this.logNamespaceUsed(descriptor.ns);\n  return getPropertyNs(effectiveNs, descriptor);\n};\n\nElementSerializer.prototype.isLocalNs = function(ns) {\n  return ns.uri === this.ns.uri;\n};\n\n/**\n * Get the actual ns attribute name for the given element.\n *\n * @param {Object} element\n * @param {Boolean} [element.inherited=false]\n *\n * @return {Object} nsName\n */\nElementSerializer.prototype.nsAttributeName = function(element) {\n\n  var ns;\n\n  if (isString(element)) {\n    ns = parseNameNS(element);\n  } else {\n    ns = element.ns;\n  }\n\n  // return just local name for inherited attributes\n  if (element.inherited) {\n    return { localName: ns.localName };\n  }\n\n  // parse + log effective ns\n  var effectiveNs = this.logNamespaceUsed(ns);\n\n  // LOG ACTUAL namespace use\n  this.getNamespaces().logUsed(effectiveNs);\n\n  // strip prefix if same namespace like parent\n  if (this.isLocalNs(effectiveNs)) {\n    return { localName: ns.localName };\n  } else {\n    return assign({ localName: ns.localName }, effectiveNs);\n  }\n};\n\nElementSerializer.prototype.parseGenericNsAttributes = function(element) {\n\n  return Object.entries(element).filter(\n    ([ key, value ]) => !key.startsWith('$') && this.parseNsAttribute(element, key, value)\n  ).map(\n    ([ key, value ]) => ({ name: key, value: value })\n  );\n};\n\nElementSerializer.prototype.parseGenericContainments = function(element) {\n  var body = element.$body;\n\n  if (body) {\n    this.body.push(new BodySerializer().build({ type: 'String' }, body));\n  }\n\n  var children = element.$children;\n\n  if (children) {\n    forEach(children, child => {\n      this.body.push(new ElementSerializer(this).build(child));\n    });\n  }\n};\n\nElementSerializer.prototype.parseNsAttribute = function(element, name, value) {\n  var model = element.$model;\n\n  var nameNs = parseNameNS(name);\n\n  var ns;\n\n  // parse xmlns:foo=\"http://foo.bar\"\n  if (nameNs.prefix === 'xmlns') {\n    ns = { prefix: nameNs.localName, uri: value };\n  }\n\n  // parse xmlns=\"http://foo.bar\"\n  if (!nameNs.prefix && nameNs.localName === 'xmlns') {\n    ns = { uri: value };\n  }\n\n  if (!ns) {\n    return {\n      name: name,\n      value: value\n    };\n  }\n\n  if (model && model.getPackage(value)) {\n\n    // register well known namespace\n    this.logNamespace(ns, true, true);\n  } else {\n\n    // log custom namespace directly as used\n    var actualNs = this.logNamespaceUsed(ns, true);\n\n    this.getNamespaces().logUsed(actualNs);\n  }\n};\n\n\n/**\n * Parse namespaces and return a list of left over generic attributes\n *\n * @param  {Object} element\n * @return {Array<Object>}\n */\nElementSerializer.prototype.parseNsAttributes = function(element) {\n  var self = this;\n\n  var genericAttrs = element.$attrs;\n\n  var attributes = [];\n\n  // parse namespace attributes first\n  // and log them. push non namespace attributes to a list\n  // and process them later\n  forEach(genericAttrs, function(value, name) {\n\n    var nonNsAttr = self.parseNsAttribute(element, name, value);\n\n    if (nonNsAttr) {\n      attributes.push(nonNsAttr);\n    }\n  });\n\n  return attributes;\n};\n\nElementSerializer.prototype.parseGenericAttributes = function(element, attributes) {\n\n  var self = this;\n\n  forEach(attributes, function(attr) {\n\n    try {\n      self.addAttribute(self.nsAttributeName(attr.name), attr.value);\n    } catch (e) {\n\n      // eslint-disable-next-line no-undef\n      typeof console !== 'undefined' && console.warn(\n        `missing namespace information for <${\n          attr.name\n        }=${ attr.value }> on`, element, e\n      );\n    }\n  });\n};\n\nElementSerializer.prototype.parseContainments = function(properties) {\n\n  var self = this,\n      body = this.body,\n      element = this.element;\n\n  forEach(properties, function(p) {\n    var value = element.get(p.name),\n        isReference = p.isReference,\n        isMany = p.isMany;\n\n    if (!isMany) {\n      value = [ value ];\n    }\n\n    if (p.isBody) {\n      body.push(new BodySerializer().build(p, value[0]));\n    } else if (isSimpleType(p.type)) {\n      forEach(value, function(v) {\n        body.push(new ValueSerializer(self.addTagName(self.nsPropertyTagName(p))).build(p, v));\n      });\n    } else if (isReference) {\n      forEach(value, function(v) {\n        body.push(new ReferenceSerializer(self.addTagName(self.nsPropertyTagName(p))).build(v));\n      });\n    } else {\n\n      // allow serialization via type\n      // rather than element name\n      var serialization = getSerialization(p);\n\n      forEach(value, function(v) {\n        var serializer;\n\n        if (serialization) {\n          if (serialization === SERIALIZE_PROPERTY) {\n            serializer = new ElementSerializer(self, p);\n          } else {\n            serializer = new TypeSerializer(self, p, serialization);\n          }\n        } else {\n          serializer = new ElementSerializer(self);\n        }\n\n        body.push(serializer.build(v));\n      });\n    }\n  });\n};\n\nElementSerializer.prototype.getNamespaces = function(local) {\n\n  var namespaces = this.namespaces,\n      parent = this.parent,\n      parentNamespaces;\n\n  if (!namespaces) {\n    parentNamespaces = parent && parent.getNamespaces();\n\n    if (local || !parentNamespaces) {\n      this.namespaces = namespaces = new Namespaces(parentNamespaces);\n    } else {\n      namespaces = parentNamespaces;\n    }\n  }\n\n  return namespaces;\n};\n\nElementSerializer.prototype.logNamespace = function(ns, wellknown, local) {\n  var namespaces = this.getNamespaces(local);\n\n  var nsUri = ns.uri,\n      nsPrefix = ns.prefix;\n\n  var existing = namespaces.byUri(nsUri);\n\n  if (!existing || local) {\n    namespaces.add(ns, wellknown);\n  }\n\n  namespaces.mapPrefix(nsPrefix, nsUri);\n\n  return ns;\n};\n\nElementSerializer.prototype.logNamespaceUsed = function(ns, local) {\n  var namespaces = this.getNamespaces(local);\n\n  // ns may be\n  //\n  //   * prefix only\n  //   * prefix:uri\n  //   * localName only\n\n  var prefix = ns.prefix,\n      uri = ns.uri,\n      newPrefix, idx,\n      wellknownUri;\n\n  // handle anonymous namespaces (elementForm=unqualified), cf. #23\n  if (!prefix && !uri) {\n    return { localName: ns.localName };\n  }\n\n  wellknownUri = namespaces.defaultUriByPrefix(prefix);\n\n  uri = uri || wellknownUri || namespaces.uriByPrefix(prefix);\n\n  if (!uri) {\n    throw new Error('no namespace uri given for prefix <' + prefix + '>');\n  }\n\n  ns = namespaces.byUri(uri);\n\n  // register new default prefix <xmlns> in local scope\n  if (!ns && !prefix) {\n    ns = this.logNamespace({ uri }, wellknownUri === uri, true);\n  }\n\n  if (!ns) {\n    newPrefix = prefix;\n    idx = 1;\n\n    // find a prefix that is not mapped yet\n    while (namespaces.uriByPrefix(newPrefix)) {\n      newPrefix = prefix + '_' + idx++;\n    }\n\n    ns = this.logNamespace({ prefix: newPrefix, uri: uri }, wellknownUri === uri);\n  }\n\n  if (prefix) {\n    namespaces.mapPrefix(prefix, uri);\n  }\n\n  return ns;\n};\n\nElementSerializer.prototype.parseAttributes = function(properties) {\n  var self = this,\n      element = this.element;\n\n  forEach(properties, function(p) {\n\n    var value = element.get(p.name);\n\n    if (p.isReference) {\n\n      if (!p.isMany) {\n        value = value.id;\n      } else {\n        var values = [];\n        forEach(value, function(v) {\n          values.push(v.id);\n        });\n\n        // IDREFS is a whitespace-separated list of references.\n        value = values.join(' ');\n      }\n\n    }\n\n    self.addAttribute(self.nsAttributeName(p), value);\n  });\n};\n\nElementSerializer.prototype.addTagName = function(nsTagName) {\n  var actualNs = this.logNamespaceUsed(nsTagName);\n\n  this.getNamespaces().logUsed(actualNs);\n\n  return nsName(nsTagName);\n};\n\nElementSerializer.prototype.addAttribute = function(name, value) {\n  var attrs = this.attrs;\n\n  if (isString(value)) {\n    value = escapeAttr(value);\n  }\n\n  // de-duplicate attributes\n  // https://github.com/bpmn-io/moddle-xml/issues/66\n  var idx = findIndex(attrs, function(element) {\n    return (\n      element.name.localName === name.localName &&\n      element.name.uri === name.uri &&\n      element.name.prefix === name.prefix\n    );\n  });\n\n  var attr = { name: name, value: value };\n\n  if (idx !== -1) {\n    attrs.splice(idx, 1, attr);\n  } else {\n    attrs.push(attr);\n  }\n};\n\nElementSerializer.prototype.serializeAttributes = function(writer) {\n  var attrs = this.attrs,\n      namespaces = this.namespaces;\n\n  if (namespaces) {\n    attrs = getNsAttrs(namespaces).concat(attrs);\n  }\n\n  forEach(attrs, function(a) {\n    writer\n      .append(' ')\n      .append(nsName(a.name)).append('=\"').append(a.value).append('\"');\n  });\n};\n\nElementSerializer.prototype.serializeTo = function(writer) {\n  var firstBody = this.body[0],\n      indent = firstBody && firstBody.constructor !== BodySerializer;\n\n  writer\n    .appendIndent()\n    .append('<' + this.tagName);\n\n  this.serializeAttributes(writer);\n\n  writer.append(firstBody ? '>' : ' />');\n\n  if (firstBody) {\n\n    if (indent) {\n      writer\n        .appendNewLine()\n        .indent();\n    }\n\n    forEach(this.body, function(b) {\n      b.serializeTo(writer);\n    });\n\n    if (indent) {\n      writer\n        .unindent()\n        .appendIndent();\n    }\n\n    writer.append('</' + this.tagName + '>');\n  }\n\n  writer.appendNewLine();\n};\n\n/**\n * A serializer for types that handles serialization of data types\n */\nfunction TypeSerializer(parent, propertyDescriptor, serialization) {\n  ElementSerializer.call(this, parent, propertyDescriptor);\n\n  this.serialization = serialization;\n}\n\ninherits(TypeSerializer, ElementSerializer);\n\nTypeSerializer.prototype.parseNsAttributes = function(element) {\n\n  // extracted attributes with serialization attribute\n  // <type=typeName> stripped; it may be later\n  var attributes = ElementSerializer.prototype.parseNsAttributes.call(this, element).filter(\n    attr => attr.name !== this.serialization\n  );\n\n  var descriptor = element.$descriptor;\n\n  // only serialize <type=typeName> if necessary\n  if (descriptor.name === this.propertyDescriptor.type) {\n    return attributes;\n  }\n\n  var typeNs = this.typeNs = this.nsTagName(descriptor);\n  this.getNamespaces().logUsed(this.typeNs);\n\n  // add xsi:type attribute to represent the elements\n  // actual type\n\n  var pkg = element.$model.getPackage(typeNs.uri),\n      typePrefix = (pkg.xml && pkg.xml.typePrefix) || '';\n\n  this.addAttribute(\n    this.nsAttributeName(this.serialization),\n    (typeNs.prefix ? typeNs.prefix + ':' : '') + typePrefix + descriptor.ns.localName\n  );\n\n  return attributes;\n};\n\nTypeSerializer.prototype.isLocalNs = function(ns) {\n  return ns.uri === (this.typeNs || this.ns).uri;\n};\n\nfunction SavingWriter() {\n  this.value = '';\n\n  this.write = function(str) {\n    this.value += str;\n  };\n}\n\nfunction FormatingWriter(out, format) {\n\n  var indent = [ '' ];\n\n  this.append = function(str) {\n    out.write(str);\n\n    return this;\n  };\n\n  this.appendNewLine = function() {\n    if (format) {\n      out.write('\\n');\n    }\n\n    return this;\n  };\n\n  this.appendIndent = function() {\n    if (format) {\n      out.write(indent.join('  '));\n    }\n\n    return this;\n  };\n\n  this.indent = function() {\n    indent.push('');\n    return this;\n  };\n\n  this.unindent = function() {\n    indent.pop();\n    return this;\n  };\n}\n\n/**\n * A writer for meta-model backed document trees\n *\n * @param {Object} options output options to pass into the writer\n */\nexport function Writer(options) {\n\n  options = assign({ format: false, preamble: true }, options || {});\n\n  function toXML(tree, writer) {\n    var internalWriter = writer || new SavingWriter();\n    var formatingWriter = new FormatingWriter(internalWriter, options.format);\n\n    if (options.preamble) {\n      formatingWriter.append(XML_PREAMBLE);\n    }\n\n    var serializer = new ElementSerializer();\n\n    var model = tree.$model;\n\n    serializer.getNamespaces().mapDefaultPrefixes(getDefaultPrefixMappings(model));\n\n    serializer.build(tree).serializeTo(formatingWriter);\n\n    if (!writer) {\n      return internalWriter.value;\n    }\n  }\n\n  return {\n    toXML: toXML\n  };\n}\n\n\n// helpers ///////////\n\n/**\n * @param {Moddle} model\n *\n * @return { Record<string, string> } map from prefix to URI\n */\nfunction getDefaultPrefixMappings(model) {\n\n  const nsMap = model.config && model.config.nsMap || {};\n\n  const prefixMap = {};\n\n  // { prefix -> uri }\n  for (const prefix in DEFAULT_NS_MAP) {\n    prefixMap[prefix] = DEFAULT_NS_MAP[prefix];\n  }\n\n  // { uri -> prefix }\n  for (const uri in nsMap) {\n    const prefix = nsMap[uri];\n\n    prefixMap[prefix] = uri;\n  }\n\n  for (const pkg of model.getPackages()) {\n    prefixMap[pkg.prefix] = pkg.uri;\n  }\n\n  return prefixMap;\n}","import {\r\n  isString,\r\n  assign\r\n} from 'min-dash';\r\n\r\nimport {\r\n  Moddle\r\n} from 'moddle';\r\n\r\nimport {\r\n  Reader,\r\n  Writer\r\n} from 'moddle-xml';\r\n\r\n\r\n/**\r\n * A sub class of {@link Moddle} with support for import and export of BPMN 2.0 xml files.\r\n *\r\n * @class BpmnModdle\r\n * @extends Moddle\r\n *\r\n * @param {Object|Array} packages to use for instantiating the model\r\n * @param {Object} [options] additional options to pass over\r\n */\r\nexport default function BpmnModdle(packages, options) {\r\n  Moddle.call(this, packages, options);\r\n}\r\n\r\nBpmnModdle.prototype = Object.create(Moddle.prototype);\r\n\r\n/**\r\n * The fromXML result.\r\n *\r\n * @typedef {Object} ParseResult\r\n *\r\n * @property {ModdleElement} rootElement\r\n * @property {Array<Object>} references\r\n * @property {Array<Error>} warnings\r\n * @property {Object} elementsById - a mapping containing each ID -> ModdleElement\r\n */\r\n\r\n/**\r\n * The fromXML error.\r\n *\r\n * @typedef {Error} ParseError\r\n *\r\n * @property {Array<Error>} warnings\r\n */\r\n\r\n/**\r\n * Instantiates a BPMN model tree from a given xml string.\r\n *\r\n * @param {String}   xmlStr\r\n * @param {String}   [typeName='bpmn:Definitions'] name of the root element\r\n * @param {Object}   [options]  options to pass to the underlying reader\r\n *\r\n * @returns {Promise<ParseResult, ParseError>}\r\n */\r\nBpmnModdle.prototype.fromXML = function(xmlStr, typeName, options) {\r\n\r\n  if (!isString(typeName)) {\r\n    options = typeName;\r\n    typeName = 'bpmn:Definitions';\r\n  }\r\n\r\n  var reader = new Reader(assign({ model: this, lax: true }, options));\r\n  var rootHandler = reader.handler(typeName);\r\n\r\n  return reader.fromXML(xmlStr, rootHandler);\r\n};\r\n\r\n\r\n/**\r\n * The toXML result.\r\n *\r\n * @typedef {Object} SerializationResult\r\n *\r\n * @property {String} xml\r\n */\r\n\r\n/**\r\n * Serializes a BPMN 2.0 object tree to XML.\r\n *\r\n * @param {String}   element    the root element, typically an instance of `bpmn:Definitions`\r\n * @param {Object}   [options]  to pass to the underlying writer\r\n *\r\n * @returns {Promise<SerializationResult, Error>}\r\n */\r\nBpmnModdle.prototype.toXML = function(element, options) {\r\n\r\n  var writer = new Writer(options);\r\n\r\n  return new Promise(function(resolve, reject) {\r\n    try {\r\n      var result = writer.toXML(element);\r\n\r\n      return resolve({\r\n        xml: result\r\n      });\r\n    } catch (err) {\r\n      return reject(err);\r\n    }\r\n  });\r\n};\r\n","import {\r\n  assign\r\n} from 'min-dash';\r\n\r\nimport BpmnModdle from './bpmn-moddle.js';\r\n\r\nimport BpmnPackage from '../resources/bpmn/json/bpmn.json' with { type: 'json' };\r\nimport BpmnDiPackage from '../resources/bpmn/json/bpmndi.json' with { type: 'json' };\r\nimport DcPackage from '../resources/bpmn/json/dc.json' with { type: 'json' };\r\nimport DiPackage from '../resources/bpmn/json/di.json' with { type: 'json' };\r\nimport BiocPackage from '../resources/bpmn-io/json/bioc.json' with { type: 'json' };\r\nimport BpmnInColorPackage from 'bpmn-in-color-moddle/resources/bpmn-in-color.json' with { type: 'json' };\r\n\r\nconst packages = {\r\n  bpmn: BpmnPackage,\r\n  bpmndi: BpmnDiPackage,\r\n  dc: DcPackage,\r\n  di: DiPackage,\r\n  bioc: BiocPackage,\r\n  color: BpmnInColorPackage\r\n};\r\n\r\nexport default function SimpleBpmnModdle(additionalPackages, options) {\r\n  const pks = assign({}, packages, additionalPackages);\r\n\r\n  return new BpmnModdle(pks, options);\r\n}\r\n","import {\r\n  filter,\r\n  find,\r\n  forEach\r\n} from 'min-dash';\r\n\r\nimport {\r\n  elementToString\r\n} from './Util';\r\n\r\nimport {\r\n  ensureCompatDiRef\r\n} from '../util/CompatibilityUtil';\r\n\r\n/**\r\n * @typedef {import('../model/Types').ModdleElement} ModdleElement\r\n */\r\n\r\n/**\r\n * Returns true if an element is of the given meta-model type.\r\n *\r\n * @param {ModdleElement} element\r\n * @param {string} type\r\n *\r\n * @return {boolean}\r\n */\r\nfunction is(element, type) {\r\n  return element.$instanceOf(type);\r\n}\r\n\r\n\r\n/**\r\n * Find a suitable display candidate for definitions where the DI does not\r\n * correctly specify one.\r\n *\r\n * @param {ModdleElement} definitions\r\n *\r\n * @return {ModdleElement}\r\n */\r\nfunction findDisplayCandidate(definitions) {\r\n  return find(definitions.rootElements, function(e) {\r\n    return is(e, 'bpmn:Process') || is(e, 'bpmn:Collaboration');\r\n  });\r\n}\r\n\r\n/**\r\n * @param {Record<'element' | 'root' | 'error', Function>} handler\r\n */\r\nexport default function BpmnTreeWalker(handler) {\r\n\r\n  // list of containers already walked\r\n  var handledElements = {};\r\n\r\n  // list of elements to handle deferred to ensure\r\n  // prerequisites are drawn\r\n  var deferred = [];\r\n\r\n  var diMap = {};\r\n\r\n  // Helpers //////////////////////\r\n\r\n  function contextual(fn, ctx) {\r\n    return function(e) {\r\n      fn(e, ctx);\r\n    };\r\n  }\r\n\r\n  function handled(element) {\r\n    handledElements[element.id] = element;\r\n  }\r\n\r\n  function isHandled(element) {\r\n    return handledElements[element.id];\r\n  }\r\n\r\n  function visit(element, ctx) {\r\n\r\n    var gfx = element.gfx;\r\n\r\n    // avoid multiple rendering of elements\r\n    if (gfx) {\r\n      throw new Error(\r\n        `already rendered ${ elementToString(element) }`\r\n      );\r\n    }\r\n\r\n    // call handler\r\n    return handler.element(element, diMap[element.id], ctx);\r\n  }\r\n\r\n  function visitRoot(element, diagram) {\r\n    return handler.root(element, diMap[element.id], diagram);\r\n  }\r\n\r\n  function visitIfDi(element, ctx) {\r\n\r\n    try {\r\n      var gfx = diMap[element.id] && visit(element, ctx);\r\n\r\n      handled(element);\r\n\r\n      return gfx;\r\n    } catch (error) {\r\n      logError(error.message, { element, error });\r\n\r\n      console.error(`failed to import ${ elementToString(element) }`, error);\r\n    }\r\n  }\r\n\r\n  function logError(message, context) {\r\n    handler.error(message, context);\r\n  }\r\n\r\n  // DI handling //////////////////////\r\n\r\n  var registerDi = this.registerDi = function registerDi(di) {\r\n    var bpmnElement = di.bpmnElement;\r\n\r\n    if (bpmnElement) {\r\n      if (diMap[bpmnElement.id]) {\r\n        logError(\r\n          `multiple DI elements defined for ${ elementToString(bpmnElement) }`,\r\n          { element: bpmnElement }\r\n        );\r\n      } else {\r\n        diMap[bpmnElement.id] = di;\r\n\r\n        ensureCompatDiRef(bpmnElement);\r\n      }\r\n    } else {\r\n      logError(\r\n        `no bpmnElement referenced in ${ elementToString(di) }`,\r\n        { element: di }\r\n      );\r\n    }\r\n  };\r\n\r\n  function handleDiagram(diagram) {\r\n    handlePlane(diagram.plane);\r\n  }\r\n\r\n  function handlePlane(plane) {\r\n    registerDi(plane);\r\n\r\n    forEach(plane.planeElement, handlePlaneElement);\r\n  }\r\n\r\n  function handlePlaneElement(planeElement) {\r\n    registerDi(planeElement);\r\n  }\r\n\r\n\r\n  // Semantic handling //////////////////////\r\n\r\n  /**\r\n   * Handle definitions and return the rendered diagram (if any).\r\n   *\r\n   * @param {ModdleElement} definitions to walk and import\r\n   * @param {ModdleElement} [diagram] specific diagram to import and display\r\n   *\r\n   * @throws {Error} if no diagram to display could be found\r\n   */\r\n  this.handleDefinitions = function handleDefinitions(definitions, diagram) {\r\n\r\n    // make sure we walk the correct bpmnElement\r\n\r\n    var diagrams = definitions.diagrams;\r\n\r\n    if (diagram && diagrams.indexOf(diagram) === -1) {\r\n      throw new Error('diagram not part of <bpmn:Definitions />');\r\n    }\r\n\r\n    if (!diagram && diagrams && diagrams.length) {\r\n      diagram = diagrams[0];\r\n    }\r\n\r\n    // no diagram -> nothing to import\r\n    if (!diagram) {\r\n      throw new Error('no diagram to display');\r\n    }\r\n\r\n    // load DI from selected diagram only\r\n    diMap = {};\r\n    handleDiagram(diagram);\r\n\r\n\r\n    var plane = diagram.plane;\r\n\r\n    if (!plane) {\r\n      throw new Error(\r\n        `no plane for ${ elementToString(diagram) }`\r\n      );\r\n    }\r\n\r\n    var rootElement = plane.bpmnElement;\r\n\r\n    // ensure we default to a suitable display candidate (process or collaboration),\r\n    // even if non is specified in DI\r\n    if (!rootElement) {\r\n      rootElement = findDisplayCandidate(definitions);\r\n\r\n      if (!rootElement) {\r\n        throw new Error('no process or collaboration to display');\r\n      } else {\r\n\r\n        logError(\r\n          `correcting missing bpmnElement on ${ elementToString(plane) } to ${ elementToString(rootElement) }`\r\n        );\r\n\r\n        // correct DI on the fly\r\n        plane.bpmnElement = rootElement;\r\n        registerDi(plane);\r\n      }\r\n    }\r\n\r\n\r\n    var ctx = visitRoot(rootElement, plane);\r\n\r\n    if (is(rootElement, 'bpmn:Process') || is(rootElement, 'bpmn:SubProcess')) {\r\n      handleProcess(rootElement, ctx);\r\n    } else if (is(rootElement, 'bpmn:Collaboration')) {\r\n      handleCollaboration(rootElement, ctx);\r\n\r\n      // force drawing of everything not yet drawn that is part of the target DI\r\n      handleUnhandledProcesses(definitions.rootElements, ctx);\r\n    } else {\r\n      throw new Error(\r\n        `unsupported bpmnElement for ${ elementToString(plane) }: ${ elementToString(rootElement) }`\r\n      );\r\n    }\r\n\r\n    // handle all deferred elements\r\n    handleDeferred(deferred);\r\n  };\r\n\r\n  var handleDeferred = this.handleDeferred = function handleDeferred() {\r\n\r\n    var fn;\r\n\r\n    // drain deferred until empty\r\n    while (deferred.length) {\r\n      fn = deferred.shift();\r\n\r\n      fn();\r\n    }\r\n  };\r\n\r\n  function handleProcess(process, context) {\r\n    handleFlowElementsContainer(process, context);\r\n    handleIoSpecification(process.ioSpecification, context);\r\n\r\n    handleArtifacts(process.artifacts, context);\r\n\r\n    // log process handled\r\n    handled(process);\r\n  }\r\n\r\n  function handleUnhandledProcesses(rootElements, ctx) {\r\n\r\n    // walk through all processes that have not yet been drawn and draw them\r\n    // if they contain lanes with DI information.\r\n    // we do this to pass the free-floating lane test cases in the MIWG test suite\r\n    var processes = filter(rootElements, function(e) {\r\n      return !isHandled(e) && is(e, 'bpmn:Process') && e.laneSets;\r\n    });\r\n\r\n    processes.forEach(contextual(handleProcess, ctx));\r\n  }\r\n\r\n  function handleMessageFlow(messageFlow, context) {\r\n    visitIfDi(messageFlow, context);\r\n  }\r\n\r\n  function handleMessageFlows(messageFlows, context) {\r\n    forEach(messageFlows, contextual(handleMessageFlow, context));\r\n  }\r\n\r\n  function handleDataAssociation(association, context) {\r\n    visitIfDi(association, context);\r\n  }\r\n\r\n  function handleDataInput(dataInput, context) {\r\n    visitIfDi(dataInput, context);\r\n  }\r\n\r\n  function handleDataOutput(dataOutput, context) {\r\n    visitIfDi(dataOutput, context);\r\n  }\r\n\r\n  function handleArtifact(artifact, context) {\r\n\r\n    // bpmn:TextAnnotation\r\n    // bpmn:Group\r\n    // bpmn:Association\r\n\r\n    visitIfDi(artifact, context);\r\n  }\r\n\r\n  function handleArtifacts(artifacts, context) {\r\n\r\n    forEach(artifacts, function(e) {\r\n      if (is(e, 'bpmn:Association')) {\r\n        deferred.push(function() {\r\n          handleArtifact(e, context);\r\n        });\r\n      } else {\r\n        handleArtifact(e, context);\r\n      }\r\n    });\r\n  }\r\n\r\n  function handleIoSpecification(ioSpecification, context) {\r\n\r\n    if (!ioSpecification) {\r\n      return;\r\n    }\r\n\r\n    forEach(ioSpecification.dataInputs, contextual(handleDataInput, context));\r\n    forEach(ioSpecification.dataOutputs, contextual(handleDataOutput, context));\r\n  }\r\n\r\n  var handleSubProcess = this.handleSubProcess = function handleSubProcess(subProcess, context) {\r\n    handleFlowElementsContainer(subProcess, context);\r\n    handleArtifacts(subProcess.artifacts, context);\r\n  };\r\n\r\n  function handleFlowNode(flowNode, context) {\r\n    var childCtx = visitIfDi(flowNode, context);\r\n\r\n    if (is(flowNode, 'bpmn:SubProcess')) {\r\n      handleSubProcess(flowNode, childCtx || context);\r\n    }\r\n\r\n    if (is(flowNode, 'bpmn:Activity')) {\r\n      handleIoSpecification(flowNode.ioSpecification, context);\r\n    }\r\n\r\n    // defer handling of associations\r\n    // affected types:\r\n    //\r\n    //   * bpmn:Activity\r\n    //   * bpmn:ThrowEvent\r\n    //   * bpmn:CatchEvent\r\n    //\r\n    deferred.push(function() {\r\n      forEach(flowNode.dataInputAssociations, contextual(handleDataAssociation, context));\r\n      forEach(flowNode.dataOutputAssociations, contextual(handleDataAssociation, context));\r\n    });\r\n  }\r\n\r\n  function handleSequenceFlow(sequenceFlow, context) {\r\n    visitIfDi(sequenceFlow, context);\r\n  }\r\n\r\n  function handleDataElement(dataObject, context) {\r\n    visitIfDi(dataObject, context);\r\n  }\r\n\r\n  function handleLane(lane, context) {\r\n\r\n    deferred.push(function() {\r\n\r\n      var newContext = visitIfDi(lane, context);\r\n\r\n      if (lane.childLaneSet) {\r\n        handleLaneSet(lane.childLaneSet, newContext || context);\r\n      }\r\n\r\n      wireFlowNodeRefs(lane);\r\n    });\r\n  }\r\n\r\n  function handleLaneSet(laneSet, context) {\r\n    forEach(laneSet.lanes, contextual(handleLane, context));\r\n  }\r\n\r\n  function handleLaneSets(laneSets, context) {\r\n    forEach(laneSets, contextual(handleLaneSet, context));\r\n  }\r\n\r\n  function handleFlowElementsContainer(container, context) {\r\n    handleFlowElements(container.flowElements, context);\r\n\r\n    if (container.laneSets) {\r\n      handleLaneSets(container.laneSets, context);\r\n    }\r\n  }\r\n\r\n  function handleFlowElements(flowElements, context) {\r\n    forEach(flowElements, function(flowElement) {\r\n      if (is(flowElement, 'bpmn:SequenceFlow')) {\r\n        deferred.push(function() {\r\n          handleSequenceFlow(flowElement, context);\r\n        });\r\n      } else if (is(flowElement, 'bpmn:BoundaryEvent')) {\r\n        deferred.unshift(function() {\r\n          handleFlowNode(flowElement, context);\r\n        });\r\n      } else if (is(flowElement, 'bpmn:FlowNode')) {\r\n        handleFlowNode(flowElement, context);\r\n      } else if (is(flowElement, 'bpmn:DataObject')) {\r\n\r\n        // SKIP (assume correct referencing via DataObjectReference)\r\n      } else if (is(flowElement, 'bpmn:DataStoreReference')) {\r\n        handleDataElement(flowElement, context);\r\n      } else if (is(flowElement, 'bpmn:DataObjectReference')) {\r\n        handleDataElement(flowElement, context);\r\n      } else {\r\n        logError(\r\n          `unrecognized flowElement ${ elementToString(flowElement) } in context ${ elementToString(context && context.businessObject) }`,\r\n          {\r\n            element: flowElement,\r\n            context\r\n          }\r\n        );\r\n      }\r\n    });\r\n  }\r\n\r\n  function handleParticipant(participant, context) {\r\n    var newCtx = visitIfDi(participant, context);\r\n\r\n    var process = participant.processRef;\r\n    if (process) {\r\n      handleProcess(process, newCtx || context);\r\n    }\r\n  }\r\n\r\n  function handleCollaboration(collaboration, context) {\r\n\r\n    forEach(collaboration.participants, contextual(handleParticipant, context));\r\n\r\n    deferred.push(function() {\r\n      handleMessageFlows(collaboration.messageFlows, context);\r\n    });\r\n\r\n    handleArtifacts(collaboration.artifacts, context);\r\n  }\r\n\r\n\r\n  function wireFlowNodeRefs(lane) {\r\n\r\n    // wire the virtual flowNodeRefs <-> relationship\r\n    forEach(lane.flowNodeRef, function(flowNode) {\r\n      var lanes = flowNode.get('lanes');\r\n\r\n      if (lanes) {\r\n        lanes.push(lane);\r\n      }\r\n    });\r\n  }\r\n}\r\n","import {\r\n  find,\r\n  forEach,\r\n  map\r\n} from 'min-dash';\r\n\r\nimport BpmnTreeWalker from './BpmnTreeWalker';\r\n\r\nimport { is } from '../util/ModelUtil';\r\n\r\n\r\n/**\r\n * @typedef {import('../model/Types').ModdleElement} ModdleElement\r\n *\r\n * @typedef { {\r\n *   warnings: string[];\r\n * } } ImportBPMNDiagramResult\r\n *\r\n * @typedef {ImportBPMNDiagramResult & Error} ImportBPMNDiagramError\r\n */\r\n\r\n/**\r\n * Import the definitions into a diagram.\r\n *\r\n * Errors and warnings are reported through the specified callback.\r\n *\r\n * @param {ModdleElement} diagram\r\n * @param {ModdleElement} definitions\r\n * @param {ModdleElement} [bpmnDiagram] The diagram to be rendered (if not\r\n * provided, the first one will be rendered).\r\n *\r\n * @return {Promise<ImportBPMNDiagramResult>}\r\n */\r\nexport function importBpmnDiagram(diagram, definitions, bpmnDiagram) {\r\n\r\n  var importer,\r\n      eventBus,\r\n      canvas;\r\n\r\n  var error,\r\n      warnings = [];\r\n\r\n  /**\r\n   * Walk the diagram semantically, importing (=drawing)\r\n   * all elements you encounter.\r\n   *\r\n   * @param {ModdleElement} definitions\r\n   * @param {ModdleElement} bpmnDiagram\r\n   */\r\n  function render(definitions, bpmnDiagram) {\r\n\r\n    var visitor = {\r\n\r\n      root: function(element, di) {\r\n        return importer.add(element, di);\r\n      },\r\n\r\n      element: function(element, di, parentShape) {\r\n        return importer.add(element, di, parentShape);\r\n      },\r\n\r\n      error: function(message, context) {\r\n        warnings.push({ message: message, context: context });\r\n      }\r\n    };\r\n\r\n    var walker = new BpmnTreeWalker(visitor);\r\n\r\n\r\n    bpmnDiagram = bpmnDiagram || (definitions.diagrams && definitions.diagrams[0]);\r\n\r\n    var diagramsToImport = getDiagramsToImport(definitions, bpmnDiagram);\r\n\r\n    if (!diagramsToImport) {\r\n      throw new Error('no diagram to display');\r\n    }\r\n\r\n    // traverse BPMN 2.0 document model,\r\n    // starting at definitions\r\n    forEach(diagramsToImport, function(diagram) {\r\n      walker.handleDefinitions(definitions, diagram);\r\n    });\r\n\r\n    var rootId = bpmnDiagram.plane.bpmnElement.id;\r\n\r\n    // we do need to account for different ways we create root elements\r\n    // each nested imported <root> do have the `_plane` suffix, while\r\n    // the root <root> is found under the business object ID\r\n    canvas.setRootElement(\r\n      canvas.findRoot(rootId + '_plane') || canvas.findRoot(rootId)\r\n    );\r\n  }\r\n\r\n  return new Promise(function(resolve, reject) {\r\n    try {\r\n      importer = diagram.get('bpmnImporter');\r\n      eventBus = diagram.get('eventBus');\r\n      canvas = diagram.get('canvas');\r\n\r\n      eventBus.fire('import.render.start', { definitions: definitions });\r\n\r\n      render(definitions, bpmnDiagram);\r\n\r\n      eventBus.fire('import.render.complete', {\r\n        error: error,\r\n        warnings: warnings\r\n      });\r\n\r\n      return resolve({ warnings: warnings });\r\n    } catch (e) {\r\n\r\n      e.warnings = warnings;\r\n      return reject(e);\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Returns all diagrams in the same hierarchy as the requested diagram.\r\n * Includes all parent and sub process diagrams.\r\n *\r\n * @param {ModdleElement} definitions\r\n * @param {ModdleElement} bpmnDiagram\r\n *\r\n * @return {ModdleElement[]}\r\n */\r\nfunction getDiagramsToImport(definitions, bpmnDiagram) {\r\n  if (!bpmnDiagram || !bpmnDiagram.plane) {\r\n    return;\r\n  }\r\n\r\n  var bpmnElement = bpmnDiagram.plane.bpmnElement,\r\n      rootElement = bpmnElement;\r\n\r\n  if (!is(bpmnElement, 'bpmn:Process') && !is(bpmnElement, 'bpmn:Collaboration')) {\r\n    rootElement = findRootProcess(bpmnElement);\r\n  }\r\n\r\n  // in case the process is part of a collaboration, the plane references the\r\n  // collaboration, not the process\r\n  var collaboration;\r\n\r\n  if (is(rootElement, 'bpmn:Collaboration')) {\r\n    collaboration = rootElement;\r\n  } else {\r\n    collaboration = find(definitions.rootElements, function(element) {\r\n      if (!is(element, 'bpmn:Collaboration')) {\r\n        return;\r\n      }\r\n\r\n      return find(element.participants, function(participant) {\r\n        return participant.processRef === rootElement;\r\n      });\r\n    });\r\n  }\r\n\r\n  var rootElements = [ rootElement ];\r\n\r\n  // all collaboration processes can contain sub-diagrams\r\n  if (collaboration) {\r\n    rootElements = map(collaboration.participants, function(participant) {\r\n      return participant.processRef;\r\n    });\r\n\r\n    rootElements.push(collaboration);\r\n  }\r\n\r\n  var allChildren = selfAndAllFlowElements(rootElements);\r\n\r\n  // if we have multiple diagrams referencing the same element, we\r\n  // use the first in the file\r\n  var diagramsToImport = [ bpmnDiagram ];\r\n  var handledElements = [ bpmnElement ];\r\n\r\n  forEach(definitions.diagrams, function(diagram) {\r\n\r\n    if (!diagram.plane) {\r\n      return;\r\n    }\r\n\r\n    var businessObject = diagram.plane.bpmnElement;\r\n\r\n    if (\r\n      allChildren.indexOf(businessObject) !== -1 &&\r\n      handledElements.indexOf(businessObject) === -1\r\n    ) {\r\n      diagramsToImport.push(diagram);\r\n      handledElements.push(businessObject);\r\n    }\r\n  });\r\n\r\n\r\n  return diagramsToImport;\r\n}\r\n\r\nfunction selfAndAllFlowElements(elements) {\r\n  var result = [];\r\n\r\n  forEach(elements, function(element) {\r\n    if (!element) {\r\n      return;\r\n    }\r\n\r\n    result.push(element);\r\n\r\n    result = result.concat(selfAndAllFlowElements(element.flowElements));\r\n  });\r\n\r\n  return result;\r\n}\r\n\r\nfunction findRootProcess(element) {\r\n  var parent = element;\r\n\r\n  while (parent) {\r\n    if (is(parent, 'bpmn:Process')) {\r\n      return parent;\r\n    }\r\n\r\n    parent = parent.$parent;\r\n  }\r\n}\r\n","/**\r\n * This file must not be changed or exchanged.\r\n *\r\n * @see http://bpmn.io/license for more information.\r\n */\r\n\r\nimport {\r\n  assignStyle,\r\n  domify,\r\n  delegate as domDelegate,\r\n  query as domQuery\r\n} from 'min-dom';\r\n\r\n\r\n// inlined ../../resources/logo.svg\r\nvar BPMNIO_LOGO_SVG = '<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 14.02 5.57\" width=\"53\" height=\"21\"><path fill=\"currentColor\" d=\"M1.88.92v.14c0 .41-.13.68-.4.8.33.14.46.44.46.86v.33c0 .61-.33.95-.95.95H0V0h.95c.65 0 .93.3.93.92zM.63.57v1.06h.24c.24 0 .38-.1.38-.43V.98c0-.28-.1-.4-.32-.4zm0 1.63v1.22h.36c.2 0 .32-.1.32-.39v-.35c0-.37-.12-.48-.4-.48H.63zM4.18.99v.52c0 .64-.31.98-.94.98h-.3V4h-.62V0h.92c.63 0 .94.35.94.99zM2.94.57v1.35h.3c.2 0 .3-.09.3-.37v-.6c0-.29-.1-.38-.3-.38h-.3zm2.89 2.27L6.25 0h.88v4h-.6V1.12L6.1 3.99h-.6l-.46-2.82v2.82h-.55V0h.87zM8.14 1.1V4h-.56V0h.79L9 2.4V0h.56v4h-.64zm2.49 2.29v.6h-.6v-.6zM12.12 1c0-.63.33-1 .95-1 .61 0 .95.37.95 1v2.04c0 .64-.34 1-.95 1-.62 0-.95-.37-.95-1zm.62 2.08c0 .28.13.39.33.39s.32-.1.32-.4V.98c0-.29-.12-.4-.32-.4s-.33.11-.33.4z\"/><path fill=\"currentColor\" d=\"M0 4.53h14.02v1.04H0zM11.08 0h.63v.62h-.63zm.63 4V1h-.63v2.98z\"/></svg>';\r\n\r\nexport var BPMNIO_IMG = BPMNIO_LOGO_SVG;\r\n\r\nexport var LOGO_STYLES = {\r\n  verticalAlign: 'middle'\r\n};\r\n\r\nexport var LINK_STYLES = {\r\n  'color': '#404040'\r\n};\r\n\r\nvar LIGHTBOX_STYLES = {\r\n  'zIndex': '1001',\r\n  'position': 'fixed',\r\n  'top': '0',\r\n  'left': '0',\r\n  'right': '0',\r\n  'bottom': '0'\r\n};\r\n\r\nvar BACKDROP_STYLES = {\r\n  'width': '100%',\r\n  'height': '100%',\r\n  'background': 'rgba(40,40,40,0.2)'\r\n};\r\n\r\nvar NOTICE_STYLES = {\r\n  'position': 'absolute',\r\n  'left': '50%',\r\n  'top': '40%',\r\n  'transform': 'translate(-50%)',\r\n  'width': '260px',\r\n  'padding': '10px',\r\n  'background': 'white',\r\n  'boxShadow': '0 1px 4px rgba(0,0,0,0.3)',\r\n  'fontFamily': 'Helvetica, Arial, sans-serif',\r\n  'fontSize': '14px',\r\n  'display': 'flex',\r\n  'lineHeight': '1.3'\r\n};\r\n\r\nvar LIGHTBOX_MARKUP =\r\n  '<div class=\"bjs-powered-by-lightbox\">' +\r\n    '<div class=\"backdrop\"></div>' +\r\n    '<div class=\"notice\">' +\r\n      '<a href=\"https://bpmn.io\" target=\"_blank\" rel=\"noopener\" class=\"link\">' +\r\n        BPMNIO_IMG +\r\n      '</a>' +\r\n      '<span>' +\r\n        'Web-based tooling for BPMN, DMN and forms ' +\r\n        'powered by <a href=\"https://bpmn.io\" target=\"_blank\" rel=\"noopener\">bpmn.io</a>.' +\r\n      '</span>' +\r\n    '</div>' +\r\n  '</div>';\r\n\r\n\r\nvar lightbox;\r\n\r\nfunction createLightbox() {\r\n  lightbox = domify(LIGHTBOX_MARKUP);\r\n\r\n  assignStyle(lightbox, LIGHTBOX_STYLES);\r\n  assignStyle(domQuery('svg', lightbox), LOGO_STYLES);\r\n  assignStyle(domQuery('.backdrop', lightbox), BACKDROP_STYLES);\r\n  assignStyle(domQuery('.notice', lightbox), NOTICE_STYLES);\r\n  assignStyle(domQuery('.link', lightbox), LINK_STYLES, {\r\n    'margin': '15px 20px 15px 10px',\r\n    'alignSelf': 'center'\r\n  });\r\n}\r\n\r\nexport function open() {\r\n\r\n  if (!lightbox) {\r\n    createLightbox();\r\n\r\n    domDelegate.bind(lightbox, '.backdrop', 'click', function(event) {\r\n      document.body.removeChild(lightbox);\r\n    });\r\n  }\r\n\r\n  document.body.appendChild(lightbox);\r\n}\r\n","/**\r\n * The code in the <project-logo></project-logo> area\r\n * must not be changed.\r\n *\r\n * @see http://bpmn.io/license for more information.\r\n */\r\nimport {\r\n  assign,\r\n  find,\r\n  isNumber,\r\n  omit\r\n} from 'min-dash';\r\n\r\nimport {\r\n  domify,\r\n  assignStyle,\r\n  query as domQuery,\r\n  remove as domRemove\r\n} from 'min-dom';\r\n\r\nimport {\r\n  innerSVG\r\n} from 'tiny-svg';\r\n\r\nimport Diagram from 'diagram-js';\r\nimport BpmnModdle from 'bpmn-moddle';\r\n\r\nimport inherits from 'inherits-browser';\r\n\r\nimport {\r\n  importBpmnDiagram\r\n} from './import/Importer';\r\n\r\n/**\r\n * @template T\r\n *\r\n * @typedef { import('diagram-js/lib/core/EventBus').default<T> } EventBus\r\n */\r\n\r\n/**\r\n * @template T\r\n *\r\n * @typedef {import('diagram-js/lib/core/EventBus').EventBusEventCallback<T>} EventBusEventCallback\r\n */\r\n\r\n/**\r\n * @typedef {import('didi').ModuleDeclaration} ModuleDeclaration\r\n *\r\n * @typedef {import('./model/Types').Moddle} Moddle\r\n * @typedef {import('./model/Types').ModdleElement} ModdleElement\r\n * @typedef {import('./model/Types').ModdleExtension} ModdleExtension\r\n *\r\n * @typedef { {\r\n *   width?: number|string;\r\n *   height?: number|string;\r\n *   position?: string;\r\n *   container?: string|HTMLElement;\r\n *   moddleExtensions?: ModdleExtensions;\r\n *   additionalModules?: ModuleDeclaration[];\r\n * } & Record<string, any> } BaseViewerOptions\r\n *\r\n * @typedef {Record<string, ModdleElement>} ModdleElementsById\r\n *\r\n * @typedef { {\r\n *   [key: string]: ModdleExtension;\r\n * } } ModdleExtensions\r\n *\r\n * @typedef { {\r\n *   warnings: string[];\r\n * } } ImportXMLResult\r\n *\r\n * @typedef {ImportXMLResult & Error} ImportXMLError\r\n *\r\n * @typedef {ImportXMLResult} ImportDefinitionsResult\r\n *\r\n * @typedef {ImportXMLError} ImportDefinitionsError\r\n *\r\n * @typedef {ImportXMLResult} OpenResult\r\n *\r\n * @typedef {ImportXMLError} OpenError\r\n *\r\n * @typedef { {\r\n *   format?: boolean;\r\n *   preamble?: boolean;\r\n * } } SaveXMLOptions\r\n *\r\n * @typedef { {\r\n *   xml?: string;\r\n *   error?: Error;\r\n * } } SaveXMLResult\r\n *\r\n * @typedef { {\r\n *   svg: string;\r\n * } } SaveSVGResult\r\n *\r\n * @typedef { {\r\n *   xml: string;\r\n * } } ImportParseStartEvent\r\n *\r\n * @typedef { {\r\n *   error?: ImportXMLError;\r\n *   definitions?: ModdleElement;\r\n *   elementsById?: ModdleElementsById;\r\n *   references?: ModdleElement[];\r\n *   warnings: string[];\r\n * } } ImportParseCompleteEvent\r\n *\r\n * @typedef { {\r\n *   error?: ImportXMLError;\r\n *   warnings: string[];\r\n * } } ImportDoneEvent\r\n *\r\n * @typedef { {\r\n *   definitions: ModdleElement;\r\n * } } SaveXMLStartEvent\r\n *\r\n * @typedef {SaveXMLResult} SaveXMLDoneEvent\r\n *\r\n * @typedef { {\r\n *   error?: Error;\r\n *   svg: string;\r\n * } } SaveSVGDoneEvent\r\n */\r\n\r\n/**\r\n * @template Type\r\n *\r\n * @typedef { Type extends { eventBus: EventBus<infer X> } ? X : never } EventMap\r\n */\r\n\r\n/**\r\n * A base viewer for BPMN 2.0 diagrams.\r\n *\r\n * Have a look at {@link bpmn-js/lib/Viewer}, {@link bpmn-js/lib/NavigatedViewer} or {@link bpmn-js/lib/Modeler} for\r\n * bundles that include actual features.\r\n *\r\n * @template [ServiceMap=null]\r\n *\r\n * @extends Diagram<ServiceMap>\r\n *\r\n * @param {BaseViewerOptions} [options] The options to configure the viewer.\r\n */\r\nexport default function BaseViewer(options) {\r\n\r\n  /**\r\n   * @type {BaseViewerOptions}\r\n   */\r\n  options = assign({}, DEFAULT_OPTIONS, options);\r\n\r\n  /**\r\n   * @type {Moddle}\r\n   */\r\n  this._moddle = this._createModdle(options);\r\n\r\n  /**\r\n   * @type {HTMLElement}\r\n   */\r\n  this._container = this._createContainer(options);\r\n\r\n  this._init(this._container, this._moddle, options);\r\n\r\n  /* <project-logo> */\r\n\r\n  addProjectLogo(this._container);\r\n\r\n  /* </project-logo> */\r\n}\r\n\r\ninherits(BaseViewer, Diagram);\r\n\r\n/**\r\n * Parse and render a BPMN 2.0 diagram.\r\n *\r\n * Once finished the viewer reports back the result to the\r\n * provided callback function with (err, warnings).\r\n *\r\n * ## Life-Cycle Events\r\n *\r\n * During import the viewer will fire life-cycle events:\r\n *\r\n *   * import.parse.start (about to read model from XML)\r\n *   * import.parse.complete (model read; may have worked or not)\r\n *   * import.render.start (graphical import start)\r\n *   * import.render.complete (graphical import finished)\r\n *   * import.done (everything done)\r\n *\r\n * You can use these events to hook into the life-cycle.\r\n *\r\n * @throws {ImportXMLError} An error thrown during the import of the XML.\r\n *\r\n * @fires BaseViewer#ImportParseStartEvent\r\n * @fires BaseViewer#ImportParseCompleteEvent\r\n * @fires Importer#ImportRenderStartEvent\r\n * @fires Importer#ImportRenderCompleteEvent\r\n * @fires BaseViewer#ImportDoneEvent\r\n *\r\n * @param {string} xml The BPMN 2.0 XML to be imported.\r\n * @param {ModdleElement|string} [bpmnDiagram] The optional diagram or Id of the BPMN diagram to open.\r\n *\r\n * @return {Promise<ImportXMLResult>} A promise resolving with warnings that were produced during the import.\r\n */\r\nBaseViewer.prototype.importXML = async function importXML(xml, bpmnDiagram) {\r\n\r\n  const self = this;\r\n\r\n  function ParseCompleteEvent(data) {\r\n    return self.get('eventBus').createEvent(data);\r\n  }\r\n\r\n  let aggregatedWarnings = [];\r\n  try {\r\n\r\n    // hook in pre-parse listeners +\r\n    // allow xml manipulation\r\n\r\n    /**\r\n     * A `import.parse.start` event.\r\n     *\r\n     * @event BaseViewer#ImportParseStartEvent\r\n     * @type {ImportParseStartEvent}\r\n     */\r\n    xml = this._emit('import.parse.start', { xml: xml }) || xml;\r\n\r\n    let parseResult;\r\n    try {\r\n      parseResult = await this._moddle.fromXML(xml, 'bpmn:Definitions');\r\n    } catch (error) {\r\n      this._emit('import.parse.complete', {\r\n        error\r\n      });\r\n\r\n      throw error;\r\n    }\r\n\r\n    let definitions = parseResult.rootElement;\r\n    const references = parseResult.references;\r\n    const parseWarnings = parseResult.warnings;\r\n    const elementsById = parseResult.elementsById;\r\n\r\n    aggregatedWarnings = aggregatedWarnings.concat(parseWarnings);\r\n\r\n    // hook in post parse listeners +\r\n    // allow definitions manipulation\r\n\r\n    /**\r\n     * A `import.parse.complete` event.\r\n     *\r\n     * @event BaseViewer#ImportParseCompleteEvent\r\n     * @type {ImportParseCompleteEvent}\r\n     */\r\n    definitions = this._emit('import.parse.complete', ParseCompleteEvent({\r\n      error: null,\r\n      definitions: definitions,\r\n      elementsById: elementsById,\r\n      references: references,\r\n      warnings: aggregatedWarnings\r\n    })) || definitions;\r\n\r\n    const importResult = await this.importDefinitions(definitions, bpmnDiagram);\r\n\r\n    aggregatedWarnings = aggregatedWarnings.concat(importResult.warnings);\r\n\r\n    /**\r\n     * A `import.parse.complete` event.\r\n     *\r\n     * @event BaseViewer#ImportDoneEvent\r\n     * @type {ImportDoneEvent}\r\n     */\r\n    this._emit('import.done', { error: null, warnings: aggregatedWarnings });\r\n\r\n    return { warnings: aggregatedWarnings };\r\n  } catch (err) {\r\n    let error = err;\r\n    aggregatedWarnings = aggregatedWarnings.concat(error.warnings || []);\r\n    addWarningsToError(error, aggregatedWarnings);\r\n\r\n    error = checkValidationError(error);\r\n\r\n    this._emit('import.done', { error, warnings: error.warnings });\r\n\r\n    throw error;\r\n  }\r\n};\r\n\r\n\r\n/**\r\n * Import parsed definitions and render a BPMN 2.0 diagram.\r\n *\r\n * Once finished the viewer reports back the result to the\r\n * provided callback function with (err, warnings).\r\n *\r\n * ## Life-Cycle Events\r\n *\r\n * During import the viewer will fire life-cycle events:\r\n *\r\n *   * import.render.start (graphical import start)\r\n *   * import.render.complete (graphical import finished)\r\n *\r\n * You can use these events to hook into the life-cycle.\r\n *\r\n * @throws {ImportDefinitionsError} An error thrown during the import of the definitions.\r\n *\r\n * @param {ModdleElement} definitions The definitions.\r\n * @param {ModdleElement|string} [bpmnDiagram] The optional diagram or ID of the BPMN diagram to open.\r\n *\r\n * @return {Promise<ImportDefinitionsResult>} A promise resolving with warnings that were produced during the import.\r\n */\r\nBaseViewer.prototype.importDefinitions = async function importDefinitions(definitions, bpmnDiagram) {\r\n  this._setDefinitions(definitions);\r\n  const result = await this.open(bpmnDiagram);\r\n\r\n  return { warnings: result.warnings };\r\n};\r\n\r\n\r\n/**\r\n * Open diagram of previously imported XML.\r\n *\r\n * Once finished the viewer reports back the result to the\r\n * provided callback function with (err, warnings).\r\n *\r\n * ## Life-Cycle Events\r\n *\r\n * During switch the viewer will fire life-cycle events:\r\n *\r\n *   * import.render.start (graphical import start)\r\n *   * import.render.complete (graphical import finished)\r\n *\r\n * You can use these events to hook into the life-cycle.\r\n *\r\n * @throws {OpenError} An error thrown during opening.\r\n *\r\n * @param {ModdleElement|string} bpmnDiagramOrId The diagram or Id of the BPMN diagram to open.\r\n *\r\n * @return {Promise<OpenResult>} A promise resolving with warnings that were produced during opening.\r\n */\r\nBaseViewer.prototype.open = async function open(bpmnDiagramOrId) {\r\n\r\n  const definitions = this._definitions;\r\n  let bpmnDiagram = bpmnDiagramOrId;\r\n\r\n  if (!definitions) {\r\n    const error = new Error('no XML imported');\r\n    addWarningsToError(error, []);\r\n\r\n    throw error;\r\n  }\r\n\r\n  if (typeof bpmnDiagramOrId === 'string') {\r\n    bpmnDiagram = findBPMNDiagram(definitions, bpmnDiagramOrId);\r\n\r\n    if (!bpmnDiagram) {\r\n      const error = new Error('BPMNDiagram <' + bpmnDiagramOrId + '> not found');\r\n      addWarningsToError(error, []);\r\n\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  // clear existing rendered diagram\r\n  // catch synchronous exceptions during #clear()\r\n  try {\r\n    this.clear();\r\n  } catch (error) {\r\n    addWarningsToError(error, []);\r\n\r\n    throw error;\r\n  }\r\n\r\n  // perform graphical import\r\n  const { warnings } = await importBpmnDiagram(this, definitions, bpmnDiagram);\r\n\r\n  return { warnings };\r\n};\r\n\r\n/**\r\n * Export the currently displayed BPMN 2.0 diagram as\r\n * a BPMN 2.0 XML document.\r\n *\r\n * ## Life-Cycle Events\r\n *\r\n * During XML saving the viewer will fire life-cycle events:\r\n *\r\n *   * saveXML.start (before serialization)\r\n *   * saveXML.serialized (after xml generation)\r\n *   * saveXML.done (everything done)\r\n *\r\n * You can use these events to hook into the life-cycle.\r\n *\r\n * @throws {Error} An error thrown during export.\r\n *\r\n * @fires BaseViewer#SaveXMLStart\r\n * @fires BaseViewer#SaveXMLDone\r\n *\r\n * @param {SaveXMLOptions} [options] The options.\r\n *\r\n * @return {Promise<SaveXMLResult>} A promise resolving with the XML.\r\n */\r\nBaseViewer.prototype.saveXML = async function saveXML(options) {\r\n\r\n  options = options || {};\r\n\r\n  let definitions = this._definitions,\r\n      error, xml;\r\n\r\n  try {\r\n    if (!definitions) {\r\n      throw new Error('no definitions loaded');\r\n    }\r\n\r\n    // allow to fiddle around with definitions\r\n\r\n    /**\r\n     * A `saveXML.start` event.\r\n     *\r\n     * @event BaseViewer#SaveXMLStartEvent\r\n     * @type {SaveXMLStartEvent}\r\n     */\r\n    definitions = this._emit('saveXML.start', {\r\n      definitions\r\n    }) || definitions;\r\n\r\n    const result = await this._moddle.toXML(definitions, options);\r\n    xml = result.xml;\r\n\r\n    xml = this._emit('saveXML.serialized', {\r\n      xml\r\n    }) || xml;\r\n  } catch (err) {\r\n    error = err;\r\n  }\r\n\r\n  const result = error ? { error } : { xml };\r\n\r\n  /**\r\n   * A `saveXML.done` event.\r\n   *\r\n   * @event BaseViewer#SaveXMLDoneEvent\r\n   * @type {SaveXMLDoneEvent}\r\n   */\r\n  this._emit('saveXML.done', result);\r\n\r\n  if (error) {\r\n    throw error;\r\n  }\r\n\r\n  return result;\r\n};\r\n\r\n\r\n/**\r\n * Export the currently displayed BPMN 2.0 diagram as\r\n * an SVG image.\r\n *\r\n * ## Life-Cycle Events\r\n *\r\n * During SVG saving the viewer will fire life-cycle events:\r\n *\r\n *   * saveSVG.start (before serialization)\r\n *   * saveSVG.done (everything done)\r\n *\r\n * You can use these events to hook into the life-cycle.\r\n *\r\n * @throws {Error} An error thrown during export.\r\n *\r\n * @fires BaseViewer#SaveSVGDone\r\n *\r\n * @return {Promise<SaveSVGResult>} A promise resolving with the SVG.\r\n */\r\nBaseViewer.prototype.saveSVG = async function saveSVG() {\r\n  this._emit('saveSVG.start');\r\n\r\n  let svg, err;\r\n\r\n  try {\r\n    const canvas = this.get('canvas');\r\n\r\n    const contentNode = canvas.getActiveLayer(),\r\n          defsNode = domQuery(':scope > defs', canvas._svg);\r\n\r\n    const contents = innerSVG(contentNode),\r\n          defs = defsNode ? '<defs>' + innerSVG(defsNode) + '</defs>' : '';\r\n\r\n    const bbox = contentNode.getBBox();\r\n\r\n    svg =\r\n      '<?xml version=\"1.0\" encoding=\"utf-8\"?>\\n' +\r\n      '<!-- created with bpmn-js / http://bpmn.io -->\\n' +\r\n      '<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\\n' +\r\n      '<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" ' +\r\n      'width=\"' + bbox.width + '\" height=\"' + bbox.height + '\" ' +\r\n      'viewBox=\"' + bbox.x + ' ' + bbox.y + ' ' + bbox.width + ' ' + bbox.height + '\" version=\"1.1\">' +\r\n      defs + contents +\r\n      '</svg>';\r\n  } catch (e) {\r\n    err = e;\r\n  }\r\n\r\n  /**\r\n   * A `saveSVG.done` event.\r\n   *\r\n   * @event BaseViewer#SaveSVGDoneEvent\r\n   * @type {SaveSVGDoneEvent}\r\n   */\r\n  this._emit('saveSVG.done', {\r\n    error: err,\r\n    svg: svg\r\n  });\r\n\r\n  if (err) {\r\n    throw err;\r\n  }\r\n\r\n  return { svg };\r\n};\r\n\r\nBaseViewer.prototype._setDefinitions = function(definitions) {\r\n  this._definitions = definitions;\r\n};\r\n\r\n/**\r\n * Return modules to instantiate with.\r\n *\r\n * @return {ModuleDeclaration[]} The modules.\r\n */\r\nBaseViewer.prototype.getModules = function() {\r\n  return this._modules;\r\n};\r\n\r\n/**\r\n * Remove all drawn elements from the viewer.\r\n *\r\n * After calling this method the viewer can still be reused for opening another\r\n * diagram.\r\n */\r\nBaseViewer.prototype.clear = function() {\r\n  if (!this.getDefinitions()) {\r\n\r\n    // no diagram to clear\r\n    return;\r\n  }\r\n\r\n  // remove drawn elements\r\n  Diagram.prototype.clear.call(this);\r\n};\r\n\r\n/**\r\n * Destroy the viewer instance and remove all its remainders from the document\r\n * tree.\r\n */\r\nBaseViewer.prototype.destroy = function() {\r\n\r\n  // diagram destroy\r\n  Diagram.prototype.destroy.call(this);\r\n\r\n  // dom detach\r\n  domRemove(this._container);\r\n};\r\n\r\n/**\r\n * @overlord\r\n *\r\n * Register an event listener for events with the given name.\r\n *\r\n * The callback will be invoked with `event, ...additionalArguments`\r\n * that have been passed to {@link EventBus#fire}.\r\n *\r\n * Returning false from a listener will prevent the events default action\r\n * (if any is specified). To stop an event from being processed further in\r\n * other listeners execute {@link Event#stopPropagation}.\r\n *\r\n * Returning anything but `undefined` from a listener will stop the listener propagation.\r\n *\r\n * @template T\r\n *\r\n * @param {string|string[]} events The event(s) to listen to.\r\n * @param {number} [priority] The priority with which to listen.\r\n * @param {EventBusEventCallback<T>} callback The callback.\r\n * @param {any} [that] Value of `this` the callback will be called with.\r\n */\r\n/**\r\n * Register an event listener for events with the given name.\r\n *\r\n * The callback will be invoked with `event, ...additionalArguments`\r\n * that have been passed to {@link EventBus#fire}.\r\n *\r\n * Returning false from a listener will prevent the events default action\r\n * (if any is specified). To stop an event from being processed further in\r\n * other listeners execute {@link Event#stopPropagation}.\r\n *\r\n * Returning anything but `undefined` from a listener will stop the listener propagation.\r\n *\r\n * @template {keyof EventMap<ServiceMap>} EventName\r\n *\r\n * @param {EventName} events to subscribe to\r\n * @param {number} [priority=1000] listen priority\r\n * @param {EventBusEventCallback<(EventMap<ServiceMap>)[EventName]>} callback\r\n * @param {any} [that] callback context\r\n */\r\nBaseViewer.prototype.on = function(events, priority, callback, that) {\r\n  return this.get('eventBus').on(events, priority, callback, that);\r\n};\r\n\r\n/**\r\n * Remove an event listener.\r\n *\r\n * @param {string|string[]} events The event(s).\r\n * @param {Function} [callback] The callback.\r\n */\r\nBaseViewer.prototype.off = function(events, callback) {\r\n  this.get('eventBus').off(events, callback);\r\n};\r\n\r\n/**\r\n * Attach the viewer to an HTML element.\r\n *\r\n * @param {HTMLElement} parentNode The parent node to attach to.\r\n */\r\nBaseViewer.prototype.attachTo = function(parentNode) {\r\n\r\n  if (!parentNode) {\r\n    throw new Error('parentNode required');\r\n  }\r\n\r\n  // ensure we detach from the\r\n  // previous, old parent\r\n  this.detach();\r\n\r\n  // unwrap jQuery if provided\r\n  if (parentNode.get && parentNode.constructor.prototype.jquery) {\r\n    parentNode = parentNode.get(0);\r\n  }\r\n\r\n  if (typeof parentNode === 'string') {\r\n    parentNode = domQuery(parentNode);\r\n  }\r\n\r\n  parentNode.appendChild(this._container);\r\n\r\n  this._emit('attach', {});\r\n\r\n  this.get('canvas').resized();\r\n};\r\n\r\n/**\r\n * Get the definitions model element.\r\n *\r\n * @return {ModdleElement} The definitions model element.\r\n */\r\nBaseViewer.prototype.getDefinitions = function() {\r\n  return this._definitions;\r\n};\r\n\r\n/**\r\n * Detach the viewer.\r\n *\r\n * @fires BaseViewer#DetachEvent\r\n */\r\nBaseViewer.prototype.detach = function() {\r\n\r\n  const container = this._container,\r\n        parentNode = container.parentNode;\r\n\r\n  if (!parentNode) {\r\n    return;\r\n  }\r\n\r\n  /**\r\n   * A `detach` event.\r\n   *\r\n   * @event BaseViewer#DetachEvent\r\n   * @type {Object}\r\n   */\r\n  this._emit('detach', {});\r\n\r\n  parentNode.removeChild(container);\r\n};\r\n\r\nBaseViewer.prototype._init = function(container, moddle, options) {\r\n\r\n  const baseModules = options.modules || this.getModules(options),\r\n        additionalModules = options.additionalModules || [],\r\n        staticModules = [\r\n          {\r\n            bpmnjs: [ 'value', this ],\r\n            moddle: [ 'value', moddle ]\r\n          }\r\n        ];\r\n\r\n  const diagramModules = [].concat(staticModules, baseModules, additionalModules);\r\n\r\n  const diagramOptions = assign(omit(options, [ 'additionalModules' ]), {\r\n    canvas: assign({}, options.canvas, { container: container }),\r\n    modules: diagramModules\r\n  });\r\n\r\n  // invoke diagram constructor\r\n  Diagram.call(this, diagramOptions);\r\n\r\n  if (options && options.container) {\r\n    this.attachTo(options.container);\r\n  }\r\n};\r\n\r\n/**\r\n * Emit an event on the underlying {@link EventBus}\r\n *\r\n * @param  {string} type\r\n * @param  {Object} event\r\n *\r\n * @return {Object} The return value after calling all event listeners.\r\n */\r\nBaseViewer.prototype._emit = function(type, event) {\r\n  return this.get('eventBus').fire(type, event);\r\n};\r\n\r\n/**\r\n * @param {BaseViewerOptions} options\r\n *\r\n * @return {HTMLElement}\r\n */\r\nBaseViewer.prototype._createContainer = function(options) {\r\n\r\n  const container = domify('<div class=\"bjs-container\"></div>');\r\n\r\n  assignStyle(container, {\r\n    width: ensureUnit(options.width),\r\n    height: ensureUnit(options.height),\r\n    position: options.position\r\n  });\r\n\r\n  return container;\r\n};\r\n\r\n/**\r\n * @param {BaseViewerOptions} options\r\n *\r\n * @return {Moddle}\r\n */\r\nBaseViewer.prototype._createModdle = function(options) {\r\n  const moddleOptions = assign({}, this._moddleExtensions, options.moddleExtensions);\r\n\r\n  return new BpmnModdle(moddleOptions);\r\n};\r\n\r\nBaseViewer.prototype._modules = [];\r\n\r\n// helpers ///////////////\r\n\r\nfunction addWarningsToError(err, warningsAry) {\r\n  err.warnings = warningsAry;\r\n  return err;\r\n}\r\n\r\nfunction checkValidationError(err) {\r\n\r\n  // check if we can help the user by indicating wrong BPMN 2.0 xml\r\n  // (in case he or the exporting tool did not get that right)\r\n\r\n  const pattern = /unparsable content <([^>]+)> detected([\\s\\S]*)$/;\r\n  const match = pattern.exec(err.message);\r\n\r\n  if (match) {\r\n    err.message =\r\n      'unparsable content <' + match[1] + '> detected; ' +\r\n      'this may indicate an invalid BPMN 2.0 diagram file' + match[2];\r\n  }\r\n\r\n  return err;\r\n}\r\n\r\nconst DEFAULT_OPTIONS = {\r\n  width: '100%',\r\n  height: '100%',\r\n  position: 'relative'\r\n};\r\n\r\n\r\n/**\r\n * Ensure the passed argument is a proper unit (defaulting to px)\r\n */\r\nfunction ensureUnit(val) {\r\n  return val + (isNumber(val) ? 'px' : '');\r\n}\r\n\r\n\r\n/**\r\n * Find BPMNDiagram in definitions by ID\r\n *\r\n * @param {ModdleElement<Definitions>} definitions\r\n * @param {string} diagramId\r\n *\r\n * @return {ModdleElement<BPMNDiagram>|null}\r\n */\r\nfunction findBPMNDiagram(definitions, diagramId) {\r\n  if (!diagramId) {\r\n    return null;\r\n  }\r\n\r\n  return find(definitions.diagrams, function(element) {\r\n    return element.id === diagramId;\r\n  }) || null;\r\n}\r\n\r\n\r\n/* <project-logo> */\r\n\r\nimport {\r\n  open as openPoweredBy,\r\n  BPMNIO_IMG,\r\n  LOGO_STYLES,\r\n  LINK_STYLES\r\n} from './util/PoweredByUtil';\r\n\r\nimport {\r\n  event as domEvent\r\n} from 'min-dom';\r\n\r\n/**\r\n * Adds the project logo to the diagram container as\r\n * required by the bpmn.io license.\r\n *\r\n * @see http://bpmn.io/license\r\n *\r\n * @param {Element} container\r\n */\r\nfunction addProjectLogo(container) {\r\n  const img = BPMNIO_IMG;\r\n\r\n  const linkMarkup =\r\n    '<a href=\"http://bpmn.io\" ' +\r\n    'target=\"_blank\" ' +\r\n    'class=\"bjs-powered-by\" ' +\r\n    'title=\"Powered by bpmn.io\" ' +\r\n    '>' +\r\n    img +\r\n    '</a>';\r\n\r\n  const linkElement = domify(linkMarkup);\r\n\r\n  assignStyle(domQuery('svg', linkElement), LOGO_STYLES);\r\n  assignStyle(linkElement, LINK_STYLES, {\r\n    position: 'absolute',\r\n    bottom: '15px',\r\n    right: '15px',\r\n    zIndex: '100'\r\n  });\r\n\r\n  container.appendChild(linkElement);\r\n\r\n  domEvent.bind(linkElement, 'click', function(event) {\r\n    openPoweredBy();\r\n\r\n    event.preventDefault();\r\n  });\r\n}\r\n\r\n/* </project-logo> */\r\n","import { getDi, is } from './ModelUtil';\r\n\r\n/**\r\n * @typedef {import('../model/Types').Element} Element\r\n * @typedef {import('../model/Types').ModdleElement} ModdleElement\r\n */\r\n\r\nexport var planeSuffix = '_plane';\r\n\r\n/**\r\n * Get primary shape ID for a plane.\r\n *\r\n * @param  {Element|ModdleElement} element\r\n *\r\n * @return {string}\r\n */\r\nexport function getShapeIdFromPlane(element) {\r\n  var id = element.id;\r\n\r\n  return removePlaneSuffix(id);\r\n}\r\n\r\n/**\r\n * Get plane ID for a primary shape.\r\n *\r\n * @param  {Element|ModdleElement} element\r\n *\r\n * @return {string}\r\n */\r\nexport function getPlaneIdFromShape(element) {\r\n  var id = element.id;\r\n\r\n  if (is(element, 'bpmn:SubProcess')) {\r\n    return addPlaneSuffix(id);\r\n  }\r\n\r\n  return id;\r\n}\r\n\r\n/**\r\n * Get plane ID for primary shape ID.\r\n *\r\n * @param {string} id\r\n *\r\n * @return {string}\r\n */\r\nexport function toPlaneId(id) {\r\n  return addPlaneSuffix(id);\r\n}\r\n\r\n/**\r\n * Check wether element is plane.\r\n *\r\n * @param  {Element|ModdleElement} element\r\n *\r\n * @return {boolean}\r\n */\r\nexport function isPlane(element) {\r\n  var di = getDi(element);\r\n\r\n  return is(di, 'bpmndi:BPMNPlane');\r\n}\r\n\r\nfunction addPlaneSuffix(id) {\r\n  return id + planeSuffix;\r\n}\r\n\r\nfunction removePlaneSuffix(id) {\r\n  return id.replace(new RegExp(planeSuffix + '$'), '');\r\n}","export function elementToString(e) {\r\n  if (!e) {\r\n    return '<null>';\r\n  }\r\n\r\n  return '<' + e.$type + (e.id ? ' id=\"' + e.id : '') + '\" />';\r\n}","import {\r\n  has,\r\n  some\r\n} from 'min-dash';\r\n\r\nimport {\r\n  getDi\r\n} from '../util/ModelUtil';\r\n\r\nimport {\r\n  componentsToPath\r\n} from 'diagram-js/lib/util/RenderUtil';\r\n\r\n\r\n/**\r\n * @typedef {import('../model').ModdleElement} ModdleElement\r\n * @typedef {import('../model').Element} Element\r\n *\r\n * @typedef {import('../model').ShapeLike} ShapeLike\r\n *\r\n * @typedef {import('diagram-js/lib/util/Types').Dimensions} Dimensions\r\n * @typedef {import('diagram-js/lib/util/Types').Rect} Rect\r\n */\r\n\r\n// re-export for compatibility\r\nexport {\r\n  getDi,\r\n  getBusinessObject as getSemantic\r\n} from '../util/ModelUtil';\r\n\r\n\r\nexport var black = 'hsl(225, 10%, 15%)';\r\nexport var white = 'white';\r\n\r\n// element utils //////////////////////\r\n\r\n/**\r\n * Checks if eventDefinition of the given element matches with semantic type.\r\n *\r\n * @param {ModdleElement} event\r\n * @param {string} eventDefinitionType\r\n *\r\n * @return {boolean}\r\n */\r\nexport function isTypedEvent(event, eventDefinitionType) {\r\n  return some(event.eventDefinitions, function(definition) {\r\n    return definition.$type === eventDefinitionType;\r\n  });\r\n}\r\n\r\n/**\r\n * Check if element is a throw event.\r\n *\r\n * @param {ModdleElement} event\r\n *\r\n * @return {boolean}\r\n */\r\nexport function isThrowEvent(event) {\r\n  return (event.$type === 'bpmn:IntermediateThrowEvent') || (event.$type === 'bpmn:EndEvent');\r\n}\r\n\r\n/**\r\n * Check if element is a throw event.\r\n *\r\n * @param {ModdleElement} element\r\n *\r\n * @return {boolean}\r\n */\r\nexport function isCollection(element) {\r\n  var dataObject = element.dataObjectRef;\r\n\r\n  return element.isCollection || (dataObject && dataObject.isCollection);\r\n}\r\n\r\n\r\n// color access //////////////////////\r\n\r\n/**\r\n * @param {Element} element\r\n * @param {string} [defaultColor]\r\n * @param {string} [overrideColor]\r\n *\r\n * @return {string}\r\n */\r\nexport function getFillColor(element, defaultColor, overrideColor) {\r\n  var di = getDi(element);\r\n\r\n  return overrideColor || di.get('color:background-color') || di.get('bioc:fill') || defaultColor || white;\r\n}\r\n\r\n/**\r\n * @param {Element} element\r\n * @param {string} [defaultColor]\r\n * @param {string} [overrideColor]\r\n *\r\n * @return {string}\r\n */\r\nexport function getStrokeColor(element, defaultColor, overrideColor) {\r\n  var di = getDi(element);\r\n\r\n  return overrideColor || di.get('color:border-color') || di.get('bioc:stroke') || defaultColor || black;\r\n}\r\n\r\n/**\r\n * @param {Element} element\r\n * @param {string} [defaultColor]\r\n * @param {string} [defaultStrokeColor]\r\n * @param {string} [overrideColor]\r\n *\r\n * @return {string}\r\n */\r\nexport function getLabelColor(element, defaultColor, defaultStrokeColor, overrideColor) {\r\n  var di = getDi(element),\r\n      label = di.get('label');\r\n\r\n  return overrideColor || (label && label.get('color:color')) || defaultColor ||\r\n    getStrokeColor(element, defaultStrokeColor);\r\n}\r\n\r\n// cropping path customizations //////////////////////\r\n\r\n/**\r\n * @param {ShapeLike} shape\r\n *\r\n * @return {string} path\r\n */\r\nexport function getCirclePath(shape) {\r\n\r\n  var cx = shape.x + shape.width / 2,\r\n      cy = shape.y + shape.height / 2,\r\n      radius = shape.width / 2;\r\n\r\n  var circlePath = [\r\n    [ 'M', cx, cy ],\r\n    [ 'm', 0, -radius ],\r\n    [ 'a', radius, radius, 0, 1, 1, 0, 2 * radius ],\r\n    [ 'a', radius, radius, 0, 1, 1, 0, -2 * radius ],\r\n    [ 'z' ]\r\n  ];\r\n\r\n  return componentsToPath(circlePath);\r\n}\r\n\r\n/**\r\n * @param {ShapeLike} shape\r\n * @param {number} [borderRadius]\r\n *\r\n * @return {string} path\r\n */\r\nexport function getRoundRectPath(shape, borderRadius) {\r\n\r\n  var x = shape.x,\r\n      y = shape.y,\r\n      width = shape.width,\r\n      height = shape.height;\r\n\r\n  var roundRectPath = [\r\n    [ 'M', x + borderRadius, y ],\r\n    [ 'l', width - borderRadius * 2, 0 ],\r\n    [ 'a', borderRadius, borderRadius, 0, 0, 1, borderRadius, borderRadius ],\r\n    [ 'l', 0, height - borderRadius * 2 ],\r\n    [ 'a', borderRadius, borderRadius, 0, 0, 1, -borderRadius, borderRadius ],\r\n    [ 'l', borderRadius * 2 - width, 0 ],\r\n    [ 'a', borderRadius, borderRadius, 0, 0, 1, -borderRadius, -borderRadius ],\r\n    [ 'l', 0, borderRadius * 2 - height ],\r\n    [ 'a', borderRadius, borderRadius, 0, 0, 1, borderRadius, -borderRadius ],\r\n    [ 'z' ]\r\n  ];\r\n\r\n  return componentsToPath(roundRectPath);\r\n}\r\n\r\n/**\r\n * @param {ShapeLike} shape\r\n *\r\n * @return {string} path\r\n */\r\nexport function getDiamondPath(shape) {\r\n\r\n  var width = shape.width,\r\n      height = shape.height,\r\n      x = shape.x,\r\n      y = shape.y,\r\n      halfWidth = width / 2,\r\n      halfHeight = height / 2;\r\n\r\n  var diamondPath = [\r\n    [ 'M', x + halfWidth, y ],\r\n    [ 'l', halfWidth, halfHeight ],\r\n    [ 'l', -halfWidth, halfHeight ],\r\n    [ 'l', -halfWidth, -halfHeight ],\r\n    [ 'z' ]\r\n  ];\r\n\r\n  return componentsToPath(diamondPath);\r\n}\r\n\r\n/**\r\n * @param {ShapeLike} shape\r\n *\r\n * @return {string} path\r\n */\r\nexport function getRectPath(shape) {\r\n  var x = shape.x,\r\n      y = shape.y,\r\n      width = shape.width,\r\n      height = shape.height;\r\n\r\n  var rectPath = [\r\n    [ 'M', x, y ],\r\n    [ 'l', width, 0 ],\r\n    [ 'l', 0, height ],\r\n    [ 'l', -width, 0 ],\r\n    [ 'z' ]\r\n  ];\r\n\r\n  return componentsToPath(rectPath);\r\n}\r\n\r\n/**\r\n * Get width and height from element or overrides.\r\n *\r\n * @param {Dimensions|Rect|ShapeLike} bounds\r\n * @param {Object} overrides\r\n *\r\n * @returns {Dimensions}\r\n */\r\nexport function getBounds(bounds, overrides = {}) {\r\n  return {\r\n    width: getWidth(bounds, overrides),\r\n    height: getHeight(bounds, overrides)\r\n  };\r\n}\r\n\r\n/**\r\n * Get width from element or overrides.\r\n *\r\n * @param {Dimensions|Rect|ShapeLike} bounds\r\n * @param {Object} overrides\r\n *\r\n * @returns {number}\r\n */\r\nexport function getWidth(bounds, overrides = {}) {\r\n  return has(overrides, 'width') ? overrides.width : bounds.width;\r\n}\r\n\r\n/**\r\n * Get height from element or overrides.\r\n *\r\n * @param {Dimensions|Rect|ShapeLike} bounds\r\n * @param {Object} overrides\r\n *\r\n * @returns {number}\r\n */\r\nexport function getHeight(bounds, overrides = {}) {\r\n  return has(overrides, 'height') ? overrides.height : bounds.height;\r\n}","import inherits from 'inherits-browser';\n\nimport {\n  assign,\n  forEach,\n  isObject\n} from 'min-dash';\n\nimport BaseRenderer from 'diagram-js/lib/draw/BaseRenderer';\n\nimport {\n  isExpanded,\n  isHorizontal,\n  isEventSubProcess\n} from '../util/DiUtil';\n\nimport {\n  getLabel\n} from '../util/LabelUtil';\n\nimport {\n  is\n} from '../util/ModelUtil';\n\nimport {\n  createLine\n} from 'diagram-js/lib/util/RenderUtil';\n\nimport {\n  isTypedEvent,\n  isThrowEvent,\n  isCollection,\n  getBounds,\n  getDi,\n  getSemantic,\n  getCirclePath,\n  getRoundRectPath,\n  getDiamondPath,\n  getRectPath,\n  getFillColor,\n  getStrokeColor,\n  getLabelColor,\n  getHeight,\n  getWidth\n} from './BpmnRenderUtil';\n\nimport {\n  query as domQuery\n} from 'min-dom';\n\nimport {\n  append as svgAppend,\n  attr as svgAttr,\n  create as svgCreate,\n  classes as svgClasses\n} from 'tiny-svg';\n\nimport {\n  rotate,\n  transform,\n  translate\n} from 'diagram-js/lib/util/SvgTransformUtil';\n\nimport Ids from 'ids';\n\nimport { black } from './BpmnRenderUtil';\n\nvar markerIds = new Ids();\n\nvar ELEMENT_LABEL_DISTANCE = 10,\n    INNER_OUTER_DIST = 3,\n    PARTICIPANT_STROKE_WIDTH = 1.5,\n    TASK_BORDER_RADIUS = 10;\n\nvar DEFAULT_OPACITY = 0.95,\n    FULL_OPACITY = 1,\n    LOW_OPACITY = 0.25;\n\n/**\n * @typedef { Partial<{\n *   defaultFillColor: string,\n *   defaultStrokeColor: string,\n *   defaultLabelColor: string\n * }> } BpmnRendererConfig\n *\n * @typedef { Partial<{\n *   fill: string,\n *   stroke: string,\n *   width: string,\n *   height: string\n * }> } Attrs\n */\n\n/**\n * @typedef { import('../model/Types').Element } Element\n * @typedef { import('../model/Types').Shape } Shape\n * @typedef { import('../model/Types').Connection } Connection\n */\n\n/**\n * A renderer for BPMN elements\n *\n * @param {BpmnRendererConfig} config\n * @param {import('diagram-js/lib/core/EventBus').default} eventBus\n * @param {import('diagram-js/lib/draw/Styles').default} styles\n * @param {import('./PathMap').default} pathMap\n * @param {import('diagram-js/lib/core/Canvas').default} canvas\n * @param {import('./TextRenderer').default} textRenderer\n * @param {number} [priority]\n */\nexport default function BpmnRenderer(\n    config, eventBus, styles, pathMap,\n    canvas, textRenderer, priority) {\n\n  BaseRenderer.call(this, eventBus, priority);\n\n  var defaultFillColor = config && config.defaultFillColor,\n      defaultStrokeColor = config && config.defaultStrokeColor,\n      defaultLabelColor = config && config.defaultLabelColor;\n\n  function shapeStyle(attrs) {\n    return styles.computeStyle(attrs, {\n      strokeLinecap: 'round',\n      strokeLinejoin: 'round',\n      stroke: black,\n      strokeWidth: 2,\n      fill: 'white'\n    });\n  }\n\n  function lineStyle(attrs) {\n    return styles.computeStyle(attrs, [ 'no-fill' ], {\n      strokeLinecap: 'round',\n      strokeLinejoin: 'round',\n      stroke: black,\n      strokeWidth: 2\n    });\n  }\n\n  function addMarker(id, options) {\n    var {\n      ref = { x: 0, y: 0 },\n      scale = 1,\n      element,\n      parentGfx = canvas._svg\n    } = options;\n\n    var marker = svgCreate('marker', {\n      id: id,\n      viewBox: '0 0 20 20',\n      refX: ref.x,\n      refY: ref.y,\n      markerWidth: 20 * scale,\n      markerHeight: 20 * scale,\n      orient: 'auto'\n    });\n\n    svgAppend(marker, element);\n\n    var defs = domQuery(':scope > defs', parentGfx);\n\n    if (!defs) {\n      defs = svgCreate('defs');\n\n      svgAppend(parentGfx, defs);\n    }\n\n    svgAppend(defs, marker);\n  }\n\n  function marker(parentGfx, type, fill, stroke) {\n\n\n    var id = markerIds.nextPrefixed('marker-');\n\n    createMarker(parentGfx, id, type, fill, stroke);\n\n    return 'url(#' + id + ')';\n  }\n\n  function createMarker(parentGfx, id, type, fill, stroke) {\n\n    if (type === 'sequenceflow-end') {\n      var sequenceflowEnd = svgCreate('path', {\n        d: 'M 1 5 L 11 10 L 1 15 Z',\n        ...shapeStyle({\n          fill: stroke,\n          stroke: stroke,\n          strokeWidth: 1\n        })\n      });\n\n      addMarker(id, {\n        element: sequenceflowEnd,\n        ref: { x: 11, y: 10 },\n        scale: 0.5,\n        parentGfx\n      });\n    }\n\n    if (type === 'messageflow-start') {\n      var messageflowStart = svgCreate('circle', {\n        cx: 6,\n        cy: 6,\n        r: 3.5,\n        ...shapeStyle({\n          fill,\n          stroke: stroke,\n          strokeWidth: 1,\n\n          // fix for safari / chrome / firefox bug not correctly\n          // resetting stroke dash array\n          strokeDasharray: [ 10000, 1 ]\n        })\n      });\n\n      addMarker(id, {\n        element: messageflowStart,\n        ref: { x: 6, y: 6 },\n        parentGfx\n      });\n    }\n\n    if (type === 'messageflow-end') {\n      var messageflowEnd = svgCreate('path', {\n        d: 'm 1 5 l 0 -3 l 7 3 l -7 3 z',\n        ...shapeStyle({\n          fill,\n          stroke: stroke,\n          strokeWidth: 1,\n\n          // fix for safari / chrome / firefox bug not correctly\n          // resetting stroke dash array\n          strokeDasharray: [ 10000, 1 ]\n        })\n      });\n\n      addMarker(id, {\n        element: messageflowEnd,\n        ref: { x: 8.5, y: 5 },\n        parentGfx\n      });\n    }\n\n    if (type === 'association-start') {\n      var associationStart = svgCreate('path', {\n        d: 'M 11 5 L 1 10 L 11 15',\n        ...lineStyle({\n          fill: 'none',\n          stroke,\n          strokeWidth: 1.5,\n\n          // fix for safari / chrome / firefox bug not correctly\n          // resetting stroke dash array\n          strokeDasharray: [ 10000, 1 ]\n        })\n      });\n\n      addMarker(id, {\n        element: associationStart,\n        ref: { x: 1, y: 10 },\n        scale: 0.5,\n        parentGfx\n      });\n    }\n\n    if (type === 'association-end') {\n      var associationEnd = svgCreate('path', {\n        d: 'M 1 5 L 11 10 L 1 15',\n        ...lineStyle({\n          fill: 'none',\n          stroke,\n          strokeWidth: 1.5,\n\n          // fix for safari / chrome / firefox bug not correctly\n          // resetting stroke dash array\n          strokeDasharray: [ 10000, 1 ]\n        })\n      });\n\n      addMarker(id, {\n        element: associationEnd,\n        ref: { x: 11, y: 10 },\n        scale: 0.5,\n        parentGfx\n      });\n    }\n\n    if (type === 'conditional-flow-marker') {\n      var conditionalFlowMarker = svgCreate('path', {\n        d: 'M 0 10 L 8 6 L 16 10 L 8 14 Z',\n        ...shapeStyle({\n          fill,\n          stroke: stroke\n        })\n      });\n\n      addMarker(id, {\n        element: conditionalFlowMarker,\n        ref: { x: -1, y: 10 },\n        scale: 0.5,\n        parentGfx\n      });\n    }\n\n    if (type === 'conditional-default-flow-marker') {\n      var defaultFlowMarker = svgCreate('path', {\n        d: 'M 6 4 L 10 16',\n        ...shapeStyle({\n          stroke: stroke,\n          fill: 'none'\n        })\n      });\n\n      addMarker(id, {\n        element: defaultFlowMarker,\n        ref: { x: 0, y: 10 },\n        scale: 0.5,\n        parentGfx\n      });\n    }\n  }\n\n  function drawCircle(parentGfx, width, height, offset, attrs = {}) {\n\n    if (isObject(offset)) {\n      attrs = offset;\n      offset = 0;\n    }\n\n    offset = offset || 0;\n\n    attrs = shapeStyle(attrs);\n\n    var cx = width / 2,\n        cy = height / 2;\n\n    var circle = svgCreate('circle', {\n      cx: cx,\n      cy: cy,\n      r: Math.round((width + height) / 4 - offset),\n      ...attrs\n    });\n\n    svgAppend(parentGfx, circle);\n\n    return circle;\n  }\n\n  function drawRect(parentGfx, width, height, r, offset, attrs) {\n\n    if (isObject(offset)) {\n      attrs = offset;\n      offset = 0;\n    }\n\n    offset = offset || 0;\n\n    attrs = shapeStyle(attrs);\n\n    var rect = svgCreate('rect', {\n      x: offset,\n      y: offset,\n      width: width - offset * 2,\n      height: height - offset * 2,\n      rx: r,\n      ry: r,\n      ...attrs\n    });\n\n    svgAppend(parentGfx, rect);\n\n    return rect;\n  }\n\n  function drawDiamond(parentGfx, width, height, attrs) {\n\n    var x_2 = width / 2;\n    var y_2 = height / 2;\n\n    var points = [\n      { x: x_2, y: 0 },\n      { x: width, y: y_2 },\n      { x: x_2, y: height },\n      { x: 0, y: y_2 }\n    ];\n\n    var pointsString = points.map(function(point) {\n      return point.x + ',' + point.y;\n    }).join(' ');\n\n    attrs = shapeStyle(attrs);\n\n    var polygon = svgCreate('polygon', {\n      ...attrs,\n      points: pointsString\n    });\n\n    svgAppend(parentGfx, polygon);\n\n    return polygon;\n  }\n\n  /**\n   * @param {SVGElement} parentGfx\n   * @param {Point[]} waypoints\n   * @param {any} attrs\n   * @param {number} [radius]\n   *\n   * @return {SVGElement}\n   */\n  function drawLine(parentGfx, waypoints, attrs, radius) {\n    attrs = lineStyle(attrs);\n\n    var line = createLine(waypoints, attrs, radius);\n\n    svgAppend(parentGfx, line);\n\n    return line;\n  }\n\n  /**\n   * @param {SVGElement} parentGfx\n   * @param {Point[]} waypoints\n   * @param {any} attrs\n   *\n   * @return {SVGElement}\n   */\n  function drawConnectionSegments(parentGfx, waypoints, attrs) {\n    return drawLine(parentGfx, waypoints, attrs, 5);\n  }\n\n  function drawPath(parentGfx, d, attrs) {\n    attrs = lineStyle(attrs);\n\n    var path = svgCreate('path', {\n      ...attrs,\n      d\n    });\n\n    svgAppend(parentGfx, path);\n\n    return path;\n  }\n\n  function drawMarker(type, parentGfx, path, attrs) {\n    return drawPath(parentGfx, path, assign({ 'data-marker': type }, attrs));\n  }\n\n  function renderer(type) {\n    return handlers[type];\n  }\n\n  function as(type) {\n    return function(parentGfx, element, attrs) {\n      return renderer(type)(parentGfx, element, attrs);\n    };\n  }\n\n  var eventIconRenderers = {\n    'bpmn:MessageEventDefinition': function(parentGfx, element, attrs = {}, isThrowing) {\n      var pathData = pathMap.getScaledPath('EVENT_MESSAGE', {\n        xScaleFactor: 0.9,\n        yScaleFactor: 0.9,\n        containerWidth: attrs.width || element.width,\n        containerHeight: attrs.height || element.height,\n        position: {\n          mx: 0.235,\n          my: 0.315\n        }\n      });\n\n      var fill = isThrowing\n        ? getStrokeColor(element, defaultStrokeColor, attrs.stroke)\n        : getFillColor(element, defaultFillColor, attrs.fill);\n\n      var stroke = isThrowing\n        ? getFillColor(element, defaultFillColor, attrs.fill)\n        : getStrokeColor(element, defaultStrokeColor, attrs.stroke);\n\n      var messagePath = drawPath(parentGfx, pathData, {\n        fill,\n        stroke,\n        strokeWidth: 1\n      });\n\n      return messagePath;\n    },\n    'bpmn:TimerEventDefinition': function(parentGfx, element, attrs = {}) {\n      var baseWidth = attrs.width || element.width;\n      var baseHeight = attrs.height || element.height;\n\n      // use a lighter stroke for event suprocess icons\n      var strokeWidth = attrs.width ? 1 : 2;\n\n      var circle = drawCircle(parentGfx, baseWidth, baseHeight, 0.2 * baseHeight, {\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: strokeWidth\n      });\n\n      var pathData = pathMap.getScaledPath('EVENT_TIMER_WH', {\n        xScaleFactor: 0.75,\n        yScaleFactor: 0.75,\n        containerWidth: baseWidth,\n        containerHeight: baseHeight,\n        position: {\n          mx: 0.5,\n          my: 0.5\n        }\n      });\n\n      drawPath(parentGfx, pathData, {\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: strokeWidth\n      });\n\n      for (var i = 0; i < 12; i++) {\n        var linePathData = pathMap.getScaledPath('EVENT_TIMER_LINE', {\n          xScaleFactor: 0.75,\n          yScaleFactor: 0.75,\n          containerWidth: baseWidth,\n          containerHeight: baseHeight,\n          position: {\n            mx: 0.5,\n            my: 0.5\n          }\n        });\n\n        var width = baseWidth / 2,\n            height = baseHeight / 2;\n\n        drawPath(parentGfx, linePathData, {\n          strokeWidth: 1,\n          stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n          transform: 'rotate(' + (i * 30) + ',' + height + ',' + width + ')'\n        });\n      }\n\n      return circle;\n    },\n    'bpmn:EscalationEventDefinition': function(parentGfx, event, attrs = {}, isThrowing) {\n      var pathData = pathMap.getScaledPath('EVENT_ESCALATION', {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: attrs.width || event.width,\n        containerHeight: attrs.height || event.height,\n        position: {\n          mx: 0.5,\n          my: 0.2\n        }\n      });\n\n      var fill = isThrowing\n        ? getStrokeColor(event, defaultStrokeColor, attrs.stroke)\n        : getFillColor(event, defaultFillColor, attrs.fill);\n\n      return drawPath(parentGfx, pathData, {\n        fill,\n        stroke: getStrokeColor(event, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 1\n      });\n    },\n    'bpmn:ConditionalEventDefinition': function(parentGfx, event, attrs = {}) {\n      var pathData = pathMap.getScaledPath('EVENT_CONDITIONAL', {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: attrs.width || event.width,\n        containerHeight: attrs.height || event.height,\n        position: {\n          mx: 0.5,\n          my: 0.222\n        }\n      });\n\n      return drawPath(parentGfx, pathData, {\n        fill: getFillColor(event, defaultFillColor, attrs.fill),\n        stroke: getStrokeColor(event, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 1\n      });\n    },\n    'bpmn:LinkEventDefinition': function(parentGfx, event, attrs = {}, isThrowing) {\n      var pathData = pathMap.getScaledPath('EVENT_LINK', {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: event.width,\n        containerHeight: event.height,\n        position: {\n          mx: 0.57,\n          my: 0.263\n        }\n      });\n\n      var fill = isThrowing\n        ? getStrokeColor(event, defaultStrokeColor, attrs.stroke)\n        : getFillColor(event, defaultFillColor, attrs.fill);\n\n      return drawPath(parentGfx, pathData, {\n        fill,\n        stroke: getStrokeColor(event, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 1\n      });\n    },\n    'bpmn:ErrorEventDefinition': function(parentGfx, event, attrs = {}, isThrowing) {\n      var pathData = pathMap.getScaledPath('EVENT_ERROR', {\n        xScaleFactor: 1.1,\n        yScaleFactor: 1.1,\n        containerWidth: attrs.width || event.width,\n        containerHeight: attrs.height || event.height,\n        position: {\n          mx: 0.2,\n          my: 0.722\n        }\n      });\n\n      var fill = isThrowing\n        ? getStrokeColor(event, defaultStrokeColor, attrs.stroke)\n        : getFillColor(event, defaultFillColor, attrs.fill);\n\n      return drawPath(parentGfx, pathData, {\n        fill,\n        stroke: getStrokeColor(event, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 1\n      });\n    },\n    'bpmn:CancelEventDefinition': function(parentGfx, event, attrs = {}, isThrowing) {\n      var pathData = pathMap.getScaledPath('EVENT_CANCEL_45', {\n        xScaleFactor: 1.0,\n        yScaleFactor: 1.0,\n        containerWidth: event.width,\n        containerHeight: event.height,\n        position: {\n          mx: 0.638,\n          my: -0.055\n        }\n      });\n\n      var fill = isThrowing ? getStrokeColor(event, defaultStrokeColor, attrs.stroke) : 'none';\n\n      var path = drawPath(parentGfx, pathData, {\n        fill,\n        stroke: getStrokeColor(event, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 1\n      });\n\n      rotate(path, 45);\n\n      return path;\n    },\n    'bpmn:CompensateEventDefinition': function(parentGfx, event, attrs = {}, isThrowing) {\n      var pathData = pathMap.getScaledPath('EVENT_COMPENSATION', {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: attrs.width || event.width,\n        containerHeight: attrs.height || event.height,\n        position: {\n          mx: 0.22,\n          my: 0.5\n        }\n      });\n\n      var fill = isThrowing\n        ? getStrokeColor(event, defaultStrokeColor, attrs.stroke)\n        : getFillColor(event, defaultFillColor, attrs.fill);\n\n      return drawPath(parentGfx, pathData, {\n        fill,\n        stroke: getStrokeColor(event, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 1\n      });\n    },\n    'bpmn:SignalEventDefinition': function(parentGfx, event, attrs = {}, isThrowing) {\n      var pathData = pathMap.getScaledPath('EVENT_SIGNAL', {\n        xScaleFactor: 0.9,\n        yScaleFactor: 0.9,\n        containerWidth: attrs.width || event.width,\n        containerHeight: attrs.height || event.height,\n        position: {\n          mx: 0.5,\n          my: 0.2\n        }\n      });\n\n      var fill = isThrowing\n        ? getStrokeColor(event, defaultStrokeColor, attrs.stroke)\n        : getFillColor(event, defaultFillColor, attrs.fill);\n\n      return drawPath(parentGfx, pathData, {\n        strokeWidth: 1,\n        fill,\n        stroke: getStrokeColor(event, defaultStrokeColor, attrs.stroke)\n      });\n    },\n    'bpmn:MultipleEventDefinition': function(parentGfx, event, attrs = {}, isThrowing) {\n      var pathData = pathMap.getScaledPath('EVENT_MULTIPLE', {\n        xScaleFactor: 1.1,\n        yScaleFactor: 1.1,\n        containerWidth: attrs.width || event.width,\n        containerHeight: attrs.height || event.height,\n        position: {\n          mx: 0.211,\n          my: 0.36\n        }\n      });\n\n      var fill = isThrowing\n        ? getStrokeColor(event, defaultStrokeColor, attrs.stroke)\n        : getFillColor(event, defaultFillColor, attrs.fill);\n\n      return drawPath(parentGfx, pathData, {\n        fill,\n        stroke: getStrokeColor(event, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 1\n      });\n    },\n    'bpmn:ParallelMultipleEventDefinition': function(parentGfx, event, attrs = {}) {\n      var pathData = pathMap.getScaledPath('EVENT_PARALLEL_MULTIPLE', {\n        xScaleFactor: 1.2,\n        yScaleFactor: 1.2,\n        containerWidth: attrs.width || event.width,\n        containerHeight: attrs.height || event.height,\n        position: {\n          mx: 0.458,\n          my: 0.194\n        }\n      });\n\n      return drawPath(parentGfx, pathData, {\n        fill: getFillColor(event, defaultFillColor, attrs.fill),\n        stroke: getStrokeColor(event, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 1\n      });\n    },\n    'bpmn:TerminateEventDefinition': function(parentGfx, element, attrs = {}) {\n      var circle = drawCircle(parentGfx, element.width, element.height, 8, {\n        fill: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 4\n      });\n\n      return circle;\n    }\n  };\n\n  function renderEventIcon(element, parentGfx, attrs = {}, proxyElement) {\n    var semantic = getSemantic(element),\n        isThrowing = isThrowEvent(semantic);\n\n    var nodeElement = proxyElement || element;\n\n    if (semantic.get('eventDefinitions') && semantic.get('eventDefinitions').length > 1) {\n      if (semantic.get('parallelMultiple')) {\n        return eventIconRenderers[ 'bpmn:ParallelMultipleEventDefinition' ](parentGfx, nodeElement, attrs, isThrowing);\n      }\n      else {\n        return eventIconRenderers[ 'bpmn:MultipleEventDefinition' ](parentGfx, nodeElement, attrs, isThrowing);\n      }\n    }\n\n    if (isTypedEvent(semantic, 'bpmn:MessageEventDefinition')) {\n      return eventIconRenderers[ 'bpmn:MessageEventDefinition' ](parentGfx, nodeElement, attrs, isThrowing);\n    }\n\n    if (isTypedEvent(semantic, 'bpmn:TimerEventDefinition')) {\n      return eventIconRenderers[ 'bpmn:TimerEventDefinition' ](parentGfx, nodeElement, attrs, isThrowing);\n    }\n\n    if (isTypedEvent(semantic, 'bpmn:ConditionalEventDefinition')) {\n      return eventIconRenderers[ 'bpmn:ConditionalEventDefinition' ](parentGfx, nodeElement, attrs, isThrowing);\n    }\n\n    if (isTypedEvent(semantic, 'bpmn:SignalEventDefinition')) {\n      return eventIconRenderers[ 'bpmn:SignalEventDefinition' ](parentGfx, nodeElement, attrs, isThrowing);\n    }\n\n    if (isTypedEvent(semantic, 'bpmn:EscalationEventDefinition')) {\n      return eventIconRenderers[ 'bpmn:EscalationEventDefinition' ](parentGfx, nodeElement, attrs, isThrowing);\n    }\n\n    if (isTypedEvent(semantic, 'bpmn:LinkEventDefinition')) {\n      return eventIconRenderers[ 'bpmn:LinkEventDefinition' ](parentGfx, nodeElement, attrs, isThrowing);\n    }\n\n    if (isTypedEvent(semantic, 'bpmn:ErrorEventDefinition')) {\n      return eventIconRenderers[ 'bpmn:ErrorEventDefinition' ](parentGfx, nodeElement, attrs, isThrowing);\n    }\n\n    if (isTypedEvent(semantic, 'bpmn:CancelEventDefinition')) {\n      return eventIconRenderers[ 'bpmn:CancelEventDefinition' ](parentGfx, nodeElement, attrs, isThrowing);\n    }\n\n    if (isTypedEvent(semantic, 'bpmn:CompensateEventDefinition')) {\n      return eventIconRenderers[ 'bpmn:CompensateEventDefinition' ](parentGfx, nodeElement, attrs, isThrowing);\n    }\n\n    if (isTypedEvent(semantic, 'bpmn:TerminateEventDefinition')) {\n      return eventIconRenderers[ 'bpmn:TerminateEventDefinition' ](parentGfx, nodeElement, attrs, isThrowing);\n    }\n\n    return null;\n  }\n\n  var taskMarkerRenderers = {\n    'ParticipantMultiplicityMarker': function(parentGfx, element, attrs = {}) {\n      var width = getWidth(element, attrs),\n          height = getHeight(element, attrs);\n\n      var markerPath = pathMap.getScaledPath('MARKER_PARALLEL', {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: width,\n        containerHeight: height,\n        position: {\n          mx: ((width / 2 - 6) / width),\n          my: (height - 15) / height\n        }\n      });\n\n      drawMarker('participant-multiplicity', parentGfx, markerPath, {\n        strokeWidth: 2,\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke)\n      });\n    },\n    'SubProcessMarker': function(parentGfx, element, attrs = {}) {\n      var markerRect = drawRect(parentGfx, 14, 14, 0, {\n        strokeWidth: 1,\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke)\n      });\n\n      translate(markerRect, element.width / 2 - 7.5, element.height - 20);\n\n      var markerPath = pathMap.getScaledPath('MARKER_SUB_PROCESS', {\n        xScaleFactor: 1.5,\n        yScaleFactor: 1.5,\n        containerWidth: element.width,\n        containerHeight: element.height,\n        position: {\n          mx: (element.width / 2 - 7.5) / element.width,\n          my: (element.height - 20) / element.height\n        }\n      });\n\n      drawMarker('sub-process', parentGfx, markerPath, {\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke)\n      });\n    },\n    'ParallelMarker': function(parentGfx, element, attrs) {\n      var width = getWidth(element, attrs),\n          height = getHeight(element, attrs);\n\n      var markerPath = pathMap.getScaledPath('MARKER_PARALLEL', {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: width,\n        containerHeight: height,\n        position: {\n          mx: ((width / 2 + attrs.parallel) / width),\n          my: (height - 20) / height\n        }\n      });\n\n      drawMarker('parallel', parentGfx, markerPath, {\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke)\n      });\n    },\n    'SequentialMarker': function(parentGfx, element, attrs) {\n      var markerPath = pathMap.getScaledPath('MARKER_SEQUENTIAL', {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: element.width,\n        containerHeight: element.height,\n        position: {\n          mx: ((element.width / 2 + attrs.seq) / element.width),\n          my: (element.height - 19) / element.height\n        }\n      });\n\n      drawMarker('sequential', parentGfx, markerPath, {\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke)\n      });\n    },\n    'CompensationMarker': function(parentGfx, element, attrs) {\n      var markerMath = pathMap.getScaledPath('MARKER_COMPENSATION', {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: element.width,\n        containerHeight: element.height,\n        position: {\n          mx: ((element.width / 2 + attrs.compensation) / element.width),\n          my: (element.height - 13) / element.height\n        }\n      });\n\n      drawMarker('compensation', parentGfx, markerMath, {\n        strokeWidth: 1,\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke)\n      });\n    },\n    'LoopMarker': function(parentGfx, element, attrs) {\n      var width = getWidth(element, attrs),\n          height = getHeight(element, attrs);\n\n      var markerPath = pathMap.getScaledPath('MARKER_LOOP', {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: width,\n        containerHeight: height,\n        position: {\n          mx: ((width / 2 + attrs.loop) / width),\n          my: (height - 7) / height\n        }\n      });\n\n      drawMarker('loop', parentGfx, markerPath, {\n        strokeWidth: 1.5,\n        fill: 'none',\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeMiterlimit: 0.5\n      });\n    },\n    'AdhocMarker': function(parentGfx, element, attrs) {\n      var width = getWidth(element, attrs),\n          height = getHeight(element, attrs);\n\n      var markerPath = pathMap.getScaledPath('MARKER_ADHOC', {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: width,\n        containerHeight: height,\n        position: {\n          mx: ((width / 2 + attrs.adhoc) / width),\n          my: (height - 15) / height\n        }\n      });\n\n      drawMarker('adhoc', parentGfx, markerPath, {\n        strokeWidth: 1,\n        fill: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke)\n      });\n    }\n  };\n\n  function renderTaskMarker(type, parentGfx, element, attrs) {\n    taskMarkerRenderers[ type ](parentGfx, element, attrs);\n  }\n\n  function renderTaskMarkers(parentGfx, element, taskMarkers = [], attrs = {}) {\n    attrs = {\n      fill: attrs.fill,\n      stroke: attrs.stroke,\n      width: getWidth(element, attrs),\n      height: getHeight(element, attrs)\n    };\n\n    var semantic = getSemantic(element);\n\n    var subprocess = taskMarkers.includes('SubProcessMarker');\n\n    if (subprocess) {\n      attrs = {\n        ...attrs,\n        seq: -21,\n        parallel: -22,\n        compensation: -25,\n        loop: -18,\n        adhoc: 10\n      };\n    } else {\n      attrs = {\n        ...attrs,\n        seq: -5,\n        parallel: -6,\n        compensation: -7,\n        loop: 0,\n        adhoc: -8\n      };\n    }\n\n    if (semantic.get('isForCompensation')) {\n      taskMarkers.push('CompensationMarker');\n    }\n\n    if (is(semantic, 'bpmn:AdHocSubProcess')) {\n      taskMarkers.push('AdhocMarker');\n\n      if (!subprocess) {\n        assign(attrs, { compensation: attrs.compensation - 18 });\n      }\n    }\n\n    var loopCharacteristics = semantic.get('loopCharacteristics'),\n        isSequential = loopCharacteristics && loopCharacteristics.get('isSequential');\n\n    if (loopCharacteristics) {\n\n      assign(attrs, {\n        compensation: attrs.compensation - 18,\n      });\n\n      if (taskMarkers.includes('AdhocMarker')) {\n        assign(attrs, {\n          seq: -23,\n          loop: -18,\n          parallel: -24\n        });\n      }\n\n      if (isSequential === undefined) {\n        taskMarkers.push('LoopMarker');\n      }\n\n      if (isSequential === false) {\n        taskMarkers.push('ParallelMarker');\n      }\n\n      if (isSequential === true) {\n        taskMarkers.push('SequentialMarker');\n      }\n    }\n\n    if (taskMarkers.includes('CompensationMarker') && taskMarkers.length === 1) {\n      assign(attrs, {\n        compensation: -8\n      });\n    }\n\n    forEach(taskMarkers, function(marker) {\n      renderTaskMarker(marker, parentGfx, element, attrs);\n    });\n  }\n\n  function renderLabel(parentGfx, label, attrs = {}) {\n    attrs = assign({\n      size: {\n        width: 100\n      }\n    }, attrs);\n\n    var text = textRenderer.createText(label || '', attrs);\n\n    svgClasses(text).add('djs-label');\n\n    svgAppend(parentGfx, text);\n\n    return text;\n  }\n\n  function renderEmbeddedLabel(parentGfx, element, align, attrs = {}) {\n    var semantic = getSemantic(element);\n\n    var box = getBounds({\n      x: element.x,\n      y: element.y,\n      width: element.width,\n      height: element.height\n    }, attrs);\n\n    return renderLabel(parentGfx, semantic.name, {\n      align,\n      box,\n      padding: 7,\n      style: {\n        fill: getLabelColor(element, defaultLabelColor, defaultStrokeColor, attrs.stroke)\n      }\n    });\n  }\n\n  function renderExternalLabel(parentGfx, element, attrs = {}) {\n    var box = {\n      width: 90,\n      height: 30,\n      x: element.width / 2 + element.x,\n      y: element.height / 2 + element.y\n    };\n\n    return renderLabel(parentGfx, getLabel(element), {\n      box: box,\n      fitBox: true,\n      style: assign(\n        {},\n        textRenderer.getExternalStyle(),\n        {\n          fill: getLabelColor(element, defaultLabelColor, defaultStrokeColor, attrs.stroke)\n        }\n      )\n    });\n  }\n\n  function renderLaneLabel(parentGfx, text, element, attrs = {}) {\n    var isHorizontalLane = isHorizontal(element);\n\n    var textBox = renderLabel(parentGfx, text, {\n      box: {\n        height: 30,\n        width: isHorizontalLane ? getHeight(element, attrs) : getWidth(element, attrs),\n      },\n      align: 'center-middle',\n      style: {\n        fill: getLabelColor(element, defaultLabelColor, defaultStrokeColor, attrs.stroke)\n      }\n    });\n\n    if (isHorizontalLane) {\n      var top = -1 * getHeight(element, attrs);\n      transform(textBox, 0, -top, 270);\n    }\n  }\n\n  function renderActivity(parentGfx, element, attrs = {}) {\n    var {\n      width,\n      height\n    } = getBounds(element, attrs);\n\n    return drawRect(parentGfx, width, height, TASK_BORDER_RADIUS, {\n      ...attrs,\n      fill: getFillColor(element, defaultFillColor, attrs.fill),\n      fillOpacity: DEFAULT_OPACITY,\n      stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke)\n    });\n  }\n\n  function renderAssociation(parentGfx, element, attrs = {}) {\n    var semantic = getSemantic(element);\n\n    var fill = getFillColor(element, defaultFillColor, attrs.fill),\n        stroke = getStrokeColor(element, defaultStrokeColor, attrs.stroke);\n\n    if (semantic.get('associationDirection') === 'One' ||\n        semantic.get('associationDirection') === 'Both') {\n      attrs.markerEnd = marker(parentGfx, 'association-end', fill, stroke);\n    }\n\n    if (semantic.get('associationDirection') === 'Both') {\n      attrs.markerStart = marker(parentGfx, 'association-start', fill, stroke);\n    }\n\n    attrs = pickAttrs(attrs, [\n      'markerStart',\n      'markerEnd'\n    ]);\n\n    return drawConnectionSegments(parentGfx, element.waypoints, {\n      ...attrs,\n      stroke,\n      strokeDasharray: '0, 5'\n    });\n  }\n\n  function renderDataObject(parentGfx, element, attrs = {}) {\n    var fill = getFillColor(element, defaultFillColor, attrs.fill),\n        stroke = getStrokeColor(element, defaultStrokeColor, attrs.stroke);\n\n    var pathData = pathMap.getScaledPath('DATA_OBJECT_PATH', {\n      xScaleFactor: 1,\n      yScaleFactor: 1,\n      containerWidth: element.width,\n      containerHeight: element.height,\n      position: {\n        mx: 0.474,\n        my: 0.296\n      }\n    });\n\n    var dataObject = drawPath(parentGfx, pathData, {\n      fill,\n      fillOpacity: DEFAULT_OPACITY,\n      stroke\n    });\n\n    var semantic = getSemantic(element);\n\n    if (isCollection(semantic)) {\n      var collectionPathData = pathMap.getScaledPath('DATA_OBJECT_COLLECTION_PATH', {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: element.width,\n        containerHeight: element.height,\n        position: {\n          mx: 0.33,\n          my: (element.height - 18) / element.height\n        }\n      });\n\n      drawPath(parentGfx, collectionPathData, {\n        strokeWidth: 2,\n        fill,\n        stroke\n      });\n    }\n\n    return dataObject;\n  }\n\n  function renderEvent(parentGfx, element, attrs = {}) {\n    return drawCircle(parentGfx, element.width, element.height, {\n      fillOpacity: DEFAULT_OPACITY,\n      ...attrs,\n      fill: getFillColor(element, defaultFillColor, attrs.fill),\n      stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke)\n    });\n  }\n\n  function renderGateway(parentGfx, element, attrs = {}) {\n    return drawDiamond(parentGfx, element.width, element.height, {\n      fill: getFillColor(element, defaultFillColor, attrs.fill),\n      fillOpacity: DEFAULT_OPACITY,\n      stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke)\n    });\n  }\n\n  function renderLane(parentGfx, element, attrs = {}) {\n    var lane = drawRect(parentGfx, getWidth(element, attrs), getHeight(element, attrs), 0, {\n      fill: getFillColor(element, defaultFillColor, attrs.fill),\n      fillOpacity: attrs.fillOpacity || DEFAULT_OPACITY,\n      stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n      strokeWidth: 1.5\n    });\n\n    var semantic = getSemantic(element);\n\n    if (is(semantic, 'bpmn:Lane')) {\n      var text = semantic.get('name');\n\n      renderLaneLabel(parentGfx, text, element, attrs);\n    }\n\n    return lane;\n  }\n\n  function renderSubProcess(parentGfx, element, attrs = {}) {\n    var activity = renderActivity(parentGfx, element, attrs);\n\n    var expanded = isExpanded(element);\n\n    if (isEventSubProcess(element)) {\n      svgAttr(activity, {\n        strokeDasharray: '0, 5.5',\n        strokeWidth: 2.5\n      });\n\n      if (!expanded) {\n        var flowElements = getSemantic(element).flowElements || [];\n        var startEvents = flowElements.filter(e => is(e, 'bpmn:StartEvent'));\n\n        if (startEvents.length === 1) {\n          renderEventSubProcessIcon(startEvents[0], parentGfx, attrs, element);\n        }\n      }\n    }\n\n    renderEmbeddedLabel(parentGfx, element, expanded ? 'center-top' : 'center-middle', attrs);\n\n    if (expanded) {\n      renderTaskMarkers(parentGfx, element, undefined, attrs);\n    } else {\n      renderTaskMarkers(parentGfx, element, [ 'SubProcessMarker' ], attrs);\n    }\n\n    return activity;\n  }\n\n  function renderEventSubProcessIcon(startEvent, parentGfx, attrs, proxyElement) {\n    var iconSize = 22;\n\n    // match the colors of the enclosing subprocess\n    var proxyAttrs = {\n      fill: getFillColor(proxyElement, defaultFillColor, attrs.fill),\n      stroke: getStrokeColor(proxyElement, defaultStrokeColor, attrs.stroke),\n      width: iconSize,\n      height: iconSize\n    };\n\n    var interrupting = getSemantic(startEvent).isInterrupting;\n    var strokeDasharray = interrupting ? 0 : 3;\n\n    // better visibility for non-interrupting events\n    var strokeWidth = interrupting ? 1 : 1.2;\n\n    // make the icon look larger by drawing a smaller circle\n    var circleSize = 20;\n    var shift = (iconSize - circleSize) / 2;\n    var transform = 'translate(' + shift + ',' + shift + ')';\n\n    drawCircle(parentGfx, circleSize, circleSize, {\n      fill: proxyAttrs.fill,\n      stroke: proxyAttrs.stroke,\n      strokeWidth,\n      strokeDasharray,\n      transform\n    });\n\n    renderEventIcon(startEvent, parentGfx, proxyAttrs, proxyElement);\n  }\n\n  function renderTask(parentGfx, element, attrs = {}) {\n    var activity = renderActivity(parentGfx, element, attrs);\n\n    renderEmbeddedLabel(parentGfx, element, 'center-middle', attrs);\n\n    renderTaskMarkers(parentGfx, element, undefined, attrs);\n\n    return activity;\n  }\n\n  var handlers = this.handlers = {\n    'bpmn:AdHocSubProcess': function(parentGfx, element, attrs = {}) {\n      if (isExpanded(element)) {\n        attrs = pickAttrs(attrs, [\n          'fill',\n          'stroke',\n          'width',\n          'height'\n        ]);\n      } else {\n        attrs = pickAttrs(attrs, [\n          'fill',\n          'stroke'\n        ]);\n      }\n\n      return renderSubProcess(parentGfx, element, attrs);\n    },\n    'bpmn:Association': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      return renderAssociation(parentGfx, element, attrs);\n    },\n    'bpmn:BoundaryEvent': function(parentGfx, element, attrs = {}) {\n      var { renderIcon = true } = attrs;\n\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var semantic = getSemantic(element),\n          cancelActivity = semantic.get('cancelActivity');\n\n      attrs = {\n        strokeWidth: 1.5,\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        fillOpacity: FULL_OPACITY,\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke)\n      };\n\n      if (!cancelActivity) {\n        attrs.strokeDasharray = '6';\n      }\n\n      var event = renderEvent(parentGfx, element, attrs);\n\n      drawCircle(parentGfx, element.width, element.height, INNER_OUTER_DIST, {\n        ...attrs,\n        fill: 'none'\n      });\n\n      if (renderIcon) {\n        renderEventIcon(element, parentGfx, attrs);\n      }\n\n      return event;\n    },\n    'bpmn:BusinessRuleTask': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var task = renderTask(parentGfx, element, attrs);\n\n      var headerData = pathMap.getScaledPath('TASK_TYPE_BUSINESS_RULE_MAIN', {\n        abspos: {\n          x: 8,\n          y: 8\n        }\n      });\n\n      var businessPath = drawPath(parentGfx, headerData);\n\n      svgAttr(businessPath, {\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 1\n      });\n\n      var headerPathData = pathMap.getScaledPath('TASK_TYPE_BUSINESS_RULE_HEADER', {\n        abspos: {\n          x: 8,\n          y: 8\n        }\n      });\n\n      var businessHeaderPath = drawPath(parentGfx, headerPathData);\n\n      svgAttr(businessHeaderPath, {\n        fill: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 1\n      });\n\n      return task;\n    },\n    'bpmn:CallActivity': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      return renderSubProcess(parentGfx, element, {\n        strokeWidth: 5,\n        ...attrs\n      });\n    },\n    'bpmn:ComplexGateway': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var gateway = renderGateway(parentGfx, element, attrs);\n\n      var pathData = pathMap.getScaledPath('GATEWAY_COMPLEX', {\n        xScaleFactor: 0.5,\n        yScaleFactor:0.5,\n        containerWidth: element.width,\n        containerHeight: element.height,\n        position: {\n          mx: 0.46,\n          my: 0.26\n        }\n      });\n\n      drawPath(parentGfx, pathData, {\n        fill: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 1\n      });\n\n      return gateway;\n    },\n    'bpmn:DataInput': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var arrowPathData = pathMap.getRawPath('DATA_ARROW');\n\n      var dataObject = renderDataObject(parentGfx, element, attrs);\n\n      drawPath(parentGfx, arrowPathData, {\n        fill: 'none',\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 1\n      });\n\n      return dataObject;\n    },\n    'bpmn:DataInputAssociation': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      return renderAssociation(parentGfx, element, {\n        ...attrs,\n        markerEnd: marker(parentGfx, 'association-end', getFillColor(element, defaultFillColor, attrs.fill), getStrokeColor(element, defaultStrokeColor, attrs.stroke))\n      });\n    },\n    'bpmn:DataObject': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      return renderDataObject(parentGfx, element, attrs);\n    },\n    'bpmn:DataObjectReference': as('bpmn:DataObject'),\n    'bpmn:DataOutput': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var arrowPathData = pathMap.getRawPath('DATA_ARROW');\n\n      var dataObject = renderDataObject(parentGfx, element, attrs);\n\n      drawPath(parentGfx, arrowPathData, {\n        strokeWidth: 1,\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke)\n      });\n\n      return dataObject;\n    },\n    'bpmn:DataOutputAssociation': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      return renderAssociation(parentGfx, element, {\n        ...attrs,\n        markerEnd: marker(parentGfx, 'association-end', getFillColor(element, defaultFillColor, attrs.fill), getStrokeColor(element, defaultStrokeColor, attrs.stroke))\n      });\n    },\n    'bpmn:DataStoreReference': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var dataStorePath = pathMap.getScaledPath('DATA_STORE', {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: element.width,\n        containerHeight: element.height,\n        position: {\n          mx: 0,\n          my: 0.133\n        }\n      });\n\n      return drawPath(parentGfx, dataStorePath, {\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        fillOpacity: DEFAULT_OPACITY,\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 2\n      });\n    },\n    'bpmn:EndEvent': function(parentGfx, element, attrs = {}) {\n      var { renderIcon = true } = attrs;\n\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var event = renderEvent(parentGfx, element, {\n        ...attrs,\n        strokeWidth: 4\n      });\n\n      if (renderIcon) {\n        renderEventIcon(element, parentGfx, attrs);\n      }\n\n      return event;\n    },\n    'bpmn:EventBasedGateway': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var semantic = getSemantic(element);\n\n      var diamond = renderGateway(parentGfx, element, attrs);\n\n      drawCircle(parentGfx, element.width, element.height, element.height * 0.20, {\n        fill: getFillColor(element, 'none', attrs.fill),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 1\n      });\n\n      var type = semantic.get('eventGatewayType'),\n          instantiate = !!semantic.get('instantiate');\n\n      function drawEvent() {\n\n        var pathData = pathMap.getScaledPath('GATEWAY_EVENT_BASED', {\n          xScaleFactor: 0.18,\n          yScaleFactor: 0.18,\n          containerWidth: element.width,\n          containerHeight: element.height,\n          position: {\n            mx: 0.36,\n            my: 0.44\n          }\n        });\n\n        drawPath(parentGfx, pathData, {\n          fill: 'none',\n          stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n          strokeWidth: 2\n        });\n      }\n\n      if (type === 'Parallel') {\n        var pathData = pathMap.getScaledPath('GATEWAY_PARALLEL', {\n          xScaleFactor: 0.4,\n          yScaleFactor: 0.4,\n          containerWidth: element.width,\n          containerHeight: element.height,\n          position: {\n            mx: 0.474,\n            my: 0.296\n          }\n        });\n\n        drawPath(parentGfx, pathData, {\n          fill: 'none',\n          stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n          strokeWidth: 1\n        });\n      } else if (type === 'Exclusive') {\n        if (!instantiate) {\n          drawCircle(parentGfx, element.width, element.height, element.height * 0.26, {\n            fill: 'none',\n            stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n            strokeWidth: 1\n          });\n        }\n\n        drawEvent();\n      }\n\n\n      return diamond;\n    },\n    'bpmn:ExclusiveGateway': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var gateway = renderGateway(parentGfx, element, attrs);\n\n      var pathData = pathMap.getScaledPath('GATEWAY_EXCLUSIVE', {\n        xScaleFactor: 0.4,\n        yScaleFactor: 0.4,\n        containerWidth: element.width,\n        containerHeight: element.height,\n        position: {\n          mx: 0.32,\n          my: 0.3\n        }\n      });\n\n      var di = getDi(element);\n\n      if (di.get('isMarkerVisible')) {\n        drawPath(parentGfx, pathData, {\n          fill: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n          stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n          strokeWidth: 1\n        });\n      }\n\n      return gateway;\n    },\n    'bpmn:Gateway': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      return renderGateway(parentGfx, element, attrs);\n    },\n    'bpmn:Group': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke',\n        'width',\n        'height'\n      ]);\n\n      return drawRect(parentGfx, element.width, element.height, TASK_BORDER_RADIUS, {\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 1.5,\n        strokeDasharray: '10, 6, 0, 6',\n        fill: 'none',\n        pointerEvents: 'none',\n        width: getWidth(element, attrs),\n        height: getHeight(element, attrs)\n      });\n    },\n    'bpmn:InclusiveGateway': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var gateway = renderGateway(parentGfx, element, attrs);\n\n      drawCircle(parentGfx, element.width, element.height, element.height * 0.24, {\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 2.5\n      });\n\n      return gateway;\n    },\n    'bpmn:IntermediateEvent': function(parentGfx, element, attrs = {}) {\n      var { renderIcon = true } = attrs;\n\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var outer = renderEvent(parentGfx, element, {\n        ...attrs,\n        strokeWidth: 1.5\n      });\n\n      drawCircle(parentGfx, element.width, element.height, INNER_OUTER_DIST, {\n        fill: 'none',\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 1.5\n      });\n\n      if (renderIcon) {\n        renderEventIcon(element, parentGfx, attrs);\n      }\n\n      return outer;\n    },\n    'bpmn:IntermediateCatchEvent': as('bpmn:IntermediateEvent'),\n    'bpmn:IntermediateThrowEvent': as('bpmn:IntermediateEvent'),\n    'bpmn:Lane': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke',\n        'width',\n        'height'\n      ]);\n\n      return renderLane(parentGfx, element, {\n        ...attrs,\n        fillOpacity: LOW_OPACITY\n      });\n    },\n    'bpmn:ManualTask': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var task = renderTask(parentGfx, element, attrs);\n\n      var pathData = pathMap.getScaledPath('TASK_TYPE_MANUAL', {\n        abspos: {\n          x: 17,\n          y: 15\n        }\n      });\n\n      drawPath(parentGfx, pathData, {\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 0.5\n      });\n\n      return task;\n    },\n    'bpmn:MessageFlow': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var semantic = getSemantic(element),\n          di = getDi(element);\n\n      var fill = getFillColor(element, defaultFillColor, attrs.fill),\n          stroke = getStrokeColor(element, defaultStrokeColor, attrs.stroke);\n\n      var path = drawConnectionSegments(parentGfx, element.waypoints, {\n        markerEnd: marker(parentGfx, 'messageflow-end', fill, stroke),\n        markerStart: marker(parentGfx, 'messageflow-start', fill, stroke),\n        stroke,\n        strokeDasharray: '10, 11',\n        strokeWidth: 1.5\n      });\n\n      if (semantic.get('messageRef')) {\n        var midPoint = path.getPointAtLength(path.getTotalLength() / 2);\n\n        var markerPathData = pathMap.getScaledPath('MESSAGE_FLOW_MARKER', {\n          abspos: {\n            x: midPoint.x,\n            y: midPoint.y\n          }\n        });\n\n        var messageAttrs = {\n          strokeWidth: 1\n        };\n\n        if (di.get('messageVisibleKind') === 'initiating') {\n          messageAttrs.fill = fill;\n          messageAttrs.stroke = stroke;\n        } else {\n          messageAttrs.fill = stroke;\n          messageAttrs.stroke = fill;\n        }\n\n        var message = drawPath(parentGfx, markerPathData, messageAttrs);\n\n        var messageRef = semantic.get('messageRef'),\n            name = messageRef.get('name');\n\n        var label = renderLabel(parentGfx, name, {\n          align: 'center-top',\n          fitBox: true,\n          style: {\n            fill: stroke\n          }\n        });\n\n        var messageBounds = message.getBBox(),\n            labelBounds = label.getBBox();\n\n        var translateX = midPoint.x - labelBounds.width / 2,\n            translateY = midPoint.y + messageBounds.height / 2 + ELEMENT_LABEL_DISTANCE;\n\n        transform(label, translateX, translateY, 0);\n      }\n\n      return path;\n    },\n    'bpmn:ParallelGateway': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var diamond = renderGateway(parentGfx, element, attrs);\n\n      var pathData = pathMap.getScaledPath('GATEWAY_PARALLEL', {\n        xScaleFactor: 0.6,\n        yScaleFactor: 0.6,\n        containerWidth: element.width,\n        containerHeight: element.height,\n        position: {\n          mx: 0.46,\n          my: 0.2\n        }\n      });\n\n      drawPath(parentGfx, pathData, {\n        fill: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 1\n      });\n\n      return diamond;\n    },\n    'bpmn:Participant': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke',\n        'width',\n        'height'\n      ]);\n\n      var participant = renderLane(parentGfx, element, attrs);\n\n      var expandedParticipant = isExpanded(element);\n      var horizontalParticipant = isHorizontal(element);\n\n      var semantic = getSemantic(element),\n          name = semantic.get('name');\n\n      if (expandedParticipant) {\n        var waypoints = horizontalParticipant ? [\n          {\n            x: 30,\n            y: 0\n          },\n          {\n            x: 30,\n            y: getHeight(element, attrs)\n          }\n        ] : [\n          {\n            x: 0,\n            y: 30\n          },\n          {\n            x: getWidth(element, attrs),\n            y: 30\n          }\n        ];\n\n        drawLine(parentGfx, waypoints, {\n          stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n          strokeWidth: PARTICIPANT_STROKE_WIDTH\n        });\n\n        renderLaneLabel(parentGfx, name, element, attrs);\n      } else {\n        var bounds = getBounds(element, attrs);\n\n        if (!horizontalParticipant) {\n          bounds.height = getWidth(element, attrs);\n          bounds.width = getHeight(element, attrs);\n        }\n\n        var textBox = renderLabel(parentGfx, name, {\n          box: bounds,\n          align: 'center-middle',\n          style: {\n            fill: getLabelColor(element, defaultLabelColor, defaultStrokeColor, attrs.stroke)\n          }\n        });\n\n        if (!horizontalParticipant) {\n          var top = -1 * getHeight(element, attrs);\n          transform(textBox, 0, -top, 270);\n        }\n      }\n\n      if (semantic.get('participantMultiplicity')) {\n        renderTaskMarker('ParticipantMultiplicityMarker', parentGfx, element, attrs);\n      }\n\n      return participant;\n    },\n    'bpmn:ReceiveTask' : function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var semantic = getSemantic(element);\n\n      var task = renderTask(parentGfx, element, attrs);\n\n      var pathData;\n\n      if (semantic.get('instantiate')) {\n        drawCircle(parentGfx, 28, 28, 20 * 0.22, {\n          fill: getFillColor(element, defaultFillColor, attrs.fill),\n          stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n          strokeWidth: 1\n        });\n\n        pathData = pathMap.getScaledPath('TASK_TYPE_INSTANTIATING_SEND', {\n          abspos: {\n            x: 7.77,\n            y: 9.52\n          }\n        });\n      } else {\n        pathData = pathMap.getScaledPath('TASK_TYPE_SEND', {\n          xScaleFactor: 0.9,\n          yScaleFactor: 0.9,\n          containerWidth: 21,\n          containerHeight: 14,\n          position: {\n            mx: 0.3,\n            my: 0.4\n          }\n        });\n      }\n\n      drawPath(parentGfx, pathData, {\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 1\n      });\n\n      return task;\n    },\n    'bpmn:ScriptTask': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var task = renderTask(parentGfx, element, attrs);\n\n      var pathData = pathMap.getScaledPath('TASK_TYPE_SCRIPT', {\n        abspos: {\n          x: 15,\n          y: 20\n        }\n      });\n\n      drawPath(parentGfx, pathData, {\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 1\n      });\n\n      return task;\n    },\n    'bpmn:SendTask': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var task = renderTask(parentGfx, element, attrs);\n\n      var pathData = pathMap.getScaledPath('TASK_TYPE_SEND', {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: 21,\n        containerHeight: 14,\n        position: {\n          mx: 0.285,\n          my: 0.357\n        }\n      });\n\n      drawPath(parentGfx, pathData, {\n        fill: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        stroke: getFillColor(element, defaultFillColor, attrs.fill),\n        strokeWidth: 1\n      });\n\n      return task;\n    },\n    'bpmn:SequenceFlow': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var fill = getFillColor(element, defaultFillColor, attrs.fill),\n          stroke = getStrokeColor(element, defaultStrokeColor, attrs.stroke);\n\n      var connection = drawConnectionSegments(parentGfx, element.waypoints, {\n        markerEnd: marker(parentGfx, 'sequenceflow-end', fill, stroke),\n        stroke\n      });\n\n      var semantic = getSemantic(element);\n\n      var { source } = element;\n\n      if (source) {\n        var sourceSemantic = getSemantic(source);\n\n        // conditional flow marker\n        if (semantic.get('conditionExpression') && is(sourceSemantic, 'bpmn:Activity')) {\n          svgAttr(connection, {\n            markerStart: marker(parentGfx, 'conditional-flow-marker', fill, stroke)\n          });\n        }\n\n        // default marker\n        if (sourceSemantic.get('default') && (is(sourceSemantic, 'bpmn:Gateway') || is(sourceSemantic, 'bpmn:Activity')) &&\n            sourceSemantic.get('default') === semantic) {\n          svgAttr(connection, {\n            markerStart: marker(parentGfx, 'conditional-default-flow-marker', fill, stroke)\n          });\n        }\n      }\n\n      return connection;\n    },\n    'bpmn:ServiceTask': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var task = renderTask(parentGfx, element, attrs);\n\n      drawCircle(parentGfx, 10, 10, {\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        stroke: 'none',\n        transform: 'translate(6, 6)'\n      });\n\n      var pathDataService1 = pathMap.getScaledPath('TASK_TYPE_SERVICE', {\n        abspos: {\n          x: 12,\n          y: 18\n        }\n      });\n\n      drawPath(parentGfx, pathDataService1, {\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 1\n      });\n\n      drawCircle(parentGfx, 10, 10, {\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        stroke: 'none',\n        transform: 'translate(11, 10)'\n      });\n\n      var pathDataService2 = pathMap.getScaledPath('TASK_TYPE_SERVICE', {\n        abspos: {\n          x: 17,\n          y: 22\n        }\n      });\n\n      drawPath(parentGfx, pathDataService2, {\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 1\n      });\n\n      return task;\n    },\n    'bpmn:StartEvent': function(parentGfx, element, attrs = {}) {\n      var { renderIcon = true } = attrs;\n\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var semantic = getSemantic(element);\n\n      if (!semantic.get('isInterrupting')) {\n        attrs = {\n          ...attrs,\n          strokeDasharray: '6'\n        };\n      }\n\n      var event = renderEvent(parentGfx, element, attrs);\n\n      if (renderIcon) {\n        renderEventIcon(element, parentGfx, attrs);\n      }\n\n      return event;\n    },\n    'bpmn:SubProcess': function(parentGfx, element, attrs = {}) {\n      if (isExpanded(element)) {\n        attrs = pickAttrs(attrs, [\n          'fill',\n          'stroke',\n          'width',\n          'height'\n        ]);\n      } else {\n        attrs = pickAttrs(attrs, [\n          'fill',\n          'stroke'\n        ]);\n      }\n\n      return renderSubProcess(parentGfx, element, attrs);\n    },\n    'bpmn:Task': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      return renderTask(parentGfx, element, attrs);\n    },\n    'bpmn:TextAnnotation': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke',\n        'width',\n        'height'\n      ]);\n\n      var {\n        width,\n        height\n      } = getBounds(element, attrs);\n\n      var textElement = drawRect(parentGfx, width, height, 0, 0, {\n        fill: 'none',\n        stroke: 'none'\n      });\n\n      var textPathData = pathMap.getScaledPath('TEXT_ANNOTATION', {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: width,\n        containerHeight: height,\n        position: {\n          mx: 0.0,\n          my: 0.0\n        }\n      });\n\n      drawPath(parentGfx, textPathData, {\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke)\n      });\n\n      var semantic = getSemantic(element),\n          text = semantic.get('text') || '';\n\n      renderLabel(parentGfx, text, {\n        align: 'left-top',\n        box: getBounds(element, attrs),\n        padding: 7,\n        style: {\n          fill: getLabelColor(element, defaultLabelColor, defaultStrokeColor, attrs.stroke)\n        }\n      });\n\n      return textElement;\n    },\n    'bpmn:Transaction': function(parentGfx, element, attrs = {}) {\n      if (isExpanded(element)) {\n        attrs = pickAttrs(attrs, [\n          'fill',\n          'stroke',\n          'width',\n          'height'\n        ]);\n      } else {\n        attrs = pickAttrs(attrs, [\n          'fill',\n          'stroke'\n        ]);\n      }\n\n      var outer = renderSubProcess(parentGfx, element, {\n        strokeWidth: 1.5,\n        ...attrs\n      });\n\n      var innerAttrs = styles.style([ 'no-fill', 'no-events' ], {\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 1.5\n      });\n\n      var expanded = isExpanded(element);\n\n      if (!expanded) {\n        attrs = {};\n      }\n\n      drawRect(\n        parentGfx,\n        getWidth(element, attrs),\n        getHeight(element, attrs),\n        TASK_BORDER_RADIUS - INNER_OUTER_DIST,\n        INNER_OUTER_DIST,\n        innerAttrs\n      );\n\n      return outer;\n    },\n    'bpmn:UserTask': function(parentGfx, element, attrs = {}) {\n      attrs = pickAttrs(attrs, [\n        'fill',\n        'stroke'\n      ]);\n\n      var task = renderTask(parentGfx, element, attrs);\n\n      var x = 15;\n      var y = 12;\n\n      var pathDataUser1 = pathMap.getScaledPath('TASK_TYPE_USER_1', {\n        abspos: {\n          x: x,\n          y: y\n        }\n      });\n\n      drawPath(parentGfx, pathDataUser1, {\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 0.5\n      });\n\n      var pathDataUser2 = pathMap.getScaledPath('TASK_TYPE_USER_2', {\n        abspos: {\n          x: x,\n          y: y\n        }\n      });\n\n      drawPath(parentGfx, pathDataUser2, {\n        fill: getFillColor(element, defaultFillColor, attrs.fill),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 0.5\n      });\n\n      var pathDataUser3 = pathMap.getScaledPath('TASK_TYPE_USER_3', {\n        abspos: {\n          x: x,\n          y: y\n        }\n      });\n\n      drawPath(parentGfx, pathDataUser3, {\n        fill: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        stroke: getStrokeColor(element, defaultStrokeColor, attrs.stroke),\n        strokeWidth: 0.5\n      });\n\n      return task;\n    },\n    'label': function(parentGfx, element, attrs = {}) {\n      return renderExternalLabel(parentGfx, element, attrs);\n    }\n  };\n\n  // extension API, use at your own risk\n  this._drawPath = drawPath;\n\n  this._renderer = renderer;\n}\n\n\ninherits(BpmnRenderer, BaseRenderer);\n\nBpmnRenderer.$inject = [\n  'config.bpmnRenderer',\n  'eventBus',\n  'styles',\n  'pathMap',\n  'canvas',\n  'textRenderer'\n];\n\n\n/**\n * @param {Element} element\n *\n * @return {boolean}\n */\nBpmnRenderer.prototype.canRender = function(element) {\n  return is(element, 'bpmn:BaseElement');\n};\n\n/**\n * Draw shape into parentGfx.\n *\n * @param {SVGElement} parentGfx\n * @param {Shape} shape\n * @param {Attrs} [attrs]\n *\n * @return {SVGElement} mainGfx\n */\nBpmnRenderer.prototype.drawShape = function(parentGfx, shape, attrs = {}) {\n  var { type } = shape;\n\n  var handler = this._renderer(type);\n\n  return handler(parentGfx, shape, attrs);\n};\n\n/**\n * Draw connection into parentGfx.\n *\n * @param {SVGElement} parentGfx\n * @param {Connection} connection\n * @param {Attrs} [attrs]\n *\n * @return {SVGElement} mainGfx\n */\nBpmnRenderer.prototype.drawConnection = function(parentGfx, connection, attrs = {}) {\n  var { type } = connection;\n\n  var handler = this._renderer(type);\n\n  return handler(parentGfx, connection, attrs);\n};\n\n/**\n * Get shape path.\n *\n * @param {Shape} shape\n *\n * @return {string} path\n */\nBpmnRenderer.prototype.getShapePath = function(shape) {\n  if (is(shape, 'bpmn:Event')) {\n    return getCirclePath(shape);\n  }\n\n  if (is(shape, 'bpmn:Activity')) {\n    return getRoundRectPath(shape, TASK_BORDER_RADIUS);\n  }\n\n  if (is(shape, 'bpmn:Gateway')) {\n    return getDiamondPath(shape);\n  }\n\n  return getRectPath(shape);\n};\n\n/**\n * Pick attributes if they exist.\n *\n * @param {Object} attrs\n * @param {string[]} keys\n *\n * @returns {Object}\n */\nfunction pickAttrs(attrs, keys = []) {\n  return keys.reduce((pickedAttrs, key) => {\n    if (attrs[ key ]) {\n      pickedAttrs[ key ] = attrs[ key ];\n    }\n\n    return pickedAttrs;\n  }, {});\n}","import {\n  isObject,\n  assign,\n  forEach,\n  reduce\n} from 'min-dash';\n\nimport {\n  append as svgAppend,\n  attr as svgAttr,\n  create as svgCreate,\n  remove as svgRemove\n} from 'tiny-svg';\n\nimport {\n  assignStyle\n} from 'min-dom';\n\n\n/**\n * @typedef {import('../util/Types').Dimensions} Dimensions\n *\n * @typedef { {\n *   top: number;\n *   left: number;\n *   right: number;\n *   bottom: number;\n * } } Padding\n *\n * @typedef { number | Partial<Padding> } PaddingConfig\n *\n * @typedef { {\n *   horizontal: 'center' | 'left' | 'right';\n *   vertical: 'top' | 'middle';\n * } } Alignment\n *\n *  @typedef { 'center-middle' | 'center-top' } AlignmentConfig\n *\n * @typedef { Partial<{\n *   align: AlignmentConfig;\n *   style: Record<string, number | string>;\n *   padding: PaddingConfig;\n * }> } BaseTextConfig\n *\n * @typedef { BaseTextConfig & Partial<{\n *   size: Dimensions;\n * }> } TextConfig\n *\n * @typedef { BaseTextConfig & Partial<{\n *   box: Dimensions;\n *   fitBox: boolean;\n * }> } TextLayoutConfig\n *\n *  @typedef { Dimensions & {\n *  text: string;\n * } } LineDescriptor\n */\n\nvar DEFAULT_BOX_PADDING = 0;\n\nvar DEFAULT_LABEL_SIZE = {\n  width: 150,\n  height: 50\n};\n\n\n/**\n * @param {AlignmentConfig} align\n * @return {Alignment}\n */\nfunction parseAlign(align) {\n\n  var parts = align.split('-');\n\n  return {\n    horizontal: parts[0] || 'center',\n    vertical: parts[1] || 'top'\n  };\n}\n\n/**\n * @param {PaddingConfig} padding\n *\n * @return {Padding}\n */\nfunction parsePadding(padding) {\n\n  if (isObject(padding)) {\n    return assign({ top: 0, left: 0, right: 0, bottom: 0 }, padding);\n  } else {\n    return {\n      top: padding,\n      left: padding,\n      right: padding,\n      bottom: padding\n    };\n  }\n}\n\n/**\n * @param {string} text\n * @param {SVGTextElement} fakeText\n *\n * @return {import('../util/Types').Dimensions}\n */\nfunction getTextBBox(text, fakeText) {\n\n  fakeText.textContent = text;\n\n  var textBBox;\n\n  try {\n    var bbox,\n        emptyLine = text === '';\n\n    // add dummy text, when line is empty to\n    // determine correct height\n    fakeText.textContent = emptyLine ? 'dummy' : text;\n\n    textBBox = fakeText.getBBox();\n\n    // take text rendering related horizontal\n    // padding into account\n    bbox = {\n      width: textBBox.width + textBBox.x * 2,\n      height: textBBox.height\n    };\n\n    if (emptyLine) {\n\n      // correct width\n      bbox.width = 0;\n    }\n\n    return bbox;\n  } catch (e) {\n    console.log(e);\n\n    return { width: 0, height: 0 };\n  }\n}\n\n\n/**\n * Layout the next line and return the layouted element.\n *\n * Alters the lines passed.\n *\n * @param {string[]} lines\n * @param {number} maxWidth\n * @param {SVGTextElement} fakeText\n *\n * @return {LineDescriptor} the line descriptor\n */\nfunction layoutNext(lines, maxWidth, fakeText) {\n\n  var originalLine = lines.shift(),\n      fitLine = originalLine;\n\n  var textBBox;\n\n  for (;;) {\n    textBBox = getTextBBox(fitLine, fakeText);\n\n    textBBox.width = fitLine ? textBBox.width : 0;\n\n    // try to fit\n    if (fitLine === ' ' || fitLine === '' || textBBox.width < Math.round(maxWidth) || fitLine.length < 2) {\n      return fit(lines, fitLine, originalLine, textBBox);\n    }\n\n    fitLine = shortenLine(fitLine, textBBox.width, maxWidth);\n  }\n}\n\n/**\n * @param {string[]} lines\n * @param {string} fitLine\n * @param {string} originalLine\n * @param {Dimensions} textBBox\n *\n * @return {LineDescriptor}\n */\nfunction fit(lines, fitLine, originalLine, textBBox) {\n  if (fitLine.length < originalLine.length) {\n    var remainder = originalLine.slice(fitLine.length).trim();\n\n    lines.unshift(remainder);\n  }\n\n  return {\n    width: textBBox.width,\n    height: textBBox.height,\n    text: fitLine\n  };\n}\n\nvar SOFT_BREAK = '\\u00AD';\n\n\n/**\n * Shortens a line based on spacing and hyphens.\n * Returns the shortened result on success.\n *\n * @param {string} line\n * @param {number} maxLength the maximum characters of the string\n *\n * @return {string} the shortened string\n */\nfunction semanticShorten(line, maxLength) {\n\n  var parts = line.split(/(\\s|-|\\u00AD)/g),\n      part,\n      shortenedParts = [],\n      length = 0;\n\n  // try to shorten via break chars\n  if (parts.length > 1) {\n\n    while ((part = parts.shift())) {\n      if (part.length + length < maxLength) {\n        shortenedParts.push(part);\n        length += part.length;\n      } else {\n\n        // remove previous part, too if hyphen does not fit anymore\n        if (part === '-' || part === SOFT_BREAK) {\n          shortenedParts.pop();\n        }\n\n        break;\n      }\n    }\n  }\n\n  var last = shortenedParts[shortenedParts.length - 1];\n\n  // translate trailing soft break to actual hyphen\n  if (last && last === SOFT_BREAK) {\n    shortenedParts[shortenedParts.length - 1] = '-';\n  }\n\n  return shortenedParts.join('');\n}\n\n\n/**\n * @param {string} line\n * @param {number} width\n * @param {number} maxWidth\n *\n * @return {string}\n */\nfunction shortenLine(line, width, maxWidth) {\n  var length = Math.max(line.length * (maxWidth / width), 1);\n\n  // try to shorten semantically (i.e. based on spaces and hyphens)\n  var shortenedLine = semanticShorten(line, length);\n\n  if (!shortenedLine) {\n\n    // force shorten by cutting the long word\n    shortenedLine = line.slice(0, Math.max(Math.round(length - 1), 1));\n  }\n\n  return shortenedLine;\n}\n\n\n/**\n * @return {SVGSVGElement}\n */\nfunction getHelperSvg() {\n  var helperSvg = document.getElementById('helper-svg');\n\n  if (!helperSvg) {\n    helperSvg = svgCreate('svg');\n\n    svgAttr(helperSvg, {\n      id: 'helper-svg'\n    });\n\n    assignStyle(helperSvg, {\n      visibility: 'hidden',\n      position: 'fixed',\n      width: 0,\n      height: 0\n    });\n\n    document.body.appendChild(helperSvg);\n  }\n\n  return helperSvg;\n}\n\n\n/**\n * Creates a new label utility\n *\n * @param {TextConfig} [config]\n */\nexport default function Text(config) {\n\n  this._config = assign({}, {\n    size: DEFAULT_LABEL_SIZE,\n    padding: DEFAULT_BOX_PADDING,\n    style: {},\n    align: 'center-top'\n  }, config || {});\n}\n\n/**\n * Returns the layouted text as an SVG element.\n *\n * @param {string} text\n * @param {TextLayoutConfig} options\n *\n * @return {SVGElement}\n */\nText.prototype.createText = function(text, options) {\n  return this.layoutText(text, options).element;\n};\n\n/**\n * Returns a labels layouted dimensions.\n *\n * @param {string} text to layout\n * @param {TextLayoutConfig} options\n *\n * @return {Dimensions}\n */\nText.prototype.getDimensions = function(text, options) {\n  return this.layoutText(text, options).dimensions;\n};\n\n/**\n * Creates and returns a label and its bounding box.\n *\n * @param {string} text the text to render on the label\n * @param {TextLayoutConfig} options\n *\n * @return { {\n *   element: SVGElement,\n *   dimensions: Dimensions\n * } }\n */\nText.prototype.layoutText = function(text, options) {\n  var box = assign({}, this._config.size, options.box),\n      style = assign({}, this._config.style, options.style),\n      align = parseAlign(options.align || this._config.align),\n      padding = parsePadding(options.padding !== undefined ? options.padding : this._config.padding),\n      fitBox = options.fitBox || false;\n\n  var lineHeight = getLineHeight(style);\n\n  // we split text by lines and normalize\n  // {soft break} + {line break} => { line break }\n  var lines = text.split(/\\u00AD?\\r?\\n/),\n      layouted = [];\n\n  var maxWidth = box.width - padding.left - padding.right;\n\n  // ensure correct rendering by attaching helper text node to invisible SVG\n  var helperText = svgCreate('text');\n  svgAttr(helperText, { x: 0, y: 0 });\n  svgAttr(helperText, style);\n\n  var helperSvg = getHelperSvg();\n\n  svgAppend(helperSvg, helperText);\n\n  while (lines.length) {\n    layouted.push(layoutNext(lines, maxWidth, helperText));\n  }\n\n  if (align.vertical === 'middle') {\n    padding.top = padding.bottom = 0;\n  }\n\n  var totalHeight = reduce(layouted, function(sum, line, idx) {\n    return sum + (lineHeight || line.height);\n  }, 0) + padding.top + padding.bottom;\n\n  var maxLineWidth = reduce(layouted, function(sum, line, idx) {\n    return line.width > sum ? line.width : sum;\n  }, 0);\n\n  // the y position of the next line\n  var y = padding.top;\n\n  if (align.vertical === 'middle') {\n    y += (box.height - totalHeight) / 2;\n  }\n\n  // magic number initial offset\n  y -= (lineHeight || layouted[0].height) / 4;\n\n\n  var textElement = svgCreate('text');\n\n  svgAttr(textElement, style);\n\n  // layout each line taking into account that parent\n  // shape might resize to fit text size\n  forEach(layouted, function(line) {\n\n    var x;\n\n    y += (lineHeight || line.height);\n\n    switch (align.horizontal) {\n    case 'left':\n      x = padding.left;\n      break;\n\n    case 'right':\n      x = ((fitBox ? maxLineWidth : maxWidth)\n        - padding.right - line.width);\n      break;\n\n    default:\n\n      // aka center\n      x = Math.max((((fitBox ? maxLineWidth : maxWidth)\n        - line.width) / 2 + padding.left), 0);\n    }\n\n    var tspan = svgCreate('tspan');\n    svgAttr(tspan, { x: x, y: y });\n\n    tspan.textContent = line.text;\n\n    svgAppend(textElement, tspan);\n  });\n\n  svgRemove(helperText);\n\n  var dimensions = {\n    width: maxLineWidth,\n    height: totalHeight\n  };\n\n  return {\n    dimensions: dimensions,\n    element: textElement\n  };\n};\n\n\nfunction getLineHeight(style) {\n  if ('fontSize' in style && 'lineHeight' in style) {\n    return style.lineHeight * parseInt(style.fontSize, 10);\n  }\n}\n","import { assign } from 'min-dash';\r\n\r\nimport TextUtil from 'diagram-js/lib/util/Text';\r\n\r\nvar DEFAULT_FONT_SIZE = 12;\r\nvar LINE_HEIGHT_RATIO = 1.2;\r\n\r\nvar MIN_TEXT_ANNOTATION_HEIGHT = 30;\r\n\r\n/**\r\n * @typedef { {\r\n *   fontFamily: string;\r\n *   fontSize: number;\r\n *   fontWeight: string;\r\n *   lineHeight: number;\r\n * } } TextRendererStyle\r\n *\r\n * @typedef { {\r\n *   defaultStyle?: Partial<TextRendererStyle>;\r\n *   externalStyle?: Partial<TextRendererStyle>;\r\n * } } TextRendererConfig\r\n *\r\n * @typedef { import('diagram-js/lib/util/Text').TextLayoutConfig } TextLayoutConfig\r\n *\r\n * @typedef { import('diagram-js/lib/util/Types').Rect } Rect\r\n */\r\n\r\n\r\n/**\r\n * Renders text and computes text bounding boxes.\r\n *\r\n * @param {TextRendererConfig} [config]\r\n */\r\nexport default function TextRenderer(config) {\r\n\r\n  var defaultStyle = assign({\r\n    fontFamily: 'Arial, sans-serif',\r\n    fontSize: DEFAULT_FONT_SIZE,\r\n    fontWeight: 'normal',\r\n    lineHeight: LINE_HEIGHT_RATIO\r\n  }, config && config.defaultStyle || {});\r\n\r\n  var fontSize = parseInt(defaultStyle.fontSize, 10) - 1;\r\n\r\n  var externalStyle = assign({}, defaultStyle, {\r\n    fontSize: fontSize\r\n  }, config && config.externalStyle || {});\r\n\r\n  var textUtil = new TextUtil({\r\n    style: defaultStyle\r\n  });\r\n\r\n  /**\r\n   * Get the new bounds of an externally rendered,\r\n   * layouted label.\r\n   *\r\n   * @param {Rect} bounds\r\n   * @param {string} text\r\n   *\r\n   * @return {Rect}\r\n   */\r\n  this.getExternalLabelBounds = function(bounds, text) {\r\n\r\n    var layoutedDimensions = textUtil.getDimensions(text, {\r\n      box: {\r\n        width: 90,\r\n        height: 30\r\n      },\r\n      style: externalStyle\r\n    });\r\n\r\n    // resize label shape to fit label text\r\n    return {\r\n      x: Math.round(bounds.x + bounds.width / 2 - layoutedDimensions.width / 2),\r\n      y: Math.round(bounds.y),\r\n      width: Math.ceil(layoutedDimensions.width),\r\n      height: Math.ceil(layoutedDimensions.height)\r\n    };\r\n\r\n  };\r\n\r\n  /**\r\n   * Get the new bounds of text annotation.\r\n   *\r\n   * @param {Rect} bounds\r\n   * @param {string} text\r\n   *\r\n   * @return {Rect}\r\n   */\r\n  this.getTextAnnotationBounds = function(bounds, text) {\r\n\r\n    var layoutedDimensions = textUtil.getDimensions(text, {\r\n      box: bounds,\r\n      style: defaultStyle,\r\n      align: 'left-top',\r\n      padding: 5\r\n    });\r\n\r\n    return {\r\n      x: bounds.x,\r\n      y: bounds.y,\r\n      width: bounds.width,\r\n      height: Math.max(MIN_TEXT_ANNOTATION_HEIGHT, Math.round(layoutedDimensions.height))\r\n    };\r\n  };\r\n\r\n  /**\r\n   * Create a layouted text element.\r\n   *\r\n   * @param {string} text\r\n   * @param {TextLayoutConfig} [options]\r\n   *\r\n   * @return {SVGElement} rendered text\r\n   */\r\n  this.createText = function(text, options) {\r\n    return textUtil.createText(text, options || {});\r\n  };\r\n\r\n  /**\r\n   * Get default text style.\r\n   */\r\n  this.getDefaultStyle = function() {\r\n    return defaultStyle;\r\n  };\r\n\r\n  /**\r\n   * Get the external text style.\r\n   */\r\n  this.getExternalStyle = function() {\r\n    return externalStyle;\r\n  };\r\n\r\n}\r\n\r\nTextRenderer.$inject = [\r\n  'config.textRenderer'\r\n];","/**\r\n * Map containing SVG paths needed by BpmnRenderer\r\n */\r\nexport default function PathMap() {\r\n\r\n  /**\r\n   * Contains a map of path elements\r\n   *\r\n   * <h1>Path definition</h1>\r\n   * A parameterized path is defined like this:\r\n   * <pre>\r\n   * 'GATEWAY_PARALLEL': {\r\n   *   d: 'm {mx},{my} {e.x0},0 0,{e.x1} {e.x1},0 0,{e.y0} -{e.x1},0 0,{e.y1} ' +\r\n          '-{e.x0},0 0,-{e.y1} -{e.x1},0 0,-{e.y0} {e.x1},0 z',\r\n   *   height: 17.5,\r\n   *   width:  17.5,\r\n   *   heightElements: [2.5, 7.5],\r\n   *   widthElements: [2.5, 7.5]\r\n   * }\r\n   * </pre>\r\n   * <p>It's important to specify a correct <b>height and width</b> for the path as the scaling\r\n   * is based on the ratio between the specified height and width in this object and the\r\n   * height and width that is set as scale target (Note x,y coordinates will be scaled with\r\n   * individual ratios).</p>\r\n   * <p>The '<b>heightElements</b>' and '<b>widthElements</b>' array must contain the values that will be scaled.\r\n   * The scaling is based on the computed ratios.\r\n   * Coordinates on the y axis should be in the <b>heightElement</b>'s array, they will be scaled using\r\n   * the computed ratio coefficient.\r\n   * In the parameterized path the scaled values can be accessed through the 'e' object in {} brackets.\r\n   *   <ul>\r\n   *    <li>The values for the y axis can be accessed in the path string using {e.y0}, {e.y1}, ....</li>\r\n   *    <li>The values for the x axis can be accessed in the path string using {e.x0}, {e.x1}, ....</li>\r\n   *   </ul>\r\n   *   The numbers x0, x1 respectively y0, y1, ... map to the corresponding array index.\r\n   * </p>\r\n   */\r\n  this.pathMap = {\r\n    'EVENT_MESSAGE': {\r\n      d: 'm {mx},{my} l 0,{e.y1} l {e.x1},0 l 0,-{e.y1} z l {e.x0},{e.y0} l {e.x0},-{e.y0}',\r\n      height: 36,\r\n      width:  36,\r\n      heightElements: [ 6, 14 ],\r\n      widthElements: [ 10.5, 21 ]\r\n    },\r\n    'EVENT_SIGNAL': {\r\n      d: 'M {mx},{my} l {e.x0},{e.y0} l -{e.x1},0 Z',\r\n      height: 36,\r\n      width: 36,\r\n      heightElements: [ 18 ],\r\n      widthElements: [ 10, 20 ]\r\n    },\r\n    'EVENT_ESCALATION': {\r\n      d: 'M {mx},{my} l {e.x0},{e.y0} l -{e.x0},-{e.y1} l -{e.x0},{e.y1} Z',\r\n      height: 36,\r\n      width: 36,\r\n      heightElements: [ 20, 7 ],\r\n      widthElements: [ 8 ]\r\n    },\r\n    'EVENT_CONDITIONAL': {\r\n      d: 'M {e.x0},{e.y0} l {e.x1},0 l 0,{e.y2} l -{e.x1},0 Z ' +\r\n         'M {e.x2},{e.y3} l {e.x0},0 ' +\r\n         'M {e.x2},{e.y4} l {e.x0},0 ' +\r\n         'M {e.x2},{e.y5} l {e.x0},0 ' +\r\n         'M {e.x2},{e.y6} l {e.x0},0 ' +\r\n         'M {e.x2},{e.y7} l {e.x0},0 ' +\r\n         'M {e.x2},{e.y8} l {e.x0},0 ',\r\n      height: 36,\r\n      width:  36,\r\n      heightElements: [ 8.5, 14.5, 18, 11.5, 14.5, 17.5, 20.5, 23.5, 26.5 ],\r\n      widthElements:  [ 10.5, 14.5, 12.5 ]\r\n    },\r\n    'EVENT_LINK': {\r\n      d: 'm {mx},{my} 0,{e.y0} -{e.x1},0 0,{e.y1} {e.x1},0 0,{e.y0} {e.x0},-{e.y2} -{e.x0},-{e.y2} z',\r\n      height: 36,\r\n      width: 36,\r\n      heightElements: [ 4.4375, 6.75, 7.8125 ],\r\n      widthElements: [ 9.84375, 13.5 ]\r\n    },\r\n    'EVENT_ERROR': {\r\n      d: 'm {mx},{my} {e.x0},-{e.y0} {e.x1},-{e.y1} {e.x2},{e.y2} {e.x3},-{e.y3} -{e.x4},{e.y4} -{e.x5},-{e.y5} z',\r\n      height: 36,\r\n      width: 36,\r\n      heightElements: [ 0.023, 8.737, 8.151, 16.564, 10.591, 8.714 ],\r\n      widthElements: [ 0.085, 6.672, 6.97, 4.273, 5.337, 6.636 ]\r\n    },\r\n    'EVENT_CANCEL_45': {\r\n      d: 'm {mx},{my} -{e.x1},0 0,{e.x0} {e.x1},0 0,{e.y1} {e.x0},0 ' +\r\n        '0,-{e.y1} {e.x1},0 0,-{e.y0} -{e.x1},0 0,-{e.y1} -{e.x0},0 z',\r\n      height: 36,\r\n      width: 36,\r\n      heightElements: [ 4.75, 8.5 ],\r\n      widthElements: [ 4.75, 8.5 ]\r\n    },\r\n    'EVENT_COMPENSATION': {\r\n      d: 'm {mx},{my} {e.x0},-{e.y0} 0,{e.y1} z m {e.x1},-{e.y2} {e.x2},-{e.y3} 0,{e.y1} -{e.x2},-{e.y3} z',\r\n      height: 36,\r\n      width: 36,\r\n      heightElements: [ 6.5, 13, 0.4, 6.1 ],\r\n      widthElements: [ 9, 9.3, 8.7 ]\r\n    },\r\n    'EVENT_TIMER_WH': {\r\n      d: 'M {mx},{my} l {e.x0},-{e.y0} m -{e.x0},{e.y0} l {e.x1},{e.y1} ',\r\n      height: 36,\r\n      width:  36,\r\n      heightElements: [ 10, 2 ],\r\n      widthElements: [ 3, 7 ]\r\n    },\r\n    'EVENT_TIMER_LINE': {\r\n      d:  'M {mx},{my} ' +\r\n          'm {e.x0},{e.y0} l -{e.x1},{e.y1} ',\r\n      height: 36,\r\n      width:  36,\r\n      heightElements: [ 10, 3 ],\r\n      widthElements: [ 0, 0 ]\r\n    },\r\n    'EVENT_MULTIPLE': {\r\n      d:'m {mx},{my} {e.x1},-{e.y0} {e.x1},{e.y0} -{e.x0},{e.y1} -{e.x2},0 z',\r\n      height: 36,\r\n      width:  36,\r\n      heightElements: [ 6.28099, 12.56199 ],\r\n      widthElements: [ 3.1405, 9.42149, 12.56198 ]\r\n    },\r\n    'EVENT_PARALLEL_MULTIPLE': {\r\n      d:'m {mx},{my} {e.x0},0 0,{e.y1} {e.x1},0 0,{e.y0} -{e.x1},0 0,{e.y1} ' +\r\n        '-{e.x0},0 0,-{e.y1} -{e.x1},0 0,-{e.y0} {e.x1},0 z',\r\n      height: 36,\r\n      width:  36,\r\n      heightElements: [ 2.56228, 7.68683 ],\r\n      widthElements: [ 2.56228, 7.68683 ]\r\n    },\r\n    'GATEWAY_EXCLUSIVE': {\r\n      d:'m {mx},{my} {e.x0},{e.y0} {e.x1},{e.y0} {e.x2},0 {e.x4},{e.y2} ' +\r\n                    '{e.x4},{e.y1} {e.x2},0 {e.x1},{e.y3} {e.x0},{e.y3} ' +\r\n                    '{e.x3},0 {e.x5},{e.y1} {e.x5},{e.y2} {e.x3},0 z',\r\n      height: 17.5,\r\n      width:  17.5,\r\n      heightElements: [ 8.5, 6.5312, -6.5312, -8.5 ],\r\n      widthElements:  [ 6.5, -6.5, 3, -3, 5, -5 ]\r\n    },\r\n    'GATEWAY_PARALLEL': {\r\n      d:'m {mx},{my} 0,{e.y1} -{e.x1},0 0,{e.y0} {e.x1},0 0,{e.y1} {e.x0},0 ' +\r\n        '0,-{e.y1} {e.x1},0 0,-{e.y0} -{e.x1},0 0,-{e.y1} -{e.x0},0 z',\r\n      height: 30,\r\n      width:  30,\r\n      heightElements: [ 5, 12.5 ],\r\n      widthElements: [ 5, 12.5 ]\r\n    },\r\n    'GATEWAY_EVENT_BASED': {\r\n      d:'m {mx},{my} {e.x0},{e.y0} {e.x0},{e.y1} {e.x1},{e.y2} {e.x2},0 z',\r\n      height: 11,\r\n      width:  11,\r\n      heightElements: [ -6, 6, 12, -12 ],\r\n      widthElements: [ 9, -3, -12 ]\r\n    },\r\n    'GATEWAY_COMPLEX': {\r\n      d:'m {mx},{my} 0,{e.y0} -{e.x0},-{e.y1} -{e.x1},{e.y2} {e.x0},{e.y1} -{e.x2},0 0,{e.y3} ' +\r\n        '{e.x2},0  -{e.x0},{e.y1} l {e.x1},{e.y2} {e.x0},-{e.y1} 0,{e.y0} {e.x3},0 0,-{e.y0} {e.x0},{e.y1} ' +\r\n        '{e.x1},-{e.y2} -{e.x0},-{e.y1} {e.x2},0 0,-{e.y3} -{e.x2},0 {e.x0},-{e.y1} -{e.x1},-{e.y2} ' +\r\n        '-{e.x0},{e.y1} 0,-{e.y0} -{e.x3},0 z',\r\n      height: 17.125,\r\n      width:  17.125,\r\n      heightElements: [ 4.875, 3.4375, 2.125, 3 ],\r\n      widthElements: [ 3.4375, 2.125, 4.875, 3 ]\r\n    },\r\n    'DATA_OBJECT_PATH': {\r\n      d:'m 0,0 {e.x1},0 {e.x0},{e.y0} 0,{e.y1} -{e.x2},0 0,-{e.y2} {e.x1},0 0,{e.y0} {e.x0},0',\r\n      height: 61,\r\n      width:  51,\r\n      heightElements: [ 10, 50, 60 ],\r\n      widthElements: [ 10, 40, 50, 60 ]\r\n    },\r\n    'DATA_OBJECT_COLLECTION_PATH': {\r\n      d: 'm{mx},{my} m 3,2 l 0,10 m 3,-10 l 0,10 m 3,-10 l 0,10',\r\n      height: 10,\r\n      width: 10,\r\n      heightElements: [],\r\n      widthElements: []\r\n    },\r\n    'DATA_ARROW': {\r\n      d:'m 5,9 9,0 0,-3 5,5 -5,5 0,-3 -9,0 z',\r\n      height: 61,\r\n      width:  51,\r\n      heightElements: [],\r\n      widthElements: []\r\n    },\r\n    'DATA_STORE': {\r\n      d:'m  {mx},{my} ' +\r\n        'l  0,{e.y2} ' +\r\n        'c  {e.x0},{e.y1} {e.x1},{e.y1}  {e.x2},0 ' +\r\n        'l  0,-{e.y2} ' +\r\n        'c -{e.x0},-{e.y1} -{e.x1},-{e.y1} -{e.x2},0' +\r\n        'c  {e.x0},{e.y1} {e.x1},{e.y1}  {e.x2},0 ' +\r\n        'm  -{e.x2},{e.y0}' +\r\n        'c  {e.x0},{e.y1} {e.x1},{e.y1} {e.x2},0' +\r\n        'm  -{e.x2},{e.y0}' +\r\n        'c  {e.x0},{e.y1} {e.x1},{e.y1}  {e.x2},0',\r\n      height: 61,\r\n      width:  61,\r\n      heightElements: [ 7, 10, 45 ],\r\n      widthElements:  [ 2, 58, 60 ]\r\n    },\r\n    'TEXT_ANNOTATION': {\r\n      d: 'm {mx}, {my} m 10,0 l -10,0 l 0,{e.y0} l 10,0',\r\n      height: 30,\r\n      width: 10,\r\n      heightElements: [ 30 ],\r\n      widthElements: [ 10 ]\r\n    },\r\n    'MARKER_SUB_PROCESS': {\r\n      d: 'm{mx},{my} m 7,2 l 0,10 m -5,-5 l 10,0',\r\n      height: 10,\r\n      width: 10,\r\n      heightElements: [],\r\n      widthElements: []\r\n    },\r\n    'MARKER_PARALLEL': {\r\n      d: 'm{mx},{my} m 3,2 l 0,10 m 3,-10 l 0,10 m 3,-10 l 0,10',\r\n      height: 10,\r\n      width: 10,\r\n      heightElements: [],\r\n      widthElements: []\r\n    },\r\n    'MARKER_SEQUENTIAL': {\r\n      d: 'm{mx},{my} m 0,3 l 10,0 m -10,3 l 10,0 m -10,3 l 10,0',\r\n      height: 10,\r\n      width: 10,\r\n      heightElements: [],\r\n      widthElements: []\r\n    },\r\n    'MARKER_COMPENSATION': {\r\n      d: 'm {mx},{my} 7,-5 0,10 z m 7.1,-0.3 6.9,-4.7 0,10 -6.9,-4.7 z',\r\n      height: 10,\r\n      width: 21,\r\n      heightElements: [],\r\n      widthElements: []\r\n    },\r\n    'MARKER_LOOP': {\r\n      d: 'm {mx},{my} c 3.526979,0 6.386161,-2.829858 6.386161,-6.320661 0,-3.490806 -2.859182,-6.320661 ' +\r\n        '-6.386161,-6.320661 -3.526978,0 -6.38616,2.829855 -6.38616,6.320661 0,1.745402 ' +\r\n        '0.714797,3.325567 1.870463,4.469381 0.577834,0.571908 1.265885,1.034728 2.029916,1.35457 ' +\r\n        'l -0.718163,-3.909793 m 0.718163,3.909793 -3.885211,0.802902',\r\n      height: 13.9,\r\n      width: 13.7,\r\n      heightElements: [],\r\n      widthElements: []\r\n    },\r\n    'MARKER_ADHOC': {\r\n      d: 'm {mx},{my} m 0.84461,2.64411 c 1.05533,-1.23780996 2.64337,-2.07882 4.29653,-1.97997996 2.05163,0.0805 ' +\r\n        '3.85579,1.15803 5.76082,1.79107 1.06385,0.34139996 2.24454,0.1438 3.18759,-0.43767 0.61743,-0.33642 ' +\r\n        '1.2775,-0.64078 1.7542,-1.17511 0,0.56023 0,1.12046 0,1.6807 -0.98706,0.96237996 -2.29792,1.62393996 ' +\r\n        '-3.6918,1.66181996 -1.24459,0.0927 -2.46671,-0.2491 -3.59505,-0.74812 -1.35789,-0.55965 ' +\r\n        '-2.75133,-1.33436996 -4.27027,-1.18121996 -1.37741,0.14601 -2.41842,1.13685996 -3.44288,1.96782996 z',\r\n      height: 4,\r\n      width: 15,\r\n      heightElements: [],\r\n      widthElements: []\r\n    },\r\n    'TASK_TYPE_SEND': {\r\n      d: 'm {mx},{my} l 0,{e.y1} l {e.x1},0 l 0,-{e.y1} z l {e.x0},{e.y0} l {e.x0},-{e.y0}',\r\n      height: 14,\r\n      width:  21,\r\n      heightElements: [ 6, 14 ],\r\n      widthElements: [ 10.5, 21 ]\r\n    },\r\n    'TASK_TYPE_SCRIPT': {\r\n      d: 'm {mx},{my} c 9.966553,-6.27276 -8.000926,-7.91932 2.968968,-14.938 l -8.802728,0 ' +\r\n        'c -10.969894,7.01868 6.997585,8.66524 -2.968967,14.938 z ' +\r\n        'm -7,-12 l 5,0 ' +\r\n        'm -4.5,3 l 4.5,0 ' +\r\n        'm -3,3 l 5,0' +\r\n        'm -4,3 l 5,0',\r\n      height: 15,\r\n      width:  12.6,\r\n      heightElements: [ 6, 14 ],\r\n      widthElements: [ 10.5, 21 ]\r\n    },\r\n    'TASK_TYPE_USER_1': {\r\n      d: 'm {mx},{my} c 0.909,-0.845 1.594,-2.049 1.594,-3.385 0,-2.554 -1.805,-4.62199999 ' +\r\n        '-4.357,-4.62199999 -2.55199998,0 -4.28799998,2.06799999 -4.28799998,4.62199999 0,1.348 ' +\r\n        '0.974,2.562 1.89599998,3.405 -0.52899998,0.187 -5.669,2.097 -5.794,4.7560005 v 6.718 ' +\r\n        'h 17 v -6.718 c 0,-2.2980005 -5.5279996,-4.5950005 -6.0509996,-4.7760005 z' +\r\n        'm -8,6 l 0,5.5 m 11,0 l 0,-5'\r\n    },\r\n    'TASK_TYPE_USER_2': {\r\n      d: 'm {mx},{my} m 2.162,1.009 c 0,2.4470005 -2.158,4.4310005 -4.821,4.4310005 ' +\r\n        '-2.66499998,0 -4.822,-1.981 -4.822,-4.4310005 '\r\n    },\r\n    'TASK_TYPE_USER_3': {\r\n      d: 'm {mx},{my} m -6.9,-3.80 c 0,0 2.25099998,-2.358 4.27399998,-1.177 2.024,1.181 4.221,1.537 ' +\r\n        '4.124,0.965 -0.098,-0.57 -0.117,-3.79099999 -4.191,-4.13599999 -3.57499998,0.001 ' +\r\n        '-4.20799998,3.36699999 -4.20699998,4.34799999 z'\r\n    },\r\n    'TASK_TYPE_MANUAL': {\r\n      d: 'm {mx},{my} c 0.234,-0.01 5.604,0.008 8.029,0.004 0.808,0 1.271,-0.172 1.417,-0.752 0.227,-0.898 ' +\r\n        '-0.334,-1.314 -1.338,-1.316 -2.467,-0.01 -7.886,-0.004 -8.108,-0.004 -0.014,-0.079 0.016,-0.533 0,-0.61 ' +\r\n        '0.195,-0.042 8.507,0.006 9.616,0.002 0.877,-0.007 1.35,-0.438 1.353,-1.208 0.003,-0.768 -0.479,-1.09 ' +\r\n        '-1.35,-1.091 -2.968,-0.002 -9.619,-0.013 -9.619,-0.013 v -0.591 c 0,0 5.052,-0.016 7.225,-0.016 ' +\r\n        '0.888,-0.002 1.354,-0.416 1.351,-1.193 -0.006,-0.761 -0.492,-1.196 -1.361,-1.196 -3.473,-0.005 ' +\r\n        '-10.86,-0.003 -11.0829995,-0.003 -0.022,-0.047 -0.045,-0.094 -0.069,-0.139 0.3939995,-0.319 ' +\r\n        '2.0409995,-1.626 2.4149995,-2.017 0.469,-0.4870005 0.519,-1.1650005 0.162,-1.6040005 -0.414,-0.511 ' +\r\n        '-0.973,-0.5 -1.48,-0.236 -1.4609995,0.764 -6.5999995,3.6430005 -7.7329995,4.2710005 -0.9,0.499 ' +\r\n        '-1.516,1.253 -1.882,2.19 -0.37000002,0.95 -0.17,2.01 -0.166,2.979 0.004,0.718 -0.27300002,1.345 ' +\r\n        '-0.055,2.063 0.629,2.087 2.425,3.312 4.859,3.318 4.6179995,0.014 9.2379995,-0.139 13.8569995,-0.158 ' +\r\n        '0.755,-0.004 1.171,-0.301 1.182,-1.033 0.012,-0.754 -0.423,-0.969 -1.183,-0.973 -1.778,-0.01 ' +\r\n        '-5.824,-0.004 -6.04,-0.004 10e-4,-0.084 0.003,-0.586 10e-4,-0.67 z'\r\n    },\r\n    'TASK_TYPE_INSTANTIATING_SEND': {\r\n      d: 'm {mx},{my} l 0,8.4 l 12.6,0 l 0,-8.4 z l 6.3,3.6 l 6.3,-3.6'\r\n    },\r\n    'TASK_TYPE_SERVICE': {\r\n      d: 'm {mx},{my} v -1.71335 c 0.352326,-0.0705 0.703932,-0.17838 1.047628,-0.32133 ' +\r\n        '0.344416,-0.14465 0.665822,-0.32133 0.966377,-0.52145 l 1.19431,1.18005 1.567487,-1.57688 ' +\r\n        '-1.195028,-1.18014 c 0.403376,-0.61394 0.683079,-1.29908 0.825447,-2.01824 l 1.622133,-0.01 ' +\r\n        'v -2.2196 l -1.636514,0.01 c -0.07333,-0.35153 -0.178319,-0.70024 -0.323564,-1.04372 ' +\r\n        '-0.145244,-0.34406 -0.321407,-0.6644 -0.522735,-0.96217 l 1.131035,-1.13631 -1.583305,-1.56293 ' +\r\n        '-1.129598,1.13589 c -0.614052,-0.40108 -1.302883,-0.68093 -2.022633,-0.82247 l 0.0093,-1.61852 ' +\r\n        'h -2.241173 l 0.0042,1.63124 c -0.353763,0.0736 -0.705369,0.17977 -1.049785,0.32371 -0.344415,0.14437 ' +\r\n        '-0.665102,0.32092 -0.9635006,0.52046 l -1.1698628,-1.15823 -1.5667691,1.5792 1.1684265,1.15669 ' +\r\n        'c -0.4026573,0.61283 -0.68308,1.29797 -0.8247287,2.01713 l -1.6588041,0.003 v 2.22174 ' +\r\n        'l 1.6724648,-0.006 c 0.073327,0.35077 0.1797598,0.70243 0.3242851,1.04472 0.1452428,0.34448 ' +\r\n        '0.3214064,0.6644 0.5227339,0.96066 l -1.1993431,1.19723 1.5840256,1.56011 1.1964668,-1.19348 ' +\r\n        'c 0.6140517,0.40346 1.3028827,0.68232 2.0233517,0.82331 l 7.19e-4,1.69892 h 2.226848 z ' +\r\n        'm 0.221462,-3.9957 c -1.788948,0.7502 -3.8576,-0.0928 -4.6097055,-1.87438 -0.7521065,-1.78321 ' +\r\n        '0.090598,-3.84627 1.8802645,-4.59604 1.78823,-0.74936 3.856881,0.0929 4.608987,1.87437 ' +\r\n        '0.752106,1.78165 -0.0906,3.84612 -1.879546,4.59605 z'\r\n    },\r\n    'TASK_TYPE_SERVICE_FILL': {\r\n      d: 'm {mx},{my} c -1.788948,0.7502 -3.8576,-0.0928 -4.6097055,-1.87438 -0.7521065,-1.78321 ' +\r\n        '0.090598,-3.84627 1.8802645,-4.59604 1.78823,-0.74936 3.856881,0.0929 4.608987,1.87437 ' +\r\n        '0.752106,1.78165 -0.0906,3.84612 -1.879546,4.59605 z'\r\n    },\r\n    'TASK_TYPE_BUSINESS_RULE_HEADER': {\r\n      d: 'm {mx},{my} 0,4 20,0 0,-4 z'\r\n    },\r\n    'TASK_TYPE_BUSINESS_RULE_MAIN': {\r\n      d: 'm {mx},{my} 0,12 20,0 0,-12 z' +\r\n        'm 0,8 l 20,0 ' +\r\n        'm -13,-4 l 0,8'\r\n    },\r\n    'MESSAGE_FLOW_MARKER': {\r\n      d: 'm {mx},{my} m -10.5 ,-7 l 0,14 l 21,0 l 0,-14 z l 10.5,6 l 10.5,-6'\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Return raw path for the given ID.\r\n   *\r\n   * @param {string} pathId\r\n   *\r\n   * @return {string} raw path\r\n   */\r\n  this.getRawPath = function getRawPath(pathId) {\r\n    return this.pathMap[pathId].d;\r\n  };\r\n\r\n  /**\r\n   * Scales the path to the given height and width.\r\n   * <h1>Use case</h1>\r\n   * <p>Use case is to scale the content of elements (event, gateways) based\r\n   * on the element bounding box's size.\r\n   * </p>\r\n   * <h1>Why not transform</h1>\r\n   * <p>Scaling a path with transform() will also scale the stroke and IE does not support\r\n   * the option 'non-scaling-stroke' to prevent this.\r\n   * Also there are use cases where only some parts of a path should be\r\n   * scaled.</p>\r\n   *\r\n   * @param {string} pathId The ID of the path.\r\n   * @param {Object} param <p>\r\n   *   Example param object scales the path to 60% size of the container (data.width, data.height).\r\n   *   <pre>\r\n   *   {\r\n   *     xScaleFactor: 0.6,\r\n   *     yScaleFactor:0.6,\r\n   *     containerWidth: data.width,\r\n   *     containerHeight: data.height,\r\n   *     position: {\r\n   *       mx: 0.46,\r\n   *       my: 0.2,\r\n   *     }\r\n   *   }\r\n   *   </pre>\r\n   *   <ul>\r\n   *    <li>targetpathwidth = xScaleFactor * containerWidth</li>\r\n   *    <li>targetpathheight = yScaleFactor * containerHeight</li>\r\n   *    <li>Position is used to set the starting coordinate of the path. M is computed:\r\n    *    <ul>\r\n    *      <li>position.x * containerWidth</li>\r\n    *      <li>position.y * containerHeight</li>\r\n    *    </ul>\r\n    *    Center of the container <pre> position: {\r\n   *       mx: 0.5,\r\n   *       my: 0.5,\r\n   *     }</pre>\r\n   *     Upper left corner of the container\r\n   *     <pre> position: {\r\n   *       mx: 0.0,\r\n   *       my: 0.0,\r\n   *     }</pre>\r\n   *    </li>\r\n   *   </ul>\r\n   * </p>\r\n   *\r\n   * @return {string} scaled path\r\n   */\r\n  this.getScaledPath = function getScaledPath(pathId, param) {\r\n    var rawPath = this.pathMap[pathId];\r\n\r\n    // positioning\r\n    // compute the start point of the path\r\n    var mx, my;\r\n\r\n    if (param.abspos) {\r\n      mx = param.abspos.x;\r\n      my = param.abspos.y;\r\n    } else {\r\n      mx = param.containerWidth * param.position.mx;\r\n      my = param.containerHeight * param.position.my;\r\n    }\r\n\r\n    var coordinates = {}; // map for the scaled coordinates\r\n    if (param.position) {\r\n\r\n      // path\r\n      var heightRatio = (param.containerHeight / rawPath.height) * param.yScaleFactor;\r\n      var widthRatio = (param.containerWidth / rawPath.width) * param.xScaleFactor;\r\n\r\n\r\n      // Apply height ratio\r\n      for (var heightIndex = 0; heightIndex < rawPath.heightElements.length; heightIndex++) {\r\n        coordinates['y' + heightIndex] = rawPath.heightElements[heightIndex] * heightRatio;\r\n      }\r\n\r\n      // Apply width ratio\r\n      for (var widthIndex = 0; widthIndex < rawPath.widthElements.length; widthIndex++) {\r\n        coordinates['x' + widthIndex] = rawPath.widthElements[widthIndex] * widthRatio;\r\n      }\r\n    }\r\n\r\n    // Apply value to raw path\r\n    var path = format(\r\n      rawPath.d, {\r\n        mx: mx,\r\n        my: my,\r\n        e: coordinates\r\n      }\r\n    );\r\n    return path;\r\n  };\r\n}\r\n\r\n// helpers //////////////////////\r\n\r\n// copied and adjusted from https://github.com/adobe-webplatform/Snap.svg/blob/master/src/svg.js\r\nvar tokenRegex = /\\{([^{}]+)\\}/g,\r\n    objNotationRegex = /(?:(?:^|\\.)(.+?)(?=\\[|\\.|$|\\()|\\[('|\")(.+?)\\2\\])(\\(\\))?/g; // matches .xxxxx or [\"xxxxx\"] to run over object properties\r\n\r\nfunction replacer(all, key, obj) {\r\n  var res = obj;\r\n  key.replace(objNotationRegex, function(all, name, quote, quotedName, isFunc) {\r\n    name = name || quotedName;\r\n    if (res) {\r\n      if (name in res) {\r\n        res = res[name];\r\n      }\r\n      typeof res == 'function' && isFunc && (res = res());\r\n    }\r\n  });\r\n  res = (res == null || res == obj ? all : res) + '';\r\n\r\n  return res;\r\n}\r\n\r\nfunction format(str, obj) {\r\n  return String(str).replace(tokenRegex, function(all, key) {\r\n    return replacer(all, key, obj);\r\n  });\r\n}\r\n","import BpmnRenderer from './BpmnRenderer';\r\nimport TextRenderer from './TextRenderer';\r\n\r\nimport PathMap from './PathMap';\r\n\r\nexport default {\r\n  __init__: [ 'bpmnRenderer' ],\r\n  bpmnRenderer: [ 'type', BpmnRenderer ],\r\n  textRenderer: [ 'type', TextRenderer ],\r\n  pathMap: [ 'type', PathMap ]\r\n};\r\n","import {\r\n  assign\r\n} from 'min-dash';\r\n\r\nimport { is } from '../util/ModelUtil';\r\n\r\nimport {\r\n  isLabelExternal,\r\n  getExternalLabelBounds,\r\n  getLabel\r\n} from '../util/LabelUtil';\r\n\r\nimport {\r\n  getMid\r\n} from 'diagram-js/lib/layout/LayoutUtil';\r\n\r\nimport {\r\n  isExpanded\r\n} from '../util/DiUtil';\r\n\r\nimport {\r\n  elementToString\r\n} from './Util';\r\n\r\n/**\r\n * @typedef {import('diagram-js/lib/core/Canvas').default} Canvas\r\n * @typedef {import('diagram-js/lib/core/ElementRegistry').default} ElementRegistry\r\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\r\n *\r\n * @typedef {import('../features/modeling/ElementFactory').default} ElementFactory\r\n * @typedef {import('../draw/TextRenderer').default} TextRenderer\r\n *\r\n * @typedef {import('../model/Types').Element} Element\r\n * @typedef {import('../model/Types').Label} Label\r\n * @typedef {import('../model/Types').Shape} Shape\r\n * @typedef {import('../model/Types').Connection} Connection\r\n * @typedef {import('../model/Types').Root} Root\r\n * @typedef {import('../model/Types').ModdleElement} ModdleElement\r\n */\r\n\r\n/**\r\n * @param {ModdleElement} semantic\r\n * @param {ModdleElement} di\r\n * @param {Object} [attrs=null]\r\n *\r\n * @return {Object}\r\n */\r\nfunction elementData(semantic, di, attrs) {\r\n  return assign({\r\n    id: semantic.id,\r\n    type: semantic.$type,\r\n    businessObject: semantic,\r\n    di: di\r\n  }, attrs);\r\n}\r\n\r\nfunction getWaypoints(di, source, target) {\r\n\r\n  var waypoints = di.waypoint;\r\n\r\n  if (!waypoints || waypoints.length < 2) {\r\n    return [ getMid(source), getMid(target) ];\r\n  }\r\n\r\n  return waypoints.map(function(p) {\r\n    return { x: p.x, y: p.y };\r\n  });\r\n}\r\n\r\nfunction notYetDrawn(semantic, refSemantic, property) {\r\n  return new Error(\r\n    `element ${ elementToString(refSemantic) } referenced by ${ elementToString(semantic) }#${ property } not yet drawn`\r\n  );\r\n}\r\n\r\n\r\n/**\r\n * An importer that adds bpmn elements to the canvas\r\n *\r\n * @param {EventBus} eventBus\r\n * @param {Canvas} canvas\r\n * @param {ElementFactory} elementFactory\r\n * @param {ElementRegistry} elementRegistry\r\n * @param {TextRenderer} textRenderer\r\n */\r\nexport default function BpmnImporter(\r\n    eventBus, canvas, elementFactory,\r\n    elementRegistry, textRenderer) {\r\n\r\n  this._eventBus = eventBus;\r\n  this._canvas = canvas;\r\n  this._elementFactory = elementFactory;\r\n  this._elementRegistry = elementRegistry;\r\n  this._textRenderer = textRenderer;\r\n}\r\n\r\nBpmnImporter.$inject = [\r\n  'eventBus',\r\n  'canvas',\r\n  'elementFactory',\r\n  'elementRegistry',\r\n  'textRenderer'\r\n];\r\n\r\n\r\n/**\r\n * Add a BPMN element (semantic) to the canvas making it a child of the\r\n * given parent.\r\n *\r\n * @param {ModdleElement} semantic\r\n * @param {ModdleElement} di\r\n * @param {Shape} parentElement\r\n *\r\n * @return {Shape | Root | Connection}\r\n */\r\nBpmnImporter.prototype.add = function(semantic, di, parentElement) {\r\n  var element,\r\n      hidden;\r\n\r\n  var parentIndex;\r\n\r\n  // ROOT ELEMENT\r\n  // handle the special case that we deal with a\r\n  // invisible root element (process, subprocess or collaboration)\r\n  if (is(di, 'bpmndi:BPMNPlane')) {\r\n\r\n    var attrs = is(semantic, 'bpmn:SubProcess')\r\n      ? { id: semantic.id + '_plane' }\r\n      : {};\r\n\r\n    // add a virtual element (not being drawn)\r\n    element = this._elementFactory.createRoot(elementData(semantic, di, attrs));\r\n\r\n    this._canvas.addRootElement(element);\r\n  }\r\n\r\n  // SHAPE\r\n  else if (is(di, 'bpmndi:BPMNShape')) {\r\n\r\n    var collapsed = !isExpanded(semantic, di),\r\n        isFrame = isFrameElement(semantic);\r\n\r\n    hidden = parentElement && (parentElement.hidden || parentElement.collapsed);\r\n\r\n    var bounds = di.bounds;\r\n\r\n    element = this._elementFactory.createShape(elementData(semantic, di, {\r\n      collapsed: collapsed,\r\n      hidden: hidden,\r\n      x: Math.round(bounds.x),\r\n      y: Math.round(bounds.y),\r\n      width: Math.round(bounds.width),\r\n      height: Math.round(bounds.height),\r\n      isFrame: isFrame\r\n    }));\r\n\r\n    if (is(semantic, 'bpmn:BoundaryEvent')) {\r\n      this._attachBoundary(semantic, element);\r\n    }\r\n\r\n    // insert lanes behind other flow nodes (cf. #727)\r\n    if (is(semantic, 'bpmn:Lane')) {\r\n      parentIndex = 0;\r\n    }\r\n\r\n    if (is(semantic, 'bpmn:DataStoreReference')) {\r\n\r\n      // check whether data store is inside our outside of its semantic parent\r\n      if (!isPointInsideBBox(parentElement, getMid(bounds))) {\r\n        parentElement = this._canvas.findRoot(parentElement);\r\n      }\r\n    }\r\n\r\n    this._canvas.addShape(element, parentElement, parentIndex);\r\n  }\r\n\r\n  // CONNECTION\r\n  else if (is(di, 'bpmndi:BPMNEdge')) {\r\n\r\n    var source = this._getSource(semantic),\r\n        target = this._getTarget(semantic);\r\n\r\n    hidden = parentElement && (parentElement.hidden || parentElement.collapsed);\r\n\r\n    element = this._elementFactory.createConnection(elementData(semantic, di, {\r\n      hidden: hidden,\r\n      source: source,\r\n      target: target,\r\n      waypoints: getWaypoints(di, source, target)\r\n    }));\r\n\r\n    if (is(semantic, 'bpmn:DataAssociation')) {\r\n\r\n      // render always on top; this ensures DataAssociations\r\n      // are rendered correctly across different \"hacks\" people\r\n      // love to model such as cross participant / sub process\r\n      // associations\r\n      parentElement = this._canvas.findRoot(parentElement);\r\n    }\r\n\r\n    this._canvas.addConnection(element, parentElement, parentIndex);\r\n  } else {\r\n    throw new Error(\r\n      `unknown di ${ elementToString(di) } for element ${ elementToString(semantic) }`\r\n    );\r\n  }\r\n\r\n  // (optional) LABEL\r\n  if (isLabelExternal(semantic) && getLabel(element)) {\r\n    this.addLabel(semantic, di, element);\r\n  }\r\n\r\n  this._eventBus.fire('bpmnElement.added', { element: element });\r\n\r\n  return element;\r\n};\r\n\r\n\r\n/**\r\n * Attach a boundary element to the given host.\r\n *\r\n * @param {ModdleElement} boundarySemantic\r\n * @param {Shape} boundaryElement\r\n */\r\nBpmnImporter.prototype._attachBoundary = function(boundarySemantic, boundaryElement) {\r\n  var hostSemantic = boundarySemantic.attachedToRef;\r\n\r\n  if (!hostSemantic) {\r\n    throw new Error(\r\n      `missing ${ elementToString(boundarySemantic) }#attachedToRef`\r\n    );\r\n  }\r\n\r\n  var host = this._elementRegistry.get(hostSemantic.id),\r\n      attachers = host && host.attachers;\r\n\r\n  if (!host) {\r\n    throw notYetDrawn(boundarySemantic, hostSemantic, 'attachedToRef');\r\n  }\r\n\r\n  // wire element.host <> host.attachers\r\n  boundaryElement.host = host;\r\n\r\n  if (!attachers) {\r\n    host.attachers = attachers = [];\r\n  }\r\n\r\n  if (attachers.indexOf(boundaryElement) === -1) {\r\n    attachers.push(boundaryElement);\r\n  }\r\n};\r\n\r\n\r\n/**\r\n * Add a label to a given element.\r\n *\r\n * @param {ModdleElement} semantic\r\n * @param {ModdleElement} di\r\n * @param {Element} element\r\n *\r\n * @return {Label}\r\n */\r\nBpmnImporter.prototype.addLabel = function(semantic, di, element) {\r\n  var bounds,\r\n      text,\r\n      label;\r\n\r\n  bounds = getExternalLabelBounds(di, element);\r\n\r\n  text = getLabel(element);\r\n\r\n  if (text) {\r\n\r\n    // get corrected bounds from actual layouted text\r\n    bounds = this._textRenderer.getExternalLabelBounds(bounds, text);\r\n  }\r\n\r\n  label = this._elementFactory.createLabel(elementData(semantic, di, {\r\n    id: semantic.id + '_label',\r\n    labelTarget: element,\r\n    type: 'label',\r\n    hidden: element.hidden || !getLabel(element),\r\n    x: Math.round(bounds.x),\r\n    y: Math.round(bounds.y),\r\n    width: Math.round(bounds.width),\r\n    height: Math.round(bounds.height)\r\n  }));\r\n\r\n  return this._canvas.addShape(label, element.parent);\r\n};\r\n\r\n/**\r\n * Get the source or target of the given connection.\r\n *\r\n * @param {ModdleElement} semantic\r\n * @param {'source' | 'target'} side\r\n *\r\n * @return {Element}\r\n */\r\nBpmnImporter.prototype._getConnectedElement = function(semantic, side) {\r\n\r\n  var element,\r\n      refSemantic,\r\n      type = semantic.$type;\r\n\r\n  refSemantic = semantic[side + 'Ref'];\r\n\r\n  // handle mysterious isMany DataAssociation#sourceRef\r\n  if (side === 'source' && type === 'bpmn:DataInputAssociation') {\r\n    refSemantic = refSemantic && refSemantic[0];\r\n  }\r\n\r\n  // fix source / target for DataInputAssociation / DataOutputAssociation\r\n  if (side === 'source' && type === 'bpmn:DataOutputAssociation' ||\r\n      side === 'target' && type === 'bpmn:DataInputAssociation') {\r\n\r\n    refSemantic = semantic.$parent;\r\n  }\r\n\r\n  element = refSemantic && this._getElement(refSemantic);\r\n\r\n  if (element) {\r\n    return element;\r\n  }\r\n\r\n  if (refSemantic) {\r\n    throw notYetDrawn(semantic, refSemantic, side + 'Ref');\r\n  } else {\r\n    throw new Error(\r\n      `${ elementToString(semantic) }#${ side } Ref not specified`\r\n    );\r\n  }\r\n};\r\n\r\nBpmnImporter.prototype._getSource = function(semantic) {\r\n  return this._getConnectedElement(semantic, 'source');\r\n};\r\n\r\nBpmnImporter.prototype._getTarget = function(semantic) {\r\n  return this._getConnectedElement(semantic, 'target');\r\n};\r\n\r\n\r\nBpmnImporter.prototype._getElement = function(semantic) {\r\n  return this._elementRegistry.get(semantic.id);\r\n};\r\n\r\n\r\n// helpers ////////////////////\r\n\r\nfunction isPointInsideBBox(bbox, point) {\r\n  var x = point.x,\r\n      y = point.y;\r\n\r\n  return x >= bbox.x &&\r\n    x <= bbox.x + bbox.width &&\r\n    y >= bbox.y &&\r\n    y <= bbox.y + bbox.height;\r\n}\r\n\r\nfunction isFrameElement(semantic) {\r\n  return is(semantic, 'bpmn:Group');\r\n}\r\n","import translate from 'diagram-js/lib/i18n/translate';\r\n\r\nimport BpmnImporter from './BpmnImporter';\r\n\r\nexport default {\r\n  __depends__: [\r\n    translate\r\n  ],\r\n  bpmnImporter: [ 'type', BpmnImporter ]\r\n};","import DrawModule from '../draw';\r\nimport ImportModule from '../import';\r\n\r\nexport default {\r\n  __depends__: [\r\n    DrawModule,\r\n    ImportModule\r\n  ]\r\n};","import inherits from 'inherits-browser';\n\nimport CommandInterceptor from '../../command/CommandInterceptor';\n\n/**\n * @typedef {import('didi').Injector} Injector\n *\n * @typedef {import('../../core/Canvas').default} Canvas\n */\n\n/**\n * A modeling behavior that ensures we set the correct root element\n * as we undo and redo commands.\n *\n * @param {Canvas} canvas\n * @param {Injector} injector\n */\nexport default function RootElementsBehavior(canvas, injector) {\n\n  injector.invoke(CommandInterceptor, this);\n\n  this.executed(function(event) {\n    var context = event.context;\n\n    if (context.rootElement) {\n      canvas.setRootElement(context.rootElement);\n    } else {\n      context.rootElement = canvas.getRootElement();\n    }\n  });\n\n  this.revert(function(event) {\n    var context = event.context;\n\n    if (context.rootElement) {\n      canvas.setRootElement(context.rootElement);\n    }\n  });\n}\n\ninherits(RootElementsBehavior, CommandInterceptor);\n\nRootElementsBehavior.$inject = [ 'canvas', 'injector' ];","import RootElementsBehavior from './RootElementsBehavior';\n\n\n/**\n * @type { import('didi').ModuleDeclaration }\n */\nexport default {\n  __init__: [ 'rootElementsBehavior' ],\n  rootElementsBehavior: [ 'type', RootElementsBehavior ]\n};\n","import { domify, classes } from 'min-dom';\r\nimport { find } from 'min-dash';\r\n\r\nimport { escapeHTML } from 'diagram-js/lib/util/EscapeUtil';\r\nimport { getBusinessObject, is } from '../../util/ModelUtil';\r\nimport {\r\n  getPlaneIdFromShape\r\n} from '../../util/DrilldownUtil';\r\n\r\n/**\r\n * @typedef {import('diagram-js/lib/core/Canvas').default} Canvas\r\n * @typedef {import('diagram-js/lib/core/ElementRegistry').default} ElementRegistry\r\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\r\n *\r\n * @typedef {import('../../model/Types').Element} Element\r\n * @typedef {import('../../model/Types').Shape} Shape\r\n */\r\n\r\nvar OPEN_CLASS = 'bjs-breadcrumbs-shown';\r\n\r\n\r\n/**\r\n * Adds overlays that allow switching planes on collapsed subprocesses.\r\n *\r\n * @param {EventBus} eventBus\r\n * @param {ElementRegistry} elementRegistry\r\n * @param {Canvas} canvas\r\n */\r\nexport default function DrilldownBreadcrumbs(eventBus, elementRegistry, canvas) {\r\n  var breadcrumbs = domify('<ul class=\"bjs-breadcrumbs\"></ul>');\r\n  var container = canvas.getContainer();\r\n  var containerClasses = classes(container);\r\n  container.appendChild(breadcrumbs);\r\n\r\n  var businessObjectParents = [];\r\n\r\n  // update breadcrumbs if name or ID of the primary shape changes\r\n  eventBus.on('element.changed', function(event) {\r\n    var shape = event.element,\r\n        businessObject = getBusinessObject(shape);\r\n\r\n    var isPresent = find(businessObjectParents, function(element) {\r\n      return element === businessObject;\r\n    });\r\n\r\n    if (!isPresent) {\r\n      return;\r\n    }\r\n\r\n    updateBreadcrumbs();\r\n  });\r\n\r\n  /**\r\n   * Updates the displayed breadcrumbs. If no element is provided, only the\r\n   * labels are updated.\r\n   *\r\n   * @param {Element} [element]\r\n   */\r\n  function updateBreadcrumbs(element) {\r\n    if (element) {\r\n      businessObjectParents = getBusinessObjectParentChain(element);\r\n    }\r\n\r\n    var path = businessObjectParents.flatMap(function(parent) {\r\n      var parentPlane =\r\n        canvas.findRoot(getPlaneIdFromShape(parent)) ||\r\n        canvas.findRoot(parent.id);\r\n\r\n      // when the root is a collaboration, the process does not have a\r\n      // corresponding element in the elementRegisty. Instead, we search\r\n      // for the corresponding participant\r\n      if (!parentPlane && is(parent, 'bpmn:Process')) {\r\n        var participant = elementRegistry.find(function(element) {\r\n          var businessObject = getBusinessObject(element);\r\n\r\n          return businessObject && businessObject.get('processRef') === parent;\r\n        });\r\n\r\n        parentPlane = participant && canvas.findRoot(participant.id);\r\n      }\r\n\r\n      if (!parentPlane) {\r\n        return [];\r\n      }\r\n\r\n      var title = escapeHTML(parent.name || parent.id);\r\n      var link = domify('<li><span class=\"bjs-crumb\"><a title=\"' + title + '\">' + title + '</a></span></li>');\r\n\r\n      link.addEventListener('click', function() {\r\n        canvas.setRootElement(parentPlane);\r\n      });\r\n\r\n      return link;\r\n    });\r\n\r\n    breadcrumbs.innerHTML = '';\r\n\r\n    // show breadcrumbs and expose state to .djs-container\r\n    var visible = path.length > 1;\r\n\r\n    containerClasses.toggle(OPEN_CLASS, visible);\r\n\r\n    path.forEach(function(element) {\r\n      breadcrumbs.appendChild(element);\r\n    });\r\n  }\r\n\r\n  eventBus.on('root.set', function(event) {\r\n    updateBreadcrumbs(event.element);\r\n  });\r\n\r\n}\r\n\r\nDrilldownBreadcrumbs.$inject = [ 'eventBus', 'elementRegistry', 'canvas' ];\r\n\r\n\r\n// helpers //////////\r\n\r\n/**\r\n * Returns the parents for the element using the business object chain,\r\n * starting with the root element.\r\n *\r\n * @param {Shape} child\r\n *\r\n * @return {Shape}\r\n */\r\nfunction getBusinessObjectParentChain(child) {\r\n  var businessObject = getBusinessObject(child);\r\n\r\n  var parents = [];\r\n\r\n  for (var element = businessObject; element; element = element.$parent) {\r\n    if (is(element, 'bpmn:SubProcess') || is(element, 'bpmn:Process')) {\r\n      parents.push(element);\r\n    }\r\n  }\r\n\r\n  return parents.reverse();\r\n}","import { is } from '../../util/ModelUtil';\r\n\r\n/**\r\n * @typedef {import('diagram-js/lib/core/Canvas').default} Canvas\r\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\r\n */\r\n\r\n/**\r\n * Move collapsed subprocesses into view when drilling down.\r\n *\r\n * Zoom and scroll are saved in a session.\r\n *\r\n * @param {EventBus} eventBus\r\n * @param {Canvas} canvas\r\n */\r\nexport default function DrilldownCentering(eventBus, canvas) {\r\n\r\n  var currentRoot = null;\r\n  var positionMap = new Map();\r\n\r\n  eventBus.on('root.set', function(event) {\r\n    var newRoot = event.element;\r\n    var currentViewbox = canvas.viewbox();\r\n    var storedViewbox = positionMap.get(newRoot);\r\n\r\n    positionMap.set(currentRoot, {\r\n      x: currentViewbox.x,\r\n      y: currentViewbox.y,\r\n      zoom: currentViewbox.scale\r\n    });\r\n\r\n    currentRoot = newRoot;\r\n\r\n    // Keep viewbox when replacing root elements\r\n    if (!is(newRoot, 'bpmn:SubProcess') && !storedViewbox) {\r\n      return;\r\n    }\r\n\r\n    storedViewbox = storedViewbox || { x: 0, y: 0, zoom: 1 };\r\n\r\n    var dx = (currentViewbox.x - storedViewbox.x) * currentViewbox.scale,\r\n        dy = (currentViewbox.y - storedViewbox.y) * currentViewbox.scale;\r\n\r\n    if (dx !== 0 || dy !== 0) {\r\n      canvas.scroll({\r\n        dx: dx,\r\n        dy: dy\r\n      });\r\n    }\r\n\r\n    if (storedViewbox.zoom !== currentViewbox.scale) {\r\n      canvas.zoom(storedViewbox.zoom, { x: 0, y: 0 });\r\n    }\r\n  });\r\n\r\n  eventBus.on('diagram.clear', function() {\r\n    positionMap.clear();\r\n    currentRoot = null;\r\n  });\r\n\r\n}\r\n\r\nDrilldownCentering.$inject = [ 'eventBus', 'canvas' ];\r\n\r\n\r\n/**\r\n * ES5 Map implementation. Works.\r\n */\r\nfunction Map() {\r\n\r\n  this._entries = [];\r\n\r\n  this.set = function(key, value) {\r\n\r\n    var found = false;\r\n\r\n    for (var k in this._entries) {\r\n      if (this._entries[k][0] === key) {\r\n        this._entries[k][1] = value;\r\n\r\n        found = true;\r\n\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (!found) {\r\n      this._entries.push([ key, value ]);\r\n    }\r\n  };\r\n\r\n  this.get = function(key) {\r\n\r\n    for (var k in this._entries) {\r\n      if (this._entries[k][0] === key) {\r\n        return this._entries[k][1];\r\n      }\r\n    }\r\n\r\n    return null;\r\n  };\r\n\r\n  this.clear = function() {\r\n    this._entries.length = 0;\r\n  };\r\n\r\n  this.remove = function(key) {\r\n\r\n    var idx = -1;\r\n\r\n    for (var k in this._entries) {\r\n      if (this._entries[k][0] === key) {\r\n        idx = k;\r\n\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (idx !== -1) {\r\n      this._entries.splice(idx, 1);\r\n    }\r\n  };\r\n}","\r\nimport { asBounds, asTRBL } from 'diagram-js/lib/layout/LayoutUtil';\r\nimport { is, isAny } from '../../util/ModelUtil';\r\n\r\n/**\r\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\r\n * @typedef {import('../../model/Types').Moddle} Moddle\r\n *\r\n * @typedef {import('../../model/Types').Element} Element\r\n * @typedef {import('../../model/Types').Shape} Shape\r\n *\r\n * @typedef {import('diagram-js/lib/core/Canvas').CanvasPlane} CanvasPlane\r\n *\r\n * @typedef {import('diagram-js/lib/util/Types').Rect} Rect\r\n */\r\n\r\nvar DEFAULT_POSITION = {\r\n  x: 180,\r\n  y: 160\r\n};\r\n\r\n/**\r\n * Hook into `import.render.start` and create new planes for diagrams with\r\n * collapsed subprocesses and all DI elements on the same plane.\r\n *\r\n * @param {EventBus} eventBus\r\n * @param {Moddle} moddle\r\n */\r\nexport default function SubprocessCompatibility(eventBus, moddle) {\r\n  this._eventBus = eventBus;\r\n  this._moddle = moddle;\r\n\r\n  var self = this;\r\n\r\n  eventBus.on('import.render.start', 1500, function(e, context) {\r\n    self._handleImport(context.definitions);\r\n  });\r\n}\r\n\r\n/**\r\n * @param {ModdleElement} definitions\r\n */\r\nSubprocessCompatibility.prototype._handleImport = function(definitions) {\r\n  if (!definitions.diagrams) {\r\n    return;\r\n  }\r\n\r\n  var self = this;\r\n  this._definitions = definitions;\r\n  this._processToDiagramMap = {};\r\n\r\n  definitions.diagrams.forEach(function(diagram) {\r\n    if (!diagram.plane || !diagram.plane.bpmnElement) {\r\n      return;\r\n    }\r\n\r\n    self._processToDiagramMap[diagram.plane.bpmnElement.id] = diagram;\r\n  });\r\n\r\n  var newDiagrams = definitions.diagrams\r\n    .filter(diagram => diagram.plane)\r\n    .flatMap(diagram => self._createNewDiagrams(diagram.plane));\r\n\r\n  newDiagrams.forEach(function(diagram) {\r\n    self._movePlaneElementsToOrigin(diagram.plane);\r\n  });\r\n};\r\n\r\n\r\n/**\r\n * Moves all DI elements from collapsed subprocesses to a new plane.\r\n *\r\n * @param {CanvasPlane} plane\r\n *\r\n * @return {ModdleElement[]} new diagrams created for the collapsed subprocesses\r\n */\r\nSubprocessCompatibility.prototype._createNewDiagrams = function(plane) {\r\n  var self = this;\r\n\r\n  var collapsedElements = [];\r\n  var elementsToMove = [];\r\n\r\n  plane.get('planeElement').forEach(function(diElement) {\r\n    var businessObject = diElement.bpmnElement;\r\n\r\n    if (!businessObject) {\r\n      return;\r\n    }\r\n\r\n    var parent = businessObject.$parent;\r\n\r\n    if (is(businessObject, 'bpmn:SubProcess') && !diElement.isExpanded) {\r\n      collapsedElements.push(businessObject);\r\n    }\r\n\r\n    if (shouldMoveToPlane(businessObject, plane)) {\r\n\r\n      // don't change the array while we iterate over it\r\n      elementsToMove.push({ diElement: diElement, parent: parent });\r\n    }\r\n  });\r\n\r\n  var newDiagrams = [];\r\n\r\n  // create new planes for all collapsed subprocesses, even when they are empty\r\n  collapsedElements.forEach(function(element) {\r\n    if (!self._processToDiagramMap[ element.id ]) {\r\n      var diagram = self._createDiagram(element);\r\n\r\n      self._processToDiagramMap[element.id] = diagram;\r\n\r\n      newDiagrams.push(diagram);\r\n    }\r\n  });\r\n\r\n  elementsToMove.forEach(function(element) {\r\n    var diElement = element.diElement;\r\n    var parent = element.parent;\r\n\r\n    // parent is expanded, get nearest collapsed parent\r\n    while (parent && collapsedElements.indexOf(parent) === -1) {\r\n      parent = parent.$parent;\r\n    }\r\n\r\n    // false positive, all parents are expanded\r\n    if (!parent) {\r\n      return;\r\n    }\r\n\r\n    var diagram = self._processToDiagramMap[ parent.id ];\r\n\r\n    self._moveToDiPlane(diElement, diagram.plane);\r\n  });\r\n\r\n  return newDiagrams;\r\n};\r\n\r\n/**\r\n * @param {CanvasPlane} plane\r\n */\r\nSubprocessCompatibility.prototype._movePlaneElementsToOrigin = function(plane) {\r\n  var elements = plane.get('planeElement');\r\n\r\n  // get bounding box of all elements\r\n  var planeBounds = getPlaneBounds(plane);\r\n\r\n  var offset = {\r\n    x: planeBounds.x - DEFAULT_POSITION.x,\r\n    y: planeBounds.y - DEFAULT_POSITION.y\r\n  };\r\n\r\n  elements.forEach(function(diElement) {\r\n    if (diElement.waypoint) {\r\n      diElement.waypoint.forEach(function(waypoint) {\r\n        waypoint.x = waypoint.x - offset.x;\r\n        waypoint.y = waypoint.y - offset.y;\r\n      });\r\n    } else if (diElement.bounds) {\r\n      diElement.bounds.x = diElement.bounds.x - offset.x;\r\n      diElement.bounds.y = diElement.bounds.y - offset.y;\r\n    }\r\n  });\r\n};\r\n\r\n/**\r\n * @param {ModdleElement} diElement\r\n * @param {CanvasPlane} newPlane\r\n */\r\nSubprocessCompatibility.prototype._moveToDiPlane = function(diElement, newPlane) {\r\n  var containingDiagram = findRootDiagram(diElement);\r\n\r\n  // remove DI from old Plane and add it to the new one\r\n  var parentPlaneElement = containingDiagram.plane.get('planeElement');\r\n\r\n  parentPlaneElement.splice(parentPlaneElement.indexOf(diElement), 1);\r\n\r\n  newPlane.get('planeElement').push(diElement);\r\n};\r\n\r\n/**\r\n * @param {ModdleElement} businessObject\r\n *\r\n * @return {ModdleElement}\r\n */\r\nSubprocessCompatibility.prototype._createDiagram = function(businessObject) {\r\n  var plane = this._moddle.create('bpmndi:BPMNPlane', {\r\n    bpmnElement: businessObject\r\n  });\r\n\r\n  var diagram = this._moddle.create('bpmndi:BPMNDiagram', {\r\n    plane: plane\r\n  });\r\n\r\n  plane.$parent = diagram;\r\n\r\n  plane.bpmnElement = businessObject;\r\n\r\n  diagram.$parent = this._definitions;\r\n\r\n  this._definitions.diagrams.push(diagram);\r\n\r\n  return diagram;\r\n};\r\n\r\nSubprocessCompatibility.$inject = [ 'eventBus', 'moddle' ];\r\n\r\n\r\n// helpers //////////\r\n\r\nfunction findRootDiagram(element) {\r\n  if (is(element, 'bpmndi:BPMNDiagram')) {\r\n    return element;\r\n  } else {\r\n    return findRootDiagram(element.$parent);\r\n  }\r\n}\r\n\r\n/**\r\n * @param {CanvasPlane} plane\r\n *\r\n * @return {Rect}\r\n */\r\nfunction getPlaneBounds(plane) {\r\n  var planeTrbl = {\r\n    top: Infinity,\r\n    right: -Infinity,\r\n    bottom: -Infinity,\r\n    left: Infinity\r\n  };\r\n\r\n  plane.planeElement.forEach(function(element) {\r\n    if (!element.bounds) {\r\n      return;\r\n    }\r\n\r\n    var trbl = asTRBL(element.bounds);\r\n\r\n    planeTrbl.top = Math.min(trbl.top, planeTrbl.top);\r\n    planeTrbl.left = Math.min(trbl.left, planeTrbl.left);\r\n  });\r\n\r\n  return asBounds(planeTrbl);\r\n}\r\n\r\n/**\r\n * @param {ModdleElement} businessObject\r\n * @param {CanvasPlane} plane\r\n *\r\n * @return {boolean}\r\n */\r\nfunction shouldMoveToPlane(businessObject, plane) {\r\n  var parent = businessObject.$parent;\r\n\r\n  // don't move elements that are already on the plane\r\n  if (!is(parent, 'bpmn:SubProcess') || parent === plane.bpmnElement) {\r\n    return false;\r\n  }\r\n\r\n  // dataAssociations are children of the subprocess but rendered on process level\r\n  // cf. https://github.com/bpmn-io/bpmn-js/issues/1619\r\n  if (isAny(businessObject, [ 'bpmn:DataInputAssociation', 'bpmn:DataOutputAssociation' ])) {\r\n    return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n","import inherits from 'inherits-browser';\r\n\r\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\r\nimport { getBusinessObject, is } from '../../util/ModelUtil';\r\nimport { classes, domify } from 'min-dom';\r\nimport { getPlaneIdFromShape } from '../../util/DrilldownUtil';\r\n\r\n/**\r\n * @typedef {import('diagram-js/lib/core/Canvas').default} Canvas\r\n * @typedef {import('diagram-js/lib/core/ElementRegistry').default} ElementRegistry\r\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\r\n * @typedef {import('diagram-js/lib/features/overlays/Overlays').default} Overlays\r\n * @typedef {import('diagram-js/lib/i18n/translate/translate').default} Translate\r\n *\r\n * @typedef {import('../../model/Types').Element} Element\r\n * @typedef {import('../../model/Types').Parent} Parent\r\n * @typedef {import('../../model/Types').Shape} Shape\r\n */\r\n\r\nvar LOW_PRIORITY = 250;\r\nvar ARROW_DOWN_SVG = '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" d=\"M4.81801948,3.50735931 L10.4996894,9.1896894 L10.5,4 L12,4 L12,12 L4,12 L4,10.5 L9.6896894,10.4996894 L3.75735931,4.56801948 C3.46446609,4.27512627 3.46446609,3.80025253 3.75735931,3.50735931 C4.05025253,3.21446609 4.52512627,3.21446609 4.81801948,3.50735931 Z\"/></svg>';\r\n\r\nvar EMPTY_MARKER = 'bjs-drilldown-empty';\r\n\r\n/**\r\n * @param {Canvas} canvas\r\n * @param {EventBus} eventBus\r\n * @param {ElementRegistry} elementRegistry\r\n * @param {Overlays} overlays\r\n * @param {Translate} translate\r\n */\r\nexport default function DrilldownOverlayBehavior(\r\n    canvas, eventBus, elementRegistry, overlays, translate\r\n) {\r\n  CommandInterceptor.call(this, eventBus);\r\n\r\n  this._canvas = canvas;\r\n  this._eventBus = eventBus;\r\n  this._elementRegistry = elementRegistry;\r\n  this._overlays = overlays;\r\n  this._translate = translate;\r\n\r\n  var self = this;\r\n\r\n  this.executed('shape.toggleCollapse', LOW_PRIORITY, function(context) {\r\n    var shape = context.shape;\r\n\r\n    // Add overlay to the collapsed shape\r\n    if (self._canDrillDown(shape)) {\r\n      self._addOverlay(shape);\r\n    } else {\r\n      self._removeOverlay(shape);\r\n    }\r\n  }, true);\r\n\r\n\r\n  this.reverted('shape.toggleCollapse', LOW_PRIORITY, function(context) {\r\n    var shape = context.shape;\r\n\r\n    // Add overlay to the collapsed shape\r\n    if (self._canDrillDown(shape)) {\r\n      self._addOverlay(shape);\r\n    } else {\r\n      self._removeOverlay(shape);\r\n    }\r\n  }, true);\r\n\r\n\r\n  this.executed([ 'shape.create', 'shape.move', 'shape.delete' ], LOW_PRIORITY,\r\n    function(context) {\r\n      var oldParent = context.oldParent,\r\n          newParent = context.newParent || context.parent,\r\n          shape = context.shape;\r\n\r\n      // Add overlay to the collapsed shape\r\n      if (self._canDrillDown(shape)) {\r\n        self._addOverlay(shape);\r\n      }\r\n\r\n      self._updateDrilldownOverlay(oldParent);\r\n      self._updateDrilldownOverlay(newParent);\r\n      self._updateDrilldownOverlay(shape);\r\n    }, true);\r\n\r\n\r\n  this.reverted([ 'shape.create', 'shape.move', 'shape.delete' ], LOW_PRIORITY,\r\n    function(context) {\r\n      var oldParent = context.oldParent,\r\n          newParent = context.newParent || context.parent,\r\n          shape = context.shape;\r\n\r\n      // Add overlay to the collapsed shape\r\n      if (self._canDrillDown(shape)) {\r\n        self._addOverlay(shape);\r\n      }\r\n\r\n      self._updateDrilldownOverlay(oldParent);\r\n      self._updateDrilldownOverlay(newParent);\r\n      self._updateDrilldownOverlay(shape);\r\n    }, true);\r\n\r\n\r\n  eventBus.on('import.render.complete', function() {\r\n    elementRegistry.filter(function(e) {\r\n      return self._canDrillDown(e);\r\n    }).map(function(el) {\r\n      self._addOverlay(el);\r\n    });\r\n  });\r\n\r\n}\r\n\r\ninherits(DrilldownOverlayBehavior, CommandInterceptor);\r\n\r\n/**\r\n * @param {Shape} shape\r\n */\r\nDrilldownOverlayBehavior.prototype._updateDrilldownOverlay = function(shape) {\r\n  var canvas = this._canvas;\r\n\r\n  if (!shape) {\r\n    return;\r\n  }\r\n\r\n  var root = canvas.findRoot(shape);\r\n\r\n  if (root) {\r\n    this._updateOverlayVisibility(root);\r\n  }\r\n};\r\n\r\n/**\r\n * @param {Element} element\r\n *\r\n * @return {boolean}\r\n */\r\nDrilldownOverlayBehavior.prototype._canDrillDown = function(element) {\r\n  var canvas = this._canvas;\r\n\r\n  return is(element, 'bpmn:SubProcess') && canvas.findRoot(getPlaneIdFromShape(element));\r\n};\r\n\r\n/**\r\n * Update the visibility of the drilldown overlay. If the plane has no elements,\r\n * the drilldown will only be shown when the element is selected.\r\n *\r\n * @param {Parent} element The collapsed root or shape.\r\n */\r\nDrilldownOverlayBehavior.prototype._updateOverlayVisibility = function(element) {\r\n  var overlays = this._overlays;\r\n\r\n  var businessObject = getBusinessObject(element);\r\n\r\n  var overlay = overlays.get({ element: businessObject.id, type: 'drilldown' })[0];\r\n\r\n  if (!overlay) {\r\n    return;\r\n  }\r\n\r\n  var hasFlowElements = businessObject\r\n    && businessObject.get('flowElements')\r\n    && businessObject.get('flowElements').length;\r\n\r\n  classes(overlay.html).toggle(EMPTY_MARKER, !hasFlowElements);\r\n};\r\n\r\n/**\r\n * Add a drilldown button to the given element assuming the plane has the same\r\n * ID as the element.\r\n *\r\n * @param {Shape} element The collapsed shape.\r\n */\r\nDrilldownOverlayBehavior.prototype._addOverlay = function(element) {\r\n  var canvas = this._canvas,\r\n      overlays = this._overlays,\r\n      bo = getBusinessObject(element);\r\n\r\n  var existingOverlays = overlays.get({ element: element, type: 'drilldown' });\r\n\r\n  if (existingOverlays.length) {\r\n    this._removeOverlay(element);\r\n  }\r\n\r\n  var button = domify('<button type=\"button\" class=\"bjs-drilldown\">' + ARROW_DOWN_SVG + '</button>'),\r\n      elementName = bo.get('name') || bo.get('id'),\r\n      title = this._translate('Open {element}', { element: elementName });\r\n  button.setAttribute('title', title);\r\n\r\n  button.addEventListener('click', function() {\r\n    canvas.setRootElement(canvas.findRoot(getPlaneIdFromShape(element)));\r\n  });\r\n\r\n  overlays.add(element, 'drilldown', {\r\n    position: {\r\n      bottom: -7,\r\n      right: -8\r\n    },\r\n    html: button\r\n  });\r\n\r\n  this._updateOverlayVisibility(element);\r\n};\r\n\r\nDrilldownOverlayBehavior.prototype._removeOverlay = function(element) {\r\n  var overlays = this._overlays;\r\n\r\n  overlays.remove({\r\n    element: element,\r\n    type: 'drilldown'\r\n  });\r\n};\r\n\r\nDrilldownOverlayBehavior.$inject = [\r\n  'canvas',\r\n  'eventBus',\r\n  'elementRegistry',\r\n  'overlays',\r\n  'translate'\r\n];","import OverlaysModule from 'diagram-js/lib/features/overlays';\r\nimport ChangeSupportModule from 'diagram-js/lib/features/change-support';\r\nimport RootElementsModule from 'diagram-js/lib/features/root-elements';\r\n\r\nimport DrilldownBreadcrumbs from './DrilldownBreadcrumbs';\r\nimport DrilldownCentering from './DrilldownCentering';\r\nimport SubprocessCompatibility from './SubprocessCompatibility';\r\nimport DrilldownOverlayBehavior from './DrilldownOverlayBehavior';\r\n\r\nexport default {\r\n  __depends__: [ OverlaysModule, ChangeSupportModule, RootElementsModule ],\r\n  __init__: [ 'drilldownBreadcrumbs', 'drilldownOverlayBehavior', 'drilldownCentering', 'subprocessCompatibility' ],\r\n  drilldownBreadcrumbs: [ 'type', DrilldownBreadcrumbs ],\r\n  drilldownCentering: [ 'type', DrilldownCentering ],\r\n  drilldownOverlayBehavior: [ 'type', DrilldownOverlayBehavior ],\r\n  subprocessCompatibility: [ 'type', SubprocessCompatibility ]\r\n};","import inherits from 'inherits-browser';\r\n\r\nimport CoreModule from './core';\r\nimport DrilldownModdule from './features/drilldown';\r\nimport OverlaysModule from 'diagram-js/lib/features/overlays';\r\nimport SelectionModule from 'diagram-js/lib/features/selection';\r\nimport TranslateModule from 'diagram-js/lib/i18n/translate';\r\n\r\nimport BaseViewer from './BaseViewer';\r\n\r\n\r\n/**\r\n * @typedef { import('./BaseViewer').BaseViewerOptions } BaseViewerOptions\r\n */\r\n\r\n/**\r\n * A viewer for BPMN 2.0 diagrams.\r\n *\r\n * Have a look at {@link bpmn-js/lib/NavigatedViewer} or {@link bpmn-js/lib/Modeler} for bundles that include\r\n * additional features.\r\n *\r\n *\r\n * ## Extending the Viewer\r\n *\r\n * In order to extend the viewer pass extension modules to bootstrap via the\r\n * `additionalModules` option. An extension module is an object that exposes\r\n * named services.\r\n *\r\n * The following example depicts the integration of a simple\r\n * logging component that integrates with interaction events:\r\n *\r\n *\r\n * ```javascript\r\n *\r\n * // logging component\r\n * function InteractionLogger(eventBus) {\r\n *   eventBus.on('element.hover', function(event) {\r\n *     console.log()\r\n *   })\r\n * }\r\n *\r\n * InteractionLogger.$inject = [ 'eventBus' ]; // minification save\r\n *\r\n * // extension module\r\n * var extensionModule = {\r\n *   __init__: [ 'interactionLogger' ],\r\n *   interactionLogger: [ 'type', InteractionLogger ]\r\n * };\r\n *\r\n * // extend the viewer\r\n * var bpmnViewer = new Viewer({ additionalModules: [ extensionModule ] });\r\n * bpmnViewer.importXML(...);\r\n * ```\r\n *\r\n * @template [ServiceMap=null]\r\n *\r\n * @extends BaseViewer<ServiceMap>\r\n *\r\n * @param {BaseViewerOptions} [options] The options to configure the viewer.\r\n */\r\nexport default function Viewer(options) {\r\n  BaseViewer.call(this, options);\r\n}\r\n\r\ninherits(Viewer, BaseViewer);\r\n\r\n// modules the viewer is composed of\r\nViewer.prototype._modules = [\r\n  CoreModule,\r\n  DrilldownModdule,\r\n  OverlaysModule,\r\n  SelectionModule,\r\n  TranslateModule\r\n];\r\n\r\n// default moddle extensions the viewer is composed of\r\nViewer.prototype._moddleExtensions = {};","import {\n  has,\n  isNil,\n  isObject\n} from 'min-dash';\n\n/**\n * Checks whether a value is an instance of Connection.\n *\n * @param {any} value\n *\n * @return {boolean}\n */\nexport function isConnection(value) {\n  return isObject(value) && has(value, 'waypoints');\n}\n\n/**\n * Checks whether a value is an instance of Label.\n *\n * @param {any} value\n *\n * @return {boolean}\n */\nexport function isLabel(value) {\n  return isObject(value) && has(value, 'labelTarget');\n}\n\n/**\n * Checks whether a value is an instance of Root.\n *\n * @param {any} value\n *\n * @return {boolean}\n */\nexport function isRoot(value) {\n  return isObject(value) && isNil(value.parent);\n}","/**\n * Failsafe remove an element from a collection\n *\n * @param {Array<Object>} [collection]\n * @param {Object} [element]\n *\n * @return {number} the previous index of the element\n */\nexport function remove(collection, element) {\n\n  if (!collection || !element) {\n    return -1;\n  }\n\n  var idx = collection.indexOf(element);\n\n  if (idx !== -1) {\n    collection.splice(idx, 1);\n  }\n\n  return idx;\n}\n\n/**\n * Fail save add an element to the given connection, ensuring\n * it does not yet exist.\n *\n * @param {Array<Object>} collection\n * @param {Object} element\n * @param {number} [idx]\n */\nexport function add(collection, element, idx) {\n\n  if (!collection || !element) {\n    return;\n  }\n\n  if (typeof idx !== 'number') {\n    idx = -1;\n  }\n\n  var currentIdx = collection.indexOf(element);\n\n  if (currentIdx !== -1) {\n\n    if (currentIdx === idx) {\n\n      // nothing to do, position has not changed\n      return;\n    } else {\n\n      if (idx !== -1) {\n\n        // remove from current position\n        collection.splice(currentIdx, 1);\n      } else {\n\n        // already exists in collection\n        return;\n      }\n    }\n  }\n\n  if (idx !== -1) {\n\n    // insert at specified position\n    collection.splice(idx, 0, element);\n  } else {\n\n    // push to end\n    collection.push(element);\n  }\n}\n\n\n/**\n * Fail save get the index of an element in a collection.\n *\n * @param {Array<Object>} collection\n * @param {Object} element\n *\n * @return {number} the index or -1 if collection or element do\n *                  not exist or the element is not contained.\n */\nexport function indexOf(collection, element) {\n\n  if (!collection || !element) {\n    return -1;\n  }\n\n  return collection.indexOf(element);\n}\n","/**\n * Flatten array, one level deep.\n *\n * @template T\n *\n * @param {T[][] | T[] | null} [arr]\n *\n * @return {T[]}\n */\nfunction flatten(arr) {\n  return Array.prototype.concat.apply([], arr);\n}\n\nconst nativeToString = Object.prototype.toString;\nconst nativeHasOwnProperty = Object.prototype.hasOwnProperty;\n\nfunction isUndefined(obj) {\n  return obj === undefined;\n}\n\nfunction isDefined(obj) {\n  return obj !== undefined;\n}\n\nfunction isNil(obj) {\n  return obj == null;\n}\n\nfunction isArray(obj) {\n  return nativeToString.call(obj) === '[object Array]';\n}\n\nfunction isObject(obj) {\n  return nativeToString.call(obj) === '[object Object]';\n}\n\nfunction isNumber(obj) {\n  return nativeToString.call(obj) === '[object Number]';\n}\n\n/**\n * @param {any} obj\n *\n * @return {boolean}\n */\nfunction isFunction(obj) {\n  const tag = nativeToString.call(obj);\n\n  return (\n    tag === '[object Function]' ||\n    tag === '[object AsyncFunction]' ||\n    tag === '[object GeneratorFunction]' ||\n    tag === '[object AsyncGeneratorFunction]' ||\n    tag === '[object Proxy]'\n  );\n}\n\nfunction isString(obj) {\n  return nativeToString.call(obj) === '[object String]';\n}\n\n\n/**\n * Ensure collection is an array.\n *\n * @param {Object} obj\n */\nfunction ensureArray(obj) {\n\n  if (isArray(obj)) {\n    return;\n  }\n\n  throw new Error('must supply array');\n}\n\n/**\n * Return true, if target owns a property with the given key.\n *\n * @param {Object} target\n * @param {String} key\n *\n * @return {Boolean}\n */\nfunction has(target, key) {\n  return nativeHasOwnProperty.call(target, key);\n}\n\n/**\n * @template T\n * @typedef { (\n *   ((e: T) => boolean) |\n *   ((e: T, idx: number) => boolean) |\n *   ((e: T, key: string) => boolean) |\n *   string |\n *   number\n * ) } Matcher\n */\n\n/**\n * @template T\n * @template U\n *\n * @typedef { (\n *   ((e: T) => U) | string | number\n * ) } Extractor\n */\n\n\n/**\n * @template T\n * @typedef { (val: T, key: any) => boolean } MatchFn\n */\n\n/**\n * @template T\n * @typedef { T[] } ArrayCollection\n */\n\n/**\n * @template T\n * @typedef { { [key: string]: T } } StringKeyValueCollection\n */\n\n/**\n * @template T\n * @typedef { { [key: number]: T } } NumberKeyValueCollection\n */\n\n/**\n * @template T\n * @typedef { StringKeyValueCollection<T> | NumberKeyValueCollection<T> } KeyValueCollection\n */\n\n/**\n * @template T\n * @typedef { KeyValueCollection<T> | ArrayCollection<T> } Collection\n */\n\n/**\n * Find element in collection.\n *\n * @template T\n * @param {Collection<T>} collection\n * @param {Matcher<T>} matcher\n *\n * @return {Object}\n */\nfunction find(collection, matcher) {\n\n  const matchFn = toMatcher(matcher);\n\n  let match;\n\n  forEach(collection, function(val, key) {\n    if (matchFn(val, key)) {\n      match = val;\n\n      return false;\n    }\n  });\n\n  return match;\n\n}\n\n\n/**\n * Find element index in collection.\n *\n * @template T\n * @param {Collection<T>} collection\n * @param {Matcher<T>} matcher\n *\n * @return {number}\n */\nfunction findIndex(collection, matcher) {\n\n  const matchFn = toMatcher(matcher);\n\n  let idx = isArray(collection) ? -1 : undefined;\n\n  forEach(collection, function(val, key) {\n    if (matchFn(val, key)) {\n      idx = key;\n\n      return false;\n    }\n  });\n\n  return idx;\n}\n\n\n/**\n * Filter elements in collection.\n *\n * @template T\n * @param {Collection<T>} collection\n * @param {Matcher<T>} matcher\n *\n * @return {T[]} result\n */\nfunction filter(collection, matcher) {\n\n  const matchFn = toMatcher(matcher);\n\n  let result = [];\n\n  forEach(collection, function(val, key) {\n    if (matchFn(val, key)) {\n      result.push(val);\n    }\n  });\n\n  return result;\n}\n\n\n/**\n * Iterate over collection; returning something\n * (non-undefined) will stop iteration.\n *\n * @template T\n * @param {Collection<T>} collection\n * @param { ((item: T, idx: number) => (boolean|void)) | ((item: T, key: string) => (boolean|void)) } iterator\n *\n * @return {T} return result that stopped the iteration\n */\nfunction forEach(collection, iterator) {\n\n  let val,\n      result;\n\n  if (isUndefined(collection)) {\n    return;\n  }\n\n  const convertKey = isArray(collection) ? toNum : identity;\n\n  for (let key in collection) {\n\n    if (has(collection, key)) {\n      val = collection[key];\n\n      result = iterator(val, convertKey(key));\n\n      if (result === false) {\n        return val;\n      }\n    }\n  }\n}\n\n/**\n * Return collection without element.\n *\n * @template T\n * @param {ArrayCollection<T>} arr\n * @param {Matcher<T>} matcher\n *\n * @return {T[]}\n */\nfunction without(arr, matcher) {\n\n  if (isUndefined(arr)) {\n    return [];\n  }\n\n  ensureArray(arr);\n\n  const matchFn = toMatcher(matcher);\n\n  return arr.filter(function(el, idx) {\n    return !matchFn(el, idx);\n  });\n\n}\n\n\n/**\n * Reduce collection, returning a single result.\n *\n * @template T\n * @template V\n *\n * @param {Collection<T>} collection\n * @param {(result: V, entry: T, index: any) => V} iterator\n * @param {V} result\n *\n * @return {V} result returned from last iterator\n */\nfunction reduce(collection, iterator, result) {\n\n  forEach(collection, function(value, idx) {\n    result = iterator(result, value, idx);\n  });\n\n  return result;\n}\n\n\n/**\n * Return true if every element in the collection\n * matches the criteria.\n *\n * @param  {Object|Array} collection\n * @param  {Function} matcher\n *\n * @return {Boolean}\n */\nfunction every(collection, matcher) {\n\n  return !!reduce(collection, function(matches, val, key) {\n    return matches && matcher(val, key);\n  }, true);\n}\n\n\n/**\n * Return true if some elements in the collection\n * match the criteria.\n *\n * @param  {Object|Array} collection\n * @param  {Function} matcher\n *\n * @return {Boolean}\n */\nfunction some(collection, matcher) {\n\n  return !!find(collection, matcher);\n}\n\n\n/**\n * Transform a collection into another collection\n * by piping each member through the given fn.\n *\n * @param  {Object|Array}   collection\n * @param  {Function} fn\n *\n * @return {Array} transformed collection\n */\nfunction map(collection, fn) {\n\n  let result = [];\n\n  forEach(collection, function(val, key) {\n    result.push(fn(val, key));\n  });\n\n  return result;\n}\n\n\n/**\n * Get the collections keys.\n *\n * @param  {Object|Array} collection\n *\n * @return {Array}\n */\nfunction keys(collection) {\n  return collection && Object.keys(collection) || [];\n}\n\n\n/**\n * Shorthand for `keys(o).length`.\n *\n * @param  {Object|Array} collection\n *\n * @return {Number}\n */\nfunction size(collection) {\n  return keys(collection).length;\n}\n\n\n/**\n * Get the values in the collection.\n *\n * @param  {Object|Array} collection\n *\n * @return {Array}\n */\nfunction values(collection) {\n  return map(collection, (val) => val);\n}\n\n\n/**\n * Group collection members by attribute.\n *\n * @param {Object|Array} collection\n * @param {Extractor} extractor\n *\n * @return {Object} map with { attrValue => [ a, b, c ] }\n */\nfunction groupBy(collection, extractor, grouped = {}) {\n\n  extractor = toExtractor(extractor);\n\n  forEach(collection, function(val) {\n    let discriminator = extractor(val) || '_';\n\n    let group = grouped[discriminator];\n\n    if (!group) {\n      group = grouped[discriminator] = [];\n    }\n\n    group.push(val);\n  });\n\n  return grouped;\n}\n\n\nfunction uniqueBy(extractor, ...collections) {\n\n  extractor = toExtractor(extractor);\n\n  let grouped = {};\n\n  forEach(collections, (c) => groupBy(c, extractor, grouped));\n\n  let result = map(grouped, function(val, key) {\n    return val[0];\n  });\n\n  return result;\n}\n\n\nconst unionBy = uniqueBy;\n\n\n\n/**\n * Sort collection by criteria.\n *\n * @template T\n *\n * @param {Collection<T>} collection\n * @param {Extractor<T, number | string>} extractor\n *\n * @return {Array}\n */\nfunction sortBy(collection, extractor) {\n\n  extractor = toExtractor(extractor);\n\n  let sorted = [];\n\n  forEach(collection, function(value, key) {\n    let disc = extractor(value, key);\n\n    let entry = {\n      d: disc,\n      v: value\n    };\n\n    for (var idx = 0; idx < sorted.length; idx++) {\n      let { d } = sorted[idx];\n\n      if (disc < d) {\n        sorted.splice(idx, 0, entry);\n        return;\n      }\n    }\n\n    // not inserted, append (!)\n    sorted.push(entry);\n  });\n\n  return map(sorted, (e) => e.v);\n}\n\n\n/**\n * Create an object pattern matcher.\n *\n * @example\n *\n * ```javascript\n * const matcher = matchPattern({ id: 1 });\n *\n * let element = find(elements, matcher);\n * ```\n *\n * @template T\n *\n * @param {T} pattern\n *\n * @return { (el: any) =>  boolean } matcherFn\n */\nfunction matchPattern(pattern) {\n\n  return function(el) {\n\n    return every(pattern, function(val, key) {\n      return el[key] === val;\n    });\n\n  };\n}\n\n\n/**\n * @param {string | ((e: any) => any) } extractor\n *\n * @return { (e: any) => any }\n */\nfunction toExtractor(extractor) {\n\n  /**\n   * @satisfies { (e: any) => any }\n   */\n  return isFunction(extractor) ? extractor : (e) => {\n\n    // @ts-ignore: just works\n    return e[extractor];\n  };\n}\n\n\n/**\n * @template T\n * @param {Matcher<T>} matcher\n *\n * @return {MatchFn<T>}\n */\nfunction toMatcher(matcher) {\n  return isFunction(matcher) ? matcher : (e) => {\n    return e === matcher;\n  };\n}\n\n\nfunction identity(arg) {\n  return arg;\n}\n\nfunction toNum(arg) {\n  return Number(arg);\n}\n\n/* global setTimeout clearTimeout */\n\n/**\n * @typedef { {\n *   (...args: any[]): any;\n *   flush: () => void;\n *   cancel: () => void;\n * } } DebouncedFunction\n */\n\n/**\n * Debounce fn, calling it only once if the given time\n * elapsed between calls.\n *\n * Lodash-style the function exposes methods to `#clear`\n * and `#flush` to control internal behavior.\n *\n * @param  {Function} fn\n * @param  {Number} timeout\n *\n * @return {DebouncedFunction} debounced function\n */\nfunction debounce(fn, timeout) {\n\n  let timer;\n\n  let lastArgs;\n  let lastThis;\n\n  let lastNow;\n\n  function fire(force) {\n\n    let now = Date.now();\n\n    let scheduledDiff = force ? 0 : (lastNow + timeout) - now;\n\n    if (scheduledDiff > 0) {\n      return schedule(scheduledDiff);\n    }\n\n    fn.apply(lastThis, lastArgs);\n\n    clear();\n  }\n\n  function schedule(timeout) {\n    timer = setTimeout(fire, timeout);\n  }\n\n  function clear() {\n    if (timer) {\n      clearTimeout(timer);\n    }\n\n    timer = lastNow = lastArgs = lastThis = undefined;\n  }\n\n  function flush() {\n    if (timer) {\n      fire(true);\n    }\n\n    clear();\n  }\n\n  /**\n   * @type { DebouncedFunction }\n   */\n  function callback(...args) {\n    lastNow = Date.now();\n\n    lastArgs = args;\n    lastThis = this;\n\n    // ensure an execution is scheduled\n    if (!timer) {\n      schedule(timeout);\n    }\n  }\n\n  callback.flush = flush;\n  callback.cancel = clear;\n\n  return callback;\n}\n\n/**\n * Throttle fn, calling at most once\n * in the given interval.\n *\n * @param  {Function} fn\n * @param  {Number} interval\n *\n * @return {Function} throttled function\n */\nfunction throttle(fn, interval) {\n  let throttling = false;\n\n  return function(...args) {\n\n    if (throttling) {\n      return;\n    }\n\n    fn(...args);\n    throttling = true;\n\n    setTimeout(() => {\n      throttling = false;\n    }, interval);\n  };\n}\n\n/**\n * Bind function against target <this>.\n *\n * @param  {Function} fn\n * @param  {Object}   target\n *\n * @return {Function} bound function\n */\nfunction bind(fn, target) {\n  return fn.bind(target);\n}\n\n/**\n * Convenience wrapper for `Object.assign`.\n *\n * @param {Object} target\n * @param {...Object} others\n *\n * @return {Object} the target\n */\nfunction assign(target, ...others) {\n  return Object.assign(target, ...others);\n}\n\n/**\n * Sets a nested property of a given object to the specified value.\n *\n * This mutates the object and returns it.\n *\n * @template T\n *\n * @param {T} target The target of the set operation.\n * @param {(string|number)[]} path The path to the nested value.\n * @param {any} value The value to set.\n *\n * @return {T}\n */\nfunction set(target, path, value) {\n\n  let currentTarget = target;\n\n  forEach(path, function(key, idx) {\n\n    if (typeof key !== 'number' && typeof key !== 'string') {\n      throw new Error('illegal key type: ' + typeof key + '. Key should be of type number or string.');\n    }\n\n    if (key === 'constructor') {\n      throw new Error('illegal key: constructor');\n    }\n\n    if (key === '__proto__') {\n      throw new Error('illegal key: __proto__');\n    }\n\n    let nextKey = path[idx + 1];\n    let nextTarget = currentTarget[key];\n\n    if (isDefined(nextKey) && isNil(nextTarget)) {\n      nextTarget = currentTarget[key] = isNaN(+nextKey) ? {} : [];\n    }\n\n    if (isUndefined(nextKey)) {\n      if (isUndefined(value)) {\n        delete currentTarget[key];\n      } else {\n        currentTarget[key] = value;\n      }\n    } else {\n      currentTarget = nextTarget;\n    }\n  });\n\n  return target;\n}\n\n\n/**\n * Gets a nested property of a given object.\n *\n * @param {Object} target The target of the get operation.\n * @param {(string|number)[]} path The path to the nested value.\n * @param {any} [defaultValue] The value to return if no value exists.\n *\n * @return {any}\n */\nfunction get(target, path, defaultValue) {\n\n  let currentTarget = target;\n\n  forEach(path, function(key) {\n\n    // accessing nil property yields <undefined>\n    if (isNil(currentTarget)) {\n      currentTarget = undefined;\n\n      return false;\n    }\n\n    currentTarget = currentTarget[key];\n  });\n\n  return isUndefined(currentTarget) ? defaultValue : currentTarget;\n}\n\n/**\n * Pick properties from the given target.\n *\n * @template T\n * @template {any[]} V\n *\n * @param {T} target\n * @param {V} properties\n *\n * @return Pick<T, V>\n */\nfunction pick(target, properties) {\n\n  let result = {};\n\n  let obj = Object(target);\n\n  forEach(properties, function(prop) {\n\n    if (prop in obj) {\n      result[prop] = target[prop];\n    }\n  });\n\n  return result;\n}\n\n/**\n * Pick all target properties, excluding the given ones.\n *\n * @template T\n * @template {any[]} V\n *\n * @param {T} target\n * @param {V} properties\n *\n * @return {Omit<T, V>} target\n */\nfunction omit(target, properties) {\n\n  let result = {};\n\n  let obj = Object(target);\n\n  forEach(obj, function(prop, key) {\n\n    if (properties.indexOf(key) === -1) {\n      result[key] = prop;\n    }\n  });\n\n  return result;\n}\n\n/**\n * Recursively merge `...sources` into given target.\n *\n * Does support merging objects; does not support merging arrays.\n *\n * @param {Object} target\n * @param {...Object} sources\n *\n * @return {Object} the target\n */\nfunction merge(target, ...sources) {\n\n  if (!sources.length) {\n    return target;\n  }\n\n  forEach(sources, function(source) {\n\n    // skip non-obj sources, i.e. null\n    if (!source || !isObject(source)) {\n      return;\n    }\n\n    forEach(source, function(sourceVal, key) {\n\n      if (key === '__proto__') {\n        return;\n      }\n\n      let targetVal = target[key];\n\n      if (isObject(sourceVal)) {\n\n        if (!isObject(targetVal)) {\n\n          // override target[key] with object\n          targetVal = {};\n        }\n\n        target[key] = merge(targetVal, sourceVal);\n      } else {\n        target[key] = sourceVal;\n      }\n\n    });\n  });\n\n  return target;\n}\n\nexport { assign, bind, debounce, ensureArray, every, filter, find, findIndex, flatten, forEach, get, groupBy, has, isArray, isDefined, isFunction, isNil, isNumber, isObject, isString, isUndefined, keys, map, matchPattern, merge, omit, pick, reduce, set, size, some, sortBy, throttle, unionBy, uniqueBy, values, without };\n","import { forEach } from 'min-dash';\n\n/**\n * Assigns style attributes in a style-src compliant way.\n *\n * @param {Element} element\n * @param {...Object} styleSources\n *\n * @return {Element} the element\n */\nexport function assign(element, ...styleSources) {\n  const target = element.style;\n\n  forEach(styleSources, function(style) {\n    if (!style) {\n      return;\n    }\n\n    forEach(style, function(value, key) {\n      target[key] = value;\n    });\n  });\n\n  return element;\n}\n","/**\n * Set attribute `name` to `val`, or get attr `name`.\n *\n * @param {Element} el\n * @param {String} name\n * @param {String} [val]\n * @api public\n */\nexport default function attr(el, name, val) {\n\n  // get\n  if (arguments.length == 2) {\n    return el.getAttribute(name);\n  }\n\n  // remove\n  if (val === null) {\n    return el.removeAttribute(name);\n  }\n\n  // set\n  el.setAttribute(name, val);\n\n  return el;\n}","/**\n * Taken from https://github.com/component/classes\n *\n * Without the component bits.\n */\n\n/**\n * toString reference.\n */\n\nconst toString = Object.prototype.toString;\n\n/**\n * Wrap `el` in a `ClassList`.\n *\n * @param {Element} el\n * @return {ClassList}\n * @api public\n */\n\nexport default function classes(el) {\n  return new ClassList(el);\n}\n\n/**\n * Initialize a new ClassList for `el`.\n *\n * @param {Element} el\n * @api private\n */\n\nfunction ClassList(el) {\n  if (!el || !el.nodeType) {\n    throw new Error('A DOM element reference is required');\n  }\n  this.el = el;\n  this.list = el.classList;\n}\n\n/**\n * Add class `name` if not already present.\n *\n * @param {String} name\n * @return {ClassList}\n * @api public\n */\n\nClassList.prototype.add = function(name) {\n  this.list.add(name);\n  return this;\n};\n\n/**\n * Remove class `name` when present, or\n * pass a regular expression to remove\n * any which match.\n *\n * @param {String|RegExp} name\n * @return {ClassList}\n * @api public\n */\n\nClassList.prototype.remove = function(name) {\n  if ('[object RegExp]' == toString.call(name)) {\n    return this.removeMatching(name);\n  }\n\n  this.list.remove(name);\n  return this;\n};\n\n/**\n * Remove all classes matching `re`.\n *\n * @param {RegExp} re\n * @return {ClassList}\n * @api private\n */\n\nClassList.prototype.removeMatching = function(re) {\n  const arr = this.array();\n  for (let i = 0; i < arr.length; i++) {\n    if (re.test(arr[i])) {\n      this.remove(arr[i]);\n    }\n  }\n  return this;\n};\n\n/**\n * Toggle class `name`, can force state via `force`.\n *\n * For browsers that support classList, but do not support `force` yet,\n * the mistake will be detected and corrected.\n *\n * @param {String} name\n * @param {Boolean} force\n * @return {ClassList}\n * @api public\n */\n\nClassList.prototype.toggle = function(name, force) {\n  if ('undefined' !== typeof force) {\n    if (force !== this.list.toggle(name, force)) {\n      this.list.toggle(name); // toggle again to correct\n    }\n  } else {\n    this.list.toggle(name);\n  }\n  return this;\n};\n\n/**\n * Return an array of classes.\n *\n * @return {Array}\n * @api public\n */\n\nClassList.prototype.array = function() {\n  return Array.from(this.list);\n};\n\n/**\n * Check if class `name` is present.\n *\n * @param {String} name\n * @return {ClassList}\n * @api public\n */\n\nClassList.prototype.has =\nClassList.prototype.contains = function(name) {\n  return this.list.contains(name);\n};\n","/**\n * Clear utility\n */\n\n/**\n * Removes all children from the given element\n *\n * @param {Element} element\n *\n * @return {Element} the element (for chaining)\n */\nexport default function clear(element) {\n  var child;\n\n  while ((child = element.firstChild)) {\n    element.removeChild(child);\n  }\n\n  return element;\n}","/**\n * Closest\n *\n * @param {Element} el\n * @param {string} selector\n * @param {boolean} checkYourSelf (optional)\n */\nexport default function(element, selector, checkYourSelf) {\n  var actualElement = checkYourSelf ? element : element.parentNode;\n\n  return actualElement && typeof actualElement.closest === 'function' && actualElement.closest(selector) || null;\n}\n","var bind, unbind, prefix;\n\nfunction detect () {\n  bind = window.addEventListener ? 'addEventListener' : 'attachEvent';\n  unbind = window.removeEventListener ? 'removeEventListener' : 'detachEvent';\n  prefix = bind !== 'addEventListener' ? 'on' : '';\n}\n\n/**\n * Bind `el` event `type` to `fn`.\n *\n * @param {Element} el\n * @param {String} type\n * @param {Function} fn\n * @param {Boolean} capture\n * @return {Function}\n * @api public\n */\n\nexports.bind = function(el, type, fn, capture){\n  if (!bind) detect();\n  el[bind](prefix + type, fn, capture || false);\n  return fn;\n};\n\n/**\n * Unbind `el` event `type`'s callback `fn`.\n *\n * @param {Element} el\n * @param {String} type\n * @param {Function} fn\n * @param {Boolean} capture\n * @return {Function}\n * @api public\n */\n\nexports.unbind = function(el, type, fn, capture){\n  if (!unbind) detect();\n  el[unbind](prefix + type, fn, capture || false);\n  return fn;\n};\n","/**\n * Module dependencies.\n */\n\nimport closest from './closest';\nimport event from './event';\n\n/**\n * Delegate event `type` to `selector`\n * and invoke `fn(e)`. A callback function\n * is returned which may be passed to `.unbind()`.\n *\n * @param {Element} el\n * @param {String} selector\n * @param {String} type\n * @param {Function} fn\n * @param {Boolean} capture\n * @return {Function}\n * @api public\n */\n\n// Some events don't bubble, so we want to bind to the capture phase instead\n// when delegating.\nvar forceCaptureEvents = [ 'focus', 'blur' ];\n\nfunction bind(el, selector, type, fn, capture) {\n  if (forceCaptureEvents.indexOf(type) !== -1) {\n    capture = true;\n  }\n\n  return event.bind(el, type, function(e) {\n    var target = e.target || e.srcElement;\n    e.delegateTarget = closest(target, selector, true, el);\n    if (e.delegateTarget) {\n      fn.call(el, e);\n    }\n  }, capture);\n}\n\n/**\n * Unbind event `type`'s callback `fn`.\n *\n * @param {Element} el\n * @param {String} type\n * @param {Function} fn\n * @param {Boolean} capture\n * @api public\n */\nfunction unbind(el, type, fn, capture) {\n  if (forceCaptureEvents.indexOf(type) !== -1) {\n    capture = true;\n  }\n\n  return event.unbind(el, type, fn, capture);\n}\n\nexport default {\n  bind,\n  unbind\n};","\n/**\n * Expose `parse`.\n */\n\nmodule.exports = parse;\n\n/**\n * Tests for browser support.\n */\n\nvar innerHTMLBug = false;\nvar bugTestDiv;\nif (typeof document !== 'undefined') {\n  bugTestDiv = document.createElement('div');\n  // Setup\n  bugTestDiv.innerHTML = '  <link/><table></table><a href=\"/a\">a</a><input type=\"checkbox\"/>';\n  // Make sure that link elements get serialized correctly by innerHTML\n  // This requires a wrapper element in IE\n  innerHTMLBug = !bugTestDiv.getElementsByTagName('link').length;\n  bugTestDiv = undefined;\n}\n\n/**\n * Wrap map from jquery.\n */\n\nvar map = {\n  legend: [1, '<fieldset>', '</fieldset>'],\n  tr: [2, '<table><tbody>', '</tbody></table>'],\n  col: [2, '<table><tbody></tbody><colgroup>', '</colgroup></table>'],\n  // for script/link/style tags to work in IE6-8, you have to wrap\n  // in a div with a non-whitespace character in front, ha!\n  _default: innerHTMLBug ? [1, 'X<div>', '</div>'] : [0, '', '']\n};\n\nmap.td =\nmap.th = [3, '<table><tbody><tr>', '</tr></tbody></table>'];\n\nmap.option =\nmap.optgroup = [1, '<select multiple=\"multiple\">', '</select>'];\n\nmap.thead =\nmap.tbody =\nmap.colgroup =\nmap.caption =\nmap.tfoot = [1, '<table>', '</table>'];\n\nmap.polyline =\nmap.ellipse =\nmap.polygon =\nmap.circle =\nmap.text =\nmap.line =\nmap.path =\nmap.rect =\nmap.g = [1, '<svg xmlns=\"http://www.w3.org/2000/svg\" version=\"1.1\">','</svg>'];\n\n/**\n * Parse `html` and return a DOM Node instance, which could be a TextNode,\n * HTML DOM Node of some kind (<div> for example), or a DocumentFragment\n * instance, depending on the contents of the `html` string.\n *\n * @param {String} html - HTML string to \"domify\"\n * @param {Document} doc - The `document` instance to create the Node for\n * @return {DOMNode} the TextNode, DOM Node, or DocumentFragment instance\n * @api private\n */\n\nfunction parse(html, doc) {\n  if ('string' != typeof html) throw new TypeError('String expected');\n\n  // default to the global `document` object\n  if (!doc) doc = document;\n\n  // tag name\n  var m = /<([\\w:]+)/.exec(html);\n  if (!m) return doc.createTextNode(html);\n\n  html = html.replace(/^\\s+|\\s+$/g, ''); // Remove leading/trailing whitespace\n\n  var tag = m[1];\n\n  // body support\n  if (tag == 'body') {\n    var el = doc.createElement('html');\n    el.innerHTML = html;\n    return el.removeChild(el.lastChild);\n  }\n\n  // wrap map\n  var wrap = Object.prototype.hasOwnProperty.call(map, tag) ? map[tag] : map._default;\n  var depth = wrap[0];\n  var prefix = wrap[1];\n  var suffix = wrap[2];\n  var el = doc.createElement('div');\n  el.innerHTML = prefix + html + suffix;\n  while (depth--) el = el.lastChild;\n\n  // one element\n  if (el.firstChild == el.lastChild) {\n    return el.removeChild(el.firstChild);\n  }\n\n  // several elements\n  var fragment = doc.createDocumentFragment();\n  while (el.firstChild) {\n    fragment.appendChild(el.removeChild(el.firstChild));\n  }\n\n  return fragment;\n}\n","/**\n * @param { HTMLElement } element\n * @param { String } selector\n *\n * @return { boolean }\n */\nexport default function matches(element, selector) {\n  return element && typeof element.matches === 'function' && element.matches(selector) || false;\n}","export default function query(selector, el) {\n  el = el || document;\n\n  return el.querySelector(selector);\n}\n\nexport function all(selector, el) {\n  el = el || document;\n\n  return el.querySelectorAll(selector);\n}","export default function remove(el) {\n  el.parentNode && el.parentNode.removeChild(el);\n}","function ensureImported(element, target) {\n\n  if (element.ownerDocument !== target.ownerDocument) {\n    try {\n\n      // may fail on webkit\n      return target.ownerDocument.importNode(element, true);\n    } catch (e) {\n\n      // ignore\n    }\n  }\n\n  return element;\n}\n\n/**\n * appendTo utility\n */\n\n\n/**\n * Append a node to a target element and return the appended node.\n *\n * @param  {SVGElement} element\n * @param  {SVGElement} target\n *\n * @return {SVGElement} the appended node\n */\nfunction appendTo(element, target) {\n  return target.appendChild(ensureImported(element, target));\n}\n\n/**\n * append utility\n */\n\n\n/**\n * Append a node to an element\n *\n * @param  {SVGElement} element\n * @param  {SVGElement} node\n *\n * @return {SVGElement} the element\n */\nfunction append(target, node) {\n  appendTo(node, target);\n  return target;\n}\n\n/**\n * attribute accessor utility\n */\n\nvar LENGTH_ATTR = 2;\n\nvar CSS_PROPERTIES = {\n  'alignment-baseline': 1,\n  'baseline-shift': 1,\n  'clip': 1,\n  'clip-path': 1,\n  'clip-rule': 1,\n  'color': 1,\n  'color-interpolation': 1,\n  'color-interpolation-filters': 1,\n  'color-profile': 1,\n  'color-rendering': 1,\n  'cursor': 1,\n  'direction': 1,\n  'display': 1,\n  'dominant-baseline': 1,\n  'enable-background': 1,\n  'fill': 1,\n  'fill-opacity': 1,\n  'fill-rule': 1,\n  'filter': 1,\n  'flood-color': 1,\n  'flood-opacity': 1,\n  'font': 1,\n  'font-family': 1,\n  'font-size': LENGTH_ATTR,\n  'font-size-adjust': 1,\n  'font-stretch': 1,\n  'font-style': 1,\n  'font-variant': 1,\n  'font-weight': 1,\n  'glyph-orientation-horizontal': 1,\n  'glyph-orientation-vertical': 1,\n  'image-rendering': 1,\n  'kerning': 1,\n  'letter-spacing': 1,\n  'lighting-color': 1,\n  'marker': 1,\n  'marker-end': 1,\n  'marker-mid': 1,\n  'marker-start': 1,\n  'mask': 1,\n  'opacity': 1,\n  'overflow': 1,\n  'pointer-events': 1,\n  'shape-rendering': 1,\n  'stop-color': 1,\n  'stop-opacity': 1,\n  'stroke': 1,\n  'stroke-dasharray': 1,\n  'stroke-dashoffset': 1,\n  'stroke-linecap': 1,\n  'stroke-linejoin': 1,\n  'stroke-miterlimit': 1,\n  'stroke-opacity': 1,\n  'stroke-width': LENGTH_ATTR,\n  'text-anchor': 1,\n  'text-decoration': 1,\n  'text-rendering': 1,\n  'unicode-bidi': 1,\n  'visibility': 1,\n  'word-spacing': 1,\n  'writing-mode': 1\n};\n\n\nfunction getAttribute(node, name) {\n  if (CSS_PROPERTIES[name]) {\n    return node.style[name];\n  } else {\n    return node.getAttributeNS(null, name);\n  }\n}\n\nfunction setAttribute(node, name, value) {\n  var hyphenated = name.replace(/([a-z])([A-Z])/g, '$1-$2').toLowerCase();\n\n  var type = CSS_PROPERTIES[hyphenated];\n\n  if (type) {\n\n    // append pixel unit, unless present\n    if (type === LENGTH_ATTR && typeof value === 'number') {\n      value = String(value) + 'px';\n    }\n\n    node.style[hyphenated] = value;\n  } else {\n    node.setAttributeNS(null, name, value);\n  }\n}\n\nfunction setAttributes(node, attrs) {\n\n  var names = Object.keys(attrs), i, name;\n\n  for (i = 0, name; (name = names[i]); i++) {\n    setAttribute(node, name, attrs[name]);\n  }\n}\n\n/**\n * Gets or sets raw attributes on a node.\n *\n * @param  {SVGElement} node\n * @param  {Object} [attrs]\n * @param  {String} [name]\n * @param  {String} [value]\n *\n * @return {String}\n */\nfunction attr(node, name, value) {\n  if (typeof name === 'string') {\n    if (value !== undefined) {\n      setAttribute(node, name, value);\n    } else {\n      return getAttribute(node, name);\n    }\n  } else {\n    setAttributes(node, name);\n  }\n\n  return node;\n}\n\n/**\r\n * Taken from https://github.com/component/classes\r\n *\r\n * Without the component bits.\r\n */\r\n\r\n/**\r\n * toString reference.\r\n */\r\n\r\nconst toString = Object.prototype.toString;\r\n\r\n/**\r\n  * Wrap `el` in a `ClassList`.\r\n  *\r\n  * @param {Element} el\r\n  * @return {ClassList}\r\n  * @api public\r\n  */\r\n\r\nfunction classes(el) {\r\n  return new ClassList(el);\r\n}\r\n\r\nfunction ClassList(el) {\r\n  if (!el || !el.nodeType) {\r\n    throw new Error('A DOM element reference is required');\r\n  }\r\n  this.el = el;\r\n  this.list = el.classList;\r\n}\r\n\r\n/**\r\n  * Add class `name` if not already present.\r\n  *\r\n  * @param {String} name\r\n  * @return {ClassList}\r\n  * @api public\r\n  */\r\n\r\nClassList.prototype.add = function(name) {\r\n  this.list.add(name);\r\n  return this;\r\n};\r\n\r\n/**\r\n  * Remove class `name` when present, or\r\n  * pass a regular expression to remove\r\n  * any which match.\r\n  *\r\n  * @param {String|RegExp} name\r\n  * @return {ClassList}\r\n  * @api public\r\n  */\r\n\r\nClassList.prototype.remove = function(name) {\r\n  if ('[object RegExp]' == toString.call(name)) {\r\n    return this.removeMatching(name);\r\n  }\r\n\r\n  this.list.remove(name);\r\n  return this;\r\n};\r\n\r\n/**\r\n  * Remove all classes matching `re`.\r\n  *\r\n  * @param {RegExp} re\r\n  * @return {ClassList}\r\n  * @api private\r\n  */\r\n\r\nClassList.prototype.removeMatching = function(re) {\r\n  const arr = this.array();\r\n  for (let i = 0; i < arr.length; i++) {\r\n    if (re.test(arr[i])) {\r\n      this.remove(arr[i]);\r\n    }\r\n  }\r\n  return this;\r\n};\r\n\r\n/**\r\n  * Toggle class `name`, can force state via `force`.\r\n  *\r\n  * For browsers that support classList, but do not support `force` yet,\r\n  * the mistake will be detected and corrected.\r\n  *\r\n  * @param {String} name\r\n  * @param {Boolean} force\r\n  * @return {ClassList}\r\n  * @api public\r\n  */\r\n\r\nClassList.prototype.toggle = function(name, force) {\r\n  if ('undefined' !== typeof force) {\r\n    if (force !== this.list.toggle(name, force)) {\r\n      this.list.toggle(name); // toggle again to correct\r\n    }\r\n  } else {\r\n    this.list.toggle(name);\r\n  }\r\n  return this;\r\n};\r\n\r\n/**\r\n  * Return an array of classes.\r\n  *\r\n  * @return {Array}\r\n  * @api public\r\n  */\r\n\r\nClassList.prototype.array = function() {\r\n  return Array.from(this.list);\r\n};\r\n\r\n/**\r\n  * Check if class `name` is present.\r\n  *\r\n  * @param {String} name\r\n  * @return {ClassList}\r\n  * @api public\r\n  */\r\n\r\nClassList.prototype.has =\r\n ClassList.prototype.contains = function(name) {\r\n   return this.list.contains(name);\r\n };\n\n/**\n * Clear utility\n */\n\n/**\n * Removes all children from the given element\n *\n * @param  {SVGElement} element\n * @return {Element} the element (for chaining)\n */\nfunction clear(element) {\n  var child;\n\n  while ((child = element.firstChild)) {\n    element.removeChild(child);\n  }\n\n  return element;\n}\n\nfunction clone(element) {\n  return element.cloneNode(true);\n}\n\nvar ns = {\n  svg: 'http://www.w3.org/2000/svg'\n};\n\n/**\n * DOM parsing utility\n */\n\n\nvar SVG_START = '<svg xmlns=\"' + ns.svg + '\"';\n\nfunction parse(svg) {\n\n  var unwrap = false;\n\n  // ensure we import a valid svg document\n  if (svg.substring(0, 4) === '<svg') {\n    if (svg.indexOf(ns.svg) === -1) {\n      svg = SVG_START + svg.substring(4);\n    }\n  } else {\n\n    // namespace svg\n    svg = SVG_START + '>' + svg + '</svg>';\n    unwrap = true;\n  }\n\n  var parsed = parseDocument(svg);\n\n  if (!unwrap) {\n    return parsed;\n  }\n\n  var fragment = document.createDocumentFragment();\n\n  var parent = parsed.firstChild;\n\n  while (parent.firstChild) {\n    fragment.appendChild(parent.firstChild);\n  }\n\n  return fragment;\n}\n\nfunction parseDocument(svg) {\n\n  var parser;\n\n  // parse\n  parser = new DOMParser();\n  parser.async = false;\n\n  return parser.parseFromString(svg, 'text/xml');\n}\n\n/**\n * Create utility for SVG elements\n */\n\n\n\n/**\n * Create a specific type from name or SVG markup.\n *\n * @param {String} name the name or markup of the element\n * @param {Object} [attrs] attributes to set on the element\n *\n * @returns {SVGElement}\n */\nfunction create(name, attrs) {\n  var element;\n\n  name = name.trim();\n\n  if (name.charAt(0) === '<') {\n    element = parse(name).firstChild;\n    element = document.importNode(element, true);\n  } else {\n    element = document.createElementNS(ns.svg, name);\n  }\n\n  if (attrs) {\n    attr(element, attrs);\n  }\n\n  return element;\n}\n\n/**\n * Events handling utility\n */\n\nfunction on(node, event, listener, useCapture) {\n  node.addEventListener(event, listener, useCapture);\n}\n\nfunction off(node, event, listener, useCapture) {\n  node.removeEventListener(event, listener, useCapture);\n}\n\n/**\n * Geometry helpers\n */\n\n\n// fake node used to instantiate svg geometry elements\nvar node = null;\n\nfunction getNode() {\n  if (node === null) {\n    node = create('svg');\n  }\n\n  return node;\n}\n\nfunction extend(object, props) {\n  var i, k, keys = Object.keys(props);\n\n  for (i = 0; (k = keys[i]); i++) {\n    object[k] = props[k];\n  }\n\n  return object;\n}\n\n\nfunction createPoint(x, y) {\n  var point = getNode().createSVGPoint();\n\n  switch (arguments.length) {\n  case 0:\n    return point;\n  case 2:\n    x = {\n      x: x,\n      y: y\n    };\n    break;\n  }\n\n  return extend(point, x);\n}\n\n/**\n * Create matrix via args.\n *\n * @example\n *\n * createMatrix({ a: 1, b: 1 });\n * createMatrix();\n * createMatrix(1, 2, 0, 0, 30, 20);\n *\n * @return {SVGMatrix}\n */\nfunction createMatrix(a, b, c, d, e, f) {\n  var matrix = getNode().createSVGMatrix();\n\n  switch (arguments.length) {\n  case 0:\n    return matrix;\n  case 1:\n    return extend(matrix, a);\n  case 6:\n    return extend(matrix, {\n      a: a,\n      b: b,\n      c: c,\n      d: d,\n      e: e,\n      f: f\n    });\n  }\n}\n\nfunction createTransform(matrix) {\n  if (matrix) {\n    return getNode().createSVGTransformFromMatrix(matrix);\n  } else {\n    return getNode().createSVGTransform();\n  }\n}\n\n/**\n * Serialization util\n */\n\nvar TEXT_ENTITIES = /([&<>]{1})/g;\nvar ATTR_ENTITIES = /([&<>\\n\\r\"]{1})/g;\n\nvar ENTITY_REPLACEMENT = {\n  '&': '&amp;',\n  '<': '&lt;',\n  '>': '&gt;',\n  '\"': '\\''\n};\n\nfunction escape(str, pattern) {\n\n  function replaceFn(match, entity) {\n    return ENTITY_REPLACEMENT[entity] || entity;\n  }\n\n  return str.replace(pattern, replaceFn);\n}\n\nfunction serialize(node, output) {\n\n  var i, len, attrMap, attrNode, childNodes;\n\n  switch (node.nodeType) {\n\n  // TEXT\n  case 3:\n\n    // replace special XML characters\n    output.push(escape(node.textContent, TEXT_ENTITIES));\n    break;\n\n  // ELEMENT\n  case 1:\n    output.push('<', node.tagName);\n\n    if (node.hasAttributes()) {\n      attrMap = node.attributes;\n      for (i = 0, len = attrMap.length; i < len; ++i) {\n        attrNode = attrMap.item(i);\n        output.push(' ', attrNode.name, '=\"', escape(attrNode.value, ATTR_ENTITIES), '\"');\n      }\n    }\n\n    if (node.hasChildNodes()) {\n      output.push('>');\n      childNodes = node.childNodes;\n      for (i = 0, len = childNodes.length; i < len; ++i) {\n        serialize(childNodes.item(i), output);\n      }\n      output.push('</', node.tagName, '>');\n    } else {\n      output.push('/>');\n    }\n    break;\n\n  // COMMENT\n  case 8:\n    output.push('<!--', escape(node.nodeValue, TEXT_ENTITIES), '-->');\n    break;\n\n  // CDATA\n  case 4:\n    output.push('<![CDATA[', node.nodeValue, ']]>');\n    break;\n\n  default:\n    throw new Error('unable to handle node ' + node.nodeType);\n  }\n\n  return output;\n}\n\n/**\n * innerHTML like functionality for SVG elements.\n * based on innerSVG (https://code.google.com/p/innersvg)\n */\n\n\n\nfunction set(element, svg) {\n\n  var parsed = parse(svg);\n\n  // clear element contents\n  clear(element);\n\n  if (!svg) {\n    return;\n  }\n\n  if (!isFragment(parsed)) {\n\n    // extract <svg> from parsed document\n    parsed = parsed.documentElement;\n  }\n\n  var nodes = slice(parsed.childNodes);\n\n  // import + append each node\n  for (var i = 0; i < nodes.length; i++) {\n    appendTo(nodes[i], element);\n  }\n\n}\n\nfunction get(element) {\n  var child = element.firstChild,\n      output = [];\n\n  while (child) {\n    serialize(child, output);\n    child = child.nextSibling;\n  }\n\n  return output.join('');\n}\n\nfunction isFragment(node) {\n  return node.nodeName === '#document-fragment';\n}\n\nfunction innerSVG(element, svg) {\n\n  if (svg !== undefined) {\n\n    try {\n      set(element, svg);\n    } catch (e) {\n      throw new Error('error parsing SVG: ' + e.message);\n    }\n\n    return element;\n  } else {\n    return get(element);\n  }\n}\n\n\nfunction slice(arr) {\n  return Array.prototype.slice.call(arr);\n}\n\n/**\n * Selection utilities\n */\n\nfunction select(node, selector) {\n  return node.querySelector(selector);\n}\n\nfunction selectAll(node, selector) {\n  var nodes = node.querySelectorAll(selector);\n\n  return [].map.call(nodes, function(element) {\n    return element;\n  });\n}\n\n/**\n * prependTo utility\n */\n\n\n/**\n * Prepend a node to a target element and return the prepended node.\n *\n * @param  {SVGElement} node\n * @param  {SVGElement} target\n *\n * @return {SVGElement} the prepended node\n */\nfunction prependTo(node, target) {\n  return target.insertBefore(ensureImported(node, target), target.firstChild || null);\n}\n\n/**\n * prepend utility\n */\n\n\n/**\n * Prepend a node to a target element\n *\n * @param  {SVGElement} target\n * @param  {SVGElement} node\n *\n * @return {SVGElement} the target element\n */\nfunction prepend(target, node) {\n  prependTo(node, target);\n  return target;\n}\n\nfunction remove(element) {\n  var parent = element.parentNode;\n\n  if (parent) {\n    parent.removeChild(element);\n  }\n\n  return element;\n}\n\n/**\n * Replace utility\n */\n\n\nfunction replace(element, replacement) {\n  element.parentNode.replaceChild(ensureImported(replacement, element), element);\n  return replacement;\n}\n\n/**\n * transform accessor utility\n */\n\nfunction wrapMatrix(transformList, transform) {\n  if (transform instanceof SVGMatrix) {\n    return transformList.createSVGTransformFromMatrix(transform);\n  }\n\n  return transform;\n}\n\n\nfunction setTransforms(transformList, transforms) {\n  var i, t;\n\n  transformList.clear();\n\n  for (i = 0; (t = transforms[i]); i++) {\n    transformList.appendItem(wrapMatrix(transformList, t));\n  }\n}\n\n/**\n * Get or set the transforms on the given node.\n *\n * @param {SVGElement} node\n * @param  {SVGTransform|SVGMatrix|Array<SVGTransform|SVGMatrix>} [transforms]\n *\n * @return {SVGTransform} the consolidated transform\n */\nfunction transform(node, transforms) {\n  var transformList = node.transform.baseVal;\n\n  if (transforms) {\n\n    if (!Array.isArray(transforms)) {\n      transforms = [ transforms ];\n    }\n\n    setTransforms(transformList, transforms);\n  }\n\n  return transformList.consolidate();\n}\n\nexport { append, appendTo, attr, classes, clear, clone, create, createMatrix, createPoint, createTransform, innerSVG, off, on, prepend, prependTo, remove, replace, select, selectAll, transform };\n","/**\n * @param {string} str\n *\n * @return {string}\n */\nexport function escapeCSS(str) {\n  return CSS.escape(str);\n}\n\nvar HTML_ESCAPE_MAP = {\n  '&': '&amp;',\n  '<': '&lt;',\n  '>': '&gt;',\n  '\"': '&quot;',\n  '\\'': '&#39;'\n};\n\n/**\n * @param {string} str\n *\n * @return {string}\n */\nexport function escapeHTML(str) {\n  str = '' + str;\n\n  return str && str.replace(/[&<>\"']/g, function(match) {\n    return HTML_ESCAPE_MAP[match];\n  });\n}\n","import inherits from 'inherits-browser';\r\n\r\nimport Viewer from './Viewer';\r\n\r\nimport KeyboardMoveModule from 'diagram-js/lib/navigation/keyboard-move';\r\nimport MoveCanvasModule from 'diagram-js/lib/navigation/movecanvas';\r\nimport ZoomScrollModule from 'diagram-js/lib/navigation/zoomscroll';\r\n\r\n/**\r\n * @typedef { import('./BaseViewer').BaseViewerOptions } BaseViewerOptions\r\n */\r\n\r\n/**\r\n * A viewer with mouse and keyboard navigation features.\r\n *\r\n * @template [ServiceMap=null]\r\n *\r\n * @extends Viewer<ServiceMap>\r\n *\r\n * @param {BaseViewerOptions} [options]\r\n */\r\nexport default function NavigatedViewer(options) {\r\n  Viewer.call(this, options);\r\n}\r\n\r\ninherits(NavigatedViewer, Viewer);\r\n\r\n\r\nNavigatedViewer.prototype._navigationModules = [\r\n  KeyboardMoveModule,\r\n  MoveCanvasModule,\r\n  ZoomScrollModule\r\n];\r\n\r\nNavigatedViewer.prototype._modules = [].concat(\r\n  Viewer.prototype._modules,\r\n  NavigatedViewer.prototype._navigationModules\r\n);","import {\n  every\n} from 'min-dash';\n\n/**\n * @typedef {import('../util/Types').Axis} Axis\n * @typedef {import('../util/Types').Point} Point\n * @typedef {import('../util/Types').Rect} Rect\n */\n\n/**\n * Computes the distance between two points.\n *\n * @param {Point} a\n * @param {Point} b\n *\n * @return {number} The distance between the two points.\n */\nexport function pointDistance(a, b) {\n  if (!a || !b) {\n    return -1;\n  }\n\n  return Math.sqrt(\n    Math.pow(a.x - b.x, 2) +\n    Math.pow(a.y - b.y, 2)\n  );\n}\n\n\n/**\n * Returns true if the point r is on the line between p and q.\n *\n * @param {Point} p\n * @param {Point} q\n * @param {Point} r\n * @param {number} [accuracy=5] The accuracy with which to check (lower is better).\n *\n * @return {boolean}\n */\nexport function pointsOnLine(p, q, r, accuracy) {\n\n  if (typeof accuracy === 'undefined') {\n    accuracy = 5;\n  }\n\n  if (!p || !q || !r) {\n    return false;\n  }\n\n  var val = (q.x - p.x) * (r.y - p.y) - (q.y - p.y) * (r.x - p.x),\n      dist = pointDistance(p, q);\n\n  // @see http://stackoverflow.com/a/907491/412190\n  return Math.abs(val / dist) <= accuracy;\n}\n\n\nvar ALIGNED_THRESHOLD = 2;\n\n/**\n * Check whether two points are horizontally or vertically aligned.\n *\n * @param {Point[]|Point} a\n * @param {Point} [b]\n *\n * @return {string|boolean} If and how the two points are aligned ('h', 'v' or `false`).\n */\nexport function pointsAligned(a, b) {\n  var points = Array.from(arguments).flat();\n\n  const axisMap = {\n    'x': 'v',\n    'y': 'h'\n  };\n\n  for (const [ axis, orientation ] of Object.entries(axisMap)) {\n    if (pointsAlignedOnAxis(axis, points)) {\n      return orientation;\n    }\n  }\n\n  return false;\n}\n\n/**\n * @param {Axis} axis\n * @param {Point[]} points\n *\n * @return {boolean}\n */\nexport function pointsAlignedOnAxis(axis, points) {\n  const referencePoint = points[0];\n\n  return every(points, function(point) {\n    return Math.abs(referencePoint[axis] - point[axis]) <= ALIGNED_THRESHOLD;\n  });\n}\n\n/**\n * Returns true if the point p is inside the rectangle rect\n *\n * @param {Point} p\n * @param {Rect} rect\n * @param {number} tolerance\n *\n * @return {boolean}\n */\nexport function pointInRect(p, rect, tolerance) {\n  tolerance = tolerance || 0;\n\n  return p.x > rect.x - tolerance &&\n         p.y > rect.y - tolerance &&\n         p.x < rect.x + rect.width + tolerance &&\n         p.y < rect.y + rect.height + tolerance;\n}\n\n/**\n * Returns a point in the middle of points p and q\n *\n * @param {Point} p\n * @param {Point} q\n *\n * @return {Point} The mid point between the two points.\n */\nexport function getMidPoint(p, q) {\n  return {\n    x: Math.round(p.x + ((q.x - p.x) / 2.0)),\n    y: Math.round(p.y + ((q.y - p.y) / 2.0))\n  };\n}\n","import {\r\n  transform as svgTransform,\r\n  createTransform\r\n} from 'tiny-svg';\r\n\r\n\r\n/**\r\n * @param {SVGElement} gfx\r\n * @param {number} x\r\n * @param {number} y\r\n * @param {number} [angle]\r\n * @param {number} [amount]\r\n */\r\nexport function transform(gfx, x, y, angle, amount) {\r\n  var translate = createTransform();\r\n  translate.setTranslate(x, y);\r\n\r\n  var rotate = createTransform();\r\n  rotate.setRotate(angle || 0, 0, 0);\r\n\r\n  var scale = createTransform();\r\n  scale.setScale(amount || 1, amount || 1);\r\n\r\n  svgTransform(gfx, [ translate, rotate, scale ]);\r\n}\r\n\r\n\r\n/**\r\n * @param {SVGElement} gfx\r\n * @param {number} x\r\n * @param {number} y\r\n */\r\nexport function translate(gfx, x, y) {\r\n  var translate = createTransform();\r\n  translate.setTranslate(x, y);\r\n\r\n  svgTransform(gfx, translate);\r\n}\r\n\r\n\r\n/**\r\n * @param {SVGElement} gfx\r\n * @param {number} angle\r\n */\r\nexport function rotate(gfx, angle) {\r\n  var rotate = createTransform();\r\n  rotate.setRotate(angle, 0, 0);\r\n\r\n  svgTransform(gfx, rotate);\r\n}\r\n\r\n\r\n/**\r\n * @param {SVGElement} gfx\r\n * @param {number} amount\r\n */\r\nexport function scale(gfx, amount) {\r\n  var scale = createTransform();\r\n  scale.setScale(amount, amount);\r\n\r\n  svgTransform(gfx, scale);\r\n}\r\n","import translate from './translate';\n\n\n/**\n * @type { import('didi').ModuleDeclaration }\n */\nexport default {\n  translate: [ 'value', translate ]\n};","/**\n * @typedef { {\n *   [key: string]: string;\n * } } TranslateReplacements\n */\n\n/**\n * A simple translation stub to be used for multi-language support\n * in diagrams. Can be easily replaced with a more sophisticated\n * solution.\n *\n * @example\n *\n * ```javascript\n * // use it inside any diagram component by injecting `translate`.\n *\n * function MyService(translate) {\n *   alert(translate('HELLO {you}', { you: 'You!' }));\n * }\n * ```\n *\n * @param {string} template to interpolate\n * @param {TranslateReplacements} [replacements] a map with substitutes\n *\n * @return {string} the translated string\n */\nexport default function translate(template, replacements) {\n\n  replacements = replacements || {};\n\n  return template.replace(/{([^}]+)}/g, function(_, key) {\n    return replacements[key] || '{' + key + '}';\n  });\n}","import {\r\n  has\r\n} from 'min-dash';\r\n\r\n/**\r\n * @typedef {import('../model/Types').ModdleElement} ModdleElement\r\n */\r\n\r\n\r\n// TODO(nikku): remove with future bpmn-js version\r\n\r\nvar DI_ERROR_MESSAGE = 'Tried to access di from the businessObject. The di is available through the diagram element only. For more information, see https://github.com/bpmn-io/bpmn-js/issues/1472';\r\n\r\n/**\r\n * @private\r\n *\r\n * @param {ModdleElement} businessObject\r\n */\r\nexport function ensureCompatDiRef(businessObject) {\r\n\r\n  // bpmnElement can have multiple independent DIs\r\n  if (!has(businessObject, 'di')) {\r\n    Object.defineProperty(businessObject, 'di', {\r\n      enumerable: false,\r\n      get: function() {\r\n        throw new Error(DI_ERROR_MESSAGE);\r\n      }\r\n    });\r\n  }\r\n}","import {\n  isArray,\n  forEach\n} from 'min-dash';\n\n/**\n * @typedef {import('../../core/Canvas').default} Canvas\n * @typedef {import('../../core/EventBus').default} EventBus\n */\n\n/**\n * A service that offers the current selection in a diagram.\n * Offers the api to control the selection, too.\n *\n * @param {EventBus} eventBus\n * @param {Canvas} canvas\n */\nexport default function Selection(eventBus, canvas) {\n\n  this._eventBus = eventBus;\n  this._canvas = canvas;\n\n  /**\n   * @type {Object[]}\n   */\n  this._selectedElements = [];\n\n  var self = this;\n\n  eventBus.on([ 'shape.remove', 'connection.remove' ], function(e) {\n    var element = e.element;\n    self.deselect(element);\n  });\n\n  eventBus.on([ 'diagram.clear', 'root.set' ], function(e) {\n    self.select(null);\n  });\n}\n\nSelection.$inject = [ 'eventBus', 'canvas' ];\n\n/**\n * Deselect an element.\n *\n * @param {Object} element The element to deselect.\n */\nSelection.prototype.deselect = function(element) {\n  var selectedElements = this._selectedElements;\n\n  var idx = selectedElements.indexOf(element);\n\n  if (idx !== -1) {\n    var oldSelection = selectedElements.slice();\n\n    selectedElements.splice(idx, 1);\n\n    this._eventBus.fire('selection.changed', { oldSelection: oldSelection, newSelection: selectedElements });\n  }\n};\n\n/**\n * Get the selected elements.\n *\n * @return {Object[]} The selected elements.\n */\nSelection.prototype.get = function() {\n  return this._selectedElements;\n};\n\n/**\n * Check whether an element is selected.\n *\n * @param {Object} element The element.\n *\n * @return {boolean} Whether the element is selected.\n */\nSelection.prototype.isSelected = function(element) {\n  return this._selectedElements.indexOf(element) !== -1;\n};\n\n\n/**\n * Select one or many elements.\n *\n * @param {Object|Object[]} elements The element(s) to select.\n * @param {boolean} [add] Whether to add the element(s) to the selected elements.\n * Defaults to `false`.\n */\nSelection.prototype.select = function(elements, add) {\n  var selectedElements = this._selectedElements,\n      oldSelection = selectedElements.slice();\n\n  if (!isArray(elements)) {\n    elements = elements ? [ elements ] : [];\n  }\n\n  var canvas = this._canvas;\n\n  var rootElement = canvas.getRootElement();\n\n  elements = elements.filter(function(element) {\n    var elementRoot = canvas.findRoot(element);\n\n    return rootElement === elementRoot;\n  });\n\n  // selection may be cleared by passing an empty array or null\n  // to the method\n  if (add) {\n    forEach(elements, function(element) {\n      if (selectedElements.indexOf(element) !== -1) {\n\n        // already selected\n        return;\n      } else {\n        selectedElements.push(element);\n      }\n    });\n  } else {\n    this._selectedElements = selectedElements = elements.slice();\n  }\n\n  this._eventBus.fire('selection.changed', { oldSelection: oldSelection, newSelection: selectedElements });\n};\n","import {\n  forEach\n} from 'min-dash';\n\n/**\n * @typedef {import('../../core/Canvas').default} Canvas\n * @typedef {import('../../core/EventBus').default} EventBus\n */\n\nvar MARKER_HOVER = 'hover',\n    MARKER_SELECTED = 'selected';\n\n/**\n * A plugin that adds a visible selection UI to shapes and connections\n * by appending the <code>hover</code> and <code>selected</code> classes to them.\n *\n * @class\n *\n * Makes elements selectable, too.\n *\n * @param {Canvas} canvas\n * @param {EventBus} eventBus\n */\nexport default function SelectionVisuals(canvas, eventBus) {\n  this._canvas = canvas;\n\n  function addMarker(e, cls) {\n    canvas.addMarker(e, cls);\n  }\n\n  function removeMarker(e, cls) {\n    canvas.removeMarker(e, cls);\n  }\n\n  eventBus.on('element.hover', function(event) {\n    addMarker(event.element, MARKER_HOVER);\n  });\n\n  eventBus.on('element.out', function(event) {\n    removeMarker(event.element, MARKER_HOVER);\n  });\n\n  eventBus.on('selection.changed', function(event) {\n\n    function deselect(s) {\n      removeMarker(s, MARKER_SELECTED);\n    }\n\n    function select(s) {\n      addMarker(s, MARKER_SELECTED);\n    }\n\n    var oldSelection = event.oldSelection,\n        newSelection = event.newSelection;\n\n    forEach(oldSelection, function(e) {\n      if (newSelection.indexOf(e) === -1) {\n        deselect(e);\n      }\n    });\n\n    forEach(newSelection, function(e) {\n      if (oldSelection.indexOf(e) === -1) {\n        select(e);\n      }\n    });\n  });\n}\n\nSelectionVisuals.$inject = [\n  'canvas',\n  'eventBus'\n];\n","import {\n  hasSecondaryModifier,\n  isPrimaryButton\n} from '../../util/Mouse';\n\nimport {\n  find,\n  isArray\n} from 'min-dash';\n\n/**\n * @typedef {import('../../core/Canvas').default} Canvas\n * @typedef {import('../../core/ElementRegistry').default} ElementRegistry\n * @typedef {import('../../core/EventBus').default} EventBus\n * @typedef {import('./Selection').default} Selection\n */\n\n/**\n * @param {EventBus} eventBus\n * @param {Selection} selection\n * @param {Canvas} canvas\n * @param {ElementRegistry} elementRegistry\n */\nexport default function SelectionBehavior(eventBus, selection, canvas, elementRegistry) {\n\n  // Select elements on create\n  eventBus.on('create.end', 500, function(event) {\n    var context = event.context,\n        canExecute = context.canExecute,\n        elements = context.elements,\n        hints = context.hints || {},\n        autoSelect = hints.autoSelect;\n\n    if (canExecute) {\n      if (autoSelect === false) {\n\n        // Select no elements\n        return;\n      }\n\n      if (isArray(autoSelect)) {\n        selection.select(autoSelect);\n      } else {\n\n        // Select all elements by default\n        selection.select(elements.filter(isShown));\n      }\n    }\n  });\n\n  // Select connection targets on connect\n  eventBus.on('connect.end', 500, function(event) {\n    var context = event.context,\n        connection = context.connection;\n\n    if (connection) {\n      selection.select(connection);\n    }\n  });\n\n  // Select shapes on move\n  eventBus.on('shape.move.end', 500, function(event) {\n    var previousSelection = event.previousSelection || [];\n\n    var shape = elementRegistry.get(event.context.shape.id);\n\n    // Always select main shape on move\n    var isSelected = find(previousSelection, function(selectedShape) {\n      return shape.id === selectedShape.id;\n    });\n\n    if (!isSelected) {\n      selection.select(shape);\n    }\n  });\n\n  // Select elements on click\n  eventBus.on('element.click', function(event) {\n\n    if (!isPrimaryButton(event)) {\n      return;\n    }\n\n    var element = event.element;\n\n    if (element === canvas.getRootElement()) {\n      element = null;\n    }\n\n    var isSelected = selection.isSelected(element),\n        isMultiSelect = selection.get().length > 1;\n\n    // Add to selection if SHIFT pressed\n    var add = hasSecondaryModifier(event);\n\n    if (isSelected && isMultiSelect) {\n      if (add) {\n\n        // Deselect element\n        return selection.deselect(element);\n      } else {\n\n        // Select element only\n        return selection.select(element);\n      }\n    } else if (!isSelected) {\n\n      // Select element\n      selection.select(element, add);\n    } else {\n\n      // Deselect element\n      selection.deselect(element);\n    }\n  });\n}\n\nSelectionBehavior.$inject = [\n  'eventBus',\n  'selection',\n  'canvas',\n  'elementRegistry'\n];\n\n\nfunction isShown(element) {\n  return !element.hidden;\n}\n","import InteractionEventsModule from '../interaction-events';\n\nimport Selection from './Selection';\nimport SelectionVisuals from './SelectionVisuals';\nimport SelectionBehavior from './SelectionBehavior';\n\n\n/**\n * @type { import('didi').ModuleDeclaration }\n */\nexport default {\n  __init__: [ 'selectionVisuals', 'selectionBehavior' ],\n  __depends__: [\n    InteractionEventsModule,\n  ],\n  selection: [ 'type', Selection ],\n  selectionVisuals: [ 'type', SelectionVisuals ],\n  selectionBehavior: [ 'type', SelectionBehavior ]\n};\n","/**\n * Get the logarithm of x with base 10.\n *\n * @param {number} x\n */\nexport function log10(x) {\n  return Math.log(x) / Math.log(10);\n}\n\nexport { delta as substract } from './PositionUtil';\n","import {\n  log10\n} from '../../util/Math';\n\n/**\n * Get step size for given range and number of steps.\n *\n * @param {Object} range\n * @param {number} range.min\n * @param {number} range.max\n * @param {number} steps\n */\nexport function getStepSize(range, steps) {\n\n  var minLinearRange = log10(range.min),\n      maxLinearRange = log10(range.max);\n\n  var absoluteLinearRange = Math.abs(minLinearRange) + Math.abs(maxLinearRange);\n\n  return absoluteLinearRange / steps;\n}\n\n/**\n * @param {Object} range\n * @param {number} range.min\n * @param {number} range.max\n * @param {number} scale\n */\nexport function cap(range, scale) {\n  return Math.max(range.min, Math.min(range.max, scale));\n}\n","import {\n  event as domEvent\n} from 'min-dom';\n\nimport {\n  getStepSize,\n  cap\n} from './ZoomUtil';\n\nimport {\n  log10\n} from '../../util/Math';\n\nimport {\n  isMac\n} from '../../util/Platform';\n\nimport {\n  bind\n} from 'min-dash';\n\n/**\n * @typedef {import('../../core/Canvas').default} Canvas\n * @typedef {import('../../core/EventBus').default} EventBus\n *\n * @typedef {import('../../util/Types').Point} Point\n * @typedef {import('../../util/Types').ScrollDelta} ScrollDelta\n */\n\nvar sign = Math.sign || function(n) {\n  return n >= 0 ? 1 : -1;\n};\n\nvar RANGE = { min: 0.2, max: 4 },\n    NUM_STEPS = 10;\n\nvar DELTA_THRESHOLD = 0.1;\n\nvar DEFAULT_SCALE = 0.75;\n\n/**\n * An implementation of zooming and scrolling within the\n * {@link Canvas} via the mouse wheel.\n *\n * Mouse wheel zooming / scrolling may be disabled using\n * the {@link toggle(enabled)} method.\n *\n * @param {Object} [config]\n * @param {boolean} [config.enabled=true] default enabled state\n * @param {number} [config.scale=.75] scroll sensivity\n * @param {EventBus} eventBus\n * @param {Canvas} canvas\n */\nexport default function ZoomScroll(config, eventBus, canvas) {\n\n  config = config || {};\n\n  this._enabled = false;\n\n  this._canvas = canvas;\n  this._container = canvas._container;\n\n  this._handleWheel = bind(this._handleWheel, this);\n\n  this._totalDelta = 0;\n  this._scale = config.scale || DEFAULT_SCALE;\n\n  var self = this;\n\n  eventBus.on('canvas.focus.changed', function(event) {\n    self._init(event.focused && config.enabled !== false);\n  });\n}\n\nZoomScroll.$inject = [\n  'config.zoomScroll',\n  'eventBus',\n  'canvas'\n];\n\n/**\n * @param {ScrollDelta} delta\n */\nZoomScroll.prototype.scroll = function scroll(delta) {\n  this._canvas.scroll(delta);\n};\n\n\nZoomScroll.prototype.reset = function reset() {\n  this._canvas.zoom('fit-viewport');\n};\n\n/**\n * Zoom depending on delta.\n *\n * @param {number} delta\n * @param {Point} position\n */\nZoomScroll.prototype.zoom = function zoom(delta, position) {\n\n  // zoom with half the step size of stepZoom\n  var stepSize = getStepSize(RANGE, NUM_STEPS * 2);\n\n  // add until threshold reached\n  this._totalDelta += delta;\n\n  if (Math.abs(this._totalDelta) > DELTA_THRESHOLD) {\n    this._zoom(delta, position, stepSize);\n\n    // reset\n    this._totalDelta = 0;\n  }\n};\n\n\nZoomScroll.prototype._handleWheel = function handleWheel(event) {\n\n  if (!this._canvas.isFocused()) {\n    return;\n  }\n\n  var element = this._container;\n\n  event.preventDefault();\n\n  // pinch to zoom is mapped to wheel + ctrlKey = true\n  // in modern browsers (!)\n\n  var isZoom = event.ctrlKey || (isMac() && event.metaKey);\n\n  var isHorizontalScroll = event.shiftKey;\n\n  var factor = -1 * this._scale,\n      delta;\n\n  if (isZoom) {\n    factor *= event.deltaMode === 0 ? 0.020 : 0.32;\n  } else {\n    factor *= event.deltaMode === 0 ? 1.0 : 16.0;\n  }\n\n  if (isZoom) {\n    var elementRect = element.getBoundingClientRect();\n\n    var offset = {\n      x: event.clientX - elementRect.left,\n      y: event.clientY - elementRect.top\n    };\n\n    delta = (\n      Math.sqrt(\n        Math.pow(event.deltaY, 2) +\n        Math.pow(event.deltaX, 2)\n      ) * sign(event.deltaY) * factor\n    );\n\n    // zoom in relative to diagram {x,y} coordinates\n    this.zoom(delta, offset);\n  } else {\n\n    if (isHorizontalScroll) {\n      delta = {\n        dx: factor * event.deltaY,\n        dy: 0\n      };\n    } else {\n      delta = {\n        dx: factor * event.deltaX,\n        dy: factor * event.deltaY\n      };\n    }\n\n    this.scroll(delta);\n  }\n};\n\n/**\n * Zoom with fixed step size.\n *\n * @param {number} delta Zoom delta (1 for zooming in, -1 for zooming out).\n * @param {Point} [position]\n */\nZoomScroll.prototype.stepZoom = function stepZoom(delta, position) {\n\n  var stepSize = getStepSize(RANGE, NUM_STEPS);\n\n  this._zoom(delta, position, stepSize);\n};\n\n\n/**\n * Zoom in/out given a step size.\n *\n * @param {number} delta\n * @param {Point} [position]\n * @param {number} stepSize\n */\nZoomScroll.prototype._zoom = function(delta, position, stepSize) {\n  var canvas = this._canvas;\n\n  var direction = delta > 0 ? 1 : -1;\n\n  var currentLinearZoomLevel = log10(canvas.zoom());\n\n  // snap to a proximate zoom step\n  var newLinearZoomLevel = Math.round(currentLinearZoomLevel / stepSize) * stepSize;\n\n  // increase or decrease one zoom step in the given direction\n  newLinearZoomLevel += stepSize * direction;\n\n  // calculate the absolute logarithmic zoom level based on the linear zoom level\n  // (e.g. 2 for an absolute x2 zoom)\n  var newLogZoomLevel = Math.pow(10, newLinearZoomLevel);\n\n  canvas.zoom(cap(RANGE, newLogZoomLevel), position);\n};\n\n\n/**\n * Toggle the zoom scroll ability via mouse wheel.\n *\n * @param {boolean} [newEnabled] new enabled state\n */\nZoomScroll.prototype.toggle = function toggle(newEnabled) {\n\n  var element = this._container;\n  var handleWheel = this._handleWheel;\n\n  var oldEnabled = this._enabled;\n\n  if (typeof newEnabled === 'undefined') {\n    newEnabled = !oldEnabled;\n  }\n\n  // only react on actual changes\n  if (oldEnabled !== newEnabled) {\n\n    // add or remove wheel listener based on\n    // changed enabled state\n    domEvent[newEnabled ? 'bind' : 'unbind'](element, 'wheel', handleWheel, false);\n  }\n\n  this._enabled = newEnabled;\n\n  return newEnabled;\n};\n\n\nZoomScroll.prototype._init = function(newEnabled) {\n  this.toggle(newEnabled);\n};\n","import ZoomScroll from './ZoomScroll';\n\n\n/**\n * @type { import('didi').ModuleDeclaration }\n */\nexport default {\n  __init__: [ 'zoomScroll' ],\n  zoomScroll: [ 'type', ZoomScroll ]\n};","import { isArray } from 'min-dash';\r\n\r\nexport var KEYS_COPY = [ 'c', 'C' ];\r\nexport var KEYS_PASTE = [ 'v', 'V' ];\r\nexport var KEYS_REDO = [ 'y', 'Y' ];\r\nexport var KEYS_UNDO = [ 'z', 'Z' ];\r\n\r\n/**\r\n * Returns true if event was triggered with any modifier\r\n * @param {KeyboardEvent} event\r\n */\r\nexport function hasModifier(event) {\r\n  return (event.ctrlKey || event.metaKey || event.shiftKey || event.altKey);\r\n}\r\n\r\n/**\r\n * @param {KeyboardEvent} event\r\n * @return {boolean}\r\n */\r\nexport function isCmd(event) {\r\n\r\n  // ensure we don't react to AltGr\r\n  // (mapped to CTRL + ALT)\r\n  if (event.altKey) {\r\n    return false;\r\n  }\r\n\r\n  return event.ctrlKey || event.metaKey;\r\n}\r\n\r\n/**\r\n * Checks if key pressed is one of provided keys.\r\n *\r\n * @param {string|string[]} keys\r\n * @param {KeyboardEvent} event\r\n * @return {boolean}\r\n */\r\nexport function isKey(keys, event) {\r\n  keys = isArray(keys) ? keys : [ keys ];\r\n\r\n  return keys.indexOf(event.key) !== -1 || keys.indexOf(event.code) !== -1;\r\n}\r\n\r\n/**\r\n * @param {KeyboardEvent} event\r\n */\r\nexport function isShift(event) {\r\n  return event.shiftKey;\r\n}\r\n\r\n/**\r\n * @param {KeyboardEvent} event\r\n */\r\nexport function isCopy(event) {\r\n  return isCmd(event) && isKey(KEYS_COPY, event);\r\n}\r\n\r\n/**\r\n * @param {KeyboardEvent} event\r\n */\r\nexport function isPaste(event) {\r\n  return isCmd(event) && isKey(KEYS_PASTE, event);\r\n}\r\n\r\n/**\r\n * @param {KeyboardEvent} event\r\n */\r\nexport function isUndo(event) {\r\n  return isCmd(event) && !isShift(event) && isKey(KEYS_UNDO, event);\r\n}\r\n\r\n/**\r\n * @param {KeyboardEvent} event\r\n */\r\nexport function isRedo(event) {\r\n  return isCmd(event) && (\r\n    isKey(KEYS_REDO, event) || (\r\n      isKey(KEYS_UNDO, event) && isShift(event)\r\n    )\r\n  );\r\n}\r\n","import {\r\n  is,\r\n  getBusinessObject,\r\n  getDi\r\n} from './ModelUtil';\r\n\r\nimport {\r\n  some\r\n} from 'min-dash';\r\n\r\n/**\r\n * @typedef {import('../model/Types').Element} Element\r\n * @typedef {import('../model/Types').ModdleElement} ModdleElement\r\n */\r\n\r\n/**\r\n * @param {Element} element\r\n * @param {ModdleElement} [di]\r\n *\r\n * @return {boolean}\r\n */\r\nexport function isExpanded(element, di) {\r\n\r\n  if (is(element, 'bpmn:CallActivity')) {\r\n    return false;\r\n  }\r\n\r\n  if (is(element, 'bpmn:SubProcess')) {\r\n    di = di || getDi(element);\r\n\r\n    if (di && is(di, 'bpmndi:BPMNPlane')) {\r\n      return true;\r\n    }\r\n\r\n    return di && !!di.isExpanded;\r\n  }\r\n\r\n  if (is(element, 'bpmn:Participant')) {\r\n    return !!getBusinessObject(element).processRef;\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\n/**\r\n * @param {Element} element\r\n *\r\n * @return {boolean}\r\n */\r\nexport function isHorizontal(element) {\r\n\r\n  if (!is(element, 'bpmn:Participant') && !is(element, 'bpmn:Lane')) {\r\n    return undefined;\r\n  }\r\n\r\n  var isHorizontal = getDi(element).isHorizontal;\r\n\r\n  if (isHorizontal === undefined) {\r\n    return true;\r\n  }\r\n\r\n  return isHorizontal;\r\n}\r\n\r\n/**\r\n * @param {Element} element\r\n *\r\n * @return {boolean}\r\n */\r\nexport function isInterrupting(element) {\r\n  return element && getBusinessObject(element).isInterrupting !== false;\r\n}\r\n\r\n/**\r\n * @param {Element} element\r\n *\r\n * @return {boolean}\r\n */\r\nexport function isEventSubProcess(element) {\r\n  return element && !!getBusinessObject(element).triggeredByEvent;\r\n}\r\n\r\n/**\r\n * @param {Element} element\r\n * @param {string} eventType\r\n *\r\n * @return {boolean}\r\n */\r\nexport function hasEventDefinition(element, eventType) {\r\n  var eventDefinitions = getBusinessObject(element).eventDefinitions;\r\n\r\n  return some(eventDefinitions, function(event) {\r\n    return is(event, eventType);\r\n  });\r\n}\r\n\r\n/**\r\n * @param {Element} element\r\n *\r\n * @return {boolean}\r\n */\r\nexport function hasErrorEventDefinition(element) {\r\n  return hasEventDefinition(element, 'bpmn:ErrorEventDefinition');\r\n}\r\n\r\n/**\r\n * @param {Element} element\r\n *\r\n * @return {boolean}\r\n */\r\nexport function hasEscalationEventDefinition(element) {\r\n  return hasEventDefinition(element, 'bpmn:EscalationEventDefinition');\r\n}\r\n\r\n/**\r\n * @param {Element} element\r\n *\r\n * @return {boolean}\r\n */\r\nexport function hasCompensateEventDefinition(element) {\r\n  return hasEventDefinition(element, 'bpmn:CompensateEventDefinition');\r\n}\r\n","/**\n * Util that provides unique IDs.\n *\n * @class\n * @constructor\n *\n * The ids can be customized via a given prefix and contain a random value to avoid collisions.\n *\n * @param {string} [prefix] a prefix to prepend to generated ids (for better readability)\n */\nexport default function IdGenerator(prefix) {\n\n  this._counter = 0;\n  this._prefix = (prefix ? prefix + '-' : '') + Math.floor(Math.random() * 1000000000) + '-';\n}\n\n/**\n * Returns a next unique ID.\n *\n * @return {string} the id\n */\nIdGenerator.prototype.next = function() {\n  return this._prefix + (++this._counter);\n};\n","/**\n * @typedef {import('../util/Types').Point} Point\n * @typedef {import('../util/Types').Rect} Rect\n */\n\n/**\n * @param {Rect} bounds\n * @return {Point}\n */\nexport function center(bounds) {\n  return {\n    x: bounds.x + (bounds.width / 2),\n    y: bounds.y + (bounds.height / 2)\n  };\n}\n\n\n/**\n * @param {Point} a\n * @param {Point} b\n * @return {Point}\n */\nexport function delta(a, b) {\n  return {\n    x: a.x - b.x,\n    y: a.y - b.y\n  };\n}\n","import {\n  isArray,\n  isString,\n  isObject,\n  assign,\n  forEach,\n  find,\n  filter,\n  matchPattern,\n  isDefined\n} from 'min-dash';\n\nimport {\n  assignStyle,\n  domify,\n  classes as domClasses,\n  attr as domAttr,\n  remove as domRemove,\n  clear as domClear\n} from 'min-dom';\n\nimport {\n  getBBox\n} from '../../util/Elements';\n\nimport Ids from '../../util/IdGenerator';\n\n// document wide unique overlay ids\nvar ids = new Ids('ov');\n\nvar LOW_PRIORITY = 500;\n\n/**\n * @typedef {import('../../core/Canvas').default} Canvas\n * @typedef {import('../../core/ElementRegistry').default} ElementRegistry\n * @typedef {import('../../core/EventBus').default} EventBus\n *\n * @typedef {import('../../model/Types').Element} Element\n *\n * @typedef { {\n *   minZoom?: number,\n *   maxZoom?: number\n * } } OverlaysConfigShow\n *\n * @typedef { {\n *   min?: number,\n *   max?: number\n * } } OverlaysConfigScale\n *\n * @typedef { {\n*   id: string,\n*   type: string | null,\n*   element: Element | string\n* } & OverlayAttrs } Overlay\n*\n * @typedef { {\n *   html: HTMLElement | string,\n *   position: {\n *     top?: number,\n *     right?: number,\n *     bottom?: number,\n *     left?: number\n *   }\n * } & OverlaysConfigDefault } OverlayAttrs\n *\n * @typedef { {\n *   html: HTMLElement,\n *   element: Element,\n *   overlays: Overlay[]\n * } } OverlayContainer\n *\n * @typedef {{\n *   defaults?: OverlaysConfigDefault\n * }} OverlaysConfig\n *\n * @typedef { {\n *  show?: OverlaysConfigShow,\n *  scale?: OverlaysConfigScale | boolean\n * } } OverlaysConfigDefault\n *\n * @typedef { {\n *   id?: string;\n *   element?: Element | string;\n *   type?: string;\n * } | string } OverlaysFilter\n */\n\n/**\n * A service that allows users to attach overlays to diagram elements.\n *\n * The overlay service will take care of overlay positioning during updates.\n *\n * @example\n *\n * ```javascript\n * // add a pink badge on the top left of the shape\n *\n * overlays.add(someShape, {\n *   position: {\n *     top: -5,\n *     left: -5\n *   },\n *   html: '<div style=\"width: 10px; background: fuchsia; color: white;\">0</div>'\n * });\n *\n * // or add via shape id\n *\n * overlays.add('some-element-id', {\n *   position: {\n *     top: -5,\n *     left: -5\n *   }\n *   html: '<div style=\"width: 10px; background: fuchsia; color: white;\">0</div>'\n * });\n *\n * // or add with optional type\n *\n * overlays.add(someShape, 'badge', {\n *   position: {\n *     top: -5,\n *     left: -5\n *   }\n *   html: '<div style=\"width: 10px; background: fuchsia; color: white;\">0</div>'\n * });\n * ```\n *\n * ```javascript\n * // remove an overlay\n *\n * var id = overlays.add(...);\n * overlays.remove(id);\n *\n *\n * You may configure overlay defaults during tool by providing a `config` module\n * with `overlays.defaults` as an entry:\n *\n * {\n *   overlays: {\n *     defaults: {\n *       show: {\n *         minZoom: 0.7,\n *         maxZoom: 5.0\n *       },\n *       scale: {\n *         min: 1\n *       }\n *     }\n * }\n * ```\n *\n * @param {OverlaysConfig} config\n * @param {EventBus} eventBus\n * @param {Canvas} canvas\n * @param {ElementRegistry} elementRegistry\n */\nexport default function Overlays(config, eventBus, canvas, elementRegistry) {\n  this._eventBus = eventBus;\n  this._canvas = canvas;\n  this._elementRegistry = elementRegistry;\n\n  this._ids = ids;\n\n  /**\n   * @type {OverlaysConfigDefault}\n   */\n  this._overlayDefaults = assign({\n\n    // no show constraints\n    show: null,\n\n    // always scale\n    scale: true\n  }, config && config.defaults);\n\n  /**\n   * @type {Record<string, Overlay>}\n   */\n  this._overlays = {};\n\n  /**\n   * @type {OverlayContainer[]}\n   */\n  this._overlayContainers = [];\n\n  /**\n   * @type {HTMLElement}\n   */\n  this._overlayRoot = createRoot(canvas.getContainer());\n\n  this._init();\n}\n\n\nOverlays.$inject = [\n  'config.overlays',\n  'eventBus',\n  'canvas',\n  'elementRegistry'\n];\n\n\n/**\n * Returns the overlay with the specified ID or a list of overlays\n * for an element with a given type.\n *\n * @example\n *\n * ```javascript\n * // return the single overlay with the given ID\n * overlays.get('some-id');\n *\n * // return all overlays for the shape\n * overlays.get({ element: someShape });\n *\n * // return all overlays on shape with type 'badge'\n * overlays.get({ element: someShape, type: 'badge' });\n *\n * // shape can also be specified as ID\n * overlays.get({ element: 'element-id', type: 'badge' });\n * ```\n *\n * @param {OverlaysFilter} search The filter to be used to find the overlay(s).\n *\n * @return {Overlay|Overlay[]} The overlay(s).\n */\nOverlays.prototype.get = function(search) {\n\n  if (isString(search)) {\n    search = { id: search };\n  }\n\n  if (isString(search.element)) {\n    search.element = this._elementRegistry.get(search.element);\n  }\n\n  if (search.element) {\n    var container = this._getOverlayContainer(search.element, true);\n\n    // return a list of overlays when searching by element (+type)\n    if (container) {\n      return search.type ? filter(container.overlays, matchPattern({ type: search.type })) : container.overlays.slice();\n    } else {\n      return [];\n    }\n  } else if (search.type) {\n    return filter(this._overlays, matchPattern({ type: search.type }));\n  } else {\n\n    // return single element when searching by id\n    return search.id ? this._overlays[search.id] : null;\n  }\n};\n\n/**\n * Adds an HTML overlay to an element.\n *\n * @param {Element|string} element The element to add the overlay to.\n * @param {string} [type] An optional type that can be used to filter.\n * @param {OverlayAttrs} overlay The overlay.\n *\n * @return {string} The overlay's ID that can be used to get or remove it.\n */\nOverlays.prototype.add = function(element, type, overlay) {\n\n  if (isObject(type)) {\n    overlay = type;\n    type = null;\n  }\n\n  if (!element.id) {\n    element = this._elementRegistry.get(element);\n  }\n\n  if (!overlay.position) {\n    throw new Error('must specifiy overlay position');\n  }\n\n  if (!overlay.html) {\n    throw new Error('must specifiy overlay html');\n  }\n\n  if (!element) {\n    throw new Error('invalid element specified');\n  }\n\n  var id = this._ids.next();\n\n  overlay = assign({}, this._overlayDefaults, overlay, {\n    id: id,\n    type: type,\n    element: element,\n    html: overlay.html\n  });\n\n  this._addOverlay(overlay);\n\n  return id;\n};\n\n\n/**\n * Remove an overlay with the given ID or all overlays matching the given filter.\n *\n * @see Overlays#get for filter options.\n *\n * @param {OverlaysFilter} filter The filter to be used to find the overlay.\n */\nOverlays.prototype.remove = function(filter) {\n\n  var overlays = this.get(filter) || [];\n\n  if (!isArray(overlays)) {\n    overlays = [ overlays ];\n  }\n\n  var self = this;\n\n  forEach(overlays, function(overlay) {\n\n    var container = self._getOverlayContainer(overlay.element, true);\n\n    if (overlay) {\n      domRemove(overlay.html);\n      domRemove(overlay.htmlContainer);\n\n      delete overlay.htmlContainer;\n      delete overlay.element;\n\n      delete self._overlays[overlay.id];\n    }\n\n    if (container) {\n      var idx = container.overlays.indexOf(overlay);\n      if (idx !== -1) {\n        container.overlays.splice(idx, 1);\n      }\n    }\n  });\n\n};\n\n/**\n * Checks whether overlays are shown.\n *\n * @return {boolean} Whether overlays are shown.\n */\nOverlays.prototype.isShown = function() {\n  return this._overlayRoot.style.display !== 'none';\n};\n\n/**\n * Show all overlays.\n */\nOverlays.prototype.show = function() {\n  setVisible(this._overlayRoot);\n};\n\n/**\n * Hide all overlays.\n */\nOverlays.prototype.hide = function() {\n  setVisible(this._overlayRoot, false);\n};\n\n/**\n * Remove all overlays and their container.\n */\nOverlays.prototype.clear = function() {\n  this._overlays = {};\n\n  this._overlayContainers = [];\n\n  domClear(this._overlayRoot);\n};\n\nOverlays.prototype._updateOverlayContainer = function(container) {\n  var element = container.element,\n      html = container.html;\n\n  // update container left,top according to the elements x,y coordinates\n  // this ensures we can attach child elements relative to this container\n\n  var x = element.x,\n      y = element.y;\n\n  if (element.waypoints) {\n    var bbox = getBBox(element);\n    x = bbox.x;\n    y = bbox.y;\n  }\n\n  setPosition(html, x, y);\n\n  domAttr(container.html, 'data-container-id', element.id);\n};\n\n\nOverlays.prototype._updateOverlay = function(overlay) {\n\n  var position = overlay.position,\n      htmlContainer = overlay.htmlContainer,\n      element = overlay.element;\n\n  // update overlay html relative to shape because\n  // it is already positioned on the element\n\n  // update relative\n  var left = position.left,\n      top = position.top;\n\n  if (position.right !== undefined) {\n\n    var width;\n\n    if (element.waypoints) {\n      width = getBBox(element).width;\n    } else {\n      width = element.width;\n    }\n\n    left = position.right * -1 + width;\n  }\n\n  if (position.bottom !== undefined) {\n\n    var height;\n\n    if (element.waypoints) {\n      height = getBBox(element).height;\n    } else {\n      height = element.height;\n    }\n\n    top = position.bottom * -1 + height;\n  }\n\n  setPosition(htmlContainer, left || 0, top || 0);\n  this._updateOverlayVisibilty(overlay, this._canvas.viewbox());\n};\n\n\nOverlays.prototype._createOverlayContainer = function(element) {\n  var html = domify('<div class=\"djs-overlays\" />');\n  assignStyle(html, { position: 'absolute' });\n\n  this._overlayRoot.appendChild(html);\n\n  var container = {\n    html: html,\n    element: element,\n    overlays: []\n  };\n\n  this._updateOverlayContainer(container);\n\n  this._overlayContainers.push(container);\n\n  return container;\n};\n\n\nOverlays.prototype._updateRoot = function(viewbox) {\n  var scale = viewbox.scale || 1;\n\n  var matrix = 'matrix(' +\n  [\n    scale,\n    0,\n    0,\n    scale,\n    -1 * viewbox.x * scale,\n    -1 * viewbox.y * scale\n  ].join(',') +\n  ')';\n\n  setTransform(this._overlayRoot, matrix);\n};\n\n\nOverlays.prototype._getOverlayContainer = function(element, raw) {\n  var container = find(this._overlayContainers, function(c) {\n    return c.element === element;\n  });\n\n\n  if (!container && !raw) {\n    return this._createOverlayContainer(element);\n  }\n\n  return container;\n};\n\n\nOverlays.prototype._addOverlay = function(overlay) {\n\n  var id = overlay.id,\n      element = overlay.element,\n      html = overlay.html,\n      htmlContainer,\n      overlayContainer;\n\n  // unwrap jquery (for those who need it)\n  if (html.get && html.constructor.prototype.jquery) {\n    html = html.get(0);\n  }\n\n  // create proper html elements from\n  // overlay HTML strings\n  if (isString(html)) {\n    html = domify(html);\n  }\n\n  overlayContainer = this._getOverlayContainer(element);\n\n  htmlContainer = domify('<div class=\"djs-overlay\" data-overlay-id=\"' + id + '\">');\n  assignStyle(htmlContainer, { position: 'absolute' });\n\n  htmlContainer.appendChild(html);\n\n  if (overlay.type) {\n    domClasses(htmlContainer).add('djs-overlay-' + overlay.type);\n  }\n\n  var elementRoot = this._canvas.findRoot(element);\n  var activeRoot = this._canvas.getRootElement();\n\n  setVisible(htmlContainer, elementRoot === activeRoot);\n\n  overlay.htmlContainer = htmlContainer;\n\n  overlayContainer.overlays.push(overlay);\n  overlayContainer.html.appendChild(htmlContainer);\n\n  this._overlays[id] = overlay;\n\n  this._updateOverlay(overlay);\n  this._updateOverlayVisibilty(overlay, this._canvas.viewbox());\n};\n\n\nOverlays.prototype._updateOverlayVisibilty = function(overlay, viewbox) {\n  var show = overlay.show,\n      rootElement = this._canvas.findRoot(overlay.element),\n      minZoom = show && show.minZoom,\n      maxZoom = show && show.maxZoom,\n      htmlContainer = overlay.htmlContainer,\n      activeRootElement = this._canvas.getRootElement(),\n      visible = true;\n\n  if (rootElement !== activeRootElement) {\n    visible = false;\n  } else if (show) {\n    if (\n      (isDefined(minZoom) && minZoom > viewbox.scale) ||\n      (isDefined(maxZoom) && maxZoom < viewbox.scale)\n    ) {\n      visible = false;\n    }\n  }\n\n  setVisible(htmlContainer, visible);\n\n  this._updateOverlayScale(overlay, viewbox);\n};\n\n\nOverlays.prototype._updateOverlayScale = function(overlay, viewbox) {\n  var shouldScale = overlay.scale,\n      minScale,\n      maxScale,\n      htmlContainer = overlay.htmlContainer;\n\n  var scale, transform = '';\n\n  if (shouldScale !== true) {\n\n    if (shouldScale === false) {\n      minScale = 1;\n      maxScale = 1;\n    } else {\n      minScale = shouldScale.min;\n      maxScale = shouldScale.max;\n    }\n\n    if (isDefined(minScale) && viewbox.scale < minScale) {\n      scale = (1 / viewbox.scale || 1) * minScale;\n    }\n\n    if (isDefined(maxScale) && viewbox.scale > maxScale) {\n      scale = (1 / viewbox.scale || 1) * maxScale;\n    }\n  }\n\n  if (isDefined(scale)) {\n    transform = 'scale(' + scale + ',' + scale + ')';\n  }\n\n  setTransform(htmlContainer, transform);\n};\n\n\nOverlays.prototype._updateOverlaysVisibilty = function(viewbox) {\n\n  var self = this;\n\n  forEach(this._overlays, function(overlay) {\n    self._updateOverlayVisibilty(overlay, viewbox);\n  });\n};\n\n\nOverlays.prototype._init = function() {\n\n  var eventBus = this._eventBus;\n\n  var self = this;\n\n\n  // scroll/zoom integration\n\n  function updateViewbox(viewbox) {\n    self._updateRoot(viewbox);\n    self._updateOverlaysVisibilty(viewbox);\n\n    self.show();\n  }\n\n  eventBus.on('canvas.viewbox.changing', function(event) {\n    self.hide();\n  });\n\n  eventBus.on('canvas.viewbox.changed', function(event) {\n    updateViewbox(event.viewbox);\n  });\n\n\n  // remove integration\n\n  eventBus.on([ 'shape.remove', 'connection.remove' ], function(e) {\n    var element = e.element;\n    var overlays = self.get({ element: element });\n\n    forEach(overlays, function(o) {\n      self.remove(o.id);\n    });\n\n    var container = self._getOverlayContainer(element);\n\n    if (container) {\n      domRemove(container.html);\n      var i = self._overlayContainers.indexOf(container);\n      if (i !== -1) {\n        self._overlayContainers.splice(i, 1);\n      }\n    }\n  });\n\n\n  // move integration\n\n  eventBus.on('element.changed', LOW_PRIORITY, function(e) {\n    var element = e.element;\n\n    var container = self._getOverlayContainer(element, true);\n\n    if (container) {\n      forEach(container.overlays, function(overlay) {\n        self._updateOverlay(overlay);\n      });\n\n      self._updateOverlayContainer(container);\n    }\n  });\n\n\n  // marker integration, simply add them on the overlays as classes, too.\n\n  eventBus.on('element.marker.update', function(e) {\n    var container = self._getOverlayContainer(e.element, true);\n    if (container) {\n      domClasses(container.html)[e.add ? 'add' : 'remove'](e.marker);\n    }\n  });\n\n\n  eventBus.on('root.set', function() {\n    self._updateOverlaysVisibilty(self._canvas.viewbox());\n  });\n\n  // clear overlays with diagram\n\n  eventBus.on('diagram.clear', this.clear, this);\n};\n\n\n\n// helpers /////////////////////////////\n\nfunction createRoot(parentNode) {\n  var root = domify(\n    '<div class=\"djs-overlay-container\" />'\n  );\n\n  assignStyle(root, {\n    position: 'absolute',\n    width: 0,\n    height: 0\n  });\n\n  parentNode.insertBefore(root, parentNode.firstChild);\n\n  return root;\n}\n\nfunction setPosition(el, x, y) {\n  assignStyle(el, { left: x + 'px', top: y + 'px' });\n}\n\n/**\n * Set element visible\n *\n * @param {DOMElement} el\n * @param {boolean} [visible=true]\n */\nfunction setVisible(el, visible) {\n  el.style.display = visible === false ? 'none' : '';\n}\n\nfunction setTransform(el, transform) {\n\n  el.style['transform-origin'] = 'top left';\n\n  [ '', '-ms-', '-webkit-' ].forEach(function(prefix) {\n    el.style[prefix + 'transform'] = transform;\n  });\n}","import Overlays from './Overlays';\n\n\n/**\n * @type { import('didi').ModuleDeclaration }\n */\nexport default {\n  __init__: [ 'overlays' ],\n  overlays: [ 'type', Overlays ]\n};","import {\n  assign,\n  filter,\n  find,\n  isArray,\n  isNumber,\n  isObject,\n  isUndefined,\n  groupBy,\n  forEach\n} from 'min-dash';\n\n/**\n * @typedef {import('../model/Types').Connection} Connection\n * @typedef {import('../model/Types').Element} Element\n * @typedef {import('../model/Types').Shape} Shape\n *\n * @typedef {import('../util/Types').Rect} Rect\n *\n * @typedef { {\n *   allShapes: Record<string, Shape>,\n *   allConnections: Record<string, Connection>,\n *   topLevel: Record<string, Element>,\n *   enclosedConnections: Record<string, Connection>,\n *   enclosedElements: Record<string, Element>\n * } } Closure\n */\n\n/**\n * Get parent elements.\n *\n * @param {Element[]} elements\n *\n * @return {Element[]}\n */\nexport function getParents(elements) {\n\n  // find elements that are not children of any other elements\n  return filter(elements, function(element) {\n    return !find(elements, function(e) {\n      return e !== element && getParent(element, e);\n    });\n  });\n}\n\n\nfunction getParent(element, parent) {\n  if (!parent) {\n    return;\n  }\n\n  if (element === parent) {\n    return parent;\n  }\n\n  if (!element.parent) {\n    return;\n  }\n\n  return getParent(element.parent, parent);\n}\n\n\n/**\n * Adds an element to a collection and returns true if the\n * element was added.\n *\n * @param {Object[]} elements\n * @param {Object} element\n * @param {boolean} [unique]\n */\nexport function add(elements, element, unique) {\n  var canAdd = !unique || elements.indexOf(element) === -1;\n\n  if (canAdd) {\n    elements.push(element);\n  }\n\n  return canAdd;\n}\n\n\n/**\n * Iterate over each element in a collection, calling the iterator function `fn`\n * with (element, index, recursionDepth).\n *\n * Recurse into all elements that are returned by `fn`.\n *\n * @param {Element|Element[]} elements\n * @param {(element: Element, index: number, depth: number) => Element[] | boolean | undefined} fn\n * @param {number} [depth] maximum recursion depth\n */\nexport function eachElement(elements, fn, depth) {\n\n  depth = depth || 0;\n\n  if (!isArray(elements)) {\n    elements = [ elements ];\n  }\n\n  forEach(elements, function(s, i) {\n    var filter = fn(s, i, depth);\n\n    if (isArray(filter) && filter.length) {\n      eachElement(filter, fn, depth + 1);\n    }\n  });\n}\n\n\n/**\n * Collects self + child elements up to a given depth from a list of elements.\n *\n * @param {Element|Element[]} elements the elements to select the children from\n * @param {boolean} unique whether to return a unique result set (no duplicates)\n * @param {number} maxDepth the depth to search through or -1 for infinite\n *\n * @return {Element[]} found elements\n */\nexport function selfAndChildren(elements, unique, maxDepth) {\n  var result = [],\n      processedChildren = [];\n\n  eachElement(elements, function(element, i, depth) {\n    add(result, element, unique);\n\n    var children = element.children;\n\n    // max traversal depth not reached yet\n    if (maxDepth === -1 || depth < maxDepth) {\n\n      // children exist && children not yet processed\n      if (children && add(processedChildren, children, unique)) {\n        return children;\n      }\n    }\n  });\n\n  return result;\n}\n\n/**\n * Return self + direct children for a number of elements\n *\n * @param {Element[]} elements to query\n * @param {boolean} [allowDuplicates] to allow duplicates in the result set\n *\n * @return {Element[]} the collected elements\n */\nexport function selfAndDirectChildren(elements, allowDuplicates) {\n  return selfAndChildren(elements, !allowDuplicates, 1);\n}\n\n\n/**\n * Return self + ALL children for a number of elements\n *\n * @param {Element[]} elements to query\n * @param {boolean} [allowDuplicates] to allow duplicates in the result set\n *\n * @return {Element[]} the collected elements\n */\nexport function selfAndAllChildren(elements, allowDuplicates) {\n  return selfAndChildren(elements, !allowDuplicates, -1);\n}\n\n\n/**\n * Gets the the closure for all selected elements,\n * their enclosed children and connections.\n *\n * @param {Element[]} elements\n * @param {boolean} [isTopLevel=true]\n * @param {Closure} [closure]\n *\n * @return {Closure} newClosure\n */\nexport function getClosure(elements, isTopLevel, closure) {\n\n  if (isUndefined(isTopLevel)) {\n    isTopLevel = true;\n  }\n\n  if (isObject(isTopLevel)) {\n    closure = isTopLevel;\n    isTopLevel = true;\n  }\n\n\n  closure = closure || {};\n\n  var allShapes = copyObject(closure.allShapes),\n      allConnections = copyObject(closure.allConnections),\n      enclosedElements = copyObject(closure.enclosedElements),\n      enclosedConnections = copyObject(closure.enclosedConnections);\n\n  var topLevel = copyObject(\n    closure.topLevel,\n    isTopLevel && groupBy(elements, function(e) { return e.id; })\n  );\n\n\n  function handleConnection(c) {\n    if (topLevel[c.source.id] && topLevel[c.target.id]) {\n      topLevel[c.id] = [ c ];\n    }\n\n    // not enclosed as a child, but maybe logically\n    // (connecting two moved elements?)\n    if (allShapes[c.source.id] && allShapes[c.target.id]) {\n      enclosedConnections[c.id] = enclosedElements[c.id] = c;\n    }\n\n    allConnections[c.id] = c;\n  }\n\n  function handleElement(element) {\n\n    enclosedElements[element.id] = element;\n\n    if (element.waypoints) {\n\n      // remember connection\n      enclosedConnections[element.id] = allConnections[element.id] = element;\n    } else {\n\n      // remember shape\n      allShapes[element.id] = element;\n\n      // remember all connections\n      forEach(element.incoming, handleConnection);\n\n      forEach(element.outgoing, handleConnection);\n\n      // recurse into children\n      return element.children;\n    }\n  }\n\n  eachElement(elements, handleElement);\n\n  return {\n    allShapes: allShapes,\n    allConnections: allConnections,\n    topLevel: topLevel,\n    enclosedConnections: enclosedConnections,\n    enclosedElements: enclosedElements\n  };\n}\n\n/**\n * Returns the surrounding bbox for all elements in\n * the array or the element primitive.\n *\n * @param {Element|Element[]} elements\n * @param {boolean} [stopRecursion=false]\n *\n * @return {Rect}\n */\nexport function getBBox(elements, stopRecursion) {\n\n  stopRecursion = !!stopRecursion;\n  if (!isArray(elements)) {\n    elements = [ elements ];\n  }\n\n  var minX,\n      minY,\n      maxX,\n      maxY;\n\n  forEach(elements, function(element) {\n\n    // If element is a connection the bbox must be computed first\n    var bbox = element;\n    if (element.waypoints && !stopRecursion) {\n      bbox = getBBox(element.waypoints, true);\n    }\n\n    var x = bbox.x,\n        y = bbox.y,\n        height = bbox.height || 0,\n        width = bbox.width || 0;\n\n    if (x < minX || minX === undefined) {\n      minX = x;\n    }\n    if (y < minY || minY === undefined) {\n      minY = y;\n    }\n\n    if ((x + width) > maxX || maxX === undefined) {\n      maxX = x + width;\n    }\n    if ((y + height) > maxY || maxY === undefined) {\n      maxY = y + height;\n    }\n  });\n\n  return {\n    x: minX,\n    y: minY,\n    height: maxY - minY,\n    width: maxX - minX\n  };\n}\n\n\n/**\n * Returns all elements that are enclosed from the bounding box.\n *\n *   * If bbox.(width|height) is not specified the method returns\n *     all elements with element.x/y > bbox.x/y\n *   * If only bbox.x or bbox.y is specified, method return all elements with\n *     e.x > bbox.x or e.y > bbox.y\n *\n * @param {Element[]} elements List of Elements to search through\n * @param {Rect} bbox the enclosing bbox.\n *\n * @return {Element[]} enclosed elements\n */\nexport function getEnclosedElements(elements, bbox) {\n\n  var filteredElements = {};\n\n  forEach(elements, function(element) {\n\n    var e = element;\n\n    if (e.waypoints) {\n      e = getBBox(e);\n    }\n\n    if (!isNumber(bbox.y) && (e.x > bbox.x)) {\n      filteredElements[element.id] = element;\n    }\n    if (!isNumber(bbox.x) && (e.y > bbox.y)) {\n      filteredElements[element.id] = element;\n    }\n    if (e.x > bbox.x && e.y > bbox.y) {\n      if (isNumber(bbox.width) && isNumber(bbox.height) &&\n          e.width + e.x < bbox.width + bbox.x &&\n          e.height + e.y < bbox.height + bbox.y) {\n\n        filteredElements[element.id] = element;\n      } else if (!isNumber(bbox.width) || !isNumber(bbox.height)) {\n        filteredElements[element.id] = element;\n      }\n    }\n  });\n\n  return filteredElements;\n}\n\n/**\n * Get the element's type\n *\n * @param {Element} element\n *\n * @return {'connection' | 'shape' | 'root'}\n */\nexport function getType(element) {\n\n  if ('waypoints' in element) {\n    return 'connection';\n  }\n\n  if ('x' in element) {\n    return 'shape';\n  }\n\n  return 'root';\n}\n\n/**\n * @param {Element} element\n *\n * @return {boolean}\n */\nexport function isFrameElement(element) {\n  return !!(element && element.isFrame);\n}\n\n// helpers ///////////////////////////////\n\nfunction copyObject(src1, src2) {\n  return assign({}, src1 || {}, src2 || {});\n}\n","import {\n  forEach,\n  isFunction,\n  isArray,\n  isNumber,\n  isObject\n} from 'min-dash';\n\n/**\n * @typedef {import('../core/Types').ElementLike} ElementLike\n * @typedef {import('../core/EventBus').default} EventBus\n * @typedef {import('./CommandStack').CommandContext} CommandContext\n *\n * @typedef {string|string[]} Events\n * @typedef { (context: CommandContext) => ElementLike[] | void } HandlerFunction\n * @typedef { (context: CommandContext) => void } ComposeHandlerFunction\n */\n\nvar DEFAULT_PRIORITY = 1000;\n\n/**\n * A utility that can be used to plug into the command execution for\n * extension and/or validation.\n *\n * @class\n * @constructor\n *\n * @example\n *\n * ```javascript\n * import CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n *\n * class CommandLogger extends CommandInterceptor {\n *   constructor(eventBus) {\n *     super(eventBus);\n *\n *   this.preExecute('shape.create', (event) => {\n *     console.log('commandStack.shape-create.preExecute', event);\n *   });\n * }\n * ```\n *\n * @param {EventBus} eventBus\n */\nexport default function CommandInterceptor(eventBus) {\n\n  /**\n   * @type {EventBus}\n   */\n  this._eventBus = eventBus;\n}\n\nCommandInterceptor.$inject = [ 'eventBus' ];\n\nfunction unwrapEvent(fn, that) {\n  return function(event) {\n    return fn.call(that || null, event.context, event.command, event);\n  };\n}\n\n\n/**\n * Intercept a command during one of the phases.\n *\n * @param {Events} [events] command(s) to intercept\n * @param {string} [hook] phase to intercept\n * @param {number} [priority]\n * @param {ComposeHandlerFunction|HandlerFunction} handlerFn\n * @param {boolean} [unwrap] whether the event should be unwrapped\n * @param {any} [that]\n */\nCommandInterceptor.prototype.on = function(events, hook, priority, handlerFn, unwrap, that) {\n\n  if (isFunction(hook) || isNumber(hook)) {\n    that = unwrap;\n    unwrap = handlerFn;\n    handlerFn = priority;\n    priority = hook;\n    hook = null;\n  }\n\n  if (isFunction(priority)) {\n    that = unwrap;\n    unwrap = handlerFn;\n    handlerFn = priority;\n    priority = DEFAULT_PRIORITY;\n  }\n\n  if (isObject(unwrap)) {\n    that = unwrap;\n    unwrap = false;\n  }\n\n  if (!isFunction(handlerFn)) {\n    throw new Error('handlerFn must be a function');\n  }\n\n  if (!isArray(events)) {\n    events = [ events ];\n  }\n\n  var eventBus = this._eventBus;\n\n  forEach(events, function(event) {\n\n    // concat commandStack(.event)?(.hook)?\n    var fullEvent = [ 'commandStack', event, hook ].filter(function(e) { return e; }).join('.');\n\n    eventBus.on(fullEvent, priority, unwrap ? unwrapEvent(handlerFn, that) : handlerFn, that);\n  });\n};\n\n/**\n * Add a <canExecute> phase of command interceptor.\n *\n * @param {Events} [events] command(s) to intercept\n * @param {number} [priority]\n * @param {ComposeHandlerFunction|HandlerFunction} handlerFn\n * @param {boolean} [unwrap] whether the event should be unwrapped\n * @param {any} [that]\n */\nCommandInterceptor.prototype.canExecute = createHook('canExecute');\n\n/**\n * Add a <preExecute> phase of command interceptor.\n *\n * @param {Events} [events] command(s) to intercept\n * @param {number} [priority]\n * @param {ComposeHandlerFunction|HandlerFunction} handlerFn\n * @param {boolean} [unwrap] whether the event should be unwrapped\n * @param {any} [that]\n */\nCommandInterceptor.prototype.preExecute = createHook('preExecute');\n\n/**\n * Add a <preExecuted> phase of command interceptor.\n *\n * @param {Events} [events] command(s) to intercept\n * @param {number} [priority]\n * @param {ComposeHandlerFunction|HandlerFunction} handlerFn\n * @param {boolean} [unwrap] whether the event should be unwrapped\n * @param {any} [that]\n */\nCommandInterceptor.prototype.preExecuted = createHook('preExecuted');\n\n/**\n * Add a <execute> phase of command interceptor.\n *\n * @param {Events} [events] command(s) to intercept\n * @param {number} [priority]\n * @param {ComposeHandlerFunction|HandlerFunction} handlerFn\n * @param {boolean} [unwrap] whether the event should be unwrapped\n * @param {any} [that]\n */\nCommandInterceptor.prototype.execute = createHook('execute');\n\n/**\n * Add a <executed> phase of command interceptor.\n *\n * @param {Events} [events] command(s) to intercept\n * @param {number} [priority]\n * @param {ComposeHandlerFunction|HandlerFunction} handlerFn\n * @param {boolean} [unwrap] whether the event should be unwrapped\n * @param {any} [that]\n */\nCommandInterceptor.prototype.executed = createHook('executed');\n\n/**\n * Add a <postExecute> phase of command interceptor.\n *\n * @param {Events} [events] command(s) to intercept\n * @param {number} [priority]\n * @param {ComposeHandlerFunction|HandlerFunction} handlerFn\n * @param {boolean} [unwrap] whether the event should be unwrapped\n * @param {any} [that]\n */\nCommandInterceptor.prototype.postExecute = createHook('postExecute');\n\n/**\n * Add a <postExecuted> phase of command interceptor.\n *\n * @param {Events} [events] command(s) to intercept\n * @param {number} [priority]\n * @param {ComposeHandlerFunction|HandlerFunction} handlerFn\n * @param {boolean} [unwrap] whether the event should be unwrapped\n * @param {any} [that]\n */\nCommandInterceptor.prototype.postExecuted = createHook('postExecuted');\n\n/**\n * Add a <revert> phase of command interceptor.\n *\n * @param {Events} [events] command(s) to intercept\n * @param {number} [priority]\n * @param {ComposeHandlerFunction|HandlerFunction} handlerFn\n * @param {boolean} [unwrap] whether the event should be unwrapped\n * @param {any} [that]\n */\nCommandInterceptor.prototype.revert = createHook('revert');\n\n/**\n * Add a <reverted> phase of command interceptor.\n *\n * @param {Events} [events] command(s) to intercept\n * @param {number} [priority]\n * @param {ComposeHandlerFunction|HandlerFunction} handlerFn\n * @param {boolean} [unwrap] whether the event should be unwrapped\n * @param {any} [that]\n */\nCommandInterceptor.prototype.reverted = createHook('reverted');\n\n/*\n * Add prototype methods for each phase of command execution (e.g. execute,\n * revert).\n *\n * @param {string} hook\n *\n * @return { (\n *   events?: Events,\n *   priority?: number,\n *   handlerFn: ComposeHandlerFunction|HandlerFunction,\n *   unwrap?: boolean\n * ) => any }\n */\nfunction createHook(hook) {\n\n  /**\n   * @this {CommandInterceptor}\n   *\n   * @param {Events} [events]\n   * @param {number} [priority]\n   * @param {ComposeHandlerFunction|HandlerFunction} handlerFn\n   * @param {boolean} [unwrap]\n   * @param {any} [that]\n   */\n  const hookFn = function(events, priority, handlerFn, unwrap, that) {\n\n    if (isFunction(events) || isNumber(events)) {\n      that = unwrap;\n      unwrap = handlerFn;\n      handlerFn = priority;\n      priority = events;\n      events = null;\n    }\n\n    this.on(events, hook, priority, handlerFn, unwrap, that);\n  };\n\n  return hookFn;\n}\n","import {\n  isNumber\n} from 'min-dash';\n\nimport {\n  attr as svgAttr,\n  create as svgCreate\n} from 'tiny-svg';\n\n\n/**\n * @typedef {(string|number)[]} Component\n *\n * @typedef {import('../util/Types').Point} Point\n */\n\n/**\n * @param {Component[] | Component[][]} elements\n *\n * @return {string}\n */\nexport function componentsToPath(elements) {\n  return elements.flat().join(',').replace(/,?([A-Za-z]),?/g, '$1');\n}\n\n/**\n * @param {Point[]} points\n *\n * @return {string}\n */\nexport function toSVGPoints(points) {\n  var result = '';\n\n  for (var i = 0, p; (p = points[i]); i++) {\n    result += p.x + ',' + p.y + ' ';\n  }\n\n  return result;\n}\n\n/**\n * @param {Point} point\n *\n * @return {Component[]}\n */\nfunction move(point) {\n  return [ 'M', point.x, point.y ];\n}\n\n/**\n * @param {Point} point\n *\n * @return {Component[]}\n */\nfunction lineTo(point) {\n  return [ 'L', point.x, point.y ];\n}\n\n/**\n * @param {Point} p1\n * @param {Point} p2\n * @param {Point} p3\n *\n * @return {Component[]}\n */\nfunction curveTo(p1, p2, p3) {\n  return [ 'C', p1.x, p1.y, p2.x, p2.y, p3.x, p3.y ];\n}\n\n/**\n * @param {Point[]} waypoints\n * @param {number} [cornerRadius]\n * @return {Component[][]}\n */\nfunction drawPath(waypoints, cornerRadius) {\n  const pointCount = waypoints.length;\n\n  const path = [ move(waypoints[0]) ];\n\n  for (let i = 1; i < pointCount; i++) {\n\n    const pointBefore = waypoints[i - 1];\n    const point = waypoints[i];\n    const pointAfter = waypoints[i + 1];\n\n    if (!pointAfter || !cornerRadius) {\n      path.push(lineTo(point));\n\n      continue;\n    }\n\n    const effectiveRadius = Math.min(\n      cornerRadius,\n      vectorLength(point.x - pointBefore.x, point.y - pointBefore.y),\n      vectorLength(pointAfter.x - point.x, pointAfter.y - point.y)\n    );\n\n    if (!effectiveRadius) {\n      path.push(lineTo(point));\n\n      continue;\n    }\n\n    const beforePoint = getPointAtLength(point, pointBefore, effectiveRadius);\n    const beforePoint2 = getPointAtLength(point, pointBefore, effectiveRadius * .5);\n\n    const afterPoint = getPointAtLength(point, pointAfter, effectiveRadius);\n    const afterPoint2 = getPointAtLength(point, pointAfter, effectiveRadius * .5);\n\n    path.push(lineTo(beforePoint));\n    path.push(curveTo(beforePoint2, afterPoint2, afterPoint));\n  }\n\n  return path;\n}\n\nfunction getPointAtLength(start, end, length) {\n\n  const deltaX = end.x - start.x;\n  const deltaY = end.y - start.y;\n\n  const totalLength = vectorLength(deltaX, deltaY);\n\n  const percent = length / totalLength;\n\n  return {\n    x: start.x + deltaX * percent,\n    y: start.y + deltaY * percent\n  };\n}\n\nfunction vectorLength(x, y) {\n  return Math.sqrt(Math.pow(x, 2) + Math.pow(y, 2));\n}\n\n/**\n * @param {Point[]} points\n * @param {number|Object} [attrs]\n * @param {number} [radius]\n *\n * @return {SVGElement}\n */\nexport function createLine(points, attrs, radius) {\n\n  if (isNumber(attrs)) {\n    radius = attrs;\n    attrs = null;\n  }\n\n  if (!attrs) {\n    attrs = {};\n  }\n\n  const line = svgCreate('path', attrs);\n\n  if (isNumber(radius)) {\n    line.dataset.cornerRadius = String(radius);\n  }\n\n  return updateLine(line, points);\n}\n\n/**\n * @param {SVGElement} gfx\n * @param {Point[]} points\n *\n * @return {SVGElement}\n */\nexport function updateLine(gfx, points) {\n\n  const cornerRadius = parseInt(gfx.dataset.cornerRadius, 10) || 0;\n\n  svgAttr(gfx, {\n    d: componentsToPath(drawPath(points, cornerRadius))\n  });\n\n  return gfx;\n}\n","import {\n  isFunction\n} from 'min-dash';\n\nimport {\n  event as domEvent\n} from 'min-dom';\n\nimport {\n  hasModifier,\n  isCmd,\n  isKey,\n  isShift\n} from './KeyboardUtil';\n\n/**\n * @typedef {import('../../core/EventBus').default} EventBus\n *\n * @typedef {({ keyEvent: KeyboardEvent }) => any} Listener\n */\n\nvar KEYDOWN_EVENT = 'keyboard.keydown',\n    KEYUP_EVENT = 'keyboard.keyup';\n\nvar DEFAULT_PRIORITY = 1000;\n\nvar compatMessage = 'Keyboard binding is now implicit; explicit binding to an element got removed. For more information, see https://github.com/bpmn-io/diagram-js/issues/661';\n\n\n/**\n * A keyboard abstraction that may be activated and\n * deactivated by users at will, consuming global key events\n * and triggering diagram actions.\n *\n * For keys pressed down, keyboard fires `keyboard.keydown` event.\n * The event context contains one field which is `KeyboardEvent` event.\n *\n * The implementation fires the following key events that allow\n * other components to hook into key handling:\n *\n *  - keyboard.bind\n *  - keyboard.unbind\n *  - keyboard.init\n *  - keyboard.destroy\n *\n * All events contain one field which is node.\n *\n * Specify the initial keyboard binding state via the\n * `keyboard.bind=true|false` configuration option.\n *\n * @param {Object} config\n * @param {boolean} [config.bind]\n * @param {EventBus} eventBus\n */\nexport default function Keyboard(config, eventBus) {\n  var self = this;\n\n  this._config = config = config || {};\n\n  this._eventBus = eventBus;\n\n  this._keydownHandler = this._keydownHandler.bind(this);\n  this._keyupHandler = this._keyupHandler.bind(this);\n\n  // properly clean dom registrations\n  eventBus.on('diagram.destroy', function() {\n    self._fire('destroy');\n\n    self.unbind();\n  });\n\n  if (config.bindTo) {\n    console.error('unsupported configuration <keyboard.bindTo>', new Error(compatMessage));\n  }\n\n  var bind = config && config.bind !== false;\n\n  eventBus.on('canvas.init', function(event) {\n    self._target = event.svg;\n\n    if (bind) {\n      self.bind();\n    }\n\n    self._fire('init');\n  });\n\n}\n\nKeyboard.$inject = [\n  'config.keyboard',\n  'eventBus'\n];\n\nKeyboard.prototype._keydownHandler = function(event) {\n  this._keyHandler(event, KEYDOWN_EVENT);\n};\n\nKeyboard.prototype._keyupHandler = function(event) {\n  this._keyHandler(event, KEYUP_EVENT);\n};\n\nKeyboard.prototype._keyHandler = function(event, type) {\n  var eventBusResult;\n\n  if (this._isEventIgnored(event)) {\n    return;\n  }\n\n  var context = {\n    keyEvent: event\n  };\n\n  eventBusResult = this._eventBus.fire(type || KEYDOWN_EVENT, context);\n\n  if (eventBusResult) {\n    event.preventDefault();\n  }\n};\n\nKeyboard.prototype._isEventIgnored = function(event) {\n  return false;\n};\n\n/**\n * Bind keyboard events to the given DOM node.\n *\n * @overlord\n * @deprecated No longer in use since version 15.0.0.\n *\n * @param {EventTarget} node\n */\n/**\n * Bind keyboard events to the canvas node.\n */\nKeyboard.prototype.bind = function(node) {\n\n  // legacy <node> argument provided\n  if (node) {\n    console.error('unsupported argument <node>', new Error(compatMessage));\n  }\n\n  // make sure that the keyboard is only bound once to the DOM\n  this.unbind();\n\n  node = this._node = this._target;\n\n  // bind key events\n  domEvent.bind(node, 'keydown', this._keydownHandler);\n  domEvent.bind(node, 'keyup', this._keyupHandler);\n\n  this._fire('bind');\n};\n\n/**\n * @return {EventTarget}\n */\nKeyboard.prototype.getBinding = function() {\n  return this._node;\n};\n\nKeyboard.prototype.unbind = function() {\n  var node = this._node;\n\n  if (node) {\n    this._fire('unbind');\n\n    // unbind key events\n    domEvent.unbind(node, 'keydown', this._keydownHandler);\n    domEvent.unbind(node, 'keyup', this._keyupHandler);\n  }\n\n  this._node = null;\n};\n\n/**\n * @param {string} event\n */\nKeyboard.prototype._fire = function(event) {\n  this._eventBus.fire('keyboard.' + event, { node: this._node });\n};\n\n/**\n * Add a listener function that is notified with `KeyboardEvent` whenever\n * the keyboard is bound and the user presses a key. If no priority is\n * provided, the default value of 1000 is used.\n *\n * @param {number} [priority]\n * @param {Listener} listener\n * @param {string} [type='keyboard.keydown']\n */\nKeyboard.prototype.addListener = function(priority, listener, type) {\n  if (isFunction(priority)) {\n    type = listener;\n    listener = priority;\n    priority = DEFAULT_PRIORITY;\n  }\n\n  this._eventBus.on(type || KEYDOWN_EVENT, priority, listener);\n};\n\n/**\n * Remove a listener function.\n *\n * @param {Listener} listener\n * @param {string} [type='keyboard.keydown']\n */\nKeyboard.prototype.removeListener = function(listener, type) {\n  this._eventBus.off(type || KEYDOWN_EVENT, listener);\n};\n\nKeyboard.prototype.hasModifier = hasModifier;\nKeyboard.prototype.isCmd = isCmd;\nKeyboard.prototype.isShift = isShift;\nKeyboard.prototype.isKey = isKey;\n","import Keyboard from './Keyboard';\nimport KeyboardBindings from './KeyboardBindings';\n\n\n/**\n * @type { import('didi').ModuleDeclaration }\n */\nexport default {\n  __init__: [ 'keyboard', 'keyboardBindings' ],\n  keyboard: [ 'type', Keyboard ],\n  keyboardBindings: [ 'type', KeyboardBindings ]\n};\n","import {\n  isCmd,\n  isKey,\n  isCopy,\n  isPaste,\n  isUndo,\n  isRedo,\n  KEYS_COPY,\n  KEYS_PASTE,\n  KEYS_UNDO,\n  KEYS_REDO\n} from './KeyboardUtil';\n\n/**\n * @typedef {import('../editor-actions/EditorActions').default} EditorActions\n * @typedef {import('../../core/EventBus').default} EventBus\n * @typedef {import('./Keyboard').default} Keyboard\n */\n\nexport {\n  KEYS_COPY,\n  KEYS_PASTE,\n  KEYS_UNDO,\n  KEYS_REDO\n};\n\n\nvar LOW_PRIORITY = 500;\n\n\n/**\n * Adds default keyboard bindings.\n *\n * This does not pull in any features will bind only actions that\n * have previously been registered against the editorActions component.\n *\n * @param {EventBus} eventBus\n * @param {Keyboard} keyboard\n */\nexport default function KeyboardBindings(eventBus, keyboard) {\n\n  var self = this;\n\n  eventBus.on('editorActions.init', LOW_PRIORITY, function(event) {\n\n    var editorActions = event.editorActions;\n\n    self.registerBindings(keyboard, editorActions);\n  });\n}\n\nKeyboardBindings.$inject = [\n  'eventBus',\n  'keyboard'\n];\n\n\n/**\n * Register available keyboard bindings.\n *\n * @param {Keyboard} keyboard\n * @param {EditorActions} editorActions\n */\nKeyboardBindings.prototype.registerBindings = function(keyboard, editorActions) {\n\n  /**\n   * Add keyboard binding if respective editor action\n   * is registered.\n   *\n   * @param {string} action name\n   * @param {Function} fn that implements the key binding\n   */\n  function addListener(action, fn) {\n\n    if (editorActions.isRegistered(action)) {\n      keyboard.addListener(fn);\n    }\n  }\n\n\n  // undo\n  // (CTRL|CMD) + Z\n  addListener('undo', function(context) {\n\n    var event = context.keyEvent;\n\n    if (isUndo(event)) {\n      editorActions.trigger('undo');\n\n      return true;\n    }\n  });\n\n  // redo\n  // CTRL + Y\n  // CMD + SHIFT + Z\n  addListener('redo', function(context) {\n\n    var event = context.keyEvent;\n\n    if (isRedo(event)) {\n      editorActions.trigger('redo');\n\n      return true;\n    }\n  });\n\n  // copy\n  // CTRL/CMD + C\n  addListener('copy', function(context) {\n\n    var event = context.keyEvent;\n\n    if (isCopy(event)) {\n      editorActions.trigger('copy');\n\n      return true;\n    }\n  });\n\n  // paste\n  // CTRL/CMD + V\n  addListener('paste', function(context) {\n\n    var event = context.keyEvent;\n\n    if (isPaste(event)) {\n      editorActions.trigger('paste');\n\n      return true;\n    }\n  });\n\n  // zoom in one step\n  // CTRL/CMD + +\n  addListener('stepZoom', function(context) {\n\n    var event = context.keyEvent;\n\n    // quirk: it has to be triggered by `=` as well to work on international keyboard layout\n    // cf: https://github.com/bpmn-io/bpmn-js/issues/1362#issuecomment-722989754\n    if (isKey([ '+', 'Add', '=' ], event) && isCmd(event)) {\n      editorActions.trigger('stepZoom', { value: 1 });\n\n      return true;\n    }\n  });\n\n  // zoom out one step\n  // CTRL + -\n  addListener('stepZoom', function(context) {\n\n    var event = context.keyEvent;\n\n    if (isKey([ '-', 'Subtract' ], event) && isCmd(event)) {\n      editorActions.trigger('stepZoom', { value: -1 });\n\n      return true;\n    }\n  });\n\n  // zoom to the default level\n  // CTRL + 0\n  addListener('zoom', function(context) {\n\n    var event = context.keyEvent;\n\n    if (isKey('0', event) && isCmd(event)) {\n      editorActions.trigger('zoom', { value: 1 });\n\n      return true;\n    }\n  });\n\n  // delete selected element\n  // DEL\n  addListener('removeSelection', function(context) {\n\n    var event = context.keyEvent;\n\n    if (isKey([ 'Backspace', 'Delete', 'Del' ], event)) {\n      editorActions.trigger('removeSelection');\n\n      return true;\n    }\n  });\n};","import {\n  getType as getElementType\n} from '../../util/Elements';\n\n/**\n * @typedef {import('../../core/Canvas').default} Canvas\n * @typedef {import('../../core/ElementRegistry').default} ElementRegistry\n * @typedef {import('../../core/EventBus').default} EventBus\n * @typedef {import('../../core/GraphicsFactory').default} GraphicsFactory\n */\n\n/**\n * Adds change support to the diagram, including\n *\n * <ul>\n *   <li>redrawing shapes and connections on change</li>\n * </ul>\n *\n * @param {EventBus} eventBus\n * @param {Canvas} canvas\n * @param {ElementRegistry} elementRegistry\n * @param {GraphicsFactory} graphicsFactory\n */\nexport default function ChangeSupport(\n    eventBus, canvas, elementRegistry,\n    graphicsFactory) {\n\n\n  // redraw shapes / connections on change\n\n  eventBus.on('element.changed', function(event) {\n\n    var element = event.element;\n\n    // element might have been deleted and replaced by new element with same ID\n    // thus check for parent of element except for root element\n    if (element.parent || element === canvas.getRootElement()) {\n      event.gfx = elementRegistry.getGraphics(element);\n    }\n\n    // shape + gfx may have been deleted\n    if (!event.gfx) {\n      return;\n    }\n\n    eventBus.fire(getElementType(element) + '.changed', event);\n  });\n\n  eventBus.on('elements.changed', function(event) {\n\n    var elements = event.elements;\n\n    elements.forEach(function(e) {\n      eventBus.fire('element.changed', { element: e });\n    });\n\n    graphicsFactory.updateContainments(elements);\n  });\n\n  eventBus.on('shape.changed', function(event) {\n    graphicsFactory.update('shape', event.element, event.gfx);\n  });\n\n  eventBus.on('connection.changed', function(event) {\n    graphicsFactory.update('connection', event.element, event.gfx);\n  });\n}\n\nChangeSupport.$inject = [\n  'eventBus',\n  'canvas',\n  'elementRegistry',\n  'graphicsFactory'\n];","import ChangeSupport from './ChangeSupport';\n\n\n/**\n * @type { import('didi').ModuleDeclaration }\n */\nexport default {\n  __init__: [ 'changeSupport' ],\n  changeSupport: [ 'type', ChangeSupport ]\n};","/**\n * This file contains source code adapted from Snap.svg (licensed Apache-2.0).\n *\n * @see https://github.com/adobe-webplatform/Snap.svg/blob/master/src/path.js\n */\n\n/* eslint no-fallthrough: \"off\" */\n\nvar p2s = /,?([a-z]),?/gi,\n    toFloat = parseFloat,\n    math = Math,\n    PI = math.PI,\n    mmin = math.min,\n    mmax = math.max,\n    pow = math.pow,\n    abs = math.abs,\n    pathCommand = /([a-z])[\\s,]*((-?\\d*\\.?\\d*(?:e[-+]?\\d+)?[\\s]*,?[\\s]*)+)/ig,\n    pathValues = /(-?\\d*\\.?\\d*(?:e[-+]?\\d+)?)[\\s]*,?[\\s]*/ig;\n\nvar isArray = Array.isArray || function(o) { return o instanceof Array; };\n\nfunction hasProperty(obj, property) {\n  return Object.prototype.hasOwnProperty.call(obj, property);\n}\n\nfunction clone(obj) {\n\n  if (typeof obj == 'function' || Object(obj) !== obj) {\n    return obj;\n  }\n\n  var res = new obj.constructor;\n\n  for (var key in obj) {\n    if (hasProperty(obj, key)) {\n      res[key] = clone(obj[key]);\n    }\n  }\n\n  return res;\n}\n\nfunction repush(array, item) {\n  for (var i = 0, ii = array.length; i < ii; i++) if (array[i] === item) {\n    return array.push(array.splice(i, 1)[0]);\n  }\n}\n\nfunction cacher(f) {\n\n  function newf() {\n\n    var arg = Array.prototype.slice.call(arguments, 0),\n        args = arg.join('\\u2400'),\n        cache = newf.cache = newf.cache || {},\n        count = newf.count = newf.count || [];\n\n    if (hasProperty(cache, args)) {\n      repush(count, args);\n      return cache[args];\n    }\n\n    count.length >= 1e3 && delete cache[count.shift()];\n    count.push(args);\n    cache[args] = f(...arguments);\n\n    return cache[args];\n  }\n  return newf;\n}\n\nfunction parsePathString(pathString) {\n\n  if (!pathString) {\n    return null;\n  }\n\n  var pth = paths(pathString);\n\n  if (pth.arr) {\n    return clone(pth.arr);\n  }\n\n  var paramCounts = { a: 7, c: 6, h: 1, l: 2, m: 2, q: 4, s: 4, t: 2, v: 1, z: 0 },\n      data = [];\n\n  if (isArray(pathString) && isArray(pathString[0])) { // rough assumption\n    data = clone(pathString);\n  }\n\n  if (!data.length) {\n\n    String(pathString).replace(pathCommand, function(a, b, c) {\n      var params = [],\n          name = b.toLowerCase();\n\n      c.replace(pathValues, function(a, b) {\n        b && params.push(+b);\n      });\n\n      if (name == 'm' && params.length > 2) {\n        data.push([ b, ...params.splice(0, 2) ]);\n        name = 'l';\n        b = b == 'm' ? 'l' : 'L';\n      }\n\n      while (params.length >= paramCounts[name]) {\n        data.push([ b, ...params.splice(0, paramCounts[name]) ]);\n        if (!paramCounts[name]) {\n          break;\n        }\n      }\n    });\n  }\n\n  data.toString = paths.toString;\n  pth.arr = clone(data);\n\n  return data;\n}\n\nfunction paths(ps) {\n  var p = paths.ps = paths.ps || {};\n\n  if (p[ps]) {\n    p[ps].sleep = 100;\n  } else {\n    p[ps] = {\n      sleep: 100\n    };\n  }\n\n  setTimeout(function() {\n    for (var key in p) {\n      if (hasProperty(p, key) && key != ps) {\n        p[key].sleep--;\n        !p[key].sleep && delete p[key];\n      }\n    }\n  });\n\n  return p[ps];\n}\n\nfunction rectBBox(x, y, width, height) {\n\n  if (arguments.length === 1) {\n    y = x.y;\n    width = x.width;\n    height = x.height;\n    x = x.x;\n  }\n\n  return {\n    x: x,\n    y: y,\n    width: width,\n    height: height,\n    x2: x + width,\n    y2: y + height\n  };\n}\n\nfunction pathToString() {\n  return this.join(',').replace(p2s, '$1');\n}\n\nfunction pathClone(pathArray) {\n  var res = clone(pathArray);\n  res.toString = pathToString;\n  return res;\n}\n\nfunction findDotsAtSegment(p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y, t) {\n  var t1 = 1 - t,\n      t13 = pow(t1, 3),\n      t12 = pow(t1, 2),\n      t2 = t * t,\n      t3 = t2 * t,\n      x = t13 * p1x + t12 * 3 * t * c1x + t1 * 3 * t * t * c2x + t3 * p2x,\n      y = t13 * p1y + t12 * 3 * t * c1y + t1 * 3 * t * t * c2y + t3 * p2y;\n\n  return {\n    x: fixError(x),\n    y: fixError(y)\n  };\n}\n\nfunction bezierBBox(points) {\n\n  var bbox = curveBBox(...points);\n\n  return rectBBox(\n    bbox.x0,\n    bbox.y0,\n    bbox.x1 - bbox.x0,\n    bbox.y1 - bbox.y0\n  );\n}\n\nfunction isPointInsideBBox(bbox, x, y) {\n  return x >= bbox.x &&\n    x <= bbox.x + bbox.width &&\n    y >= bbox.y &&\n    y <= bbox.y + bbox.height;\n}\n\nfunction isBBoxIntersect(bbox1, bbox2) {\n  bbox1 = rectBBox(bbox1);\n  bbox2 = rectBBox(bbox2);\n  return isPointInsideBBox(bbox2, bbox1.x, bbox1.y)\n    || isPointInsideBBox(bbox2, bbox1.x2, bbox1.y)\n    || isPointInsideBBox(bbox2, bbox1.x, bbox1.y2)\n    || isPointInsideBBox(bbox2, bbox1.x2, bbox1.y2)\n    || isPointInsideBBox(bbox1, bbox2.x, bbox2.y)\n    || isPointInsideBBox(bbox1, bbox2.x2, bbox2.y)\n    || isPointInsideBBox(bbox1, bbox2.x, bbox2.y2)\n    || isPointInsideBBox(bbox1, bbox2.x2, bbox2.y2)\n    || (bbox1.x < bbox2.x2 && bbox1.x > bbox2.x\n        || bbox2.x < bbox1.x2 && bbox2.x > bbox1.x)\n    && (bbox1.y < bbox2.y2 && bbox1.y > bbox2.y\n        || bbox2.y < bbox1.y2 && bbox2.y > bbox1.y);\n}\n\nfunction base3(t, p1, p2, p3, p4) {\n  var t1 = -3 * p1 + 9 * p2 - 9 * p3 + 3 * p4,\n      t2 = t * t1 + 6 * p1 - 12 * p2 + 6 * p3;\n  return t * t2 - 3 * p1 + 3 * p2;\n}\n\nfunction bezlen(x1, y1, x2, y2, x3, y3, x4, y4, z) {\n\n  if (z == null) {\n    z = 1;\n  }\n\n  z = z > 1 ? 1 : z < 0 ? 0 : z;\n\n  var z2 = z / 2,\n      n = 12,\n      Tvalues = [ -.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816 ],\n      Cvalues = [ 0.2491,0.2491,0.2335,0.2335,0.2032,0.2032,0.1601,0.1601,0.1069,0.1069,0.0472,0.0472 ],\n      sum = 0;\n\n  for (var i = 0; i < n; i++) {\n    var ct = z2 * Tvalues[i] + z2,\n        xbase = base3(ct, x1, x2, x3, x4),\n        ybase = base3(ct, y1, y2, y3, y4),\n        comb = xbase * xbase + ybase * ybase;\n\n    sum += Cvalues[i] * math.sqrt(comb);\n  }\n\n  return z2 * sum;\n}\n\n\nfunction intersectLines(x1, y1, x2, y2, x3, y3, x4, y4) {\n\n  if (\n    mmax(x1, x2) < mmin(x3, x4) ||\n      mmin(x1, x2) > mmax(x3, x4) ||\n      mmax(y1, y2) < mmin(y3, y4) ||\n      mmin(y1, y2) > mmax(y3, y4)\n  ) {\n    return;\n  }\n\n  var nx = (x1 * y2 - y1 * x2) * (x3 - x4) - (x1 - x2) * (x3 * y4 - y3 * x4),\n      ny = (x1 * y2 - y1 * x2) * (y3 - y4) - (y1 - y2) * (x3 * y4 - y3 * x4),\n      denominator = (x1 - x2) * (y3 - y4) - (y1 - y2) * (x3 - x4);\n\n  if (!denominator) {\n    return;\n  }\n\n  var px = fixError(nx / denominator),\n      py = fixError(ny / denominator),\n      px2 = +px.toFixed(2),\n      py2 = +py.toFixed(2);\n\n  if (\n    px2 < +mmin(x1, x2).toFixed(2) ||\n      px2 > +mmax(x1, x2).toFixed(2) ||\n      px2 < +mmin(x3, x4).toFixed(2) ||\n      px2 > +mmax(x3, x4).toFixed(2) ||\n      py2 < +mmin(y1, y2).toFixed(2) ||\n      py2 > +mmax(y1, y2).toFixed(2) ||\n      py2 < +mmin(y3, y4).toFixed(2) ||\n      py2 > +mmax(y3, y4).toFixed(2)\n  ) {\n    return;\n  }\n\n  return { x: px, y: py };\n}\n\nfunction fixError(number) {\n  return Math.round(number * 100000000000) / 100000000000;\n}\n\nfunction findBezierIntersections(bez1, bez2, justCount) {\n  var bbox1 = bezierBBox(bez1),\n      bbox2 = bezierBBox(bez2);\n\n  if (!isBBoxIntersect(bbox1, bbox2)) {\n    return justCount ? 0 : [];\n  }\n\n  // As an optimization, lines will have only 1 segment\n\n  var l1 = bezlen(...bez1),\n      l2 = bezlen(...bez2),\n      n1 = isLine(bez1) ? 1 : ~~(l1 / 5) || 1,\n      n2 = isLine(bez2) ? 1 : ~~(l2 / 5) || 1,\n      dots1 = [],\n      dots2 = [],\n      xy = {},\n      res = justCount ? 0 : [];\n\n  for (var i = 0; i < n1 + 1; i++) {\n    var p = findDotsAtSegment(...bez1, i / n1);\n    dots1.push({ x: p.x, y: p.y, t: i / n1 });\n  }\n\n  for (i = 0; i < n2 + 1; i++) {\n    p = findDotsAtSegment(...bez2, i / n2);\n    dots2.push({ x: p.x, y: p.y, t: i / n2 });\n  }\n\n  for (i = 0; i < n1; i++) {\n\n    for (var j = 0; j < n2; j++) {\n      var di = dots1[i],\n          di1 = dots1[i + 1],\n          dj = dots2[j],\n          dj1 = dots2[j + 1],\n          ci = abs(di1.x - di.x) < .01 ? 'y' : 'x',\n          cj = abs(dj1.x - dj.x) < .01 ? 'y' : 'x',\n          is = intersectLines(di.x, di.y, di1.x, di1.y, dj.x, dj.y, dj1.x, dj1.y),\n          key;\n\n      if (is) {\n        key = is.x.toFixed(9) + '#' + is.y.toFixed(9);\n\n        if (xy[key]) {\n          continue;\n        }\n\n        xy[key] = true;\n\n        var t1 = di.t + abs((is[ci] - di[ci]) / (di1[ci] - di[ci])) * (di1.t - di.t),\n            t2 = dj.t + abs((is[cj] - dj[cj]) / (dj1[cj] - dj[cj])) * (dj1.t - dj.t);\n\n        if (t1 >= 0 && t1 <= 1 && t2 >= 0 && t2 <= 1) {\n\n          if (justCount) {\n            res++;\n          } else {\n            res.push({\n              x: is.x,\n              y: is.y,\n              t1: t1,\n              t2: t2\n            });\n          }\n        }\n      }\n    }\n  }\n\n  return res;\n}\n\n\n/**\n * Find or counts the intersections between two SVG paths.\n *\n * Returns a number in counting mode and a list of intersections otherwise.\n *\n * A single intersection entry contains the intersection coordinates (x, y)\n * as well as additional information regarding the intersecting segments\n * on each path (segment1, segment2) and the relative location of the\n * intersection on these segments (t1, t2).\n *\n * The path may be an SVG path string or a list of path components\n * such as `[ [ 'M', 0, 10 ], [ 'L', 20, 0 ] ]`.\n *\n * @example\n *\n * var intersections = findPathIntersections(\n *   'M0,0L100,100',\n *   [ [ 'M', 0, 100 ], [ 'L', 100, 0 ] ]\n * );\n *\n * // intersections = [\n * //   { x: 50, y: 50, segment1: 1, segment2: 1, t1: 0.5, t2: 0.5 }\n * // ]\n *\n * @param {String|Array<PathDef>} path1\n * @param {String|Array<PathDef>} path2\n * @param {Boolean} [justCount=false]\n *\n * @return {Array<Intersection>|Number}\n */\nexport default function findPathIntersections(path1, path2, justCount) {\n  path1 = pathToCurve(path1);\n  path2 = pathToCurve(path2);\n\n  var x1, y1, x2, y2, x1m, y1m, x2m, y2m, bez1, bez2,\n      res = justCount ? 0 : [];\n\n  for (var i = 0, ii = path1.length; i < ii; i++) {\n    var pi = path1[i];\n\n    if (pi[0] == 'M') {\n      x1 = x1m = pi[1];\n      y1 = y1m = pi[2];\n    } else {\n\n      if (pi[0] == 'C') {\n        bez1 = [ x1, y1, ...pi.slice(1) ];\n        x1 = bez1[6];\n        y1 = bez1[7];\n      } else {\n        bez1 = [ x1, y1, x1, y1, x1m, y1m, x1m, y1m ];\n        x1 = x1m;\n        y1 = y1m;\n      }\n\n      for (var j = 0, jj = path2.length; j < jj; j++) {\n        var pj = path2[j];\n\n        if (pj[0] == 'M') {\n          x2 = x2m = pj[1];\n          y2 = y2m = pj[2];\n        } else {\n\n          if (pj[0] == 'C') {\n            bez2 = [ x2, y2, ...pj.slice(1) ];\n            x2 = bez2[6];\n            y2 = bez2[7];\n          } else {\n            bez2 = [ x2, y2, x2, y2, x2m, y2m, x2m, y2m ];\n            x2 = x2m;\n            y2 = y2m;\n          }\n\n          var intr = findBezierIntersections(bez1, bez2, justCount);\n\n          if (justCount) {\n            res += intr;\n          } else {\n\n            for (var k = 0, kk = intr.length; k < kk; k++) {\n              intr[k].segment1 = i;\n              intr[k].segment2 = j;\n              intr[k].bez1 = bez1;\n              intr[k].bez2 = bez2;\n            }\n\n            res = res.concat(intr);\n          }\n        }\n      }\n    }\n  }\n\n  return res;\n}\n\n\nfunction pathToAbsolute(pathArray) {\n  var pth = paths(pathArray);\n\n  if (pth.abs) {\n    return pathClone(pth.abs);\n  }\n\n  if (!isArray(pathArray) || !isArray(pathArray && pathArray[0])) { // rough assumption\n    pathArray = parsePathString(pathArray);\n  }\n\n  if (!pathArray || !pathArray.length) {\n    return [ [ 'M', 0, 0 ] ];\n  }\n\n  var res = [],\n      x = 0,\n      y = 0,\n      mx = 0,\n      my = 0,\n      start = 0,\n      pa0;\n\n  if (pathArray[0][0] == 'M') {\n    x = +pathArray[0][1];\n    y = +pathArray[0][2];\n    mx = x;\n    my = y;\n    start++;\n    res[0] = [ 'M', x, y ];\n  }\n\n  for (var r, pa, i = start, ii = pathArray.length; i < ii; i++) {\n    res.push(r = []);\n    pa = pathArray[i];\n    pa0 = pa[0];\n\n    if (pa0 != pa0.toUpperCase()) {\n      r[0] = pa0.toUpperCase();\n\n      switch (r[0]) {\n      case 'A':\n        r[1] = pa[1];\n        r[2] = pa[2];\n        r[3] = pa[3];\n        r[4] = pa[4];\n        r[5] = pa[5];\n        r[6] = +pa[6] + x;\n        r[7] = +pa[7] + y;\n        break;\n      case 'V':\n        r[1] = +pa[1] + y;\n        break;\n      case 'H':\n        r[1] = +pa[1] + x;\n        break;\n      case 'M':\n        mx = +pa[1] + x;\n        my = +pa[2] + y;\n      default:\n        for (var j = 1, jj = pa.length; j < jj; j++) {\n          r[j] = +pa[j] + ((j % 2) ? x : y);\n        }\n      }\n    } else {\n      for (var k = 0, kk = pa.length; k < kk; k++) {\n        r[k] = pa[k];\n      }\n    }\n    pa0 = pa0.toUpperCase();\n\n    switch (r[0]) {\n    case 'Z':\n      x = +mx;\n      y = +my;\n      break;\n    case 'H':\n      x = r[1];\n      break;\n    case 'V':\n      y = r[1];\n      break;\n    case 'M':\n      mx = r[r.length - 2];\n      my = r[r.length - 1];\n    default:\n      x = r[r.length - 2];\n      y = r[r.length - 1];\n    }\n  }\n\n  res.toString = pathToString;\n  pth.abs = pathClone(res);\n\n  return res;\n}\n\nfunction isLine(bez) {\n  return (\n    bez[0] === bez[2] &&\n    bez[1] === bez[3] &&\n    bez[4] === bez[6] &&\n    bez[5] === bez[7]\n  );\n}\n\nfunction lineToCurve(x1, y1, x2, y2) {\n  return [\n    x1, y1, x2,\n    y2, x2, y2\n  ];\n}\n\nfunction qubicToCurve(x1, y1, ax, ay, x2, y2) {\n  var _13 = 1 / 3,\n      _23 = 2 / 3;\n\n  return [\n    _13 * x1 + _23 * ax,\n    _13 * y1 + _23 * ay,\n    _13 * x2 + _23 * ax,\n    _13 * y2 + _23 * ay,\n    x2,\n    y2\n  ];\n}\n\nfunction arcToCurve(x1, y1, rx, ry, angle, large_arc_flag, sweep_flag, x2, y2, recursive) {\n\n  // for more information of where this math came from visit:\n  // http://www.w3.org/TR/SVG11/implnote.html#ArcImplementationNotes\n  var _120 = PI * 120 / 180,\n      rad = PI / 180 * (+angle || 0),\n      res = [],\n      xy,\n      rotate = cacher(function(x, y, rad) {\n        var X = x * math.cos(rad) - y * math.sin(rad),\n            Y = x * math.sin(rad) + y * math.cos(rad);\n\n        return { x: X, y: Y };\n      });\n\n  if (!recursive) {\n    xy = rotate(x1, y1, -rad);\n    x1 = xy.x;\n    y1 = xy.y;\n    xy = rotate(x2, y2, -rad);\n    x2 = xy.x;\n    y2 = xy.y;\n\n    var x = (x1 - x2) / 2,\n        y = (y1 - y2) / 2;\n\n    var h = (x * x) / (rx * rx) + (y * y) / (ry * ry);\n\n    if (h > 1) {\n      h = math.sqrt(h);\n      rx = h * rx;\n      ry = h * ry;\n    }\n\n    var rx2 = rx * rx,\n        ry2 = ry * ry,\n        k = (large_arc_flag == sweep_flag ? -1 : 1) *\n            math.sqrt(abs((rx2 * ry2 - rx2 * y * y - ry2 * x * x) / (rx2 * y * y + ry2 * x * x))),\n        cx = k * rx * y / ry + (x1 + x2) / 2,\n        cy = k * -ry * x / rx + (y1 + y2) / 2,\n        f1 = math.asin(((y1 - cy) / ry).toFixed(9)),\n        f2 = math.asin(((y2 - cy) / ry).toFixed(9));\n\n    f1 = x1 < cx ? PI - f1 : f1;\n    f2 = x2 < cx ? PI - f2 : f2;\n    f1 < 0 && (f1 = PI * 2 + f1);\n    f2 < 0 && (f2 = PI * 2 + f2);\n\n    if (sweep_flag && f1 > f2) {\n      f1 = f1 - PI * 2;\n    }\n    if (!sweep_flag && f2 > f1) {\n      f2 = f2 - PI * 2;\n    }\n  } else {\n    f1 = recursive[0];\n    f2 = recursive[1];\n    cx = recursive[2];\n    cy = recursive[3];\n  }\n\n  var df = f2 - f1;\n\n  if (abs(df) > _120) {\n    var f2old = f2,\n        x2old = x2,\n        y2old = y2;\n\n    f2 = f1 + _120 * (sweep_flag && f2 > f1 ? 1 : -1);\n    x2 = cx + rx * math.cos(f2);\n    y2 = cy + ry * math.sin(f2);\n    res = arcToCurve(x2, y2, rx, ry, angle, 0, sweep_flag, x2old, y2old, [ f2, f2old, cx, cy ]);\n  }\n\n  df = f2 - f1;\n\n  var c1 = math.cos(f1),\n      s1 = math.sin(f1),\n      c2 = math.cos(f2),\n      s2 = math.sin(f2),\n      t = math.tan(df / 4),\n      hx = 4 / 3 * rx * t,\n      hy = 4 / 3 * ry * t,\n      m1 = [ x1, y1 ],\n      m2 = [ x1 + hx * s1, y1 - hy * c1 ],\n      m3 = [ x2 + hx * s2, y2 - hy * c2 ],\n      m4 = [ x2, y2 ];\n\n  m2[0] = 2 * m1[0] - m2[0];\n  m2[1] = 2 * m1[1] - m2[1];\n\n  if (recursive) {\n    return [ m2, m3, m4 ].concat(res);\n  } else {\n    res = [ m2, m3, m4 ].concat(res).join().split(',');\n    var newres = [];\n\n    for (var i = 0, ii = res.length; i < ii; i++) {\n      newres[i] = i % 2 ? rotate(res[i - 1], res[i], rad).y : rotate(res[i], res[i + 1], rad).x;\n    }\n\n    return newres;\n  }\n}\n\n// Returns bounding box of cubic bezier curve.\n// Source: http://blog.hackers-cafe.net/2009/06/how-to-calculate-bezier-curves-bounding.html\n// Original version: NISHIO Hirokazu\n// Modifications: https://github.com/timo22345\nfunction curveBBox(x0, y0, x1, y1, x2, y2, x3, y3) {\n  var tvalues = [],\n      bounds = [ [], [] ],\n      a, b, c, t, t1, t2, b2ac, sqrtb2ac;\n\n  for (var i = 0; i < 2; ++i) {\n\n    if (i == 0) {\n      b = 6 * x0 - 12 * x1 + 6 * x2;\n      a = -3 * x0 + 9 * x1 - 9 * x2 + 3 * x3;\n      c = 3 * x1 - 3 * x0;\n    } else {\n      b = 6 * y0 - 12 * y1 + 6 * y2;\n      a = -3 * y0 + 9 * y1 - 9 * y2 + 3 * y3;\n      c = 3 * y1 - 3 * y0;\n    }\n\n    if (abs(a) < 1e-12) {\n\n      if (abs(b) < 1e-12) {\n        continue;\n      }\n\n      t = -c / b;\n\n      if (0 < t && t < 1) {\n        tvalues.push(t);\n      }\n\n      continue;\n    }\n\n    b2ac = b * b - 4 * c * a;\n    sqrtb2ac = math.sqrt(b2ac);\n\n    if (b2ac < 0) {\n      continue;\n    }\n\n    t1 = (-b + sqrtb2ac) / (2 * a);\n\n    if (0 < t1 && t1 < 1) {\n      tvalues.push(t1);\n    }\n\n    t2 = (-b - sqrtb2ac) / (2 * a);\n\n    if (0 < t2 && t2 < 1) {\n      tvalues.push(t2);\n    }\n  }\n\n  var j = tvalues.length,\n      jlen = j,\n      mt;\n\n  while (j--) {\n    t = tvalues[j];\n    mt = 1 - t;\n    bounds[0][j] = (mt * mt * mt * x0) + (3 * mt * mt * t * x1) + (3 * mt * t * t * x2) + (t * t * t * x3);\n    bounds[1][j] = (mt * mt * mt * y0) + (3 * mt * mt * t * y1) + (3 * mt * t * t * y2) + (t * t * t * y3);\n  }\n\n  bounds[0][jlen] = x0;\n  bounds[1][jlen] = y0;\n  bounds[0][jlen + 1] = x3;\n  bounds[1][jlen + 1] = y3;\n  bounds[0].length = bounds[1].length = jlen + 2;\n\n  return {\n    x0: mmin(...bounds[0]),\n    y0: mmin(...bounds[1]),\n    x1: mmax(...bounds[0]),\n    y1: mmax(...bounds[1])\n  };\n}\n\nfunction pathToCurve(path) {\n\n  var pth = paths(path);\n\n  // return cached curve, if existing\n  if (pth.curve) {\n    return pathClone(pth.curve);\n  }\n\n  var curvedPath = pathToAbsolute(path),\n      attrs = { x: 0, y: 0, bx: 0, by: 0, X: 0, Y: 0, qx: null, qy: null },\n      processPath = function(path, d, pathCommand) {\n        var nx, ny;\n\n        if (!path) {\n          return [ 'C', d.x, d.y, d.x, d.y, d.x, d.y ];\n        }\n\n        !(path[0] in { T: 1, Q: 1 }) && (d.qx = d.qy = null);\n\n        switch (path[0]) {\n        case 'M':\n          d.X = path[1];\n          d.Y = path[2];\n          break;\n        case 'A':\n          path = [ 'C', ...arcToCurve(d.x, d.y, ...path.slice(1)) ];\n          break;\n        case 'S':\n          if (pathCommand == 'C' || pathCommand == 'S') {\n\n            // In 'S' case we have to take into account, if the previous command is C/S.\n            nx = d.x * 2 - d.bx;\n\n            // And reflect the previous\n            ny = d.y * 2 - d.by;\n\n            // command's control point relative to the current point.\n          }\n          else {\n\n            // or some else or nothing\n            nx = d.x;\n            ny = d.y;\n          }\n          path = [ 'C', nx, ny, ...path.slice(1) ];\n          break;\n        case 'T':\n          if (pathCommand == 'Q' || pathCommand == 'T') {\n\n            // In 'T' case we have to take into account, if the previous command is Q/T.\n            d.qx = d.x * 2 - d.qx;\n\n            // And make a reflection similar\n            d.qy = d.y * 2 - d.qy;\n\n            // to case 'S'.\n          }\n          else {\n\n            // or something else or nothing\n            d.qx = d.x;\n            d.qy = d.y;\n          }\n          path = [ 'C', ...qubicToCurve(d.x, d.y, d.qx, d.qy, path[1], path[2]) ];\n          break;\n        case 'Q':\n          d.qx = path[1];\n          d.qy = path[2];\n          path = [ 'C', ...qubicToCurve(d.x, d.y, path[1], path[2], path[3], path[4]) ];\n          break;\n        case 'L':\n          path = [ 'C', ...lineToCurve(d.x, d.y, path[1], path[2]) ];\n          break;\n        case 'H':\n          path = [ 'C', ...lineToCurve(d.x, d.y, path[1], d.y) ];\n          break;\n        case 'V':\n          path = [ 'C', ...lineToCurve(d.x, d.y, d.x, path[1]) ];\n          break;\n        case 'Z':\n          path = [ 'C', ...lineToCurve(d.x, d.y, d.X, d.Y) ];\n          break;\n        }\n\n        return path;\n      },\n\n      fixArc = function(pp, i) {\n\n        if (pp[i].length > 7) {\n          pp[i].shift();\n          var pi = pp[i];\n\n          while (pi.length) {\n            pathCommands[i] = 'A'; // if created multiple C:s, their original seg is saved\n            pp.splice(i++, 0, [ 'C', ...pi.splice(0, 6) ]);\n          }\n\n          pp.splice(i, 1);\n          ii = curvedPath.length;\n        }\n      },\n\n      pathCommands = [], // path commands of original path p\n      pfirst = '', // temporary holder for original path command\n      pathCommand = ''; // holder for previous path command of original path\n\n  for (var i = 0, ii = curvedPath.length; i < ii; i++) {\n    curvedPath[i] && (pfirst = curvedPath[i][0]); // save current path command\n\n    if (pfirst != 'C') // C is not saved yet, because it may be result of conversion\n    {\n      pathCommands[i] = pfirst; // Save current path command\n      i && (pathCommand = pathCommands[i - 1]); // Get previous path command pathCommand\n    }\n    curvedPath[i] = processPath(curvedPath[i], attrs, pathCommand); // Previous path command is inputted to processPath\n\n    if (pathCommands[i] != 'A' && pfirst == 'C') pathCommands[i] = 'C'; // A is the only command\n    // which may produce multiple C:s\n    // so we have to make sure that C is also C in original path\n\n    fixArc(curvedPath, i); // fixArc adds also the right amount of A:s to pathCommands\n\n    var seg = curvedPath[i],\n        seglen = seg.length;\n\n    attrs.x = seg[seglen - 2];\n    attrs.y = seg[seglen - 1];\n    attrs.bx = toFloat(seg[seglen - 4]) || attrs.x;\n    attrs.by = toFloat(seg[seglen - 3]) || attrs.y;\n  }\n\n  // cache curve\n  pth.curve = pathClone(curvedPath);\n\n  return curvedPath;\n}","import {\n  getOriginal as getOriginalEvent\n} from './Event';\n\nimport {\n  isMac\n} from './Platform';\n\nexport {\n  isMac\n} from './Platform';\n\n/**\n * @param {MouseEvent} event\n * @param {string} button\n *\n * @return {boolean}\n */\nexport function isButton(event, button) {\n  return (getOriginalEvent(event) || event).button === button;\n}\n\n/**\n * @param {MouseEvent} event\n *\n * @return {boolean}\n */\nexport function isPrimaryButton(event) {\n\n  // button === 0 -> left áka primary mouse button\n  return isButton(event, 0);\n}\n\n/**\n * @param {MouseEvent} event\n *\n * @return {boolean}\n */\nexport function isAuxiliaryButton(event) {\n\n  // button === 1 -> auxiliary áka wheel button\n  return isButton(event, 1);\n}\n\n/**\n * @param {MouseEvent} event\n *\n * @return {boolean}\n */\nexport function isSecondaryButton(event) {\n\n  // button === 2 -> right áka secondary button\n  return isButton(event, 2);\n}\n\n/**\n * @param {MouseEvent} event\n *\n * @return {boolean}\n */\nexport function hasPrimaryModifier(event) {\n  var originalEvent = getOriginalEvent(event) || event;\n\n  if (!isPrimaryButton(event)) {\n    return false;\n  }\n\n  // Use cmd as primary modifier key for mac OS\n  if (isMac()) {\n    return originalEvent.metaKey;\n  } else {\n    return originalEvent.ctrlKey;\n  }\n}\n\n/**\n * @param {MouseEvent} event\n *\n * @return {boolean}\n */\nexport function hasSecondaryModifier(event) {\n  var originalEvent = getOriginalEvent(event) || event;\n\n  return isPrimaryButton(event) && originalEvent.shiftKey;\n}\n","import {\n  set as cursorSet,\n  unset as cursorUnset\n} from '../../util/Cursor';\n\nimport {\n  install as installClickTrap\n} from '../../util/ClickTrap';\n\nimport {\n  delta as deltaPos\n} from '../../util/PositionUtil';\n\nimport {\n  event as domEvent,\n  closest as domClosest\n} from 'min-dom';\n\nimport {\n  toPoint\n} from '../../util/Event';\n\n/**\n * @typedef {import('../../core/Canvas').default} Canvas\n * @typedef {import('../../core/EventBus').default} EventBus\n */\n\nvar THRESHOLD = 15;\n\n\n/**\n * Move the canvas via mouse.\n *\n * @param {EventBus} eventBus\n * @param {Canvas} canvas\n */\nexport default function MoveCanvas(eventBus, canvas) {\n\n  var context;\n\n  function handleMousedown(event) {\n    return handleStart(event.originalEvent);\n  }\n\n  // listen for move on element mouse down;\n  // allow others to hook into the event before us though\n  // (dragging / element moving will do this)\n  eventBus.on('canvas.focus.changed', function(event) {\n    if (event.focused) {\n      eventBus.on('element.mousedown', 500, handleMousedown);\n    } else {\n      eventBus.off('element.mousedown', handleMousedown);\n    }\n  });\n\n\n  function handleMove(event) {\n\n    var start = context.start,\n        button = context.button,\n        position = toPoint(event),\n        delta = deltaPos(position, start);\n\n    if (!context.dragging && length(delta) > THRESHOLD) {\n      context.dragging = true;\n\n      if (button === 0) {\n        installClickTrap(eventBus);\n      }\n\n      cursorSet('grab');\n    }\n\n    if (context.dragging) {\n\n      var lastPosition = context.last || context.start;\n\n      delta = deltaPos(position, lastPosition);\n\n      canvas.scroll({\n        dx: delta.x,\n        dy: delta.y\n      });\n\n      context.last = position;\n    }\n\n    // prevent select\n    event.preventDefault();\n  }\n\n\n  function handleEnd(event) {\n    domEvent.unbind(document, 'mousemove', handleMove);\n    domEvent.unbind(document, 'mouseup', handleEnd);\n\n    context = null;\n\n    cursorUnset();\n  }\n\n  function handleStart(event) {\n\n    // event is already handled by '.djs-draggable'\n    if (domClosest(event.target, '.djs-draggable')) {\n      return;\n    }\n\n    var button = event.button;\n\n    // reject right mouse button or modifier key\n    if (button >= 2 || event.ctrlKey || event.shiftKey || event.altKey) {\n      return;\n    }\n\n    context = {\n      button: button,\n      start: toPoint(event)\n    };\n\n    domEvent.bind(document, 'mousemove', handleMove);\n    domEvent.bind(document, 'mouseup', handleEnd);\n\n    // we've handled the event\n    return true;\n  }\n\n  this.isActive = function() {\n    return !!context;\n  };\n\n}\n\n\nMoveCanvas.$inject = [\n  'eventBus',\n  'canvas'\n];\n\n\n\n// helpers ///////\n\nfunction length(point) {\n  return Math.sqrt(Math.pow(point.x, 2) + Math.pow(point.y, 2));\n}\n","import MoveCanvas from './MoveCanvas';\n\n\n/**\n * @type { import('didi').ModuleDeclaration }\n */\nexport default {\n  __init__: [ 'moveCanvas' ],\n  moveCanvas: [ 'type', MoveCanvas ]\n};","import {\r\n  some\r\n} from 'min-dash';\r\n\r\n/**\r\n * @typedef { import('../model/Types').Element } Element\r\n * @typedef { import('../model/Types').ModdleElement } ModdleElement\r\n */\r\n\r\n/**\r\n * Is an element of the given BPMN type?\r\n *\r\n * @param  {Element|ModdleElement} element\r\n * @param  {string} type\r\n *\r\n * @return {boolean}\r\n */\r\nexport function is(element, type) {\r\n  var bo = getBusinessObject(element);\r\n\r\n  return bo && (typeof bo.$instanceOf === 'function') && bo.$instanceOf(type);\r\n}\r\n\r\n\r\n/**\r\n * Return true if element has any of the given types.\r\n *\r\n * @param {Element|ModdleElement} element\r\n * @param {string[]} types\r\n *\r\n * @return {boolean}\r\n */\r\nexport function isAny(element, types) {\r\n  return some(types, function(t) {\r\n    return is(element, t);\r\n  });\r\n}\r\n\r\n/**\r\n * Return the business object for a given element.\r\n *\r\n * @param {Element|ModdleElement} element\r\n *\r\n * @return {ModdleElement}\r\n */\r\nexport function getBusinessObject(element) {\r\n  return (element && element.businessObject) || element;\r\n}\r\n\r\n/**\r\n * Return the di object for a given element.\r\n *\r\n * @param {Element} element\r\n *\r\n * @return {ModdleElement}\r\n */\r\nexport function getDi(element) {\r\n  return element && element.di;\r\n}","/**\n * @typedef {import('../core/EventBus').default} EventBus\n */\n\nvar TRAP_PRIORITY = 5000;\n\n/**\n * Installs a click trap that prevents a ghost click following a dragging operation.\n *\n * @param {EventBus} eventBus\n * @param {string} [eventName='element.click']\n *\n * @return {() => void} a function to immediately remove the installed trap.\n */\nexport function install(eventBus, eventName) {\n\n  eventName = eventName || 'element.click';\n\n  function trap() {\n    return false;\n  }\n\n  eventBus.once(eventName, TRAP_PRIORITY, trap);\n\n  return function() {\n    eventBus.off(eventName, trap);\n  };\n}","import { assign } from 'min-dash';\n\n/**\n * @typedef {import('../../core/Canvas').default} Canvas\n * @typedef {import('../../features/keyboard/Keyboard').default} Keyboard\n */\n\nvar DEFAULT_CONFIG = {\n  moveSpeed: 50,\n  moveSpeedAccelerated: 200\n};\n\n\n/**\n * A feature that allows users to move the canvas using the keyboard.\n *\n * @param {Object} config\n * @param {number} [config.moveSpeed=50]\n * @param {number} [config.moveSpeedAccelerated=200]\n * @param {Keyboard} keyboard\n * @param {Canvas} canvas\n */\nexport default function KeyboardMove(\n    config,\n    keyboard,\n    canvas\n) {\n\n  var self = this;\n\n  this._config = assign({}, DEFAULT_CONFIG, config || {});\n\n  keyboard.addListener(arrowsListener);\n\n\n  function arrowsListener(context) {\n\n    var event = context.keyEvent,\n        config = self._config;\n\n    if (!keyboard.isCmd(event)) {\n      return;\n    }\n\n    if (keyboard.isKey([\n      'ArrowLeft', 'Left',\n      'ArrowUp', 'Up',\n      'ArrowDown', 'Down',\n      'ArrowRight', 'Right'\n    ], event)) {\n\n      var speed = (\n        keyboard.isShift(event) ?\n          config.moveSpeedAccelerated :\n          config.moveSpeed\n      );\n\n      var direction;\n\n      switch (event.key) {\n      case 'ArrowLeft':\n      case 'Left':\n        direction = 'left';\n        break;\n      case 'ArrowUp':\n      case 'Up':\n        direction = 'up';\n        break;\n      case 'ArrowRight':\n      case 'Right':\n        direction = 'right';\n        break;\n      case 'ArrowDown':\n      case 'Down':\n        direction = 'down';\n        break;\n      }\n\n      self.moveCanvas({\n        speed: speed,\n        direction: direction\n      });\n\n      return true;\n    }\n  }\n\n  /**\n   * @param {{\n   *   direction: 'up' | 'down' | 'left' | 'right';\n   *   speed: number;\n   * }} options\n   */\n  this.moveCanvas = function(options) {\n\n    var dx = 0,\n        dy = 0,\n        speed = options.speed;\n\n    var actualSpeed = speed / Math.min(Math.sqrt(canvas.viewbox().scale), 1);\n\n    switch (options.direction) {\n    case 'left': // Left\n      dx = actualSpeed;\n      break;\n    case 'up': // Up\n      dy = actualSpeed;\n      break;\n    case 'right': // Right\n      dx = -actualSpeed;\n      break;\n    case 'down': // Down\n      dy = -actualSpeed;\n      break;\n    }\n\n    canvas.scroll({\n      dx: dx,\n      dy: dy\n    });\n  };\n\n}\n\n\nKeyboardMove.$inject = [\n  'config.keyboardMove',\n  'keyboard',\n  'canvas'\n];\n","import KeyboardModule from '../../features/keyboard';\n\nimport KeyboardMove from './KeyboardMove';\n\n\n/**\n * @type { import('didi').ModuleDeclaration }\n */\nexport default {\n  __depends__: [\n    KeyboardModule\n  ],\n  __init__: [ 'keyboardMove' ],\n  keyboardMove: [ 'type', KeyboardMove ]\n};","import {\n  isObject,\n  sortBy\n} from 'min-dash';\n\nimport {\n  pointDistance,\n  pointsOnLine\n} from '../util/Geometry';\n\nimport intersectPaths from 'path-intersection';\n\nimport { isConnection } from '../util/ModelUtil';\n\n/**\n * @typedef {import('../core/Types').ElementLike} Element\n * @typedef {import('../core/Types').ConnectionLike} Connection\n *\n * @typedef {import('../util/Types').DirectionTRBL} DirectionTRBL\n * @typedef {import('../util/Types').Intersection} Intersection\n * @typedef {import('../util/Types').Point} Point\n * @typedef {import('../util/Types').Rect} Rect\n * @typedef {import('../util/Types').RectTRBL} RectTRBL\n */\n\n/**\n * @param {Rect} bounds\n *\n * @returns {Rect}\n */\nexport function roundBounds(bounds) {\n  return {\n    x: Math.round(bounds.x),\n    y: Math.round(bounds.y),\n    width: Math.round(bounds.width),\n    height: Math.round(bounds.height)\n  };\n}\n\n/**\n * @param {Point} point\n *\n * @returns {Point}\n */\nexport function roundPoint(point) {\n\n  return {\n    x: Math.round(point.x),\n    y: Math.round(point.y)\n  };\n}\n\n\n/**\n * Convert the given bounds to a { top, left, bottom, right } descriptor.\n *\n * @param {Point|Rect} bounds\n *\n * @return {RectTRBL}\n */\nexport function asTRBL(bounds) {\n  return {\n    top: bounds.y,\n    right: bounds.x + (bounds.width || 0),\n    bottom: bounds.y + (bounds.height || 0),\n    left: bounds.x\n  };\n}\n\n\n/**\n * Convert a { top, left, bottom, right } to an objects bounds.\n *\n * @param {RectTRBL} trbl\n *\n * @return {Rect}\n */\nexport function asBounds(trbl) {\n  return {\n    x: trbl.left,\n    y: trbl.top,\n    width: trbl.right - trbl.left,\n    height: trbl.bottom - trbl.top\n  };\n}\n\n\n/**\n * Get the mid of the given bounds or point.\n *\n * @param {Point|Rect} bounds\n *\n * @return {Point}\n */\nexport function getBoundsMid(bounds) {\n  return roundPoint({\n    x: bounds.x + (bounds.width || 0) / 2,\n    y: bounds.y + (bounds.height || 0) / 2\n  });\n}\n\n\n/**\n * Get the mid of the given Connection.\n *\n * @param {Connection} connection\n *\n * @return {Point}\n */\nexport function getConnectionMid(connection) {\n  var waypoints = connection.waypoints;\n\n  // calculate total length and length of each segment\n  var parts = waypoints.reduce(function(parts, point, index) {\n\n    var lastPoint = waypoints[index - 1];\n\n    if (lastPoint) {\n      var lastPart = parts[parts.length - 1];\n\n      var startLength = lastPart && lastPart.endLength || 0;\n      var length = distance(lastPoint, point);\n\n      parts.push({\n        start: lastPoint,\n        end: point,\n        startLength: startLength,\n        endLength: startLength + length,\n        length: length\n      });\n    }\n\n    return parts;\n  }, []);\n\n  var totalLength = parts.reduce(function(length, part) {\n    return length + part.length;\n  }, 0);\n\n  // find which segement contains middle point\n  var midLength = totalLength / 2;\n\n  var i = 0;\n  var midSegment = parts[i];\n\n  while (midSegment.endLength < midLength) {\n    midSegment = parts[++i];\n  }\n\n  // calculate relative position on mid segment\n  var segmentProgress = (midLength - midSegment.startLength) / midSegment.length;\n\n  var midPoint = {\n    x: midSegment.start.x + (midSegment.end.x - midSegment.start.x) * segmentProgress,\n    y: midSegment.start.y + (midSegment.end.y - midSegment.start.y) * segmentProgress\n  };\n\n  return midPoint;\n}\n\n\n/**\n * Get the mid of the given Element.\n *\n * @param {Element} element\n *\n * @return {Point}\n */\nexport function getMid(element) {\n  if (isConnection(element)) {\n    return getConnectionMid(element);\n  }\n\n  return getBoundsMid(element);\n}\n\n// orientation utils //////////////////////\n\n/**\n * Get orientation of the given rectangle with respect to\n * the reference rectangle.\n *\n * A padding (positive or negative) may be passed to influence\n * horizontal / vertical orientation and intersection.\n *\n * @param {Rect} rect\n * @param {Rect} reference\n * @param {Point|number} padding\n *\n * @return {DirectionTRBL|Intersection} the orientation; one of top, top-left, left, ..., bottom, right or intersect.\n */\nexport function getOrientation(rect, reference, padding) {\n\n  padding = padding || 0;\n\n  // make sure we can use an object, too\n  // for individual { x, y } padding\n  if (!isObject(padding)) {\n    padding = { x: padding, y: padding };\n  }\n\n\n  var rectOrientation = asTRBL(rect),\n      referenceOrientation = asTRBL(reference);\n\n  var top = rectOrientation.bottom + padding.y <= referenceOrientation.top,\n      right = rectOrientation.left - padding.x >= referenceOrientation.right,\n      bottom = rectOrientation.top - padding.y >= referenceOrientation.bottom,\n      left = rectOrientation.right + padding.x <= referenceOrientation.left;\n\n  var vertical = top ? 'top' : (bottom ? 'bottom' : null),\n      horizontal = left ? 'left' : (right ? 'right' : null);\n\n  if (horizontal && vertical) {\n    return vertical + '-' + horizontal;\n  } else {\n    return horizontal || vertical || 'intersect';\n  }\n}\n\n\n// intersection utils //////////////////////\n\n/**\n * Get intersection between an element and a line path.\n *\n * @param {string} elementPath\n * @param {string} linePath\n * @param {boolean} cropStart Whether to crop start or end.\n *\n * @return {Point}\n */\nexport function getElementLineIntersection(elementPath, linePath, cropStart) {\n\n  var intersections = getIntersections(elementPath, linePath);\n\n  // recognize intersections\n  // only one -> choose\n  // two close together -> choose first\n  // two or more distinct -> pull out appropriate one\n  // none -> ok (fallback to point itself)\n  if (intersections.length === 1) {\n    return roundPoint(intersections[0]);\n  } else if (intersections.length === 2 && pointDistance(intersections[0], intersections[1]) < 1) {\n    return roundPoint(intersections[0]);\n  } else if (intersections.length > 1) {\n\n    // sort by intersections based on connection segment +\n    // distance from start\n    intersections = sortBy(intersections, function(i) {\n      var distance = Math.floor(i.t2 * 100) || 1;\n\n      distance = 100 - distance;\n\n      distance = (distance < 10 ? '0' : '') + distance;\n\n      // create a sort string that makes sure we sort\n      // line segment ASC + line segment position DESC (for cropStart)\n      // line segment ASC + line segment position ASC (for cropEnd)\n      return i.segment2 + '#' + distance;\n    });\n\n    return roundPoint(intersections[cropStart ? 0 : intersections.length - 1]);\n  }\n\n  return null;\n}\n\n\nexport function getIntersections(a, b) {\n  return intersectPaths(a, b);\n}\n\n\nexport function filterRedundantWaypoints(waypoints) {\n\n  // alter copy of waypoints, not original\n  waypoints = waypoints.slice();\n\n  var idx = 0,\n      point,\n      previousPoint,\n      nextPoint;\n\n  while (waypoints[idx]) {\n    point = waypoints[idx];\n    previousPoint = waypoints[idx - 1];\n    nextPoint = waypoints[idx + 1];\n\n    if (pointDistance(point, nextPoint) === 0 ||\n        pointsOnLine(previousPoint, nextPoint, point)) {\n\n      // remove point, if overlapping with {nextPoint}\n      // or on line with {previousPoint} -> {point} -> {nextPoint}\n      waypoints.splice(idx, 1);\n    } else {\n      idx++;\n    }\n  }\n\n  return waypoints;\n}\n\n// helpers //////////////////////\n\nfunction distance(a, b) {\n  return Math.sqrt(Math.pow(a.x - b.x, 2) + Math.pow(a.y - b.y, 2));\n}","var DEFAULT_RENDER_PRIORITY = 1000;\n\n/**\n * @typedef {import('../core/Types').ElementLike} Element\n * @typedef {import('../core/Types').ConnectionLike} Connection\n * @typedef {import('../core/Types').ShapeLike} Shape\n *\n * @typedef {import('../core/EventBus').default} EventBus\n */\n\n/**\n * The base implementation of shape and connection renderers.\n *\n * @param {EventBus} eventBus\n * @param {number} [renderPriority=1000]\n */\nexport default function BaseRenderer(eventBus, renderPriority) {\n  var self = this;\n\n  renderPriority = renderPriority || DEFAULT_RENDER_PRIORITY;\n\n  eventBus.on([ 'render.shape', 'render.connection' ], renderPriority, function(evt, context) {\n    var type = evt.type,\n        element = context.element,\n        visuals = context.gfx,\n        attrs = context.attrs;\n\n    if (self.canRender(element)) {\n      if (type === 'render.shape') {\n        return self.drawShape(visuals, element, attrs);\n      } else {\n        return self.drawConnection(visuals, element, attrs);\n      }\n    }\n  });\n\n  eventBus.on([ 'render.getShapePath', 'render.getConnectionPath' ], renderPriority, function(evt, element) {\n    if (self.canRender(element)) {\n      if (evt.type === 'render.getShapePath') {\n        return self.getShapePath(element);\n      } else {\n        return self.getConnectionPath(element);\n      }\n    }\n  });\n}\n\n/**\n * Checks whether an element can be rendered.\n *\n * @param {Element} element The element to be rendered.\n *\n * @return {boolean} Whether the element can be rendered.\n */\nBaseRenderer.prototype.canRender = function(element) {};\n\n/**\n * Draws a shape.\n *\n * @param {SVGElement} visuals The SVG element to draw the shape into.\n * @param {Shape} shape The shape to be drawn.\n *\n * @return {SVGElement} The SVG element of the shape drawn.\n */\nBaseRenderer.prototype.drawShape = function(visuals, shape) {};\n\n/**\n * Draws a connection.\n *\n * @param {SVGElement} visuals The SVG element to draw the connection into.\n * @param {Connection} connection The connection to be drawn.\n *\n * @return {SVGElement} The SVG element of the connection drawn.\n */\nBaseRenderer.prototype.drawConnection = function(visuals, connection) {};\n\n/**\n * Gets the SVG path of the graphical representation of a shape.\n *\n * @param {Shape} shape The shape.\n *\n * @return {string} The SVG path of the shape.\n */\nBaseRenderer.prototype.getShapePath = function(shape) {};\n\n/**\n * Gets the SVG path of the graphical representation of a connection.\n *\n * @param {Connection} connection The connection.\n *\n * @return {string} The SVG path of the connection.\n */\nBaseRenderer.prototype.getConnectionPath = function(connection) {};\n"],"names":["DEFAULT_LABEL_SIZE","width","height","FLOW_LABEL_INDENT","isLabelExternal","semantic","is","hasExternalLabel","element","isLabel","label","getFlowLabelPosition","waypoints","mid","length","first","Math","floor","second","ceil","position","x","y","getWaypointsMid","angle","atan","abs","PI","getExternalLabelMid","getExternalLabelBounds","di","size","bounds","max","assign","getLabelAttr","getLabel","businessObject","attr","categoryValueRef","value","getCategoryValue","setLabel","text","allowAll","event","allowPrimaryAndAuxiliary","isPrimaryButton","isAuxiliaryButton","InteractionEvents","eventBus","elementRegistry","styles","self","this","fire","type","target","gfx","localEventName","ignoredFilters","isIgnored","getGraphics","delegateTarget","get","originalEvent","stopPropagation","preventDefault","handlers","mouseHandler","bindings","click","contextmenu","dblclick","mousedown","mousemove","mouseover","mouseout","mouseup","registerEvent","node","localEvent","ignoredFilter","handler","$delegate","domDelegate","bind","unregisterEvent","unbind","on","svg","forEach","val","key","createDefaultHit","updateDefaultHit","STROKE_HIT_STYLE","createHitStyle","CLICK_STROKE_HIT_STYLE","HIT_TYPES","classNames","attrs","stroke","strokeWidth","cls","applyStyle","hit","Error","svgAttr","appendHit","svgAppend","removeHits","hits","domQueryAll","svgRemove","boxType","isFrame","createWaypointsHit","createBoxHit","createLine","svgCreate","domQuery","updateLine","triggerMouseEvent","eventName","targetElement","$inject","__init__","interactionEvents","flatten","arr","Array","prototype","concat","apply","nativeToString","Object","toString","nativeHasOwnProperty","hasOwnProperty","isUndefined","obj","undefined","isDefined","isNil","isArray","call","isObject","isNumber","isFunction","tag","isString","has","find","collection","matcher","matchFn","toMatcher","match","findIndex","idx","filter","result","push","iterator","convertKey","toNum","identity","without","ensureArray","el","reduce","every","matches","some","map","fn","keys","values","groupBy","extractor","grouped","arguments","toExtractor","discriminator","group","uniqueBy","_len","collections","_key","c","unionBy","sortBy","sorted","disc","entry","d","v","splice","e","matchPattern","pattern","arg","Number","debounce","timeout","timer","lastArgs","lastThis","lastNow","force","now","Date","scheduledDiff","schedule","clear","setTimeout","clearTimeout","callback","_len2","args","_key2","flush","cancel","_len3","others","_key3","set","path","currentTarget","nextKey","nextTarget","isNaN","pick","properties","prop","omit","indexOf","ElementFactory","_uid","createRoot","create","createLabel","createShape","createConnection","id","hat","module","exports","bits","base","digits","log","pow","i","Infinity","rem","res","random","b","parsed","parseInt","rack","expandBy","data","iters","hats","Ids","seed","_seed","hat_1","next","nextPrefixed","prefix","assigned","claim","unclaim","extend","refs","property","inverseProperty","inverse","defineProperty","unset","currentIdx","isExtended","__refs_collection","defineCollectionProperty","ref","name","enumerable","o","Refs","a","props","_value","configurable","old","ensureRefsCollection","ensureBound","remove","add","parentRefs","labelRefs","attacherRefs","outgoingRefs","incomingRefs","ElementImpl","writable","labels","newLabel","ShapeImpl","RootImpl","LabelImpl","ConnectionImpl","inherits","types","connection","shape","root","Type","isModelElement","CURSOR_CLS_PATTERN","mode","classes","domClasses","document","body","removeMatching","t","super_","constructor","getVisual","childNodes","getChildren","parentNode","isMac","test","navigator","platform","__stopPropagation","getOriginal","srcEvent","toPoint","pointers","touches","clientX","clientY","CLASS_PATTERN","hasOwnProp","annotate","pop","CONSTRUCTOR_ARGS","FN_ARGS","FN_ARG","parseAnnotations","isClass","split","argMatch","trim","Injector","modules","_parent","parent","strict","currentlyResolving","error","providers","_providers","instances","_instances","injector","msg","stack","join","includes","parts","pivot","shift","fnDef","locals","slice","dependencies","dep","instantiate","Function","invoke","func","context","createPrivateInjectorFactory","childInjector","createChild","forceNewInstances","fromParentModule","matchedScopes","privateInjectorsCache","privateChildInjectors","privateChildFactories","provider","cacheIdx","privateChildInjector","privateChildInjectorFactory","$scope","scope","unshift","factoryMap","factory","createInitializer","moduleDefinition","initializers","initializer","loadModule","moduleExports","__exports__","nestedModules","__modules__","clonedModule","privateInjector","getFromPrivateInjector","init","typeDeclaration","arrayUnwrap","resolveDependencies","moduleDefinitions","__depends__","initialized","bootstrap","DefaultRenderer","BaseRenderer","CONNECTION_STYLE","style","SHAPE_STYLE","fill","FRAME_STYLE","strokeDasharray","canRender","drawShape","visuals","rect","isFrameElement","drawConnection","line","getShapePath","shapePath","componentsToPath","getConnectionPath","point","connectionPath","original","defaultRenderer","defaultTraits","strokeOpacity","pointerEvents","className","traits","additionalAttrs","computeStyle","custom","defaultStyles","round","number","resolution","ensurePx","createGroup","childIndex","svgClasses","index","insertBefore","REQUIRED_MODEL_ATTRS","Canvas","config","graphicsFactory","_eventBus","_elementRegistry","_graphicsFactory","_rootsIdx","_layers","_planes","_rootElement","_focused","_init","setCTM","m","mstr","f","setAttribute","container","_container","options","createElement","assignStyle","overflow","appendChild","createContainer","_svg","domAttr","autoFocus","restoreFocus","focus","addEventListener","_setFocused","viewport","_viewport","deferUpdate","_viewboxChanged","_cachedViewbox","_destroy","_clear","removeChild","focused","getAll","getType","removeRootElement","_removeElement","preventScroll","activeElement","isFocused","getDefaultLayer","getLayer","layer","_createLayer","_getChildIndex","visible","showLayer","hideLayer","_removeLayer","getActiveLayer","plane","_findPlaneForRoot","getRootElement","findRoot","rootElement","getRootElements","getContainer","_updateMarker","marker","markers","Set","_elements","secondaryGfx","delete","addMarker","removeMarker","hasMarker","toggleMarker","setRootElement","addRootElement","children","isImplicit","layerName","_ensureValid","_addRoot","_removeRoot","_setRoot","currentRoot","updateGraphics","requiredAttrs","_setParent","parentIndex","collectionAdd","_addElement","update","addShape","addConnection","collectionRemove","removeShape","removeConnection","secondary","_changeViewbox","changeFn","viewbox","box","structuredClone","outerBox","getSize","innerBox","matrix","activeLayer","transform","scale","min","createSVGMatrix","translate","svgTransform","getBBox","createMatrix","inner","outer","scroll","delta","getCTM","dx","dy","multiply","scrollToElement","padding","defaultPadding","top","right","bottom","left","elementBounds","getBoundingBox","elementTrbl","asTRBL","viewboxBounds","zoom","viewboxTrbl","dRight","dLeft","dBottom","dTop","newScale","center","_fitViewport","_setZoom","vbox","newViewbox","createSVGPoint","centerPoint","originalPoint","currentMatrix","scaleMatrix","newMatrix","currentScale","matrixTransform","clientWidth","clientHeight","getAbsoluteBBox","bbox","resized","ELEMENT_ID","ElementRegistry","_validateId","elements","updateId","newId","filtered","FN_REF","EventBus","_listeners","InternalEvent","events","priority","that","actualCallback","_addListener","once","wrappedCallback","__isTomb","off","_removeListener","createEvent","firstListener","returnValue","originalType","_invokeListeners","defaultPrevented","handleError","listener","cancelBubble","_invokeListener","invokeFunction","console","newListener","previousListener","_getListeners","_setListeners","nextListener","listenerCallback","GraphicsFactory","prependTo","newNode","siblingNode","firstChild","_getChildrenContainer","childrenGfx","visual","domClear","_createContainer","outerGfx","updateContainments","parents","reverse","child","hidden","DrawModule","canvas","elementFactory","createInjector","CoreModule","Diagram","_injector","Base","Factory","model","destroy","$model","createType","descriptor","p","isMany","default","defineModel","defineDescriptor","ns","ModdleElement","define","hasType","$instanceOf","BUILTINS","String","Boolean","Integer","Real","Element","TYPE_CONVERTERS","s","parseFloat","coerceType","converter","isBuiltIn","isSimple","parseName","defaultPrefix","localName","DescriptorBuilder","nameNs","allTypes","allTypesByName","propertiesByName","Registry","packages","packageMap","typeMap","registerPackage","ensureAvailable","pkg","identifierKey","Properties","isReference","stripGlobal","replace","Moddle","registry","typeCache","build","addProperty","validate","addNamedProperty","replaceProperty","oldProperty","newProperty","oldNameNs","rename","isId","setIdProperty","isBody","setBodyProperty","redefineProperty","targetPropertyName","nsPrefix","attrName","redefinedProperty","redefines","propsByName","assertNotDefined","removeNamedProperty","bodyProperty","idProperty","assertNotTrait","typeDescriptor","extends","propertyName","definedProperty","definedBy","hasProperty","addTrait","inherited","typesByName","typeName","replaces","getPackage","uriOrPrefix","getPackages","pkgMap","registerType","uri","superClass","meta","propertyNs","extendsName","extendsNameNs","extended","definePackage","mapTypes","nsName","trait","traverse","parentNs","traverseTrait","getEffectiveDescriptor","builder","$pkg","TypeError","getProperty","$attrs","getPropertyDescriptor","$type","warn","cache","createAny","nsUri","isGeneric","getElementDescriptor","$descriptor","getTypeDescriptor","fromCharCode","ENTITY_PATTERN","ENTITY_MAPPING","replaceEntities","_","z","decodeEntities","k","toUpperCase","NON_WHITESPACE_OUTSIDE_ROOT_NODE","missingNamespaceForPrefix","getter","getFn","cloneNsMatrix","nsMatrix","clone","uriPrefix","noopGetContext","column","throwFunc","err","Parser","onText","onOpenTag","onCloseTag","onCDATA","onWarning","onComment","onQuestion","onAttention","nsUriToPrefix","proxy","onError","getContext","maybeNS","isNamespace","returnError","parseStop","handleWarning","cb","nsMap","_nsUriToPrefix","xml","_nsMatrix","q","w","xmlns","elementName","_elementName","elementProxy","cachedAttrs","nsMatrixStack","buildNsMatrix","nodeStack","anonymousNsCount","tagStart","tagEnd","j","attrsString","attrsStart","getAttrs","nsUriPrefix","hasNewMatrix","newalias","alias","skipAttr","defaultAlias","attrList","l","seenAttrs","parseAttr","charCodeAt","substring","substr","getParseContext","splitsRe","startOfLine","endOfLine","exec","parse","hasLowerCaseAlias","tagAlias","DEFAULT_NS_MAP","SERIALIZE_PROPERTY","getSerialization","serialize","aliasToName","aliasNs","str","charAt","message","getModdleDescriptor","Context","elementsById","references","warnings","addReference","reference","addElement","addWarning","warning","BaseHandler","NoopHandler","BodyHandler","ReferenceHandler","ValueHandler","propertyDesc","BaseElementHandler","ElementHandler","RootElementHandler","GenericElementHandler","Reader","lax","handleEnd","handleText","handleNode","createReference","parser","handleChild","propNameNs","attributes","instance","parseNameNS","getPropertyForNode","isAttr","serializationType","getSerializationType","elementTypeName","normalizedTypeName","normalizedNameNs","typePrefix","prefixedToName","normalizeTypeName","elementType","effectiveType","isVirtual","isAttribute","valueHandler","referenceHandler","childHandler","isSimpleType","newElement","$parent","originalName","$children","$body","fromXML","done","rootHandler","createStack","ctx","PREAMBLE_START_PATTERN","ENCODING_PATTERN","UTF_8_PATTERN","handleCData","peek","uriMap","entries","_ref","url","decodeStr","selfClosing","decodedAttrs","handleOpen","question","encoding","Promise","resolve","reject","r","resolveReferences","ESCAPE_ATTR_CHARS","ESCAPE_CHARS","Namespaces","prefixMap","used","wellknown","defaultPrefixMap","nameToAlias","string","toLowerCase","ctor","superCtor","mapDefaultPrefixes","defaultUriByPrefix","byUri","isWellknown","mapPrefix","uriByPrefix","getNSKey","logUsed","nsKey","getUsed","ESCAPE_ATTR_MAP","ESCAPE_MAP","escape","charPattern","replaceMap","ReferenceSerializer","tagName","BodySerializer","ValueSerializer","ElementSerializer","propertyDescriptor","TypeSerializer","serialization","SavingWriter","write","FormatingWriter","out","format","indent","append","appendNewLine","appendIndent","unindent","Writer","preamble","toXML","tree","writer","internalWriter","formatingWriter","serializer","getNamespaces","getDefaultPrefixMappings","serializeTo","BpmnModdle","serializeValue","search","otherAttrs","elementDescriptor","parseGenericNsAttributes","parseNsAttributes","nsPropertyTagName","nsTagName","addTagName","parseGenericContainments","getSerializableProperties","parseAttributes","parseContainments","filterContained","parseGenericAttributes","getElementNs","logNamespaceUsed","getPropertyNs","isLocalNs","nsAttributeName","effectiveNs","_ref2","startsWith","parseNsAttribute","_ref3","logNamespace","actualNs","genericAttrs","nonNsAttr","addAttribute","local","parentNamespaces","namespaces","newPrefix","wellknownUri","serializeAttributes","getNsAttrs","firstBody","typeNs","xmlStr","reader","bpmn","bpmndi","dc","bioc","color","SimpleBpmnModdle","additionalPackages","BpmnTreeWalker","handledElements","deferred","diMap","contextual","handled","visitIfDi","elementToString","visit","logError","registerDi","bpmnElement","ensureCompatDiRef","handleDiagram","diagram","planeElement","handlePlaneElement","handleDefinitions","definitions","diagrams","rootElements","findDisplayCandidate","collaboration","visitRoot","handleProcess","participants","handleParticipant","messageFlows","handleMessageFlow","handleMessageFlows","handleArtifacts","artifacts","laneSets","handleUnhandledProcesses","handleDeferred","process","handleFlowElementsContainer","handleIoSpecification","ioSpecification","messageFlow","handleDataAssociation","association","handleDataInput","dataInput","handleDataOutput","dataOutput","handleArtifact","artifact","dataInputs","dataOutputs","handleSubProcess","subProcess","handleFlowNode","flowNode","childCtx","dataInputAssociations","dataOutputAssociations","handleDataElement","dataObject","handleLane","lane","newContext","childLaneSet","handleLaneSet","flowNodeRef","lanes","wireFlowNodeRefs","laneSet","flowElements","flowElement","sequenceFlow","handleSequenceFlow","handleFlowElements","handleLaneSets","participant","newCtx","processRef","importBpmnDiagram","bpmnDiagram","importer","render","walker","parentShape","diagramsToImport","findRootProcess","allChildren","selfAndAllFlowElements","getDiagramsToImport","rootId","lightbox","BPMNIO_IMG","LOGO_STYLES","verticalAlign","LINK_STYLES","LIGHTBOX_STYLES","BACKDROP_STYLES","NOTICE_STYLES","LIGHTBOX_MARKUP","open","domify","BaseViewer","DEFAULT_OPTIONS","_moddle","_createModdle","linkMarkup","linkElement","zIndex","domEvent","openPoweredBy","addProjectLogo","addWarningsToError","warningsAry","importXML","async","aggregatedWarnings","parseResult","_emit","parseWarnings","importResult","importDefinitions","checkValidationError","_setDefinitions","bpmnDiagramOrId","_definitions","diagramId","findBPMNDiagram","saveXML","saveSVG","contentNode","defsNode","contents","innerSVG","defs","getModules","_modules","getDefinitions","domRemove","attachTo","detach","jquery","moddle","baseModules","additionalModules","diagramModules","bpmnjs","diagramOptions","ensureUnit","_moddleExtensions","moddleExtensions","planeSuffix","getShapeIdFromPlane","RegExp","removePlaneSuffix","getPlaneIdFromShape","addPlaneSuffix","toPlaneId","isPlane","getDi","black","isTypedEvent","eventDefinitionType","eventDefinitions","definition","getFillColor","defaultColor","overrideColor","getStrokeColor","getLabelColor","defaultStrokeColor","getBounds","overrides","getWidth","getHeight","markerIds","DEFAULT_OPACITY","BpmnRenderer","pathMap","textRenderer","defaultFillColor","defaultLabelColor","shapeStyle","strokeLinecap","strokeLinejoin","lineStyle","parentGfx","viewBox","refX","refY","markerWidth","markerHeight","orient","_objectSpread","cx","cy","createMarker","drawCircle","offset","circle","drawRect","rx","ry","drawLine","radius","drawConnectionSegments","drawPath","drawMarker","renderer","as","eventIconRenderers","isThrowing","getScaledPath","xScaleFactor","yScaleFactor","containerWidth","containerHeight","mx","my","baseWidth","baseHeight","rotate","renderEventIcon","proxyElement","getSemantic","nodeElement","taskMarkerRenderers","markerRect","parallel","seq","compensation","loop","strokeMiterlimit","adhoc","renderTaskMarker","renderTaskMarkers","taskMarkers","subprocess","loopCharacteristics","isSequential","renderLabel","createText","renderEmbeddedLabel","align","renderLaneLabel","isHorizontalLane","isHorizontal","textBox","renderActivity","fillOpacity","renderAssociation","markerEnd","markerStart","pickAttrs","renderDataObject","dataObjectRef","isCollection","renderEvent","renderGateway","x_2","y_2","pointsString","polygon","points","drawDiamond","renderLane","renderSubProcess","activity","expanded","isExpanded","isEventSubProcess","startEvents","startEvent","iconSize","proxyAttrs","interrupting","isInterrupting","circleSize","renderEventSubProcessIcon","renderTask","renderIcon","cancelActivity","task","businessPath","abspos","businessHeaderPath","gateway","arrowPathData","getRawPath","diamond","pathData","drawEvent","midPoint","getPointAtLength","getTotalLength","markerPathData","messageAttrs","fitBox","messageBounds","labelBounds","translateX","translateY","expandedParticipant","horizontalParticipant","source","sourceSemantic","textElement","innerAttrs","TASK_BORDER_RADIUS","getExternalStyle","renderExternalLabel","_drawPath","_renderer","pickedAttrs","circlePath","getCirclePath","borderRadius","roundRectPath","getRoundRectPath","halfWidth","halfHeight","diamondPath","getDiamondPath","rectPath","getRectPath","getTextBBox","fakeText","textBBox","textContent","emptyLine","layoutNext","lines","maxWidth","originalLine","fitLine","fit","shortenLine","remainder","SOFT_BREAK","shortenedLine","maxLength","part","shortenedParts","last","semanticShorten","Text","_config","layoutText","getDimensions","dimensions","horizontal","vertical","parseAlign","parsePadding","lineHeight","fontSize","getLineHeight","layouted","helperText","helperSvg","getElementById","visibility","getHelperSvg","totalHeight","sum","maxLineWidth","tspan","TextRenderer","defaultStyle","fontFamily","fontWeight","externalStyle","textUtil","TextUtil","layoutedDimensions","getTextAnnotationBounds","getDefaultStyle","tokenRegex","objNotationRegex","bpmnRenderer","heightElements","widthElements","pathId","param","rawPath","coordinates","heightRatio","widthRatio","heightIndex","widthIndex","all","quote","quotedName","isFunc","replacer","elementData","getWaypoints","waypoint","getMid","notYetDrawn","refSemantic","BpmnImporter","_canvas","_elementFactory","_textRenderer","parentElement","collapsed","_attachBoundary","isPointInsideBBox","_getSource","_getTarget","addLabel","boundarySemantic","boundaryElement","hostSemantic","attachedToRef","host","attachers","labelTarget","_getConnectedElement","side","_getElement","bpmnImporter","RootElementsBehavior","CommandInterceptor","executed","revert","rootElementsBehavior","DrilldownBreadcrumbs","breadcrumbs","containerClasses","businessObjectParents","updateBreadcrumbs","getBusinessObject","getBusinessObjectParentChain","flatMap","parentPlane","title","escapeHTML","link","innerHTML","toggle","DrilldownCentering","positionMap","Map","newRoot","currentViewbox","storedViewbox","_entries","found","DEFAULT_POSITION","SubprocessCompatibility","_handleImport","findRootDiagram","_processToDiagramMap","_createNewDiagrams","_movePlaneElementsToOrigin","collapsedElements","elementsToMove","diElement","isAny","shouldMoveToPlane","newDiagrams","_createDiagram","_moveToDiPlane","planeBounds","planeTrbl","trbl","asBounds","getPlaneBounds","newPlane","parentPlaneElement","LOW_PRIORITY","DrilldownOverlayBehavior","overlays","_overlays","_translate","_canDrillDown","_addOverlay","_removeOverlay","reverted","oldParent","newParent","_updateDrilldownOverlay","_updateOverlayVisibility","overlay","hasFlowElements","html","bo","button","OverlaysModule","ChangeSupportModule","RootElementsModule","drilldownBreadcrumbs","drilldownCentering","drilldownOverlayBehavior","subprocessCompatibility","Viewer","DrilldownModdule","SelectionModule","TranslateModule","isConnection","styleSources","getAttribute","removeAttribute","ClassList","nodeType","list","classList","closest","selector","checkYourSelf","actualElement","re","array","from","contains","bind$1","unbind$1","detect","window","removeEventListener","componentEvent","capture","forceCaptureEvents","bugTestDiv","delegate","srcElement","doc","createTextNode","lastChild","wrap","_default","depth","suffix","fragment","createDocumentFragment","innerHTMLBug","getElementsByTagName","legend","tr","col","td","th","option","optgroup","thead","tbody","colgroup","caption","tfoot","polyline","ellipse","g","query","querySelector","querySelectorAll","ensureImported","ownerDocument","importNode","appendTo","LENGTH_ATTR","CSS_PROPERTIES","hyphenated","setAttributeNS","getAttributeNS","names","setAttributes","cloneNode","SVG_START","unwrap","DOMParser","parseFromString","parseDocument","createElementNS","getNode","object","createTransform","createSVGTransformFromMatrix","createSVGTransform","TEXT_ENTITIES","ATTR_ENTITIES","ENTITY_REPLACEMENT","entity","output","len","attrMap","attrNode","hasAttributes","item","hasChildNodes","nodeValue","nodeName","isFragment","documentElement","nodes","nextSibling","wrapMatrix","transformList","SVGMatrix","transforms","baseVal","appendItem","setTransforms","consolidate","escapeCSS","CSS","HTML_ESCAPE_MAP","NavigatedViewer","_navigationModules","KeyboardMoveModule","MoveCanvasModule","ZoomScrollModule","pointDistance","sqrt","pointsOnLine","accuracy","dist","ALIGNED_THRESHOLD","pointsAligned","flat","axisMap","axis","orientation","pointsAlignedOnAxis","referencePoint","pointInRect","tolerance","getMidPoint","amount","setTranslate","setRotate","setScale","template","replacements","DI_ERROR_MESSAGE","Selection","_selectedElements","deselect","select","selectedElements","oldSelection","newSelection","isSelected","elementRoot","MARKER_HOVER","MARKER_SELECTED","SelectionVisuals","SelectionBehavior","selection","canExecute","autoSelect","hints","isShown","previousSelection","selectedShape","isMultiSelect","hasSecondaryModifier","InteractionEventsModule","selectionVisuals","selectionBehavior","log10","getStepSize","range","steps","minLinearRange","maxLinearRange","sign","n","RANGE","ZoomScroll","_enabled","_handleWheel","_totalDelta","_scale","enabled","reset","stepSize","NUM_STEPS","_zoom","isZoom","ctrlKey","metaKey","isHorizontalScroll","shiftKey","factor","deltaMode","elementRect","getBoundingClientRect","deltaY","deltaX","stepZoom","direction","currentLinearZoomLevel","newLinearZoomLevel","newLogZoomLevel","newEnabled","handleWheel","oldEnabled","zoomScroll","KEYS_COPY","KEYS_PASTE","KEYS_REDO","KEYS_UNDO","hasModifier","altKey","isCmd","isKey","code","isShift","isCopy","isPaste","isUndo","isRedo","triggeredByEvent","hasEventDefinition","eventType","hasErrorEventDefinition","hasEscalationEventDefinition","hasCompensateEventDefinition","IdGenerator","_counter","_prefix","ids","Overlays","_ids","_overlayDefaults","show","defaults","_overlayContainers","_overlayRoot","setPosition","setVisible","display","setTransform","_getOverlayContainer","htmlContainer","hide","_updateOverlayContainer","_updateOverlay","_updateOverlayVisibilty","_createOverlayContainer","_updateRoot","raw","overlayContainer","minZoom","maxZoom","_updateOverlayScale","minScale","maxScale","shouldScale","_updateOverlaysVisibilty","getParents","getParent","unique","canAdd","eachElement","selfAndChildren","maxDepth","processedChildren","selfAndAllChildren","allowDuplicates","getClosure","isTopLevel","closure","allShapes","copyObject","allConnections","enclosedElements","enclosedConnections","topLevel","handleConnection","incoming","outgoing","stopRecursion","minX","minY","maxX","maxY","getEnclosedElements","filteredElements","src1","src2","createHook","hook","handlerFn","fullEvent","command","unwrapEvent","preExecute","preExecuted","execute","postExecute","postExecuted","lineTo","curveTo","p1","p2","p3","cornerRadius","pointCount","pointBefore","pointAfter","effectiveRadius","vectorLength","beforePoint","beforePoint2","afterPoint","afterPoint2","start","end","percent","dataset","KEYDOWN_EVENT","compatMessage","Keyboard","_keydownHandler","_keyupHandler","_fire","bindTo","_target","_keyHandler","_isEventIgnored","keyEvent","_node","getBinding","addListener","removeListener","keyboard","keyboardBindings","KeyboardBindings","editorActions","registerBindings","action","isRegistered","trigger","ChangeSupport","getElementType","changeSupport","p2s","toFloat","math","mmin","mmax","pathCommand","pathValues","paths","ps","sleep","rectBBox","x2","y2","pathToString","pathClone","pathArray","findDotsAtSegment","p1x","p1y","c1x","c1y","c2x","c2y","p2x","p2y","t1","t13","t12","t3","fixError","bezierBBox","x0","y0","x1","y1","x3","y3","t2","b2ac","sqrtb2ac","tvalues","mt","jlen","curveBBox","base3","p4","bezlen","x4","y4","z2","Tvalues","Cvalues","ct","xbase","ybase","comb","intersectLines","ny","denominator","px","py","px2","toFixed","py2","findBezierIntersections","bez1","bez2","justCount","bbox1","bbox2","isBBoxIntersect","l1","l2","n1","isLine","n2","dots1","dots2","xy","di1","dj","dj1","ci","cj","findPathIntersections","path1","path2","pathToCurve","x1m","y1m","x2m","y2m","ii","pi","jj","pj","intr","kk","segment1","segment2","pathToAbsolute","pth","pathString","paramCounts","h","params","parsePathString","pa0","pa","bez","lineToCurve","qubicToCurve","ax","ay","_13","_23","arcToCurve","large_arc_flag","sweep_flag","recursive","_120","rad","cos","sin","newf","count","repush","f1","f2","rx2","ry2","asin","df","f2old","x2old","y2old","c1","s1","c2","s2","tan","hx","hy","m1","m2","m3","m4","newres","curve","curvedPath","bx","by","X","Y","qx","qy","processPath","nx","T","Q","fixArc","pp","pathCommands","pfirst","seg","seglen","isButton","getOriginalEvent","hasPrimaryModifier","MoveCanvas","handleMousedown","domClosest","handleMove","handleStart","deltaPos","dragging","installClickTrap","cursorSet","lastPosition","cursorUnset","isActive","moveCanvas","TRAP_PRIORITY","install","trap","DEFAULT_CONFIG","moveSpeed","moveSpeedAccelerated","KeyboardMove","speed","actualSpeed","KeyboardModule","keyboardMove","roundBounds","roundPoint","getConnectionMid","lastPoint","lastPart","startLength","endLength","midLength","midSegment","segmentProgress","getOrientation","rectOrientation","referenceOrientation","getElementLineIntersection","elementPath","linePath","cropStart","intersections","intersectPaths","distance","filterRedundantWaypoints","previousPoint","nextPoint","DEFAULT_RENDER_PRIORITY","renderPriority","evt"],"sourceRoot":""}