"use strict";(self.webpackChunksgex_workbench=self.webpackChunksgex_workbench||[]).push([[141],{81750:(e,n,t)=>{t.d(n,{Cq:()=>r,Ub:()=>a,_Q:()=>o});var i=t(37522);async function r(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new(await(0,i.sN)())(e)}async function a(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new(await(0,i.uW)())(e)}async function o(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new(await(0,i.M3)())(e)}},85141:(e,n,t)=>{t.r(n),t.d(n,{default:()=>l});var i=t(65043),r=t(87338),a=t(31984),o=t(81750),s=t(70579);const l=()=>{const e=(0,r.Zp)(),{profile:n,repository:t,branch:l}=(0,a.N5)(),c=(0,i.useRef)(null),d=(0,i.useRef)(null),[m,p]=(0,i.useState)([]),[u,h]=(0,i.useState)(null),[b,g]=(0,i.useState)(!0),[w,f]=(0,i.useState)(null),[v,N]=(0,i.useState)(""),[x,P]=(0,i.useState)("");(0,i.useEffect)(()=>{const e=async()=>{if(d.current&&!c.current&&u)try{c.current=await(0,o.Ub)({container:d.current}),console.log("BPMN modeler initialized successfully")}catch(w){console.error("Failed to initialize BPMN modeler:",w)}};if(u){e();const n=setTimeout(e,100);return()=>clearTimeout(n)}return()=>{if(c.current){try{c.current.destroy()}catch(w){console.error("Error destroying BPMN modeler:",w)}c.current=null}}},[u]),(0,i.useEffect)(()=>{(async()=>{if(n&&t)try{if(g(!0),f(null),n.token)try{var i;const e=await(0,o.Cq)({auth:n.token}),{data:r}=await e.rest.repos.getContent({owner:(null===(i=t.owner)||void 0===i?void 0:i.login)||t.full_name.split("/")[0],repo:t.name,path:"input/business-processes"}),a=Array.isArray(r)?r.filter(e=>e.name.endsWith(".bpmn")):r.name.endsWith(".bpmn")?[r]:[];return p(a),void g(!1)}catch(r){console.warn("GitHub API error, falling back to mock data:",r)}p([{name:"patient-registration.bpmn",path:"input/business-processes/patient-registration.bpmn",sha:"abc123",size:2048,download_url:"https://raw.githubusercontent.com/..."},{name:"vaccination-workflow.bpmn",path:"input/business-processes/vaccination-workflow.bpmn",sha:"def456",size:3072,download_url:"https://raw.githubusercontent.com/..."},{name:"appointment-scheduling.bpmn",path:"input/business-processes/appointment-scheduling.bpmn",sha:"ghi789",size:1536,download_url:"https://raw.githubusercontent.com/..."}]),g(!1)}catch(a){console.error("Error loading BPMN files:",a),f("Failed to load BPMN files from repository"),g(!1)}else e("/")})()},[n,t,e]),(0,i.useEffect)(()=>{if(c.current){const e=()=>{c.current.saveXML({format:!0}).then(e=>{let{xml:n}=e;N(n)}).catch(e=>{console.error("Error getting XML content:",e)})};return c.current.on("commandStack.changed",e),()=>{c.current&&c.current.off("commandStack.changed",e)}}},[u]);if(!n||!t)return e("/"),(0,s.jsx)("div",{children:"Redirecting..."});const M=v!==x;return(0,s.jsx)(a.ox,{pageName:"bpmn-editor",file:u,repository:t,branch:l||"main",content:v,originalContent:x,hasChanges:M,onSave:async(e,n)=>{console.log("BPMN diagram saved to ".concat(n)),"github"===n&&P(e)},saveButtonsPosition:"top",customSaveToGitHub:async e=>{if(!e.trim()||!u||!c.current)return!1;try{const{xml:s}=await c.current.saveXML({format:!0});if(n.token&&t){var i;const l=await(0,o.Cq)({auth:n.token});let c=u.sha;try{var r;const{data:e}=await l.rest.repos.getContent({owner:(null===(r=t.owner)||void 0===r?void 0:r.login)||t.full_name.split("/")[0],repo:t.name,path:u.path});c=e.sha}catch(a){console.warn("Could not get current file SHA, using provided SHA:",a)}return await l.rest.repos.createOrUpdateFileContents({owner:(null===(i=t.owner)||void 0===i?void 0:i.login)||t.full_name.split("/")[0],repo:t.name,path:u.path,message:e,content:btoa(s),sha:c,committer:{name:n.name||n.login,email:n.email||"".concat(n.login,"@users.noreply.github.com")}}),console.log("BPMN file committed to GitHub successfully"),!0}return!1}catch(w){throw console.error("Error saving BPMN to GitHub:",w),w}},children:(0,s.jsx)("div",{className:"bpmn-editor",children:(0,s.jsx)("div",{className:"editor-content",children:(0,s.jsxs)("div",{className:"bpmn-workspace",children:[(0,s.jsxs)("div",{className:"file-browser",children:[(0,s.jsxs)("div",{className:"file-browser-header",children:[(0,s.jsx)("h3",{children:"BPMN Files"}),(0,s.jsx)("span",{className:"file-path",children:"input/business-processes/"})]}),b&&!u?(0,s.jsxs)("div",{className:"loading",children:[(0,s.jsx)("div",{className:"spinner"}),(0,s.jsx)("p",{children:"Loading BPMN files..."})]}):w?(0,s.jsx)("div",{className:"error",children:(0,s.jsxs)("p",{children:["\u274c ",w]})}):(0,s.jsx)("div",{className:"file-list",children:m.map(e=>(0,s.jsxs)("div",{className:"file-item ".concat((null===u||void 0===u?void 0:u.sha)===e.sha?"selected":""),onClick:()=>(async e=>{try{g(!0),f(null),h(e),setTimeout(async()=>{try{if(!c.current&&d.current&&(c.current=await(0,o.Ub)({container:d.current}),console.log("BPMN modeler initialized for file loading")),!c.current)return console.error("BPMN modeler not available"),f("BPMN editor not ready. Please try again."),void g(!1);let i=null;if(n.token&&e.download_url)try{const n=await fetch(e.download_url);n.ok&&(i=await n.text(),console.log("Loaded BPMN content from GitHub"))}catch(t){console.warn("Could not fetch BPMN content from GitHub:",t)}i||(i='<?xml version="1.0" encoding="UTF-8"?>\n<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" id="Definitions_1" targetNamespace="http://bpmn.io/schema/bpmn" exporter="bpmn-js (https://demo.bpmn.io)" exporterVersion="17.11.1">\n  <bpmn:process id="Process_'.concat(e.name.replace(".bpmn",""),'" isExecutable="true">\n    <bpmn:startEvent id="StartEvent_1">\n      <bpmn:outgoing>Flow_1</bpmn:outgoing>\n    </bpmn:startEvent>\n    <bpmn:task id="Task_1" name="').concat(e.name.replace(".bpmn","").replace("-"," ").toUpperCase(),'">\n      <bpmn:incoming>Flow_1</bpmn:incoming>\n      <bpmn:outgoing>Flow_2</bpmn:outgoing>\n    </bpmn:task>\n    <bpmn:endEvent id="EndEvent_1">\n      <bpmn:incoming>Flow_2</bpmn:incoming>\n    </bpmn:endEvent>\n    <bpmn:sequenceFlow id="Flow_1" sourceRef="StartEvent_1" targetRef="Task_1" />\n    <bpmn:sequenceFlow id="Flow_2" sourceRef="Task_1" targetRef="EndEvent_1" />\n  </bpmn:process>\n  <bpmndi:BPMNDiagram id="BPMNDiagram_1">\n    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="Process_').concat(e.name.replace(".bpmn",""),'">\n      <bpmndi:BPMNShape id="_BPMNShape_StartEvent_2" bpmnElement="StartEvent_1">\n        <dc:Bounds x="179" y="99" width="36" height="36" />\n      </bpmndi:BPMNShape>\n      <bpmndi:BPMNShape id="Activity_1" bpmnElement="Task_1">\n        <dc:Bounds x="270" y="77" width="100" height="80" />\n      </bpmndi:BPMNShape>\n      <bpmndi:BPMNShape id="Event_1" bpmnElement="EndEvent_1">\n        <dc:Bounds x="432" y="99" width="36" height="36" />\n      </bpmndi:BPMNShape>\n      <bpmndi:BPMNEdge id="Flow_1_di" bpmnElement="Flow_1">\n        <di:waypoint x="215" y="117" />\n        <di:waypoint x="270" y="117" />\n      </bpmndi:BPMNEdge>\n      <bpmndi:BPMNEdge id="Flow_2_di" bpmnElement="Flow_2">\n        <di:waypoint x="370" y="117" />\n        <di:waypoint x="432" y="117" />\n      </bpmndi:BPMNEdge>\n    </bpmndi:BPMNPlane>\n  </bpmndi:BPMNDiagram>\n</bpmn:definitions>')),await c.current.importXML(i),P(i),N(i),g(!1)}catch(i){console.error("Error loading BPMN file:",i),f("Failed to load BPMN diagram"),g(!1)}},100)}catch(t){console.error("Error initializing BPMN file load:",t),f("Failed to initialize BPMN editor"),g(!1)}})(e),children:[(0,s.jsx)("div",{className:"file-icon",children:"\ud83d\udccb"}),(0,s.jsxs)("div",{className:"file-details",children:[(0,s.jsx)("div",{className:"file-name",children:e.name}),(0,s.jsxs)("div",{className:"file-size",children:[(e.size/1024).toFixed(1)," KB"]})]})]},e.sha))})]}),(0,s.jsx)("div",{className:"diagram-editor",children:u?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"editor-toolbar",children:(0,s.jsx)("div",{className:"toolbar-left",children:(0,s.jsx)("h4",{children:u.name})})}),(0,s.jsx)("div",{className:"bpmn-container",ref:d})]}):(0,s.jsx)("div",{className:"diagram-placeholder",children:(0,s.jsxs)("div",{className:"placeholder-content",children:[(0,s.jsx)("div",{className:"placeholder-icon",children:"\ud83d\udd04"}),(0,s.jsx)("h3",{children:"Select a BPMN File"}),(0,s.jsx)("p",{children:"Choose a .bpmn file from the list to start editing business processes."})]})})})]})})})})}}}]);
//# sourceMappingURL=141.7e98c7c4.chunk.js.map