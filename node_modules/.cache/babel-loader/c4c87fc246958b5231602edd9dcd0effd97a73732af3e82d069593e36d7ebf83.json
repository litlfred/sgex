{"ast":null,"code":"import { hasPrimaryModifier } from '../../util/Mouse';\nimport { isKey } from '../../features/keyboard/KeyboardUtil';\n\n/**\n * @typedef {import('didi').Injector} Injector\n *\n * @typedef {import('../../core/Canvas').default} Canvas\n * @typedef {import('../dragging/Dragging').default} Dragging\n * @typedef {import('../../core/EventBus').default} EventBus\n * @typedef {import('../mouse/Mouse').default} Mouse\n * @typedef {import('../tool-manager/ToolManager').default} ToolManager\n */\n\nvar HIGH_PRIORITY = 1500;\nvar HAND_CURSOR = 'grab';\n\n/**\n * @param {EventBus} eventBus\n * @param {Canvas} canvas\n * @param {Dragging} dragging\n * @param {Injector} injector\n * @param {ToolManager} toolManager\n * @param {Mouse} mouse\n */\nexport default function HandTool(eventBus, canvas, dragging, injector, toolManager, mouse) {\n  this._dragging = dragging;\n  this._mouse = mouse;\n  var self = this,\n    keyboard = injector.get('keyboard', false);\n  toolManager.registerTool('hand', {\n    tool: 'hand',\n    dragging: 'hand.move'\n  });\n  eventBus.on('element.mousedown', HIGH_PRIORITY, function (event) {\n    if (!hasPrimaryModifier(event)) {\n      return;\n    }\n    self.activateMove(event.originalEvent, true);\n    return false;\n  });\n  keyboard && keyboard.addListener(HIGH_PRIORITY, function (e) {\n    if (!isSpace(e.keyEvent) || self.isActive()) {\n      return;\n    }\n    var mouseEvent = self._mouse.getLastMoveEvent();\n    self.activateMove(mouseEvent, !!mouseEvent);\n  }, 'keyboard.keydown');\n  keyboard && keyboard.addListener(HIGH_PRIORITY, function (e) {\n    if (!isSpace(e.keyEvent) || !self.isActive()) {\n      return;\n    }\n    self.toggle();\n  }, 'keyboard.keyup');\n  eventBus.on('hand.end', function (event) {\n    var target = event.originalEvent.target;\n\n    // only reactive on diagram click\n    // on some occasions, event.hover is not set and we have to check if the target is an svg\n    if (!event.hover && !(target instanceof SVGElement)) {\n      return false;\n    }\n    eventBus.once('hand.ended', function () {\n      self.activateMove(event.originalEvent, {\n        reactivate: true\n      });\n    });\n  });\n  eventBus.on('hand.move.move', function (event) {\n    var scale = canvas.viewbox().scale;\n    canvas.scroll({\n      dx: event.dx * scale,\n      dy: event.dy * scale\n    });\n  });\n  eventBus.on('hand.move.end', function (event) {\n    var context = event.context,\n      reactivate = context.reactivate;\n\n    // Don't reactivate if the user is using the keyboard keybinding\n    if (!hasPrimaryModifier(event) && reactivate) {\n      eventBus.once('hand.move.ended', function (event) {\n        self.activateHand(event.originalEvent, true, true);\n      });\n    }\n    return false;\n  });\n}\nHandTool.$inject = ['eventBus', 'canvas', 'dragging', 'injector', 'toolManager', 'mouse'];\n\n/**\n *\n * @param event\n * @param {boolean} [autoActivate]\n * @param {object} [context]\n */\nHandTool.prototype.activateMove = function (event, autoActivate, context) {\n  if (typeof autoActivate === 'object') {\n    context = autoActivate;\n    autoActivate = false;\n  }\n  this._dragging.init(event, 'hand.move', {\n    autoActivate: autoActivate,\n    cursor: HAND_CURSOR,\n    data: {\n      context: context || {}\n    }\n  });\n};\n\n/**\n *\n * @param event\n * @param {boolean} [autoActivate]\n * @param {boolean} [reactivate]\n */\nHandTool.prototype.activateHand = function (event, autoActivate, reactivate) {\n  this._dragging.init(event, 'hand', {\n    trapClick: false,\n    autoActivate: autoActivate,\n    cursor: HAND_CURSOR,\n    data: {\n      context: {\n        reactivate: reactivate\n      }\n    }\n  });\n};\nHandTool.prototype.toggle = function () {\n  if (this.isActive()) {\n    return this._dragging.cancel();\n  }\n  var mouseEvent = this._mouse.getLastMoveEvent();\n  this.activateHand(mouseEvent, !!mouseEvent);\n};\nHandTool.prototype.isActive = function () {\n  var context = this._dragging.context();\n  if (context) {\n    return /^(hand|hand\\.move)$/.test(context.prefix);\n  }\n  return false;\n};\n\n// helpers //////////\n\nfunction isSpace(keyEvent) {\n  return isKey('Space', keyEvent);\n}","map":{"version":3,"names":["hasPrimaryModifier","isKey","HIGH_PRIORITY","HAND_CURSOR","HandTool","eventBus","canvas","dragging","injector","toolManager","mouse","_dragging","_mouse","self","keyboard","get","registerTool","tool","on","event","activateMove","originalEvent","addListener","e","isSpace","keyEvent","isActive","mouseEvent","getLastMoveEvent","toggle","target","hover","SVGElement","once","reactivate","scale","viewbox","scroll","dx","dy","context","activateHand","$inject","prototype","autoActivate","init","cursor","data","trapClick","cancel","test","prefix"],"sources":["/home/runner/work/sgex/sgex/node_modules/diagram-js/lib/features/hand-tool/HandTool.js"],"sourcesContent":["import {\n  hasPrimaryModifier\n} from '../../util/Mouse';\n\nimport { isKey } from '../../features/keyboard/KeyboardUtil';\n\n/**\n * @typedef {import('didi').Injector} Injector\n *\n * @typedef {import('../../core/Canvas').default} Canvas\n * @typedef {import('../dragging/Dragging').default} Dragging\n * @typedef {import('../../core/EventBus').default} EventBus\n * @typedef {import('../mouse/Mouse').default} Mouse\n * @typedef {import('../tool-manager/ToolManager').default} ToolManager\n */\n\nvar HIGH_PRIORITY = 1500;\nvar HAND_CURSOR = 'grab';\n\n/**\n * @param {EventBus} eventBus\n * @param {Canvas} canvas\n * @param {Dragging} dragging\n * @param {Injector} injector\n * @param {ToolManager} toolManager\n * @param {Mouse} mouse\n */\nexport default function HandTool(\n    eventBus, canvas, dragging,\n    injector, toolManager, mouse) {\n\n  this._dragging = dragging;\n  this._mouse = mouse;\n\n  var self = this,\n      keyboard = injector.get('keyboard', false);\n\n  toolManager.registerTool('hand', {\n    tool: 'hand',\n    dragging: 'hand.move'\n  });\n\n  eventBus.on('element.mousedown', HIGH_PRIORITY, function(event) {\n\n    if (!hasPrimaryModifier(event)) {\n      return;\n    }\n\n    self.activateMove(event.originalEvent, true);\n\n    return false;\n  });\n\n  keyboard && keyboard.addListener(HIGH_PRIORITY, function(e) {\n    if (!isSpace(e.keyEvent) || self.isActive()) {\n      return;\n    }\n\n    var mouseEvent = self._mouse.getLastMoveEvent();\n\n    self.activateMove(mouseEvent, !!mouseEvent);\n  }, 'keyboard.keydown');\n\n  keyboard && keyboard.addListener(HIGH_PRIORITY, function(e) {\n    if (!isSpace(e.keyEvent) || !self.isActive()) {\n      return;\n    }\n\n    self.toggle();\n  }, 'keyboard.keyup');\n\n  eventBus.on('hand.end', function(event) {\n    var target = event.originalEvent.target;\n\n    // only reactive on diagram click\n    // on some occasions, event.hover is not set and we have to check if the target is an svg\n    if (!event.hover && !(target instanceof SVGElement)) {\n      return false;\n    }\n\n    eventBus.once('hand.ended', function() {\n      self.activateMove(event.originalEvent, { reactivate: true });\n    });\n\n  });\n\n  eventBus.on('hand.move.move', function(event) {\n    var scale = canvas.viewbox().scale;\n\n    canvas.scroll({\n      dx: event.dx * scale,\n      dy: event.dy * scale\n    });\n  });\n\n  eventBus.on('hand.move.end', function(event) {\n    var context = event.context,\n        reactivate = context.reactivate;\n\n    // Don't reactivate if the user is using the keyboard keybinding\n    if (!hasPrimaryModifier(event) && reactivate) {\n\n      eventBus.once('hand.move.ended', function(event) {\n        self.activateHand(event.originalEvent, true, true);\n      });\n\n    }\n\n    return false;\n  });\n\n}\n\nHandTool.$inject = [\n  'eventBus',\n  'canvas',\n  'dragging',\n  'injector',\n  'toolManager',\n  'mouse'\n];\n\n/**\n *\n * @param event\n * @param {boolean} [autoActivate]\n * @param {object} [context]\n */\nHandTool.prototype.activateMove = function(event, autoActivate, context) {\n  if (typeof autoActivate === 'object') {\n    context = autoActivate;\n    autoActivate = false;\n  }\n\n  this._dragging.init(event, 'hand.move', {\n    autoActivate: autoActivate,\n    cursor: HAND_CURSOR,\n    data: {\n      context: context || {}\n    }\n  });\n};\n\n/**\n *\n * @param event\n * @param {boolean} [autoActivate]\n * @param {boolean} [reactivate]\n */\nHandTool.prototype.activateHand = function(event, autoActivate, reactivate) {\n  this._dragging.init(event, 'hand', {\n    trapClick: false,\n    autoActivate: autoActivate,\n    cursor: HAND_CURSOR,\n    data: {\n      context: {\n        reactivate: reactivate\n      }\n    }\n  });\n};\n\nHandTool.prototype.toggle = function() {\n  if (this.isActive()) {\n    return this._dragging.cancel();\n  }\n\n  var mouseEvent = this._mouse.getLastMoveEvent();\n\n  this.activateHand(mouseEvent, !!mouseEvent);\n};\n\nHandTool.prototype.isActive = function() {\n  var context = this._dragging.context();\n\n  if (context) {\n    return /^(hand|hand\\.move)$/.test(context.prefix);\n  }\n\n  return false;\n};\n\n// helpers //////////\n\nfunction isSpace(keyEvent) {\n  return isKey('Space', keyEvent);\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}