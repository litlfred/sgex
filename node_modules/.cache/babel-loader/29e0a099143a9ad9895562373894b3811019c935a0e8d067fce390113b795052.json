{"ast":null,"code":"import { bind, forEach } from 'min-dash';\nimport { append as svgAppend, attr as svgAttr, classes as svgClasses, clear as svgClear, create as svgCreate } from 'tiny-svg';\nimport { event as domEvent } from 'min-dom';\nimport { isPrimaryButton } from '../../util/Mouse';\nimport { transform } from '../../util/SvgTransformUtil';\nimport { getReferencePoint } from './Resize';\nimport { isConnection } from '../../util/ModelUtil';\n\n/**\n * @typedef {import('../../model/Types').Element} Element\n *\n * @typedef {import('../../core/Canvas').default} Canvas\n * @typedef {import('../../core/EventBus').default} EventBus\n * @typedef {import('../resize/Resize').default} Resize\n * @typedef {import('../selection/Selection').default} Selection\n */\n\nvar HANDLE_OFFSET = -6,\n  HANDLE_SIZE = 8,\n  HANDLE_HIT_SIZE = 20;\nvar CLS_RESIZER = 'djs-resizer';\nvar directions = ['n', 'w', 's', 'e', 'nw', 'ne', 'se', 'sw'];\n\n/**\n * This component is responsible for adding resize handles.\n *\n * @param {EventBus} eventBus\n * @param {Canvas} canvas\n * @param {Selection} selection\n * @param {Resize} resize\n */\nexport default function ResizeHandles(eventBus, canvas, selection, resize) {\n  this._resize = resize;\n  this._canvas = canvas;\n  var self = this;\n  eventBus.on('selection.changed', function (e) {\n    var newSelection = e.newSelection;\n\n    // remove old selection markers\n    self.removeResizers();\n\n    // add new selection markers ONLY if single selection\n    if (newSelection.length === 1) {\n      forEach(newSelection, bind(self.addResizer, self));\n    }\n  });\n  eventBus.on('shape.changed', function (e) {\n    var shape = e.element;\n    if (selection.isSelected(shape)) {\n      self.removeResizers();\n      self.addResizer(shape);\n    }\n  });\n}\nResizeHandles.prototype.makeDraggable = function (element, gfx, direction) {\n  var resize = this._resize;\n  function startResize(event) {\n    // only trigger on left mouse button\n    if (isPrimaryButton(event)) {\n      resize.activate(event, element, direction);\n    }\n  }\n  domEvent.bind(gfx, 'mousedown', startResize);\n  domEvent.bind(gfx, 'touchstart', startResize);\n};\nResizeHandles.prototype._createResizer = function (element, x, y, direction) {\n  var resizersParent = this._getResizersParent();\n  var offset = getHandleOffset(direction);\n  var group = svgCreate('g');\n  svgClasses(group).add(CLS_RESIZER);\n  svgClasses(group).add(CLS_RESIZER + '-' + element.id);\n  svgClasses(group).add(CLS_RESIZER + '-' + direction);\n  svgAppend(resizersParent, group);\n  var visual = svgCreate('rect');\n  svgAttr(visual, {\n    x: -HANDLE_SIZE / 2 + offset.x,\n    y: -HANDLE_SIZE / 2 + offset.y,\n    width: HANDLE_SIZE,\n    height: HANDLE_SIZE\n  });\n  svgClasses(visual).add(CLS_RESIZER + '-visual');\n  svgAppend(group, visual);\n  var hit = svgCreate('rect');\n  svgAttr(hit, {\n    x: -HANDLE_HIT_SIZE / 2 + offset.x,\n    y: -HANDLE_HIT_SIZE / 2 + offset.y,\n    width: HANDLE_HIT_SIZE,\n    height: HANDLE_HIT_SIZE\n  });\n  svgClasses(hit).add(CLS_RESIZER + '-hit');\n  svgAppend(group, hit);\n  transform(group, x, y);\n  return group;\n};\nResizeHandles.prototype.createResizer = function (element, direction) {\n  var point = getReferencePoint(element, direction);\n  var resizer = this._createResizer(element, point.x, point.y, direction);\n  this.makeDraggable(element, resizer, direction);\n};\n\n// resize handles implementation ///////////////////////////////\n\n/**\n * Add resizers for a given element.\n *\n * @param {Element} element\n */\nResizeHandles.prototype.addResizer = function (element) {\n  var self = this;\n  if (isConnection(element) || !this._resize.canResize({\n    shape: element\n  })) {\n    return;\n  }\n  forEach(directions, function (direction) {\n    self.createResizer(element, direction);\n  });\n};\n\n/**\n * Remove all resizers\n */\nResizeHandles.prototype.removeResizers = function () {\n  var resizersParent = this._getResizersParent();\n  svgClear(resizersParent);\n};\nResizeHandles.prototype._getResizersParent = function () {\n  return this._canvas.getLayer('resizers');\n};\nResizeHandles.$inject = ['eventBus', 'canvas', 'selection', 'resize'];\n\n// helpers //////////\n\nfunction getHandleOffset(direction) {\n  var offset = {\n    x: 0,\n    y: 0\n  };\n  if (direction.indexOf('e') !== -1) {\n    offset.x = -HANDLE_OFFSET;\n  } else if (direction.indexOf('w') !== -1) {\n    offset.x = HANDLE_OFFSET;\n  }\n  if (direction.indexOf('s') !== -1) {\n    offset.y = -HANDLE_OFFSET;\n  } else if (direction.indexOf('n') !== -1) {\n    offset.y = HANDLE_OFFSET;\n  }\n  return offset;\n}","map":{"version":3,"names":["bind","forEach","append","svgAppend","attr","svgAttr","classes","svgClasses","clear","svgClear","create","svgCreate","event","domEvent","isPrimaryButton","transform","getReferencePoint","isConnection","HANDLE_OFFSET","HANDLE_SIZE","HANDLE_HIT_SIZE","CLS_RESIZER","directions","ResizeHandles","eventBus","canvas","selection","resize","_resize","_canvas","self","on","e","newSelection","removeResizers","length","addResizer","shape","element","isSelected","prototype","makeDraggable","gfx","direction","startResize","activate","_createResizer","x","y","resizersParent","_getResizersParent","offset","getHandleOffset","group","add","id","visual","width","height","hit","createResizer","point","resizer","canResize","getLayer","$inject","indexOf"],"sources":["/home/runner/work/sgex/sgex/node_modules/diagram-js/lib/features/resize/ResizeHandles.js"],"sourcesContent":["import {\n  bind,\n  forEach\n} from 'min-dash';\n\nimport {\n  append as svgAppend,\n  attr as svgAttr,\n  classes as svgClasses,\n  clear as svgClear,\n  create as svgCreate\n} from 'tiny-svg';\n\nimport {\n  event as domEvent\n} from 'min-dom';\n\nimport {\n  isPrimaryButton\n} from '../../util/Mouse';\n\nimport {\n  transform\n} from '../../util/SvgTransformUtil';\n\nimport { getReferencePoint } from './Resize';\n\nimport { isConnection } from '../../util/ModelUtil';\n\n/**\n * @typedef {import('../../model/Types').Element} Element\n *\n * @typedef {import('../../core/Canvas').default} Canvas\n * @typedef {import('../../core/EventBus').default} EventBus\n * @typedef {import('../resize/Resize').default} Resize\n * @typedef {import('../selection/Selection').default} Selection\n */\n\nvar HANDLE_OFFSET = -6,\n    HANDLE_SIZE = 8,\n    HANDLE_HIT_SIZE = 20;\n\nvar CLS_RESIZER = 'djs-resizer';\n\nvar directions = [ 'n', 'w', 's', 'e', 'nw', 'ne', 'se', 'sw' ];\n\n\n/**\n * This component is responsible for adding resize handles.\n *\n * @param {EventBus} eventBus\n * @param {Canvas} canvas\n * @param {Selection} selection\n * @param {Resize} resize\n */\nexport default function ResizeHandles(eventBus, canvas, selection, resize) {\n\n  this._resize = resize;\n  this._canvas = canvas;\n\n  var self = this;\n\n  eventBus.on('selection.changed', function(e) {\n    var newSelection = e.newSelection;\n\n    // remove old selection markers\n    self.removeResizers();\n\n    // add new selection markers ONLY if single selection\n    if (newSelection.length === 1) {\n      forEach(newSelection, bind(self.addResizer, self));\n    }\n  });\n\n  eventBus.on('shape.changed', function(e) {\n    var shape = e.element;\n\n    if (selection.isSelected(shape)) {\n      self.removeResizers();\n\n      self.addResizer(shape);\n    }\n  });\n}\n\n\nResizeHandles.prototype.makeDraggable = function(element, gfx, direction) {\n  var resize = this._resize;\n\n  function startResize(event) {\n\n    // only trigger on left mouse button\n    if (isPrimaryButton(event)) {\n      resize.activate(event, element, direction);\n    }\n  }\n\n  domEvent.bind(gfx, 'mousedown', startResize);\n  domEvent.bind(gfx, 'touchstart', startResize);\n};\n\n\nResizeHandles.prototype._createResizer = function(element, x, y, direction) {\n  var resizersParent = this._getResizersParent();\n\n  var offset = getHandleOffset(direction);\n\n  var group = svgCreate('g');\n\n  svgClasses(group).add(CLS_RESIZER);\n  svgClasses(group).add(CLS_RESIZER + '-' + element.id);\n  svgClasses(group).add(CLS_RESIZER + '-' + direction);\n\n  svgAppend(resizersParent, group);\n\n  var visual = svgCreate('rect');\n\n  svgAttr(visual, {\n    x: -HANDLE_SIZE / 2 + offset.x,\n    y: -HANDLE_SIZE / 2 + offset.y,\n    width: HANDLE_SIZE,\n    height: HANDLE_SIZE\n  });\n\n  svgClasses(visual).add(CLS_RESIZER + '-visual');\n\n  svgAppend(group, visual);\n\n  var hit = svgCreate('rect');\n\n  svgAttr(hit, {\n    x: -HANDLE_HIT_SIZE / 2 + offset.x,\n    y: -HANDLE_HIT_SIZE / 2 + offset.y,\n    width: HANDLE_HIT_SIZE,\n    height: HANDLE_HIT_SIZE\n  });\n\n  svgClasses(hit).add(CLS_RESIZER + '-hit');\n\n  svgAppend(group, hit);\n\n  transform(group, x, y);\n\n  return group;\n};\n\nResizeHandles.prototype.createResizer = function(element, direction) {\n  var point = getReferencePoint(element, direction);\n\n  var resizer = this._createResizer(element, point.x, point.y, direction);\n\n  this.makeDraggable(element, resizer, direction);\n};\n\n// resize handles implementation ///////////////////////////////\n\n/**\n * Add resizers for a given element.\n *\n * @param {Element} element\n */\nResizeHandles.prototype.addResizer = function(element) {\n  var self = this;\n\n  if (isConnection(element) || !this._resize.canResize({ shape: element })) {\n    return;\n  }\n\n  forEach(directions, function(direction) {\n    self.createResizer(element, direction);\n  });\n};\n\n/**\n * Remove all resizers\n */\nResizeHandles.prototype.removeResizers = function() {\n  var resizersParent = this._getResizersParent();\n\n  svgClear(resizersParent);\n};\n\nResizeHandles.prototype._getResizersParent = function() {\n  return this._canvas.getLayer('resizers');\n};\n\nResizeHandles.$inject = [\n  'eventBus',\n  'canvas',\n  'selection',\n  'resize'\n];\n\n// helpers //////////\n\nfunction getHandleOffset(direction) {\n  var offset = {\n    x: 0,\n    y: 0\n  };\n\n  if (direction.indexOf('e') !== -1) {\n    offset.x = -HANDLE_OFFSET;\n  } else if (direction.indexOf('w') !== -1) {\n    offset.x = HANDLE_OFFSET;\n  }\n\n  if (direction.indexOf('s') !== -1) {\n    offset.y = -HANDLE_OFFSET;\n  } else if (direction.indexOf('n') !== -1) {\n    offset.y = HANDLE_OFFSET;\n  }\n\n  return offset;\n}"],"mappings":"AAAA,SACEA,IAAI,EACJC,OAAO,QACF,UAAU;AAEjB,SACEC,MAAM,IAAIC,SAAS,EACnBC,IAAI,IAAIC,OAAO,EACfC,OAAO,IAAIC,UAAU,EACrBC,KAAK,IAAIC,QAAQ,EACjBC,MAAM,IAAIC,SAAS,QACd,UAAU;AAEjB,SACEC,KAAK,IAAIC,QAAQ,QACZ,SAAS;AAEhB,SACEC,eAAe,QACV,kBAAkB;AAEzB,SACEC,SAAS,QACJ,6BAA6B;AAEpC,SAASC,iBAAiB,QAAQ,UAAU;AAE5C,SAASC,YAAY,QAAQ,sBAAsB;;AAEnD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,IAAIC,aAAa,GAAG,CAAC,CAAC;EAClBC,WAAW,GAAG,CAAC;EACfC,eAAe,GAAG,EAAE;AAExB,IAAIC,WAAW,GAAG,aAAa;AAE/B,IAAIC,UAAU,GAAG,CAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,CAAE;;AAG/D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,SAASC,aAAaA,CAACC,QAAQ,EAAEC,MAAM,EAAEC,SAAS,EAAEC,MAAM,EAAE;EAEzE,IAAI,CAACC,OAAO,GAAGD,MAAM;EACrB,IAAI,CAACE,OAAO,GAAGJ,MAAM;EAErB,IAAIK,IAAI,GAAG,IAAI;EAEfN,QAAQ,CAACO,EAAE,CAAC,mBAAmB,EAAE,UAASC,CAAC,EAAE;IAC3C,IAAIC,YAAY,GAAGD,CAAC,CAACC,YAAY;;IAEjC;IACAH,IAAI,CAACI,cAAc,CAAC,CAAC;;IAErB;IACA,IAAID,YAAY,CAACE,MAAM,KAAK,CAAC,EAAE;MAC7BlC,OAAO,CAACgC,YAAY,EAAEjC,IAAI,CAAC8B,IAAI,CAACM,UAAU,EAAEN,IAAI,CAAC,CAAC;IACpD;EACF,CAAC,CAAC;EAEFN,QAAQ,CAACO,EAAE,CAAC,eAAe,EAAE,UAASC,CAAC,EAAE;IACvC,IAAIK,KAAK,GAAGL,CAAC,CAACM,OAAO;IAErB,IAAIZ,SAAS,CAACa,UAAU,CAACF,KAAK,CAAC,EAAE;MAC/BP,IAAI,CAACI,cAAc,CAAC,CAAC;MAErBJ,IAAI,CAACM,UAAU,CAACC,KAAK,CAAC;IACxB;EACF,CAAC,CAAC;AACJ;AAGAd,aAAa,CAACiB,SAAS,CAACC,aAAa,GAAG,UAASH,OAAO,EAAEI,GAAG,EAAEC,SAAS,EAAE;EACxE,IAAIhB,MAAM,GAAG,IAAI,CAACC,OAAO;EAEzB,SAASgB,WAAWA,CAAChC,KAAK,EAAE;IAE1B;IACA,IAAIE,eAAe,CAACF,KAAK,CAAC,EAAE;MAC1Be,MAAM,CAACkB,QAAQ,CAACjC,KAAK,EAAE0B,OAAO,EAAEK,SAAS,CAAC;IAC5C;EACF;EAEA9B,QAAQ,CAACb,IAAI,CAAC0C,GAAG,EAAE,WAAW,EAAEE,WAAW,CAAC;EAC5C/B,QAAQ,CAACb,IAAI,CAAC0C,GAAG,EAAE,YAAY,EAAEE,WAAW,CAAC;AAC/C,CAAC;AAGDrB,aAAa,CAACiB,SAAS,CAACM,cAAc,GAAG,UAASR,OAAO,EAAES,CAAC,EAAEC,CAAC,EAAEL,SAAS,EAAE;EAC1E,IAAIM,cAAc,GAAG,IAAI,CAACC,kBAAkB,CAAC,CAAC;EAE9C,IAAIC,MAAM,GAAGC,eAAe,CAACT,SAAS,CAAC;EAEvC,IAAIU,KAAK,GAAG1C,SAAS,CAAC,GAAG,CAAC;EAE1BJ,UAAU,CAAC8C,KAAK,CAAC,CAACC,GAAG,CAACjC,WAAW,CAAC;EAClCd,UAAU,CAAC8C,KAAK,CAAC,CAACC,GAAG,CAACjC,WAAW,GAAG,GAAG,GAAGiB,OAAO,CAACiB,EAAE,CAAC;EACrDhD,UAAU,CAAC8C,KAAK,CAAC,CAACC,GAAG,CAACjC,WAAW,GAAG,GAAG,GAAGsB,SAAS,CAAC;EAEpDxC,SAAS,CAAC8C,cAAc,EAAEI,KAAK,CAAC;EAEhC,IAAIG,MAAM,GAAG7C,SAAS,CAAC,MAAM,CAAC;EAE9BN,OAAO,CAACmD,MAAM,EAAE;IACdT,CAAC,EAAE,CAAC5B,WAAW,GAAG,CAAC,GAAGgC,MAAM,CAACJ,CAAC;IAC9BC,CAAC,EAAE,CAAC7B,WAAW,GAAG,CAAC,GAAGgC,MAAM,CAACH,CAAC;IAC9BS,KAAK,EAAEtC,WAAW;IAClBuC,MAAM,EAAEvC;EACV,CAAC,CAAC;EAEFZ,UAAU,CAACiD,MAAM,CAAC,CAACF,GAAG,CAACjC,WAAW,GAAG,SAAS,CAAC;EAE/ClB,SAAS,CAACkD,KAAK,EAAEG,MAAM,CAAC;EAExB,IAAIG,GAAG,GAAGhD,SAAS,CAAC,MAAM,CAAC;EAE3BN,OAAO,CAACsD,GAAG,EAAE;IACXZ,CAAC,EAAE,CAAC3B,eAAe,GAAG,CAAC,GAAG+B,MAAM,CAACJ,CAAC;IAClCC,CAAC,EAAE,CAAC5B,eAAe,GAAG,CAAC,GAAG+B,MAAM,CAACH,CAAC;IAClCS,KAAK,EAAErC,eAAe;IACtBsC,MAAM,EAAEtC;EACV,CAAC,CAAC;EAEFb,UAAU,CAACoD,GAAG,CAAC,CAACL,GAAG,CAACjC,WAAW,GAAG,MAAM,CAAC;EAEzClB,SAAS,CAACkD,KAAK,EAAEM,GAAG,CAAC;EAErB5C,SAAS,CAACsC,KAAK,EAAEN,CAAC,EAAEC,CAAC,CAAC;EAEtB,OAAOK,KAAK;AACd,CAAC;AAED9B,aAAa,CAACiB,SAAS,CAACoB,aAAa,GAAG,UAAStB,OAAO,EAAEK,SAAS,EAAE;EACnE,IAAIkB,KAAK,GAAG7C,iBAAiB,CAACsB,OAAO,EAAEK,SAAS,CAAC;EAEjD,IAAImB,OAAO,GAAG,IAAI,CAAChB,cAAc,CAACR,OAAO,EAAEuB,KAAK,CAACd,CAAC,EAAEc,KAAK,CAACb,CAAC,EAAEL,SAAS,CAAC;EAEvE,IAAI,CAACF,aAAa,CAACH,OAAO,EAAEwB,OAAO,EAAEnB,SAAS,CAAC;AACjD,CAAC;;AAED;;AAEA;AACA;AACA;AACA;AACA;AACApB,aAAa,CAACiB,SAAS,CAACJ,UAAU,GAAG,UAASE,OAAO,EAAE;EACrD,IAAIR,IAAI,GAAG,IAAI;EAEf,IAAIb,YAAY,CAACqB,OAAO,CAAC,IAAI,CAAC,IAAI,CAACV,OAAO,CAACmC,SAAS,CAAC;IAAE1B,KAAK,EAAEC;EAAQ,CAAC,CAAC,EAAE;IACxE;EACF;EAEArC,OAAO,CAACqB,UAAU,EAAE,UAASqB,SAAS,EAAE;IACtCb,IAAI,CAAC8B,aAAa,CAACtB,OAAO,EAAEK,SAAS,CAAC;EACxC,CAAC,CAAC;AACJ,CAAC;;AAED;AACA;AACA;AACApB,aAAa,CAACiB,SAAS,CAACN,cAAc,GAAG,YAAW;EAClD,IAAIe,cAAc,GAAG,IAAI,CAACC,kBAAkB,CAAC,CAAC;EAE9CzC,QAAQ,CAACwC,cAAc,CAAC;AAC1B,CAAC;AAED1B,aAAa,CAACiB,SAAS,CAACU,kBAAkB,GAAG,YAAW;EACtD,OAAO,IAAI,CAACrB,OAAO,CAACmC,QAAQ,CAAC,UAAU,CAAC;AAC1C,CAAC;AAEDzC,aAAa,CAAC0C,OAAO,GAAG,CACtB,UAAU,EACV,QAAQ,EACR,WAAW,EACX,QAAQ,CACT;;AAED;;AAEA,SAASb,eAAeA,CAACT,SAAS,EAAE;EAClC,IAAIQ,MAAM,GAAG;IACXJ,CAAC,EAAE,CAAC;IACJC,CAAC,EAAE;EACL,CAAC;EAED,IAAIL,SAAS,CAACuB,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,EAAE;IACjCf,MAAM,CAACJ,CAAC,GAAG,CAAC7B,aAAa;EAC3B,CAAC,MAAM,IAAIyB,SAAS,CAACuB,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,EAAE;IACxCf,MAAM,CAACJ,CAAC,GAAG7B,aAAa;EAC1B;EAEA,IAAIyB,SAAS,CAACuB,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,EAAE;IACjCf,MAAM,CAACH,CAAC,GAAG,CAAC9B,aAAa;EAC3B,CAAC,MAAM,IAAIyB,SAAS,CAACuB,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,EAAE;IACxCf,MAAM,CAACH,CAAC,GAAG9B,aAAa;EAC1B;EAEA,OAAOiC,MAAM;AACf","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}