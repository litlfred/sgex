{"ast":null,"code":"import React,{createContext,useContext,useEffect,useState}from'react';import{useParams,useLocation,useNavigate}from'react-router-dom';import githubService from'../../services/githubService';import dakValidationService from'../../services/dakValidationService';/**\n * Page types supported by the framework\n */import{jsx as _jsx}from\"react/jsx-runtime\";export const PAGE_TYPES={TOP_LEVEL:'top-level',USER:'user',DAK:'dak',ASSET:'asset'};/**\n * Context for page framework\n */const PageContext=/*#__PURE__*/createContext(null);/**\n * Hook to use page context\n */export const usePage=()=>{const context=useContext(PageContext);if(!context){throw new Error('usePage must be used within a PageProvider');}return context;};/**\n * Determine page type from URL parameters\n */const determinePageType=params=>{const{user,repo,asset}=params;if(asset)return PAGE_TYPES.ASSET;if(user&&repo)return PAGE_TYPES.DAK;if(user)return PAGE_TYPES.USER;return PAGE_TYPES.TOP_LEVEL;};/**\n * Provider component for page framework\n */export const PageProvider=_ref=>{let{children,pageName}=_ref;const params=useParams();const location=useLocation();const navigate=useNavigate();const[pageState,setPageState]=useState({type:determinePageType(params),pageName,loading:false,error:null,user:null,profile:null,repository:null,branch:null,asset:null,isAuthenticated:githubService.isAuth()});// Extract URL parameters\nconst{user,repo,asset}=params;// Load data based on page type\nuseEffect(()=>{const loadPageData=async()=>{try{var _location$state,_location$state2,_location$state3;setPageState(prev=>({...prev,loading:true,error:null}));// Use location state if available, otherwise fetch from URL params\nlet profile=(_location$state=location.state)===null||_location$state===void 0?void 0:_location$state.profile;let repository=(_location$state2=location.state)===null||_location$state2===void 0?void 0:_location$state2.repository;let selectedBranch=((_location$state3=location.state)===null||_location$state3===void 0?void 0:_location$state3.selectedBranch)||params.branch;// For DAK and Asset pages, validate and fetch data\nif(pageState.type===PAGE_TYPES.DAK||pageState.type===PAGE_TYPES.ASSET){var _repository;if(!profile&&user){if(githubService.isAuth()){try{profile=await githubService.getUser(user);}catch(err){throw new Error(`User '${user}' not found or not accessible.`);}}else{// Demo mode for DAK validation\nconst isValidDAK=dakValidationService.validateDemoDAKRepository(user,repo);if(!isValidDAK){throw new Error(`Repository '${user}/${repo}' not found or not accessible.`);}profile={login:user,name:user.charAt(0).toUpperCase()+user.slice(1),avatar_url:`https://github.com/${user}.png`,type:'User',isDemo:true};}}if(!repository&&user&&repo){if(githubService.isAuth()){try{repository=await githubService.getRepository(user,repo);// Validate it's a DAK repository\nconst isValidDAK=await dakValidationService.validateDAKRepository(user,repo,selectedBranch||repository.default_branch);if(!isValidDAK){throw new Error(`Repository '${user}/${repo}' is not a valid DAK repository.`);}}catch(err){throw new Error(`Repository '${user}/${repo}' not found or not accessible.`);}}else{repository={name:repo,full_name:`${user}/${repo}`,owner:{login:user},default_branch:selectedBranch||'main',html_url:`https://github.com/${user}/${repo}`,isDemo:true};}}selectedBranch=selectedBranch||((_repository=repository)===null||_repository===void 0?void 0:_repository.default_branch)||'main';// For asset pages, validate the asset exists (when authenticated or public repo)\nif(pageState.type===PAGE_TYPES.ASSET&&asset){try{await githubService.getFileContent(user,repo,asset,selectedBranch);}catch(err){throw new Error(`Asset '${asset}' not found in repository.`);}}}// For User pages, just need profile\nif(pageState.type===PAGE_TYPES.USER&&!profile&&user){if(githubService.isAuth()){try{profile=await githubService.getUser(user);}catch(err){throw new Error(`User '${user}' not found or not accessible.`);}}else{profile={login:user,name:user.charAt(0).toUpperCase()+user.slice(1),avatar_url:`https://github.com/${user}.png`,type:'User',isDemo:true};}}setPageState(prev=>({...prev,loading:false,user,profile,repository,branch:selectedBranch,asset,isAuthenticated:githubService.isAuth()}));}catch(error){console.error('Page data loading error:',error);setPageState(prev=>({...prev,loading:false,error:error.message}));}};// Only load data if we have URL parameters that require it\nif(pageState.type!==PAGE_TYPES.TOP_LEVEL&&user||pageState.type===PAGE_TYPES.TOP_LEVEL){loadPageData();}},[user,repo,params.branch,asset,pageState.type,location.state]);const value={...pageState,navigate,params,location};return/*#__PURE__*/_jsx(PageContext.Provider,{value:value,children:children});};","map":{"version":3,"names":["React","createContext","useContext","useEffect","useState","useParams","useLocation","useNavigate","githubService","dakValidationService","jsx","_jsx","PAGE_TYPES","TOP_LEVEL","USER","DAK","ASSET","PageContext","usePage","context","Error","determinePageType","params","user","repo","asset","PageProvider","_ref","children","pageName","location","navigate","pageState","setPageState","type","loading","error","profile","repository","branch","isAuthenticated","isAuth","loadPageData","_location$state","_location$state2","_location$state3","prev","state","selectedBranch","_repository","getUser","err","isValidDAK","validateDemoDAKRepository","login","name","charAt","toUpperCase","slice","avatar_url","isDemo","getRepository","validateDAKRepository","default_branch","full_name","owner","html_url","getFileContent","console","message","value","Provider"],"sources":["/home/runner/work/sgex/sgex/src/components/framework/PageProvider.js"],"sourcesContent":["import React, { createContext, useContext, useEffect, useState } from 'react';\nimport { useParams, useLocation, useNavigate } from 'react-router-dom';\nimport githubService from '../../services/githubService';\nimport dakValidationService from '../../services/dakValidationService';\n\n/**\n * Page types supported by the framework\n */\nexport const PAGE_TYPES = {\n  TOP_LEVEL: 'top-level',\n  USER: 'user', \n  DAK: 'dak',\n  ASSET: 'asset'\n};\n\n/**\n * Context for page framework\n */\nconst PageContext = createContext(null);\n\n/**\n * Hook to use page context\n */\nexport const usePage = () => {\n  const context = useContext(PageContext);\n  if (!context) {\n    throw new Error('usePage must be used within a PageProvider');\n  }\n  return context;\n};\n\n/**\n * Determine page type from URL parameters\n */\nconst determinePageType = (params) => {\n  const { user, repo, asset } = params;\n  \n  if (asset) return PAGE_TYPES.ASSET;\n  if (user && repo) return PAGE_TYPES.DAK;\n  if (user) return PAGE_TYPES.USER;\n  return PAGE_TYPES.TOP_LEVEL;\n};\n\n/**\n * Provider component for page framework\n */\nexport const PageProvider = ({ children, pageName }) => {\n  const params = useParams();\n  const location = useLocation();\n  const navigate = useNavigate();\n  \n  const [pageState, setPageState] = useState({\n    type: determinePageType(params),\n    pageName,\n    loading: false,\n    error: null,\n    user: null,\n    profile: null,\n    repository: null,\n    branch: null,\n    asset: null,\n    isAuthenticated: githubService.isAuth()\n  });\n\n  // Extract URL parameters\n  const { user, repo, asset } = params;\n\n  // Load data based on page type\n  useEffect(() => {\n    const loadPageData = async () => {\n      try {\n        setPageState(prev => ({ ...prev, loading: true, error: null }));\n\n        // Use location state if available, otherwise fetch from URL params\n        let profile = location.state?.profile;\n        let repository = location.state?.repository;\n        let selectedBranch = location.state?.selectedBranch || params.branch;\n\n        // For DAK and Asset pages, validate and fetch data\n        if (pageState.type === PAGE_TYPES.DAK || pageState.type === PAGE_TYPES.ASSET) {\n          if (!profile && user) {\n            if (githubService.isAuth()) {\n              try {\n                profile = await githubService.getUser(user);\n              } catch (err) {\n                throw new Error(`User '${user}' not found or not accessible.`);\n              }\n            } else {\n              // Demo mode for DAK validation\n              const isValidDAK = dakValidationService.validateDemoDAKRepository(user, repo);\n              if (!isValidDAK) {\n                throw new Error(`Repository '${user}/${repo}' not found or not accessible.`);\n              }\n              profile = {\n                login: user,\n                name: user.charAt(0).toUpperCase() + user.slice(1),\n                avatar_url: `https://github.com/${user}.png`,\n                type: 'User',\n                isDemo: true\n              };\n            }\n          }\n\n          if (!repository && user && repo) {\n            if (githubService.isAuth()) {\n              try {\n                repository = await githubService.getRepository(user, repo);\n                // Validate it's a DAK repository\n                const isValidDAK = await dakValidationService.validateDAKRepository(user, repo, selectedBranch || repository.default_branch);\n                if (!isValidDAK) {\n                  throw new Error(`Repository '${user}/${repo}' is not a valid DAK repository.`);\n                }\n              } catch (err) {\n                throw new Error(`Repository '${user}/${repo}' not found or not accessible.`);\n              }\n            } else {\n              repository = {\n                name: repo,\n                full_name: `${user}/${repo}`,\n                owner: { login: user },\n                default_branch: selectedBranch || 'main',\n                html_url: `https://github.com/${user}/${repo}`,\n                isDemo: true\n              };\n            }\n          }\n\n          selectedBranch = selectedBranch || repository?.default_branch || 'main';\n\n          // For asset pages, validate the asset exists (when authenticated or public repo)\n          if (pageState.type === PAGE_TYPES.ASSET && asset) {\n            try {\n              await githubService.getFileContent(user, repo, asset, selectedBranch);\n            } catch (err) {\n              throw new Error(`Asset '${asset}' not found in repository.`);\n            }\n          }\n        }\n\n        // For User pages, just need profile\n        if (pageState.type === PAGE_TYPES.USER && !profile && user) {\n          if (githubService.isAuth()) {\n            try {\n              profile = await githubService.getUser(user);\n            } catch (err) {\n              throw new Error(`User '${user}' not found or not accessible.`);\n            }\n          } else {\n            profile = {\n              login: user,\n              name: user.charAt(0).toUpperCase() + user.slice(1),\n              avatar_url: `https://github.com/${user}.png`,\n              type: 'User',\n              isDemo: true\n            };\n          }\n        }\n\n        setPageState(prev => ({\n          ...prev,\n          loading: false,\n          user,\n          profile,\n          repository,\n          branch: selectedBranch,\n          asset,\n          isAuthenticated: githubService.isAuth()\n        }));\n\n      } catch (error) {\n        console.error('Page data loading error:', error);\n        setPageState(prev => ({\n          ...prev,\n          loading: false,\n          error: error.message\n        }));\n      }\n    };\n\n    // Only load data if we have URL parameters that require it\n    if ((pageState.type !== PAGE_TYPES.TOP_LEVEL && user) || pageState.type === PAGE_TYPES.TOP_LEVEL) {\n      loadPageData();\n    }\n  }, [user, repo, params.branch, asset, pageState.type, location.state]);\n\n  const value = {\n    ...pageState,\n    navigate,\n    params,\n    location\n  };\n\n  return (\n    <PageContext.Provider value={value}>\n      {children}\n    </PageContext.Provider>\n  );\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}