{"ast":null,"code":"import inherits from 'inherits-browser';\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\nimport { getBusinessObject, is } from '../../../util/ModelUtil';\nimport { isLabel } from '../../../util/LabelUtil';\n\n/**\n * @typedef {import('../../replace/BpmnReplace').default} BpmnReplace\n * @typedef {import('didi').Injector} Injector\n */\n\nvar LOW_PRIORITY = 500;\n\n/**\n * Replace boundary event with intermediate event when creating or moving results in detached event.\n *\n * @param {BpmnReplace} bpmnReplace\n * @param {Injector} injector\n */\nexport default function DetachEventBehavior(bpmnReplace, injector) {\n  injector.invoke(CommandInterceptor, this);\n  this._bpmnReplace = bpmnReplace;\n  var self = this;\n  this.postExecuted('elements.create', LOW_PRIORITY, function (context) {\n    var elements = context.elements;\n    elements.filter(function (shape) {\n      var host = shape.host;\n      return shouldReplace(shape, host);\n    }).map(function (shape) {\n      return elements.indexOf(shape);\n    }).forEach(function (index) {\n      context.elements[index] = self._replaceShape(elements[index]);\n    });\n  }, true);\n  this.preExecute('elements.move', LOW_PRIORITY, function (context) {\n    var shapes = context.shapes,\n      newHost = context.newHost;\n    shapes.forEach(function (shape, index) {\n      var host = shape.host;\n      if (shouldReplace(shape, includes(shapes, host) ? host : newHost)) {\n        shapes[index] = self._replaceShape(shape);\n      }\n    });\n  }, true);\n}\nDetachEventBehavior.$inject = ['bpmnReplace', 'injector'];\ninherits(DetachEventBehavior, CommandInterceptor);\nDetachEventBehavior.prototype._replaceShape = function (shape) {\n  var eventDefinition = getEventDefinition(shape),\n    intermediateEvent;\n  if (eventDefinition) {\n    intermediateEvent = {\n      type: 'bpmn:IntermediateCatchEvent',\n      eventDefinitionType: eventDefinition.$type\n    };\n  } else {\n    intermediateEvent = {\n      type: 'bpmn:IntermediateThrowEvent'\n    };\n  }\n  return this._bpmnReplace.replaceElement(shape, intermediateEvent, {\n    layoutConnection: false\n  });\n};\n\n// helpers //////////\n\nfunction getEventDefinition(element) {\n  var businessObject = getBusinessObject(element),\n    eventDefinitions = businessObject.eventDefinitions;\n  return eventDefinitions && eventDefinitions[0];\n}\nfunction shouldReplace(shape, host) {\n  return !isLabel(shape) && is(shape, 'bpmn:BoundaryEvent') && !host;\n}\nfunction includes(array, item) {\n  return array.indexOf(item) !== -1;\n}","map":{"version":3,"names":["inherits","CommandInterceptor","getBusinessObject","is","isLabel","LOW_PRIORITY","DetachEventBehavior","bpmnReplace","injector","invoke","_bpmnReplace","self","postExecuted","context","elements","filter","shape","host","shouldReplace","map","indexOf","forEach","index","_replaceShape","preExecute","shapes","newHost","includes","$inject","prototype","eventDefinition","getEventDefinition","intermediateEvent","type","eventDefinitionType","$type","replaceElement","layoutConnection","element","businessObject","eventDefinitions","array","item"],"sources":["/home/runner/work/sgex/sgex/node_modules/bpmn-js/lib/features/modeling/behavior/DetachEventBehavior.js"],"sourcesContent":["import inherits from 'inherits-browser';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport {\n  getBusinessObject,\n  is\n} from '../../../util/ModelUtil';\n\nimport { isLabel } from '../../../util/LabelUtil';\n\n/**\n * @typedef {import('../../replace/BpmnReplace').default} BpmnReplace\n * @typedef {import('didi').Injector} Injector\n */\n\nvar LOW_PRIORITY = 500;\n\n\n/**\n * Replace boundary event with intermediate event when creating or moving results in detached event.\n *\n * @param {BpmnReplace} bpmnReplace\n * @param {Injector} injector\n */\nexport default function DetachEventBehavior(bpmnReplace, injector) {\n  injector.invoke(CommandInterceptor, this);\n\n  this._bpmnReplace = bpmnReplace;\n\n  var self = this;\n\n  this.postExecuted('elements.create', LOW_PRIORITY, function(context) {\n    var elements = context.elements;\n\n    elements.filter(function(shape) {\n      var host = shape.host;\n\n      return shouldReplace(shape, host);\n    }).map(function(shape) {\n      return elements.indexOf(shape);\n    }).forEach(function(index) {\n      context.elements[ index ] = self._replaceShape(elements[ index ]);\n    });\n  }, true);\n\n  this.preExecute('elements.move', LOW_PRIORITY, function(context) {\n    var shapes = context.shapes,\n        newHost = context.newHost;\n\n    shapes.forEach(function(shape, index) {\n      var host = shape.host;\n\n      if (shouldReplace(shape, includes(shapes, host) ? host : newHost)) {\n        shapes[ index ] = self._replaceShape(shape);\n      }\n    });\n  }, true);\n}\n\nDetachEventBehavior.$inject = [\n  'bpmnReplace',\n  'injector'\n];\n\ninherits(DetachEventBehavior, CommandInterceptor);\n\nDetachEventBehavior.prototype._replaceShape = function(shape) {\n  var eventDefinition = getEventDefinition(shape),\n      intermediateEvent;\n\n  if (eventDefinition) {\n    intermediateEvent = {\n      type: 'bpmn:IntermediateCatchEvent',\n      eventDefinitionType: eventDefinition.$type\n    };\n  } else {\n    intermediateEvent = {\n      type: 'bpmn:IntermediateThrowEvent'\n    };\n  }\n\n  return this._bpmnReplace.replaceElement(shape, intermediateEvent, { layoutConnection: false });\n};\n\n\n// helpers //////////\n\nfunction getEventDefinition(element) {\n  var businessObject = getBusinessObject(element),\n      eventDefinitions = businessObject.eventDefinitions;\n\n  return eventDefinitions && eventDefinitions[0];\n}\n\nfunction shouldReplace(shape, host) {\n  return !isLabel(shape) && is(shape, 'bpmn:BoundaryEvent') && !host;\n}\n\nfunction includes(array, item) {\n  return array.indexOf(item) !== -1;\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}