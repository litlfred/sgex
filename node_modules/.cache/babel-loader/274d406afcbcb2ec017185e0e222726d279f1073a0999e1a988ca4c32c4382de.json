{"ast":null,"code":"import{Octokit}from'@octokit/rest';import{processConcurrently}from'../utils/concurrency';import repositoryCompatibilityCache from'../utils/repositoryCompatibilityCache';import logger from'../utils/logger';import GITHUB_CONFIG from'../config/github';class GitHubService{constructor(){this.octokit=null;this.isAuthenticated=false;this.permissions=null;this.tokenType=null;// 'classic', 'fine-grained', or 'oauth'\nthis.logger=logger.getLogger('GitHubService');// Per-repository token management (in-memory only)\nthis.repoTokens=new Map();// Map of 'owner/repo' -> { token, scopes, octokit }\nthis.currentRepo=null;// Currently active repository\nthis.guestMode=false;// Whether user is browsing without authentication\nthis.logger.debug('GitHubService instance created');}// Initialize with a GitHub token (supports both OAuth and PAT tokens)\nauthenticate(token){const startTime=Date.now();this.logger.auth('Starting authentication',{tokenProvided:!!token,tokenLength:token?token.length:0});try{this.octokit=new Octokit({auth:token});this.isAuthenticated=true;const duration=Date.now()-startTime;this.logger.auth('Authentication successful',{duration});this.logger.performance('GitHub authentication',duration);return true;}catch(error){const duration=Date.now()-startTime;this.logger.auth('Authentication failed',{error:error.message,duration});console.error('Failed to authenticate with GitHub:',error);this.isAuthenticated=false;return false;}}// Initialize with an existing Octokit instance (for OAuth flow)\nauthenticateWithOctokit(octokitInstance){this.logger.auth('Starting OAuth authentication with Octokit instance');try{this.octokit=octokitInstance;this.isAuthenticated=true;this.tokenType='oauth';this.logger.auth('OAuth authentication successful',{tokenType:this.tokenType});return true;}catch(error){this.logger.auth('OAuth authentication failed',{error:error.message});console.error('Failed to authenticate with Octokit instance:',error);this.isAuthenticated=false;return false;}}// OAuth Device Flow methods\n// Step 1: Initialize OAuth device flow\nasync initiateDeviceFlow(){let scopes=arguments.length>0&&arguments[0]!==undefined?arguments[0]:GITHUB_CONFIG.DEFAULT_SCOPES;this.logger.auth('Starting OAuth device flow',{scopes});try{// Use GitHub's OAuth device flow endpoint\nconst response=await fetch('https://github.com/login/device/code',{method:'POST',headers:{'Accept':'application/json','Content-Type':'application/json'},body:JSON.stringify({client_id:GITHUB_CONFIG.CLIENT_ID,scope:scopes.join(' ')})});if(!response.ok){throw new Error(`Device flow initiation failed: ${response.statusText}`);}const data=await response.json();this.logger.auth('Device flow initiated successfully',{device_code:data.device_code?'present':'missing',verification_uri:data.verification_uri,expires_in:data.expires_in});return{device_code:data.device_code,user_code:data.user_code,verification_uri:data.verification_uri,verification_uri_complete:data.verification_uri_complete,expires_in:data.expires_in,interval:data.interval||5};}catch(error){this.logger.auth('Device flow initiation failed',{error:error.message});console.error('Failed to initiate device flow:',error);throw error;}}// Step 2: Poll for device flow completion\nasync pollDeviceFlowToken(deviceCode){let interval=arguments.length>1&&arguments[1]!==undefined?arguments[1]:5;this.logger.auth('Starting device flow token polling',{deviceCode:deviceCode?'present':'missing',interval});try{const response=await fetch('https://github.com/login/oauth/access_token',{method:'POST',headers:{'Accept':'application/json','Content-Type':'application/json'},body:JSON.stringify({client_id:GITHUB_CONFIG.CLIENT_ID,device_code:deviceCode,grant_type:'urn:ietf:params:oauth:grant-type:device_code'})});if(!response.ok){throw new Error(`Token polling failed: ${response.statusText}`);}const data=await response.json();if(data.error){if(data.error==='authorization_pending'){this.logger.auth('Device flow authorization still pending');return{status:'pending'};}else if(data.error==='slow_down'){this.logger.auth('Device flow polling too fast, slowing down');return{status:'slow_down'};}else if(data.error==='expired_token'){this.logger.auth('Device flow token expired');return{status:'expired'};}else if(data.error==='access_denied'){this.logger.auth('Device flow access denied by user');return{status:'denied'};}else{throw new Error(`Device flow error: ${data.error} - ${data.error_description}`);}}this.logger.auth('Device flow token received successfully',{tokenType:data.token_type,scope:data.scope});return{status:'success',access_token:data.access_token,token_type:data.token_type,scope:data.scope};}catch(error){this.logger.auth('Device flow token polling failed',{error:error.message});console.error('Failed to poll device flow token:',error);throw error;}}// Complete OAuth device flow authentication\nasync authenticateWithDeviceFlow(accessToken,scopes){this.logger.auth('Completing device flow authentication',{scopes});try{const octokit=new Octokit({auth:accessToken});// Test the token by fetching user info\nconst userResponse=await octokit.rest.users.getAuthenticated();// Store the authentication\nthis.octokit=octokit;this.isAuthenticated=true;this.tokenType='oauth';this.logger.auth('Device flow authentication completed successfully',{username:userResponse.data.login,tokenType:this.tokenType,scopes});return{success:true,user:userResponse.data,scopes,token:accessToken};}catch(error){this.logger.auth('Device flow authentication completion failed',{error:error.message});console.error('Failed to complete device flow authentication:',error);this.isAuthenticated=false;throw error;}}// Per-Repository Token Management\n// Set token for specific repository\nsetRepositoryToken(owner,repo,token,scopes){const repoKey=`${owner}/${repo}`;this.logger.auth('Setting repository token',{repo:repoKey,scopes});try{const octokit=new Octokit({auth:token});this.repoTokens.set(repoKey,{token,scopes:scopes||[],octokit,timestamp:Date.now()});this.logger.auth('Repository token set successfully',{repo:repoKey});return true;}catch(error){this.logger.auth('Failed to set repository token',{repo:repoKey,error:error.message});console.error('Failed to set repository token:',error);return false;}}// Get token for specific repository\ngetRepositoryToken(owner,repo){const repoKey=`${owner}/${repo}`;return this.repoTokens.get(repoKey);}// Switch to repository context\nswitchToRepository(owner,repo){const repoKey=`${owner}/${repo}`;this.currentRepo=repoKey;this.logger.debug('Switched to repository context',{repo:repoKey});const repoAuth=this.repoTokens.get(repoKey);if(repoAuth){// Use repository-specific authentication\nthis.octokit=repoAuth.octokit;this.isAuthenticated=true;this.tokenType='oauth';this.guestMode=false;this.logger.auth('Using repository-specific authentication',{repo:repoKey,scopes:repoAuth.scopes});}else{// Fall back to guest mode for this repository\nthis.guestMode=true;this.isAuthenticated=false;this.octokit=new Octokit();// Public API access only\nthis.logger.auth('Switched to guest mode for repository',{repo:repoKey});}return this.getRepositoryAccessLevel(owner,repo);}// Get access level for repository\ngetRepositoryAccessLevel(owner,repo){const repoKey=`${owner}/${repo}`;const repoAuth=this.repoTokens.get(repoKey);if(!repoAuth){return{level:'read-only',canComment:false,canManageWorkflows:false,scopes:[],authenticated:false};}const scopes=repoAuth.scopes;const hasPublicRepo=scopes.includes('public_repo');const hasRepo=scopes.includes('repo');const hasWorkflow=scopes.includes('workflow');return{level:hasPublicRepo||hasRepo?'read-write':'read-only',canComment:hasPublicRepo||hasRepo,canManageWorkflows:hasWorkflow,scopes,authenticated:true};}// Check if repository requires additional scopes for an action\ncheckRequiredScopes(owner,repo,action){const repoKey=`${owner}/${repo}`;const repoAuth=this.repoTokens.get(repoKey);const currentScopes=repoAuth?repoAuth.scopes:[];const actionRequirements={'comment':['public_repo'],// Can also use 'repo' for private repos\n'workflow':['workflow'],'write':['public_repo']// Can also use 'repo' for private repos\n};const requiredScopes=actionRequirements[action]||[];const missingScopes=requiredScopes.filter(scope=>!currentScopes.includes(scope));return{hasPermission:missingScopes.length===0,missingScopes,requiredScopes};}// Remove repository token (revoke access)\nremoveRepositoryToken(owner,repo){const repoKey=`${owner}/${repo}`;const removed=this.repoTokens.delete(repoKey);if(removed){this.logger.auth('Repository token removed',{repo:repoKey});// If this was the current repository, switch to guest mode\nif(this.currentRepo===repoKey){this.switchToRepository(owner,repo);}}return removed;}// Get all repository tokens (for management UI)\ngetAllRepositoryTokens(){const tokens=[];for(const[repoKey,auth]of this.repoTokens.entries()){const[owner,repo]=repoKey.split('/');tokens.push({owner,repo,scopes:auth.scopes,timestamp:auth.timestamp});}return tokens;}// Clear all repository tokens\nclearAllRepositoryTokens(){this.repoTokens.clear();this.currentRepo=null;this.guestMode=true;this.isAuthenticated=false;this.octokit=new Octokit();// Public API access only\nthis.logger.auth('All repository tokens cleared');}// Enable guest mode (read-only browsing)\nenableGuestMode(){this.guestMode=true;this.isAuthenticated=false;this.octokit=new Octokit();// Public API access only\nthis.logger.auth('Guest mode enabled');}// Check token permissions and type\nasync checkTokenPermissions(){if(!this.isAuth()){const error=new Error('Not authenticated with GitHub');this.logger.error('Token permission check failed - not authenticated');throw error;}const startTime=Date.now();this.logger.apiCall('GET','/user',null);try{// Try to get token info to determine type and permissions\nconst response=await this.octokit.request('GET /user');this.logger.apiResponse('GET','/user',response.status,Date.now()-startTime);// Check if this is a fine-grained token by trying to access rate limit info\ntry{const rateLimitStart=Date.now();this.logger.apiCall('GET','/rate_limit',null);const rateLimit=await this.octokit.rest.rateLimit.get();this.logger.apiResponse('GET','/rate_limit',rateLimit.status,Date.now()-rateLimitStart);// Fine-grained tokens have different rate limit structure\nthis.tokenType=rateLimit.data.resources.core?'classic':'fine-grained';this.logger.debug('Token type determined',{tokenType:this.tokenType,hasCore:!!rateLimit.data.resources.core});}catch(rateLimitError){this.tokenType='unknown';this.logger.warn('Could not determine token type from rate limit',{error:rateLimitError.message});}const permissions={type:this.tokenType,user:response.data};this.permissions=permissions;this.logger.debug('Token permissions checked successfully',{tokenType:this.tokenType,username:response.data.login});return permissions;}catch(error){const duration=Date.now()-startTime;this.logger.apiError('GET','/user',error);this.logger.performance('Token permission check (failed)',duration);console.error('Failed to check token permissions:',error);throw error;}}// Check if we have write permissions for a specific repository\nasync checkRepositoryWritePermissions(owner,repo){if(!this.isAuth()){this.logger.warn('Cannot check repository write permissions - not authenticated',{owner,repo});return false;}const startTime=Date.now();this.logger.debug('Checking write permissions for repository',{owner,repo});try{// Get current user first\nconst currentUser=await this.getCurrentUser();const username=currentUser.login;this.logger.apiCall('GET',`/repos/${owner}/${repo}/collaborators/${username}/permission`,null);// Try to get repository collaborator permissions\nconst{data}=await this.octokit.rest.repos.getCollaboratorPermissionLevel({owner,repo,username});const duration=Date.now()-startTime;this.logger.apiResponse('GET',`/repos/${owner}/${repo}/collaborators/${username}/permission`,200,duration);const hasWriteAccess=['write','admin'].includes(data.permission);this.logger.debug('Repository write permissions checked',{owner,repo,permission:data.permission,hasWriteAccess});return hasWriteAccess;}catch(error){const duration=Date.now()-startTime;this.logger.apiError('GET',`/repos/${owner}/${repo}/collaborators/*/permission`,error);this.logger.performance('Repository write permission check (failed)',duration);// If we can't check permissions, assume we don't have write access\nconsole.warn('Could not check repository write permissions:',error);this.logger.warn('Assuming no write access due to permission check failure',{owner,repo,error:error.message});return false;}}// Check if authenticated\nisAuth(){return this.isAuthenticated&&this.octokit!==null;}// Get current user data\nasync getCurrentUser(){if(!this.isAuth()){throw new Error('Not authenticated with GitHub');}try{const{data}=await this.octokit.rest.users.getAuthenticated();return data;}catch(error){console.error('Failed to fetch user data:',error);throw error;}}// Get user's organizations\nasync getUserOrganizations(){if(!this.isAuth()){throw new Error('Not authenticated with GitHub');}try{const{data}=await this.octokit.rest.orgs.listForAuthenticatedUser();return data;}catch(error){console.error('Failed to fetch organizations:',error);throw error;}}// Get specific organization data (public data, no auth required)\nasync getOrganization(orgLogin){try{// Create a temporary Octokit instance for public API calls if we don't have one\nconst octokit=this.octokit||new Octokit();const{data}=await octokit.rest.orgs.get({org:orgLogin});return data;}catch(error){console.error(`Failed to fetch organization ${orgLogin}:`,error);throw error;}}// Get specific user data (public data, no auth required)\nasync getUser(username){try{// Create a temporary Octokit instance for public API calls if we don't have one\nconst octokit=this.octokit||new Octokit();const{data}=await octokit.rest.users.getByUsername({username});return data;}catch(error){console.error(`Failed to fetch user ${username}:`,error);throw error;}}// Get WHO organization data with fresh avatar\nasync getWHOOrganization(){try{const whoData=await this.getOrganization('WorldHealthOrganization');return{id:whoData.id,login:whoData.login,display_name:whoData.name||'World Health Organization',description:whoData.description||'The World Health Organization is a specialized agency of the United Nations responsible for international public health.',avatar_url:whoData.avatar_url,html_url:whoData.html_url,type:'Organization',permissions:{can_create_repositories:true,can_create_private_repositories:true},plan:{name:'Organization',private_repos:'unlimited'},isWHO:true};}catch(error){console.warn('Could not fetch WHO organization data from API, using fallback:',error);// Return hardcoded fallback data\nreturn{id:'who-organization',login:'WorldHealthOrganization',display_name:'World Health Organization',description:'The World Health Organization is a specialized agency of the United Nations responsible for international public health.',avatar_url:'https://avatars.githubusercontent.com/u/12261302?s=200&v=4',html_url:'https://github.com/WorldHealthOrganization',type:'Organization',permissions:{can_create_repositories:true,can_create_private_repositories:true},plan:{name:'Organization',private_repos:'unlimited'},isWHO:true};}}// Get repositories for a user or organization (now filters by SMART Guidelines compatibility)\nasync getRepositories(owner){let type=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'user';let isDemo=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;// Handle demo mode - return demo repositories without requiring authentication\nif(isDemo||owner==='demo-user'){return this.getDemoRepositories(owner);}// Use the new SMART guidelines filtering method\nreturn this.getSmartGuidelinesRepositories(owner,type);}// Get demo repositories for demo mode (no authentication required)\ngetDemoRepositories(owner){const demoRepos=[{id:'demo-smart-anc',name:'smart-anc',full_name:`${owner}/smart-anc`,description:'Demo SMART Guidelines Digital Adaptation Kit for Antenatal Care',private:false,owner:{login:owner,id:'demo-owner',avatar_url:`https://github.com/${owner}.png`,type:'User'},html_url:`https://github.com/${owner}/smart-anc`,clone_url:`https://github.com/${owner}/smart-anc.git`,language:'FSH',stargazers_count:15,forks_count:3,open_issues_count:2,topics:['who','smart-guidelines','dak','antenatal-care','health'],created_at:'2023-01-15T10:00:00Z',updated_at:'2024-12-15T14:30:00Z',pushed_at:'2024-12-15T14:30:00Z',default_branch:'main',smart_guidelines_compatible:true,isDemo:true},{id:'demo-smart-tb',name:'smart-tb',full_name:`${owner}/smart-tb`,description:'Demo SMART Guidelines Digital Adaptation Kit for Tuberculosis Care',private:false,owner:{login:owner,id:'demo-owner',avatar_url:`https://github.com/${owner}.png`,type:'User'},html_url:`https://github.com/${owner}/smart-tb`,clone_url:`https://github.com/${owner}/smart-tb.git`,language:'FSH',stargazers_count:8,forks_count:1,open_issues_count:0,topics:['who','smart-guidelines','dak','tuberculosis','health'],created_at:'2023-03-20T15:00:00Z',updated_at:'2024-11-30T09:15:00Z',pushed_at:'2024-11-30T09:15:00Z',default_branch:'main',smart_guidelines_compatible:true,isDemo:true},{id:'demo-smart-ips-pilgrimage',name:'smart-ips-pilgrimage',full_name:`${owner}/smart-ips-pilgrimage`,description:'Demo SMART Guidelines International Patient Summary for Pilgrimage',private:false,owner:{login:owner,id:'demo-owner',avatar_url:`https://github.com/${owner}.png`,type:'User'},html_url:`https://github.com/${owner}/smart-ips-pilgrimage`,clone_url:`https://github.com/${owner}/smart-ips-pilgrimage.git`,language:'FSH',stargazers_count:12,forks_count:2,open_issues_count:1,topics:['who','smart-guidelines','dak','ips','pilgrimage','health'],created_at:'2023-06-10T12:00:00Z',updated_at:'2024-12-01T16:45:00Z',pushed_at:'2024-12-01T16:45:00Z',default_branch:'main',smart_guidelines_compatible:true,isDemo:true}];return Promise.resolve(demoRepos);}// Check if a repository has sushi-config.yaml with smart.who.int.base dependency\nasync checkSmartGuidelinesCompatibility(owner,repo){let retryCount=arguments.length>2&&arguments[2]!==undefined?arguments[2]:2;if(!this.isAuth()){return false;}// Check cache first to prevent redundant downloads\nconst cachedResult=repositoryCompatibilityCache.get(owner,repo);if(cachedResult!==null){return cachedResult;}try{// Try to get sushi-config.yaml from the repository root\nconst{data}=await this.octokit.rest.repos.getContent({owner,repo,path:'sushi-config.yaml'});if(data.type==='file'&&data.content){// Decode base64 content (browser-compatible)\nconst content=decodeURIComponent(escape(atob(data.content)));// Check if the content contains smart.who.int.base in dependencies\nconst isCompatible=content.includes('smart.who.int.base');// Cache the result\nrepositoryCompatibilityCache.set(owner,repo,isCompatible);return isCompatible;}// Cache negative result\nrepositoryCompatibilityCache.set(owner,repo,false);return false;}catch(error){// If it's a 404 (file not found), retry once more in case of temporary issues\nif(error.status===404&&retryCount>0){console.warn(`File not found for ${owner}/${repo}, retrying... (${retryCount} attempts left)`);// Use shorter delay in test environment\nconst delay=process.env.NODE_ENV==='test'?10:1000;await new Promise(resolve=>setTimeout(resolve,delay));return this.checkSmartGuidelinesCompatibility(owner,repo,retryCount-1);}// For any error (including rate limiting, network errors, or file not found after retries),\n// strictly return false - no fallback logic\nconsole.warn(`Failed to check ${owner}/${repo} for sushi-config.yaml with smart.who.int.base dependency:`,error.message);// Cache negative result\nrepositoryCompatibilityCache.set(owner,repo,false);return false;}}// Get repositories that are SMART guidelines compatible\nasync getSmartGuidelinesRepositories(owner){let type=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'user';if(!this.isAuth()){throw new Error('Not authenticated with GitHub');}try{let repositories=[];let page=1;let hasMorePages=true;// Fetch all repositories using pagination\nwhile(hasMorePages){let response;if(type==='user'){response=await this.octokit.rest.repos.listForUser({username:owner,sort:'updated',per_page:100,page:page});}else{response=await this.octokit.rest.repos.listForOrg({org:owner,sort:'updated',per_page:100,page:page});}repositories=repositories.concat(response.data);// Check if there are more pages\nhasMorePages=response.data.length===100;page++;}// Check each repository for SMART guidelines compatibility\nconst smartGuidelinesRepos=[];for(const repo of repositories){const isCompatible=await this.checkSmartGuidelinesCompatibility(repo.owner.login,repo.name);if(isCompatible){smartGuidelinesRepos.push({...repo,smart_guidelines_compatible:true});}}return smartGuidelinesRepos;}catch(error){console.error('Failed to fetch SMART guidelines repositories:',error);throw error;}}// Get repositories with progressive scanning (for real-time updates)\nasync getSmartGuidelinesRepositoriesProgressive(owner){let type=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'user';let onRepositoryFound=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;let onProgress=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;if(!this.isAuth()){throw new Error('Not authenticated with GitHub');}try{let repositories=[];let page=1;let hasMorePages=true;// Fetch all repositories using pagination\nwhile(hasMorePages){let response;if(type==='user'){response=await this.octokit.rest.repos.listForUser({username:owner,sort:'updated',per_page:100,page:page});}else{response=await this.octokit.rest.repos.listForOrg({org:owner,sort:'updated',per_page:100,page:page});}repositories=repositories.concat(response.data);// Check if there are more pages\nhasMorePages=response.data.length===100;page++;}// Handle case where user has no repositories\nif(repositories.length===0){console.log('ðŸ“Š No repositories found for user, completing scan immediately');// Call progress callback to indicate completion\nif(onProgress){onProgress({current:0,total:0,currentRepo:'none',progress:100,completed:true});}return[];}// Process repositories concurrently with rate limiting and enhanced display\nconst processor=async(repo,index)=>{// Add a small delay to make scanning progress visible (similar to demo mode)\nawait new Promise(resolve=>setTimeout(resolve,100+Math.random()*200));const isCompatible=await this.checkSmartGuidelinesCompatibility(repo.owner.login,repo.name);if(isCompatible){const smartRepo={...repo,smart_guidelines_compatible:true};// Notify that a repository was found\nif(onRepositoryFound){onRepositoryFound(smartRepo);}return smartRepo;}return null;};// Use concurrent processing with max 5 parallel requests\nconst results=await processConcurrently(repositories,processor,{concurrency:5,onProgress:(completed,total,repo,result)=>{// Progress callback for completed items\nif(onProgress){onProgress({current:completed,total:total,currentRepo:repo.name,progress:Math.round(completed/total*100),completed:true});}},onItemStart:(repo,index)=>{// Progress callback for started items\nif(onProgress){onProgress({current:index+1,total:repositories.length,currentRepo:repo.name,progress:Math.round((index+1)/repositories.length*100),completed:false,started:true});}}});// Filter out null results and collect smart repositories\nconst validResults=results.filter(result=>result!==null&&!result.error);return validResults;}catch(error){console.error('Failed to fetch SMART guidelines repositories:',error);throw error;}}// Get a specific repository\nasync getRepository(owner,repo){try{// Use authenticated octokit if available, otherwise create a public instance for public repos\nconst octokit=this.isAuth()?this.octokit:new Octokit();const{data}=await octokit.rest.repos.get({owner,repo});return data;}catch(error){console.error('Failed to fetch repository:',error);throw error;}}// Get repository branches\nasync getBranches(owner,repo){try{console.log(`githubService.getBranches: Fetching branches for ${owner}/${repo}`);console.log('githubService.getBranches: Authentication status:',this.isAuth());// Use authenticated octokit if available, otherwise create a public instance for public repos\nconst octokit=this.isAuth()?this.octokit:new Octokit();console.log('githubService.getBranches: Using',this.isAuth()?'authenticated':'public','octokit instance');const{data}=await octokit.rest.repos.listBranches({owner,repo,per_page:100});console.log(`githubService.getBranches: Successfully fetched ${data.length} branches`);return data;}catch(error){console.error('githubService.getBranches: Failed to fetch branches:',error);console.error('githubService.getBranches: Error details:',{status:error.status,message:error.message,owner,repo});throw error;}}// Create a new branch\nasync createBranch(owner,repo,branchName){let fromBranch=arguments.length>3&&arguments[3]!==undefined?arguments[3]:'main';if(!this.isAuth()){throw new Error('Not authenticated with GitHub');}try{// First get the SHA of the source branch\nconst{data:refData}=await this.octokit.rest.git.getRef({owner,repo,ref:`heads/${fromBranch}`});// Create the new branch\nconst{data}=await this.octokit.rest.git.createRef({owner,repo,ref:`refs/heads/${branchName}`,sha:refData.object.sha});return data;}catch(error){console.error('Failed to create branch:',error);throw error;}}// Get a specific branch\nasync getBranch(owner,repo,branch){try{// Use authenticated octokit if available, otherwise create a public instance for public repos\nconst octokit=this.isAuth()?this.octokit:new Octokit();const{data}=await octokit.rest.repos.getBranch({owner,repo,branch});return data;}catch(error){console.error('Failed to fetch branch:',error);throw error;}}// GitHub Actions API methods\n// Get workflows for a repository (detailed version with file parsing)\nasync getWorkflows(owner,repo){if(!this.isAuth()){throw new Error('Not authenticated with GitHub');}try{// First, try to get the .github/workflows directory\nconst{data}=await this.octokit.rest.repos.getContent({owner,repo,path:'.github/workflows'});// Filter for YAML/YML files\nconst workflowFiles=Array.isArray(data)?data.filter(file=>file.name.endsWith('.yml')||file.name.endsWith('.yaml')):[];// Fetch workflow details for each file\nconst workflows=await Promise.all(workflowFiles.map(async file=>{try{// Get file content to parse workflow name\nconst contentResponse=await this.octokit.rest.repos.getContent({owner,repo,path:file.path});const content=decodeURIComponent(escape(atob(contentResponse.data.content)));// Parse workflow name from YAML (simple regex approach)\nconst nameMatch=content.match(/^name:\\s*(.+)$/m);const workflowName=nameMatch?nameMatch[1].replace(/['\"]/g,''):file.name.replace(/\\.(yml|yaml)$/,'');// Parse triggers\nconst onMatch=content.match(/^on:\\s*$/m);let triggers=[];if(onMatch){const pushMatch=content.match(/^\\s*push:/m);const prMatch=content.match(/^\\s*pull_request:/m);const scheduleMatch=content.match(/^\\s*schedule:/m);const workflowDispatchMatch=content.match(/^\\s*workflow_dispatch:/m);if(pushMatch)triggers.push('push');if(prMatch)triggers.push('pull_request');if(scheduleMatch)triggers.push('schedule');if(workflowDispatchMatch)triggers.push('manual');}return{name:workflowName,filename:file.name,path:file.path,size:file.size,sha:file.sha,url:file.html_url,triggers:triggers.length>0?triggers:['push'],// default to push if we can't parse\nlastModified:contentResponse.data.last_modified||'Unknown'};}catch(error){console.warn(`Failed to fetch workflow details for ${file.name}:`,error);return{name:file.name.replace(/\\.(yml|yaml)$/,''),filename:file.name,path:file.path,size:file.size,sha:file.sha,url:file.html_url,triggers:['unknown'],lastModified:'Unknown'};}}));return workflows;}catch(error){if(error.status===404){// No .github/workflows directory exists\nreturn[];}console.error('Failed to fetch workflows:',error);throw error;}}// Get workflow runs for a repository\nasync getWorkflowRuns(owner,repo){let options=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};if(!this.isAuth()){throw new Error('Not authenticated with GitHub');}try{const params={owner,repo,per_page:options.per_page||10,page:options.page||1};if(options.branch){params.branch=options.branch;}if(options.workflow_id){params.workflow_id=options.workflow_id;}const{data}=await this.octokit.rest.actions.listWorkflowRunsForRepo(params);return data;}catch(error){console.error('Failed to fetch workflow runs:',error);throw error;}}// Get workflow runs for a specific workflow\nasync getWorkflowRunsForWorkflow(owner,repo,workflow_id){let options=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};if(!this.isAuth()){throw new Error('Not authenticated with GitHub');}try{const params={owner,repo,workflow_id,per_page:options.per_page||10,page:options.page||1};if(options.branch){params.branch=options.branch;}const{data}=await this.octokit.rest.actions.listWorkflowRuns(params);return data;}catch(error){console.error('Failed to fetch workflow runs for workflow:',error);throw error;}}// Trigger a workflow run\nasync triggerWorkflow(owner,repo,workflow_id){let ref=arguments.length>3&&arguments[3]!==undefined?arguments[3]:'main';let inputs=arguments.length>4&&arguments[4]!==undefined?arguments[4]:{};if(!this.isAuth()){throw new Error('Not authenticated with GitHub');}try{const{data}=await this.octokit.rest.actions.createWorkflowDispatch({owner,repo,workflow_id,ref,inputs});return data;}catch(error){console.error('Failed to trigger workflow:',error);throw error;}}// Re-run a workflow\nasync rerunWorkflow(owner,repo,run_id){if(!this.isAuth()){throw new Error('Not authenticated with GitHub');}try{const{data}=await this.octokit.rest.actions.reRunWorkflow({owner,repo,run_id});return data;}catch(error){console.error('Failed to re-run workflow:',error);throw error;}}// Get workflow run logs\nasync getWorkflowRunLogs(owner,repo,run_id){if(!this.isAuth()){throw new Error('Not authenticated with GitHub');}try{const{data}=await this.octokit.rest.actions.downloadWorkflowRunLogs({owner,repo,run_id});return data;}catch(error){console.error('Failed to get workflow run logs:',error);throw error;}}// Releases API methods\n// Get releases for a repository\nasync getReleases(owner,repo){let options=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};if(!this.isAuth()){throw new Error('Not authenticated with GitHub');}try{const{data}=await this.octokit.rest.repos.listReleases({owner,repo,per_page:options.per_page||10,page:options.page||1});return data;}catch(error){console.error('Failed to fetch releases:',error);throw error;}}// Get latest release\nasync getLatestRelease(owner,repo){if(!this.isAuth()){throw new Error('Not authenticated with GitHub');}try{const{data}=await this.octokit.rest.repos.getLatestRelease({owner,repo});return data;}catch(error){console.error('Failed to fetch latest release:',error);throw error;}}// Recursively fetch BPMN files from a directory and its subdirectories\nasync getBpmnFilesRecursive(owner,repo,path){let ref=arguments.length>3&&arguments[3]!==undefined?arguments[3]:'main';let allFiles=arguments.length>4&&arguments[4]!==undefined?arguments[4]:[];try{// Use authenticated octokit if available, otherwise create a public instance\nconst octokit=this.isAuth()?this.octokit:new Octokit();const{data}=await octokit.rest.repos.getContent({owner,repo,path,ref});// Handle single file response\nif(!Array.isArray(data)){if(data.name.endsWith('.bpmn')){allFiles.push(data);}return allFiles;}// Handle directory response\nfor(const item of data){if(item.type==='file'&&item.name.endsWith('.bpmn')){allFiles.push(item);}else if(item.type==='dir'){// Recursively search subdirectories\nawait this.getBpmnFilesRecursive(owner,repo,item.path,ref,allFiles);}}return allFiles;}catch(error){// If directory doesn't exist, return empty array (not an error)\nif(error.status===404){return allFiles;}throw error;}}// Get all BPMN files from a repository's business process directories\nasync getBpmnFiles(owner,repo){let ref=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'main';const allBpmnFiles=[];// Try both possible directory names: 'input/business-processes' and 'input/business-process'\nconst possiblePaths=['input/business-processes','input/business-process'];for(const path of possiblePaths){try{const files=await this.getBpmnFilesRecursive(owner,repo,path,ref);allBpmnFiles.push(...files);}catch(error){console.warn(`Could not fetch BPMN files from ${path}:`,error.message);// Continue trying other paths\n}}// Remove duplicates based on path (in case both directories exist and have overlapping files)\nconst uniqueFiles=allBpmnFiles.filter((file,index,self)=>index===self.findIndex(f=>f.path===file.path));return uniqueFiles;}// Get file content from GitHub repository with timeout handling\nasync getFileContent(owner,repo,path){let ref=arguments.length>3&&arguments[3]!==undefined?arguments[3]:'main';const timeoutMs=15000;// 15 second timeout\ntry{console.log(`ðŸš€ githubService.getFileContent: Starting request for ${owner}/${repo}/${path} (ref: ${ref})`);console.log('ðŸ” githubService.getFileContent: Authentication status:',this.isAuth());console.log('ðŸ“‹ githubService.getFileContent: Request parameters:',{owner,repo,path,ref});// Use authenticated octokit if available, otherwise create a public instance for public repos\nconst octokit=this.isAuth()?this.octokit:new Octokit();console.log('ðŸ”§ githubService.getFileContent: Using',this.isAuth()?'authenticated':'public','octokit instance');// Create a promise that rejects after timeout\nconst timeoutPromise=new Promise((_,reject)=>{console.log(`â° githubService.getFileContent: Setting up ${timeoutMs}ms timeout`);setTimeout(()=>{console.error(`â° githubService.getFileContent: Request timed out after ${timeoutMs}ms`);reject(new Error(`Request timeout after ${timeoutMs}ms`));},timeoutMs);});// Race the GitHub API call against the timeout\nconsole.log('ðŸŒ githubService.getFileContent: Creating GitHub API promise...');const apiPromise=octokit.rest.repos.getContent({owner,repo,path,ref});console.log('ðŸ“¡ githubService.getFileContent: API request initiated, waiting for response...');const startTime=Date.now();const{data}=await Promise.race([apiPromise,timeoutPromise]);const responseTime=Date.now()-startTime;console.log(`âœ… githubService.getFileContent: API response received in ${responseTime}ms`);console.log('ðŸ“‚ githubService.getFileContent: Response data type:',data.type);console.log('ðŸ“Š githubService.getFileContent: Response details:',{type:data.type,name:data.name,size:data.size,encoding:data.encoding,hasContent:!!data.content});// Handle file content\nif(data.type==='file'&&data.content){// Decode base64 content\nconsole.log('ðŸ”§ githubService.getFileContent: Decoding base64 content...');console.log('ðŸ“Š githubService.getFileContent: Base64 content length:',data.content.length);const content=decodeURIComponent(escape(atob(data.content)));console.log(`âœ… githubService.getFileContent: Successfully fetched and decoded file content`);console.log('ðŸ“ githubService.getFileContent: Final content length:',content.length,'characters');console.log('ðŸ‘€ githubService.getFileContent: Content preview (first 200 chars):',content.substring(0,200));return content;}else{console.error('âŒ githubService.getFileContent: Invalid response - not a file or no content');console.error('ðŸ” githubService.getFileContent: Full response data:',JSON.stringify(data,null,2));throw new Error('File not found or is not a file');}}catch(error){var _error$stack;console.error(`ðŸ’¥ githubService.getFileContent: Failed to fetch file content from ${owner}/${repo}/${path}:`,error);console.error('ðŸ” githubService.getFileContent: Error analysis:',{type:typeof error,status:error.status,message:error.message,name:error.name,stack:((_error$stack=error.stack)===null||_error$stack===void 0?void 0:_error$stack.substring(0,500))+'...'});// Provide more specific error messages\nif(error.message.includes('timeout')){console.error('â° githubService.getFileContent: Timeout error detected');throw new Error(`GitHub API request timed out after ${timeoutMs/1000} seconds. Please try again.`);}else if(error.status===403){console.error('ðŸ”’ githubService.getFileContent: 403 Forbidden error detected');throw new Error('Access denied. This repository may be private or you may have hit rate limits.');}else if(error.status===404){console.error('ðŸ” githubService.getFileContent: 404 Not Found error detected');throw new Error('File not found in the repository.');}else if(error.message.includes('rate limit')){console.error('ðŸš¦ githubService.getFileContent: Rate limit error detected');throw new Error('GitHub API rate limit exceeded. Please try again later.');}else if(error.message.includes('Network Error')||error.message.includes('Failed to fetch')){console.error('ðŸŒ githubService.getFileContent: Network error detected');throw new Error('Network error occurred. Please check your internet connection and try again.');}console.error('â“ githubService.getFileContent: Unknown error type, re-throwing original error');throw error;}}// Create a commit with multiple files\nasync createCommit(owner,repo,branch,message,files){if(!this.isAuth()){throw new Error('Not authenticated with GitHub');}try{// Get the latest commit SHA\nconst{data:refData}=await this.octokit.rest.git.getRef({owner,repo,ref:`heads/${branch}`});const latestCommitSha=refData.object.sha;// Get the tree SHA from the latest commit\nconst{data:commitData}=await this.octokit.rest.git.getCommit({owner,repo,commit_sha:latestCommitSha});const baseTreeSha=commitData.tree.sha;// Create blobs for all files\nconst blobs=await Promise.all(files.map(async file=>{const{data:blobData}=await this.octokit.rest.git.createBlob({owner,repo,content:file.content,encoding:'utf-8'});return{path:file.path,mode:'100644',type:'blob',sha:blobData.sha};}));// Create a new tree with the blobs\nconst{data:treeData}=await this.octokit.rest.git.createTree({owner,repo,base_tree:baseTreeSha,tree:blobs});// Create the commit\nconst{data:newCommitData}=await this.octokit.rest.git.createCommit({owner,repo,message,tree:treeData.sha,parents:[latestCommitSha]});// Update the branch reference\nawait this.octokit.rest.git.updateRef({owner,repo,ref:`heads/${branch}`,sha:newCommitData.sha});return{sha:newCommitData.sha,html_url:`https://github.com/${owner}/${repo}/commit/${newCommitData.sha}`,message:newCommitData.message,author:newCommitData.author,committer:newCommitData.committer};}catch(error){console.error('Failed to create commit:',error);throw error;}}// Get recent commits for a repository branch\nasync getRecentCommits(owner,repo){let branch=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'main';let per_page=arguments.length>3&&arguments[3]!==undefined?arguments[3]:5;if(!this.isAuth()){throw new Error('Not authenticated with GitHub');}const startTime=Date.now();this.logger.apiCall('GET',`/repos/${owner}/${repo}/commits`,{sha:branch,per_page});try{const response=await this.octokit.rest.repos.listCommits({owner,repo,sha:branch,per_page});this.logger.apiResponse('GET',`/repos/${owner}/${repo}/commits`,response.status,Date.now()-startTime);return response.data.map(commit=>({sha:commit.sha,message:commit.commit.message,author:{name:commit.commit.author.name,email:commit.commit.author.email,date:commit.commit.author.date},committer:{name:commit.commit.committer.name,email:commit.commit.committer.email,date:commit.commit.committer.date},html_url:commit.html_url,stats:commit.stats}));}catch(error){this.logger.apiResponse('GET',`/repos/${owner}/${repo}/commits`,error.status||'error',Date.now()-startTime);console.error('Failed to fetch recent commits:',error);throw error;}}// Get open pull requests count\nasync getOpenPullRequestsCount(owner,repo){if(!this.isAuth()){throw new Error('Not authenticated with GitHub');}const startTime=Date.now();this.logger.apiCall('GET',`/repos/${owner}/${repo}/pulls`,{state:'open',per_page:1});try{const response=await this.octokit.rest.pulls.list({owner,repo,state:'open',per_page:1});this.logger.apiResponse('GET',`/repos/${owner}/${repo}/pulls`,response.status,Date.now()-startTime);// GitHub includes the total count in the response headers\nconst linkHeader=response.headers.link;if(linkHeader&&linkHeader.includes('rel=\"last\"')){const lastPageMatch=linkHeader.match(/page=(\\d+)>; rel=\"last\"/);if(lastPageMatch){return parseInt(lastPageMatch[1],10);}}// Fallback: use the length of returned items (may not be accurate for large counts)\nreturn response.data.length;}catch(error){this.logger.apiResponse('GET',`/repos/${owner}/${repo}/pulls`,error.status||'error',Date.now()-startTime);console.error('Failed to fetch pull requests count:',error);throw error;}}// Get open issues count\nasync getOpenIssuesCount(owner,repo){if(!this.isAuth()){throw new Error('Not authenticated with GitHub');}const startTime=Date.now();this.logger.apiCall('GET',`/repos/${owner}/${repo}/issues`,{state:'open',per_page:1});try{const response=await this.octokit.rest.issues.listForRepo({owner,repo,state:'open',per_page:1});this.logger.apiResponse('GET',`/repos/${owner}/${repo}/issues`,response.status,Date.now()-startTime);// GitHub includes the total count in the response headers\nconst linkHeader=response.headers.link;if(linkHeader&&linkHeader.includes('rel=\"last\"')){const lastPageMatch=linkHeader.match(/page=(\\d+)>; rel=\"last\"/);if(lastPageMatch){return parseInt(lastPageMatch[1],10);}}// Fallback: use the length of returned items (may not be accurate for large counts)\nreturn response.data.length;}catch(error){this.logger.apiResponse('GET',`/repos/${owner}/${repo}/issues`,error.status||'error',Date.now()-startTime);console.error('Failed to fetch issues count:',error);throw error;}}// Get repository statistics (combined method for efficiency)\nasync getRepositoryStats(owner,repo){let branch=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'main';if(!this.isAuth()){throw new Error('Not authenticated with GitHub');}try{const[recentCommits,openPRsCount,openIssuesCount]=await Promise.allSettled([this.getRecentCommits(owner,repo,branch,1),this.getOpenPullRequestsCount(owner,repo),this.getOpenIssuesCount(owner,repo)]);return{recentCommits:recentCommits.status==='fulfilled'?recentCommits.value:[],openPullRequestsCount:openPRsCount.status==='fulfilled'?openPRsCount.value:0,openIssuesCount:openIssuesCount.status==='fulfilled'?openIssuesCount.value:0,errors:{recentCommits:recentCommits.status==='rejected'?recentCommits.reason:null,openPullRequestsCount:openPRsCount.status==='rejected'?openPRsCount.reason:null,openIssuesCount:openIssuesCount.status==='rejected'?openIssuesCount.reason:null}};}catch(error){console.error('Failed to fetch repository stats:',error);throw error;}}// Get directory contents (supports both authenticated and unauthenticated access)\nasync getDirectoryContents(owner,repo){let path=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'';let ref=arguments.length>3&&arguments[3]!==undefined?arguments[3]:'main';try{// Create temporary Octokit instance for unauthenticated access if needed\nconst octokit=this.isAuth()?this.octokit:new Octokit();const{data}=await octokit.rest.repos.getContent({owner,repo,path,ref});if(Array.isArray(data)){return data;}else{throw new Error('Not a directory');}}catch(error){console.error(`Failed to get directory contents for ${path}:`,error);throw error;}}// Update file content (requires authentication)\nasync updateFile(owner,repo,path,content,message){let branch=arguments.length>5&&arguments[5]!==undefined?arguments[5]:'main';if(!this.isAuth()){throw new Error('Authentication required to update files');}try{// First, get the current file to get its SHA\nconst{data:currentFile}=await this.octokit.rest.repos.getContent({owner,repo,path,ref:branch});if(Array.isArray(currentFile)){throw new Error('Path is a directory, not a file');}// Update the file\nconst{data}=await this.octokit.rest.repos.createOrUpdateFileContents({owner,repo,path,message,content:btoa(unescape(encodeURIComponent(content))),sha:currentFile.sha,branch});return data;}catch(error){console.error(`Failed to update file ${path}:`,error);throw error;}}// Get commits for a repository (supports unauthenticated access)\nasync getCommits(owner,repo){let options=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};try{// Create temporary Octokit instance for unauthenticated access if needed\nconst octokit=this.isAuth()?this.octokit:new Octokit();const params={owner,repo,per_page:options.per_page||10,page:options.page||1};if(options.sha){params.sha=options.sha;}if(options.since){params.since=options.since;}if(options.until){params.until=options.until;}const{data}=await octokit.rest.repos.listCommits(params);return data;}catch(error){console.error('Failed to fetch commits:',error);throw error;}}// Get issues for a repository (supports unauthenticated access)\nasync getIssues(owner,repo){let options=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};try{// Create temporary Octokit instance for unauthenticated access if needed\nconst octokit=this.isAuth()?this.octokit:new Octokit();const params={owner,repo,state:options.state||'all',per_page:options.per_page||30,page:options.page||1};if(options.labels){params.labels=options.labels;}if(options.milestone){params.milestone=options.milestone;}const{data}=await octokit.rest.issues.listForRepo(params);return data;}catch(error){console.error('Failed to fetch issues:',error);throw error;}}// Logout\nlogout(){this.octokit=null;this.isAuthenticated=false;this.tokenType=null;this.permissions=null;localStorage.removeItem('github_token');sessionStorage.removeItem('github_token');// Clear branch context on logout\ntry{const{default:branchContextService}=require('../services/branchContextService');branchContextService.clearAllBranchContext();}catch(error){// Service might not be available during testing\nsessionStorage.removeItem('sgex_branch_context');}}}// Create a singleton instance\nconst githubService=new GitHubService();export default githubService;","map":{"version":3,"names":["Octokit","processConcurrently","repositoryCompatibilityCache","logger","GITHUB_CONFIG","GitHubService","constructor","octokit","isAuthenticated","permissions","tokenType","getLogger","repoTokens","Map","currentRepo","guestMode","debug","authenticate","token","startTime","Date","now","auth","tokenProvided","tokenLength","length","duration","performance","error","message","console","authenticateWithOctokit","octokitInstance","initiateDeviceFlow","scopes","arguments","undefined","DEFAULT_SCOPES","response","fetch","method","headers","body","JSON","stringify","client_id","CLIENT_ID","scope","join","ok","Error","statusText","data","json","device_code","verification_uri","expires_in","user_code","verification_uri_complete","interval","pollDeviceFlowToken","deviceCode","grant_type","status","error_description","token_type","access_token","authenticateWithDeviceFlow","accessToken","userResponse","rest","users","getAuthenticated","username","login","success","user","setRepositoryToken","owner","repo","repoKey","set","timestamp","getRepositoryToken","get","switchToRepository","repoAuth","getRepositoryAccessLevel","level","canComment","canManageWorkflows","authenticated","hasPublicRepo","includes","hasRepo","hasWorkflow","checkRequiredScopes","action","currentScopes","actionRequirements","requiredScopes","missingScopes","filter","hasPermission","removeRepositoryToken","removed","delete","getAllRepositoryTokens","tokens","entries","split","push","clearAllRepositoryTokens","clear","enableGuestMode","checkTokenPermissions","isAuth","apiCall","request","apiResponse","rateLimitStart","rateLimit","resources","core","hasCore","rateLimitError","warn","type","apiError","checkRepositoryWritePermissions","currentUser","getCurrentUser","repos","getCollaboratorPermissionLevel","hasWriteAccess","permission","getUserOrganizations","orgs","listForAuthenticatedUser","getOrganization","orgLogin","org","getUser","getByUsername","getWHOOrganization","whoData","id","display_name","name","description","avatar_url","html_url","can_create_repositories","can_create_private_repositories","plan","private_repos","isWHO","getRepositories","isDemo","getDemoRepositories","getSmartGuidelinesRepositories","demoRepos","full_name","private","clone_url","language","stargazers_count","forks_count","open_issues_count","topics","created_at","updated_at","pushed_at","default_branch","smart_guidelines_compatible","Promise","resolve","checkSmartGuidelinesCompatibility","retryCount","cachedResult","getContent","path","content","decodeURIComponent","escape","atob","isCompatible","delay","process","env","NODE_ENV","setTimeout","repositories","page","hasMorePages","listForUser","sort","per_page","listForOrg","concat","smartGuidelinesRepos","getSmartGuidelinesRepositoriesProgressive","onRepositoryFound","onProgress","log","current","total","progress","completed","processor","index","Math","random","smartRepo","results","concurrency","result","round","onItemStart","started","validResults","getRepository","getBranches","listBranches","createBranch","branchName","fromBranch","refData","git","getRef","ref","createRef","sha","object","getBranch","branch","getWorkflows","workflowFiles","Array","isArray","file","endsWith","workflows","all","map","contentResponse","nameMatch","match","workflowName","replace","onMatch","triggers","pushMatch","prMatch","scheduleMatch","workflowDispatchMatch","filename","size","url","lastModified","last_modified","getWorkflowRuns","options","params","workflow_id","actions","listWorkflowRunsForRepo","getWorkflowRunsForWorkflow","listWorkflowRuns","triggerWorkflow","inputs","createWorkflowDispatch","rerunWorkflow","run_id","reRunWorkflow","getWorkflowRunLogs","downloadWorkflowRunLogs","getReleases","listReleases","getLatestRelease","getBpmnFilesRecursive","allFiles","item","getBpmnFiles","allBpmnFiles","possiblePaths","files","uniqueFiles","self","findIndex","f","getFileContent","timeoutMs","timeoutPromise","_","reject","apiPromise","race","responseTime","encoding","hasContent","substring","_error$stack","stack","createCommit","latestCommitSha","commitData","getCommit","commit_sha","baseTreeSha","tree","blobs","blobData","createBlob","mode","treeData","createTree","base_tree","newCommitData","parents","updateRef","author","committer","getRecentCommits","listCommits","commit","email","date","stats","getOpenPullRequestsCount","state","pulls","list","linkHeader","link","lastPageMatch","parseInt","getOpenIssuesCount","issues","listForRepo","getRepositoryStats","recentCommits","openPRsCount","openIssuesCount","allSettled","value","openPullRequestsCount","errors","reason","getDirectoryContents","updateFile","currentFile","createOrUpdateFileContents","btoa","unescape","encodeURIComponent","getCommits","since","until","getIssues","labels","milestone","logout","localStorage","removeItem","sessionStorage","default","branchContextService","require","clearAllBranchContext","githubService"],"sources":["/home/runner/work/sgex/sgex/src/services/githubService.js"],"sourcesContent":["import { Octokit } from '@octokit/rest';\nimport { processConcurrently } from '../utils/concurrency';\nimport repositoryCompatibilityCache from '../utils/repositoryCompatibilityCache';\nimport logger from '../utils/logger';\nimport GITHUB_CONFIG from '../config/github';\n\nclass GitHubService {\n  constructor() {\n    this.octokit = null;\n    this.isAuthenticated = false;\n    this.permissions = null;\n    this.tokenType = null; // 'classic', 'fine-grained', or 'oauth'\n    this.logger = logger.getLogger('GitHubService');\n    \n    // Per-repository token management (in-memory only)\n    this.repoTokens = new Map(); // Map of 'owner/repo' -> { token, scopes, octokit }\n    this.currentRepo = null; // Currently active repository\n    this.guestMode = false; // Whether user is browsing without authentication\n    \n    this.logger.debug('GitHubService instance created');\n  }\n\n  // Initialize with a GitHub token (supports both OAuth and PAT tokens)\n  authenticate(token) {\n    const startTime = Date.now();\n    this.logger.auth('Starting authentication', { tokenProvided: !!token, tokenLength: token ? token.length : 0 });\n    \n    try {\n      this.octokit = new Octokit({\n        auth: token,\n      });\n      this.isAuthenticated = true;\n      \n      const duration = Date.now() - startTime;\n      this.logger.auth('Authentication successful', { duration });\n      this.logger.performance('GitHub authentication', duration);\n      \n      return true;\n    } catch (error) {\n      const duration = Date.now() - startTime;\n      this.logger.auth('Authentication failed', { error: error.message, duration });\n      console.error('Failed to authenticate with GitHub:', error);\n      this.isAuthenticated = false;\n      return false;\n    }\n  }\n\n  // Initialize with an existing Octokit instance (for OAuth flow)\n  authenticateWithOctokit(octokitInstance) {\n    this.logger.auth('Starting OAuth authentication with Octokit instance');\n    \n    try {\n      this.octokit = octokitInstance;\n      this.isAuthenticated = true;\n      this.tokenType = 'oauth';\n      \n      this.logger.auth('OAuth authentication successful', { tokenType: this.tokenType });\n      return true;\n    } catch (error) {\n      this.logger.auth('OAuth authentication failed', { error: error.message });\n      console.error('Failed to authenticate with Octokit instance:', error);\n      this.isAuthenticated = false;\n      return false;\n    }\n  }\n\n  // OAuth Device Flow methods\n  \n  // Step 1: Initialize OAuth device flow\n  async initiateDeviceFlow(scopes = GITHUB_CONFIG.DEFAULT_SCOPES) {\n    this.logger.auth('Starting OAuth device flow', { scopes });\n    \n    try {\n      // Use GitHub's OAuth device flow endpoint\n      const response = await fetch('https://github.com/login/device/code', {\n        method: 'POST',\n        headers: {\n          'Accept': 'application/json',\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          client_id: GITHUB_CONFIG.CLIENT_ID,\n          scope: scopes.join(' ')\n        })\n      });\n\n      if (!response.ok) {\n        throw new Error(`Device flow initiation failed: ${response.statusText}`);\n      }\n\n      const data = await response.json();\n      \n      this.logger.auth('Device flow initiated successfully', { \n        device_code: data.device_code ? 'present' : 'missing',\n        verification_uri: data.verification_uri,\n        expires_in: data.expires_in \n      });\n\n      return {\n        device_code: data.device_code,\n        user_code: data.user_code,\n        verification_uri: data.verification_uri,\n        verification_uri_complete: data.verification_uri_complete,\n        expires_in: data.expires_in,\n        interval: data.interval || 5\n      };\n    } catch (error) {\n      this.logger.auth('Device flow initiation failed', { error: error.message });\n      console.error('Failed to initiate device flow:', error);\n      throw error;\n    }\n  }\n\n  // Step 2: Poll for device flow completion\n  async pollDeviceFlowToken(deviceCode, interval = 5) {\n    this.logger.auth('Starting device flow token polling', { deviceCode: deviceCode ? 'present' : 'missing', interval });\n    \n    try {\n      const response = await fetch('https://github.com/login/oauth/access_token', {\n        method: 'POST',\n        headers: {\n          'Accept': 'application/json',\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          client_id: GITHUB_CONFIG.CLIENT_ID,\n          device_code: deviceCode,\n          grant_type: 'urn:ietf:params:oauth:grant-type:device_code'\n        })\n      });\n\n      if (!response.ok) {\n        throw new Error(`Token polling failed: ${response.statusText}`);\n      }\n\n      const data = await response.json();\n      \n      if (data.error) {\n        if (data.error === 'authorization_pending') {\n          this.logger.auth('Device flow authorization still pending');\n          return { status: 'pending' };\n        } else if (data.error === 'slow_down') {\n          this.logger.auth('Device flow polling too fast, slowing down');\n          return { status: 'slow_down' };\n        } else if (data.error === 'expired_token') {\n          this.logger.auth('Device flow token expired');\n          return { status: 'expired' };\n        } else if (data.error === 'access_denied') {\n          this.logger.auth('Device flow access denied by user');\n          return { status: 'denied' };\n        } else {\n          throw new Error(`Device flow error: ${data.error} - ${data.error_description}`);\n        }\n      }\n\n      this.logger.auth('Device flow token received successfully', { \n        tokenType: data.token_type,\n        scope: data.scope \n      });\n\n      return {\n        status: 'success',\n        access_token: data.access_token,\n        token_type: data.token_type,\n        scope: data.scope\n      };\n    } catch (error) {\n      this.logger.auth('Device flow token polling failed', { error: error.message });\n      console.error('Failed to poll device flow token:', error);\n      throw error;\n    }\n  }\n\n  // Complete OAuth device flow authentication\n  async authenticateWithDeviceFlow(accessToken, scopes) {\n    this.logger.auth('Completing device flow authentication', { scopes });\n    \n    try {\n      const octokit = new Octokit({ auth: accessToken });\n      \n      // Test the token by fetching user info\n      const userResponse = await octokit.rest.users.getAuthenticated();\n      \n      // Store the authentication\n      this.octokit = octokit;\n      this.isAuthenticated = true;\n      this.tokenType = 'oauth';\n      \n      this.logger.auth('Device flow authentication completed successfully', { \n        username: userResponse.data.login,\n        tokenType: this.tokenType,\n        scopes \n      });\n\n      return {\n        success: true,\n        user: userResponse.data,\n        scopes,\n        token: accessToken\n      };\n    } catch (error) {\n      this.logger.auth('Device flow authentication completion failed', { error: error.message });\n      console.error('Failed to complete device flow authentication:', error);\n      this.isAuthenticated = false;\n      throw error;\n    }\n  }\n\n  // Per-Repository Token Management\n\n  // Set token for specific repository\n  setRepositoryToken(owner, repo, token, scopes) {\n    const repoKey = `${owner}/${repo}`;\n    this.logger.auth('Setting repository token', { repo: repoKey, scopes });\n    \n    try {\n      const octokit = new Octokit({ auth: token });\n      this.repoTokens.set(repoKey, {\n        token,\n        scopes: scopes || [],\n        octokit,\n        timestamp: Date.now()\n      });\n      \n      this.logger.auth('Repository token set successfully', { repo: repoKey });\n      return true;\n    } catch (error) {\n      this.logger.auth('Failed to set repository token', { repo: repoKey, error: error.message });\n      console.error('Failed to set repository token:', error);\n      return false;\n    }\n  }\n\n  // Get token for specific repository\n  getRepositoryToken(owner, repo) {\n    const repoKey = `${owner}/${repo}`;\n    return this.repoTokens.get(repoKey);\n  }\n\n  // Switch to repository context\n  switchToRepository(owner, repo) {\n    const repoKey = `${owner}/${repo}`;\n    this.currentRepo = repoKey;\n    this.logger.debug('Switched to repository context', { repo: repoKey });\n    \n    const repoAuth = this.repoTokens.get(repoKey);\n    if (repoAuth) {\n      // Use repository-specific authentication\n      this.octokit = repoAuth.octokit;\n      this.isAuthenticated = true;\n      this.tokenType = 'oauth';\n      this.guestMode = false;\n      this.logger.auth('Using repository-specific authentication', { repo: repoKey, scopes: repoAuth.scopes });\n    } else {\n      // Fall back to guest mode for this repository\n      this.guestMode = true;\n      this.isAuthenticated = false;\n      this.octokit = new Octokit(); // Public API access only\n      this.logger.auth('Switched to guest mode for repository', { repo: repoKey });\n    }\n    \n    return this.getRepositoryAccessLevel(owner, repo);\n  }\n\n  // Get access level for repository\n  getRepositoryAccessLevel(owner, repo) {\n    const repoKey = `${owner}/${repo}`;\n    const repoAuth = this.repoTokens.get(repoKey);\n    \n    if (!repoAuth) {\n      return {\n        level: 'read-only',\n        canComment: false,\n        canManageWorkflows: false,\n        scopes: [],\n        authenticated: false\n      };\n    }\n\n    const scopes = repoAuth.scopes;\n    const hasPublicRepo = scopes.includes('public_repo');\n    const hasRepo = scopes.includes('repo');\n    const hasWorkflow = scopes.includes('workflow');\n\n    return {\n      level: (hasPublicRepo || hasRepo) ? 'read-write' : 'read-only',\n      canComment: hasPublicRepo || hasRepo,\n      canManageWorkflows: hasWorkflow,\n      scopes,\n      authenticated: true\n    };\n  }\n\n  // Check if repository requires additional scopes for an action\n  checkRequiredScopes(owner, repo, action) {\n    const repoKey = `${owner}/${repo}`;\n    const repoAuth = this.repoTokens.get(repoKey);\n    const currentScopes = repoAuth ? repoAuth.scopes : [];\n    \n    const actionRequirements = {\n      'comment': ['public_repo'], // Can also use 'repo' for private repos\n      'workflow': ['workflow'],\n      'write': ['public_repo'] // Can also use 'repo' for private repos\n    };\n\n    const requiredScopes = actionRequirements[action] || [];\n    const missingScopes = requiredScopes.filter(scope => !currentScopes.includes(scope));\n    \n    return {\n      hasPermission: missingScopes.length === 0,\n      missingScopes,\n      requiredScopes\n    };\n  }\n\n  // Remove repository token (revoke access)\n  removeRepositoryToken(owner, repo) {\n    const repoKey = `${owner}/${repo}`;\n    const removed = this.repoTokens.delete(repoKey);\n    \n    if (removed) {\n      this.logger.auth('Repository token removed', { repo: repoKey });\n      \n      // If this was the current repository, switch to guest mode\n      if (this.currentRepo === repoKey) {\n        this.switchToRepository(owner, repo);\n      }\n    }\n    \n    return removed;\n  }\n\n  // Get all repository tokens (for management UI)\n  getAllRepositoryTokens() {\n    const tokens = [];\n    for (const [repoKey, auth] of this.repoTokens.entries()) {\n      const [owner, repo] = repoKey.split('/');\n      tokens.push({\n        owner,\n        repo,\n        scopes: auth.scopes,\n        timestamp: auth.timestamp\n      });\n    }\n    return tokens;\n  }\n\n  // Clear all repository tokens\n  clearAllRepositoryTokens() {\n    this.repoTokens.clear();\n    this.currentRepo = null;\n    this.guestMode = true;\n    this.isAuthenticated = false;\n    this.octokit = new Octokit(); // Public API access only\n    this.logger.auth('All repository tokens cleared');\n  }\n\n  // Enable guest mode (read-only browsing)\n  enableGuestMode() {\n    this.guestMode = true;\n    this.isAuthenticated = false;\n    this.octokit = new Octokit(); // Public API access only\n    this.logger.auth('Guest mode enabled');\n  }\n\n  // Check token permissions and type\n  async checkTokenPermissions() {\n    if (!this.isAuth()) {\n      const error = new Error('Not authenticated with GitHub');\n      this.logger.error('Token permission check failed - not authenticated');\n      throw error;\n    }\n\n    const startTime = Date.now();\n    this.logger.apiCall('GET', '/user', null);\n\n    try {\n      // Try to get token info to determine type and permissions\n      const response = await this.octokit.request('GET /user');\n      this.logger.apiResponse('GET', '/user', response.status, Date.now() - startTime);\n      \n      // Check if this is a fine-grained token by trying to access rate limit info\n      try {\n        const rateLimitStart = Date.now();\n        this.logger.apiCall('GET', '/rate_limit', null);\n        const rateLimit = await this.octokit.rest.rateLimit.get();\n        this.logger.apiResponse('GET', '/rate_limit', rateLimit.status, Date.now() - rateLimitStart);\n        \n        // Fine-grained tokens have different rate limit structure\n        this.tokenType = rateLimit.data.resources.core ? 'classic' : 'fine-grained';\n        this.logger.debug('Token type determined', { tokenType: this.tokenType, hasCore: !!rateLimit.data.resources.core });\n      } catch (rateLimitError) {\n        this.tokenType = 'unknown';\n        this.logger.warn('Could not determine token type from rate limit', { error: rateLimitError.message });\n      }\n\n      const permissions = {\n        type: this.tokenType,\n        user: response.data\n      };\n      \n      this.permissions = permissions;\n      this.logger.debug('Token permissions checked successfully', { \n        tokenType: this.tokenType, \n        username: response.data.login \n      });\n      \n      return permissions;\n    } catch (error) {\n      const duration = Date.now() - startTime;\n      this.logger.apiError('GET', '/user', error);\n      this.logger.performance('Token permission check (failed)', duration);\n      console.error('Failed to check token permissions:', error);\n      throw error;\n    }\n  }\n\n  // Check if we have write permissions for a specific repository\n  async checkRepositoryWritePermissions(owner, repo) {\n    if (!this.isAuth()) {\n      this.logger.warn('Cannot check repository write permissions - not authenticated', { owner, repo });\n      return false;\n    }\n\n    const startTime = Date.now();\n    this.logger.debug('Checking write permissions for repository', { owner, repo });\n\n    try {\n      // Get current user first\n      const currentUser = await this.getCurrentUser();\n      const username = currentUser.login;\n      \n      this.logger.apiCall('GET', `/repos/${owner}/${repo}/collaborators/${username}/permission`, null);\n      \n      // Try to get repository collaborator permissions\n      const { data } = await this.octokit.rest.repos.getCollaboratorPermissionLevel({\n        owner,\n        repo,\n        username\n      });\n      \n      const duration = Date.now() - startTime;\n      this.logger.apiResponse('GET', `/repos/${owner}/${repo}/collaborators/${username}/permission`, 200, duration);\n      \n      const hasWriteAccess = ['write', 'admin'].includes(data.permission);\n      this.logger.debug('Repository write permissions checked', { \n        owner, \n        repo, \n        permission: data.permission, \n        hasWriteAccess \n      });\n      \n      return hasWriteAccess;\n    } catch (error) {\n      const duration = Date.now() - startTime;\n      this.logger.apiError('GET', `/repos/${owner}/${repo}/collaborators/*/permission`, error);\n      this.logger.performance('Repository write permission check (failed)', duration);\n      \n      // If we can't check permissions, assume we don't have write access\n      console.warn('Could not check repository write permissions:', error);\n      this.logger.warn('Assuming no write access due to permission check failure', { owner, repo, error: error.message });\n      return false;\n    }\n  }\n\n  // Check if authenticated\n  isAuth() {\n    return this.isAuthenticated && this.octokit !== null;\n  }\n\n  // Get current user data\n  async getCurrentUser() {\n    if (!this.isAuth()) {\n      throw new Error('Not authenticated with GitHub');\n    }\n\n    try {\n      const { data } = await this.octokit.rest.users.getAuthenticated();\n      return data;\n    } catch (error) {\n      console.error('Failed to fetch user data:', error);\n      throw error;\n    }\n  }\n\n  // Get user's organizations\n  async getUserOrganizations() {\n    if (!this.isAuth()) {\n      throw new Error('Not authenticated with GitHub');\n    }\n\n    try {\n      const { data } = await this.octokit.rest.orgs.listForAuthenticatedUser();\n      return data;\n    } catch (error) {\n      console.error('Failed to fetch organizations:', error);\n      throw error;\n    }\n  }\n\n  // Get specific organization data (public data, no auth required)\n  async getOrganization(orgLogin) {\n    try {\n      // Create a temporary Octokit instance for public API calls if we don't have one\n      const octokit = this.octokit || new Octokit();\n      \n      const { data } = await octokit.rest.orgs.get({\n        org: orgLogin\n      });\n      return data;\n    } catch (error) {\n      console.error(`Failed to fetch organization ${orgLogin}:`, error);\n      throw error;\n    }\n  }\n\n  // Get specific user data (public data, no auth required)\n  async getUser(username) {\n    try {\n      // Create a temporary Octokit instance for public API calls if we don't have one\n      const octokit = this.octokit || new Octokit();\n      \n      const { data } = await octokit.rest.users.getByUsername({\n        username\n      });\n      return data;\n    } catch (error) {\n      console.error(`Failed to fetch user ${username}:`, error);\n      throw error;\n    }\n  }\n\n  // Get WHO organization data with fresh avatar\n  async getWHOOrganization() {\n    try {\n      const whoData = await this.getOrganization('WorldHealthOrganization');\n      return {\n        id: whoData.id,\n        login: whoData.login,\n        display_name: whoData.name || 'World Health Organization',\n        description: whoData.description || 'The World Health Organization is a specialized agency of the United Nations responsible for international public health.',\n        avatar_url: whoData.avatar_url,\n        html_url: whoData.html_url,\n        type: 'Organization',\n        permissions: {\n          can_create_repositories: true,\n          can_create_private_repositories: true\n        },\n        plan: {\n          name: 'Organization',\n          private_repos: 'unlimited'\n        },\n        isWHO: true\n      };\n    } catch (error) {\n      console.warn('Could not fetch WHO organization data from API, using fallback:', error);\n      // Return hardcoded fallback data\n      return {\n        id: 'who-organization',\n        login: 'WorldHealthOrganization',\n        display_name: 'World Health Organization',\n        description: 'The World Health Organization is a specialized agency of the United Nations responsible for international public health.',\n        avatar_url: 'https://avatars.githubusercontent.com/u/12261302?s=200&v=4',\n        html_url: 'https://github.com/WorldHealthOrganization',\n        type: 'Organization',\n        permissions: {\n          can_create_repositories: true,\n          can_create_private_repositories: true\n        },\n        plan: {\n          name: 'Organization',\n          private_repos: 'unlimited'\n        },\n        isWHO: true\n      };\n    }\n  }\n\n  // Get repositories for a user or organization (now filters by SMART Guidelines compatibility)\n  async getRepositories(owner, type = 'user', isDemo = false) {\n    // Handle demo mode - return demo repositories without requiring authentication\n    if (isDemo || owner === 'demo-user') {\n      return this.getDemoRepositories(owner);\n    }\n    \n    // Use the new SMART guidelines filtering method\n    return this.getSmartGuidelinesRepositories(owner, type);\n  }\n\n  // Get demo repositories for demo mode (no authentication required)\n  getDemoRepositories(owner) {\n    const demoRepos = [\n      {\n        id: 'demo-smart-anc',\n        name: 'smart-anc',\n        full_name: `${owner}/smart-anc`,\n        description: 'Demo SMART Guidelines Digital Adaptation Kit for Antenatal Care',\n        private: false,\n        owner: {\n          login: owner,\n          id: 'demo-owner',\n          avatar_url: `https://github.com/${owner}.png`,\n          type: 'User'\n        },\n        html_url: `https://github.com/${owner}/smart-anc`,\n        clone_url: `https://github.com/${owner}/smart-anc.git`,\n        language: 'FSH',\n        stargazers_count: 15,\n        forks_count: 3,\n        open_issues_count: 2,\n        topics: ['who', 'smart-guidelines', 'dak', 'antenatal-care', 'health'],\n        created_at: '2023-01-15T10:00:00Z',\n        updated_at: '2024-12-15T14:30:00Z',\n        pushed_at: '2024-12-15T14:30:00Z',\n        default_branch: 'main',\n        smart_guidelines_compatible: true,\n        isDemo: true\n      },\n      {\n        id: 'demo-smart-tb',\n        name: 'smart-tb',\n        full_name: `${owner}/smart-tb`,\n        description: 'Demo SMART Guidelines Digital Adaptation Kit for Tuberculosis Care',\n        private: false,\n        owner: {\n          login: owner,\n          id: 'demo-owner',\n          avatar_url: `https://github.com/${owner}.png`,\n          type: 'User'\n        },\n        html_url: `https://github.com/${owner}/smart-tb`,\n        clone_url: `https://github.com/${owner}/smart-tb.git`,\n        language: 'FSH',\n        stargazers_count: 8,\n        forks_count: 1,\n        open_issues_count: 0,\n        topics: ['who', 'smart-guidelines', 'dak', 'tuberculosis', 'health'],\n        created_at: '2023-03-20T15:00:00Z',\n        updated_at: '2024-11-30T09:15:00Z',\n        pushed_at: '2024-11-30T09:15:00Z',\n        default_branch: 'main',\n        smart_guidelines_compatible: true,\n        isDemo: true\n      },\n      {\n        id: 'demo-smart-ips-pilgrimage',\n        name: 'smart-ips-pilgrimage',\n        full_name: `${owner}/smart-ips-pilgrimage`,\n        description: 'Demo SMART Guidelines International Patient Summary for Pilgrimage',\n        private: false,\n        owner: {\n          login: owner,\n          id: 'demo-owner',\n          avatar_url: `https://github.com/${owner}.png`,\n          type: 'User'\n        },\n        html_url: `https://github.com/${owner}/smart-ips-pilgrimage`,\n        clone_url: `https://github.com/${owner}/smart-ips-pilgrimage.git`,\n        language: 'FSH',\n        stargazers_count: 12,\n        forks_count: 2,\n        open_issues_count: 1,\n        topics: ['who', 'smart-guidelines', 'dak', 'ips', 'pilgrimage', 'health'],\n        created_at: '2023-06-10T12:00:00Z',\n        updated_at: '2024-12-01T16:45:00Z',\n        pushed_at: '2024-12-01T16:45:00Z',\n        default_branch: 'main',\n        smart_guidelines_compatible: true,\n        isDemo: true\n      }\n    ];\n\n    return Promise.resolve(demoRepos);\n  }\n\n  // Check if a repository has sushi-config.yaml with smart.who.int.base dependency\n  async checkSmartGuidelinesCompatibility(owner, repo, retryCount = 2) {\n    if (!this.isAuth()) {\n      return false;\n    }\n\n    // Check cache first to prevent redundant downloads\n    const cachedResult = repositoryCompatibilityCache.get(owner, repo);\n    if (cachedResult !== null) {\n      return cachedResult;\n    }\n\n    try {\n      // Try to get sushi-config.yaml from the repository root\n      const { data } = await this.octokit.rest.repos.getContent({\n        owner,\n        repo,\n        path: 'sushi-config.yaml',\n      });\n\n      if (data.type === 'file' && data.content) {\n        // Decode base64 content (browser-compatible)\n        const content = decodeURIComponent(escape(atob(data.content)));\n        \n        // Check if the content contains smart.who.int.base in dependencies\n        const isCompatible = content.includes('smart.who.int.base');\n        \n        // Cache the result\n        repositoryCompatibilityCache.set(owner, repo, isCompatible);\n        return isCompatible;\n      }\n      \n      // Cache negative result\n      repositoryCompatibilityCache.set(owner, repo, false);\n      return false;\n    } catch (error) {\n      // If it's a 404 (file not found), retry once more in case of temporary issues\n      if (error.status === 404 && retryCount > 0) {\n        console.warn(`File not found for ${owner}/${repo}, retrying... (${retryCount} attempts left)`);\n        // Use shorter delay in test environment\n        const delay = process.env.NODE_ENV === 'test' ? 10 : 1000;\n        await new Promise(resolve => setTimeout(resolve, delay));\n        return this.checkSmartGuidelinesCompatibility(owner, repo, retryCount - 1);\n      }\n      \n      // For any error (including rate limiting, network errors, or file not found after retries),\n      // strictly return false - no fallback logic\n      console.warn(`Failed to check ${owner}/${repo} for sushi-config.yaml with smart.who.int.base dependency:`, error.message);\n      \n      // Cache negative result\n      repositoryCompatibilityCache.set(owner, repo, false);\n      return false;\n    }\n  }\n\n\n\n  // Get repositories that are SMART guidelines compatible\n  async getSmartGuidelinesRepositories(owner, type = 'user') {\n    if (!this.isAuth()) {\n      throw new Error('Not authenticated with GitHub');\n    }\n\n    try {\n      let repositories = [];\n      let page = 1;\n      let hasMorePages = true;\n\n      // Fetch all repositories using pagination\n      while (hasMorePages) {\n        let response;\n        if (type === 'user') {\n          response = await this.octokit.rest.repos.listForUser({\n            username: owner,\n            sort: 'updated',\n            per_page: 100,\n            page: page,\n          });\n        } else {\n          response = await this.octokit.rest.repos.listForOrg({\n            org: owner,\n            sort: 'updated',\n            per_page: 100,\n            page: page,\n          });\n        }\n\n        repositories = repositories.concat(response.data);\n        \n        // Check if there are more pages\n        hasMorePages = response.data.length === 100;\n        page++;\n      }\n\n      // Check each repository for SMART guidelines compatibility\n      const smartGuidelinesRepos = [];\n      for (const repo of repositories) {\n        const isCompatible = await this.checkSmartGuidelinesCompatibility(repo.owner.login, repo.name);\n        if (isCompatible) {\n          smartGuidelinesRepos.push({\n            ...repo,\n            smart_guidelines_compatible: true\n          });\n        }\n      }\n\n      return smartGuidelinesRepos;\n    } catch (error) {\n      console.error('Failed to fetch SMART guidelines repositories:', error);\n      throw error;\n    }\n  }\n\n  // Get repositories with progressive scanning (for real-time updates)\n  async getSmartGuidelinesRepositoriesProgressive(owner, type = 'user', onRepositoryFound = null, onProgress = null) {\n    if (!this.isAuth()) {\n      throw new Error('Not authenticated with GitHub');\n    }\n\n    try {\n      let repositories = [];\n      let page = 1;\n      let hasMorePages = true;\n\n      // Fetch all repositories using pagination\n      while (hasMorePages) {\n        let response;\n        if (type === 'user') {\n          response = await this.octokit.rest.repos.listForUser({\n            username: owner,\n            sort: 'updated',\n            per_page: 100,\n            page: page,\n          });\n        } else {\n          response = await this.octokit.rest.repos.listForOrg({\n            org: owner,\n            sort: 'updated',\n            per_page: 100,\n            page: page,\n          });\n        }\n\n        repositories = repositories.concat(response.data);\n        \n        // Check if there are more pages\n        hasMorePages = response.data.length === 100;\n        page++;\n      }\n\n      // Handle case where user has no repositories\n      if (repositories.length === 0) {\n        console.log('ðŸ“Š No repositories found for user, completing scan immediately');\n        // Call progress callback to indicate completion\n        if (onProgress) {\n          onProgress({\n            current: 0,\n            total: 0,\n            currentRepo: 'none',\n            progress: 100,\n            completed: true\n          });\n        }\n        return [];\n      }\n\n      // Process repositories concurrently with rate limiting and enhanced display\n      const processor = async (repo, index) => {\n        // Add a small delay to make scanning progress visible (similar to demo mode)\n        await new Promise(resolve => setTimeout(resolve, 100 + Math.random() * 200));\n        \n        const isCompatible = await this.checkSmartGuidelinesCompatibility(repo.owner.login, repo.name);\n        \n        if (isCompatible) {\n          const smartRepo = {\n            ...repo,\n            smart_guidelines_compatible: true\n          };\n          \n          // Notify that a repository was found\n          if (onRepositoryFound) {\n            onRepositoryFound(smartRepo);\n          }\n          \n          return smartRepo;\n        }\n        \n        return null;\n      };\n\n      // Use concurrent processing with max 5 parallel requests\n      const results = await processConcurrently(repositories, processor, {\n        concurrency: 5,\n        onProgress: (completed, total, repo, result) => {\n          // Progress callback for completed items\n          if (onProgress) {\n            onProgress({\n              current: completed,\n              total: total,\n              currentRepo: repo.name,\n              progress: Math.round((completed / total) * 100),\n              completed: true\n            });\n          }\n        },\n        onItemStart: (repo, index) => {\n          // Progress callback for started items\n          if (onProgress) {\n            onProgress({\n              current: index + 1,\n              total: repositories.length,\n              currentRepo: repo.name,\n              progress: Math.round(((index + 1) / repositories.length) * 100),\n              completed: false,\n              started: true\n            });\n          }\n        }\n      });\n\n      // Filter out null results and collect smart repositories\n      const validResults = results.filter(result => result !== null && !result.error);\n      \n      return validResults;\n    } catch (error) {\n      console.error('Failed to fetch SMART guidelines repositories:', error);\n      throw error;\n    }\n  }\n\n  // Get a specific repository\n  async getRepository(owner, repo) {\n    try {\n      // Use authenticated octokit if available, otherwise create a public instance for public repos\n      const octokit = this.isAuth() ? this.octokit : new Octokit();\n      \n      const { data } = await octokit.rest.repos.get({\n        owner,\n        repo,\n      });\n      return data;\n    } catch (error) {\n      console.error('Failed to fetch repository:', error);\n      throw error;\n    }  \n  }\n\n  // Get repository branches\n  async getBranches(owner, repo) {\n    try {\n      console.log(`githubService.getBranches: Fetching branches for ${owner}/${repo}`);\n      console.log('githubService.getBranches: Authentication status:', this.isAuth());\n      \n      // Use authenticated octokit if available, otherwise create a public instance for public repos\n      const octokit = this.isAuth() ? this.octokit : new Octokit();\n      console.log('githubService.getBranches: Using', this.isAuth() ? 'authenticated' : 'public', 'octokit instance');\n      \n      const { data } = await octokit.rest.repos.listBranches({\n        owner,\n        repo,\n        per_page: 100\n      });\n      \n      console.log(`githubService.getBranches: Successfully fetched ${data.length} branches`);\n      return data;\n    } catch (error) {\n      console.error('githubService.getBranches: Failed to fetch branches:', error);\n      console.error('githubService.getBranches: Error details:', {\n        status: error.status,\n        message: error.message,\n        owner,\n        repo\n      });\n      throw error;\n    }\n  }\n\n  // Create a new branch\n  async createBranch(owner, repo, branchName, fromBranch = 'main') {\n    if (!this.isAuth()) {\n      throw new Error('Not authenticated with GitHub');\n    }\n\n    try {\n      // First get the SHA of the source branch\n      const { data: refData } = await this.octokit.rest.git.getRef({\n        owner,\n        repo,\n        ref: `heads/${fromBranch}`\n      });\n\n      // Create the new branch\n      const { data } = await this.octokit.rest.git.createRef({\n        owner,\n        repo,\n        ref: `refs/heads/${branchName}`,\n        sha: refData.object.sha\n      });\n\n      return data;\n    } catch (error) {\n      console.error('Failed to create branch:', error);\n      throw error;\n    }\n  }\n\n  // Get a specific branch\n  async getBranch(owner, repo, branch) {\n    try {\n      // Use authenticated octokit if available, otherwise create a public instance for public repos\n      const octokit = this.isAuth() ? this.octokit : new Octokit();\n      \n      const { data } = await octokit.rest.repos.getBranch({\n        owner,\n        repo,\n        branch\n      });\n      return data;\n    } catch (error) {\n      console.error('Failed to fetch branch:', error);\n      throw error;\n    }\n  }\n\n  // GitHub Actions API methods\n  \n  // Get workflows for a repository (detailed version with file parsing)\n  async getWorkflows(owner, repo) {\n    if (!this.isAuth()) {\n      throw new Error('Not authenticated with GitHub');\n    }\n\n    try {\n      // First, try to get the .github/workflows directory\n      const { data } = await this.octokit.rest.repos.getContent({\n        owner,\n        repo,\n        path: '.github/workflows'\n      });\n\n      // Filter for YAML/YML files\n      const workflowFiles = Array.isArray(data) \n        ? data.filter(file => file.name.endsWith('.yml') || file.name.endsWith('.yaml'))\n        : [];\n\n      // Fetch workflow details for each file\n      const workflows = await Promise.all(\n        workflowFiles.map(async (file) => {\n          try {\n            // Get file content to parse workflow name\n            const contentResponse = await this.octokit.rest.repos.getContent({\n              owner,\n              repo,\n              path: file.path\n            });\n\n            const content = decodeURIComponent(escape(atob(contentResponse.data.content)));\n            \n            // Parse workflow name from YAML (simple regex approach)\n            const nameMatch = content.match(/^name:\\s*(.+)$/m);\n            const workflowName = nameMatch ? nameMatch[1].replace(/['\"]/g, '') : file.name.replace(/\\.(yml|yaml)$/, '');\n\n            // Parse triggers\n            const onMatch = content.match(/^on:\\s*$/m);\n            let triggers = [];\n            if (onMatch) {\n              const pushMatch = content.match(/^\\s*push:/m);\n              const prMatch = content.match(/^\\s*pull_request:/m);\n              const scheduleMatch = content.match(/^\\s*schedule:/m);\n              const workflowDispatchMatch = content.match(/^\\s*workflow_dispatch:/m);\n              \n              if (pushMatch) triggers.push('push');\n              if (prMatch) triggers.push('pull_request');\n              if (scheduleMatch) triggers.push('schedule');\n              if (workflowDispatchMatch) triggers.push('manual');\n            }\n\n            return {\n              name: workflowName,\n              filename: file.name,\n              path: file.path,\n              size: file.size,\n              sha: file.sha,\n              url: file.html_url,\n              triggers: triggers.length > 0 ? triggers : ['push'], // default to push if we can't parse\n              lastModified: contentResponse.data.last_modified || 'Unknown'\n            };\n          } catch (error) {\n            console.warn(`Failed to fetch workflow details for ${file.name}:`, error);\n            return {\n              name: file.name.replace(/\\.(yml|yaml)$/, ''),\n              filename: file.name,\n              path: file.path,\n              size: file.size,\n              sha: file.sha,\n              url: file.html_url,\n              triggers: ['unknown'],\n              lastModified: 'Unknown'\n            };\n          }\n        })\n      );\n\n      return workflows;\n    } catch (error) {\n      if (error.status === 404) {\n        // No .github/workflows directory exists\n        return [];\n      }\n      console.error('Failed to fetch workflows:', error);\n      throw error;\n    }\n  }\n\n  // Get workflow runs for a repository\n  async getWorkflowRuns(owner, repo, options = {}) {\n    if (!this.isAuth()) {\n      throw new Error('Not authenticated with GitHub');\n    }\n\n    try {\n      const params = {\n        owner,\n        repo,\n        per_page: options.per_page || 10,\n        page: options.page || 1\n      };\n\n      if (options.branch) {\n        params.branch = options.branch;\n      }\n\n      if (options.workflow_id) {\n        params.workflow_id = options.workflow_id;\n      }\n\n      const { data } = await this.octokit.rest.actions.listWorkflowRunsForRepo(params);\n      return data;\n    } catch (error) {\n      console.error('Failed to fetch workflow runs:', error);\n      throw error;\n    }\n  }\n\n  // Get workflow runs for a specific workflow\n  async getWorkflowRunsForWorkflow(owner, repo, workflow_id, options = {}) {\n    if (!this.isAuth()) {\n      throw new Error('Not authenticated with GitHub');\n    }\n\n    try {\n      const params = {\n        owner,\n        repo,\n        workflow_id,\n        per_page: options.per_page || 10,\n        page: options.page || 1\n      };\n\n      if (options.branch) {\n        params.branch = options.branch;\n      }\n\n      const { data } = await this.octokit.rest.actions.listWorkflowRuns(params);\n      return data;\n    } catch (error) {\n      console.error('Failed to fetch workflow runs for workflow:', error);\n      throw error;\n    }\n  }\n\n  // Trigger a workflow run\n  async triggerWorkflow(owner, repo, workflow_id, ref = 'main', inputs = {}) {\n    if (!this.isAuth()) {\n      throw new Error('Not authenticated with GitHub');\n    }\n\n    try {\n      const { data } = await this.octokit.rest.actions.createWorkflowDispatch({\n        owner,\n        repo,\n        workflow_id,\n        ref,\n        inputs\n      });\n      return data;\n    } catch (error) {\n      console.error('Failed to trigger workflow:', error);\n      throw error;\n    }\n  }\n\n  // Re-run a workflow\n  async rerunWorkflow(owner, repo, run_id) {\n    if (!this.isAuth()) {\n      throw new Error('Not authenticated with GitHub');\n    }\n\n    try {\n      const { data } = await this.octokit.rest.actions.reRunWorkflow({\n        owner,\n        repo,\n        run_id\n      });\n      return data;\n    } catch (error) {\n      console.error('Failed to re-run workflow:', error);\n      throw error;\n    }\n  }\n\n  // Get workflow run logs\n  async getWorkflowRunLogs(owner, repo, run_id) {\n    if (!this.isAuth()) {\n      throw new Error('Not authenticated with GitHub');\n    }\n\n    try {\n      const { data } = await this.octokit.rest.actions.downloadWorkflowRunLogs({\n        owner,\n        repo,\n        run_id\n      });\n      return data;\n    } catch (error) {\n      console.error('Failed to get workflow run logs:', error);\n      throw error;\n    }\n  }\n\n  // Releases API methods\n\n  // Get releases for a repository\n  async getReleases(owner, repo, options = {}) {\n    if (!this.isAuth()) {\n      throw new Error('Not authenticated with GitHub');\n    }\n\n    try {\n      const { data } = await this.octokit.rest.repos.listReleases({\n        owner,\n        repo,\n        per_page: options.per_page || 10,\n        page: options.page || 1\n      });\n      return data;\n    } catch (error) {\n      console.error('Failed to fetch releases:', error);\n      throw error;\n    }\n  }\n\n  // Get latest release\n  async getLatestRelease(owner, repo) {\n    if (!this.isAuth()) {\n      throw new Error('Not authenticated with GitHub');\n    }\n\n    try {\n      const { data } = await this.octokit.rest.repos.getLatestRelease({\n        owner,\n        repo\n      });\n      return data;\n    } catch (error) {\n      console.error('Failed to fetch latest release:', error);\n      throw error;\n    }\n  }\n\n  // Recursively fetch BPMN files from a directory and its subdirectories\n  async getBpmnFilesRecursive(owner, repo, path, ref = 'main', allFiles = []) {\n    try {\n      // Use authenticated octokit if available, otherwise create a public instance\n      const octokit = this.isAuth() ? this.octokit : new Octokit();\n      \n      const { data } = await octokit.rest.repos.getContent({\n        owner,\n        repo,\n        path,\n        ref\n      });\n\n      // Handle single file response\n      if (!Array.isArray(data)) {\n        if (data.name.endsWith('.bpmn')) {\n          allFiles.push(data);\n        }\n        return allFiles;\n      }\n\n      // Handle directory response\n      for (const item of data) {\n        if (item.type === 'file' && item.name.endsWith('.bpmn')) {\n          allFiles.push(item);\n        } else if (item.type === 'dir') {\n          // Recursively search subdirectories\n          await this.getBpmnFilesRecursive(owner, repo, item.path, ref, allFiles);\n        }\n      }\n\n      return allFiles;\n    } catch (error) {\n      // If directory doesn't exist, return empty array (not an error)\n      if (error.status === 404) {\n        return allFiles;\n      }\n      throw error;\n    }\n  }\n\n  // Get all BPMN files from a repository's business process directories\n  async getBpmnFiles(owner, repo, ref = 'main') {\n    const allBpmnFiles = [];\n    \n    // Try both possible directory names: 'input/business-processes' and 'input/business-process'\n    const possiblePaths = [\n      'input/business-processes',\n      'input/business-process'\n    ];\n\n    for (const path of possiblePaths) {\n      try {\n        const files = await this.getBpmnFilesRecursive(owner, repo, path, ref);\n        allBpmnFiles.push(...files);\n      } catch (error) {\n        console.warn(`Could not fetch BPMN files from ${path}:`, error.message);\n        // Continue trying other paths\n      }\n    }\n\n    // Remove duplicates based on path (in case both directories exist and have overlapping files)\n    const uniqueFiles = allBpmnFiles.filter((file, index, self) => \n      index === self.findIndex(f => f.path === file.path)\n    );\n\n    return uniqueFiles;\n  }\n\n  // Get file content from GitHub repository with timeout handling\n  async getFileContent(owner, repo, path, ref = 'main') {\n    const timeoutMs = 15000; // 15 second timeout\n    \n    try {\n      console.log(`ðŸš€ githubService.getFileContent: Starting request for ${owner}/${repo}/${path} (ref: ${ref})`);\n      console.log('ðŸ” githubService.getFileContent: Authentication status:', this.isAuth());\n      console.log('ðŸ“‹ githubService.getFileContent: Request parameters:', { owner, repo, path, ref });\n      \n      // Use authenticated octokit if available, otherwise create a public instance for public repos\n      const octokit = this.isAuth() ? this.octokit : new Octokit();\n      console.log('ðŸ”§ githubService.getFileContent: Using', this.isAuth() ? 'authenticated' : 'public', 'octokit instance');\n      \n      // Create a promise that rejects after timeout\n      const timeoutPromise = new Promise((_, reject) => {\n        console.log(`â° githubService.getFileContent: Setting up ${timeoutMs}ms timeout`);\n        setTimeout(() => {\n          console.error(`â° githubService.getFileContent: Request timed out after ${timeoutMs}ms`);\n          reject(new Error(`Request timeout after ${timeoutMs}ms`));\n        }, timeoutMs);\n      });\n      \n      // Race the GitHub API call against the timeout\n      console.log('ðŸŒ githubService.getFileContent: Creating GitHub API promise...');\n      const apiPromise = octokit.rest.repos.getContent({\n        owner,\n        repo,\n        path,\n        ref\n      });\n      \n      console.log('ðŸ“¡ githubService.getFileContent: API request initiated, waiting for response...');\n      const startTime = Date.now();\n      \n      const { data } = await Promise.race([apiPromise, timeoutPromise]);\n      const responseTime = Date.now() - startTime;\n      \n      console.log(`âœ… githubService.getFileContent: API response received in ${responseTime}ms`);\n      console.log('ðŸ“‚ githubService.getFileContent: Response data type:', data.type);\n      console.log('ðŸ“Š githubService.getFileContent: Response details:', {\n        type: data.type,\n        name: data.name,\n        size: data.size,\n        encoding: data.encoding,\n        hasContent: !!data.content\n      });\n\n      // Handle file content\n      if (data.type === 'file' && data.content) {\n        // Decode base64 content\n        console.log('ðŸ”§ githubService.getFileContent: Decoding base64 content...');\n        console.log('ðŸ“Š githubService.getFileContent: Base64 content length:', data.content.length);\n        \n        const content = decodeURIComponent(escape(atob(data.content)));\n        console.log(`âœ… githubService.getFileContent: Successfully fetched and decoded file content`);\n        console.log('ðŸ“ githubService.getFileContent: Final content length:', content.length, 'characters');\n        console.log('ðŸ‘€ githubService.getFileContent: Content preview (first 200 chars):', content.substring(0, 200));\n        \n        return content;\n      } else {\n        console.error('âŒ githubService.getFileContent: Invalid response - not a file or no content');\n        console.error('ðŸ” githubService.getFileContent: Full response data:', JSON.stringify(data, null, 2));\n        throw new Error('File not found or is not a file');\n      }\n    } catch (error) {\n      console.error(`ðŸ’¥ githubService.getFileContent: Failed to fetch file content from ${owner}/${repo}/${path}:`, error);\n      console.error('ðŸ” githubService.getFileContent: Error analysis:', {\n        type: typeof error,\n        status: error.status,\n        message: error.message,\n        name: error.name,\n        stack: error.stack?.substring(0, 500) + '...'\n      });\n      \n      // Provide more specific error messages\n      if (error.message.includes('timeout')) {\n        console.error('â° githubService.getFileContent: Timeout error detected');\n        throw new Error(`GitHub API request timed out after ${timeoutMs / 1000} seconds. Please try again.`);\n      } else if (error.status === 403) {\n        console.error('ðŸ”’ githubService.getFileContent: 403 Forbidden error detected');\n        throw new Error('Access denied. This repository may be private or you may have hit rate limits.');\n      } else if (error.status === 404) {\n        console.error('ðŸ” githubService.getFileContent: 404 Not Found error detected');\n        throw new Error('File not found in the repository.');\n      } else if (error.message.includes('rate limit')) {\n        console.error('ðŸš¦ githubService.getFileContent: Rate limit error detected');\n        throw new Error('GitHub API rate limit exceeded. Please try again later.');\n      } else if (error.message.includes('Network Error') || error.message.includes('Failed to fetch')) {\n        console.error('ðŸŒ githubService.getFileContent: Network error detected');\n        throw new Error('Network error occurred. Please check your internet connection and try again.');\n      }\n      \n      console.error('â“ githubService.getFileContent: Unknown error type, re-throwing original error');\n      throw error;\n    }\n  }\n\n  // Create a commit with multiple files\n  async createCommit(owner, repo, branch, message, files) {\n    if (!this.isAuth()) {\n      throw new Error('Not authenticated with GitHub');\n    }\n\n    try {\n      // Get the latest commit SHA\n      const { data: refData } = await this.octokit.rest.git.getRef({\n        owner,\n        repo,\n        ref: `heads/${branch}`\n      });\n      const latestCommitSha = refData.object.sha;\n\n      // Get the tree SHA from the latest commit\n      const { data: commitData } = await this.octokit.rest.git.getCommit({\n        owner,\n        repo,\n        commit_sha: latestCommitSha\n      });\n      const baseTreeSha = commitData.tree.sha;\n\n      // Create blobs for all files\n      const blobs = await Promise.all(\n        files.map(async (file) => {\n          const { data: blobData } = await this.octokit.rest.git.createBlob({\n            owner,\n            repo,\n            content: file.content,\n            encoding: 'utf-8'\n          });\n          return {\n            path: file.path,\n            mode: '100644',\n            type: 'blob',\n            sha: blobData.sha\n          };\n        })\n      );\n\n      // Create a new tree with the blobs\n      const { data: treeData } = await this.octokit.rest.git.createTree({\n        owner,\n        repo,\n        base_tree: baseTreeSha,\n        tree: blobs\n      });\n\n      // Create the commit\n      const { data: newCommitData } = await this.octokit.rest.git.createCommit({\n        owner,\n        repo,\n        message,\n        tree: treeData.sha,\n        parents: [latestCommitSha]\n      });\n\n      // Update the branch reference\n      await this.octokit.rest.git.updateRef({\n        owner,\n        repo,\n        ref: `heads/${branch}`,\n        sha: newCommitData.sha\n      });\n\n      return {\n        sha: newCommitData.sha,\n        html_url: `https://github.com/${owner}/${repo}/commit/${newCommitData.sha}`,\n        message: newCommitData.message,\n        author: newCommitData.author,\n        committer: newCommitData.committer\n      };\n    } catch (error) {\n      console.error('Failed to create commit:', error);\n      throw error;\n    }\n  }\n\n  // Get recent commits for a repository branch\n  async getRecentCommits(owner, repo, branch = 'main', per_page = 5) {\n    if (!this.isAuth()) {\n      throw new Error('Not authenticated with GitHub');\n    }\n\n    const startTime = Date.now();\n    this.logger.apiCall('GET', `/repos/${owner}/${repo}/commits`, { sha: branch, per_page });\n\n    try {\n      const response = await this.octokit.rest.repos.listCommits({\n        owner,\n        repo,\n        sha: branch,\n        per_page\n      });\n\n      this.logger.apiResponse('GET', `/repos/${owner}/${repo}/commits`, response.status, Date.now() - startTime);\n      \n      return response.data.map(commit => ({\n        sha: commit.sha,\n        message: commit.commit.message,\n        author: {\n          name: commit.commit.author.name,\n          email: commit.commit.author.email,\n          date: commit.commit.author.date\n        },\n        committer: {\n          name: commit.commit.committer.name,\n          email: commit.commit.committer.email,\n          date: commit.commit.committer.date\n        },\n        html_url: commit.html_url,\n        stats: commit.stats\n      }));\n    } catch (error) {\n      this.logger.apiResponse('GET', `/repos/${owner}/${repo}/commits`, error.status || 'error', Date.now() - startTime);\n      console.error('Failed to fetch recent commits:', error);\n      throw error;\n    }\n  }\n\n  // Get open pull requests count\n  async getOpenPullRequestsCount(owner, repo) {\n    if (!this.isAuth()) {\n      throw new Error('Not authenticated with GitHub');\n    }\n\n    const startTime = Date.now();\n    this.logger.apiCall('GET', `/repos/${owner}/${repo}/pulls`, { state: 'open', per_page: 1 });\n\n    try {\n      const response = await this.octokit.rest.pulls.list({\n        owner,\n        repo,\n        state: 'open',\n        per_page: 1\n      });\n\n      this.logger.apiResponse('GET', `/repos/${owner}/${repo}/pulls`, response.status, Date.now() - startTime);\n      \n      // GitHub includes the total count in the response headers\n      const linkHeader = response.headers.link;\n      if (linkHeader && linkHeader.includes('rel=\"last\"')) {\n        const lastPageMatch = linkHeader.match(/page=(\\d+)>; rel=\"last\"/);\n        if (lastPageMatch) {\n          return parseInt(lastPageMatch[1], 10);\n        }\n      }\n      \n      // Fallback: use the length of returned items (may not be accurate for large counts)\n      return response.data.length;\n    } catch (error) {\n      this.logger.apiResponse('GET', `/repos/${owner}/${repo}/pulls`, error.status || 'error', Date.now() - startTime);\n      console.error('Failed to fetch pull requests count:', error);\n      throw error;\n    }\n  }\n\n  // Get open issues count\n  async getOpenIssuesCount(owner, repo) {\n    if (!this.isAuth()) {\n      throw new Error('Not authenticated with GitHub');\n    }\n\n    const startTime = Date.now();\n    this.logger.apiCall('GET', `/repos/${owner}/${repo}/issues`, { state: 'open', per_page: 1 });\n\n    try {\n      const response = await this.octokit.rest.issues.listForRepo({\n        owner,\n        repo,\n        state: 'open',\n        per_page: 1\n      });\n\n      this.logger.apiResponse('GET', `/repos/${owner}/${repo}/issues`, response.status, Date.now() - startTime);\n      \n      // GitHub includes the total count in the response headers\n      const linkHeader = response.headers.link;\n      if (linkHeader && linkHeader.includes('rel=\"last\"')) {\n        const lastPageMatch = linkHeader.match(/page=(\\d+)>; rel=\"last\"/);\n        if (lastPageMatch) {\n          return parseInt(lastPageMatch[1], 10);\n        }\n      }\n      \n      // Fallback: use the length of returned items (may not be accurate for large counts)\n      return response.data.length;\n    } catch (error) {\n      this.logger.apiResponse('GET', `/repos/${owner}/${repo}/issues`, error.status || 'error', Date.now() - startTime);\n      console.error('Failed to fetch issues count:', error);\n      throw error;\n    }\n  }\n\n  // Get repository statistics (combined method for efficiency)\n  async getRepositoryStats(owner, repo, branch = 'main') {\n    if (!this.isAuth()) {\n      throw new Error('Not authenticated with GitHub');\n    }\n\n    try {\n      const [recentCommits, openPRsCount, openIssuesCount] = await Promise.allSettled([\n        this.getRecentCommits(owner, repo, branch, 1),\n        this.getOpenPullRequestsCount(owner, repo),\n        this.getOpenIssuesCount(owner, repo)\n      ]);\n\n      return {\n        recentCommits: recentCommits.status === 'fulfilled' ? recentCommits.value : [],\n        openPullRequestsCount: openPRsCount.status === 'fulfilled' ? openPRsCount.value : 0,\n        openIssuesCount: openIssuesCount.status === 'fulfilled' ? openIssuesCount.value : 0,\n        errors: {\n          recentCommits: recentCommits.status === 'rejected' ? recentCommits.reason : null,\n          openPullRequestsCount: openPRsCount.status === 'rejected' ? openPRsCount.reason : null,\n          openIssuesCount: openIssuesCount.status === 'rejected' ? openIssuesCount.reason : null\n        }\n      };\n    } catch (error) {\n      console.error('Failed to fetch repository stats:', error);\n      throw error;\n    }\n  }\n\n  // Get directory contents (supports both authenticated and unauthenticated access)\n  async getDirectoryContents(owner, repo, path = '', ref = 'main') {\n    try {\n      // Create temporary Octokit instance for unauthenticated access if needed\n      const octokit = this.isAuth() ? this.octokit : new Octokit();\n      \n      const { data } = await octokit.rest.repos.getContent({\n        owner,\n        repo,\n        path,\n        ref\n      });\n\n      if (Array.isArray(data)) {\n        return data;\n      } else {\n        throw new Error('Not a directory');\n      }\n    } catch (error) {\n      console.error(`Failed to get directory contents for ${path}:`, error);\n      throw error;\n    }\n  }\n\n  // Update file content (requires authentication)\n  async updateFile(owner, repo, path, content, message, branch = 'main') {\n    if (!this.isAuth()) {\n      throw new Error('Authentication required to update files');\n    }\n\n    try {\n      // First, get the current file to get its SHA\n      const { data: currentFile } = await this.octokit.rest.repos.getContent({\n        owner,\n        repo,\n        path,\n        ref: branch\n      });\n\n      if (Array.isArray(currentFile)) {\n        throw new Error('Path is a directory, not a file');\n      }\n\n      // Update the file\n      const { data } = await this.octokit.rest.repos.createOrUpdateFileContents({\n        owner,\n        repo,\n        path,\n        message,\n        content: btoa(unescape(encodeURIComponent(content))),\n        sha: currentFile.sha,\n        branch\n      });\n\n      return data;\n    } catch (error) {\n      console.error(`Failed to update file ${path}:`, error);\n      throw error;\n    }\n  }\n\n  // Get commits for a repository (supports unauthenticated access)\n  async getCommits(owner, repo, options = {}) {\n    try {\n      // Create temporary Octokit instance for unauthenticated access if needed\n      const octokit = this.isAuth() ? this.octokit : new Octokit();\n      \n      const params = {\n        owner,\n        repo,\n        per_page: options.per_page || 10,\n        page: options.page || 1\n      };\n\n      if (options.sha) {\n        params.sha = options.sha;\n      }\n\n      if (options.since) {\n        params.since = options.since;\n      }\n\n      if (options.until) {\n        params.until = options.until;\n      }\n\n      const { data } = await octokit.rest.repos.listCommits(params);\n      return data;\n    } catch (error) {\n      console.error('Failed to fetch commits:', error);\n      throw error;\n    }\n  }\n\n  // Get issues for a repository (supports unauthenticated access)\n  async getIssues(owner, repo, options = {}) {\n    try {\n      // Create temporary Octokit instance for unauthenticated access if needed\n      const octokit = this.isAuth() ? this.octokit : new Octokit();\n      \n      const params = {\n        owner,\n        repo,\n        state: options.state || 'all',\n        per_page: options.per_page || 30,\n        page: options.page || 1\n      };\n\n      if (options.labels) {\n        params.labels = options.labels;\n      }\n\n      if (options.milestone) {\n        params.milestone = options.milestone;\n      }\n\n      const { data } = await octokit.rest.issues.listForRepo(params);\n      return data;\n    } catch (error) {\n      console.error('Failed to fetch issues:', error);\n      throw error;\n    }\n  }\n\n  // Logout\n  logout() {\n    this.octokit = null;\n    this.isAuthenticated = false;\n    this.tokenType = null;\n    this.permissions = null;\n    localStorage.removeItem('github_token');\n    sessionStorage.removeItem('github_token');\n    \n    // Clear branch context on logout\n    try {\n      const { default: branchContextService } = require('../services/branchContextService');\n      branchContextService.clearAllBranchContext();\n    } catch (error) {\n      // Service might not be available during testing\n      sessionStorage.removeItem('sgex_branch_context');\n    }\n  }\n}\n\n// Create a singleton instance\nconst githubService = new GitHubService();\n\nexport default githubService;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}