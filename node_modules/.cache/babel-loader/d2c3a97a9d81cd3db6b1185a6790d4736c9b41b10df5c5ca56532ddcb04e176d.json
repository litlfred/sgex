{"ast":null,"code":"import inherits from 'inherits-browser';\nimport OrderingProvider from 'diagram-js/lib/features/ordering/OrderingProvider';\nimport { is, isAny } from '../modeling/util/ModelingUtil';\nimport { findIndex, find } from 'min-dash';\n\n/**\n * @typedef {import('diagram-js/lib/core/Canvas').default} Canvas\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n */\n\n/**\n * A BPMN-specific ordering provider.\n *\n * @param {EventBus} eventBus\n * @param {Canvas} canvas\n */\nexport default function BpmnOrderingProvider(eventBus, canvas) {\n  OrderingProvider.call(this, eventBus);\n  var orders = [{\n    type: 'bpmn:SubProcess',\n    order: {\n      level: 6\n    }\n  },\n  // handle SequenceFlow(s) like message flows and render them always on top\n  {\n    type: 'bpmn:SequenceFlow',\n    order: {\n      level: 9,\n      containers: ['bpmn:Participant', 'bpmn:FlowElementsContainer']\n    }\n  },\n  // handle DataAssociation(s) like message flows and render them always on top\n  {\n    type: 'bpmn:DataAssociation',\n    order: {\n      level: 9,\n      containers: ['bpmn:Collaboration', 'bpmn:FlowElementsContainer']\n    }\n  }, {\n    type: 'bpmn:TextAnnotation',\n    order: {\n      level: 9\n    }\n  }, {\n    type: 'bpmn:MessageFlow',\n    order: {\n      level: 9,\n      containers: ['bpmn:Collaboration']\n    }\n  }, {\n    type: 'bpmn:Association',\n    order: {\n      level: 6,\n      containers: ['bpmn:Participant', 'bpmn:FlowElementsContainer', 'bpmn:Collaboration']\n    }\n  }, {\n    type: 'bpmn:BoundaryEvent',\n    order: {\n      level: 8\n    }\n  }, {\n    type: 'bpmn:Group',\n    order: {\n      level: 10,\n      containers: ['bpmn:Collaboration', 'bpmn:FlowElementsContainer']\n    }\n  }, {\n    type: 'bpmn:FlowElement',\n    order: {\n      level: 5\n    }\n  }, {\n    type: 'bpmn:Participant',\n    order: {\n      level: -2\n    }\n  }, {\n    type: 'bpmn:Lane',\n    order: {\n      level: -1\n    }\n  }];\n  function computeOrder(element) {\n    if (element.labelTarget) {\n      return {\n        level: 10\n      };\n    }\n    var entry = find(orders, function (o) {\n      return isAny(element, [o.type]);\n    });\n    return entry && entry.order || {\n      level: 1\n    };\n  }\n  function getOrder(element) {\n    var order = element.order;\n    if (!order) {\n      element.order = order = computeOrder(element);\n    }\n    if (!order) {\n      throw new Error(`no order for <${element.id}>`);\n    }\n    return order;\n  }\n  function findActualParent(element, newParent, containers) {\n    var actualParent = newParent;\n    while (actualParent) {\n      if (isAny(actualParent, containers)) {\n        break;\n      }\n      actualParent = actualParent.parent;\n    }\n    if (!actualParent) {\n      throw new Error(`no parent for <${element.id}> in <${newParent && newParent.id}>`);\n    }\n    return actualParent;\n  }\n  this.getOrdering = function (element, newParent) {\n    // render labels and text annotations always on top\n    if (element.labelTarget || is(element, 'bpmn:TextAnnotation')) {\n      return {\n        parent: canvas.findRoot(newParent) || canvas.getRootElement(),\n        index: -1\n      };\n    }\n    var elementOrder = getOrder(element);\n    if (elementOrder.containers) {\n      newParent = findActualParent(element, newParent, elementOrder.containers);\n    }\n    var currentIndex = newParent.children.indexOf(element);\n    var insertIndex = findIndex(newParent.children, function (child) {\n      // do not compare with labels, they are created\n      // in the wrong order (right after elements) during import and\n      // mess up the positioning.\n      if (!element.labelTarget && child.labelTarget) {\n        return false;\n      }\n      return elementOrder.level < getOrder(child).level;\n    });\n\n    // if the element is already in the child list at\n    // a smaller index, we need to adjust the insert index.\n    // this takes into account that the element is being removed\n    // before being re-inserted\n    if (insertIndex !== -1) {\n      if (currentIndex !== -1 && currentIndex < insertIndex) {\n        insertIndex -= 1;\n      }\n    }\n    return {\n      index: insertIndex,\n      parent: newParent\n    };\n  };\n}\nBpmnOrderingProvider.$inject = ['eventBus', 'canvas'];\ninherits(BpmnOrderingProvider, OrderingProvider);","map":{"version":3,"names":["inherits","OrderingProvider","is","isAny","findIndex","find","BpmnOrderingProvider","eventBus","canvas","call","orders","type","order","level","containers","computeOrder","element","labelTarget","entry","o","getOrder","Error","id","findActualParent","newParent","actualParent","parent","getOrdering","findRoot","getRootElement","index","elementOrder","currentIndex","children","indexOf","insertIndex","child","$inject"],"sources":["/home/runner/work/sgex/sgex/node_modules/bpmn-js/lib/features/ordering/BpmnOrderingProvider.js"],"sourcesContent":["import inherits from 'inherits-browser';\n\nimport OrderingProvider from 'diagram-js/lib/features/ordering/OrderingProvider';\n\nimport {\n  is,\n  isAny\n} from '../modeling/util/ModelingUtil';\n\nimport {\n  findIndex,\n  find\n} from 'min-dash';\n\n/**\n * @typedef {import('diagram-js/lib/core/Canvas').default} Canvas\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n */\n\n/**\n * A BPMN-specific ordering provider.\n *\n * @param {EventBus} eventBus\n * @param {Canvas} canvas\n */\nexport default function BpmnOrderingProvider(eventBus, canvas) {\n\n  OrderingProvider.call(this, eventBus);\n\n  var orders = [\n    { type: 'bpmn:SubProcess', order: { level: 6 } },\n\n    // handle SequenceFlow(s) like message flows and render them always on top\n    {\n      type: 'bpmn:SequenceFlow',\n      order: {\n        level: 9,\n        containers: [\n          'bpmn:Participant',\n          'bpmn:FlowElementsContainer'\n        ]\n      }\n    },\n\n    // handle DataAssociation(s) like message flows and render them always on top\n    {\n      type: 'bpmn:DataAssociation',\n      order: {\n        level: 9,\n        containers: [\n          'bpmn:Collaboration',\n          'bpmn:FlowElementsContainer'\n        ]\n      }\n    },\n    {\n      type: 'bpmn:TextAnnotation',\n      order: {\n        level: 9\n      }\n    },\n    {\n      type: 'bpmn:MessageFlow', order: {\n        level: 9,\n        containers: [ 'bpmn:Collaboration' ]\n      }\n    },\n    {\n      type: 'bpmn:Association',\n      order: {\n        level: 6,\n        containers: [\n          'bpmn:Participant',\n          'bpmn:FlowElementsContainer',\n          'bpmn:Collaboration'\n        ]\n      }\n    },\n    { type: 'bpmn:BoundaryEvent', order: { level: 8 } },\n    {\n      type: 'bpmn:Group',\n      order: {\n        level: 10,\n        containers: [\n          'bpmn:Collaboration',\n          'bpmn:FlowElementsContainer'\n        ]\n      }\n    },\n    { type: 'bpmn:FlowElement', order: { level: 5 } },\n    { type: 'bpmn:Participant', order: { level: -2 } },\n    { type: 'bpmn:Lane', order: { level: -1 } }\n  ];\n\n  function computeOrder(element) {\n    if (element.labelTarget) {\n      return { level: 10 };\n    }\n\n    var entry = find(orders, function(o) {\n      return isAny(element, [ o.type ]);\n    });\n\n    return entry && entry.order || { level: 1 };\n  }\n\n  function getOrder(element) {\n\n    var order = element.order;\n\n    if (!order) {\n      element.order = order = computeOrder(element);\n    }\n\n    if (!order) {\n      throw new Error(`no order for <${ element.id }>`);\n    }\n\n    return order;\n  }\n\n  function findActualParent(element, newParent, containers) {\n\n    var actualParent = newParent;\n\n    while (actualParent) {\n\n      if (isAny(actualParent, containers)) {\n        break;\n      }\n\n      actualParent = actualParent.parent;\n    }\n\n    if (!actualParent) {\n      throw new Error(`no parent for <${ element.id }> in <${ newParent && newParent.id }>`);\n    }\n\n    return actualParent;\n  }\n\n  this.getOrdering = function(element, newParent) {\n\n    // render labels and text annotations always on top\n    if (element.labelTarget || is(element, 'bpmn:TextAnnotation')) {\n      return {\n        parent: canvas.findRoot(newParent) || canvas.getRootElement(),\n        index: -1\n      };\n    }\n\n    var elementOrder = getOrder(element);\n\n    if (elementOrder.containers) {\n      newParent = findActualParent(element, newParent, elementOrder.containers);\n    }\n\n    var currentIndex = newParent.children.indexOf(element);\n\n    var insertIndex = findIndex(newParent.children, function(child) {\n\n      // do not compare with labels, they are created\n      // in the wrong order (right after elements) during import and\n      // mess up the positioning.\n      if (!element.labelTarget && child.labelTarget) {\n        return false;\n      }\n\n      return elementOrder.level < getOrder(child).level;\n    });\n\n\n    // if the element is already in the child list at\n    // a smaller index, we need to adjust the insert index.\n    // this takes into account that the element is being removed\n    // before being re-inserted\n    if (insertIndex !== -1) {\n      if (currentIndex !== -1 && currentIndex < insertIndex) {\n        insertIndex -= 1;\n      }\n    }\n\n    return {\n      index: insertIndex,\n      parent: newParent\n    };\n  };\n}\n\nBpmnOrderingProvider.$inject = [ 'eventBus', 'canvas' ];\n\ninherits(BpmnOrderingProvider, OrderingProvider);"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}