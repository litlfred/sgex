{"ast":null,"code":"import { translate } from '../../util/SvgTransformUtil';\nimport { getVisual } from '../../util/GraphicsUtil';\nimport { append as svgAppend, attr as svgAttr, create as svgCreate, remove as svgRemove } from 'tiny-svg';\n\n/**\r\n * @typedef {import('../../core/Canvas').default} Canvas\r\n * @typedef {import('../../core/EventBus').default} EventBus\r\n * @typedef {import('../../core/GraphicsFactory').default} GraphicsFactory\r\n * @typedef {import('../preview-support/PreviewSupport').default} PreviewSupport\r\n * @typedef {import('../../draw/Styles').default} Styles\r\n */\n\nvar LOW_PRIORITY = 750;\n\n/**\r\n * @param {Canvas} canvas\r\n * @param {EventBus} eventBus\r\n * @param {GraphicsFactory} graphicsFactory\r\n * @param {PreviewSupport} previewSupport\r\n * @param {Styles} styles\r\n */\nexport default function CreatePreview(canvas, eventBus, graphicsFactory, previewSupport, styles) {\n  function createDragGroup(elements) {\n    var dragGroup = svgCreate('g');\n    svgAttr(dragGroup, styles.cls('djs-drag-group', ['no-events']));\n    var childrenGfx = svgCreate('g');\n    elements.forEach(function (element) {\n      // create graphics\n      var gfx;\n      if (element.hidden) {\n        return;\n      }\n      if (element.waypoints) {\n        gfx = graphicsFactory._createContainer('connection', childrenGfx);\n        graphicsFactory.drawConnection(getVisual(gfx), element);\n      } else {\n        gfx = graphicsFactory._createContainer('shape', childrenGfx);\n        graphicsFactory.drawShape(getVisual(gfx), element);\n        translate(gfx, element.x, element.y);\n      }\n\n      // add preview\n      previewSupport.addDragger(element, dragGroup, gfx);\n    });\n    return dragGroup;\n  }\n  eventBus.on('create.move', LOW_PRIORITY, function (event) {\n    var hover = event.hover,\n      context = event.context,\n      elements = context.elements,\n      dragGroup = context.dragGroup;\n\n    // lazily create previews\n    if (!dragGroup) {\n      dragGroup = context.dragGroup = createDragGroup(elements);\n    }\n    var activeLayer;\n    if (hover) {\n      if (!dragGroup.parentNode) {\n        activeLayer = canvas.getActiveLayer();\n        svgAppend(activeLayer, dragGroup);\n      }\n      translate(dragGroup, event.x, event.y);\n    } else {\n      svgRemove(dragGroup);\n    }\n  });\n  eventBus.on('create.cleanup', function (event) {\n    var context = event.context,\n      dragGroup = context.dragGroup;\n    if (dragGroup) {\n      svgRemove(dragGroup);\n    }\n  });\n}\nCreatePreview.$inject = ['canvas', 'eventBus', 'graphicsFactory', 'previewSupport', 'styles'];","map":{"version":3,"names":["translate","getVisual","append","svgAppend","attr","svgAttr","create","svgCreate","remove","svgRemove","LOW_PRIORITY","CreatePreview","canvas","eventBus","graphicsFactory","previewSupport","styles","createDragGroup","elements","dragGroup","cls","childrenGfx","forEach","element","gfx","hidden","waypoints","_createContainer","drawConnection","drawShape","x","y","addDragger","on","event","hover","context","activeLayer","parentNode","getActiveLayer","$inject"],"sources":["/home/runner/work/sgex/sgex/node_modules/diagram-js/lib/features/create/CreatePreview.js"],"sourcesContent":["import {\r\n  translate\r\n} from '../../util/SvgTransformUtil';\r\n\r\nimport { getVisual } from '../../util/GraphicsUtil';\r\n\r\nimport {\r\n  append as svgAppend,\r\n  attr as svgAttr,\r\n  create as svgCreate,\r\n  remove as svgRemove\r\n} from 'tiny-svg';\r\n\r\n/**\r\n * @typedef {import('../../core/Canvas').default} Canvas\r\n * @typedef {import('../../core/EventBus').default} EventBus\r\n * @typedef {import('../../core/GraphicsFactory').default} GraphicsFactory\r\n * @typedef {import('../preview-support/PreviewSupport').default} PreviewSupport\r\n * @typedef {import('../../draw/Styles').default} Styles\r\n */\r\n\r\nvar LOW_PRIORITY = 750;\r\n\r\n/**\r\n * @param {Canvas} canvas\r\n * @param {EventBus} eventBus\r\n * @param {GraphicsFactory} graphicsFactory\r\n * @param {PreviewSupport} previewSupport\r\n * @param {Styles} styles\r\n */\r\nexport default function CreatePreview(\r\n    canvas,\r\n    eventBus,\r\n    graphicsFactory,\r\n    previewSupport,\r\n    styles\r\n) {\r\n  function createDragGroup(elements) {\r\n    var dragGroup = svgCreate('g');\r\n\r\n    svgAttr(dragGroup, styles.cls('djs-drag-group', [ 'no-events' ]));\r\n\r\n    var childrenGfx = svgCreate('g');\r\n\r\n    elements.forEach(function(element) {\r\n\r\n      // create graphics\r\n      var gfx;\r\n\r\n      if (element.hidden) {\r\n        return;\r\n      }\r\n\r\n      if (element.waypoints) {\r\n        gfx = graphicsFactory._createContainer('connection', childrenGfx);\r\n\r\n        graphicsFactory.drawConnection(getVisual(gfx), element);\r\n      } else {\r\n        gfx = graphicsFactory._createContainer('shape', childrenGfx);\r\n\r\n        graphicsFactory.drawShape(getVisual(gfx), element);\r\n\r\n        translate(gfx, element.x, element.y);\r\n      }\r\n\r\n      // add preview\r\n      previewSupport.addDragger(element, dragGroup, gfx);\r\n    });\r\n\r\n    return dragGroup;\r\n  }\r\n\r\n  eventBus.on('create.move', LOW_PRIORITY, function(event) {\r\n\r\n    var hover = event.hover,\r\n        context = event.context,\r\n        elements = context.elements,\r\n        dragGroup = context.dragGroup;\r\n\r\n    // lazily create previews\r\n    if (!dragGroup) {\r\n      dragGroup = context.dragGroup = createDragGroup(elements);\r\n    }\r\n\r\n    var activeLayer;\r\n\r\n    if (hover) {\r\n      if (!dragGroup.parentNode) {\r\n        activeLayer = canvas.getActiveLayer();\r\n\r\n        svgAppend(activeLayer, dragGroup);\r\n      }\r\n\r\n      translate(dragGroup, event.x, event.y);\r\n    } else {\r\n      svgRemove(dragGroup);\r\n    }\r\n  });\r\n\r\n  eventBus.on('create.cleanup', function(event) {\r\n    var context = event.context,\r\n        dragGroup = context.dragGroup;\r\n\r\n    if (dragGroup) {\r\n      svgRemove(dragGroup);\r\n    }\r\n  });\r\n}\r\n\r\nCreatePreview.$inject = [\r\n  'canvas',\r\n  'eventBus',\r\n  'graphicsFactory',\r\n  'previewSupport',\r\n  'styles'\r\n];\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}