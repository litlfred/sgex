{"ast":null,"code":"/**\n * SUSHI WebAssembly Service\n * \n * This service manages the loading and execution of SUSHI via WebAssembly.\n * It provides a bridge between the React application and the WASM module.\n */class VirtualFileSystem{constructor(){this.files=new Map();this.directories=new Set();}writeFile(path,content){// Normalize path\nconst normalizedPath=path.startsWith('/')?path.substring(1):path;// Ensure parent directories exist\nconst pathParts=normalizedPath.split('/');for(let i=0;i<pathParts.length-1;i++){const dirPath=pathParts.slice(0,i+1).join('/');this.directories.add(dirPath);}// Store file content as Uint8Array for WASM compatibility\nconst encoder=new TextEncoder();this.files.set(normalizedPath,encoder.encode(content));return true;}readFile(path){const normalizedPath=path.startsWith('/')?path.substring(1):path;const data=this.files.get(normalizedPath);if(!data){return null;}// Convert back to string for JavaScript consumption\nconst decoder=new TextDecoder();return decoder.decode(data);}exists(path){const normalizedPath=path.startsWith('/')?path.substring(1):path;return this.files.has(normalizedPath)||this.directories.has(normalizedPath);}listDirectory(path){const normalizedPath=path.startsWith('/')?path.substring(1):path;const prefix=normalizedPath?`${normalizedPath}/`:'';const items=[];// Add files\nfor(const filePath of this.files.keys()){if(filePath.startsWith(prefix)){const relativePath=filePath.substring(prefix.length);if(!relativePath.includes('/')){// Direct child only\nitems.push({name:relativePath,type:'file',path:filePath});}}}// Add directories\nfor(const dirPath of this.directories){if(dirPath.startsWith(prefix)){const relativePath=dirPath.substring(prefix.length);if(!relativePath.includes('/')){// Direct child only\nitems.push({name:relativePath,type:'directory',path:dirPath});}}}return items;}clear(){this.files.clear();this.directories.clear();}}class SushiWASMRunner{constructor(){this.wasmModule=null;this.fs=new VirtualFileSystem();this.isInitialized=false;this.initializationPromise=null;}async initialize(){if(this.isInitialized){return this.wasmModule;}if(this.initializationPromise){return this.initializationPromise;}this.initializationPromise=this._loadWasmModule();return this.initializationPromise;}async _loadWasmModule(){try{// For now, we'll create a fallback implementation that uses the existing fsh-sushi\n// dependency but in a browser-compatible way. This is a stepping stone to full WASM.\n// Import the SUSHI library dynamically to avoid build issues\nconst sushiModule=await this._importSushiLibrary();this.wasmModule=sushiModule;this.isInitialized=true;return this.wasmModule;}catch(error){console.error('Failed to load SUSHI WASM module:',error);throw new Error(`SUSHI WASM initialization failed: ${error.message}`);}}async _importSushiLibrary(){// This is a bridge implementation that provides a WASM-like interface\n// for future migration. For now, we avoid direct fsh-sushi imports\n// due to Node.js dependency conflicts in browser environment.\nconsole.log('Creating fallback SUSHI implementation for browser environment');// Return a mock implementation with WASM-style interface\nreturn{ccall:this._createFallbackCCall.bind(this),FS:{writeFile:this.fs.writeFile.bind(this.fs),readFile:this.fs.readFile.bind(this.fs),exists:this.fs.exists.bind(this.fs)}};}_createFallbackCCall(){return(functionName,returnType,paramTypes,params)=>{if(functionName==='runSushi'){return this._runFallbackCompilation(params[0]);}throw new Error(`Unsupported WASM function: ${functionName}`);};}async _runFallbackCompilation(workspacePath){// Fallback implementation using the existing custom FSH parser\n// This maintains the current functionality while providing WASM interface\nconst outputFiles=[];const errors=[];const warnings=[];try{const fshFiles=this._getAllFshFiles();const configContent=this.fs.readFile('sushi-config.yaml');let config={name:'browser-generated-ig',version:'1.0.0',fhirVersion:'4.0.1',canonical:'http://example.org/fhir/ig/browser-generated'};if(configContent){try{const yaml=await import('js-yaml');config=yaml.default.load(configContent);}catch(err){warnings.push(`Failed to parse sushi-config.yaml: ${err.message}`);}}else{warnings.push('No sushi-config.yaml found, using default configuration');}// Use the existing FSH parsing logic from SushiRunner\nfor(const{content}of fshFiles){const definitions=this._extractFSHDefinitions(content);// Generate FHIR resources using the same logic as the current implementation\nconst resources=this._generateFHIRResources(definitions,config);outputFiles.push(...resources);}return JSON.stringify({success:true,files:outputFiles,errors:errors,warnings:warnings});}catch(error){return JSON.stringify({success:false,files:[],errors:[error.message],warnings:warnings});}}_getAllFshFiles(){var _this=this;const fshFiles=[];// Recursively collect all .fsh files\nconst collectFiles=function(){let path=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'';const items=_this.fs.listDirectory(path);for(const item of items){if(item.type==='file'&&item.name.endsWith('.fsh')){const content=_this.fs.readFile(item.path);if(content){fshFiles.push({path:item.path,content:content});}}else if(item.type==='directory'){collectFiles(item.path);}}};collectFiles('input/fsh');return fshFiles;}_extractFSHDefinitions(content){// Reuse the existing FSH parsing logic from SushiRunner\nconst definitions={profiles:[],instances:[],valueSets:[],codeSystems:[],extensions:[]};const lines=content.split('\\n');let currentDefinition=null;let currentType=null;for(let i=0;i<lines.length;i++){const line=lines[i].trim();// Detect definition types\nif(line.startsWith('Profile:')){currentType='profiles';currentDefinition={name:line.substring(8).trim(),type:'Profile',parent:null,id:null,title:null,description:null,rules:[]};}else if(line.startsWith('Instance:')){currentType='instances';currentDefinition={name:line.substring(9).trim(),type:'Instance',instanceOf:null,usage:null,title:null,description:null,rules:[]};}else if(line.startsWith('ValueSet:')){currentType='valueSets';currentDefinition={name:line.substring(9).trim(),type:'ValueSet',id:null,title:null,description:null,rules:[]};}else if(line.startsWith('CodeSystem:')){currentType='codeSystems';currentDefinition={name:line.substring(11).trim(),type:'CodeSystem',id:null,title:null,description:null,rules:[]};}else if(line.startsWith('Extension:')){currentType='extensions';currentDefinition={name:line.substring(10).trim(),type:'Extension',id:null,title:null,description:null,rules:[]};}// Parse properties\nif(currentDefinition){if(line.startsWith('Parent:')){currentDefinition.parent=line.substring(7).trim();}else if(line.startsWith('InstanceOf:')){currentDefinition.instanceOf=line.substring(11).trim();}else if(line.startsWith('Usage:')){currentDefinition.usage=line.substring(6).trim();}else if(line.startsWith('Id:')){currentDefinition.id=line.substring(3).trim();}else if(line.startsWith('Title:')){currentDefinition.title=line.substring(6).trim().replace(/['\"]/g,'');}else if(line.startsWith('Description:')){currentDefinition.description=line.substring(12).trim().replace(/['\"]/g,'');}else if(line.startsWith('* ')){currentDefinition.rules.push(line.substring(2).trim());}// If we hit a new definition or end of content, save current one\nif(line.includes(':')&&!line.startsWith('* ')&&!line.startsWith('Parent:')&&!line.startsWith('InstanceOf:')&&!line.startsWith('Usage:')&&!line.startsWith('Id:')&&!line.startsWith('Title:')&&!line.startsWith('Description:')||i===lines.length-1){if(currentDefinition&&currentType&&currentDefinition.name){definitions[currentType].push(currentDefinition);}currentDefinition=null;currentType=null;i--;// Re-process this line for the new definition\n}}}return definitions;}_generateFHIRResources(definitions,config){const resources=[];// Generate StructureDefinitions from profiles\ndefinitions.profiles.forEach(profile=>{const profileId=profile.id||profile.name.toLowerCase().replace(/\\s+/g,'-');const structureDefinition={resourceType:'StructureDefinition',id:profileId,url:`${config.canonical}/StructureDefinition/${profileId}`,name:profile.name,title:profile.title||profile.name,status:'draft',fhirVersion:config.fhirVersion||'4.0.1',kind:'resource',abstract:false,type:profile.parent==='Patient'?'Patient':profile.parent==='Observation'?'Observation':profile.parent||'DomainResource',baseDefinition:`http://hl7.org/fhir/StructureDefinition/${profile.parent||'DomainResource'}`,derivation:'constraint',description:profile.description||`Profile for ${profile.name}`};if(profile.rules.length>0){structureDefinition.differential={element:profile.rules.map((rule,index)=>({id:`${structureDefinition.type}.${rule.split(' ')[0]}`,path:`${structureDefinition.type}.${rule.split(' ')[0]}`,short:`Rule: ${rule}`}))};}resources.push({path:`StructureDefinition-${profileId}.json`,content:JSON.stringify(structureDefinition,null,2),resourceType:'StructureDefinition'});});// Generate instances\ndefinitions.instances.forEach(instance=>{const instanceId=instance.name.toLowerCase().replace(/\\s+/g,'-');const resourceType=instance.instanceOf==='Patient'?'Patient':instance.instanceOf==='Observation'?'Observation':'Patient';// Default fallback\nconst fhirInstance={resourceType:resourceType,id:instanceId,meta:{profile:instance.instanceOf?[`${config.canonical}/StructureDefinition/${instance.instanceOf}`]:undefined}};// Add basic properties based on resource type\nif(resourceType==='Patient'){fhirInstance.name=[{family:instance.name.split(' ').pop(),given:instance.name.split(' ').slice(0,-1)}];}resources.push({path:`${instanceId}.json`,content:JSON.stringify(fhirInstance,null,2),resourceType:resourceType});});// Generate ValueSets\ndefinitions.valueSets.forEach(vs=>{const vsId=vs.id||vs.name.toLowerCase().replace(/\\s+/g,'-');const valueSet={resourceType:'ValueSet',id:vsId,url:`${config.canonical}/ValueSet/${vsId}`,name:vs.name,title:vs.title||vs.name,status:'draft',description:vs.description||`ValueSet for ${vs.name}`,compose:{include:[{system:'http://example.org/codes',concept:[{code:'example1',display:'Example Code 1'},{code:'example2',display:'Example Code 2'}]}]}};resources.push({path:`ValueSet-${vsId}.json`,content:JSON.stringify(valueSet,null,2),resourceType:'ValueSet'});});// Generate CodeSystems\ndefinitions.codeSystems.forEach(cs=>{const csId=cs.id||cs.name.toLowerCase().replace(/\\s+/g,'-');const codeSystem={resourceType:'CodeSystem',id:csId,url:`${config.canonical}/CodeSystem/${csId}`,name:cs.name,title:cs.title||cs.name,status:'draft',content:'complete',description:cs.description||`CodeSystem for ${cs.name}`,concept:[{code:'concept1',display:'Concept 1'},{code:'concept2',display:'Concept 2'}]};resources.push({path:`CodeSystem-${csId}.json`,content:JSON.stringify(codeSystem,null,2),resourceType:'CodeSystem'});});return resources;}async runSushi(config,fshFiles){if(!this.isInitialized){await this.initialize();}// Clear previous files\nthis.fs.clear();// Write configuration\nif(config){const configYaml=typeof config==='string'?config:(await import('js-yaml')).default.dump(config);this.fs.writeFile('sushi-config.yaml',configYaml);}// Write FSH files\nfshFiles.forEach(file=>{const filePath=file.path||`input/fsh/${file.name}`;this.fs.writeFile(filePath,file.content);});// Execute SUSHI via WASM interface\nconst result=this.wasmModule.ccall('runSushi',// Function name\n'string',// Return type\n['string'],// Parameter types\n['/workspace']// Parameters\n);return JSON.parse(result);}}// Singleton instance\nconst sushiWasmService=new SushiWASMRunner();export default sushiWasmService;","map":{"version":3,"names":["VirtualFileSystem","constructor","files","Map","directories","Set","writeFile","path","content","normalizedPath","startsWith","substring","pathParts","split","i","length","dirPath","slice","join","add","encoder","TextEncoder","set","encode","readFile","data","get","decoder","TextDecoder","decode","exists","has","listDirectory","prefix","items","filePath","keys","relativePath","includes","push","name","type","clear","SushiWASMRunner","wasmModule","fs","isInitialized","initializationPromise","initialize","_loadWasmModule","sushiModule","_importSushiLibrary","error","console","Error","message","log","ccall","_createFallbackCCall","bind","FS","functionName","returnType","paramTypes","params","_runFallbackCompilation","workspacePath","outputFiles","errors","warnings","fshFiles","_getAllFshFiles","configContent","config","version","fhirVersion","canonical","yaml","default","load","err","definitions","_extractFSHDefinitions","resources","_generateFHIRResources","JSON","stringify","success","_this","collectFiles","arguments","undefined","item","endsWith","profiles","instances","valueSets","codeSystems","extensions","lines","currentDefinition","currentType","line","trim","parent","id","title","description","rules","instanceOf","usage","replace","forEach","profile","profileId","toLowerCase","structureDefinition","resourceType","url","status","kind","abstract","baseDefinition","derivation","differential","element","map","rule","index","short","instance","instanceId","fhirInstance","meta","family","pop","given","vs","vsId","valueSet","compose","include","system","concept","code","display","cs","csId","codeSystem","runSushi","configYaml","dump","file","result","parse","sushiWasmService"],"sources":["/home/runner/work/sgex/sgex/src/services/sushiWasmService.js"],"sourcesContent":["/**\n * SUSHI WebAssembly Service\n * \n * This service manages the loading and execution of SUSHI via WebAssembly.\n * It provides a bridge between the React application and the WASM module.\n */\n\nclass VirtualFileSystem {\n  constructor() {\n    this.files = new Map();\n    this.directories = new Set();\n  }\n\n  writeFile(path, content) {\n    // Normalize path\n    const normalizedPath = path.startsWith('/') ? path.substring(1) : path;\n    \n    // Ensure parent directories exist\n    const pathParts = normalizedPath.split('/');\n    for (let i = 0; i < pathParts.length - 1; i++) {\n      const dirPath = pathParts.slice(0, i + 1).join('/');\n      this.directories.add(dirPath);\n    }\n    \n    // Store file content as Uint8Array for WASM compatibility\n    const encoder = new TextEncoder();\n    this.files.set(normalizedPath, encoder.encode(content));\n    \n    return true;\n  }\n\n  readFile(path) {\n    const normalizedPath = path.startsWith('/') ? path.substring(1) : path;\n    const data = this.files.get(normalizedPath);\n    \n    if (!data) {\n      return null;\n    }\n    \n    // Convert back to string for JavaScript consumption\n    const decoder = new TextDecoder();\n    return decoder.decode(data);\n  }\n\n  exists(path) {\n    const normalizedPath = path.startsWith('/') ? path.substring(1) : path;\n    return this.files.has(normalizedPath) || this.directories.has(normalizedPath);\n  }\n\n  listDirectory(path) {\n    const normalizedPath = path.startsWith('/') ? path.substring(1) : path;\n    const prefix = normalizedPath ? `${normalizedPath}/` : '';\n    \n    const items = [];\n    \n    // Add files\n    for (const filePath of this.files.keys()) {\n      if (filePath.startsWith(prefix)) {\n        const relativePath = filePath.substring(prefix.length);\n        if (!relativePath.includes('/')) { // Direct child only\n          items.push({\n            name: relativePath,\n            type: 'file',\n            path: filePath\n          });\n        }\n      }\n    }\n    \n    // Add directories\n    for (const dirPath of this.directories) {\n      if (dirPath.startsWith(prefix)) {\n        const relativePath = dirPath.substring(prefix.length);\n        if (!relativePath.includes('/')) { // Direct child only\n          items.push({\n            name: relativePath,\n            type: 'directory',\n            path: dirPath\n          });\n        }\n      }\n    }\n    \n    return items;\n  }\n\n  clear() {\n    this.files.clear();\n    this.directories.clear();\n  }\n}\n\nclass SushiWASMRunner {\n  constructor() {\n    this.wasmModule = null;\n    this.fs = new VirtualFileSystem();\n    this.isInitialized = false;\n    this.initializationPromise = null;\n  }\n\n  async initialize() {\n    if (this.isInitialized) {\n      return this.wasmModule;\n    }\n    \n    if (this.initializationPromise) {\n      return this.initializationPromise;\n    }\n    \n    this.initializationPromise = this._loadWasmModule();\n    return this.initializationPromise;\n  }\n\n  async _loadWasmModule() {\n    try {\n      // For now, we'll create a fallback implementation that uses the existing fsh-sushi\n      // dependency but in a browser-compatible way. This is a stepping stone to full WASM.\n      \n      // Import the SUSHI library dynamically to avoid build issues\n      const sushiModule = await this._importSushiLibrary();\n      \n      this.wasmModule = sushiModule;\n      this.isInitialized = true;\n      \n      return this.wasmModule;\n    } catch (error) {\n      console.error('Failed to load SUSHI WASM module:', error);\n      throw new Error(`SUSHI WASM initialization failed: ${error.message}`);\n    }\n  }\n\n  async _importSushiLibrary() {\n    // This is a bridge implementation that provides a WASM-like interface\n    // for future migration. For now, we avoid direct fsh-sushi imports\n    // due to Node.js dependency conflicts in browser environment.\n    \n    console.log('Creating fallback SUSHI implementation for browser environment');\n    \n    // Return a mock implementation with WASM-style interface\n    return {\n      ccall: this._createFallbackCCall.bind(this),\n      FS: {\n        writeFile: this.fs.writeFile.bind(this.fs),\n        readFile: this.fs.readFile.bind(this.fs),\n        exists: this.fs.exists.bind(this.fs)\n      }\n    };\n  }\n\n  _createFallbackCCall() {\n    return (functionName, returnType, paramTypes, params) => {\n      if (functionName === 'runSushi') {\n        return this._runFallbackCompilation(params[0]);\n      }\n      throw new Error(`Unsupported WASM function: ${functionName}`);\n    };\n  }\n\n  async _runFallbackCompilation(workspacePath) {\n    // Fallback implementation using the existing custom FSH parser\n    // This maintains the current functionality while providing WASM interface\n    \n    const outputFiles = [];\n    const errors = [];\n    const warnings = [];\n\n    try {\n      const fshFiles = this._getAllFshFiles();\n      const configContent = this.fs.readFile('sushi-config.yaml');\n      \n      let config = {\n        name: 'browser-generated-ig',\n        version: '1.0.0',\n        fhirVersion: '4.0.1',\n        canonical: 'http://example.org/fhir/ig/browser-generated'\n      };\n\n      if (configContent) {\n        try {\n          const yaml = await import('js-yaml');\n          config = yaml.default.load(configContent);\n        } catch (err) {\n          warnings.push(`Failed to parse sushi-config.yaml: ${err.message}`);\n        }\n      } else {\n        warnings.push('No sushi-config.yaml found, using default configuration');\n      }\n\n      // Use the existing FSH parsing logic from SushiRunner\n      for (const { content } of fshFiles) {\n        const definitions = this._extractFSHDefinitions(content);\n        \n        // Generate FHIR resources using the same logic as the current implementation\n        const resources = this._generateFHIRResources(definitions, config);\n        outputFiles.push(...resources);\n      }\n\n      return JSON.stringify({\n        success: true,\n        files: outputFiles,\n        errors: errors,\n        warnings: warnings\n      });\n\n    } catch (error) {\n      return JSON.stringify({\n        success: false,\n        files: [],\n        errors: [error.message],\n        warnings: warnings\n      });\n    }\n  }\n\n  _getAllFshFiles() {\n    const fshFiles = [];\n    \n    // Recursively collect all .fsh files\n    const collectFiles = (path = '') => {\n      const items = this.fs.listDirectory(path);\n      \n      for (const item of items) {\n        if (item.type === 'file' && item.name.endsWith('.fsh')) {\n          const content = this.fs.readFile(item.path);\n          if (content) {\n            fshFiles.push({\n              path: item.path,\n              content: content\n            });\n          }\n        } else if (item.type === 'directory') {\n          collectFiles(item.path);\n        }\n      }\n    };\n\n    collectFiles('input/fsh');\n    return fshFiles;\n  }\n\n  _extractFSHDefinitions(content) {\n    // Reuse the existing FSH parsing logic from SushiRunner\n    const definitions = {\n      profiles: [],\n      instances: [],\n      valueSets: [],\n      codeSystems: [],\n      extensions: []\n    };\n    \n    const lines = content.split('\\n');\n    let currentDefinition = null;\n    let currentType = null;\n    \n    for (let i = 0; i < lines.length; i++) {\n      const line = lines[i].trim();\n      \n      // Detect definition types\n      if (line.startsWith('Profile:')) {\n        currentType = 'profiles';\n        currentDefinition = {\n          name: line.substring(8).trim(),\n          type: 'Profile',\n          parent: null,\n          id: null,\n          title: null,\n          description: null,\n          rules: []\n        };\n      } else if (line.startsWith('Instance:')) {\n        currentType = 'instances';\n        currentDefinition = {\n          name: line.substring(9).trim(),\n          type: 'Instance',\n          instanceOf: null,\n          usage: null,\n          title: null,\n          description: null,\n          rules: []\n        };\n      } else if (line.startsWith('ValueSet:')) {\n        currentType = 'valueSets';\n        currentDefinition = {\n          name: line.substring(9).trim(),\n          type: 'ValueSet',\n          id: null,\n          title: null,\n          description: null,\n          rules: []\n        };\n      } else if (line.startsWith('CodeSystem:')) {\n        currentType = 'codeSystems';\n        currentDefinition = {\n          name: line.substring(11).trim(),\n          type: 'CodeSystem',\n          id: null,\n          title: null,\n          description: null,\n          rules: []\n        };\n      } else if (line.startsWith('Extension:')) {\n        currentType = 'extensions';\n        currentDefinition = {\n          name: line.substring(10).trim(),\n          type: 'Extension',\n          id: null,\n          title: null,\n          description: null,\n          rules: []\n        };\n      }\n      \n      // Parse properties\n      if (currentDefinition) {\n        if (line.startsWith('Parent:')) {\n          currentDefinition.parent = line.substring(7).trim();\n        } else if (line.startsWith('InstanceOf:')) {\n          currentDefinition.instanceOf = line.substring(11).trim();\n        } else if (line.startsWith('Usage:')) {\n          currentDefinition.usage = line.substring(6).trim();\n        } else if (line.startsWith('Id:')) {\n          currentDefinition.id = line.substring(3).trim();\n        } else if (line.startsWith('Title:')) {\n          currentDefinition.title = line.substring(6).trim().replace(/['\"]/g, '');\n        } else if (line.startsWith('Description:')) {\n          currentDefinition.description = line.substring(12).trim().replace(/['\"]/g, '');\n        } else if (line.startsWith('* ')) {\n          currentDefinition.rules.push(line.substring(2).trim());\n        }\n        \n        // If we hit a new definition or end of content, save current one\n        if ((line.includes(':') && !line.startsWith('* ') && \n             !line.startsWith('Parent:') && !line.startsWith('InstanceOf:') &&\n             !line.startsWith('Usage:') && !line.startsWith('Id:') &&\n             !line.startsWith('Title:') && !line.startsWith('Description:')) ||\n            i === lines.length - 1) {\n          \n          if (currentDefinition && currentType && currentDefinition.name) {\n            definitions[currentType].push(currentDefinition);\n          }\n          currentDefinition = null;\n          currentType = null;\n          i--; // Re-process this line for the new definition\n        }\n      }\n    }\n    \n    return definitions;\n  }\n\n  _generateFHIRResources(definitions, config) {\n    const resources = [];\n\n    // Generate StructureDefinitions from profiles\n    definitions.profiles.forEach(profile => {\n      const profileId = profile.id || profile.name.toLowerCase().replace(/\\s+/g, '-');\n      const structureDefinition = {\n        resourceType: 'StructureDefinition',\n        id: profileId,\n        url: `${config.canonical}/StructureDefinition/${profileId}`,\n        name: profile.name,\n        title: profile.title || profile.name,\n        status: 'draft',\n        fhirVersion: config.fhirVersion || '4.0.1',\n        kind: 'resource',\n        abstract: false,\n        type: profile.parent === 'Patient' ? 'Patient' : \n               profile.parent === 'Observation' ? 'Observation' :\n               profile.parent || 'DomainResource',\n        baseDefinition: `http://hl7.org/fhir/StructureDefinition/${profile.parent || 'DomainResource'}`,\n        derivation: 'constraint',\n        description: profile.description || `Profile for ${profile.name}`\n      };\n      \n      if (profile.rules.length > 0) {\n        structureDefinition.differential = {\n          element: profile.rules.map((rule, index) => ({\n            id: `${structureDefinition.type}.${rule.split(' ')[0]}`,\n            path: `${structureDefinition.type}.${rule.split(' ')[0]}`,\n            short: `Rule: ${rule}`\n          }))\n        };\n      }\n      \n      resources.push({\n        path: `StructureDefinition-${profileId}.json`,\n        content: JSON.stringify(structureDefinition, null, 2),\n        resourceType: 'StructureDefinition'\n      });\n    });\n\n    // Generate instances\n    definitions.instances.forEach(instance => {\n      const instanceId = instance.name.toLowerCase().replace(/\\s+/g, '-');\n      const resourceType = instance.instanceOf === 'Patient' ? 'Patient' :\n                         instance.instanceOf === 'Observation' ? 'Observation' :\n                         'Patient'; // Default fallback\n                         \n      const fhirInstance = {\n        resourceType: resourceType,\n        id: instanceId,\n        meta: {\n          profile: instance.instanceOf ? [`${config.canonical}/StructureDefinition/${instance.instanceOf}`] : undefined\n        }\n      };\n      \n      // Add basic properties based on resource type\n      if (resourceType === 'Patient') {\n        fhirInstance.name = [{\n          family: instance.name.split(' ').pop(),\n          given: instance.name.split(' ').slice(0, -1)\n        }];\n      }\n      \n      resources.push({\n        path: `${instanceId}.json`,\n        content: JSON.stringify(fhirInstance, null, 2),\n        resourceType: resourceType\n      });\n    });\n\n    // Generate ValueSets\n    definitions.valueSets.forEach(vs => {\n      const vsId = vs.id || vs.name.toLowerCase().replace(/\\s+/g, '-');\n      const valueSet = {\n        resourceType: 'ValueSet',\n        id: vsId,\n        url: `${config.canonical}/ValueSet/${vsId}`,\n        name: vs.name,\n        title: vs.title || vs.name,\n        status: 'draft',\n        description: vs.description || `ValueSet for ${vs.name}`,\n        compose: {\n          include: [{\n            system: 'http://example.org/codes',\n            concept: [\n              { code: 'example1', display: 'Example Code 1' },\n              { code: 'example2', display: 'Example Code 2' }\n            ]\n          }]\n        }\n      };\n      \n      resources.push({\n        path: `ValueSet-${vsId}.json`,\n        content: JSON.stringify(valueSet, null, 2),\n        resourceType: 'ValueSet'\n      });\n    });\n\n    // Generate CodeSystems\n    definitions.codeSystems.forEach(cs => {\n      const csId = cs.id || cs.name.toLowerCase().replace(/\\s+/g, '-');\n      const codeSystem = {\n        resourceType: 'CodeSystem',\n        id: csId,\n        url: `${config.canonical}/CodeSystem/${csId}`,\n        name: cs.name,\n        title: cs.title || cs.name,\n        status: 'draft',\n        content: 'complete',\n        description: cs.description || `CodeSystem for ${cs.name}`,\n        concept: [\n          { code: 'concept1', display: 'Concept 1' },\n          { code: 'concept2', display: 'Concept 2' }\n        ]\n      };\n      \n      resources.push({\n        path: `CodeSystem-${csId}.json`,\n        content: JSON.stringify(codeSystem, null, 2),\n        resourceType: 'CodeSystem'\n      });\n    });\n\n    return resources;\n  }\n\n  async runSushi(config, fshFiles) {\n    if (!this.isInitialized) {\n      await this.initialize();\n    }\n\n    // Clear previous files\n    this.fs.clear();\n\n    // Write configuration\n    if (config) {\n      const configYaml = typeof config === 'string' ? config : \n        (await import('js-yaml')).default.dump(config);\n      this.fs.writeFile('sushi-config.yaml', configYaml);\n    }\n\n    // Write FSH files\n    fshFiles.forEach(file => {\n      const filePath = file.path || `input/fsh/${file.name}`;\n      this.fs.writeFile(filePath, file.content);\n    });\n\n    // Execute SUSHI via WASM interface\n    const result = this.wasmModule.ccall(\n      'runSushi',           // Function name\n      'string',             // Return type\n      ['string'],           // Parameter types\n      ['/workspace']        // Parameters\n    );\n\n    return JSON.parse(result);\n  }\n}\n\n// Singleton instance\nconst sushiWasmService = new SushiWASMRunner();\n\nexport default sushiWasmService;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}