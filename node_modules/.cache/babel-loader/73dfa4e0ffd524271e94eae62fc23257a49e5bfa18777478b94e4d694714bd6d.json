{"ast":null,"code":"import inherits from 'inherits-browser';\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\nimport { is } from '../../../util/ModelUtil';\nimport { isExpanded } from '../../../util/DiUtil';\nimport { selfAndAllChildren } from 'diagram-js/lib/util/Elements';\nimport { getResizedSourceAnchor, getResizedTargetAnchor } from 'diagram-js/lib/features/modeling/cmd/helper/AnchorsHelper';\n\n/**\r\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\r\n * @typedef {import('../Modeling').default} Modeling\r\n */\n\n/**\r\n * BPMN-specific message flow behavior.\r\n *\r\n * @param {EventBus} eventBus\r\n * @param {Modeling} modeling\r\n */\nexport default function MessageFlowBehavior(eventBus, modeling) {\n  CommandInterceptor.call(this, eventBus);\n  this.postExecute('shape.replace', function (context) {\n    var oldShape = context.oldShape,\n      newShape = context.newShape;\n    if (!isParticipantCollapse(oldShape, newShape)) {\n      return;\n    }\n    var messageFlows = getMessageFlows(oldShape);\n    messageFlows.incoming.forEach(function (incoming) {\n      var anchor = getResizedTargetAnchor(incoming, newShape, oldShape);\n      modeling.reconnectEnd(incoming, newShape, anchor);\n    });\n    messageFlows.outgoing.forEach(function (outgoing) {\n      var anchor = getResizedSourceAnchor(outgoing, newShape, oldShape);\n      modeling.reconnectStart(outgoing, newShape, anchor);\n    });\n  }, true);\n}\nMessageFlowBehavior.$inject = ['eventBus', 'modeling'];\ninherits(MessageFlowBehavior, CommandInterceptor);\n\n// helpers //////////\n\nfunction isParticipantCollapse(oldShape, newShape) {\n  return is(oldShape, 'bpmn:Participant') && isExpanded(oldShape) && is(newShape, 'bpmn:Participant') && !isExpanded(newShape);\n}\nfunction getMessageFlows(parent) {\n  var elements = selfAndAllChildren([parent], false);\n  var incoming = [],\n    outgoing = [];\n  elements.forEach(function (element) {\n    if (element === parent) {\n      return;\n    }\n    element.incoming.forEach(function (connection) {\n      if (is(connection, 'bpmn:MessageFlow')) {\n        incoming.push(connection);\n      }\n    });\n    element.outgoing.forEach(function (connection) {\n      if (is(connection, 'bpmn:MessageFlow')) {\n        outgoing.push(connection);\n      }\n    });\n  }, []);\n  return {\n    incoming: incoming,\n    outgoing: outgoing\n  };\n}","map":{"version":3,"names":["inherits","CommandInterceptor","is","isExpanded","selfAndAllChildren","getResizedSourceAnchor","getResizedTargetAnchor","MessageFlowBehavior","eventBus","modeling","call","postExecute","context","oldShape","newShape","isParticipantCollapse","messageFlows","getMessageFlows","incoming","forEach","anchor","reconnectEnd","outgoing","reconnectStart","$inject","parent","elements","element","connection","push"],"sources":["/home/runner/work/sgex/sgex/node_modules/bpmn-js/lib/features/modeling/behavior/MessageFlowBehavior.js"],"sourcesContent":["import inherits from 'inherits-browser';\r\n\r\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\r\n\r\nimport { is } from '../../../util/ModelUtil';\r\n\r\nimport { isExpanded } from '../../../util/DiUtil';\r\n\r\nimport { selfAndAllChildren } from 'diagram-js/lib/util/Elements';\r\n\r\nimport {\r\n  getResizedSourceAnchor,\r\n  getResizedTargetAnchor\r\n} from 'diagram-js/lib/features/modeling/cmd/helper/AnchorsHelper';\r\n\r\n/**\r\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\r\n * @typedef {import('../Modeling').default} Modeling\r\n */\r\n\r\n/**\r\n * BPMN-specific message flow behavior.\r\n *\r\n * @param {EventBus} eventBus\r\n * @param {Modeling} modeling\r\n */\r\nexport default function MessageFlowBehavior(eventBus, modeling) {\r\n\r\n  CommandInterceptor.call(this, eventBus);\r\n\r\n  this.postExecute('shape.replace', function(context) {\r\n    var oldShape = context.oldShape,\r\n        newShape = context.newShape;\r\n\r\n    if (!isParticipantCollapse(oldShape, newShape)) {\r\n      return;\r\n    }\r\n\r\n    var messageFlows = getMessageFlows(oldShape);\r\n\r\n    messageFlows.incoming.forEach(function(incoming) {\r\n      var anchor = getResizedTargetAnchor(incoming, newShape, oldShape);\r\n\r\n      modeling.reconnectEnd(incoming, newShape, anchor);\r\n    });\r\n\r\n    messageFlows.outgoing.forEach(function(outgoing) {\r\n      var anchor = getResizedSourceAnchor(outgoing, newShape, oldShape);\r\n\r\n      modeling.reconnectStart(outgoing, newShape, anchor);\r\n    });\r\n  }, true);\r\n\r\n}\r\n\r\nMessageFlowBehavior.$inject = [ 'eventBus', 'modeling' ];\r\n\r\ninherits(MessageFlowBehavior, CommandInterceptor);\r\n\r\n// helpers //////////\r\n\r\nfunction isParticipantCollapse(oldShape, newShape) {\r\n  return is(oldShape, 'bpmn:Participant')\r\n    && isExpanded(oldShape)\r\n    && is(newShape, 'bpmn:Participant')\r\n    && !isExpanded(newShape);\r\n}\r\n\r\nfunction getMessageFlows(parent) {\r\n  var elements = selfAndAllChildren([ parent ], false);\r\n\r\n  var incoming = [],\r\n      outgoing = [];\r\n\r\n  elements.forEach(function(element) {\r\n    if (element === parent) {\r\n      return;\r\n    }\r\n\r\n    element.incoming.forEach(function(connection) {\r\n      if (is(connection, 'bpmn:MessageFlow')) {\r\n        incoming.push(connection);\r\n      }\r\n    });\r\n\r\n    element.outgoing.forEach(function(connection) {\r\n      if (is(connection, 'bpmn:MessageFlow')) {\r\n        outgoing.push(connection);\r\n      }\r\n    });\r\n  }, []);\r\n\r\n  return {\r\n    incoming: incoming,\r\n    outgoing: outgoing\r\n  };\r\n}"],"mappings":"AAAA,OAAOA,QAAQ,MAAM,kBAAkB;AAEvC,OAAOC,kBAAkB,MAAM,2CAA2C;AAE1E,SAASC,EAAE,QAAQ,yBAAyB;AAE5C,SAASC,UAAU,QAAQ,sBAAsB;AAEjD,SAASC,kBAAkB,QAAQ,8BAA8B;AAEjE,SACEC,sBAAsB,EACtBC,sBAAsB,QACjB,2DAA2D;;AAElE;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,SAASC,mBAAmBA,CAACC,QAAQ,EAAEC,QAAQ,EAAE;EAE9DR,kBAAkB,CAACS,IAAI,CAAC,IAAI,EAAEF,QAAQ,CAAC;EAEvC,IAAI,CAACG,WAAW,CAAC,eAAe,EAAE,UAASC,OAAO,EAAE;IAClD,IAAIC,QAAQ,GAAGD,OAAO,CAACC,QAAQ;MAC3BC,QAAQ,GAAGF,OAAO,CAACE,QAAQ;IAE/B,IAAI,CAACC,qBAAqB,CAACF,QAAQ,EAAEC,QAAQ,CAAC,EAAE;MAC9C;IACF;IAEA,IAAIE,YAAY,GAAGC,eAAe,CAACJ,QAAQ,CAAC;IAE5CG,YAAY,CAACE,QAAQ,CAACC,OAAO,CAAC,UAASD,QAAQ,EAAE;MAC/C,IAAIE,MAAM,GAAGd,sBAAsB,CAACY,QAAQ,EAAEJ,QAAQ,EAAED,QAAQ,CAAC;MAEjEJ,QAAQ,CAACY,YAAY,CAACH,QAAQ,EAAEJ,QAAQ,EAAEM,MAAM,CAAC;IACnD,CAAC,CAAC;IAEFJ,YAAY,CAACM,QAAQ,CAACH,OAAO,CAAC,UAASG,QAAQ,EAAE;MAC/C,IAAIF,MAAM,GAAGf,sBAAsB,CAACiB,QAAQ,EAAER,QAAQ,EAAED,QAAQ,CAAC;MAEjEJ,QAAQ,CAACc,cAAc,CAACD,QAAQ,EAAER,QAAQ,EAAEM,MAAM,CAAC;IACrD,CAAC,CAAC;EACJ,CAAC,EAAE,IAAI,CAAC;AAEV;AAEAb,mBAAmB,CAACiB,OAAO,GAAG,CAAE,UAAU,EAAE,UAAU,CAAE;AAExDxB,QAAQ,CAACO,mBAAmB,EAAEN,kBAAkB,CAAC;;AAEjD;;AAEA,SAASc,qBAAqBA,CAACF,QAAQ,EAAEC,QAAQ,EAAE;EACjD,OAAOZ,EAAE,CAACW,QAAQ,EAAE,kBAAkB,CAAC,IAClCV,UAAU,CAACU,QAAQ,CAAC,IACpBX,EAAE,CAACY,QAAQ,EAAE,kBAAkB,CAAC,IAChC,CAACX,UAAU,CAACW,QAAQ,CAAC;AAC5B;AAEA,SAASG,eAAeA,CAACQ,MAAM,EAAE;EAC/B,IAAIC,QAAQ,GAAGtB,kBAAkB,CAAC,CAAEqB,MAAM,CAAE,EAAE,KAAK,CAAC;EAEpD,IAAIP,QAAQ,GAAG,EAAE;IACbI,QAAQ,GAAG,EAAE;EAEjBI,QAAQ,CAACP,OAAO,CAAC,UAASQ,OAAO,EAAE;IACjC,IAAIA,OAAO,KAAKF,MAAM,EAAE;MACtB;IACF;IAEAE,OAAO,CAACT,QAAQ,CAACC,OAAO,CAAC,UAASS,UAAU,EAAE;MAC5C,IAAI1B,EAAE,CAAC0B,UAAU,EAAE,kBAAkB,CAAC,EAAE;QACtCV,QAAQ,CAACW,IAAI,CAACD,UAAU,CAAC;MAC3B;IACF,CAAC,CAAC;IAEFD,OAAO,CAACL,QAAQ,CAACH,OAAO,CAAC,UAASS,UAAU,EAAE;MAC5C,IAAI1B,EAAE,CAAC0B,UAAU,EAAE,kBAAkB,CAAC,EAAE;QACtCN,QAAQ,CAACO,IAAI,CAACD,UAAU,CAAC;MAC3B;IACF,CAAC,CAAC;EACJ,CAAC,EAAE,EAAE,CAAC;EAEN,OAAO;IACLV,QAAQ,EAAEA,QAAQ;IAClBI,QAAQ,EAAEA;EACZ,CAAC;AACH","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}