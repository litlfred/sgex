{"ast":null,"code":"import { is } from '../../../util/ModelUtil';\nimport { getLanesRoot, computeLanesResize } from '../util/LaneUtil';\nimport { eachElement } from 'diagram-js/lib/util/Elements';\nimport { asTRBL } from 'diagram-js/lib/layout/LayoutUtil';\nimport { substractTRBL } from 'diagram-js/lib/features/resize/ResizeUtil';\n\n/**\n * @typedef {import('diagram-js/lib/command/CommandHandler').default} CommandHandler\n *\n * @typedef {import('../Modeling').default} Modeling\n * @typedef {import('../../space-tool/BpmnSpaceTool').default} SpaceTool\n *\n * @typedef {import('../../../model/Types').Shape} Shape\n *\n * @typedef {import('diagram-js/lib/util/Types').Rect} Rect\n */\n\n/**\n * A handler that resizes a lane.\n *\n * @implements {CommandHandler}\n *\n * @param {Modeling} modeling\n * @param {SpaceTool} spaceTool\n */\nexport default function ResizeLaneHandler(modeling, spaceTool) {\n  this._modeling = modeling;\n  this._spaceTool = spaceTool;\n}\nResizeLaneHandler.$inject = ['modeling', 'spaceTool'];\nResizeLaneHandler.prototype.preExecute = function (context) {\n  var shape = context.shape,\n    newBounds = context.newBounds,\n    balanced = context.balanced;\n  if (balanced !== false) {\n    this.resizeBalanced(shape, newBounds);\n  } else {\n    this.resizeSpace(shape, newBounds);\n  }\n};\n\n/**\n * Resize balanced, adjusting next / previous lane sizes.\n *\n * @param {Shape} shape\n * @param {Rect} newBounds\n */\nResizeLaneHandler.prototype.resizeBalanced = function (shape, newBounds) {\n  var modeling = this._modeling;\n  var resizeNeeded = computeLanesResize(shape, newBounds);\n\n  // resize the lane\n  modeling.resizeShape(shape, newBounds);\n\n  // resize other lanes as needed\n  resizeNeeded.forEach(function (r) {\n    modeling.resizeShape(r.shape, r.newBounds);\n  });\n};\n\n/**\n * Resize, making actual space and moving below / above elements.\n *\n * @param {Shape} shape\n * @param {Rect} newBounds\n */\nResizeLaneHandler.prototype.resizeSpace = function (shape, newBounds) {\n  var spaceTool = this._spaceTool;\n  var shapeTrbl = asTRBL(shape),\n    newTrbl = asTRBL(newBounds);\n  var trblDiff = substractTRBL(newTrbl, shapeTrbl);\n  var lanesRoot = getLanesRoot(shape);\n  var allAffected = [],\n    allLanes = [];\n  eachElement(lanesRoot, function (element) {\n    allAffected.push(element);\n    if (is(element, 'bpmn:Lane') || is(element, 'bpmn:Participant')) {\n      allLanes.push(element);\n    }\n    return element.children;\n  });\n  var change, spacePos, direction, offset, adjustments;\n  if (trblDiff.bottom || trblDiff.top) {\n    change = trblDiff.bottom || trblDiff.top;\n    spacePos = shape.y + (trblDiff.bottom ? shape.height : 0) + (trblDiff.bottom ? -10 : 10);\n    direction = trblDiff.bottom ? 's' : 'n';\n    offset = trblDiff.top > 0 || trblDiff.bottom < 0 ? -change : change;\n    adjustments = spaceTool.calculateAdjustments(allAffected, 'y', offset, spacePos);\n    spaceTool.makeSpace(adjustments.movingShapes, adjustments.resizingShapes, {\n      x: 0,\n      y: change\n    }, direction);\n  }\n  if (trblDiff.left || trblDiff.right) {\n    change = trblDiff.right || trblDiff.left;\n    spacePos = shape.x + (trblDiff.right ? shape.width : 0) + (trblDiff.right ? -10 : 100);\n    direction = trblDiff.right ? 'e' : 'w';\n    offset = trblDiff.left > 0 || trblDiff.right < 0 ? -change : change;\n    adjustments = spaceTool.calculateAdjustments(allLanes, 'x', offset, spacePos);\n    spaceTool.makeSpace(adjustments.movingShapes, adjustments.resizingShapes, {\n      x: change,\n      y: 0\n    }, direction);\n  }\n};","map":{"version":3,"names":["is","getLanesRoot","computeLanesResize","eachElement","asTRBL","substractTRBL","ResizeLaneHandler","modeling","spaceTool","_modeling","_spaceTool","$inject","prototype","preExecute","context","shape","newBounds","balanced","resizeBalanced","resizeSpace","resizeNeeded","resizeShape","forEach","r","shapeTrbl","newTrbl","trblDiff","lanesRoot","allAffected","allLanes","element","push","children","change","spacePos","direction","offset","adjustments","bottom","top","y","height","calculateAdjustments","makeSpace","movingShapes","resizingShapes","x","left","right","width"],"sources":["/home/runner/work/sgex/sgex/node_modules/bpmn-js/lib/features/modeling/cmd/ResizeLaneHandler.js"],"sourcesContent":["import { is } from '../../../util/ModelUtil';\n\nimport {\n  getLanesRoot,\n  computeLanesResize\n} from '../util/LaneUtil';\n\nimport {\n  eachElement\n} from 'diagram-js/lib/util/Elements';\n\nimport {\n  asTRBL\n} from 'diagram-js/lib/layout/LayoutUtil';\n\nimport {\n  substractTRBL\n} from 'diagram-js/lib/features/resize/ResizeUtil';\n\n/**\n * @typedef {import('diagram-js/lib/command/CommandHandler').default} CommandHandler\n *\n * @typedef {import('../Modeling').default} Modeling\n * @typedef {import('../../space-tool/BpmnSpaceTool').default} SpaceTool\n *\n * @typedef {import('../../../model/Types').Shape} Shape\n *\n * @typedef {import('diagram-js/lib/util/Types').Rect} Rect\n */\n\n/**\n * A handler that resizes a lane.\n *\n * @implements {CommandHandler}\n *\n * @param {Modeling} modeling\n * @param {SpaceTool} spaceTool\n */\nexport default function ResizeLaneHandler(modeling, spaceTool) {\n  this._modeling = modeling;\n  this._spaceTool = spaceTool;\n}\n\nResizeLaneHandler.$inject = [\n  'modeling',\n  'spaceTool'\n];\n\n\nResizeLaneHandler.prototype.preExecute = function(context) {\n\n  var shape = context.shape,\n      newBounds = context.newBounds,\n      balanced = context.balanced;\n\n  if (balanced !== false) {\n    this.resizeBalanced(shape, newBounds);\n  } else {\n    this.resizeSpace(shape, newBounds);\n  }\n};\n\n\n/**\n * Resize balanced, adjusting next / previous lane sizes.\n *\n * @param {Shape} shape\n * @param {Rect} newBounds\n */\nResizeLaneHandler.prototype.resizeBalanced = function(shape, newBounds) {\n\n  var modeling = this._modeling;\n\n  var resizeNeeded = computeLanesResize(shape, newBounds);\n\n  // resize the lane\n  modeling.resizeShape(shape, newBounds);\n\n  // resize other lanes as needed\n  resizeNeeded.forEach(function(r) {\n    modeling.resizeShape(r.shape, r.newBounds);\n  });\n};\n\n\n/**\n * Resize, making actual space and moving below / above elements.\n *\n * @param {Shape} shape\n * @param {Rect} newBounds\n */\nResizeLaneHandler.prototype.resizeSpace = function(shape, newBounds) {\n  var spaceTool = this._spaceTool;\n\n  var shapeTrbl = asTRBL(shape),\n      newTrbl = asTRBL(newBounds);\n\n  var trblDiff = substractTRBL(newTrbl, shapeTrbl);\n\n  var lanesRoot = getLanesRoot(shape);\n\n  var allAffected = [],\n      allLanes = [];\n\n  eachElement(lanesRoot, function(element) {\n    allAffected.push(element);\n\n    if (is(element, 'bpmn:Lane') || is(element, 'bpmn:Participant')) {\n      allLanes.push(element);\n    }\n\n    return element.children;\n  });\n\n  var change,\n      spacePos,\n      direction,\n      offset,\n      adjustments;\n\n  if (trblDiff.bottom || trblDiff.top) {\n\n    change = trblDiff.bottom || trblDiff.top;\n    spacePos = shape.y + (trblDiff.bottom ? shape.height : 0) + (trblDiff.bottom ? -10 : 10);\n    direction = trblDiff.bottom ? 's' : 'n';\n\n    offset = trblDiff.top > 0 || trblDiff.bottom < 0 ? -change : change;\n\n    adjustments = spaceTool.calculateAdjustments(allAffected, 'y', offset, spacePos);\n\n    spaceTool.makeSpace(adjustments.movingShapes, adjustments.resizingShapes, { x: 0, y: change }, direction);\n  }\n\n\n  if (trblDiff.left || trblDiff.right) {\n\n    change = trblDiff.right || trblDiff.left;\n    spacePos = shape.x + (trblDiff.right ? shape.width : 0) + (trblDiff.right ? -10 : 100);\n    direction = trblDiff.right ? 'e' : 'w';\n\n    offset = trblDiff.left > 0 || trblDiff.right < 0 ? -change : change;\n\n    adjustments = spaceTool.calculateAdjustments(allLanes, 'x', offset, spacePos);\n\n    spaceTool.makeSpace(adjustments.movingShapes, adjustments.resizingShapes, { x: change, y: 0 }, direction);\n  }\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}