{"ast":null,"code":"import { set as cursorSet, unset as cursorUnset } from '../../util/Cursor';\nimport { install as installClickTrap } from '../../util/ClickTrap';\nimport { delta as deltaPos } from '../../util/PositionUtil';\nimport { event as domEvent, closest as domClosest } from 'min-dom';\nimport { toPoint } from '../../util/Event';\n\n/**\n * @typedef {import('../../core/Canvas').default} Canvas\n * @typedef {import('../../core/EventBus').default} EventBus\n */\n\nvar THRESHOLD = 15;\n\n/**\n * Move the canvas via mouse.\n *\n * @param {EventBus} eventBus\n * @param {Canvas} canvas\n */\nexport default function MoveCanvas(eventBus, canvas) {\n  var context;\n  function handleMousedown(event) {\n    return handleStart(event.originalEvent);\n  }\n\n  // listen for move on element mouse down;\n  // allow others to hook into the event before us though\n  // (dragging / element moving will do this)\n  eventBus.on('canvas.focus.changed', function (event) {\n    if (event.focused) {\n      eventBus.on('element.mousedown', 500, handleMousedown);\n    } else {\n      eventBus.off('element.mousedown', handleMousedown);\n    }\n  });\n  function handleMove(event) {\n    var start = context.start,\n      button = context.button,\n      position = toPoint(event),\n      delta = deltaPos(position, start);\n    if (!context.dragging && length(delta) > THRESHOLD) {\n      context.dragging = true;\n      if (button === 0) {\n        installClickTrap(eventBus);\n      }\n      cursorSet('grab');\n    }\n    if (context.dragging) {\n      var lastPosition = context.last || context.start;\n      delta = deltaPos(position, lastPosition);\n      canvas.scroll({\n        dx: delta.x,\n        dy: delta.y\n      });\n      context.last = position;\n    }\n\n    // prevent select\n    event.preventDefault();\n  }\n  function handleEnd(event) {\n    domEvent.unbind(document, 'mousemove', handleMove);\n    domEvent.unbind(document, 'mouseup', handleEnd);\n    context = null;\n    cursorUnset();\n  }\n  function handleStart(event) {\n    // event is already handled by '.djs-draggable'\n    if (domClosest(event.target, '.djs-draggable')) {\n      return;\n    }\n    var button = event.button;\n\n    // reject right mouse button or modifier key\n    if (button >= 2 || event.ctrlKey || event.shiftKey || event.altKey) {\n      return;\n    }\n    context = {\n      button: button,\n      start: toPoint(event)\n    };\n    domEvent.bind(document, 'mousemove', handleMove);\n    domEvent.bind(document, 'mouseup', handleEnd);\n\n    // we've handled the event\n    return true;\n  }\n  this.isActive = function () {\n    return !!context;\n  };\n}\nMoveCanvas.$inject = ['eventBus', 'canvas'];\n\n// helpers ///////\n\nfunction length(point) {\n  return Math.sqrt(Math.pow(point.x, 2) + Math.pow(point.y, 2));\n}","map":{"version":3,"names":["set","cursorSet","unset","cursorUnset","install","installClickTrap","delta","deltaPos","event","domEvent","closest","domClosest","toPoint","THRESHOLD","MoveCanvas","eventBus","canvas","context","handleMousedown","handleStart","originalEvent","on","focused","off","handleMove","start","button","position","dragging","length","lastPosition","last","scroll","dx","x","dy","y","preventDefault","handleEnd","unbind","document","target","ctrlKey","shiftKey","altKey","bind","isActive","$inject","point","Math","sqrt","pow"],"sources":["/home/runner/work/sgex/sgex/node_modules/diagram-js/lib/navigation/movecanvas/MoveCanvas.js"],"sourcesContent":["import {\n  set as cursorSet,\n  unset as cursorUnset\n} from '../../util/Cursor';\n\nimport {\n  install as installClickTrap\n} from '../../util/ClickTrap';\n\nimport {\n  delta as deltaPos\n} from '../../util/PositionUtil';\n\nimport {\n  event as domEvent,\n  closest as domClosest\n} from 'min-dom';\n\nimport {\n  toPoint\n} from '../../util/Event';\n\n/**\n * @typedef {import('../../core/Canvas').default} Canvas\n * @typedef {import('../../core/EventBus').default} EventBus\n */\n\nvar THRESHOLD = 15;\n\n\n/**\n * Move the canvas via mouse.\n *\n * @param {EventBus} eventBus\n * @param {Canvas} canvas\n */\nexport default function MoveCanvas(eventBus, canvas) {\n\n  var context;\n\n  function handleMousedown(event) {\n    return handleStart(event.originalEvent);\n  }\n\n  // listen for move on element mouse down;\n  // allow others to hook into the event before us though\n  // (dragging / element moving will do this)\n  eventBus.on('canvas.focus.changed', function(event) {\n    if (event.focused) {\n      eventBus.on('element.mousedown', 500, handleMousedown);\n    } else {\n      eventBus.off('element.mousedown', handleMousedown);\n    }\n  });\n\n\n  function handleMove(event) {\n\n    var start = context.start,\n        button = context.button,\n        position = toPoint(event),\n        delta = deltaPos(position, start);\n\n    if (!context.dragging && length(delta) > THRESHOLD) {\n      context.dragging = true;\n\n      if (button === 0) {\n        installClickTrap(eventBus);\n      }\n\n      cursorSet('grab');\n    }\n\n    if (context.dragging) {\n\n      var lastPosition = context.last || context.start;\n\n      delta = deltaPos(position, lastPosition);\n\n      canvas.scroll({\n        dx: delta.x,\n        dy: delta.y\n      });\n\n      context.last = position;\n    }\n\n    // prevent select\n    event.preventDefault();\n  }\n\n\n  function handleEnd(event) {\n    domEvent.unbind(document, 'mousemove', handleMove);\n    domEvent.unbind(document, 'mouseup', handleEnd);\n\n    context = null;\n\n    cursorUnset();\n  }\n\n  function handleStart(event) {\n\n    // event is already handled by '.djs-draggable'\n    if (domClosest(event.target, '.djs-draggable')) {\n      return;\n    }\n\n    var button = event.button;\n\n    // reject right mouse button or modifier key\n    if (button >= 2 || event.ctrlKey || event.shiftKey || event.altKey) {\n      return;\n    }\n\n    context = {\n      button: button,\n      start: toPoint(event)\n    };\n\n    domEvent.bind(document, 'mousemove', handleMove);\n    domEvent.bind(document, 'mouseup', handleEnd);\n\n    // we've handled the event\n    return true;\n  }\n\n  this.isActive = function() {\n    return !!context;\n  };\n\n}\n\n\nMoveCanvas.$inject = [\n  'eventBus',\n  'canvas'\n];\n\n\n\n// helpers ///////\n\nfunction length(point) {\n  return Math.sqrt(Math.pow(point.x, 2) + Math.pow(point.y, 2));\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}