{"ast":null,"code":"import { every, forEach, isArray, isFunction } from 'min-dash';\nimport { delegate as domDelegate, event as domEvent, attr as domAttr, query as domQuery, classes as domClasses, domify } from 'min-dom';\nimport { escapeCSS } from '../../util/EscapeUtil';\nimport { isConnection } from '../../util/ModelUtil';\nvar MARKER_HIDDEN = 'djs-element-hidden';\n\n/**\n * @typedef {import('../../model/Types').Element} Element\n *\n * @typedef {import('../../util/Types').Rect} Rect\n * @typedef {import('../../util/Types').RectTRBL} RectTRBL\n *\n * @typedef {import('../../core/Canvas').default} Canvas\n * @typedef {import('../../core/ElementRegistry').default} ElementRegistry\n * @typedef {import('../../core/EventBus').default} EventBus\n * @typedef {import('../../scheduler/Scheduler').default} Scheduler\n *\n * @typedef {import('./ContextPadProvider').default} ContextPadProvider\n * @typedef {import('./ContextPadProvider').ContextPadEntries} ContextPadEntries\n *\n */\n\n/**\n * @template {Element} [ElementType=Element]\n *\n * @typedef {ElementType|ElementType[]} ContextPadTarget\n */\n\nvar entrySelector = '.entry';\nvar DEFAULT_PRIORITY = 1000;\nvar CONTEXT_PAD_MARGIN = 8;\nvar HOVER_DELAY = 300;\n\n/**\n * A context pad that displays element specific, contextual actions next\n * to a diagram element.\n *\n * @param {Canvas} canvas\n * @param {ElementRegistry} elementRegistry\n * @param {EventBus} eventBus\n * @param {Scheduler} scheduler\n */\nexport default function ContextPad(canvas, elementRegistry, eventBus, scheduler) {\n  this._canvas = canvas;\n  this._elementRegistry = elementRegistry;\n  this._eventBus = eventBus;\n  this._scheduler = scheduler;\n  this._current = null;\n  this._init();\n}\nContextPad.$inject = ['canvas', 'elementRegistry', 'eventBus', 'scheduler'];\n\n/**\n * Registers events needed for interaction with other components.\n */\nContextPad.prototype._init = function () {\n  var self = this;\n  this._eventBus.on('selection.changed', function (event) {\n    var selection = event.newSelection;\n    var target = selection.length ? selection.length === 1 ? selection[0] : selection : null;\n    if (target) {\n      self.open(target, true);\n    } else {\n      self.close();\n    }\n  });\n  this._eventBus.on('elements.changed', function (event) {\n    var elements = event.elements,\n      current = self._current;\n    if (!current) {\n      return;\n    }\n    var target = current.target;\n    var targets = isArray(target) ? target : [target];\n    var targetsChanged = targets.filter(function (element) {\n      return elements.includes(element);\n    });\n    if (targetsChanged.length) {\n      // (1) close\n      self.close();\n      var targetsNew = targets.filter(function (element) {\n        return self._elementRegistry.get(element.id);\n      });\n      if (targetsNew.length) {\n        // (2) re-open with new targets being all previous targets that still\n        // exist\n        self._updateAndOpen(targetsNew.length > 1 ? targetsNew : targetsNew[0]);\n      }\n    }\n  });\n  this._eventBus.on('canvas.viewbox.changed', function () {\n    self._updatePosition();\n  });\n  this._eventBus.on('element.marker.update', function (event) {\n    if (!self.isOpen()) {\n      return;\n    }\n    var element = event.element;\n    var current = self._current;\n    var targets = isArray(current.target) ? current.target : [current.target];\n    if (!targets.includes(element)) {\n      return;\n    }\n    self._updateVisibility();\n  });\n  this._container = this._createContainer();\n};\nContextPad.prototype._createContainer = function () {\n  var container = domify('<div class=\"djs-context-pad-parent\"></div>');\n  this._canvas.getContainer().appendChild(container);\n  return container;\n};\n\n/**\n * @overlord\n *\n * Register a context pad provider with the default priority. See\n * {@link ContextPadProvider} for examples.\n *\n * @param {ContextPadProvider} provider\n */\n\n/**\n * Register a context pad provider with the given priority. See\n * {@link ContextPadProvider} for examples.\n *\n * @param {number} priority\n * @param {ContextPadProvider} provider\n */\nContextPad.prototype.registerProvider = function (priority, provider) {\n  if (!provider) {\n    provider = priority;\n    priority = DEFAULT_PRIORITY;\n  }\n  this._eventBus.on('contextPad.getProviders', priority, function (event) {\n    event.providers.push(provider);\n  });\n};\n\n/**\n * Get context pad entries for given elements.\n *\n * @param {ContextPadTarget} target\n *\n * @return {ContextPadEntries} list of entries\n */\nContextPad.prototype.getEntries = function (target) {\n  var providers = this._getProviders();\n  var provideFn = isArray(target) ? 'getMultiElementContextPadEntries' : 'getContextPadEntries';\n  var entries = {};\n\n  // loop through all providers and their entries.\n  // group entries by id so that overriding an entry is possible\n  forEach(providers, function (provider) {\n    if (!isFunction(provider[provideFn])) {\n      return;\n    }\n    var entriesOrUpdater = provider[provideFn](target);\n    if (isFunction(entriesOrUpdater)) {\n      entries = entriesOrUpdater(entries);\n    } else {\n      forEach(entriesOrUpdater, function (entry, id) {\n        entries[id] = entry;\n      });\n    }\n  });\n  return entries;\n};\n\n/**\n * Trigger context pad via DOM event.\n *\n * The entry to trigger is determined by the target element.\n *\n * @param {string} action\n * @param {Event} event\n * @param {boolean} [autoActivate=false]\n */\nContextPad.prototype.trigger = function (action, event, autoActivate) {\n  var self = this;\n  var entry,\n    originalEvent,\n    button = event.delegateTarget || event.target;\n  if (!button) {\n    return event.preventDefault();\n  }\n  entry = domAttr(button, 'data-action');\n  originalEvent = event.originalEvent || event;\n  if (action === 'mouseover') {\n    this._timeout = setTimeout(function () {\n      self._mouseout = self.triggerEntry(entry, 'hover', originalEvent, autoActivate);\n    }, HOVER_DELAY);\n    return;\n  } else if (action === 'mouseout') {\n    clearTimeout(this._timeout);\n    if (this._mouseout) {\n      this._mouseout();\n      this._mouseout = null;\n    }\n    return;\n  }\n  return this.triggerEntry(entry, action, originalEvent, autoActivate);\n};\n\n/**\n * Trigger action on context pad entry entry, e.g. click, mouseover or mouseout.\n *\n * @param {string} entryId\n * @param {string} action\n * @param {Event} event\n * @param {boolean} [autoActivate=false]\n */\nContextPad.prototype.triggerEntry = function (entryId, action, event, autoActivate) {\n  if (!this.isShown()) {\n    return;\n  }\n  var target = this._current.target,\n    entries = this._current.entries;\n  var entry = entries[entryId];\n  if (!entry) {\n    return;\n  }\n  var handler = entry.action;\n  if (this._eventBus.fire('contextPad.trigger', {\n    entry,\n    event\n  }) === false) {\n    return;\n  }\n\n  // simple action (via callback function)\n  if (isFunction(handler)) {\n    if (action === 'click') {\n      return handler(event, target, autoActivate);\n    }\n  } else {\n    if (handler[action]) {\n      return handler[action](event, target, autoActivate);\n    }\n  }\n\n  // silence other actions\n  event.preventDefault();\n};\n\n/**\n * Open the context pad for given elements.\n *\n * @param {ContextPadTarget} target\n * @param {boolean} [force=false] - Force re-opening context pad.\n */\nContextPad.prototype.open = function (target, force) {\n  if (!force && this.isOpen(target)) {\n    return;\n  }\n  this.close();\n  this._updateAndOpen(target);\n};\nContextPad.prototype._getProviders = function () {\n  var event = this._eventBus.createEvent({\n    type: 'contextPad.getProviders',\n    providers: []\n  });\n  this._eventBus.fire(event);\n  return event.providers;\n};\n\n/**\n * @param {ContextPadTarget} target\n */\nContextPad.prototype._updateAndOpen = function (target) {\n  var entries = this.getEntries(target),\n    html = this._createHtml(target),\n    image;\n  forEach(entries, function (entry, id) {\n    var grouping = entry.group || 'default',\n      control = domify(entry.html || '<div class=\"entry\" draggable=\"true\"></div>'),\n      container;\n    domAttr(control, 'data-action', id);\n    container = domQuery('[data-group=' + escapeCSS(grouping) + ']', html);\n    if (!container) {\n      container = domify('<div class=\"group\"></div>');\n      domAttr(container, 'data-group', grouping);\n      html.appendChild(container);\n    }\n    container.appendChild(control);\n    if (entry.className) {\n      addClasses(control, entry.className);\n    }\n    if (entry.title) {\n      domAttr(control, 'title', entry.title);\n    }\n    if (entry.imageUrl) {\n      image = domify('<img>');\n      domAttr(image, 'src', entry.imageUrl);\n      image.style.width = '100%';\n      image.style.height = '100%';\n      control.appendChild(image);\n    }\n  });\n  domClasses(html).add('open');\n  this._current = {\n    entries,\n    html,\n    target\n  };\n  this._updatePosition();\n  this._updateVisibility();\n  this._eventBus.fire('contextPad.open', {\n    current: this._current\n  });\n};\n\n/**\n * @param {ContextPadTarget} target\n *\n * @return {HTMLElement}\n */\nContextPad.prototype._createHtml = function (target) {\n  var self = this;\n  var html = domify('<div class=\"djs-context-pad\"></div>');\n  domDelegate.bind(html, entrySelector, 'click', function (event) {\n    self.trigger('click', event);\n  });\n  domDelegate.bind(html, entrySelector, 'dragstart', function (event) {\n    self.trigger('dragstart', event);\n  });\n  domDelegate.bind(html, entrySelector, 'mouseover', function (event) {\n    self.trigger('mouseover', event);\n  });\n  domDelegate.bind(html, entrySelector, 'mouseout', function (event) {\n    self.trigger('mouseout', event);\n  });\n\n  // stop propagation of mouse events\n  domEvent.bind(html, 'mousedown', function (event) {\n    event.stopPropagation();\n  });\n  this._container.appendChild(html);\n  this._eventBus.fire('contextPad.create', {\n    target: target,\n    pad: html\n  });\n  return html;\n};\n\n/**\n * @param {ContextPadTarget} target\n *\n * @return { { html: HTMLElement } }\n */\nContextPad.prototype.getPad = function (target) {\n  console.warn(new Error('ContextPad#getPad is deprecated and will be removed in future library versions, cf. https://github.com/bpmn-io/diagram-js/pull/888'));\n  let html;\n  if (this.isOpen() && targetsEqual(this._current.target, target)) {\n    html = this._current.html;\n  } else {\n    html = this._createHtml(target);\n  }\n  return {\n    html\n  };\n};\n\n/**\n * Close the context pad\n */\nContextPad.prototype.close = function () {\n  if (!this.isOpen()) {\n    return;\n  }\n  clearTimeout(this._timeout);\n  this._container.innerHTML = '';\n  this._eventBus.fire('contextPad.close', {\n    current: this._current\n  });\n  this._current = null;\n};\n\n/**\n * Check if pad is open.\n *\n * If target is provided, check if it is opened\n * for the given target (single or multiple elements).\n *\n * @param {ContextPadTarget} [target]\n * @return {boolean}\n */\nContextPad.prototype.isOpen = function (target) {\n  var current = this._current;\n  if (!current) {\n    return false;\n  }\n\n  // basic no-args is open check\n  if (!target) {\n    return true;\n  }\n  var currentTarget = current.target;\n\n  // strict handling of single vs. multi-selection\n  if (isArray(target) !== isArray(currentTarget)) {\n    return false;\n  }\n  if (isArray(target)) {\n    return target.length === currentTarget.length && every(target, function (element) {\n      return currentTarget.includes(element);\n    });\n  } else {\n    return currentTarget === target;\n  }\n};\n\n/**\n * Check if pad is open and not hidden.\n *\n * @return {boolean}\n */\nContextPad.prototype.isShown = function () {\n  return this.isOpen() && domClasses(this._current.html).has('open');\n};\n\n/**\n * Show context pad.\n */\nContextPad.prototype.show = function () {\n  if (!this.isOpen()) {\n    return;\n  }\n  domClasses(this._current.html).add('open');\n  this._updatePosition();\n  this._eventBus.fire('contextPad.show', {\n    current: this._current\n  });\n};\n\n/**\n * Hide context pad.\n */\nContextPad.prototype.hide = function () {\n  if (!this.isOpen()) {\n    return;\n  }\n  domClasses(this._current.html).remove('open');\n  this._eventBus.fire('contextPad.hide', {\n    current: this._current\n  });\n};\n\n/**\n * Get context pad position.\n *\n * If target is connection context pad will be positioned at connection end.\n *\n * If multiple targets context pad will be placed at top right corner bounding\n * box.\n *\n * @param {ContextPadTarget} target\n *\n * @return {RectTRBL & { x: number, y: number }}\n */\nContextPad.prototype._getPosition = function (target) {\n  if (!isArray(target) && isConnection(target)) {\n    var viewbox = this._canvas.viewbox();\n    var lastWaypoint = getLastWaypoint(target);\n    var x = lastWaypoint.x * viewbox.scale - viewbox.x * viewbox.scale,\n      y = lastWaypoint.y * viewbox.scale - viewbox.y * viewbox.scale;\n    return {\n      left: x + CONTEXT_PAD_MARGIN * this._canvas.zoom(),\n      top: y\n    };\n  }\n  var container = this._canvas.getContainer();\n  var containerBounds = container.getBoundingClientRect();\n  var targetBounds = this._getTargetBounds(target);\n  return {\n    left: targetBounds.right - containerBounds.left + CONTEXT_PAD_MARGIN * this._canvas.zoom(),\n    top: targetBounds.top - containerBounds.top\n  };\n};\n\n/**\n * Update context pad position.\n */\nContextPad.prototype._updatePosition = function () {\n  const updateFn = () => {\n    if (!this.isOpen()) {\n      return;\n    }\n    var html = this._current.html;\n    var position = this._getPosition(this._current.target);\n    if ('x' in position && 'y' in position) {\n      html.style.left = position.x + 'px';\n      html.style.top = position.y + 'px';\n    } else {\n      ['top', 'right', 'bottom', 'left'].forEach(function (key) {\n        if (key in position) {\n          html.style[key] = position[key] + 'px';\n        }\n      });\n    }\n  };\n  this._scheduler.schedule(updateFn, 'ContextPad#_updatePosition');\n};\n\n/**\n * Update context pad visibility. Hide if any of the target elements is hidden\n * using the `djs-element-hidden` or `djs-label-hidden` markers.\n */\nContextPad.prototype._updateVisibility = function () {\n  const updateFn = () => {\n    if (!this.isOpen()) {\n      return;\n    }\n    var self = this;\n    var target = this._current.target;\n    var targets = isArray(target) ? target : [target];\n    var isHidden = targets.some(function (target) {\n      return self._canvas.hasMarker(target, MARKER_HIDDEN);\n    });\n    if (isHidden) {\n      self.hide();\n    } else {\n      self.show();\n    }\n  };\n  this._scheduler.schedule(updateFn, 'ContextPad#_updateVisibility');\n};\n\n/**\n * Get bounding client rect of target element(s).\n *\n * @param {ContextPadTarget} target\n *\n * @returns {Rect & RectTRBL}\n */\nContextPad.prototype._getTargetBounds = function (target) {\n  var self = this;\n  var elements = isArray(target) ? target : [target];\n  var elementsGfx = elements.map(function (element) {\n    return self._canvas.getGraphics(element);\n  });\n  return elementsGfx.reduce(function (bounds, elementGfx) {\n    const elementBounds = elementGfx.getBoundingClientRect();\n    bounds.top = Math.min(bounds.top, elementBounds.top);\n    bounds.right = Math.max(bounds.right, elementBounds.right);\n    bounds.bottom = Math.max(bounds.bottom, elementBounds.bottom);\n    bounds.left = Math.min(bounds.left, elementBounds.left);\n    bounds.x = bounds.left;\n    bounds.y = bounds.top;\n    bounds.width = bounds.right - bounds.left;\n    bounds.height = bounds.bottom - bounds.top;\n    return bounds;\n  }, {\n    top: Infinity,\n    right: -Infinity,\n    bottom: -Infinity,\n    left: Infinity\n  });\n};\n\n// helpers //////////\n\nfunction addClasses(element, classNames) {\n  var classes = domClasses(element);\n  classNames = isArray(classNames) ? classNames : classNames.split(/\\s+/g);\n  classNames.forEach(function (cls) {\n    classes.add(cls);\n  });\n}\nfunction getLastWaypoint(connection) {\n  return connection.waypoints[connection.waypoints.length - 1];\n}\n\n/**\n * @param {ContextPadTarget} target\n * @param {ContextPadTarget} otherTarget\n *\n * @return {boolean}\n */\nfunction targetsEqual(target, otherTarget) {\n  target = isArray(target) ? target : [target];\n  otherTarget = isArray(otherTarget) ? otherTarget : [otherTarget];\n  return target.length === otherTarget.length && every(target, function (element) {\n    return otherTarget.includes(element);\n  });\n}","map":{"version":3,"names":["every","forEach","isArray","isFunction","delegate","domDelegate","event","domEvent","attr","domAttr","query","domQuery","classes","domClasses","domify","escapeCSS","isConnection","MARKER_HIDDEN","entrySelector","DEFAULT_PRIORITY","CONTEXT_PAD_MARGIN","HOVER_DELAY","ContextPad","canvas","elementRegistry","eventBus","scheduler","_canvas","_elementRegistry","_eventBus","_scheduler","_current","_init","$inject","prototype","self","on","selection","newSelection","target","length","open","close","elements","current","targets","targetsChanged","filter","element","includes","targetsNew","get","id","_updateAndOpen","_updatePosition","isOpen","_updateVisibility","_container","_createContainer","container","getContainer","appendChild","registerProvider","priority","provider","providers","push","getEntries","_getProviders","provideFn","entries","entriesOrUpdater","entry","trigger","action","autoActivate","originalEvent","button","delegateTarget","preventDefault","_timeout","setTimeout","_mouseout","triggerEntry","clearTimeout","entryId","isShown","handler","fire","force","createEvent","type","html","_createHtml","image","grouping","group","control","className","addClasses","title","imageUrl","style","width","height","add","bind","stopPropagation","pad","getPad","console","warn","Error","targetsEqual","innerHTML","currentTarget","has","show","hide","remove","_getPosition","viewbox","lastWaypoint","getLastWaypoint","x","scale","y","left","zoom","top","containerBounds","getBoundingClientRect","targetBounds","_getTargetBounds","right","updateFn","position","key","schedule","isHidden","some","hasMarker","elementsGfx","map","getGraphics","reduce","bounds","elementGfx","elementBounds","Math","min","max","bottom","Infinity","classNames","split","cls","connection","waypoints","otherTarget"],"sources":["/home/runner/work/sgex/sgex/node_modules/diagram-js/lib/features/context-pad/ContextPad.js"],"sourcesContent":["import {\n  every,\n  forEach,\n  isArray,\n  isFunction\n} from 'min-dash';\n\nimport {\n  delegate as domDelegate,\n  event as domEvent,\n  attr as domAttr,\n  query as domQuery,\n  classes as domClasses,\n  domify as domify\n} from 'min-dom';\n\nimport {\n  escapeCSS\n} from '../../util/EscapeUtil';\n\nimport { isConnection } from '../../util/ModelUtil';\n\nvar MARKER_HIDDEN = 'djs-element-hidden';\n\n/**\n * @typedef {import('../../model/Types').Element} Element\n *\n * @typedef {import('../../util/Types').Rect} Rect\n * @typedef {import('../../util/Types').RectTRBL} RectTRBL\n *\n * @typedef {import('../../core/Canvas').default} Canvas\n * @typedef {import('../../core/ElementRegistry').default} ElementRegistry\n * @typedef {import('../../core/EventBus').default} EventBus\n * @typedef {import('../../scheduler/Scheduler').default} Scheduler\n *\n * @typedef {import('./ContextPadProvider').default} ContextPadProvider\n * @typedef {import('./ContextPadProvider').ContextPadEntries} ContextPadEntries\n *\n */\n\n/**\n * @template {Element} [ElementType=Element]\n *\n * @typedef {ElementType|ElementType[]} ContextPadTarget\n */\n\nvar entrySelector = '.entry';\n\nvar DEFAULT_PRIORITY = 1000;\nvar CONTEXT_PAD_MARGIN = 8;\nvar HOVER_DELAY = 300;\n\n/**\n * A context pad that displays element specific, contextual actions next\n * to a diagram element.\n *\n * @param {Canvas} canvas\n * @param {ElementRegistry} elementRegistry\n * @param {EventBus} eventBus\n * @param {Scheduler} scheduler\n */\nexport default function ContextPad(canvas, elementRegistry, eventBus, scheduler) {\n\n  this._canvas = canvas;\n  this._elementRegistry = elementRegistry;\n  this._eventBus = eventBus;\n  this._scheduler = scheduler;\n\n  this._current = null;\n\n  this._init();\n}\n\nContextPad.$inject = [\n  'canvas',\n  'elementRegistry',\n  'eventBus',\n  'scheduler'\n];\n\n\n/**\n * Registers events needed for interaction with other components.\n */\nContextPad.prototype._init = function() {\n  var self = this;\n\n  this._eventBus.on('selection.changed', function(event) {\n\n    var selection = event.newSelection;\n\n    var target = selection.length\n      ? selection.length === 1\n        ? selection[0]\n        : selection\n      : null;\n\n    if (target) {\n      self.open(target, true);\n    } else {\n      self.close();\n    }\n  });\n\n  this._eventBus.on('elements.changed', function(event) {\n    var elements = event.elements,\n        current = self._current;\n\n    if (!current) {\n      return;\n    }\n\n    var target = current.target;\n\n    var targets = isArray(target) ? target : [ target ];\n\n    var targetsChanged = targets.filter(function(element) {\n      return elements.includes(element);\n    });\n\n    if (targetsChanged.length) {\n\n      // (1) close\n      self.close();\n\n      var targetsNew = targets.filter(function(element) {\n        return self._elementRegistry.get(element.id);\n      });\n\n      if (targetsNew.length) {\n\n        // (2) re-open with new targets being all previous targets that still\n        // exist\n        self._updateAndOpen(targetsNew.length > 1 ? targetsNew : targetsNew[ 0 ]);\n      }\n    }\n  });\n\n  this._eventBus.on('canvas.viewbox.changed', function() {\n    self._updatePosition();\n  });\n\n  this._eventBus.on('element.marker.update', function(event) {\n    if (!self.isOpen()) {\n      return;\n    }\n\n    var element = event.element;\n\n    var current = self._current;\n\n    var targets = isArray(current.target) ? current.target : [ current.target ];\n\n    if (!targets.includes(element)) {\n      return;\n    }\n\n    self._updateVisibility();\n  });\n\n  this._container = this._createContainer();\n};\n\nContextPad.prototype._createContainer = function() {\n  var container = domify('<div class=\"djs-context-pad-parent\"></div>');\n\n  this._canvas.getContainer().appendChild(container);\n\n  return container;\n};\n\n/**\n * @overlord\n *\n * Register a context pad provider with the default priority. See\n * {@link ContextPadProvider} for examples.\n *\n * @param {ContextPadProvider} provider\n */\n\n/**\n * Register a context pad provider with the given priority. See\n * {@link ContextPadProvider} for examples.\n *\n * @param {number} priority\n * @param {ContextPadProvider} provider\n */\nContextPad.prototype.registerProvider = function(priority, provider) {\n  if (!provider) {\n    provider = priority;\n    priority = DEFAULT_PRIORITY;\n  }\n\n  this._eventBus.on('contextPad.getProviders', priority, function(event) {\n    event.providers.push(provider);\n  });\n};\n\n\n/**\n * Get context pad entries for given elements.\n *\n * @param {ContextPadTarget} target\n *\n * @return {ContextPadEntries} list of entries\n */\nContextPad.prototype.getEntries = function(target) {\n  var providers = this._getProviders();\n\n  var provideFn = isArray(target)\n    ? 'getMultiElementContextPadEntries'\n    : 'getContextPadEntries';\n\n  var entries = {};\n\n  // loop through all providers and their entries.\n  // group entries by id so that overriding an entry is possible\n  forEach(providers, function(provider) {\n\n    if (!isFunction(provider[provideFn])) {\n      return;\n    }\n\n    var entriesOrUpdater = provider[provideFn](target);\n\n    if (isFunction(entriesOrUpdater)) {\n      entries = entriesOrUpdater(entries);\n    } else {\n      forEach(entriesOrUpdater, function(entry, id) {\n        entries[id] = entry;\n      });\n    }\n  });\n\n  return entries;\n};\n\n\n/**\n * Trigger context pad via DOM event.\n *\n * The entry to trigger is determined by the target element.\n *\n * @param {string} action\n * @param {Event} event\n * @param {boolean} [autoActivate=false]\n */\nContextPad.prototype.trigger = function(action, event, autoActivate) {\n  var self = this;\n\n  var entry,\n      originalEvent,\n      button = event.delegateTarget || event.target;\n\n  if (!button) {\n    return event.preventDefault();\n  }\n\n  entry = domAttr(button, 'data-action');\n  originalEvent = event.originalEvent || event;\n\n  if (action === 'mouseover') {\n    this._timeout = setTimeout(function() {\n      self._mouseout = self.triggerEntry(entry, 'hover', originalEvent, autoActivate);\n    }, HOVER_DELAY);\n\n    return;\n  } else if (action === 'mouseout') {\n    clearTimeout(this._timeout);\n\n    if (this._mouseout) {\n      this._mouseout();\n\n      this._mouseout = null;\n    }\n\n    return;\n  }\n\n  return this.triggerEntry(entry, action, originalEvent, autoActivate);\n};\n\n/**\n * Trigger action on context pad entry entry, e.g. click, mouseover or mouseout.\n *\n * @param {string} entryId\n * @param {string} action\n * @param {Event} event\n * @param {boolean} [autoActivate=false]\n */\nContextPad.prototype.triggerEntry = function(entryId, action, event, autoActivate) {\n\n  if (!this.isShown()) {\n    return;\n  }\n\n  var target = this._current.target,\n      entries = this._current.entries;\n\n  var entry = entries[entryId];\n\n  if (!entry) {\n    return;\n  }\n\n  var handler = entry.action;\n\n  if (this._eventBus.fire('contextPad.trigger', { entry, event }) === false) {\n    return;\n  }\n\n  // simple action (via callback function)\n  if (isFunction(handler)) {\n    if (action === 'click') {\n      return handler(event, target, autoActivate);\n    }\n  } else {\n    if (handler[action]) {\n      return handler[action](event, target, autoActivate);\n    }\n  }\n\n  // silence other actions\n  event.preventDefault();\n};\n\n\n/**\n * Open the context pad for given elements.\n *\n * @param {ContextPadTarget} target\n * @param {boolean} [force=false] - Force re-opening context pad.\n */\nContextPad.prototype.open = function(target, force) {\n  if (!force && this.isOpen(target)) {\n    return;\n  }\n\n  this.close();\n\n  this._updateAndOpen(target);\n};\n\nContextPad.prototype._getProviders = function() {\n\n  var event = this._eventBus.createEvent({\n    type: 'contextPad.getProviders',\n    providers: []\n  });\n\n  this._eventBus.fire(event);\n\n  return event.providers;\n};\n\n\n/**\n * @param {ContextPadTarget} target\n */\nContextPad.prototype._updateAndOpen = function(target) {\n  var entries = this.getEntries(target),\n      html = this._createHtml(target),\n      image;\n\n  forEach(entries, function(entry, id) {\n    var grouping = entry.group || 'default',\n        control = domify(entry.html || '<div class=\"entry\" draggable=\"true\"></div>'),\n        container;\n\n    domAttr(control, 'data-action', id);\n\n    container = domQuery('[data-group=' + escapeCSS(grouping) + ']', html);\n    if (!container) {\n      container = domify('<div class=\"group\"></div>');\n      domAttr(container, 'data-group', grouping);\n\n      html.appendChild(container);\n    }\n\n    container.appendChild(control);\n\n    if (entry.className) {\n      addClasses(control, entry.className);\n    }\n\n    if (entry.title) {\n      domAttr(control, 'title', entry.title);\n    }\n\n    if (entry.imageUrl) {\n      image = domify('<img>');\n      domAttr(image, 'src', entry.imageUrl);\n      image.style.width = '100%';\n      image.style.height = '100%';\n\n      control.appendChild(image);\n    }\n  });\n\n  domClasses(html).add('open');\n\n  this._current = {\n    entries,\n    html,\n    target,\n  };\n\n  this._updatePosition();\n\n  this._updateVisibility();\n\n  this._eventBus.fire('contextPad.open', { current: this._current });\n};\n\n/**\n * @param {ContextPadTarget} target\n *\n * @return {HTMLElement}\n */\nContextPad.prototype._createHtml = function(target) {\n  var self = this;\n\n  var html = domify('<div class=\"djs-context-pad\"></div>');\n\n  domDelegate.bind(html, entrySelector, 'click', function(event) {\n    self.trigger('click', event);\n  });\n\n  domDelegate.bind(html, entrySelector, 'dragstart', function(event) {\n    self.trigger('dragstart', event);\n  });\n\n  domDelegate.bind(html, entrySelector, 'mouseover', function(event) {\n    self.trigger('mouseover', event);\n  });\n\n  domDelegate.bind(html, entrySelector, 'mouseout', function(event) {\n    self.trigger('mouseout', event);\n  });\n\n  // stop propagation of mouse events\n  domEvent.bind(html, 'mousedown', function(event) {\n    event.stopPropagation();\n  });\n\n  this._container.appendChild(html);\n\n  this._eventBus.fire('contextPad.create', {\n    target: target,\n    pad: html\n  });\n\n  return html;\n};\n\n/**\n * @param {ContextPadTarget} target\n *\n * @return { { html: HTMLElement } }\n */\nContextPad.prototype.getPad = function(target) {\n  console.warn(new Error('ContextPad#getPad is deprecated and will be removed in future library versions, cf. https://github.com/bpmn-io/diagram-js/pull/888'));\n\n  let html;\n\n  if (this.isOpen() && targetsEqual(this._current.target, target)) {\n    html = this._current.html;\n  } else {\n    html = this._createHtml(target);\n  }\n\n  return { html };\n};\n\n\n/**\n * Close the context pad\n */\nContextPad.prototype.close = function() {\n  if (!this.isOpen()) {\n    return;\n  }\n\n  clearTimeout(this._timeout);\n\n  this._container.innerHTML = '';\n\n  this._eventBus.fire('contextPad.close', { current: this._current });\n\n  this._current = null;\n};\n\n/**\n * Check if pad is open.\n *\n * If target is provided, check if it is opened\n * for the given target (single or multiple elements).\n *\n * @param {ContextPadTarget} [target]\n * @return {boolean}\n */\nContextPad.prototype.isOpen = function(target) {\n  var current = this._current;\n\n  if (!current) {\n    return false;\n  }\n\n  // basic no-args is open check\n  if (!target) {\n    return true;\n  }\n\n  var currentTarget = current.target;\n\n  // strict handling of single vs. multi-selection\n  if (isArray(target) !== isArray(currentTarget)) {\n    return false;\n  }\n\n  if (isArray(target)) {\n    return (\n      target.length === currentTarget.length &&\n      every(target, function(element) {\n        return currentTarget.includes(element);\n      })\n    );\n  } else {\n    return currentTarget === target;\n  }\n};\n\n\n/**\n * Check if pad is open and not hidden.\n *\n * @return {boolean}\n */\nContextPad.prototype.isShown = function() {\n  return this.isOpen() && domClasses(this._current.html).has('open');\n};\n\n/**\n * Show context pad.\n */\nContextPad.prototype.show = function() {\n  if (!this.isOpen()) {\n    return;\n  }\n\n  domClasses(this._current.html).add('open');\n\n  this._updatePosition();\n\n  this._eventBus.fire('contextPad.show', { current: this._current });\n};\n\n/**\n * Hide context pad.\n */\nContextPad.prototype.hide = function() {\n  if (!this.isOpen()) {\n    return;\n  }\n\n  domClasses(this._current.html).remove('open');\n\n  this._eventBus.fire('contextPad.hide', { current: this._current });\n};\n\n/**\n * Get context pad position.\n *\n * If target is connection context pad will be positioned at connection end.\n *\n * If multiple targets context pad will be placed at top right corner bounding\n * box.\n *\n * @param {ContextPadTarget} target\n *\n * @return {RectTRBL & { x: number, y: number }}\n */\nContextPad.prototype._getPosition = function(target) {\n  if (!isArray(target) && isConnection(target)) {\n    var viewbox = this._canvas.viewbox();\n\n    var lastWaypoint = getLastWaypoint(target);\n\n    var x = lastWaypoint.x * viewbox.scale - viewbox.x * viewbox.scale,\n        y = lastWaypoint.y * viewbox.scale - viewbox.y * viewbox.scale;\n\n    return {\n      left: x + CONTEXT_PAD_MARGIN * this._canvas.zoom(),\n      top: y\n    };\n  }\n\n  var container = this._canvas.getContainer();\n\n  var containerBounds = container.getBoundingClientRect();\n\n  var targetBounds = this._getTargetBounds(target);\n\n  return {\n    left: targetBounds.right - containerBounds.left + CONTEXT_PAD_MARGIN * this._canvas.zoom(),\n    top: targetBounds.top - containerBounds.top\n  };\n};\n\n/**\n * Update context pad position.\n */\nContextPad.prototype._updatePosition = function() {\n\n  const updateFn = () => {\n    if (!this.isOpen()) {\n      return;\n    }\n\n    var html = this._current.html;\n\n    var position = this._getPosition(this._current.target);\n\n    if ('x' in position && 'y' in position) {\n      html.style.left = position.x + 'px';\n      html.style.top = position.y + 'px';\n    } else {\n      [\n        'top',\n        'right',\n        'bottom',\n        'left'\n      ].forEach(function(key) {\n        if (key in position) {\n          html.style[ key ] = position[ key ] + 'px';\n        }\n      });\n    }\n  };\n\n  this._scheduler.schedule(updateFn, 'ContextPad#_updatePosition');\n};\n\n/**\n * Update context pad visibility. Hide if any of the target elements is hidden\n * using the `djs-element-hidden` or `djs-label-hidden` markers.\n */\nContextPad.prototype._updateVisibility = function() {\n\n  const updateFn = () => {\n    if (!this.isOpen()) {\n      return;\n    }\n\n    var self = this;\n\n    var target = this._current.target;\n\n    var targets = isArray(target) ? target : [ target ];\n\n    var isHidden = targets.some(function(target) {\n      return self._canvas.hasMarker(target, MARKER_HIDDEN);\n    });\n\n    if (isHidden) {\n      self.hide();\n    } else {\n      self.show();\n    }\n  };\n\n  this._scheduler.schedule(updateFn, 'ContextPad#_updateVisibility');\n};\n\n/**\n * Get bounding client rect of target element(s).\n *\n * @param {ContextPadTarget} target\n *\n * @returns {Rect & RectTRBL}\n */\nContextPad.prototype._getTargetBounds = function(target) {\n  var self = this;\n\n  var elements = isArray(target) ? target : [ target ];\n\n  var elementsGfx = elements.map(function(element) {\n    return self._canvas.getGraphics(element);\n  });\n\n  return elementsGfx.reduce(function(bounds, elementGfx) {\n    const elementBounds = elementGfx.getBoundingClientRect();\n\n    bounds.top = Math.min(bounds.top, elementBounds.top);\n    bounds.right = Math.max(bounds.right, elementBounds.right);\n    bounds.bottom = Math.max(bounds.bottom, elementBounds.bottom);\n    bounds.left = Math.min(bounds.left, elementBounds.left);\n\n    bounds.x = bounds.left;\n    bounds.y = bounds.top;\n\n    bounds.width = bounds.right - bounds.left;\n    bounds.height = bounds.bottom - bounds.top;\n\n    return bounds;\n  }, {\n    top: Infinity,\n    right: -Infinity,\n    bottom: -Infinity,\n    left: Infinity\n  });\n};\n\n// helpers //////////\n\nfunction addClasses(element, classNames) {\n  var classes = domClasses(element);\n\n  classNames = isArray(classNames) ? classNames : classNames.split(/\\s+/g);\n\n  classNames.forEach(function(cls) {\n    classes.add(cls);\n  });\n}\n\nfunction getLastWaypoint(connection) {\n  return connection.waypoints[connection.waypoints.length - 1];\n}\n\n/**\n * @param {ContextPadTarget} target\n * @param {ContextPadTarget} otherTarget\n *\n * @return {boolean}\n */\nfunction targetsEqual(target, otherTarget) {\n  target = isArray(target) ? target : [ target ];\n  otherTarget = isArray(otherTarget) ? otherTarget : [ otherTarget ];\n\n  return target.length === otherTarget.length\n    && every(target, function(element) {\n      return otherTarget.includes(element);\n    });\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}