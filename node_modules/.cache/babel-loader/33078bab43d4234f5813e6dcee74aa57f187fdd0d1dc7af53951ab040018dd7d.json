{"ast":null,"code":"import { assign, filter, forEach, isNumber, map, omit, pick, values } from 'min-dash';\nimport { getBBox, getParents } from '../../../util/Elements';\nimport { isConnection, isLabel } from '../../../util/ModelUtil';\n\n/**\r\n * @typedef {import('../Modeling').default} Modeling\r\n */\n\nvar round = Math.round;\n\n/**\r\n * @param {Modeling} modeling\r\n */\nexport default function CreateElementsHandler(modeling) {\n  this._modeling = modeling;\n}\nCreateElementsHandler.$inject = ['modeling'];\nCreateElementsHandler.prototype.preExecute = function (context) {\n  var elements = context.elements,\n    parent = context.parent,\n    parentIndex = context.parentIndex,\n    position = context.position,\n    hints = context.hints;\n  var modeling = this._modeling;\n\n  // make sure each element has x and y\n  forEach(elements, function (element) {\n    if (!isNumber(element.x)) {\n      element.x = 0;\n    }\n    if (!isNumber(element.y)) {\n      element.y = 0;\n    }\n  });\n  var visibleElements = filter(elements, function (element) {\n    return !element.hidden;\n  });\n  var bbox = getBBox(visibleElements);\n\n  // center elements around position\n  forEach(elements, function (element) {\n    if (isConnection(element)) {\n      element.waypoints = map(element.waypoints, function (waypoint) {\n        return {\n          x: round(waypoint.x - bbox.x - bbox.width / 2 + position.x),\n          y: round(waypoint.y - bbox.y - bbox.height / 2 + position.y)\n        };\n      });\n    }\n    assign(element, {\n      x: round(element.x - bbox.x - bbox.width / 2 + position.x),\n      y: round(element.y - bbox.y - bbox.height / 2 + position.y)\n    });\n  });\n  var parents = getParents(elements);\n  var cache = {};\n  forEach(elements, function (element) {\n    if (isConnection(element)) {\n      cache[element.id] = isNumber(parentIndex) ? modeling.createConnection(cache[element.source.id], cache[element.target.id], parentIndex, element, element.parent || parent, hints) : modeling.createConnection(cache[element.source.id], cache[element.target.id], element, element.parent || parent, hints);\n      return;\n    }\n    var createShapeHints = assign({}, hints);\n    if (parents.indexOf(element) === -1) {\n      createShapeHints.autoResize = false;\n    }\n    if (isLabel(element)) {\n      createShapeHints = omit(createShapeHints, ['attach']);\n    }\n    cache[element.id] = isNumber(parentIndex) ? modeling.createShape(element, pick(element, ['x', 'y', 'width', 'height']), element.parent || parent, parentIndex, createShapeHints) : modeling.createShape(element, pick(element, ['x', 'y', 'width', 'height']), element.parent || parent, createShapeHints);\n  });\n  context.elements = values(cache);\n};","map":{"version":3,"names":["assign","filter","forEach","isNumber","map","omit","pick","values","getBBox","getParents","isConnection","isLabel","round","Math","CreateElementsHandler","modeling","_modeling","$inject","prototype","preExecute","context","elements","parent","parentIndex","position","hints","element","x","y","visibleElements","hidden","bbox","waypoints","waypoint","width","height","parents","cache","id","createConnection","source","target","createShapeHints","indexOf","autoResize","createShape"],"sources":["/home/runner/work/sgex/sgex/node_modules/diagram-js/lib/features/modeling/cmd/CreateElementsHandler.js"],"sourcesContent":["import {\r\n  assign,\r\n  filter,\r\n  forEach,\r\n  isNumber,\r\n  map,\r\n  omit,\r\n  pick,\r\n  values\r\n} from 'min-dash';\r\n\r\nimport {\r\n  getBBox,\r\n  getParents\r\n} from '../../../util/Elements';\r\n\r\nimport {\r\n  isConnection,\r\n  isLabel\r\n} from '../../../util/ModelUtil';\r\n\r\n/**\r\n * @typedef {import('../Modeling').default} Modeling\r\n */\r\n\r\nvar round = Math.round;\r\n\r\n/**\r\n * @param {Modeling} modeling\r\n */\r\nexport default function CreateElementsHandler(modeling) {\r\n  this._modeling = modeling;\r\n}\r\n\r\nCreateElementsHandler.$inject = [\r\n  'modeling'\r\n];\r\n\r\nCreateElementsHandler.prototype.preExecute = function(context) {\r\n  var elements = context.elements,\r\n      parent = context.parent,\r\n      parentIndex = context.parentIndex,\r\n      position = context.position,\r\n      hints = context.hints;\r\n\r\n  var modeling = this._modeling;\r\n\r\n  // make sure each element has x and y\r\n  forEach(elements, function(element) {\r\n    if (!isNumber(element.x)) {\r\n      element.x = 0;\r\n    }\r\n\r\n    if (!isNumber(element.y)) {\r\n      element.y = 0;\r\n    }\r\n  });\r\n\r\n  var visibleElements = filter(elements, function(element) {\r\n    return !element.hidden;\r\n  });\r\n\r\n  var bbox = getBBox(visibleElements);\r\n\r\n  // center elements around position\r\n  forEach(elements, function(element) {\r\n    if (isConnection(element)) {\r\n      element.waypoints = map(element.waypoints, function(waypoint) {\r\n        return {\r\n          x: round(waypoint.x - bbox.x - bbox.width / 2 + position.x),\r\n          y: round(waypoint.y - bbox.y - bbox.height / 2 + position.y)\r\n        };\r\n      });\r\n    }\r\n\r\n    assign(element, {\r\n      x: round(element.x - bbox.x - bbox.width / 2 + position.x),\r\n      y: round(element.y - bbox.y - bbox.height / 2 + position.y)\r\n    });\r\n  });\r\n\r\n  var parents = getParents(elements);\r\n\r\n  var cache = {};\r\n\r\n  forEach(elements, function(element) {\r\n    if (isConnection(element)) {\r\n      cache[ element.id ] = isNumber(parentIndex) ?\r\n        modeling.createConnection(\r\n          cache[ element.source.id ],\r\n          cache[ element.target.id ],\r\n          parentIndex,\r\n          element,\r\n          element.parent || parent,\r\n          hints\r\n        ) :\r\n        modeling.createConnection(\r\n          cache[ element.source.id ],\r\n          cache[ element.target.id ],\r\n          element,\r\n          element.parent || parent,\r\n          hints\r\n        );\r\n\r\n      return;\r\n    }\r\n\r\n    var createShapeHints = assign({}, hints);\r\n\r\n    if (parents.indexOf(element) === -1) {\r\n      createShapeHints.autoResize = false;\r\n    }\r\n\r\n    if (isLabel(element)) {\r\n      createShapeHints = omit(createShapeHints, [ 'attach' ]);\r\n    }\r\n\r\n    cache[ element.id ] = isNumber(parentIndex) ?\r\n      modeling.createShape(\r\n        element,\r\n        pick(element, [ 'x', 'y', 'width', 'height' ]),\r\n        element.parent || parent,\r\n        parentIndex,\r\n        createShapeHints\r\n      ) :\r\n      modeling.createShape(\r\n        element,\r\n        pick(element, [ 'x', 'y', 'width', 'height' ]),\r\n        element.parent || parent,\r\n        createShapeHints\r\n      );\r\n  });\r\n\r\n  context.elements = values(cache);\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}