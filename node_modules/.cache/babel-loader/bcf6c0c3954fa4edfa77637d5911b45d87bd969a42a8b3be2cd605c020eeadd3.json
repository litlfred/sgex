{"ast":null,"code":"import inherits from 'inherits-browser';\nimport { is } from '../../../util/ModelUtil';\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\nimport lineIntersect from './util/LineIntersect';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('../../rules/BpmnRules').default} BpmnRules\n * @typedef {import('../Modeling').default} Modeling\n */\n\n/**\n * @param {EventBus} eventBus\n * @param {BpmnRules} bpmnRules\n * @param {Modeling} modeling\n */\nexport default function RemoveElementBehavior(eventBus, bpmnRules, modeling) {\n  CommandInterceptor.call(this, eventBus);\n\n  /**\n   * Combine sequence flows when deleting an element\n   * if there is one incoming and one outgoing\n   * sequence flow\n   */\n  this.preExecute('shape.delete', function (e) {\n    var shape = e.context.shape;\n\n    // only handle [a] -> [shape] -> [b] patterns\n    if (shape.incoming.length !== 1 || shape.outgoing.length !== 1) {\n      return;\n    }\n    var inConnection = shape.incoming[0],\n      outConnection = shape.outgoing[0];\n\n    // only handle sequence flows\n    if (!is(inConnection, 'bpmn:SequenceFlow') || !is(outConnection, 'bpmn:SequenceFlow')) {\n      return;\n    }\n    if (bpmnRules.canConnect(inConnection.source, outConnection.target, inConnection)) {\n      // compute new, combined waypoints\n      var newWaypoints = getNewWaypoints(inConnection.waypoints, outConnection.waypoints);\n      modeling.reconnectEnd(inConnection, outConnection.target, newWaypoints);\n    }\n  });\n}\ninherits(RemoveElementBehavior, CommandInterceptor);\nRemoveElementBehavior.$inject = ['eventBus', 'bpmnRules', 'modeling'];\n\n// helpers //////////////////////\n\nfunction getDocking(point) {\n  return point.original || point;\n}\nfunction getNewWaypoints(inWaypoints, outWaypoints) {\n  var intersection = lineIntersect(getDocking(inWaypoints[inWaypoints.length - 2]), getDocking(inWaypoints[inWaypoints.length - 1]), getDocking(outWaypoints[1]), getDocking(outWaypoints[0]));\n  if (intersection) {\n    return [].concat(inWaypoints.slice(0, inWaypoints.length - 1), [intersection], outWaypoints.slice(1));\n  } else {\n    return [getDocking(inWaypoints[0]), getDocking(outWaypoints[outWaypoints.length - 1])];\n  }\n}","map":{"version":3,"names":["inherits","is","CommandInterceptor","lineIntersect","RemoveElementBehavior","eventBus","bpmnRules","modeling","call","preExecute","e","shape","context","incoming","length","outgoing","inConnection","outConnection","canConnect","source","target","newWaypoints","getNewWaypoints","waypoints","reconnectEnd","$inject","getDocking","point","original","inWaypoints","outWaypoints","intersection","concat","slice"],"sources":["/home/runner/work/sgex/sgex/node_modules/bpmn-js/lib/features/modeling/behavior/RemoveElementBehavior.js"],"sourcesContent":["import inherits from 'inherits-browser';\n\nimport { is } from '../../../util/ModelUtil';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport lineIntersect from './util/LineIntersect';\n\n/**\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('../../rules/BpmnRules').default} BpmnRules\n * @typedef {import('../Modeling').default} Modeling\n */\n\n/**\n * @param {EventBus} eventBus\n * @param {BpmnRules} bpmnRules\n * @param {Modeling} modeling\n */\nexport default function RemoveElementBehavior(eventBus, bpmnRules, modeling) {\n\n  CommandInterceptor.call(this, eventBus);\n\n  /**\n   * Combine sequence flows when deleting an element\n   * if there is one incoming and one outgoing\n   * sequence flow\n   */\n  this.preExecute('shape.delete', function(e) {\n\n    var shape = e.context.shape;\n\n    // only handle [a] -> [shape] -> [b] patterns\n    if (shape.incoming.length !== 1 || shape.outgoing.length !== 1) {\n      return;\n    }\n\n    var inConnection = shape.incoming[0],\n        outConnection = shape.outgoing[0];\n\n    // only handle sequence flows\n    if (!is(inConnection, 'bpmn:SequenceFlow') || !is(outConnection, 'bpmn:SequenceFlow')) {\n      return;\n    }\n\n    if (bpmnRules.canConnect(inConnection.source, outConnection.target, inConnection)) {\n\n      // compute new, combined waypoints\n      var newWaypoints = getNewWaypoints(inConnection.waypoints, outConnection.waypoints);\n\n      modeling.reconnectEnd(inConnection, outConnection.target, newWaypoints);\n    }\n  });\n\n}\n\ninherits(RemoveElementBehavior, CommandInterceptor);\n\nRemoveElementBehavior.$inject = [\n  'eventBus',\n  'bpmnRules',\n  'modeling'\n];\n\n\n// helpers //////////////////////\n\nfunction getDocking(point) {\n  return point.original || point;\n}\n\n\nfunction getNewWaypoints(inWaypoints, outWaypoints) {\n\n  var intersection = lineIntersect(\n    getDocking(inWaypoints[inWaypoints.length - 2]),\n    getDocking(inWaypoints[inWaypoints.length - 1]),\n    getDocking(outWaypoints[1]),\n    getDocking(outWaypoints[0]));\n\n  if (intersection) {\n    return [].concat(\n      inWaypoints.slice(0, inWaypoints.length - 1),\n      [ intersection ],\n      outWaypoints.slice(1));\n  } else {\n    return [\n      getDocking(inWaypoints[0]),\n      getDocking(outWaypoints[outWaypoints.length - 1])\n    ];\n  }\n}"],"mappings":"AAAA,OAAOA,QAAQ,MAAM,kBAAkB;AAEvC,SAASC,EAAE,QAAQ,yBAAyB;AAE5C,OAAOC,kBAAkB,MAAM,2CAA2C;AAE1E,OAAOC,aAAa,MAAM,sBAAsB;;AAEhD;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,eAAe,SAASC,qBAAqBA,CAACC,QAAQ,EAAEC,SAAS,EAAEC,QAAQ,EAAE;EAE3EL,kBAAkB,CAACM,IAAI,CAAC,IAAI,EAAEH,QAAQ,CAAC;;EAEvC;AACF;AACA;AACA;AACA;EACE,IAAI,CAACI,UAAU,CAAC,cAAc,EAAE,UAASC,CAAC,EAAE;IAE1C,IAAIC,KAAK,GAAGD,CAAC,CAACE,OAAO,CAACD,KAAK;;IAE3B;IACA,IAAIA,KAAK,CAACE,QAAQ,CAACC,MAAM,KAAK,CAAC,IAAIH,KAAK,CAACI,QAAQ,CAACD,MAAM,KAAK,CAAC,EAAE;MAC9D;IACF;IAEA,IAAIE,YAAY,GAAGL,KAAK,CAACE,QAAQ,CAAC,CAAC,CAAC;MAChCI,aAAa,GAAGN,KAAK,CAACI,QAAQ,CAAC,CAAC,CAAC;;IAErC;IACA,IAAI,CAACd,EAAE,CAACe,YAAY,EAAE,mBAAmB,CAAC,IAAI,CAACf,EAAE,CAACgB,aAAa,EAAE,mBAAmB,CAAC,EAAE;MACrF;IACF;IAEA,IAAIX,SAAS,CAACY,UAAU,CAACF,YAAY,CAACG,MAAM,EAAEF,aAAa,CAACG,MAAM,EAAEJ,YAAY,CAAC,EAAE;MAEjF;MACA,IAAIK,YAAY,GAAGC,eAAe,CAACN,YAAY,CAACO,SAAS,EAAEN,aAAa,CAACM,SAAS,CAAC;MAEnFhB,QAAQ,CAACiB,YAAY,CAACR,YAAY,EAAEC,aAAa,CAACG,MAAM,EAAEC,YAAY,CAAC;IACzE;EACF,CAAC,CAAC;AAEJ;AAEArB,QAAQ,CAACI,qBAAqB,EAAEF,kBAAkB,CAAC;AAEnDE,qBAAqB,CAACqB,OAAO,GAAG,CAC9B,UAAU,EACV,WAAW,EACX,UAAU,CACX;;AAGD;;AAEA,SAASC,UAAUA,CAACC,KAAK,EAAE;EACzB,OAAOA,KAAK,CAACC,QAAQ,IAAID,KAAK;AAChC;AAGA,SAASL,eAAeA,CAACO,WAAW,EAAEC,YAAY,EAAE;EAElD,IAAIC,YAAY,GAAG5B,aAAa,CAC9BuB,UAAU,CAACG,WAAW,CAACA,WAAW,CAACf,MAAM,GAAG,CAAC,CAAC,CAAC,EAC/CY,UAAU,CAACG,WAAW,CAACA,WAAW,CAACf,MAAM,GAAG,CAAC,CAAC,CAAC,EAC/CY,UAAU,CAACI,YAAY,CAAC,CAAC,CAAC,CAAC,EAC3BJ,UAAU,CAACI,YAAY,CAAC,CAAC,CAAC,CAAC,CAAC;EAE9B,IAAIC,YAAY,EAAE;IAChB,OAAO,EAAE,CAACC,MAAM,CACdH,WAAW,CAACI,KAAK,CAAC,CAAC,EAAEJ,WAAW,CAACf,MAAM,GAAG,CAAC,CAAC,EAC5C,CAAEiB,YAAY,CAAE,EAChBD,YAAY,CAACG,KAAK,CAAC,CAAC,CAAC,CAAC;EAC1B,CAAC,MAAM;IACL,OAAO,CACLP,UAAU,CAACG,WAAW,CAAC,CAAC,CAAC,CAAC,EAC1BH,UAAU,CAACI,YAAY,CAACA,YAAY,CAAChB,MAAM,GAAG,CAAC,CAAC,CAAC,CAClD;EACH;AACF","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}