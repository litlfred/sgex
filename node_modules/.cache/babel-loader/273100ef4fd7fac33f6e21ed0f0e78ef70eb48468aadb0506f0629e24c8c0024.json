{"ast":null,"code":"import { append as svgAppend, attr as svgAttr, create as svgCreate, remove as svgRemove } from 'tiny-svg';\nimport { getDi, is } from '../../util/ModelUtil';\nimport { translate } from 'diagram-js/lib/util/SvgTransformUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/Canvas').default} Canvas\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('../../draw/PathMap').default} PathMap\n */\n\nvar MARKER_HIDDEN = 'djs-element-hidden',\n  MARKER_LABEL_HIDDEN = 'djs-label-hidden';\n\n/**\n * @param {EventBus} eventBus\n * @param {Canvas} canvas\n * @param {PathMap} pathMap\n */\nexport default function LabelEditingPreview(eventBus, canvas, pathMap) {\n  var self = this;\n  var defaultLayer = canvas.getDefaultLayer();\n  var element, absoluteElementBBox, gfx;\n  eventBus.on('directEditing.activate', function (context) {\n    var activeProvider = context.active;\n    element = activeProvider.element.label || activeProvider.element;\n\n    // text annotation\n    if (is(element, 'bpmn:TextAnnotation')) {\n      absoluteElementBBox = canvas.getAbsoluteBBox(element);\n      gfx = svgCreate('g');\n      var textPathData = pathMap.getScaledPath('TEXT_ANNOTATION', {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: element.width,\n        containerHeight: element.height,\n        position: {\n          mx: 0.0,\n          my: 0.0\n        }\n      });\n      var path = self.path = svgCreate('path');\n      svgAttr(path, {\n        d: textPathData,\n        strokeWidth: 2,\n        stroke: getStrokeColor(element)\n      });\n      svgAppend(gfx, path);\n      svgAppend(defaultLayer, gfx);\n      translate(gfx, element.x, element.y);\n    }\n    if (is(element, 'bpmn:TextAnnotation') || element.labelTarget) {\n      canvas.addMarker(element, MARKER_HIDDEN);\n    } else if (is(element, 'bpmn:Task') || is(element, 'bpmn:CallActivity') || is(element, 'bpmn:SubProcess') || is(element, 'bpmn:Participant') || is(element, 'bpmn:Lane')) {\n      canvas.addMarker(element, MARKER_LABEL_HIDDEN);\n    }\n  });\n  eventBus.on('directEditing.resize', function (context) {\n    // text annotation\n    if (is(element, 'bpmn:TextAnnotation')) {\n      var height = context.height,\n        dy = context.dy;\n      var newElementHeight = Math.max(element.height / absoluteElementBBox.height * (height + dy), 0);\n      var textPathData = pathMap.getScaledPath('TEXT_ANNOTATION', {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: element.width,\n        containerHeight: newElementHeight,\n        position: {\n          mx: 0.0,\n          my: 0.0\n        }\n      });\n      svgAttr(self.path, {\n        d: textPathData\n      });\n    }\n  });\n  eventBus.on(['directEditing.complete', 'directEditing.cancel'], function (context) {\n    var activeProvider = context.active;\n    if (activeProvider) {\n      canvas.removeMarker(activeProvider.element.label || activeProvider.element, MARKER_HIDDEN);\n      canvas.removeMarker(element, MARKER_LABEL_HIDDEN);\n    }\n    element = undefined;\n    absoluteElementBBox = undefined;\n    if (gfx) {\n      svgRemove(gfx);\n      gfx = undefined;\n    }\n  });\n}\nLabelEditingPreview.$inject = ['eventBus', 'canvas', 'pathMap'];\n\n// helpers //////////\n\nfunction getStrokeColor(element, defaultColor) {\n  var di = getDi(element);\n  return di.get('stroke') || defaultColor || 'black';\n}","map":{"version":3,"names":["append","svgAppend","attr","svgAttr","create","svgCreate","remove","svgRemove","getDi","is","translate","MARKER_HIDDEN","MARKER_LABEL_HIDDEN","LabelEditingPreview","eventBus","canvas","pathMap","self","defaultLayer","getDefaultLayer","element","absoluteElementBBox","gfx","on","context","activeProvider","active","label","getAbsoluteBBox","textPathData","getScaledPath","xScaleFactor","yScaleFactor","containerWidth","width","containerHeight","height","position","mx","my","path","d","strokeWidth","stroke","getStrokeColor","x","y","labelTarget","addMarker","dy","newElementHeight","Math","max","removeMarker","undefined","$inject","defaultColor","di","get"],"sources":["/home/runner/work/sgex/sgex/node_modules/bpmn-js/lib/features/label-editing/LabelEditingPreview.js"],"sourcesContent":["import {\n  append as svgAppend,\n  attr as svgAttr,\n  create as svgCreate,\n  remove as svgRemove\n} from 'tiny-svg';\n\nimport {\n  getDi,\n  is\n} from '../../util/ModelUtil';\n\nimport {\n  translate\n} from 'diagram-js/lib/util/SvgTransformUtil';\n\n/**\n * @typedef {import('diagram-js/lib/core/Canvas').default} Canvas\n * @typedef {import('diagram-js/lib/core/EventBus').default} EventBus\n * @typedef {import('../../draw/PathMap').default} PathMap\n */\n\nvar MARKER_HIDDEN = 'djs-element-hidden',\n    MARKER_LABEL_HIDDEN = 'djs-label-hidden';\n\n/**\n * @param {EventBus} eventBus\n * @param {Canvas} canvas\n * @param {PathMap} pathMap\n */\nexport default function LabelEditingPreview(eventBus, canvas, pathMap) {\n\n  var self = this;\n\n  var defaultLayer = canvas.getDefaultLayer();\n\n  var element, absoluteElementBBox, gfx;\n\n  eventBus.on('directEditing.activate', function(context) {\n    var activeProvider = context.active;\n\n    element = activeProvider.element.label || activeProvider.element;\n\n    // text annotation\n    if (is(element, 'bpmn:TextAnnotation')) {\n      absoluteElementBBox = canvas.getAbsoluteBBox(element);\n\n      gfx = svgCreate('g');\n\n      var textPathData = pathMap.getScaledPath('TEXT_ANNOTATION', {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: element.width,\n        containerHeight: element.height,\n        position: {\n          mx: 0.0,\n          my: 0.0\n        }\n      });\n\n      var path = self.path = svgCreate('path');\n\n      svgAttr(path, {\n        d: textPathData,\n        strokeWidth: 2,\n        stroke: getStrokeColor(element)\n      });\n\n      svgAppend(gfx, path);\n\n      svgAppend(defaultLayer, gfx);\n\n      translate(gfx, element.x, element.y);\n    }\n\n    if (is(element, 'bpmn:TextAnnotation') ||\n        element.labelTarget) {\n      canvas.addMarker(element, MARKER_HIDDEN);\n    } else if (is(element, 'bpmn:Task') ||\n               is(element, 'bpmn:CallActivity') ||\n               is(element, 'bpmn:SubProcess') ||\n               is(element, 'bpmn:Participant') ||\n               is(element, 'bpmn:Lane')) {\n      canvas.addMarker(element, MARKER_LABEL_HIDDEN);\n    }\n  });\n\n  eventBus.on('directEditing.resize', function(context) {\n\n    // text annotation\n    if (is(element, 'bpmn:TextAnnotation')) {\n      var height = context.height,\n          dy = context.dy;\n\n      var newElementHeight = Math.max(element.height / absoluteElementBBox.height * (height + dy), 0);\n\n      var textPathData = pathMap.getScaledPath('TEXT_ANNOTATION', {\n        xScaleFactor: 1,\n        yScaleFactor: 1,\n        containerWidth: element.width,\n        containerHeight: newElementHeight,\n        position: {\n          mx: 0.0,\n          my: 0.0\n        }\n      });\n\n      svgAttr(self.path, {\n        d: textPathData\n      });\n    }\n  });\n\n  eventBus.on([ 'directEditing.complete', 'directEditing.cancel' ], function(context) {\n    var activeProvider = context.active;\n\n    if (activeProvider) {\n      canvas.removeMarker(activeProvider.element.label || activeProvider.element, MARKER_HIDDEN);\n      canvas.removeMarker(element, MARKER_LABEL_HIDDEN);\n    }\n\n    element = undefined;\n    absoluteElementBBox = undefined;\n\n    if (gfx) {\n      svgRemove(gfx);\n\n      gfx = undefined;\n    }\n  });\n}\n\nLabelEditingPreview.$inject = [\n  'eventBus',\n  'canvas',\n  'pathMap'\n];\n\n\n// helpers //////////\n\nfunction getStrokeColor(element, defaultColor) {\n  var di = getDi(element);\n\n  return di.get('stroke') || defaultColor || 'black';\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}