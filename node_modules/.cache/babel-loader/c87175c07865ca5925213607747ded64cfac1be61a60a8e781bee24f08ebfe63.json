{"ast":null,"code":"import _objectSpread from\"/home/runner/work/sgex/sgex/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useCallback,useMemo,useEffect}from'react';import{Prism as SyntaxHighlighter}from'react-syntax-highlighter';import{oneLight}from'react-syntax-highlighter/dist/esm/styles/prism';import githubService from'../services/githubService';import sushiWasmService from'../services/sushiWasmService';import{WasmLoader,performanceMonitor}from'../utils/wasmLoader';import SushiErrorBoundary from'./SushiErrorBoundary';import'./SushiRunner.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const SushiRunner=_ref=>{var _repository$owner;let{repository,selectedBranch,profile,stagingFiles=[]}=_ref;const[isExpanded,setIsExpanded]=useState(false);const[isRunning,setIsRunning]=useState(false);const[showModal,setShowModal]=useState(false);const[logs,setLogs]=useState([]);const[generatedFiles,setGeneratedFiles]=useState([]);const[showFileViewer,setShowFileViewer]=useState(false);const[selectedFile,setSelectedFile]=useState(null);const[activeTab,setActiveTab]=useState('logs');const[logLevelToggles,setLogLevelToggles]=useState({info:true,success:true,warning:true,error:true});const[searchText,setSearchText]=useState('');const[sushiConfig,setSushiConfig]=useState(null);const[fshFiles,setFshFiles]=useState([]);const[includeStagingFiles,setIncludeStagingFiles]=useState(false);const[error,setError]=useState(null);const[executionMode,setExecutionMode]=useState('auto');// 'auto', 'wasm', 'javascript'\nconst[wasmSupported,setWasmSupported]=useState(false);const[wasmInitialized,setWasmInitialized]=useState(false);const owner=((_repository$owner=repository.owner)===null||_repository$owner===void 0?void 0:_repository$owner.login)||repository.full_name.split('/')[0];const repoName=repository.name;const addLog=useCallback(function(message){let type=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'info';setLogs(prev=>[...prev,{id:Date.now()+Math.random(),message,type,timestamp:new Date().toISOString()}]);},[]);// Check WebAssembly support on component mount\nuseEffect(()=>{const checkWasmSupport=async()=>{const supported=WasmLoader.isSupported();setWasmSupported(supported);if(supported){addLog('🚀 WebAssembly support detected','success');// Initialize WASM service\ntry{await sushiWasmService.initialize();setWasmInitialized(true);addLog('✅ SUSHI WebAssembly service initialized','success');}catch(err){addLog(\"\\u26A0\\uFE0F WASM initialization failed, falling back to JavaScript: \".concat(err.message),'warning');}}else{addLog('⚠️ WebAssembly not supported, using JavaScript fallback','warning');}};checkWasmSupport();},[addLog]);const fetchRepositoryFiles=async()=>{try{addLog('🔍 Fetching sushi-config.yaml...','info');let config=null;try{const configContent=await githubService.getFileContent(owner,repoName,'sushi-config.yaml',selectedBranch);config=configContent;setSushiConfig(config);addLog('✅ Found sushi-config.yaml','success');}catch(err){addLog('⚠️ sushi-config.yaml not found in repository','warning');}addLog('🔍 Scanning input/fsh directory recursively...','info');const fshFiles=[];try{// Recursively scan for FSH files\nconst scanDirectory=async function(dirPath){let depth=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;const maxDepth=5;// Prevent infinite recursion\nif(depth>maxDepth){addLog(\"\\u26A0\\uFE0F Maximum directory depth reached for \".concat(dirPath),'warning');return;}try{const contents=await githubService.getDirectoryContents(owner,repoName,dirPath,selectedBranch);for(const item of contents){if(item.type==='file'&&item.name.endsWith('.fsh')){try{const fileContent=await githubService.getFileContent(owner,repoName,item.path,selectedBranch);fshFiles.push({name:item.name,path:item.path,content:fileContent});addLog(\"\\uD83D\\uDCC4 Found \".concat(item.path),'success');}catch(err){addLog(\"\\u274C Failed to fetch \".concat(item.path,\": \").concat(err.message),'error');}}else if(item.type==='dir'){// Recursively scan subdirectories\naddLog(\"\\uD83D\\uDCC1 Scanning subdirectory: \".concat(item.path),'info');await scanDirectory(item.path,depth+1);}}}catch(err){addLog(\"\\u26A0\\uFE0F Could not scan directory \".concat(dirPath,\": \").concat(err.message),'warning');}};await scanDirectory('input/fsh');}catch(err){addLog('⚠️ input/fsh directory not found or empty','warning');}setFshFiles(fshFiles);addLog(\"\\uD83D\\uDCCA Found \".concat(fshFiles.length,\" FSH files in repository\"),'info');return{config,fshFiles};}catch(err){addLog(\"\\u274C Error fetching repository files: \".concat(err.message),'error');throw err;}};const integrateStagingFiles=repoFshFiles=>{// Start with repository files\nconst integratedFiles=[...repoFshFiles];// Override/add staging files\nstagingFiles.forEach(stagingFile=>{if(stagingFile.path&&stagingFile.path.endsWith('.fsh')){const fileName=stagingFile.path.split('/').pop();const existingIndex=integratedFiles.findIndex(f=>f.name===fileName);if(existingIndex>=0){// Override existing file\nintegratedFiles[existingIndex]=_objectSpread(_objectSpread({},integratedFiles[existingIndex]),{},{content:stagingFile.content,isFromStaging:true});addLog(\"\\uD83D\\uDD04 Overriding \".concat(fileName,\" with staging version\"),'info');}else{// Add new file from staging\nintegratedFiles.push({name:fileName,path:stagingFile.path,content:stagingFile.content,isFromStaging:true});addLog(\"\\u2795 Adding \".concat(fileName,\" from staging\"),'info');}}});return integratedFiles;};const runSushiInBrowser=async(config,files)=>{try{// Determine execution mode\nconst useWasm=executionMode==='wasm'||executionMode==='auto'&&wasmSupported&&wasmInitialized;const mode=useWasm?'WebAssembly':'JavaScript';addLog(\"\\uD83D\\uDE80 Starting FHIR Shorthand compilation using \".concat(mode,\"...\"),'info');// Start performance monitoring\nperformanceMonitor.startTiming('sushi-compilation',useWasm?'wasm':'js');let result;if(useWasm){addLog('🔧 Using WebAssembly SUSHI engine...','info');result=await runSushiWithWasm(config,files);}else{addLog('⚙️ Using JavaScript fallback engine...','info');result=await runSushiWithJavaScript(config,files);}// End performance monitoring\nconst duration=performanceMonitor.endTiming('sushi-compilation',useWasm?'wasm':'js');addLog(\"\\u23F1\\uFE0F Compilation completed in \".concat(duration.toFixed(2),\"ms using \").concat(mode),'success');return result;}catch(err){addLog(\"\\u274C Compilation failed: \".concat(err.message),'error');// If WASM failed, try JavaScript fallback\nif(executionMode==='auto'&&wasmSupported){addLog('🔄 Attempting JavaScript fallback...','info');try{return await runSushiWithJavaScript(config,files);}catch(fallbackErr){addLog(\"\\u274C JavaScript fallback also failed: \".concat(fallbackErr.message),'error');throw fallbackErr;}}throw err;}};const runSushiWithWasm=async(config,files)=>{try{addLog('📦 Preparing WebAssembly execution environment...','info');// Use the WASM service\nconst result=await sushiWasmService.runSushi(config,files);if(result.success){addLog(\"\\u2705 WebAssembly compilation successful\",'success');addLog(\"\\uD83D\\uDCCA Generated \".concat(result.files.length,\" FHIR resources\"),'success');// Convert WASM output to the expected format\nconst generatedResources=result.files.map(file=>({type:file.resourceType,filename:file.path,content:file.content,id:file.path.split('.')[0],resourceType:file.resourceType}));setGeneratedFiles(generatedResources);// Log any warnings\nresult.warnings.forEach(warning=>{addLog(\"\\u26A0\\uFE0F \".concat(warning),'warning');});return{success:true,resourceCount:result.files.length,warnings:result.warnings,errors:result.errors,generatedFiles:generatedResources};}else{// Log errors from WASM compilation\nresult.errors.forEach(error=>{addLog(\"\\u274C \".concat(error),'error');});throw new Error(\"WASM compilation failed: \".concat(result.errors.join(', ')));}}catch(err){addLog(\"\\uD83D\\uDCA5 WebAssembly execution failed: \".concat(err.message),'error');throw err;}};const runSushiWithJavaScript=async(config,files)=>{try{addLog('🚀 Starting FHIR Shorthand compilation...','info');addLog('ℹ️ Using JavaScript FSH processor with enhanced crash prevention','info');// Enhanced memory monitoring with much stricter limits\nconst checkMemoryUsage=()=>{if(performance.memory&&performance.memory.usedJSHeapSize){const memoryMB=performance.memory.usedJSHeapSize/1024/1024;const memoryLimitMB=30;// Much stricter: 30MB hard limit\nconst memoryWarningMB=20;// Warning at 20MB\nif(memoryMB>memoryLimitMB){throw new Error(\"Memory limit exceeded: \".concat(memoryMB.toFixed(1),\"MB > \").concat(memoryLimitMB,\"MB. Processing stopped to prevent browser crash.\"));}if(memoryMB>memoryWarningMB){addLog(\"\\u26A0\\uFE0F High memory usage: \".concat(memoryMB.toFixed(1),\"MB (approaching \").concat(memoryLimitMB,\"MB limit)\"),'warning');}return memoryMB;}return 0;};const initialMemory=checkMemoryUsage();addLog(\"\\uD83D\\uDCBE Initial memory usage: \".concat(initialMemory.toFixed(1),\" MB\"),'info');// Implement much stricter file size limits to prevent crashes\nconst maxFileSize=1*1024*1024;// Reduced to 1MB per file\nconst maxTotalSize=5*1024*1024;// Reduced to 5MB total\nconst maxFiles=5;// Reduced to maximum 5 files to prevent crashes\nlet totalSize=0;const validFiles=[];for(const file of files.slice(0,maxFiles)){const fileSize=file.content?file.content.length:0;if(fileSize>maxFileSize){addLog(\"\\u274C Skipping \".concat(file.name,\": too large (\").concat((fileSize/1024/1024).toFixed(1),\"MB > 1MB limit)\"),'error');continue;}if(totalSize+fileSize>maxTotalSize){addLog(\"\\u26A0\\uFE0F Stopping file processing: total size limit reached (\".concat((totalSize/1024/1024).toFixed(1),\"MB)\"),'warning');break;}totalSize+=fileSize;validFiles.push(file);}if(files.length>maxFiles){addLog(\"\\u26A0\\uFE0F Limited to first \".concat(maxFiles,\" files (\").concat(files.length,\" total) to prevent browser crashes\"),'warning');}addLog(\"\\uD83D\\uDCCA Processing \".concat(validFiles.length,\" files (\").concat((totalSize/1024/1024).toFixed(1),\"MB total)\"),'info');addLog('📦 Loading YAML processing library...','info');const yaml=await import('js-yaml');addLog('✅ Libraries loaded successfully','success');addLog('📝 Processing configuration...','info');// Prepare configuration\nlet configObj=null;if(config){try{configObj=typeof config==='string'?yaml.default.load(config):config;addLog(\"\\uD83D\\uDCCB Package: \".concat(configObj.name||'Unknown'),'success');addLog(\"\\uD83D\\uDCCB Version: \".concat(configObj.version||'Unknown'),'success');addLog(\"\\uD83D\\uDCCB FHIR Version: \".concat(configObj.fhirVersion||'Unknown'),'success');}catch(err){addLog(\"\\u26A0\\uFE0F Could not parse config: \".concat(err.message),'warning');}}else{// Create a default configuration\nconfigObj={name:'browser-generated-ig',version:'1.0.0',fhirVersion:'4.0.1',id:'browser.generated.ig',canonical:'http://example.org/fhir/ig/browser-generated',status:'draft'};addLog('📋 Using default configuration','info');}addLog(\"\\uD83D\\uDD0D Analyzing \".concat(validFiles.length,\" FSH files with crash prevention...\"),'info');const generatedResources=[];let processedCount=0;const maxResourcesPerFile=3;// Reduced from 5 to 3 resources per file\nconst maxTotalResources=15;// Reduced from 50 to 15 total resources\n// Process files one at a time to prevent memory buildup\nconst chunkSize=1;// Process 1 file at a time for maximum safety\nfor(let i=0;i<validFiles.length;i+=chunkSize){const chunk=validFiles.slice(i,i+chunkSize);for(const file of chunk){addLog(\"\\uD83D\\uDCC4 Processing \".concat(file.name,\" (\").concat(processedCount+1,\"/\").concat(validFiles.length,\")...\"),'info');// Enhanced memory check before processing each file\nconst currentMemory=checkMemoryUsage();// Stop if we're approaching memory limits (much stricter threshold)\nif(currentMemory>15){// Reduced from 80MB to 15MB threshold\naddLog(\"\\u26A0\\uFE0F Stopping processing due to high memory usage (\".concat(currentMemory.toFixed(1),\"MB)\"),'warning');break;}// Stop if we've reached resource limits\nif(generatedResources.length>=maxTotalResources){addLog(\"\\u26A0\\uFE0F Reached maximum resource limit (\".concat(maxTotalResources,\"), stopping processing\"),'warning');break;}const content=file.content;// Enhanced FSH parsing with stricter limits\nconst extractFSHDefinitions=content=>{try{const definitions={profiles:[],instances:[],valueSets:[],codeSystems:[],extensions:[]};// Check for empty or invalid content\nif(!content||typeof content!=='string'){return definitions;}// Much stricter line processing limit to prevent memory issues\nconst lines=content.split('\\n');const maxLinesToProcess=500;// Reduced from 1k to 500 lines per file\nif(lines.length>maxLinesToProcess){addLog(\"  \\u26A0\\uFE0F File is large (\".concat(lines.length,\" lines). Processing first \").concat(maxLinesToProcess,\" lines only.\"),'warning');}const linesToProcess=lines.slice(0,Math.min(lines.length,maxLinesToProcess));let currentDefinition=null;let currentType=null;let definitionCount=0;const maxDefinitionsPerFile=5;// Reduced from 10 to 5 definitions per file\nfor(let i=0;i<linesToProcess.length&&definitionCount<maxDefinitionsPerFile;i++){const line=linesToProcess[i].trim();// Skip empty lines and comments to improve performance\nif(!line||line.startsWith('//')||line.startsWith('/*')){continue;}// Detect definition types\nif(line.startsWith('Profile:')){if(definitionCount>=maxDefinitionsPerFile)break;currentType='profiles';currentDefinition={name:line.substring(8).trim(),type:'Profile',parent:null,id:null,title:null,description:null,rules:[]};definitionCount++;}else if(line.startsWith('Instance:')){if(definitionCount>=maxDefinitionsPerFile)break;currentType='instances';currentDefinition={name:line.substring(9).trim(),type:'Instance',instanceOf:null,usage:null,title:null,description:null,rules:[]};definitionCount++;}else if(line.startsWith('ValueSet:')){if(definitionCount>=maxDefinitionsPerFile)break;currentType='valueSets';currentDefinition={name:line.substring(9).trim(),type:'ValueSet',id:null,title:null,description:null,rules:[]};definitionCount++;}else if(line.startsWith('CodeSystem:')){if(definitionCount>=maxDefinitionsPerFile)break;currentType='codeSystems';currentDefinition={name:line.substring(11).trim(),type:'CodeSystem',id:null,title:null,description:null,rules:[]};definitionCount++;}else if(line.startsWith('Extension:')){if(definitionCount>=maxDefinitionsPerFile)break;currentType='extensions';currentDefinition={name:line.substring(10).trim(),type:'Extension',id:null,title:null,description:null,rules:[]};definitionCount++;}// Parse properties\nif(currentDefinition){if(line.startsWith('Parent:')){currentDefinition.parent=line.substring(7).trim();}else if(line.startsWith('InstanceOf:')){currentDefinition.instanceOf=line.substring(11).trim();}else if(line.startsWith('Usage:')){currentDefinition.usage=line.substring(6).trim();}else if(line.startsWith('Id:')){currentDefinition.id=line.substring(3).trim();}else if(line.startsWith('Title:')){currentDefinition.title=line.substring(6).trim().replace(/['\"]/g,'');}else if(line.startsWith('Description:')){currentDefinition.description=line.substring(12).trim().replace(/['\"]/g,'');}else if(line.startsWith('* ')){// Much stricter rule limit to prevent memory issues\nif(currentDefinition.rules.length<5){currentDefinition.rules.push(line.substring(2).trim());}}// If we hit a new definition or end of content, save current one\nif(line.includes(':')&&!line.startsWith('* ')&&!line.startsWith('Parent:')&&!line.startsWith('InstanceOf:')&&!line.startsWith('Usage:')&&!line.startsWith('Id:')&&!line.startsWith('Title:')&&!line.startsWith('Description:')||i===linesToProcess.length-1){if(currentDefinition&&currentType&&currentDefinition.name){definitions[currentType].push(currentDefinition);}currentDefinition=null;currentType=null;i--;// Re-process this line for the new definition\n}}}if(definitionCount>=maxDefinitionsPerFile){addLog(\"  \\u26A0\\uFE0F Limited to \".concat(maxDefinitionsPerFile,\" definitions per file to prevent browser crashes\"),'warning');}return definitions;}catch(err){addLog(\"  \\u274C Error parsing FSH content: \".concat(err.message),'error');return{profiles:[],instances:[],valueSets:[],codeSystems:[],extensions:[]};}};const definitions=extractFSHDefinitions(content);// Generate FHIR resources with strict memory management\nlet resourcesFromThisFile=0;const remainingResourceSlots=maxTotalResources-generatedResources.length;const maxFromThisFile=Math.min(maxResourcesPerFile,remainingResourceSlots);// Process profiles with strict limits\nfor(const profile of definitions.profiles.slice(0,Math.min(1,maxFromThisFile-resourcesFromThisFile))){if(resourcesFromThisFile>=maxFromThisFile)break;try{const profileId=profile.id||profile.name.toLowerCase().replace(/\\s+/g,'-');const structureDefinition={resourceType:'StructureDefinition',id:profileId,url:\"\".concat(configObj.canonical,\"/StructureDefinition/\").concat(profileId),name:profile.name,title:profile.title||profile.name,status:'draft',fhirVersion:configObj.fhirVersion||'4.0.1',kind:'resource',abstract:false,type:profile.parent==='Patient'?'Patient':profile.parent==='Observation'?'Observation':profile.parent||'DomainResource',baseDefinition:\"http://hl7.org/fhir/StructureDefinition/\".concat(profile.parent||'DomainResource'),derivation:'constraint',description:profile.description||\"Profile for \".concat(profile.name)};// Limit differential elements to prevent memory issues\nif(profile.rules.length>0){structureDefinition.differential={element:profile.rules.slice(0,2).map((rule,index)=>({// Reduced to 2 elements max\nid:\"\".concat(structureDefinition.type,\".\").concat(rule.split(' ')[0]),path:\"\".concat(structureDefinition.type,\".\").concat(rule.split(' ')[0]),short:\"Rule: \".concat(rule)}))};}generatedResources.push({type:'StructureDefinition',filename:\"StructureDefinition-\".concat(profileId,\".json\"),content:JSON.stringify(structureDefinition,null,2),id:profileId,name:profile.name,title:structureDefinition.title,url:structureDefinition.url});resourcesFromThisFile++;addLog(\"  \\uD83D\\uDCCA Generated StructureDefinition: \".concat(profile.name),'success');}catch(err){addLog(\"  \\u274C Error generating StructureDefinition for \".concat(profile.name,\": \").concat(err.message),'error');}}// Process instances with strict limits\nfor(const instance of definitions.instances.slice(0,Math.min(1,maxFromThisFile-resourcesFromThisFile))){if(resourcesFromThisFile>=maxFromThisFile)break;try{const instanceId=instance.name.toLowerCase().replace(/\\s+/g,'-');const resourceType=instance.instanceOf==='Patient'?'Patient':instance.instanceOf==='Observation'?'Observation':'Patient';// Default fallback\nconst fhirInstance={resourceType:resourceType,id:instanceId,meta:{profile:instance.instanceOf?[\"\".concat(configObj.canonical,\"/StructureDefinition/\").concat(instance.instanceOf)]:undefined}};// Add minimal properties to reduce memory usage\nif(resourceType==='Patient'){fhirInstance.name=[{family:instance.name.split(' ').pop(),given:instance.name.split(' ').slice(0,-1)}];}generatedResources.push({type:resourceType,filename:\"\".concat(instanceId,\".json\"),content:JSON.stringify(fhirInstance,null,2),id:instanceId,resourceType:resourceType});resourcesFromThisFile++;addLog(\"  \\uD83D\\uDCCA Generated \".concat(resourceType,\" instance: \").concat(instance.name),'success');}catch(err){addLog(\"  \\u274C Error generating instance for \".concat(instance.name,\": \").concat(err.message),'error');}}// Process ValueSets and CodeSystems with even stricter limits\nfor(const vs of definitions.valueSets.slice(0,Math.min(1,maxFromThisFile-resourcesFromThisFile))){if(resourcesFromThisFile>=maxFromThisFile)break;try{const vsId=vs.id||vs.name.toLowerCase().replace(/\\s+/g,'-');const valueSet={resourceType:'ValueSet',id:vsId,url:\"\".concat(configObj.canonical,\"/ValueSet/\").concat(vsId),name:vs.name,title:vs.title||vs.name,status:'draft',description:vs.description||\"ValueSet for \".concat(vs.name),compose:{include:[{system:'http://example.org/codes',concept:[{code:'example1',display:'Example Code 1'}]}]}};generatedResources.push({type:'ValueSet',filename:\"ValueSet-\".concat(vsId,\".json\"),content:JSON.stringify(valueSet,null,2),id:vsId,name:vs.name,title:valueSet.title,url:valueSet.url});resourcesFromThisFile++;addLog(\"  \\uD83D\\uDCCA Generated ValueSet: \".concat(vs.name),'success');}catch(err){addLog(\"  \\u274C Error generating ValueSet for \".concat(vs.name,\": \").concat(err.message),'error');}}if(file.isFromStaging){addLog(\"  \\uD83C\\uDFD7\\uFE0F File from staging ground\",'info');}processedCount++;// Clear file content from memory immediately after processing\nfile.content=null;// Force garbage collection more frequently\nif(window.gc&&typeof window.gc==='function'){window.gc();}}// Yield control for longer periods between chunks to prevent blocking\nawait new Promise(resolve=>setTimeout(resolve,200));// Increased to 200ms delay between files\n// Enhanced memory monitoring after each file\nconst memoryAfterChunk=checkMemoryUsage();addLog(\"\\uD83D\\uDCBE Memory after file: \".concat(memoryAfterChunk.toFixed(1),\" MB (processed \").concat(Math.min(i+chunkSize,validFiles.length),\"/\").concat(validFiles.length,\")\"),'info');// Break if memory is getting too high (much lower threshold)\nif(memoryAfterChunk>20){addLog(\"\\u26A0\\uFE0F Stopping processing due to high memory usage\",'warning');break;}}// Set generated files\nsetGeneratedFiles(generatedResources);// Final memory check\nconst finalMemory=checkMemoryUsage();addLog(\"\\uD83D\\uDCBE Final memory usage: \".concat(finalMemory.toFixed(1),\" MB\"),'info');addLog('✨ FSH compilation completed with crash prevention!','success');addLog(\"\\uD83D\\uDCE6 Generated \".concat(generatedResources.length,\" FHIR resources total (limited for stability)\"),'success');// Check for staging files\nconst stagingCount=validFiles.filter(f=>f.isFromStaging).length;if(stagingCount>0){addLog(\"\\uD83C\\uDFD7\\uFE0F \".concat(stagingCount,\" file(s) from staging ground included\"),'info');}// Handle edge cases\nif(validFiles.length===0){addLog('⚠️ No FSH files found or all files too large to process safely','warning');}if(!config){addLog('⚠️ No sushi-config.yaml found - used default configuration','warning');}// Safety warnings\nif(generatedResources.length>=maxTotalResources){addLog(\"\\u26A0\\uFE0F Output limited to \".concat(maxTotalResources,\" resources to prevent browser crashes\"),'warning');}if(validFiles.length<files.length){addLog(\"\\u26A0\\uFE0F \".concat(files.length-validFiles.length,\" files skipped due to size limits\"),'warning');}return{success:true,resourceCount:generatedResources.length,warnings:[],errors:[],generatedFiles:generatedResources};}catch(err){addLog(\"\\u274C Compilation failed: \".concat(err.message),'error');// Log additional error details if available\nif(err.stack){console.error('Compilation error stack:',err.stack);}throw err;}};const handleRunSushi=async function(){let withStagingFiles=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;setIsRunning(true);setShowModal(true);setLogs([]);setGeneratedFiles([]);setActiveTab('logs');setError(null);setIncludeStagingFiles(withStagingFiles);try{addLog('🏁 Starting SUSHI client-side execution...','info');if(withStagingFiles&&stagingFiles.length>0){addLog(\"\\uD83D\\uDDC2\\uFE0F Including \".concat(stagingFiles.length,\" staging files\"),'info');}// Fetch repository files\nconst{config,fshFiles:repoFiles}=await fetchRepositoryFiles();// Integrate staging files if requested\nconst finalFiles=withStagingFiles?integrateStagingFiles(repoFiles):repoFiles;if(withStagingFiles){addLog(\"\\uD83D\\uDCCA Final file count: \".concat(finalFiles.length,\" FSH files\"),'info');}// Run SUSHI\nawait runSushiInBrowser(config,finalFiles);addLog('🎉 SUSHI execution completed successfully!','success');}catch(err){setError(err.message);addLog(\"\\uD83D\\uDCA5 Execution failed: \".concat(err.message),'error');}finally{setIsRunning(false);}};const toggleLogLevel=useCallback(level=>{setLogLevelToggles(prev=>_objectSpread(_objectSpread({},prev),{},{[level]:!prev[level]}));},[]);const clearLogs=useCallback(()=>{setLogs([]);setGeneratedFiles([]);setActiveTab('logs');setLogLevelToggles({info:true,success:true,warning:true,error:true});setSearchText('');},[]);const copyAllLogs=useCallback(async()=>{const logText=logs.map(log=>\"[\".concat(new Date(log.timestamp).toLocaleTimeString(),\"] \").concat(log.message)).join('\\n');try{await navigator.clipboard.writeText(logText);}catch(err){console.error('Failed to copy logs:',err);}},[logs]);const copyLogMessage=useCallback(async message=>{try{await navigator.clipboard.writeText(message);}catch(err){console.error('Failed to copy log message:',err);}},[]);// Function to detect and create links for files mentioned in log messages\nconst parseLogMessage=useCallback((message,logId)=>{// More precise regex to find valid file paths - must be preceded by whitespace or start of line\n// and must be a complete path (not part of a longer word)\nconst filePathRegex=/(?:^|\\s)((?:input\\/fsh\\/[a-zA-Z0-9_/-]*\\/)?[a-zA-Z0-9_.-]+\\.(?:fsh|yaml|yml|json))(?=\\s|$|[.,!])/g;const matches=[...message.matchAll(filePathRegex)];if(matches.length===0){return/*#__PURE__*/_jsx(\"span\",{children:message});}let lastIndex=0;const elements=[];let elementCounter=0;// Add counter for unique keys\nmatches.forEach((match,index)=>{const fullMatch=match[0];const filePath=match[1];const matchIndex=match.index;// Add text before the match\nif(matchIndex>lastIndex){elements.push(/*#__PURE__*/_jsx(\"span\",{children:message.substring(lastIndex,matchIndex)},\"\".concat(logId,\"-text-\").concat(elementCounter++)));}// Add the leading whitespace if present\nconst leadingWhitespace=fullMatch.substring(0,fullMatch.indexOf(filePath));if(leadingWhitespace){elements.push(/*#__PURE__*/_jsx(\"span\",{children:leadingWhitespace},\"\".concat(logId,\"-ws-\").concat(elementCounter++)));}// Determine link type based on file location and validate the file exists\nconst createFileLink=(path,text,keyIndex)=>{// Check if file exists in our known file lists to avoid creating invalid links\nconst isKnownRepoFile=fshFiles.some(f=>f.path===path);const isFromStaging=stagingFiles.some(f=>f.path&&(f.path===path||f.path.endsWith(\"/\".concat(path.split('/').pop()))));const isSushiConfig=path==='sushi-config.yaml';// Only create links for files we know exist\nif(!isKnownRepoFile&&!isFromStaging&&!isSushiConfig){// File not found in our known files, return as plain text\nreturn/*#__PURE__*/_jsx(\"span\",{className:\"file-mention\",children:text},\"\".concat(logId,\"-text-\").concat(keyIndex));}if(isFromStaging){// Link to staging ground\nreturn/*#__PURE__*/_jsxs(\"span\",{className:\"file-link staging-link\",title:\"File from Staging Ground\",children:[\"\\uD83D\\uDCDD \",text]},\"\".concat(logId,\"-staging-\").concat(keyIndex));}else if(path.startsWith('input/fsh/')){// Determine DAK component based on directory structure\nconst getDakComponentLink=fshPath=>{const pathParts=fshPath.split('/');if(pathParts.length>2){const subDir=pathParts[2];switch(subDir){case'profiles':return{component:'Profiles',icon:'👤'};case'examples':return{component:'Examples',icon:'📋'};case'valuesets':return{component:'ValueSets',icon:'📊'};case'codesystems':return{component:'CodeSystems',icon:'🔢'};case'extensions':return{component:'Extensions',icon:'🔧'};default:return{component:'FSH Files',icon:'📄'};}}return{component:'FSH Files',icon:'📄'};};const dakInfo=getDakComponentLink(path);return/*#__PURE__*/_jsxs(\"span\",{className:\"file-link dak-link\",title:\"View in DAK \".concat(dakInfo.component),children:[dakInfo.icon,\" \",text]},\"\".concat(logId,\"-dak-\").concat(keyIndex));}else{// Link to GitHub source for valid repository files\nconst githubUrl=\"https://github.com/\".concat(owner,\"/\").concat(repoName,\"/blob/\").concat(selectedBranch,\"/\").concat(path);return/*#__PURE__*/_jsxs(\"a\",{href:githubUrl,target:\"_blank\",rel:\"noopener noreferrer\",className:\"file-link github-link\",title:\"Open in GitHub\",children:[\"\\uD83D\\uDD17 \",text]},\"\".concat(logId,\"-github-\").concat(keyIndex));}};elements.push(createFileLink(filePath,filePath,elementCounter++));lastIndex=matchIndex+fullMatch.length;});// Add remaining text\nif(lastIndex<message.length){elements.push(/*#__PURE__*/_jsx(\"span\",{children:message.substring(lastIndex)},\"\".concat(logId,\"-text-end-\").concat(elementCounter++)));}return/*#__PURE__*/_jsx(\"span\",{children:elements});},[owner,repoName,selectedBranch,stagingFiles,fshFiles]);// Optimized filtered logs with useMemo to prevent unnecessary re-computations\nconst filteredLogs=useMemo(()=>{return logs.filter(log=>{// Filter by log level toggles\nconst isLevelEnabled=logLevelToggles[log.type];// Filter by search text\nconst matchesSearch=searchText===''||log.message.toLowerCase().includes(searchText.toLowerCase());return isLevelEnabled&&matchesSearch;});},[logs,logLevelToggles,searchText]);// Separate component for log controls to prevent re-renders\nconst LogControls=/*#__PURE__*/React.memo(_ref2=>{let{logLevelToggles,onToggleLogLevel,searchText,onSearchChange,filteredCount,totalCount}=_ref2;const handleSearchChange=useCallback(e=>{onSearchChange(e.target.value);},[onSearchChange]);return/*#__PURE__*/_jsxs(\"div\",{className:\"log-controls\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"log-level-toggles\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"toggle-group-label\",children:\"Show levels:\"}),/*#__PURE__*/_jsx(\"div\",{className:\"toggle-buttons\",children:[{key:'info',label:'Info',icon:'ℹ️'},{key:'success',label:'Success',icon:'✅'},{key:'warning',label:'Warning',icon:'⚠️'},{key:'error',label:'Error',icon:'❌'}].map(_ref3=>{let{key,label,icon}=_ref3;return/*#__PURE__*/_jsxs(\"button\",{className:\"log-toggle-btn \".concat(logLevelToggles[key]?'active':'inactive'),onClick:()=>onToggleLogLevel(key),title:\"Toggle \".concat(label,\" messages\"),children:[icon,\" \",label]},key);})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"log-search-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"log-search\",children:\"Search logs:\"}),/*#__PURE__*/_jsx(\"input\",{id:\"log-search\",type:\"text\",value:searchText,onChange:handleSearchChange,placeholder:\"Search log messages...\",className:\"log-search-input\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"log-stats\",children:searchText||Object.values(logLevelToggles).some(v=>!v)?/*#__PURE__*/_jsxs(\"span\",{children:[\"Showing \",filteredCount,\" of \",totalCount,\" logs\"]}):/*#__PURE__*/_jsxs(\"span\",{children:[totalCount,\" logs\"]})})]});});const handleSearchChange=useCallback(value=>{setSearchText(value);},[]);const viewFile=useCallback(file=>{setSelectedFile(file);setShowFileViewer(true);},[]);const closeFileViewer=useCallback(()=>{setShowFileViewer(false);setSelectedFile(null);},[]);const getResourceTypeIcon=type=>{switch(type){case'StructureDefinition':return'🏗️';case'Patient':return'👤';case'ValueSet':return'📊';case'CodeSystem':return'🔢';case'Organization':return'🏢';case'Practitioner':return'👨‍⚕️';case'Observation':return'📋';default:return'📄';}};const FileViewerModal=()=>{if(!selectedFile)return null;return/*#__PURE__*/_jsx(\"div\",{className:\"file-viewer-overlay\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"file-viewer-modal\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"file-viewer-header\",children:[/*#__PURE__*/_jsxs(\"h3\",{children:[getResourceTypeIcon(selectedFile.type),\" \",selectedFile.filename]}),/*#__PURE__*/_jsxs(\"div\",{className:\"file-viewer-actions\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigator.clipboard.writeText(selectedFile.content),className:\"copy-file-btn\",title:\"Copy file content to clipboard\",children:\"\\uD83D\\uDCCB Copy\"}),/*#__PURE__*/_jsx(\"button\",{onClick:closeFileViewer,className:\"close-file-viewer-btn\",children:\"\\u2715\"})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"file-viewer-content\",children:/*#__PURE__*/_jsx(SyntaxHighlighter,{language:\"json\",style:oneLight,showLineNumbers:true,wrapLines:true,customStyle:{fontSize:'14px',lineHeight:'1.4',maxHeight:'70vh',overflow:'auto'},children:selectedFile.content})}),/*#__PURE__*/_jsx(\"div\",{className:\"file-viewer-footer\",children:/*#__PURE__*/_jsxs(\"span\",{className:\"file-info\",children:[\"Resource Type: \",selectedFile.type,\" | Size: \",(selectedFile.content.length/1024).toFixed(1),\" KB\"]})})]})});};const LogModal=()=>/*#__PURE__*/_jsx(\"div\",{className:\"sushi-modal-overlay\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"sushi-modal\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"sushi-modal-header\",children:[/*#__PURE__*/_jsxs(\"h3\",{children:[\"\\uD83C\\uDF63 SUSHI Client-Side Execution\",includeStagingFiles&&/*#__PURE__*/_jsx(\"span\",{className:\"staging-badge\",children:\"+ Staging\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"modal-actions\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:copyAllLogs,className:\"copy-all-btn\",disabled:logs.length===0,title:\"Copy all logs to clipboard\",children:\"\\uD83D\\uDCCB Copy All\"}),/*#__PURE__*/_jsx(\"button\",{onClick:clearLogs,className:\"clear-logs-btn\",disabled:isRunning,children:\"\\uD83D\\uDDD1\\uFE0F Clear\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowModal(false),className:\"close-modal-btn\",children:\"\\u2715\"})]})]}),/*#__PURE__*/_jsx(LogControls,{logLevelToggles:logLevelToggles,onToggleLogLevel:toggleLogLevel,searchText:searchText,onSearchChange:handleSearchChange,filteredCount:filteredLogs.length,totalCount:logs.length}),generatedFiles.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"modal-section-toggle\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"toggle-options\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"toggle-btn \".concat(activeTab==='logs'?'active':''),onClick:()=>setActiveTab('logs'),children:\"\\uD83D\\uDCC4 Logs & Messages\"}),/*#__PURE__*/_jsx(\"button\",{className:\"toggle-btn \".concat(activeTab==='files'?'active':''),onClick:()=>setActiveTab('files'),children:\"\\uD83D\\uDCE6 Generated Resources\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"section-info\",children:activeTab==='logs'?/*#__PURE__*/_jsxs(\"span\",{className:\"info-text\",children:[logs.length,\" log entries \\u2022 Use toggles to filter by level\"]}):/*#__PURE__*/_jsxs(\"span\",{className:\"info-text\",children:[generatedFiles.length,\" FHIR resources generated\"]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"sushi-modal-content\",children:[(activeTab==='logs'||generatedFiles.length===0)&&/*#__PURE__*/_jsxs(\"div\",{className:\"log-container\",children:[filteredLogs.map(log=>/*#__PURE__*/_jsxs(\"div\",{className:\"log-entry log-\".concat(log.type),children:[/*#__PURE__*/_jsx(\"span\",{className:\"log-timestamp\",children:new Date(log.timestamp).toLocaleTimeString()}),/*#__PURE__*/_jsx(\"span\",{className:\"log-message\",children:parseLogMessage(log.message,log.id)}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>copyLogMessage(log.message),className:\"copy-log-btn\",title:\"Copy this message to clipboard\",children:\"\\uD83D\\uDCCB\"})]},log.id)),isRunning&&/*#__PURE__*/_jsxs(\"div\",{className:\"log-entry log-running\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"log-timestamp\",children:new Date().toLocaleTimeString()}),/*#__PURE__*/_jsxs(\"span\",{className:\"log-message\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"spinner\",children:\"\\u23F3\"}),\" Processing...\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"copy-log-btn-placeholder\"})]}),filteredLogs.length===0&&!isRunning&&logs.length>0&&/*#__PURE__*/_jsx(\"div\",{className:\"log-placeholder\",children:\"No logs match the current filter criteria...\"}),logs.length===0&&!isRunning&&/*#__PURE__*/_jsx(\"div\",{className:\"log-placeholder\",children:\"Logs will appear here during SUSHI execution...\"}),error&&/*#__PURE__*/_jsxs(\"div\",{className:\"error-summary\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"\\u274C Execution Error\"}),/*#__PURE__*/_jsx(\"p\",{children:error})]})]}),activeTab==='files'&&generatedFiles.length>0&&/*#__PURE__*/_jsx(\"div\",{className:\"generated-files-container\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"generated-files-section\",children:[/*#__PURE__*/_jsxs(\"h4\",{children:[\"\\uD83D\\uDCE6 Generated FHIR Resources (\",generatedFiles.length,\")\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"generated-files-grid\",children:generatedFiles.map((file,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"generated-file-card\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"file-card-header\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"file-icon\",children:getResourceTypeIcon(file.type)}),/*#__PURE__*/_jsx(\"span\",{className:\"file-name\",children:file.filename})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"file-card-details\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"file-type\",children:file.type}),/*#__PURE__*/_jsxs(\"span\",{className:\"file-size\",children:[(file.content.length/1024).toFixed(1),\" KB\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"file-card-actions\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>viewFile(file),className:\"view-file-btn\",title:\"View resource content\",children:\"\\uD83D\\uDC41\\uFE0F View\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigator.clipboard.writeText(file.content),className:\"copy-file-btn\",title:\"Copy to clipboard\",children:\"\\uD83D\\uDCCB\"})]})]},index))}),/*#__PURE__*/_jsxs(\"div\",{className:\"fhir-viewer-suggestions\",children:[/*#__PURE__*/_jsx(\"h5\",{children:\"\\uD83D\\uDCA1 Enhanced FHIR Viewing Options\"}),/*#__PURE__*/_jsx(\"p\",{children:\"For better FHIR resource visualization, consider these viewers:\"}),/*#__PURE__*/_jsxs(\"ul\",{children:[/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"FHIR Tree Viewer:\"}),\" \",/*#__PURE__*/_jsx(\"code\",{children:\"npm install @types/fhir\"}),\" + custom tree renderer\"]}),/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"FHIR Path Viewer:\"}),\" \",/*#__PURE__*/_jsx(\"code\",{children:\"npm install fhirpath\"}),\" for interactive querying\"]}),/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"FHIR UI:\"}),\" \",/*#__PURE__*/_jsx(\"code\",{children:\"npm install @asymmetrik/fhir-kit-client\"}),\" with UI components\"]}),/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"HL7 FHIR Viewer:\"}),\" Integration with official HL7 FHIR viewers\"]})]})]})]})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"sushi-modal-footer\",children:/*#__PURE__*/_jsx(\"div\",{className:\"execution-info\",children:isRunning?/*#__PURE__*/_jsx(\"span\",{className:\"status-running\",children:\"\\uD83D\\uDD04 Running SUSHI...\"}):logs.length>0?/*#__PURE__*/_jsx(\"span\",{className:\"status-complete\",children:\"\\u2705 Execution complete\"}):/*#__PURE__*/_jsx(\"span\",{className:\"status-ready\",children:\"\\uD83C\\uDF63 Ready to run SUSHI\"})})})]})});return/*#__PURE__*/_jsx(SushiErrorBoundary,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"sushi-runner-section\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"sushi-status-bar \".concat(isExpanded?'expanded':'collapsed'),onClick:()=>setIsExpanded(!isExpanded),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"status-bar-header\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"status-icon\",children:\"\\uD83C\\uDF63\"}),/*#__PURE__*/_jsx(\"span\",{className:\"status-title\",children:\"SUSHI (FHIR Shorthand)\"}),/*#__PURE__*/_jsx(\"span\",{className:\"expand-icon\",children:isExpanded?'▼':'▶'})]}),!isExpanded&&/*#__PURE__*/_jsx(\"div\",{className:\"status-summary\",children:\"Client-side FHIR Implementation Guide compilation\"})]}),isExpanded&&/*#__PURE__*/_jsxs(\"div\",{className:\"sushi-controls\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"sushi-description\",children:/*#__PURE__*/_jsx(\"p\",{children:\"Run SUSHI (FHIR Shorthand) compilation directly in your browser to generate FHIR Implementation Guide resources from FSH files.\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"execution-options\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"execution-mode-selector\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"\\u2699\\uFE0F Execution Mode\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"mode-options\",children:[/*#__PURE__*/_jsxs(\"label\",{className:\"mode-option\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"radio\",name:\"executionMode\",value:\"auto\",checked:executionMode==='auto',onChange:e=>setExecutionMode(e.target.value)}),/*#__PURE__*/_jsxs(\"span\",{className:\"mode-label\",children:[\"\\uD83E\\uDD16 Auto (WebAssembly when available)\",wasmSupported&&wasmInitialized&&/*#__PURE__*/_jsx(\"span\",{className:\"wasm-badge\",children:\"WASM Ready\"})]})]}),wasmSupported&&/*#__PURE__*/_jsxs(\"label\",{className:\"mode-option\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"radio\",name:\"executionMode\",value:\"wasm\",checked:executionMode==='wasm',onChange:e=>setExecutionMode(e.target.value),disabled:!wasmInitialized}),/*#__PURE__*/_jsxs(\"span\",{className:\"mode-label\",children:[\"\\uD83D\\uDE80 WebAssembly (High Performance)\",!wasmInitialized&&/*#__PURE__*/_jsx(\"span\",{className:\"loading-badge\",children:\"Initializing...\"})]})]}),/*#__PURE__*/_jsxs(\"label\",{className:\"mode-option\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"radio\",name:\"executionMode\",value:\"javascript\",checked:executionMode==='javascript',onChange:e=>setExecutionMode(e.target.value)}),/*#__PURE__*/_jsx(\"span\",{className:\"mode-label\",children:\"\\u2699\\uFE0F JavaScript (Fallback)\"})]})]}),!wasmSupported&&/*#__PURE__*/_jsx(\"div\",{className:\"wasm-not-supported\",children:/*#__PURE__*/_jsx(\"p\",{children:\"\\u26A0\\uFE0F WebAssembly is not supported in this browser. JavaScript fallback will be used.\"})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"option-group\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"\\uD83D\\uDCC2 Repository Files Only\"}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Compile using sushi-config.yaml and input/fsh files from the GitHub repository (\",selectedBranch,\" branch).\"]}),/*#__PURE__*/_jsx(\"button\",{className:\"run-sushi-btn primary\",onClick:()=>handleRunSushi(false),disabled:isRunning,children:isRunning?'⏳ Running...':'🚀 Run SUSHI'})]}),stagingFiles.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"option-group\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"\\uD83C\\uDFD7\\uFE0F Repository + Staging Files\"}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Compile using repository files, with staging ground files (\",stagingFiles.length,\" files) overriding any repository files with the same name.\"]}),/*#__PURE__*/_jsx(\"button\",{className:\"run-sushi-btn secondary\",onClick:()=>handleRunSushi(true),disabled:isRunning,children:isRunning?'⏳ Running...':'🚀 Run SUSHI + Staging'})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"sushi-status\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"status-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"label\",children:\"Execution:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"value\",children:wasmSupported&&wasmInitialized?'🚀 WebAssembly Ready':'⚙️ JavaScript'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"status-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"label\",children:\"Config:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"value\",children:sushiConfig?'✅ Found':'❓ Unknown'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"status-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"label\",children:\"FSH Files:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"value\",children:[fshFiles.length,\" in repository\"]})]}),stagingFiles.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"status-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"label\",children:\"Staging:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"value\",children:[stagingFiles.filter(f=>f.path&&f.path.endsWith('.fsh')).length,\" FSH files\"]})]})]})]}),showModal&&/*#__PURE__*/_jsx(LogModal,{}),showFileViewer&&/*#__PURE__*/_jsx(FileViewerModal,{})]})});};export default SushiRunner;","map":{"version":3,"names":["React","useState","useCallback","useMemo","useEffect","Prism","SyntaxHighlighter","oneLight","githubService","sushiWasmService","WasmLoader","performanceMonitor","SushiErrorBoundary","jsx","_jsx","jsxs","_jsxs","SushiRunner","_ref","_repository$owner","repository","selectedBranch","profile","stagingFiles","isExpanded","setIsExpanded","isRunning","setIsRunning","showModal","setShowModal","logs","setLogs","generatedFiles","setGeneratedFiles","showFileViewer","setShowFileViewer","selectedFile","setSelectedFile","activeTab","setActiveTab","logLevelToggles","setLogLevelToggles","info","success","warning","error","searchText","setSearchText","sushiConfig","setSushiConfig","fshFiles","setFshFiles","includeStagingFiles","setIncludeStagingFiles","setError","executionMode","setExecutionMode","wasmSupported","setWasmSupported","wasmInitialized","setWasmInitialized","owner","login","full_name","split","repoName","name","addLog","message","type","arguments","length","undefined","prev","id","Date","now","Math","random","timestamp","toISOString","checkWasmSupport","supported","isSupported","initialize","err","concat","fetchRepositoryFiles","config","configContent","getFileContent","scanDirectory","dirPath","depth","maxDepth","contents","getDirectoryContents","item","endsWith","fileContent","path","push","content","integrateStagingFiles","repoFshFiles","integratedFiles","forEach","stagingFile","fileName","pop","existingIndex","findIndex","f","_objectSpread","isFromStaging","runSushiInBrowser","files","useWasm","mode","startTiming","result","runSushiWithWasm","runSushiWithJavaScript","duration","endTiming","toFixed","fallbackErr","runSushi","generatedResources","map","file","resourceType","filename","warnings","resourceCount","errors","Error","join","checkMemoryUsage","performance","memory","usedJSHeapSize","memoryMB","memoryLimitMB","memoryWarningMB","initialMemory","maxFileSize","maxTotalSize","maxFiles","totalSize","validFiles","slice","fileSize","yaml","configObj","default","load","version","fhirVersion","canonical","status","processedCount","maxResourcesPerFile","maxTotalResources","chunkSize","i","chunk","currentMemory","extractFSHDefinitions","definitions","profiles","instances","valueSets","codeSystems","extensions","lines","maxLinesToProcess","linesToProcess","min","currentDefinition","currentType","definitionCount","maxDefinitionsPerFile","line","trim","startsWith","substring","parent","title","description","rules","instanceOf","usage","replace","includes","resourcesFromThisFile","remainingResourceSlots","maxFromThisFile","profileId","toLowerCase","structureDefinition","url","kind","abstract","baseDefinition","derivation","differential","element","rule","index","short","JSON","stringify","instance","instanceId","fhirInstance","meta","family","given","vs","vsId","valueSet","compose","include","system","concept","code","display","window","gc","Promise","resolve","setTimeout","memoryAfterChunk","finalMemory","stagingCount","filter","stack","console","handleRunSushi","withStagingFiles","repoFiles","finalFiles","toggleLogLevel","level","clearLogs","copyAllLogs","logText","log","toLocaleTimeString","navigator","clipboard","writeText","copyLogMessage","parseLogMessage","logId","filePathRegex","matches","matchAll","children","lastIndex","elements","elementCounter","match","fullMatch","filePath","matchIndex","leadingWhitespace","indexOf","createFileLink","text","keyIndex","isKnownRepoFile","some","isSushiConfig","className","getDakComponentLink","fshPath","pathParts","subDir","component","icon","dakInfo","githubUrl","href","target","rel","filteredLogs","isLevelEnabled","matchesSearch","LogControls","memo","_ref2","onToggleLogLevel","onSearchChange","filteredCount","totalCount","handleSearchChange","e","value","key","label","_ref3","onClick","htmlFor","onChange","placeholder","Object","values","v","viewFile","closeFileViewer","getResourceTypeIcon","FileViewerModal","language","style","showLineNumbers","wrapLines","customStyle","fontSize","lineHeight","maxHeight","overflow","LogModal","disabled","checked"],"sources":["/home/runner/work/sgex/sgex/src/components/SushiRunner.js"],"sourcesContent":["import React, { useState, useCallback, useMemo, useEffect } from 'react';\nimport { Prism as SyntaxHighlighter } from 'react-syntax-highlighter';\nimport { oneLight } from 'react-syntax-highlighter/dist/esm/styles/prism';\nimport githubService from '../services/githubService';\nimport sushiWasmService from '../services/sushiWasmService';\nimport { WasmLoader, performanceMonitor } from '../utils/wasmLoader';\nimport SushiErrorBoundary from './SushiErrorBoundary';\nimport './SushiRunner.css';\n\nconst SushiRunner = ({ repository, selectedBranch, profile, stagingFiles = [] }) => {\n  const [isExpanded, setIsExpanded] = useState(false);\n  const [isRunning, setIsRunning] = useState(false);\n  const [showModal, setShowModal] = useState(false);\n  const [logs, setLogs] = useState([]);\n  const [generatedFiles, setGeneratedFiles] = useState([]);\n  const [showFileViewer, setShowFileViewer] = useState(false);\n  const [selectedFile, setSelectedFile] = useState(null);\n  const [activeTab, setActiveTab] = useState('logs');\n  const [logLevelToggles, setLogLevelToggles] = useState({\n    info: true,\n    success: true,\n    warning: true,\n    error: true\n  });\n  const [searchText, setSearchText] = useState('');\n  const [sushiConfig, setSushiConfig] = useState(null);\n  const [fshFiles, setFshFiles] = useState([]);\n  const [includeStagingFiles, setIncludeStagingFiles] = useState(false);\n  const [error, setError] = useState(null);\n  const [executionMode, setExecutionMode] = useState('auto'); // 'auto', 'wasm', 'javascript'\n  const [wasmSupported, setWasmSupported] = useState(false);\n  const [wasmInitialized, setWasmInitialized] = useState(false);\n\n  const owner = repository.owner?.login || repository.full_name.split('/')[0];\n  const repoName = repository.name;\n\n  const addLog = useCallback((message, type = 'info') => {\n    setLogs(prev => [...prev, {\n      id: Date.now() + Math.random(),\n      message,\n      type,\n      timestamp: new Date().toISOString()\n    }]);\n  }, []);\n\n  // Check WebAssembly support on component mount\n  useEffect(() => {\n    const checkWasmSupport = async () => {\n      const supported = WasmLoader.isSupported();\n      setWasmSupported(supported);\n      \n      if (supported) {\n        addLog('🚀 WebAssembly support detected', 'success');\n        \n        // Initialize WASM service\n        try {\n          await sushiWasmService.initialize();\n          setWasmInitialized(true);\n          addLog('✅ SUSHI WebAssembly service initialized', 'success');\n        } catch (err) {\n          addLog(`⚠️ WASM initialization failed, falling back to JavaScript: ${err.message}`, 'warning');\n        }\n      } else {\n        addLog('⚠️ WebAssembly not supported, using JavaScript fallback', 'warning');\n      }\n    };\n\n    checkWasmSupport();\n  }, [addLog]);\n\n  const fetchRepositoryFiles = async () => {\n    try {\n      addLog('🔍 Fetching sushi-config.yaml...', 'info');\n      \n      let config = null;\n      try {\n        const configContent = await githubService.getFileContent(\n          owner, \n          repoName, \n          'sushi-config.yaml', \n          selectedBranch\n        );\n        config = configContent;\n        setSushiConfig(config);\n        addLog('✅ Found sushi-config.yaml', 'success');\n      } catch (err) {\n        addLog('⚠️ sushi-config.yaml not found in repository', 'warning');\n      }\n\n      addLog('🔍 Scanning input/fsh directory recursively...', 'info');\n      \n      const fshFiles = [];\n      try {\n        // Recursively scan for FSH files\n        const scanDirectory = async (dirPath, depth = 0) => {\n          const maxDepth = 5; // Prevent infinite recursion\n          if (depth > maxDepth) {\n            addLog(`⚠️ Maximum directory depth reached for ${dirPath}`, 'warning');\n            return;\n          }\n\n          try {\n            const contents = await githubService.getDirectoryContents(\n              owner,\n              repoName,\n              dirPath,\n              selectedBranch\n            );\n            \n            for (const item of contents) {\n              if (item.type === 'file' && item.name.endsWith('.fsh')) {\n                try {\n                  const fileContent = await githubService.getFileContent(\n                    owner,\n                    repoName,\n                    item.path,\n                    selectedBranch\n                  );\n                  fshFiles.push({\n                    name: item.name,\n                    path: item.path,\n                    content: fileContent\n                  });\n                  addLog(`📄 Found ${item.path}`, 'success');\n                } catch (err) {\n                  addLog(`❌ Failed to fetch ${item.path}: ${err.message}`, 'error');\n                }\n              } else if (item.type === 'dir') {\n                // Recursively scan subdirectories\n                addLog(`📁 Scanning subdirectory: ${item.path}`, 'info');\n                await scanDirectory(item.path, depth + 1);\n              }\n            }\n          } catch (err) {\n            addLog(`⚠️ Could not scan directory ${dirPath}: ${err.message}`, 'warning');\n          }\n        };\n\n        await scanDirectory('input/fsh');\n      } catch (err) {\n        addLog('⚠️ input/fsh directory not found or empty', 'warning');\n      }\n\n      setFshFiles(fshFiles);\n      addLog(`📊 Found ${fshFiles.length} FSH files in repository`, 'info');\n      \n      return { config, fshFiles };\n    } catch (err) {\n      addLog(`❌ Error fetching repository files: ${err.message}`, 'error');\n      throw err;\n    }\n  };\n\n  const integrateStagingFiles = (repoFshFiles) => {\n    // Start with repository files\n    const integratedFiles = [...repoFshFiles];\n    \n    // Override/add staging files\n    stagingFiles.forEach(stagingFile => {\n      if (stagingFile.path && stagingFile.path.endsWith('.fsh')) {\n        const fileName = stagingFile.path.split('/').pop();\n        const existingIndex = integratedFiles.findIndex(f => f.name === fileName);\n        \n        if (existingIndex >= 0) {\n          // Override existing file\n          integratedFiles[existingIndex] = {\n            ...integratedFiles[existingIndex],\n            content: stagingFile.content,\n            isFromStaging: true\n          };\n          addLog(`🔄 Overriding ${fileName} with staging version`, 'info');\n        } else {\n          // Add new file from staging\n          integratedFiles.push({\n            name: fileName,\n            path: stagingFile.path,\n            content: stagingFile.content,\n            isFromStaging: true\n          });\n          addLog(`➕ Adding ${fileName} from staging`, 'info');\n        }\n      }\n    });\n\n    return integratedFiles;\n  };\n\n  const runSushiInBrowser = async (config, files) => {\n    try {\n      // Determine execution mode\n      const useWasm = executionMode === 'wasm' || \n                     (executionMode === 'auto' && wasmSupported && wasmInitialized);\n      \n      const mode = useWasm ? 'WebAssembly' : 'JavaScript';\n      addLog(`🚀 Starting FHIR Shorthand compilation using ${mode}...`, 'info');\n      \n      // Start performance monitoring\n      performanceMonitor.startTiming('sushi-compilation', useWasm ? 'wasm' : 'js');\n      \n      let result;\n      \n      if (useWasm) {\n        addLog('🔧 Using WebAssembly SUSHI engine...', 'info');\n        result = await runSushiWithWasm(config, files);\n      } else {\n        addLog('⚙️ Using JavaScript fallback engine...', 'info');\n        result = await runSushiWithJavaScript(config, files);\n      }\n      \n      // End performance monitoring\n      const duration = performanceMonitor.endTiming('sushi-compilation', useWasm ? 'wasm' : 'js');\n      addLog(`⏱️ Compilation completed in ${duration.toFixed(2)}ms using ${mode}`, 'success');\n      \n      return result;\n      \n    } catch (err) {\n      addLog(`❌ Compilation failed: ${err.message}`, 'error');\n      \n      // If WASM failed, try JavaScript fallback\n      if (executionMode === 'auto' && wasmSupported) {\n        addLog('🔄 Attempting JavaScript fallback...', 'info');\n        try {\n          return await runSushiWithJavaScript(config, files);\n        } catch (fallbackErr) {\n          addLog(`❌ JavaScript fallback also failed: ${fallbackErr.message}`, 'error');\n          throw fallbackErr;\n        }\n      }\n      \n      throw err;\n    }\n  };\n\n  const runSushiWithWasm = async (config, files) => {\n    try {\n      addLog('📦 Preparing WebAssembly execution environment...', 'info');\n      \n      // Use the WASM service\n      const result = await sushiWasmService.runSushi(config, files);\n      \n      if (result.success) {\n        addLog(`✅ WebAssembly compilation successful`, 'success');\n        addLog(`📊 Generated ${result.files.length} FHIR resources`, 'success');\n        \n        // Convert WASM output to the expected format\n        const generatedResources = result.files.map(file => ({\n          type: file.resourceType,\n          filename: file.path,\n          content: file.content,\n          id: file.path.split('.')[0],\n          resourceType: file.resourceType\n        }));\n        \n        setGeneratedFiles(generatedResources);\n        \n        // Log any warnings\n        result.warnings.forEach(warning => {\n          addLog(`⚠️ ${warning}`, 'warning');\n        });\n        \n        return {\n          success: true,\n          resourceCount: result.files.length,\n          warnings: result.warnings,\n          errors: result.errors,\n          generatedFiles: generatedResources\n        };\n      } else {\n        // Log errors from WASM compilation\n        result.errors.forEach(error => {\n          addLog(`❌ ${error}`, 'error');\n        });\n        \n        throw new Error(`WASM compilation failed: ${result.errors.join(', ')}`);\n      }\n      \n    } catch (err) {\n      addLog(`💥 WebAssembly execution failed: ${err.message}`, 'error');\n      throw err;\n    }\n  };\n\n  const runSushiWithJavaScript = async (config, files) => {\n    try {\n      addLog('🚀 Starting FHIR Shorthand compilation...', 'info');\n      \n      addLog('ℹ️ Using JavaScript FSH processor with enhanced crash prevention', 'info');\n      \n      // Enhanced memory monitoring with much stricter limits\n      const checkMemoryUsage = () => {\n        if (performance.memory && performance.memory.usedJSHeapSize) {\n          const memoryMB = (performance.memory.usedJSHeapSize / 1024 / 1024);\n          const memoryLimitMB = 30; // Much stricter: 30MB hard limit\n          const memoryWarningMB = 20; // Warning at 20MB\n          \n          if (memoryMB > memoryLimitMB) {\n            throw new Error(`Memory limit exceeded: ${memoryMB.toFixed(1)}MB > ${memoryLimitMB}MB. Processing stopped to prevent browser crash.`);\n          }\n          \n          if (memoryMB > memoryWarningMB) {\n            addLog(`⚠️ High memory usage: ${memoryMB.toFixed(1)}MB (approaching ${memoryLimitMB}MB limit)`, 'warning');\n          }\n          \n          return memoryMB;\n        }\n        return 0;\n      };\n      \n      const initialMemory = checkMemoryUsage();\n      addLog(`💾 Initial memory usage: ${initialMemory.toFixed(1)} MB`, 'info');\n      \n      // Implement much stricter file size limits to prevent crashes\n      const maxFileSize = 1 * 1024 * 1024; // Reduced to 1MB per file\n      const maxTotalSize = 5 * 1024 * 1024; // Reduced to 5MB total\n      const maxFiles = 5; // Reduced to maximum 5 files to prevent crashes\n      \n      let totalSize = 0;\n      const validFiles = [];\n      \n      for (const file of files.slice(0, maxFiles)) {\n        const fileSize = file.content ? file.content.length : 0;\n        \n        if (fileSize > maxFileSize) {\n          addLog(`❌ Skipping ${file.name}: too large (${(fileSize / 1024 / 1024).toFixed(1)}MB > 1MB limit)`, 'error');\n          continue;\n        }\n        \n        if (totalSize + fileSize > maxTotalSize) {\n          addLog(`⚠️ Stopping file processing: total size limit reached (${(totalSize / 1024 / 1024).toFixed(1)}MB)`, 'warning');\n          break;\n        }\n        \n        totalSize += fileSize;\n        validFiles.push(file);\n      }\n      \n      if (files.length > maxFiles) {\n        addLog(`⚠️ Limited to first ${maxFiles} files (${files.length} total) to prevent browser crashes`, 'warning');\n      }\n      \n      addLog(`📊 Processing ${validFiles.length} files (${(totalSize / 1024 / 1024).toFixed(1)}MB total)`, 'info');\n      \n      addLog('📦 Loading YAML processing library...', 'info');\n      const yaml = await import('js-yaml');\n      addLog('✅ Libraries loaded successfully', 'success');\n      \n      addLog('📝 Processing configuration...', 'info');\n      \n      // Prepare configuration\n      let configObj = null;\n      if (config) {\n        try {\n          configObj = typeof config === 'string' ? yaml.default.load(config) : config;\n          addLog(`📋 Package: ${configObj.name || 'Unknown'}`, 'success');\n          addLog(`📋 Version: ${configObj.version || 'Unknown'}`, 'success');\n          addLog(`📋 FHIR Version: ${configObj.fhirVersion || 'Unknown'}`, 'success');\n        } catch (err) {\n          addLog(`⚠️ Could not parse config: ${err.message}`, 'warning');\n        }\n      } else {\n        // Create a default configuration\n        configObj = {\n          name: 'browser-generated-ig',\n          version: '1.0.0',\n          fhirVersion: '4.0.1',\n          id: 'browser.generated.ig',\n          canonical: 'http://example.org/fhir/ig/browser-generated',\n          status: 'draft'\n        };\n        addLog('📋 Using default configuration', 'info');\n      }\n\n      addLog(`🔍 Analyzing ${validFiles.length} FSH files with crash prevention...`, 'info');\n      \n      const generatedResources = [];\n      let processedCount = 0;\n      const maxResourcesPerFile = 3; // Reduced from 5 to 3 resources per file\n      const maxTotalResources = 15; // Reduced from 50 to 15 total resources\n      \n      // Process files one at a time to prevent memory buildup\n      const chunkSize = 1; // Process 1 file at a time for maximum safety\n      \n      for (let i = 0; i < validFiles.length; i += chunkSize) {\n        const chunk = validFiles.slice(i, i + chunkSize);\n        \n        for (const file of chunk) {\n          addLog(`📄 Processing ${file.name} (${processedCount + 1}/${validFiles.length})...`, 'info');\n          \n          // Enhanced memory check before processing each file\n          const currentMemory = checkMemoryUsage();\n          \n          // Stop if we're approaching memory limits (much stricter threshold)\n          if (currentMemory > 15) { // Reduced from 80MB to 15MB threshold\n            addLog(`⚠️ Stopping processing due to high memory usage (${currentMemory.toFixed(1)}MB)`, 'warning');\n            break;\n          }\n          \n          // Stop if we've reached resource limits\n          if (generatedResources.length >= maxTotalResources) {\n            addLog(`⚠️ Reached maximum resource limit (${maxTotalResources}), stopping processing`, 'warning');\n            break;\n          }\n          \n          const content = file.content;\n          \n          // Enhanced FSH parsing with stricter limits\n          const extractFSHDefinitions = (content) => {\n            try {\n              const definitions = {\n                profiles: [],\n                instances: [],\n                valueSets: [],\n                codeSystems: [],\n                extensions: []\n              };\n              \n              // Check for empty or invalid content\n              if (!content || typeof content !== 'string') {\n                return definitions;\n              }\n              \n              // Much stricter line processing limit to prevent memory issues\n              const lines = content.split('\\n');\n              const maxLinesToProcess = 500; // Reduced from 1k to 500 lines per file\n              \n              if (lines.length > maxLinesToProcess) {\n                addLog(`  ⚠️ File is large (${lines.length} lines). Processing first ${maxLinesToProcess} lines only.`, 'warning');\n              }\n              \n              const linesToProcess = lines.slice(0, Math.min(lines.length, maxLinesToProcess));\n              \n              let currentDefinition = null;\n              let currentType = null;\n              let definitionCount = 0;\n              const maxDefinitionsPerFile = 5; // Reduced from 10 to 5 definitions per file\n              \n              for (let i = 0; i < linesToProcess.length && definitionCount < maxDefinitionsPerFile; i++) {\n                const line = linesToProcess[i].trim();\n                \n                // Skip empty lines and comments to improve performance\n                if (!line || line.startsWith('//') || line.startsWith('/*')) {\n                  continue;\n                }\n                \n                // Detect definition types\n                if (line.startsWith('Profile:')) {\n                  if (definitionCount >= maxDefinitionsPerFile) break;\n                  currentType = 'profiles';\n                  currentDefinition = {\n                    name: line.substring(8).trim(),\n                    type: 'Profile',\n                    parent: null,\n                    id: null,\n                    title: null,\n                    description: null,\n                    rules: []\n                  };\n                  definitionCount++;\n                } else if (line.startsWith('Instance:')) {\n                  if (definitionCount >= maxDefinitionsPerFile) break;\n                  currentType = 'instances';\n                  currentDefinition = {\n                    name: line.substring(9).trim(),\n                    type: 'Instance',\n                    instanceOf: null,\n                    usage: null,\n                    title: null,\n                    description: null,\n                    rules: []\n                  };\n                  definitionCount++;\n                } else if (line.startsWith('ValueSet:')) {\n                  if (definitionCount >= maxDefinitionsPerFile) break;\n                  currentType = 'valueSets';\n                  currentDefinition = {\n                    name: line.substring(9).trim(),\n                    type: 'ValueSet',\n                    id: null,\n                    title: null,\n                    description: null,\n                    rules: []\n                  };\n                  definitionCount++;\n                } else if (line.startsWith('CodeSystem:')) {\n                  if (definitionCount >= maxDefinitionsPerFile) break;\n                  currentType = 'codeSystems';\n                  currentDefinition = {\n                    name: line.substring(11).trim(),\n                    type: 'CodeSystem',\n                    id: null,\n                    title: null,\n                    description: null,\n                    rules: []\n                  };\n                  definitionCount++;\n                } else if (line.startsWith('Extension:')) {\n                  if (definitionCount >= maxDefinitionsPerFile) break;\n                  currentType = 'extensions';\n                  currentDefinition = {\n                    name: line.substring(10).trim(),\n                    type: 'Extension',\n                    id: null,\n                    title: null,\n                    description: null,\n                    rules: []\n                  };\n                  definitionCount++;\n                }\n                \n                // Parse properties\n                if (currentDefinition) {\n                  if (line.startsWith('Parent:')) {\n                    currentDefinition.parent = line.substring(7).trim();\n                  } else if (line.startsWith('InstanceOf:')) {\n                    currentDefinition.instanceOf = line.substring(11).trim();\n                  } else if (line.startsWith('Usage:')) {\n                    currentDefinition.usage = line.substring(6).trim();\n                  } else if (line.startsWith('Id:')) {\n                    currentDefinition.id = line.substring(3).trim();\n                  } else if (line.startsWith('Title:')) {\n                    currentDefinition.title = line.substring(6).trim().replace(/['\"]/g, '');\n                  } else if (line.startsWith('Description:')) {\n                    currentDefinition.description = line.substring(12).trim().replace(/['\"]/g, '');\n                  } else if (line.startsWith('* ')) {\n                    // Much stricter rule limit to prevent memory issues\n                    if (currentDefinition.rules.length < 5) {\n                      currentDefinition.rules.push(line.substring(2).trim());\n                    }\n                  }\n                  \n                  // If we hit a new definition or end of content, save current one\n                  if ((line.includes(':') && !line.startsWith('* ') && \n                       !line.startsWith('Parent:') && !line.startsWith('InstanceOf:') &&\n                       !line.startsWith('Usage:') && !line.startsWith('Id:') &&\n                       !line.startsWith('Title:') && !line.startsWith('Description:')) ||\n                      i === linesToProcess.length - 1) {\n                    \n                    if (currentDefinition && currentType && currentDefinition.name) {\n                      definitions[currentType].push(currentDefinition);\n                    }\n                    currentDefinition = null;\n                    currentType = null;\n                    i--; // Re-process this line for the new definition\n                  }\n                }\n              }\n              \n              if (definitionCount >= maxDefinitionsPerFile) {\n                addLog(`  ⚠️ Limited to ${maxDefinitionsPerFile} definitions per file to prevent browser crashes`, 'warning');\n              }\n              \n              return definitions;\n            } catch (err) {\n              addLog(`  ❌ Error parsing FSH content: ${err.message}`, 'error');\n              return {\n                profiles: [],\n                instances: [],\n                valueSets: [],\n                codeSystems: [],\n                extensions: []\n              };\n            }\n          };\n          \n          const definitions = extractFSHDefinitions(content);\n          \n          // Generate FHIR resources with strict memory management\n          let resourcesFromThisFile = 0;\n          const remainingResourceSlots = maxTotalResources - generatedResources.length;\n          const maxFromThisFile = Math.min(maxResourcesPerFile, remainingResourceSlots);\n          \n          // Process profiles with strict limits\n          for (const profile of definitions.profiles.slice(0, Math.min(1, maxFromThisFile - resourcesFromThisFile))) {\n            if (resourcesFromThisFile >= maxFromThisFile) break;\n            \n            try {\n              const profileId = profile.id || profile.name.toLowerCase().replace(/\\s+/g, '-');\n              const structureDefinition = {\n                resourceType: 'StructureDefinition',\n                id: profileId,\n                url: `${configObj.canonical}/StructureDefinition/${profileId}`,\n                name: profile.name,\n                title: profile.title || profile.name,\n                status: 'draft',\n                fhirVersion: configObj.fhirVersion || '4.0.1',\n                kind: 'resource',\n                abstract: false,\n                type: profile.parent === 'Patient' ? 'Patient' : \n                       profile.parent === 'Observation' ? 'Observation' :\n                       profile.parent || 'DomainResource',\n                baseDefinition: `http://hl7.org/fhir/StructureDefinition/${profile.parent || 'DomainResource'}`,\n                derivation: 'constraint',\n                description: profile.description || `Profile for ${profile.name}`\n              };\n              \n              // Limit differential elements to prevent memory issues\n              if (profile.rules.length > 0) {\n                structureDefinition.differential = {\n                  element: profile.rules.slice(0, 2).map((rule, index) => ({ // Reduced to 2 elements max\n                    id: `${structureDefinition.type}.${rule.split(' ')[0]}`,\n                    path: `${structureDefinition.type}.${rule.split(' ')[0]}`,\n                    short: `Rule: ${rule}`\n                  }))\n                };\n              }\n              \n              generatedResources.push({\n                type: 'StructureDefinition',\n                filename: `StructureDefinition-${profileId}.json`,\n                content: JSON.stringify(structureDefinition, null, 2),\n                id: profileId,\n                name: profile.name,\n                title: structureDefinition.title,\n                url: structureDefinition.url\n              });\n              \n              resourcesFromThisFile++;\n              addLog(`  📊 Generated StructureDefinition: ${profile.name}`, 'success');\n            } catch (err) {\n              addLog(`  ❌ Error generating StructureDefinition for ${profile.name}: ${err.message}`, 'error');\n            }\n          }\n          \n          // Process instances with strict limits\n          for (const instance of definitions.instances.slice(0, Math.min(1, maxFromThisFile - resourcesFromThisFile))) {\n            if (resourcesFromThisFile >= maxFromThisFile) break;\n            \n            try {\n              const instanceId = instance.name.toLowerCase().replace(/\\s+/g, '-');\n              const resourceType = instance.instanceOf === 'Patient' ? 'Patient' :\n                                 instance.instanceOf === 'Observation' ? 'Observation' :\n                                 'Patient'; // Default fallback\n                                 \n              const fhirInstance = {\n                resourceType: resourceType,\n                id: instanceId,\n                meta: {\n                  profile: instance.instanceOf ? [`${configObj.canonical}/StructureDefinition/${instance.instanceOf}`] : undefined\n                }\n              };\n              \n              // Add minimal properties to reduce memory usage\n              if (resourceType === 'Patient') {\n                fhirInstance.name = [{\n                  family: instance.name.split(' ').pop(),\n                  given: instance.name.split(' ').slice(0, -1)\n                }];\n              }\n              \n              generatedResources.push({\n                type: resourceType,\n                filename: `${instanceId}.json`,\n                content: JSON.stringify(fhirInstance, null, 2),\n                id: instanceId,\n                resourceType: resourceType\n              });\n              \n              resourcesFromThisFile++;\n              addLog(`  📊 Generated ${resourceType} instance: ${instance.name}`, 'success');\n            } catch (err) {\n              addLog(`  ❌ Error generating instance for ${instance.name}: ${err.message}`, 'error');\n            }\n          }\n          \n          // Process ValueSets and CodeSystems with even stricter limits\n          for (const vs of definitions.valueSets.slice(0, Math.min(1, maxFromThisFile - resourcesFromThisFile))) {\n            if (resourcesFromThisFile >= maxFromThisFile) break;\n            \n            try {\n              const vsId = vs.id || vs.name.toLowerCase().replace(/\\s+/g, '-');\n              const valueSet = {\n                resourceType: 'ValueSet',\n                id: vsId,\n                url: `${configObj.canonical}/ValueSet/${vsId}`,\n                name: vs.name,\n                title: vs.title || vs.name,\n                status: 'draft',\n                description: vs.description || `ValueSet for ${vs.name}`,\n                compose: {\n                  include: [{\n                    system: 'http://example.org/codes',\n                    concept: [\n                      { code: 'example1', display: 'Example Code 1' }\n                    ]\n                  }]\n                }\n              };\n              \n              generatedResources.push({\n                type: 'ValueSet',\n                filename: `ValueSet-${vsId}.json`,\n                content: JSON.stringify(valueSet, null, 2),\n                id: vsId,\n                name: vs.name,\n                title: valueSet.title,\n                url: valueSet.url\n              });\n              \n              resourcesFromThisFile++;\n              addLog(`  📊 Generated ValueSet: ${vs.name}`, 'success');\n            } catch (err) {\n              addLog(`  ❌ Error generating ValueSet for ${vs.name}: ${err.message}`, 'error');\n            }\n          }\n          \n          if (file.isFromStaging) {\n            addLog(`  🏗️ File from staging ground`, 'info');\n          }\n          \n          processedCount++;\n          \n          // Clear file content from memory immediately after processing\n          file.content = null;\n          \n          // Force garbage collection more frequently\n          if (window.gc && typeof window.gc === 'function') {\n            window.gc();\n          }\n        }\n        \n        // Yield control for longer periods between chunks to prevent blocking\n        await new Promise(resolve => setTimeout(resolve, 200)); // Increased to 200ms delay between files\n        \n        // Enhanced memory monitoring after each file\n        const memoryAfterChunk = checkMemoryUsage();\n        addLog(`💾 Memory after file: ${memoryAfterChunk.toFixed(1)} MB (processed ${Math.min(i + chunkSize, validFiles.length)}/${validFiles.length})`, 'info');\n        \n        // Break if memory is getting too high (much lower threshold)\n        if (memoryAfterChunk > 20) {\n          addLog(`⚠️ Stopping processing due to high memory usage`, 'warning');\n          break;\n        }\n      }\n\n      // Set generated files\n      setGeneratedFiles(generatedResources);\n      \n      // Final memory check\n      const finalMemory = checkMemoryUsage();\n      addLog(`💾 Final memory usage: ${finalMemory.toFixed(1)} MB`, 'info');\n      \n      addLog('✨ FSH compilation completed with crash prevention!', 'success');\n      addLog(`📦 Generated ${generatedResources.length} FHIR resources total (limited for stability)`, 'success');\n      \n      // Check for staging files\n      const stagingCount = validFiles.filter(f => f.isFromStaging).length;\n      if (stagingCount > 0) {\n        addLog(`🏗️ ${stagingCount} file(s) from staging ground included`, 'info');\n      }\n      \n      // Handle edge cases\n      if (validFiles.length === 0) {\n        addLog('⚠️ No FSH files found or all files too large to process safely', 'warning');\n      }\n      \n      if (!config) {\n        addLog('⚠️ No sushi-config.yaml found - used default configuration', 'warning');\n      }\n      \n      // Safety warnings\n      if (generatedResources.length >= maxTotalResources) {\n        addLog(`⚠️ Output limited to ${maxTotalResources} resources to prevent browser crashes`, 'warning');\n      }\n      \n      if (validFiles.length < files.length) {\n        addLog(`⚠️ ${files.length - validFiles.length} files skipped due to size limits`, 'warning');\n      }\n\n      return {\n        success: true,\n        resourceCount: generatedResources.length,\n        warnings: [],\n        errors: [],\n        generatedFiles: generatedResources\n      };\n      \n    } catch (err) {\n      addLog(`❌ Compilation failed: ${err.message}`, 'error');\n      \n      // Log additional error details if available\n      if (err.stack) {\n        console.error('Compilation error stack:', err.stack);\n      }\n      \n      throw err;\n    }\n  };\n\n  const handleRunSushi = async (withStagingFiles = false) => {\n    setIsRunning(true);\n    setShowModal(true);\n    setLogs([]);\n    setGeneratedFiles([]);\n    setActiveTab('logs');\n    setError(null);\n    setIncludeStagingFiles(withStagingFiles);\n\n    try {\n      addLog('🏁 Starting SUSHI client-side execution...', 'info');\n      \n      if (withStagingFiles && stagingFiles.length > 0) {\n        addLog(`🗂️ Including ${stagingFiles.length} staging files`, 'info');\n      }\n\n      // Fetch repository files\n      const { config, fshFiles: repoFiles } = await fetchRepositoryFiles();\n      \n      // Integrate staging files if requested\n      const finalFiles = withStagingFiles ? \n        integrateStagingFiles(repoFiles) : \n        repoFiles;\n\n      if (withStagingFiles) {\n        addLog(`📊 Final file count: ${finalFiles.length} FSH files`, 'info');\n      }\n\n      // Run SUSHI\n      await runSushiInBrowser(config, finalFiles);\n      \n      addLog('🎉 SUSHI execution completed successfully!', 'success');\n      \n    } catch (err) {\n      setError(err.message);\n      addLog(`💥 Execution failed: ${err.message}`, 'error');\n    } finally {\n      setIsRunning(false);\n    }\n  };\n\n  const toggleLogLevel = useCallback((level) => {\n    setLogLevelToggles(prev => ({\n      ...prev,\n      [level]: !prev[level]\n    }));\n  }, []);\n\n  const clearLogs = useCallback(() => {\n    setLogs([]);\n    setGeneratedFiles([]);\n    setActiveTab('logs');\n    setLogLevelToggles({\n      info: true,\n      success: true,\n      warning: true,\n      error: true\n    });\n    setSearchText('');\n  }, []);\n\n  const copyAllLogs = useCallback(async () => {\n    const logText = logs.map(log => \n      `[${new Date(log.timestamp).toLocaleTimeString()}] ${log.message}`\n    ).join('\\n');\n    \n    try {\n      await navigator.clipboard.writeText(logText);\n    } catch (err) {\n      console.error('Failed to copy logs:', err);\n    }\n  }, [logs]);\n\n  const copyLogMessage = useCallback(async (message) => {\n    try {\n      await navigator.clipboard.writeText(message);\n    } catch (err) {\n      console.error('Failed to copy log message:', err);\n    }\n  }, []);\n\n  // Function to detect and create links for files mentioned in log messages\n  const parseLogMessage = useCallback((message, logId) => {\n    // More precise regex to find valid file paths - must be preceded by whitespace or start of line\n    // and must be a complete path (not part of a longer word)\n    const filePathRegex = /(?:^|\\s)((?:input\\/fsh\\/[a-zA-Z0-9_/-]*\\/)?[a-zA-Z0-9_.-]+\\.(?:fsh|yaml|yml|json))(?=\\s|$|[.,!])/g;\n    const matches = [...message.matchAll(filePathRegex)];\n    \n    if (matches.length === 0) {\n      return <span>{message}</span>;\n    }\n    \n    let lastIndex = 0;\n    const elements = [];\n    let elementCounter = 0; // Add counter for unique keys\n    \n    matches.forEach((match, index) => {\n      const fullMatch = match[0];\n      const filePath = match[1];\n      const matchIndex = match.index;\n      \n      // Add text before the match\n      if (matchIndex > lastIndex) {\n        elements.push(\n          <span key={`${logId}-text-${elementCounter++}`}>\n            {message.substring(lastIndex, matchIndex)}\n          </span>\n        );\n      }\n      \n      // Add the leading whitespace if present\n      const leadingWhitespace = fullMatch.substring(0, fullMatch.indexOf(filePath));\n      if (leadingWhitespace) {\n        elements.push(\n          <span key={`${logId}-ws-${elementCounter++}`}>\n            {leadingWhitespace}\n          </span>\n        );\n      }\n      \n      // Determine link type based on file location and validate the file exists\n      const createFileLink = (path, text, keyIndex) => {\n        // Check if file exists in our known file lists to avoid creating invalid links\n        const isKnownRepoFile = fshFiles.some(f => f.path === path);\n        const isFromStaging = stagingFiles.some(f => f.path && (f.path === path || f.path.endsWith(`/${path.split('/').pop()}`)));\n        const isSushiConfig = path === 'sushi-config.yaml';\n        \n        // Only create links for files we know exist\n        if (!isKnownRepoFile && !isFromStaging && !isSushiConfig) {\n          // File not found in our known files, return as plain text\n          return (\n            <span key={`${logId}-text-${keyIndex}`} className=\"file-mention\">\n              {text}\n            </span>\n          );\n        }\n        \n        if (isFromStaging) {\n          // Link to staging ground\n          return (\n            <span key={`${logId}-staging-${keyIndex}`} className=\"file-link staging-link\" title=\"File from Staging Ground\">\n              📝 {text}\n            </span>\n          );\n        } else if (path.startsWith('input/fsh/')) {\n          // Determine DAK component based on directory structure\n          const getDakComponentLink = (fshPath) => {\n            const pathParts = fshPath.split('/');\n            if (pathParts.length > 2) {\n              const subDir = pathParts[2];\n              switch (subDir) {\n                case 'profiles':\n                  return { component: 'Profiles', icon: '👤' };\n                case 'examples':\n                  return { component: 'Examples', icon: '📋' };\n                case 'valuesets':\n                  return { component: 'ValueSets', icon: '📊' };\n                case 'codesystems':\n                  return { component: 'CodeSystems', icon: '🔢' };\n                case 'extensions':\n                  return { component: 'Extensions', icon: '🔧' };\n                default:\n                  return { component: 'FSH Files', icon: '📄' };\n              }\n            }\n            return { component: 'FSH Files', icon: '📄' };\n          };\n          \n          const dakInfo = getDakComponentLink(path);\n          return (\n            <span key={`${logId}-dak-${keyIndex}`} className=\"file-link dak-link\" title={`View in DAK ${dakInfo.component}`}>\n              {dakInfo.icon} {text}\n            </span>\n          );\n        } else {\n          // Link to GitHub source for valid repository files\n          const githubUrl = `https://github.com/${owner}/${repoName}/blob/${selectedBranch}/${path}`;\n          return (\n            <a \n              key={`${logId}-github-${keyIndex}`}\n              href={githubUrl} \n              target=\"_blank\" \n              rel=\"noopener noreferrer\" \n              className=\"file-link github-link\"\n              title=\"Open in GitHub\"\n            >\n              🔗 {text}\n            </a>\n          );\n        }\n      };\n      \n      elements.push(createFileLink(filePath, filePath, elementCounter++));\n      lastIndex = matchIndex + fullMatch.length;\n    });\n    \n    // Add remaining text\n    if (lastIndex < message.length) {\n      elements.push(\n        <span key={`${logId}-text-end-${elementCounter++}`}>\n          {message.substring(lastIndex)}\n        </span>\n      );\n    }\n    \n    return <span>{elements}</span>;\n  }, [owner, repoName, selectedBranch, stagingFiles, fshFiles]);\n\n  // Optimized filtered logs with useMemo to prevent unnecessary re-computations\n  const filteredLogs = useMemo(() => {\n    return logs.filter(log => {\n      // Filter by log level toggles\n      const isLevelEnabled = logLevelToggles[log.type];\n      \n      // Filter by search text\n      const matchesSearch = searchText === '' || \n        log.message.toLowerCase().includes(searchText.toLowerCase());\n      \n      return isLevelEnabled && matchesSearch;\n    });\n  }, [logs, logLevelToggles, searchText]);\n\n  // Separate component for log controls to prevent re-renders\n  const LogControls = React.memo(({ \n    logLevelToggles, \n    onToggleLogLevel, \n    searchText, \n    onSearchChange, \n    filteredCount, \n    totalCount \n  }) => {\n    const handleSearchChange = useCallback((e) => {\n      onSearchChange(e.target.value);\n    }, [onSearchChange]);\n\n    return (\n      <div className=\"log-controls\">\n        <div className=\"log-level-toggles\">\n          <label className=\"toggle-group-label\">Show levels:</label>\n          <div className=\"toggle-buttons\">\n            {[\n              { key: 'info', label: 'Info', icon: 'ℹ️' },\n              { key: 'success', label: 'Success', icon: '✅' },\n              { key: 'warning', label: 'Warning', icon: '⚠️' },\n              { key: 'error', label: 'Error', icon: '❌' }\n            ].map(({ key, label, icon }) => (\n              <button\n                key={key}\n                className={`log-toggle-btn ${logLevelToggles[key] ? 'active' : 'inactive'}`}\n                onClick={() => onToggleLogLevel(key)}\n                title={`Toggle ${label} messages`}\n              >\n                {icon} {label}\n              </button>\n            ))}\n          </div>\n        </div>\n        \n        <div className=\"log-search-group\">\n          <label htmlFor=\"log-search\">Search logs:</label>\n          <input\n            id=\"log-search\"\n            type=\"text\"\n            value={searchText}\n            onChange={handleSearchChange}\n            placeholder=\"Search log messages...\"\n            className=\"log-search-input\"\n          />\n        </div>\n        \n        <div className=\"log-stats\">\n          {searchText || Object.values(logLevelToggles).some(v => !v) ? (\n            <span>Showing {filteredCount} of {totalCount} logs</span>\n          ) : (\n            <span>{totalCount} logs</span>\n          )}\n        </div>\n      </div>\n    );\n  });\n\n  const handleSearchChange = useCallback((value) => {\n    setSearchText(value);\n  }, []);\n\n  const viewFile = useCallback((file) => {\n    setSelectedFile(file);\n    setShowFileViewer(true);\n  }, []);\n\n  const closeFileViewer = useCallback(() => {\n    setShowFileViewer(false);\n    setSelectedFile(null);\n  }, []);\n\n  const getResourceTypeIcon = (type) => {\n    switch (type) {\n      case 'StructureDefinition': return '🏗️';\n      case 'Patient': return '👤';\n      case 'ValueSet': return '📊';\n      case 'CodeSystem': return '🔢';\n      case 'Organization': return '🏢';\n      case 'Practitioner': return '👨‍⚕️';\n      case 'Observation': return '📋';\n      default: return '📄';\n    }\n  };\n\n  const FileViewerModal = () => {\n    if (!selectedFile) return null;\n\n    return (\n      <div className=\"file-viewer-overlay\">\n        <div className=\"file-viewer-modal\">\n          <div className=\"file-viewer-header\">\n            <h3>\n              {getResourceTypeIcon(selectedFile.type)} {selectedFile.filename}\n            </h3>\n            <div className=\"file-viewer-actions\">\n              <button\n                onClick={() => navigator.clipboard.writeText(selectedFile.content)}\n                className=\"copy-file-btn\"\n                title=\"Copy file content to clipboard\"\n              >\n                📋 Copy\n              </button>\n              <button\n                onClick={closeFileViewer}\n                className=\"close-file-viewer-btn\"\n              >\n                ✕\n              </button>\n            </div>\n          </div>\n          <div className=\"file-viewer-content\">\n            <SyntaxHighlighter\n              language=\"json\"\n              style={oneLight}\n              showLineNumbers={true}\n              wrapLines={true}\n              customStyle={{\n                fontSize: '14px',\n                lineHeight: '1.4',\n                maxHeight: '70vh',\n                overflow: 'auto'\n              }}\n            >\n              {selectedFile.content}\n            </SyntaxHighlighter>\n          </div>\n          <div className=\"file-viewer-footer\">\n            <span className=\"file-info\">\n              Resource Type: {selectedFile.type} | \n              Size: {(selectedFile.content.length / 1024).toFixed(1)} KB\n            </span>\n          </div>\n        </div>\n      </div>\n    );\n  };\n\n  const LogModal = () => (\n    <div className=\"sushi-modal-overlay\">\n      <div className=\"sushi-modal\">\n        <div className=\"sushi-modal-header\">\n          <h3>\n            🍣 SUSHI Client-Side Execution \n            {includeStagingFiles && <span className=\"staging-badge\">+ Staging</span>}\n          </h3>\n          <div className=\"modal-actions\">\n            <button \n              onClick={copyAllLogs}\n              className=\"copy-all-btn\"\n              disabled={logs.length === 0}\n              title=\"Copy all logs to clipboard\"\n            >\n              📋 Copy All\n            </button>\n            <button \n              onClick={clearLogs}\n              className=\"clear-logs-btn\"\n              disabled={isRunning}\n            >\n              🗑️ Clear\n            </button>\n            <button \n              onClick={() => setShowModal(false)}\n              className=\"close-modal-btn\"\n            >\n              ✕\n            </button>\n          </div>\n        </div>\n        \n        <LogControls\n          logLevelToggles={logLevelToggles}\n          onToggleLogLevel={toggleLogLevel}\n          searchText={searchText}\n          onSearchChange={handleSearchChange}\n          filteredCount={filteredLogs.length}\n          totalCount={logs.length}\n        />\n        \n        {generatedFiles.length > 0 && (\n          <div className=\"modal-section-toggle\">\n            <div className=\"toggle-options\">\n              <button \n                className={`toggle-btn ${activeTab === 'logs' ? 'active' : ''}`}\n                onClick={() => setActiveTab('logs')}\n              >\n                📄 Logs & Messages\n              </button>\n              <button \n                className={`toggle-btn ${activeTab === 'files' ? 'active' : ''}`}\n                onClick={() => setActiveTab('files')}\n              >\n                📦 Generated Resources\n              </button>\n            </div>\n            <div className=\"section-info\">\n              {activeTab === 'logs' ? (\n                <span className=\"info-text\">{logs.length} log entries • Use toggles to filter by level</span>\n              ) : (\n                <span className=\"info-text\">{generatedFiles.length} FHIR resources generated</span>\n              )}\n            </div>\n          </div>\n        )}\n        \n        <div className=\"sushi-modal-content\">\n          {(activeTab === 'logs' || generatedFiles.length === 0) && (\n            <div className=\"log-container\">\n              {filteredLogs.map(log => (\n                <div key={log.id} className={`log-entry log-${log.type}`}>\n                  <span className=\"log-timestamp\">\n                    {new Date(log.timestamp).toLocaleTimeString()}\n                  </span>\n                  <span className=\"log-message\">\n                    {parseLogMessage(log.message, log.id)}\n                  </span>\n                  <button \n                    onClick={() => copyLogMessage(log.message)}\n                    className=\"copy-log-btn\"\n                    title=\"Copy this message to clipboard\"\n                  >\n                    📋\n                  </button>\n                </div>\n              ))}\n              \n              {isRunning && (\n                <div className=\"log-entry log-running\">\n                  <span className=\"log-timestamp\">\n                    {new Date().toLocaleTimeString()}\n                  </span>\n                  <span className=\"log-message\">\n                    <span className=\"spinner\">⏳</span> Processing...\n                  </span>\n                  <div className=\"copy-log-btn-placeholder\"></div>\n                </div>\n              )}\n              \n              {filteredLogs.length === 0 && !isRunning && logs.length > 0 && (\n                <div className=\"log-placeholder\">\n                  No logs match the current filter criteria...\n                </div>\n              )}\n              \n              {logs.length === 0 && !isRunning && (\n                <div className=\"log-placeholder\">\n                  Logs will appear here during SUSHI execution...\n                </div>\n              )}\n              \n              {error && (\n                <div className=\"error-summary\">\n                  <h4>❌ Execution Error</h4>\n                  <p>{error}</p>\n                </div>\n              )}\n            </div>\n          )}\n          \n          {activeTab === 'files' && generatedFiles.length > 0 && (\n            <div className=\"generated-files-container\">\n              <div className=\"generated-files-section\">\n                <h4>📦 Generated FHIR Resources ({generatedFiles.length})</h4>\n                <div className=\"generated-files-grid\">\n                  {generatedFiles.map((file, index) => (\n                    <div key={index} className=\"generated-file-card\">\n                      <div className=\"file-card-header\">\n                        <span className=\"file-icon\">{getResourceTypeIcon(file.type)}</span>\n                        <span className=\"file-name\">{file.filename}</span>\n                      </div>\n                      <div className=\"file-card-details\">\n                        <span className=\"file-type\">{file.type}</span>\n                        <span className=\"file-size\">\n                          {(file.content.length / 1024).toFixed(1)} KB\n                        </span>\n                      </div>\n                      <div className=\"file-card-actions\">\n                        <button\n                          onClick={() => viewFile(file)}\n                          className=\"view-file-btn\"\n                          title=\"View resource content\"\n                        >\n                          👁️ View\n                        </button>\n                        <button\n                          onClick={() => navigator.clipboard.writeText(file.content)}\n                          className=\"copy-file-btn\"\n                          title=\"Copy to clipboard\"\n                        >\n                          📋\n                        </button>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n                <div className=\"fhir-viewer-suggestions\">\n                  <h5>💡 Enhanced FHIR Viewing Options</h5>\n                  <p>For better FHIR resource visualization, consider these viewers:</p>\n                  <ul>\n                    <li><strong>FHIR Tree Viewer:</strong> <code>npm install @types/fhir</code> + custom tree renderer</li>\n                    <li><strong>FHIR Path Viewer:</strong> <code>npm install fhirpath</code> for interactive querying</li>\n                    <li><strong>FHIR UI:</strong> <code>npm install @asymmetrik/fhir-kit-client</code> with UI components</li>\n                    <li><strong>HL7 FHIR Viewer:</strong> Integration with official HL7 FHIR viewers</li>\n                  </ul>\n                </div>\n              </div>\n            </div>\n          )}\n        </div>\n        \n        <div className=\"sushi-modal-footer\">\n          <div className=\"execution-info\">\n            {isRunning ? (\n              <span className=\"status-running\">🔄 Running SUSHI...</span>\n            ) : logs.length > 0 ? (\n              <span className=\"status-complete\">✅ Execution complete</span>\n            ) : (\n              <span className=\"status-ready\">🍣 Ready to run SUSHI</span>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n\n  return (\n    <SushiErrorBoundary>\n      <div className=\"sushi-runner-section\">\n        <div \n          className={`sushi-status-bar ${isExpanded ? 'expanded' : 'collapsed'}`}\n          onClick={() => setIsExpanded(!isExpanded)}\n        >\n          <div className=\"status-bar-header\">\n            <span className=\"status-icon\">🍣</span>\n            <span className=\"status-title\">SUSHI (FHIR Shorthand)</span>\n            <span className=\"expand-icon\">{isExpanded ? '▼' : '▶'}</span>\n          </div>\n          \n          {!isExpanded && (\n            <div className=\"status-summary\">\n              Client-side FHIR Implementation Guide compilation\n            </div>\n          )}\n        </div>\n\n        {isExpanded && (\n          <div className=\"sushi-controls\">\n            <div className=\"sushi-description\">\n              <p>\n                Run SUSHI (FHIR Shorthand) compilation directly in your browser to generate \n                FHIR Implementation Guide resources from FSH files.\n              </p>\n            </div>\n\n            <div className=\"execution-options\">\n              <div className=\"execution-mode-selector\">\n                <h4>⚙️ Execution Mode</h4>\n                <div className=\"mode-options\">\n                  <label className=\"mode-option\">\n                    <input \n                      type=\"radio\" \n                      name=\"executionMode\" \n                      value=\"auto\" \n                      checked={executionMode === 'auto'}\n                      onChange={(e) => setExecutionMode(e.target.value)}\n                    />\n                    <span className=\"mode-label\">\n                      🤖 Auto (WebAssembly when available)\n                      {wasmSupported && wasmInitialized && <span className=\"wasm-badge\">WASM Ready</span>}\n                    </span>\n                  </label>\n                  \n                  {wasmSupported && (\n                    <label className=\"mode-option\">\n                      <input \n                        type=\"radio\" \n                        name=\"executionMode\" \n                        value=\"wasm\" \n                        checked={executionMode === 'wasm'}\n                        onChange={(e) => setExecutionMode(e.target.value)}\n                        disabled={!wasmInitialized}\n                      />\n                      <span className=\"mode-label\">\n                        🚀 WebAssembly (High Performance)\n                        {!wasmInitialized && <span className=\"loading-badge\">Initializing...</span>}\n                      </span>\n                    </label>\n                  )}\n                  \n                  <label className=\"mode-option\">\n                    <input \n                      type=\"radio\" \n                      name=\"executionMode\" \n                      value=\"javascript\" \n                      checked={executionMode === 'javascript'}\n                      onChange={(e) => setExecutionMode(e.target.value)}\n                    />\n                    <span className=\"mode-label\">\n                      ⚙️ JavaScript (Fallback)\n                    </span>\n                  </label>\n                </div>\n                \n                {!wasmSupported && (\n                  <div className=\"wasm-not-supported\">\n                    <p>⚠️ WebAssembly is not supported in this browser. JavaScript fallback will be used.</p>\n                  </div>\n                )}\n              </div>\n\n              <div className=\"option-group\">\n                <h4>📂 Repository Files Only</h4>\n                <p>\n                  Compile using sushi-config.yaml and input/fsh files from the GitHub repository ({selectedBranch} branch).\n                </p>\n                <button\n                  className=\"run-sushi-btn primary\"\n                  onClick={() => handleRunSushi(false)}\n                  disabled={isRunning}\n                >\n                  {isRunning ? '⏳ Running...' : '🚀 Run SUSHI'}\n                </button>\n              </div>\n\n              {stagingFiles.length > 0 && (\n                <div className=\"option-group\">\n                  <h4>🏗️ Repository + Staging Files</h4>\n                  <p>\n                    Compile using repository files, with staging ground files ({stagingFiles.length} files) \n                    overriding any repository files with the same name.\n                  </p>\n                  <button\n                    className=\"run-sushi-btn secondary\"\n                    onClick={() => handleRunSushi(true)}\n                    disabled={isRunning}\n                  >\n                    {isRunning ? '⏳ Running...' : '🚀 Run SUSHI + Staging'}\n                  </button>\n                </div>\n              )}\n            </div>\n\n            <div className=\"sushi-status\">\n              <div className=\"status-item\">\n                <span className=\"label\">Execution:</span>\n                <span className=\"value\">\n                  {wasmSupported && wasmInitialized ? '🚀 WebAssembly Ready' : '⚙️ JavaScript'}\n                </span>\n              </div>\n              <div className=\"status-item\">\n                <span className=\"label\">Config:</span>\n                <span className=\"value\">{sushiConfig ? '✅ Found' : '❓ Unknown'}</span>\n              </div>\n              <div className=\"status-item\">\n                <span className=\"label\">FSH Files:</span>\n                <span className=\"value\">{fshFiles.length} in repository</span>\n              </div>\n              {stagingFiles.length > 0 && (\n                <div className=\"status-item\">\n                  <span className=\"label\">Staging:</span>\n                  <span className=\"value\">{stagingFiles.filter(f => f.path && f.path.endsWith('.fsh')).length} FSH files</span>\n                </div>\n              )}\n            </div>\n          </div>\n        )}\n\n        {showModal && <LogModal />}\n        {showFileViewer && <FileViewerModal />}\n      </div>\n    </SushiErrorBoundary>\n  );\n};\n\nexport default SushiRunner;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}