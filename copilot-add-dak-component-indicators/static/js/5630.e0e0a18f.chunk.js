"use strict";(self.webpackChunksgex_workbench=self.webpackChunksgex_workbench||[]).push([[5630],{53314:(e,a,s)=>{s.d(a,{A:()=>l});var t=s(9950),r=s(69396),n=s(46901),o=s(88498);const l=()=>{var e,a,s;const l=(0,r.zy)(),i=(0,r.Zp)(),{user:c,repo:d,branch:u}=(0,r.g)(),[m,h]=(0,t.useState)((null===(e=l.state)||void 0===e?void 0:e.profile)||null),[p,g]=(0,t.useState)((null===(a=l.state)||void 0===a?void 0:a.repository)||null),[f,v]=(0,t.useState)((null===(s=l.state)||void 0===s?void 0:s.selectedBranch)||u||null),[y,x]=(0,t.useState)(!m||!p),[w,A]=(0,t.useState)(null);return(0,t.useEffect)(()=>{(async()=>{var e,a,s,t,r;if(console.log("\ud83d\udd0d useDAKUrlParams: Starting data fetch analysis:",{urlParams:{user:c,repo:d,branch:u},currentState:{hasProfile:!!m,hasRepository:!!p,profileLogin:null===m||void 0===m?void 0:m.login,repositoryFullName:null===p||void 0===p?void 0:p.full_name,repositoryOwner:null===p||void 0===p||null===(e=p.owner)||void 0===e?void 0:e.login},hasLocationState:!!l.state,locationStateSummary:l.state?{hasProfile:!!l.state.profile,hasRepository:!!l.state.repository,profileLogin:null===(a=l.state.profile)||void 0===a?void 0:a.login,repositoryFullName:null===(s=l.state.repository)||void 0===s?void 0:s.full_name,repositoryOwner:null===(t=l.state.repository)||void 0===t||null===(r=t.owner)||void 0===r?void 0:r.login}:null,isAuthenticated:n.A.isAuth(),needsFetch:(!m||!p)&&c&&d}),m&&p||!c||!d)console.log("\ud83d\udccb useDAKUrlParams: Not fetching from URL params, using existing state:",{hasProfile:!!m,hasRepository:!!p,hasUserParam:!!c,hasRepoParam:!!d,reason:m&&p?"state already populated":"missing URL params"}),x(!1);else{console.log("useDAKUrlParams: Fetching data from URL parameters:",{user:c,repo:d,branch:u,hasProfile:!!m,hasRepository:!!p,hasLocationState:!!l.state,isAuthenticated:n.A.isAuth()});try{if(x(!0),A(null),!n.A.isAuth()){console.log("\ud83d\udeab useDAKUrlParams: Not authenticated, using public access"),console.log("\ud83d\udc40 useDAKUrlParams: Unauthenticated public access, creating public profile");const e={login:c,name:c.charAt(0).toUpperCase()+c.slice(1),avatar_url:"https://github.com/".concat(c,".png"),type:"User"},a={name:d,full_name:"".concat(c,"/").concat(d),owner:{login:c},default_branch:u||"main",html_url:"https://github.com/".concat(c,"/").concat(d)};return console.log("\ud83d\udccb useDAKUrlParams: Setting public access state:",{profile:e,repository:a,selectedBranch:u||"main"}),h(e),g(a),v(u||"main"),void x(!1)}console.log("\ud83d\udd10 useDAKUrlParams: Authenticated, fetching real repository data");let e=null;try{console.log("\ud83d\udd0d useDAKUrlParams: Fetching user profile for: ".concat(c));e=await n.A.getUser(c),console.log("\u2705 useDAKUrlParams: User profile fetched:",{login:e.login,name:e.name,type:e.type})}catch(f){return console.error("\u274c useDAKUrlParams: Error fetching user:",f),void i("/",{state:{warningMessage:"Could not access the requested DAK. User '".concat(c,"' not found or not accessible.")}})}let a=null;try{console.log("useDAKUrlParams: Fetching repository data for ".concat(c,"/").concat(d));a=await n.A.getRepository(c,d),console.log("useDAKUrlParams: Repository data fetched successfully:",{name:a.name,full_name:a.full_name,owner:a.owner,default_branch:a.default_branch})}catch(f){return console.error("useDAKUrlParams: Error fetching repository:",f),void i("/",{state:{warningMessage:"Could not access the requested DAK. Repository '".concat(c,"/").concat(d,"' not found or not accessible.")}})}if(!await o.A.validateDAKRepository(c,d,u||a.default_branch))return console.log("Repository ".concat(c,"/").concat(d," is not a valid DAK repository")),void i("/",{state:{warningMessage:"Could not access the requested DAK. Repository '".concat(c,"/").concat(d,"' not found or not accessible.")}});if(u)try{await n.A.getBranch(c,d,u),v(u)}catch(f){console.warn("Branch '".concat(u,"' not found, falling back to default branch")),v(a.default_branch)}else v(a.default_branch);console.log("useDAKUrlParams: Setting final state:",{profile:{login:e.login,name:e.name,type:e.type},repository:{name:a.name,full_name:a.full_name,owner:a.owner,default_branch:a.default_branch},selectedBranch:u||a.default_branch}),h(e),g(a),x(!1)}catch(f){console.error("Error fetching data from URL params:",f),A("Failed to load DAK data. Please check the URL or try again."),x(!1)}}})()},[c,d,u,m,p,i,l.state]),{profile:m,repository:p,selectedBranch:f,loading:y,error:w,user:c,repo:d,branch:u||f,navigate:i}}},75630:(e,a,s)=>{s.r(a),s.d(a,{default:()=>d});var t=s(89379),r=s(9950),n=s(69396),o=s(46901),l=s(53314),i=s(53782),c=s(44414);const d=()=>{const e=(0,n.Zp)(),{profile:a,repository:s,selectedBranch:d,loading:u,error:m}=(0,l.A)(),[h,p]=(0,r.useState)([]),[g,f]=(0,r.useState)(!0),[v,y]=(0,r.useState)(null),[x,w]=(0,r.useState)(!1),[A,j]=(0,r.useState)("");(0,r.useEffect)(()=>{(async()=>{if(s&&a)try{var e;const t=a.token&&(null===(e=s.permissions)||void 0===e?void 0:e.push);w(t||!1)}catch(v){console.warn("Could not check write permissions:",v),w(!1)}})()},[s,a]),(0,r.useEffect)(()=>{!u&&s&&(async()=>{if(s)try{var a;f(!0),y(null);const e=(null===(a=s.owner)||void 0===a?void 0:a.login)||s.full_name.split("/")[0],r=s.name,n=d||"main";console.log("\ud83d\udd0d ProgramIndicatorsViewer: Fetching measure files from ".concat(e,"/").concat(r," (branch: ").concat(n,")"));const l=(await o.A.getContents(e,r,"input/fsh/measures",n)).filter(e=>e.name.endsWith(".fsh")),i=await Promise.all(l.map(async a=>{try{const s=await o.A.getFileContent(e,r,a.path,n),l=b(s);return(0,t.A)((0,t.A)({},a),{},{title:l||a.name.replace(".fsh",""),content:s})}catch(s){return console.warn("Could not load content for ".concat(a.name,":"),s),(0,t.A)((0,t.A)({},a),{},{title:a.name.replace(".fsh",""),content:null})}}));console.log("\ud83d\udcca ProgramIndicatorsViewer: Loaded measure files:",{count:i.length,files:i.map(e=>({name:e.name,title:e.title}))}),p(i),f(!1)}catch(r){console.error("Error loading measure files:",r),y(r.message),f(!1)}else e("/")})()},[s,d,u,e]);const b=e=>{if(!e)return null;const a=e.match(/^Title:\s*"(.+)"$/m);if(a)return a[1];const s=e.match(/^\*\s*title\s*=\s*"(.+)"$/m);return s?s[1]:null},N=h.filter(e=>{if(!A)return!0;const a=A.toLowerCase();return e.title.toLowerCase().includes(a)||e.name.toLowerCase().includes(a)}),P=t=>{var r;const n=(null===(r=s.owner)||void 0===r?void 0:r.login)||s.full_name.split("/")[0],o=s.name,l=d?"/program-indicator-editor/".concat(n,"/").concat(o,"/").concat(d,"/").concat(encodeURIComponent(t.path)):"/program-indicator-editor/".concat(n,"/").concat(o,"/").concat(encodeURIComponent(t.path));e(l,{state:{profile:a,repository:s,selectedBranch:d,measure:t}})};return u?(0,c.jsx)(i.Mx,{pageName:"program-indicators-viewer",children:(0,c.jsxs)("div",{className:"loading-container",children:[(0,c.jsx)("div",{className:"loading-spinner"}),(0,c.jsx)("p",{children:"Loading..."})]})}):m?(0,c.jsx)(i.Mx,{pageName:"program-indicators-viewer",children:(0,c.jsxs)("div",{className:"error-container",children:[(0,c.jsx)("h2",{children:"Error"}),(0,c.jsx)("p",{children:m})]})}):(0,c.jsx)(i.Mx,{pageName:"program-indicators-viewer",children:(0,c.jsxs)("div",{className:"program-indicators-viewer",children:[(0,c.jsxs)("div",{className:"viewer-header",children:[(0,c.jsx)("h1",{children:"Program Indicators & Measures"}),(0,c.jsxs)("p",{children:["Performance indicators and measurement definitions for monitoring and evaluation in"," ",(0,c.jsx)("strong",{children:null===s||void 0===s?void 0:s.name}),d&&(0,c.jsxs)("span",{children:[" on branch ",(0,c.jsx)("code",{className:"branch-display",children:d})]})]})]}),(0,c.jsxs)("div",{className:"viewer-controls",children:[(0,c.jsx)("div",{className:"search-box",children:(0,c.jsx)("input",{type:"text",placeholder:"Search measures by title or name...",value:A,onChange:e=>j(e.target.value),className:"search-input"})}),(0,c.jsx)("div",{className:"controls-info",children:(0,c.jsxs)("span",{className:"measure-count",children:[N.length," measure",1!==N.length?"s":""," found"]})})]}),g&&(0,c.jsxs)("div",{className:"loading-state",children:[(0,c.jsx)("div",{className:"loading-spinner"}),(0,c.jsx)("p",{children:"Loading measure files..."})]}),v&&(0,c.jsxs)("div",{className:"error-message",children:[(0,c.jsx)("span",{className:"error-icon",children:"\u26a0\ufe0f"}),v]}),!g&&!v&&0===N.length&&(0,c.jsxs)("div",{className:"empty-state",children:[(0,c.jsx)("div",{className:"empty-icon",children:"\ud83d\udcca"}),(0,c.jsx)("h3",{children:"No measures found"}),(0,c.jsx)("p",{children:A?'No measures match "'.concat(A,'"'):"No measure files found in input/fsh/measures directory"})]}),!g&&!v&&N.length>0&&(0,c.jsx)("div",{className:"measures-list",children:N.map(e=>(0,c.jsxs)("div",{className:"measure-card",onClick:()=>P(e),onKeyPress:a=>{"Enter"!==a.key&&" "!==a.key||P(e)},role:"button",tabIndex:0,children:[(0,c.jsx)("div",{className:"measure-icon",children:"\ud83d\udcca"}),(0,c.jsxs)("div",{className:"measure-info",children:[(0,c.jsx)("h3",{className:"measure-title",children:e.title}),(0,c.jsxs)("div",{className:"measure-meta",children:[(0,c.jsx)("span",{className:"measure-filename",children:e.name}),(0,c.jsx)("span",{className:"measure-path",children:e.path})]})]}),(0,c.jsx)("div",{className:"measure-actions",children:(0,c.jsx)("button",{className:"action-button view-button",onClick:a=>{a.stopPropagation(),P(e)},children:x?"\u270f\ufe0f Edit":"\ud83d\udc41\ufe0f View"})})]},e.path))})]})})}}}]);