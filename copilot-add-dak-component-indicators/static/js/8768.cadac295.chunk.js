"use strict";(self.webpackChunksgex_workbench=self.webpackChunksgex_workbench||[]).push([[8768],{8768:(e,r,n)=>{n.r(r),n.d(r,{default:()=>l});var s=n(89379),i=n(9950),t=n(69396),a=n(53782),o=n(46901),c=n(57561),d=n(44414);const l=()=>{const e=(0,t.Zp)(),{repository:r,branch:n}=(0,a.N5)(),{"*":l}=(0,t.g)(),[m,h]=(0,i.useState)(!0),[g,p]=(0,i.useState)(null),[x,j]=(0,i.useState)(""),[u,f]=(0,i.useState)(""),[v,N]=(0,i.useState)({id:"",name:"",definition:"",numerator:"",denominator:"",disaggregation:"",descriptionString:"",descriptionUri:"",references:[]});(0,i.useEffect)(()=>{(async()=>{if(r&&l)try{var s;h(!0),p(null);const e=(null===(s=r.owner)||void 0===s?void 0:s.login)||r.full_name.split("/")[0],i=r.name,t=n||"main",a=decodeURIComponent(l);console.log("Loading measure file:",{owner:e,repoName:i,path:a,ref:t});const c=await o.A.getFileContent(e,i,a,t);j(c),f(c);const d=S(c);N(d),h(!1)}catch(i){console.error("Error loading measure file:",i),p(i.message),h(!1)}else e("/")})()},[r,n,l,e]);const S=e=>{const r={id:"",name:"",definition:"",numerator:"",denominator:"",disaggregation:"",descriptionString:"",descriptionUri:"",references:[]};if(!e)return r;const n=e.match(/^Instance:\s+(\S+)/m);n&&(r.id=n[1]);const s=e.match(/^Title:\s*"(.+)"$/m);s&&(r.name=s[1]);const i=e.match(/^\*\s*description\s*=\s*"(.+)"$/m);i&&(r.definition=i[1]);const t=e.match(/population\[numerator\][\s\S]*?description\s*=\s*"(.+?)"/);t&&(r.numerator=t[1]);const a=e.match(/population\[denominator\][\s\S]*?description\s*=\s*"(.+?)"/);a&&(r.denominator=a[1]);const o=e.matchAll(/^\/\/\s*(.+)$/gm);for(const c of o){const e=c[1].trim();if(e.toLowerCase().startsWith("disaggregation:"))r.disaggregation=e.substring(15).trim();else if(e.toLowerCase().startsWith("references:")){const n=e.substring(11).trim();r.references=n.split(",").map(e=>e.trim()).filter(e=>e)}}return r},b=(e,r)=>{const n=(0,s.A)((0,s.A)({},v),{},{[e]:r});N(n);const i=(e=>{let r=u;if(e.id&&e.id!==v.id&&(r=r.replace(/^Instance:\s+\S+/m,"Instance: ".concat(e.id))),e.name&&(r=r.replace(/^Title:\s*".+"$/m,'Title: "'.concat(e.name,'"')),r=r.replace(/^\*\s*title\s*=\s*".+"$/m,'* title = "'.concat(e.name,'"')),r=r.replace(/^\*\s*name\s*=\s*".+"$/m,'* name = "'.concat(e.id,'"'))),e.definition&&(r=r.replace(/^\*\s*description\s*=\s*".+"$/m,'* description = "'.concat(e.definition,'"'))),e.numerator&&(r=r.replace(/(population\[numerator\][\s\S]*?description\s*=\s*")(.+?)(")/,"$1".concat(e.numerator,"$3"))),e.denominator&&(r=r.replace(/(population\[denominator\][\s\S]*?description\s*=\s*")(.+?)(")/,"$1".concat(e.denominator,"$3"))),e.disaggregation||e.references.length>0){const n=r.split("\n"),s=n.findIndex(e=>e.startsWith("Title:"));if(s>=0){const i=[];e.disaggregation&&i.push("// Disaggregation: ".concat(e.disaggregation)),e.references.length>0&&i.push("// References: ".concat(e.references.join(", "))),n.splice(s+1,0,...i),r=n.join("\n")}}return r})(n);f(i)},F=u!==x;if(m)return(0,d.jsx)(a.ox,{pageName:"program-indicator-editor",file:{name:"Loading...",path:l},repository:r,branch:n,content:"",originalContent:"",hasChanges:!1,showSaveButtons:!1,children:(0,d.jsxs)("div",{className:"editor-loading",children:[(0,d.jsx)("div",{className:"loading-spinner"}),(0,d.jsx)("p",{children:"Loading measure..."})]})});if(g)return(0,d.jsx)(a.ox,{pageName:"program-indicator-editor",file:{name:"Error",path:l},repository:r,branch:n,content:"",originalContent:"",hasChanges:!1,showSaveButtons:!1,children:(0,d.jsxs)("div",{className:"editor-error",children:[(0,d.jsx)("h3",{children:"Error Loading Measure"}),(0,d.jsx)("p",{children:g}),(0,d.jsx)("button",{onClick:()=>e(-1),children:"Go Back"})]})});const C=l?decodeURIComponent(l).split("/").pop():"measure.fsh";return(0,d.jsx)(a.ox,{pageName:"program-indicator-editor",file:{name:C,path:l},repository:r,branch:n,content:u,originalContent:x,hasChanges:F,onSave:async(e,r)=>{try{if("local"===r){const r=decodeURIComponent(l);return c.A.updateFile(r,e,{source:"program-indicator-editor",timestamp:Date.now()}),console.log("Saved to staging ground:",r),{result:"success"}}return console.log("GitHub save not yet implemented"),{result:"error",message:"GitHub save not implemented"}}catch(g){return console.error("Save error:",g),{result:"error",message:g.message}}},saveButtonsPosition:"top",children:(0,d.jsxs)("div",{className:"program-indicator-editor",children:[(0,d.jsxs)("div",{className:"editor-header",children:[(0,d.jsx)("h2",{children:"Program Indicator Editor"}),(0,d.jsx)("p",{children:"Edit ProgramIndicator Logical Model fields mapped to FHIR Measure FSH"})]}),(0,d.jsxs)("div",{className:"editor-layout",children:[(0,d.jsxs)("div",{className:"editor-panel lm-fields-panel",children:[(0,d.jsx)("h3",{children:"ProgramIndicator LM Fields"}),(0,d.jsx)("div",{className:"field-mapping-note",children:(0,d.jsx)("small",{children:"WHO SMART Base ProgramIndicator Logical Model fields mapped to FHIR Measure FSH"})}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsxs)("label",{htmlFor:"id",children:[(0,d.jsx)("strong",{children:"ID"})," ",(0,d.jsx)("span",{className:"required",children:"*"}),(0,d.jsx)("small",{children:"Indicator ID (letters, numbers, hyphens, dots, 1-64 chars)"})]}),(0,d.jsx)("input",{id:"id",type:"text",value:v.id,onChange:e=>b("id",e.target.value),pattern:"[A-Za-z0-9\\-\\.]{1,64}",className:"form-control"})]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsxs)("label",{htmlFor:"name",children:[(0,d.jsx)("strong",{children:"Name"})," ",(0,d.jsx)("span",{className:"required",children:"*"}),(0,d.jsx)("small",{children:"Name of the indicator (maps to FSH Title and name)"})]}),(0,d.jsx)("input",{id:"name",type:"text",value:v.name,onChange:e=>b("name",e.target.value),className:"form-control"})]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsxs)("label",{htmlFor:"definition",children:[(0,d.jsx)("strong",{children:"Definition"})," ",(0,d.jsx)("span",{className:"required",children:"*"}),(0,d.jsx)("small",{children:"Definition of what the indicator measures (maps to FSH description)"})]}),(0,d.jsx)("textarea",{id:"definition",value:v.definition,onChange:e=>b("definition",e.target.value),rows:3,className:"form-control"})]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsxs)("label",{htmlFor:"numerator",children:[(0,d.jsx)("strong",{children:"Numerator"})," ",(0,d.jsx)("span",{className:"required",children:"*"}),(0,d.jsx)("small",{children:"Description of the numerator calculation"})]}),(0,d.jsx)("textarea",{id:"numerator",value:v.numerator,onChange:e=>b("numerator",e.target.value),rows:3,className:"form-control"})]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsxs)("label",{htmlFor:"denominator",children:[(0,d.jsx)("strong",{children:"Denominator"})," ",(0,d.jsx)("span",{className:"required",children:"*"}),(0,d.jsx)("small",{children:"Description of the denominator calculation"})]}),(0,d.jsx)("textarea",{id:"denominator",value:v.denominator,onChange:e=>b("denominator",e.target.value),rows:3,className:"form-control"})]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsxs)("label",{htmlFor:"disaggregation",children:[(0,d.jsx)("strong",{children:"Disaggregation"})," ",(0,d.jsx)("span",{className:"required",children:"*"}),(0,d.jsx)("small",{children:"Description of how the indicator should be disaggregated (stored as FSH comment)"})]}),(0,d.jsx)("textarea",{id:"disaggregation",value:v.disaggregation,onChange:e=>b("disaggregation",e.target.value),rows:2,className:"form-control"})]}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsxs)("label",{htmlFor:"references",children:[(0,d.jsx)("strong",{children:"References"}),(0,d.jsx)("small",{children:"Health Intervention IDs (comma-separated, stored as FSH comment)"})]}),(0,d.jsx)("input",{id:"references",type:"text",value:v.references.join(", "),onChange:e=>{const r=e.target.value.split(",").map(e=>e.trim()).filter(e=>e);b("references",r)},className:"form-control",placeholder:"intervention-1, intervention-2"})]}),(0,d.jsxs)("div",{className:"field-mapping-help",children:[(0,d.jsx)("h4",{children:"Field Mapping Table"}),(0,d.jsxs)("table",{className:"mapping-table",children:[(0,d.jsx)("thead",{children:(0,d.jsxs)("tr",{children:[(0,d.jsx)("th",{children:"LM Field"}),(0,d.jsx)("th",{children:"FSH Mapping"})]})}),(0,d.jsxs)("tbody",{children:[(0,d.jsxs)("tr",{children:[(0,d.jsx)("td",{children:(0,d.jsx)("code",{children:"id"})}),(0,d.jsx)("td",{children:(0,d.jsxs)("code",{children:["Instance: ","{"," id ","}"]})})]}),(0,d.jsxs)("tr",{children:[(0,d.jsx)("td",{children:(0,d.jsx)("code",{children:"name"})}),(0,d.jsx)("td",{children:(0,d.jsxs)("code",{children:['Title: "',"{"," name ","}",'"']})})]}),(0,d.jsxs)("tr",{children:[(0,d.jsx)("td",{children:(0,d.jsx)("code",{children:"definition"})}),(0,d.jsx)("td",{children:(0,d.jsxs)("code",{children:['* description = "',"{"," definition ","}",'"']})})]}),(0,d.jsxs)("tr",{children:[(0,d.jsx)("td",{children:(0,d.jsx)("code",{children:"numerator"})}),(0,d.jsx)("td",{children:(0,d.jsx)("code",{children:"population[numerator].description"})})]}),(0,d.jsxs)("tr",{children:[(0,d.jsx)("td",{children:(0,d.jsx)("code",{children:"denominator"})}),(0,d.jsx)("td",{children:(0,d.jsx)("code",{children:"population[denominator].description"})})]}),(0,d.jsxs)("tr",{children:[(0,d.jsx)("td",{children:(0,d.jsx)("code",{children:"disaggregation"})}),(0,d.jsx)("td",{children:(0,d.jsx)("code",{children:"// Disaggregation: { value }"})})]}),(0,d.jsxs)("tr",{children:[(0,d.jsx)("td",{children:(0,d.jsx)("code",{children:"references"})}),(0,d.jsx)("td",{children:(0,d.jsx)("code",{children:"// References: { ids }"})})]})]})]})]})]}),(0,d.jsxs)("div",{className:"editor-panel fsh-preview-panel",children:[(0,d.jsx)("h3",{children:"FHIR Measure FSH Preview"}),(0,d.jsx)("div",{className:"fsh-preview",children:(0,d.jsx)("pre",{children:(0,d.jsx)("code",{children:u})})})]})]})]})})}}}]);