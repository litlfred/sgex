"use strict";(self.webpackChunksgex_workbench=self.webpackChunksgex_workbench||[]).push([[7014],{87014:(e,n,t)=>{t.r(n),t.d(n,{default:()=>j});var i=t(89379),a=t(9950),s=t(85001),c=t(53782),l=t(96143);function o(){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const n={type:"ApplicationLayer",name:"FHIR Logical Models Overview",description:"Strategic view of DAK Component 2: Core Data Dictionary logical models and relationships",elements:[],relationships:[],views:[]};return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach((e,t)=>{const i={id:"lm-".concat(t),name:r(e)||"LogicalModel-".concat(t+1),type:"ApplicationComponent",description:d(e),properties:{source:"FHIR Logical Model",fshFile:e.path||e.name,elementCount:m(e)}};n.elements.push(i)}),e.forEach((e,t)=>{const i={id:"concept-".concat(t),name:e.display||e.code||"Concept-".concat(t+1),type:"DataObject",description:e.definition||"DAK concept definition",properties:{source:"DAK CodeSystem",code:e.code,system:"DAK.CodeSystem"}};n.elements.push(i)}),function(e){const n=e.elements.filter(e=>"ApplicationComponent"===e.type),t=e.elements.filter(e=>"DataObject"===e.type);n.forEach(n=>{t.forEach(t=>{const i="".concat(n.name," ").concat(n.description).toLowerCase(),a=t.name.toLowerCase();(i.includes(a)||a.includes(n.name.toLowerCase()))&&e.relationships.push({id:"rel-".concat(n.id,"-").concat(t.id),source:n.id,target:t.id,type:"Association",name:"uses concept"})})});for(let i=0;i<n.length;i++)for(let t=i+1;t<n.length;t++){const a=n[i],s=n[t];p(a.name,s.name)&&e.relationships.push({id:"rel-".concat(a.id,"-").concat(s.id),source:a.id,target:s.id,type:"Association",name:"related to"})}}(n),n.views.push({id:"strategic-overview",name:"Core Data Dictionary Strategic View",type:"ApplicationLayerView",elements:n.elements.map(e=>e.id),description:"High-level overview of logical models and concept relationships in the DAK"}),n}function r(e){if(!e)return null;if(e.content){const n=e.content.match(/Logical:\s*([^\r\n]+)/);if(n)return n[1].trim();const t=e.content.match(/Title:\s*"([^"]+)"/);if(t)return t[1]}return e.path?e.path.split("/").pop().replace(/\.(fsh|json)$/,""):e.name?e.name.replace(/\.(fsh|json)$/,""):null}function d(e){if(null===e||void 0===e||!e.content)return"FHIR Logical Model component";const n=e.content.match(/Description:\s*"([^"]+)"/);if(n)return n[1];const t=e.content.match(/\/\/\s*(.+)/);return t?t[1].trim():"FHIR Logical Model defining data structure and constraints"}function m(e){if(null===e||void 0===e||!e.content)return 0;const n=e.content.match(/^\s*\*\s+/gm);return n?n.length:0}function p(e,n){if(!e||!n)return!1;const t=e=>e.toLowerCase().replace(/[-_\s]/g,""),i=(t(e),t(n),e.toLowerCase().split(/[-_\s]+/)),a=n.toLowerCase().split(/[-_\s]+/);return i.filter(e=>a.includes(e)&&e.length>2).length>0}function h(e){var n;const t={content:e,elements:[],relationships:[],constraints:[],metadata:{}},i=e.match(/Title:\s*"([^"]+)"/),a=e.match(/Description:\s*"([^"]+)"/),s=e.match(/Logical:\s*([^\r\n]+)/);t.metadata={title:null===i||void 0===i?void 0:i[1],description:null===a||void 0===a?void 0:a[1],logical:null===s||void 0===s||null===(n=s[1])||void 0===n?void 0:n.trim()};return e.split("\n").forEach((e,n)=>{const i=e.trim().match(/^\*\s+([^\s]+)\s+([^\s]+)\s+([^\s"]+)(?:\s+"([^"]+)")?/);i&&t.elements.push({name:i[1],cardinality:i[2],type:i[3],description:i[4]||"",lineNumber:n+1})}),t}var u=t(29946),f=t(29166),g=t(44414);const v=()=>{const e=(0,s.Zp)(),{profile:n,repository:t,branch:r}=(0,c.N5)(),d=(0,s.g)(),m=d.user||(null===n||void 0===n?void 0:n.login),p=d.repo||(null===t||void 0===t?void 0:t.name),v=d.branch||r||(null===t||void 0===t?void 0:t.default_branch)||"main",[j,w]=(0,a.useState)(!0),[N,y]=(0,a.useState)(null),[b,M]=(0,a.useState)("strategic"),[C,L]=(0,a.useState)([]),[F,D]=(0,a.useState)([]),[S,A]=(0,a.useState)(null),[E,P]=(0,a.useState)(""),[_,k]=(0,a.useState)([]),[R,B]=(0,a.useState)(null),[H,I]=(0,a.useState)([]),z=(0,a.useRef)(null),O=(0,a.useRef)(null),K=((0,a.useRef)(null),(0,a.useRef)(null)),W=(0,a.useRef)(null),T=(0,a.useCallback)(async()=>{try{const n=await u.A.getDirectoryContents(m,p,"input/fsh",v);L(n);const t=[];for(const c of n)if(c.name.endsWith(".fsh"))try{const e=await u.A.getFileContent(m,p,c.path,v);if(e.includes("Logical:")){const n=h(e);t.push((0,i.A)((0,i.A)({},n),{},{fileName:c.name,path:c.path}))}}catch(e){console.warn("Failed to parse FSH file ".concat(c.name,":"),e)}k(t);const a=n.find(e=>"DAK.fsh"===e.name);if(a)try{const e=await u.A.getFileContent(m,p,a.path,v),n=X(e);I(n)}catch(e){console.warn("Failed to load DAK concepts:",e)}const s=o(t,H);B(s)}catch(e){console.error("Error loading logical models:",e),y("Failed to load logical models from FSH files")}},[m,p,v,H]),V=(0,a.useCallback)(async()=>{try{const e=(await u.A.getDirectoryContents(m,p,"input/maps",v)).filter(e=>e.name.endsWith(".fml"));if(D(e),e.length>0){const n=e[0];A(n);const t=await u.A.getFileContent(m,p,n.path,v);P(t)}}catch(e){console.warn("No FML files found or error loading:",e)}},[m,p,v]),X=e=>{const n=[],t=e.split("\n");for(let i=0;i<t.length;i++){const e=t[i].trim().match(/^\*\s*#([^\s"]+)\s*"([^"]+)"\s*"([^"]+)"/);e&&n.push({code:e[1],display:e[2],definition:e[3]})}return n};(0,a.useEffect)(()=>{(async()=>{if(m&&p){w(!0),y(null);try{await Promise.all([T(),V()])}catch(n){y(n.message||"Failed to initialize FML/StructureMap editor")}finally{w(!1)}}else e("/")})()},[m,p,v,e,T,V]),(0,a.useEffect)(()=>{(async()=>{if("strategic"===b&&K.current&&R&&!z.current)try{const e=await(0,l.Nc)({container:K.current});z.current=e,await e.importModel(R),console.log("ArchiMate viewer initialized successfully")}catch(e){console.error("Failed to initialize ArchiMate viewer:",e)}})()},[b,R]),(0,a.useEffect)(()=>{(async()=>{if("technical"===b&&W.current&&!O.current)try{const e=await(0,l._Q)({container:W.current});O.current=e;const n=q(_);await e.importXML(n),console.log("Mapping viewer initialized successfully")}catch(e){console.error("Failed to initialize mapping viewer:",e)}})()},[b,_]);const q=e=>{const n=e.map((e,n)=>{var t,i;const a=100+n%3*300,s=100+200*Math.floor(n/3);return'\n        <bpmn:task id="model_'.concat(n,'" name="').concat((null===(t=e.metadata)||void 0===t?void 0:t.title)||e.fileName,'">\n          <bpmn:documentation>Logical Model: ').concat((null===(i=e.metadata)||void 0===i?void 0:i.description)||"FHIR logical model",'</bpmn:documentation>\n        </bpmn:task>\n        <bpmndi:BPMNShape id="model_').concat(n,'_di" bpmnElement="model_').concat(n,'">\n          <dc:Bounds x="').concat(a,'" y="').concat(s,'" width="100" height="80" />\n        </bpmndi:BPMNShape>\n      ')}).join("\n");return'<?xml version="1.0" encoding="UTF-8"?>\n<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" \n                  xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" \n                  xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" \n                  xmlns:di="http://www.omg.org/spec/DD/20100524/DI" \n                  id="Definitions_1" \n                  targetNamespace="http://fml.mapping.example">\n  <bpmn:process id="Process_1" isExecutable="false">\n    '.concat(n,'\n  </bpmn:process>\n  <bpmndi:BPMNDiagram id="BPMNDiagram_1">\n    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="Process_1">\n      ').concat(n,"\n    </bpmndi:BPMNPlane>\n  </bpmndi:BPMNDiagram>\n</bpmn:definitions>")};return n&&t?j?(0,g.jsx)("div",{className:"fml-editor loading-state",children:(0,g.jsxs)("div",{className:"loading-content",children:[(0,g.jsx)("h2",{children:"Loading FML/StructureMap Editor..."}),(0,g.jsx)("p",{children:"Initializing logical models and mapping capabilities..."})]})}):(0,g.jsxs)("div",{className:"fml-editor",children:[(0,g.jsxs)("div",{className:"fml-editor-header",children:[(0,g.jsxs)("div",{className:"who-branding",children:[(0,g.jsx)("h1",{onClick:()=>{n&&t?e("/dashboard",{state:{profile:n,repository:t,branch:v}}):e("/")},className:"clickable-title",children:"SGEX Workbench"}),(0,g.jsx)("p",{className:"subtitle",children:"WHO SMART Guidelines Exchange"})]}),(0,g.jsxs)("div",{className:"context-info",children:[(0,g.jsx)("img",{src:(null===n||void 0===n?void 0:n.avatar_url)||"https://github.com/".concat(m,".png"),alt:"Profile",className:"context-avatar"}),(0,g.jsxs)("div",{className:"context-details",children:[(0,g.jsx)("span",{className:"context-repo",children:p}),(0,g.jsx)("span",{className:"context-component",children:"FML/StructureMap Editor"})]})]})]}),(0,g.jsxs)("div",{className:"view-mode-selector",children:[(0,g.jsx)("button",{className:"mode-btn ".concat("strategic"===b?"active":""),onClick:()=>M("strategic"),children:"\ud83d\udcca Strategic View (ArchiMate)"}),(0,g.jsx)("button",{className:"mode-btn ".concat("technical"===b?"active":""),onClick:()=>M("technical"),children:"\ud83d\udd27 Technical View (Mapping)"})]}),N&&(0,g.jsxs)("div",{className:"error-banner",children:[(0,g.jsx)("strong",{children:"Error:"})," ",N]}),(0,g.jsx)("div",{className:"fml-editor-content",children:"strategic"===b?(0,g.jsxs)("div",{className:"strategic-view",children:[(0,g.jsxs)("div",{className:"strategic-header",children:[(0,g.jsx)("h2",{children:"Logical Models Strategic Overview"}),(0,g.jsx)("p",{children:"ArchiMate Application Layer visualization of FHIR Logical Models and relationships"})]}),(0,g.jsx)("div",{className:"archimate-section",children:(0,g.jsx)("div",{ref:K,className:"archimate-viewer-container",children:R?(0,g.jsxs)("div",{className:"archimate-fallback",children:[(0,g.jsxs)("h3",{children:["Logical Models (",R.elements.filter(e=>"ApplicationComponent"===e.type).length,")"]}),(0,g.jsx)("div",{className:"model-grid",children:R.elements.filter(e=>"ApplicationComponent"===e.type).map((e,n)=>{var t,i;return(0,g.jsxs)("div",{className:"model-card",children:[(0,g.jsx)("h4",{children:e.name}),(0,g.jsx)("p",{children:e.description}),(0,g.jsxs)("div",{className:"model-properties",children:[(0,g.jsxs)("span",{children:["Source: ",null===(t=e.properties)||void 0===t?void 0:t.fshFile]}),(0,g.jsxs)("span",{children:["Elements: ",(null===(i=e.properties)||void 0===i?void 0:i.elementCount)||0]})]})]},e.id)})}),(0,g.jsxs)("h3",{children:["DAK Concepts (",R.elements.filter(e=>"DataObject"===e.type).length,")"]}),(0,g.jsx)("div",{className:"concept-grid",children:R.elements.filter(e=>"DataObject"===e.type).map((e,n)=>{var t;return(0,g.jsxs)("div",{className:"concept-card",children:[(0,g.jsx)("h4",{children:e.name}),(0,g.jsx)("p",{children:e.description}),(0,g.jsx)("div",{className:"concept-properties",children:(0,g.jsxs)("span",{children:["Code: ",null===(t=e.properties)||void 0===t?void 0:t.code]})})]},e.id)})})]}):(0,g.jsxs)("div",{className:"no-models-message",children:[(0,g.jsx)("p",{children:"No logical models found in FSH files."}),(0,g.jsx)("p",{children:"Logical models are required for FML mapping visualization."})]})})})]}):(0,g.jsx)("div",{className:"technical-view",children:(0,g.jsxs)("div",{className:"technical-layout",children:[(0,g.jsxs)("div",{className:"fml-files-panel",children:[(0,g.jsx)("h3",{children:"FML Files"}),F.length>0?(0,g.jsx)("div",{className:"fml-file-list",children:F.map((e,n)=>(0,g.jsxs)("div",{className:"fml-file-item ".concat((null===S||void 0===S?void 0:S.path)===e.path?"selected":""),onClick:()=>(async e=>{try{A(e);const n=await u.A.getFileContent(m,p,e.path,v);P(n)}catch(n){console.error("Error loading FML file:",n),y("Failed to load FML file content")}})(e),children:[(0,g.jsx)("span",{className:"file-name",children:e.name}),(0,g.jsx)("span",{className:"file-path",children:e.path})]},n))}):(0,g.jsxs)("div",{className:"no-fml-files",children:[(0,g.jsx)("p",{children:"No FML files found in input/maps/"}),(0,g.jsx)("p",{children:"Create .fml files to define StructureMap transformations"})]})]}),(0,g.jsxs)("div",{className:"mapping-panel",children:[(0,g.jsx)("h3",{children:"Mapping Visualization"}),(0,g.jsx)("div",{ref:W,className:"mapping-viewer-container",children:(0,g.jsxs)("div",{className:"mapping-placeholder",children:[(0,g.jsx)("p",{children:"Interactive mapping visualization"}),(0,g.jsx)("p",{children:"Powered by diagram-js"})]})})]}),(0,g.jsxs)("div",{className:"fml-code-panel",children:[(0,g.jsx)("h3",{children:"FML Code Editor"}),(0,g.jsx)("div",{className:"fml-editor-container",children:S?(0,g.jsx)(x,{content:E,fileName:S.name,onChange:P}):(0,g.jsx)("div",{className:"no-file-selected",children:(0,g.jsx)("p",{children:"Select an FML file to edit"})})})]})]})})}),(0,g.jsx)(f.A,{pageId:"fml-structuremap-editor",notificationBadge:0===_.length?"No logical models found":null})]}):(e("/"),(0,g.jsx)("div",{children:"Redirecting..."}))},x=e=>{let{content:n,fileName:t,onChange:i}=e;const[s,c]=(0,a.useState)(null);return(0,a.useEffect)(()=>{(async()=>{try{const e=await(0,l.fR)();c(()=>e)}catch(e){console.error("Failed to load Monaco Editor:",e)}})()},[]),s?(0,g.jsx)(s,{height:"400px",language:"fhir-fml",theme:"vs-light",value:n,onChange:i,options:{selectOnLineNumbers:!0,roundedSelection:!1,readOnly:!1,cursorStyle:"line",automaticLayout:!0,minimap:{enabled:!1},scrollBeyondLastLine:!1,wordWrap:"on"}}):(0,g.jsx)("div",{className:"editor-loading",children:(0,g.jsx)("p",{children:"Loading FML editor..."})})},j=()=>(0,g.jsx)(c.Mx,{pageName:"fml-structuremap-editor",children:(0,g.jsx)(v,{})})},96143:(e,n,t)=>{t.d(n,{Cq:()=>a,Nc:()=>o,Ub:()=>s,_Q:()=>c,fR:()=>l});var i=t(57335);async function a(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new(await(0,i.sN)())(e)}async function s(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new(await(0,i.uW)())(e)}async function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new(await(0,i.M3)())(e)}async function l(){return await(0,i.Xr)()}async function o(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new(await(0,i.BC)())(e)}}}]);