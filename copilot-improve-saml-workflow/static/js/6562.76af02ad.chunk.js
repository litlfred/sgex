"use strict";(self.webpackChunksgex_workbench=self.webpackChunksgex_workbench||[]).push([[6562],{35922:(e,n,t)=>{t.r(n),t.d(n,{default:()=>l});var a=t(89379),o=t(9950),i=t(18518),r=t(53782),s=t(75658),c=t(44414);const l=()=>{(0,i.Zp)();const e=(0,r.oc)(),n=(0,s.f4)("personas"),[t,l]=(0,o.useState)(null),[d,u]=(0,o.useState)(!0),[p,m]=(0,o.useState)(!1),[h,b]=(0,o.useState)({}),[g,f]=(0,o.useState)(!1),[v,x]=(0,o.useState)(""),[j,k]=(0,o.useState)([]),[w,y]=(0,o.useState)(!1),[D,C]=(0,o.useState)("basic");(0,o.useEffect)(()=>{const e=e=>{"Escape"===e.key&&g&&f(!1)};if(g)return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[g]);const O=(0,o.useCallback)(async()=>{if(u(!0),n)try{l(A());const e=await n.retrieveAll();k(e.map(e=>({id:e.id,name:e.name||e.title,definition:e}))),console.log("Loaded ".concat(e.length," personas via Component Object"))}catch(e){console.error("Error initializing actor editor:",e),b({initialization:"Failed to initialize editor"})}finally{u(!1)}else console.log("Component Object not yet available, waiting...")},[n]);(0,o.useEffect)(()=>{e.error||e.loading||!n||O()},[e.error,e.loading,n,O]);const A=()=>({id:"actor-".concat(Date.now()),name:"",title:"",description:"",type:"Person",roles:[],qualifications:[],responsibilities:[]}),S=(0,o.useCallback)((e,n)=>{l(t=>(0,a.A)((0,a.A)({},t),{},{[e]:n})),h[e]&&b(n=>{const t=(0,a.A)({},n);return delete t[e],t})},[h]),N=(0,o.useCallback)(()=>{const e={};return null!==t&&void 0!==t&&t.name||(e.name="Actor name is required"),null!==t&&void 0!==t&&t.title||(e.title="Actor title is required"),null!==t&&void 0!==t&&t.type||(e.type="Actor type is required"),b(e),0===Object.keys(e).length},[t]),E=(0,o.useCallback)(async()=>{if(t&&n)try{const e=await n.validate(t);if(e.isValid){const e=z(t);x(e)}else b({general:e.errors.join(", ")})}catch(e){console.error("Error generating FSH preview:",e),b({general:"Failed to generate FSH preview"})}},[t,n]),z=e=>{let n="Instance: ".concat(e.id,"\n");return n+="InstanceOf: GenericPersona\n",n+='Title: "'.concat(e.title,'"\n'),n+='Description: "'.concat(e.description||e.title,'"\n'),n+='* name = "'.concat(e.name,'"\n'),n+="* type = #".concat(e.type,"\n"),e.roles&&e.roles.length>0&&e.roles.forEach(e=>{n+='* role = "'.concat(e.display||e.code,'"\n')}),e.qualifications&&e.qualifications.length>0&&e.qualifications.forEach(e=>{n+='* qualification = "'.concat(e.display||e.code,'"\n')}),n},q=(0,o.useCallback)(async()=>{if(N())if(n){m(!0);try{await n.save(t,{saveType:"file",path:"input/fsh/actors/".concat(t.id,".fsh"),commit:!1});const e=await n.retrieveAll();k(e.map(e=>({id:e.id,name:e.name||e.title,definition:e}))),b({}),console.log("Actor saved successfully via Component Object"),console.log("dak.json automatically updated with source reference"),alert("Actor saved successfully!")}catch(e){console.error("Error saving actor definition:",e),b({general:"Failed to save actor definition: ".concat(e.message)})}finally{m(!1)}}else b({general:"Component Object not available"})},[t,N,n]),F=(0,o.useCallback)(e=>{const n=j.find(n=>n.id===e);n&&(l(n.definition),y(!1))},[j]);if(e.error)return(0,c.jsx)(r.Mx,{pageName:"actor-editor-integrated",children:(0,c.jsx)("div",{className:"actor-editor-container",children:(0,c.jsx)("div",{className:"error-message",children:(0,c.jsx)("p",{children:e.error})})})});if(d||!t)return(0,c.jsx)(r.Mx,{pageName:"actor-editor-integrated",children:(0,c.jsx)("div",{className:"actor-editor-container",children:(0,c.jsx)("div",{className:"loading-message",children:(0,c.jsx)("p",{children:"Loading Actor Editor..."})})})});const P=n?"Using Component Object for data operations":"Waiting for Component Object initialization...";return(0,c.jsx)(r.Mx,{pageName:"actor-editor-integrated",children:(0,c.jsxs)("div",{className:"actor-editor-container",children:[(0,c.jsxs)("div",{className:"actor-editor-header",children:[(0,c.jsx)("h1",{children:"Generic Persona Editor (Integrated)"}),(0,c.jsx)("p",{className:"integration-note",children:"\u2705 This editor uses Component Objects - all changes automatically update dak.json"}),(0,c.jsx)("p",{className:"component-status",children:P})]}),h.general&&(0,c.jsx)("div",{className:"error-message",children:(0,c.jsx)("p",{children:h.general})}),(0,c.jsxs)("div",{className:"editor-actions",children:[(0,c.jsxs)("button",{onClick:()=>y(!w),children:[w?"Hide":"Show"," Staged Actors (",j.length,")"]}),(0,c.jsx)("button",{onClick:E,children:"Generate FSH Preview"}),(0,c.jsx)("button",{onClick:q,disabled:p||!n,children:p?"Saving...":"Save Actor"})]}),w&&(0,c.jsxs)("div",{className:"staged-actors-list",children:[(0,c.jsx)("h3",{children:"Staged Actors"}),(0,c.jsx)("ul",{children:j.map(e=>(0,c.jsx)("li",{onClick:()=>F(e.id),children:e.name},e.id))})]}),(0,c.jsxs)("div",{className:"editor-tabs",children:[(0,c.jsx)("button",{className:"basic"===D?"active":"",onClick:()=>C("basic"),children:"Basic Info"}),(0,c.jsx)("button",{className:"roles"===D?"active":"",onClick:()=>C("roles"),children:"Roles"}),(0,c.jsx)("button",{className:"qualifications"===D?"active":"",onClick:()=>C("qualifications"),children:"Qualifications"})]}),(0,c.jsxs)("div",{className:"editor-content",children:["basic"===D&&(0,c.jsxs)("div",{className:"basic-info",children:[(0,c.jsxs)("div",{className:"form-field",children:[(0,c.jsx)("label",{children:"Name *"}),(0,c.jsx)("input",{type:"text",value:t.name,onChange:e=>S("name",e.target.value),placeholder:"e.g., community-health-worker"}),h.name&&(0,c.jsx)("span",{className:"field-error",children:h.name})]}),(0,c.jsxs)("div",{className:"form-field",children:[(0,c.jsx)("label",{children:"Title *"}),(0,c.jsx)("input",{type:"text",value:t.title,onChange:e=>S("title",e.target.value),placeholder:"e.g., Community Health Worker"}),h.title&&(0,c.jsx)("span",{className:"field-error",children:h.title})]}),(0,c.jsxs)("div",{className:"form-field",children:[(0,c.jsx)("label",{children:"Description"}),(0,c.jsx)("textarea",{value:t.description,onChange:e=>S("description",e.target.value),placeholder:"Describe the actor's role and responsibilities...",rows:"4"})]}),(0,c.jsxs)("div",{className:"form-field",children:[(0,c.jsx)("label",{children:"Type *"}),(0,c.jsxs)("select",{value:t.type,onChange:e=>S("type",e.target.value),children:[(0,c.jsx)("option",{value:"Person",children:"Person"}),(0,c.jsx)("option",{value:"Organization",children:"Organization"}),(0,c.jsx)("option",{value:"Device",children:"Device"}),(0,c.jsx)("option",{value:"System",children:"System"})]})]})]}),"roles"===D&&(0,c.jsx)("div",{className:"roles-section",children:(0,c.jsx)("p",{children:"Roles management coming soon..."})}),"qualifications"===D&&(0,c.jsx)("div",{className:"qualifications-section",children:(0,c.jsx)("p",{children:"Qualifications management coming soon..."})})]}),g&&(0,c.jsx)("div",{className:"preview-modal",onClick:()=>f(!1),children:(0,c.jsxs)("div",{className:"preview-content",onClick:e=>e.stopPropagation(),children:[(0,c.jsxs)("div",{className:"preview-header",children:[(0,c.jsx)("h3",{children:"FSH Preview"}),(0,c.jsx)("button",{onClick:()=>f(!1),children:"\xd7"})]}),(0,c.jsx)("pre",{className:"fsh-code",children:v})]})}),(0,c.jsx)("style",{jsx:!0,children:"\n          .actor-editor-container {\n            padding: 20px;\n            max-width: 1200px;\n            margin: 0 auto;\n          }\n          .actor-editor-header {\n            margin-bottom: 20px;\n          }\n          .integration-note {\n            color: #0078d4;\n            font-weight: 500;\n            margin-top: 8px;\n          }\n          .component-status {\n            color: #666;\n            font-size: 0.9em;\n            margin-top: 4px;\n          }\n          .editor-actions {\n            display: flex;\n            gap: 10px;\n            margin-bottom: 20px;\n          }\n          .editor-actions button {\n            padding: 10px 20px;\n            background: #0078d4;\n            color: white;\n            border: none;\n            border-radius: 4px;\n            cursor: pointer;\n          }\n          .editor-actions button:disabled {\n            background: #ccc;\n            cursor: not-allowed;\n          }\n          .editor-actions button:hover:not(:disabled) {\n            background: #005a9e;\n          }\n          .staged-actors-list {\n            background: #f5f5f5;\n            padding: 15px;\n            border-radius: 4px;\n            margin-bottom: 20px;\n          }\n          .staged-actors-list ul {\n            list-style: none;\n            padding: 0;\n          }\n          .staged-actors-list li {\n            padding: 8px;\n            background: white;\n            margin: 5px 0;\n            border-radius: 4px;\n            cursor: pointer;\n          }\n          .staged-actors-list li:hover {\n            background: #e8e8e8;\n          }\n          .editor-tabs {\n            display: flex;\n            gap: 5px;\n            border-bottom: 2px solid #ddd;\n            margin-bottom: 20px;\n          }\n          .editor-tabs button {\n            padding: 10px 20px;\n            background: none;\n            border: none;\n            cursor: pointer;\n            border-bottom: 3px solid transparent;\n          }\n          .editor-tabs button.active {\n            border-bottom-color: #0078d4;\n            color: #0078d4;\n            font-weight: bold;\n          }\n          .editor-content {\n            background: white;\n            padding: 20px;\n            border-radius: 4px;\n            box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n          }\n          .form-field {\n            margin-bottom: 20px;\n          }\n          .form-field label {\n            display: block;\n            margin-bottom: 5px;\n            font-weight: 500;\n          }\n          .form-field input,\n          .form-field textarea,\n          .form-field select {\n            width: 100%;\n            padding: 8px;\n            border: 1px solid #ddd;\n            border-radius: 4px;\n          }\n          .field-error {\n            color: #d32f2f;\n            font-size: 0.9em;\n            display: block;\n            margin-top: 5px;\n          }\n          .preview-modal {\n            position: fixed;\n            top: 0;\n            left: 0;\n            right: 0;\n            bottom: 0;\n            background: rgba(0,0,0,0.5);\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            z-index: 1000;\n          }\n          .preview-content {\n            background: white;\n            padding: 20px;\n            border-radius: 8px;\n            max-width: 800px;\n            width: 90%;\n            max-height: 80vh;\n            overflow: auto;\n          }\n          .preview-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 15px;\n          }\n          .preview-header button {\n            font-size: 24px;\n            background: none;\n            border: none;\n            cursor: pointer;\n          }\n          .fsh-code {\n            background: #f5f5f5;\n            padding: 15px;\n            border-radius: 4px;\n            overflow-x: auto;\n          }\n          .error-message, .loading-message {\n            padding: 20px;\n            text-align: center;\n          }\n          .error-message {\n            background: #ffe6e6;\n            color: #d32f2f;\n            border-radius: 4px;\n          }\n        "})]})})}},75658:(e,n,t)=>{t.d(n,{f4:()=>s});var a=t(9950),o=t(89379),i=t(57561);new class{constructor(){this.dakFactory=null,this.currentDakObject=null,this.initialized=!1}async initializeForRepository(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"main";try{var a;const{DAKFactory:o}=await Promise.all([t.e(8900),t.e(5508),t.e(9082),t.e(2873),t.e(119)]).then(t.t.bind(t,90119,23));return this.dakFactory=new o(i.A),this.currentDakObject=await this.dakFactory.createFromRepository((null===(a=e.owner)||void 0===a?void 0:a.login)||e.full_name.split("/")[0],e.name,n),this.initialized=!0,this.currentDakObject}catch(o){return console.error("Failed to initialize DAK object:",o),console.warn("Using mock DAK object (dak-core not available)"),this.currentDakObject=this.createMockDakObject(e,n),this.initialized=!0,this.currentDakObject}}createMockDakObject(e,n){var t;const a=e=>({componentType:e,getSources:()=>[],addSource:n=>console.log("Mock: Add source to ".concat(e),n),retrieveAll:async()=>(console.log("Mock: Retrieve all from ".concat(e)),[]),retrieveById:async n=>(console.log("Mock: Retrieve ".concat(n," from ").concat(e)),null),save:async(n,t)=>{if(console.log("Mock: Save to ".concat(e),n,t),"businessProcesses"===e&&n.xml){const e=(null===t||void 0===t?void 0:t.filename)||"".concat(n.id,".bpmn");i.A.updateFile("input/process/".concat(e),n.xml)}else if("personas"===e&&n.fsh){const e=(null===t||void 0===t?void 0:t.filename)||"".concat(n.id,".fsh");i.A.updateFile("input/fsh/actors/".concat(e),n.fsh)}return{success:!0,id:n.id}},validate:async n=>(console.log("Mock: Validate in ".concat(e),n),{isValid:!0,errors:[],warnings:[]})});return{repository:{owner:null===(t=e.owner)||void 0===t?void 0:t.login,name:e.name},branch:n,metadata:{id:e.name,name:e.name,title:e.description||e.name,description:e.description||"",version:"0.0.1",status:"draft"},healthInterventions:a("healthInterventions"),personas:a("personas"),userScenarios:a("userScenarios"),businessProcesses:a("businessProcesses"),dataElements:a("dataElements"),decisionLogic:a("decisionLogic"),indicators:a("indicators"),requirements:a("requirements"),testScenarios:a("testScenarios"),getMetadata:()=>this.metadata,updateMetadata:e=>{this.metadata=(0,o.A)((0,o.A)({},this.metadata),e)},toJSON:()=>({metadata:this.metadata,components:{}}),saveDakJson:async()=>console.log("Mock: Save dak.json")}}getDakObject(){return this.currentDakObject}isInitialized(){return this.initialized&&null!==this.currentDakObject}async saveBpmnWorkflow(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this.currentDakObject)throw new Error("DAK object not initialized");const a=this.currentDakObject.businessProcesses;return await a.save({id:e.replace(".bpmn",""),name:t.name||e,description:t.description||"",xml:n},{filename:e,format:"bpmn",validate:!0})}async loadBpmnWorkflows(){if(!this.currentDakObject)throw new Error("DAK object not initialized");const e=this.currentDakObject.businessProcesses;return await e.retrieveAll()}async loadBpmnWorkflow(e){if(!this.currentDakObject)throw new Error("DAK object not initialized");const n=this.currentDakObject.businessProcesses;return await n.retrieveById(e)}async saveActor(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.currentDakObject)throw new Error("DAK object not initialized");const t=this.currentDakObject.personas;return await t.save({id:e.id,name:e.name,description:e.description,type:e.type,roles:e.roles,qualifications:e.qualifications,metadata:e.metadata},{format:n.format||"fsh",validate:!1!==n.validate})}async loadActors(){if(!this.currentDakObject)throw new Error("DAK object not initialized");const e=this.currentDakObject.personas;return await e.retrieveAll()}async loadActor(e){if(!this.currentDakObject)throw new Error("DAK object not initialized");const n=this.currentDakObject.personas;return await n.retrieveById(e)}async saveComponent(e,n,t){if(!this.currentDakObject)throw new Error("DAK object not initialized");const a=this.currentDakObject[e];if(!a)throw new Error("Unknown component type: ".concat(e));return await a.save(n,t)}async retrieveComponent(e){if(!this.currentDakObject)throw new Error("DAK object not initialized");const n=this.currentDakObject[e];if(!n)throw new Error("Unknown component type: ".concat(e));return await n.retrieveAll()}getComponentSources(e){if(!this.currentDakObject)return[];const n=this.currentDakObject[e];return n?n.getSources():[]}async saveDakJson(){if(!this.currentDakObject)throw new Error("DAK object not initialized");await this.currentDakObject.saveDakJson()}};t(44414);const r=(0,a.createContext)(null),s=e=>{const n=(()=>{const e=(0,a.useContext)(r);if(!e)throw new Error("useDakObject must be used within ComponentObjectProvider");return e})(),{dakObject:t,loading:o,error:i,refresh:s}=n,c=n[e];return c||o||!t||console.warn("Component type '".concat(e,"' not found in DAK object")),{component:c,dakObject:t,loading:o,error:i,refresh:s,retrieveAll:(0,a.useCallback)(async()=>c?await c.retrieveAll():(console.warn("Cannot retrieve from null component: ".concat(e)),[]),[c,e]),retrieveById:(0,a.useCallback)(async n=>c?await c.retrieveById(n):(console.warn("Cannot retrieve by id from null component: ".concat(e)),null),[c,e]),save:(0,a.useCallback)(async(n,t)=>{if(!c)throw new Error("Cannot save to null component: ".concat(e));return await c.save(n,t)},[c,e]),validate:(0,a.useCallback)(async n=>c?await c.validate(n):(console.warn("Cannot validate with null component: ".concat(e)),{isValid:!0,errors:[],warnings:[]}),[c,e]),getSources:(0,a.useCallback)(()=>c?c.getSources():(console.warn("Cannot get sources from null component: ".concat(e)),[]),[c,e]),addSource:(0,a.useCallback)(n=>{if(!c)throw new Error("Cannot add source to null component: ".concat(e));return c.addSource(n)},[c,e])}}}}]);