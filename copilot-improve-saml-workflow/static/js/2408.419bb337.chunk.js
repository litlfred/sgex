"use strict";(self.webpackChunksgex_workbench=self.webpackChunksgex_workbench||[]).push([[2408],{98700:(e,a,s)=>{s.r(a),s.d(a,{default:()=>p});var i=s(89379),n=s(9950),l=s(18518),t=s(67818),o=s(46901),r=s(29473),c=s(78952),d=s(53155),h=s(53782),g=s(1932),u=s(44414);const p=()=>{const{t:e}=(0,t.Bd)(),[a,s]=(0,n.useState)(null),[p,m]=(0,n.useState)([]),[f,x]=(0,n.useState)(!1),[j,v]=(0,n.useState)(!1),[N,b]=(0,n.useState)(null),[w,z]=(0,n.useState)({}),[k,O]=(0,n.useState)(null),[A,y]=(0,n.useState)(!1),[H,W]=(0,n.useState)(null),C=(0,l.Zp)(),S=(0,l.zy)(),E=(0,n.useCallback)((e,a)=>{if(!o.A.isAuth())return;const s={};if(e){const a=r.A.getCachedRepositories(e.login,"user");a&&a.repositories&&(s["user-".concat(e.login)]=a.repositories.length)}a.forEach(e=>{const a=r.A.getCachedRepositories(e.login,"org");a&&a.repositories&&(s["org-".concat(e.login)]=a.repositories.length)}),z(s)},[]),_=(0,n.useCallback)(async()=>{v(!0),b(null);try{let a=null;f?(await o.A.checkTokenPermissions(),a=await o.A.getCurrentUser(),s(a)):(a=null,s(null));let n=[];if(f)try{n=await o.A.getUserOrganizations()}catch(N){console.error("Error fetching organizations:",N),n=[]}try{const e=await o.A.getWHOOrganization(),a=n.findIndex(e=>"WorldHealthOrganization"===e.login);a>=0?n[a]=(0,i.A)((0,i.A)((0,i.A)({},n[a]),e),{},{isWHO:!0}):n.unshift(e)}catch(e){console.warn("Could not fetch WHO organization data, using fallback:",e);const a={id:"who-organization",login:"WorldHealthOrganization",name:"World Health Organization",description:"The World Health Organization is a specialized agency of the United Nations responsible for international public health.",avatar_url:"https://avatars.githubusercontent.com/u/12261302?s=200&v=4",html_url:"https://github.com/WorldHealthOrganization",type:"Organization",isWHO:!0};n.some(e=>"WorldHealthOrganization"===e.login)?n=n.map(e=>"WorldHealthOrganization"===e.login?(0,i.A)((0,i.A)({},e),{},{isWHO:!0}):e):n.unshift(a)}m(n),f&&E(a,n)}catch(N){console.error("Error fetching user data:",N),f?(b("Failed to fetch user data. Please check your connection and try again."),x(!1),o.A.logout()):b("Unable to fetch additional data. Some features may be limited.")}finally{v(!1)}},[E,f]);(0,n.useEffect)(()=>{(()=>{const e=o.A.initializeFromStoredToken();x(!!e)})()},[]),(0,n.useEffect)(()=>{c.A.registerModalCallback(e=>{W(e),y(!0)})},[]),(0,n.useEffect)(()=>{var e;null!==(e=S.state)&&void 0!==e&&e.warningMessage&&(O(S.state.warningMessage),C(S.pathname,{replace:!0,state:{}}))},[S.state,C,S.pathname]),(0,n.useEffect)(()=>{a||_()},[a,_]);const P=(e,a)=>{const s={profile:a};(0,g.hX)(e,"/dak-action/".concat(a.login),C,s)};return(0,u.jsxs)(h.Mx,{pageName:"select-profile",children:[j&&!a?(0,u.jsxs)("div",{className:"loading-section",children:[(0,u.jsx)("div",{className:"spinner"}),(0,u.jsx)("p",{children:"Loading profile data..."})]}):(0,u.jsxs)("div",{className:"select-profile-content",children:[k&&(0,u.jsx)("div",{className:"warning-message",children:(0,u.jsxs)("div",{className:"warning-content",children:[(0,u.jsxs)("div",{className:"warning-header",children:[(0,u.jsx)("span",{className:"warning-icon",children:"\u26a0\ufe0f"}),(0,u.jsx)("span",{className:"warning-text",children:k})]}),(0,u.jsx)("button",{className:"warning-dismiss",onClick:()=>{O(null)},"aria-label":"Dismiss warning",children:"\xd7 Dismiss"})]})}),!f&&(0,u.jsx)("div",{className:"auth-status-message",children:(0,u.jsxs)("div",{className:"auth-status-content",children:[(0,u.jsx)("span",{className:"auth-status-icon",children:"\ud83d\udd13"}),(0,u.jsx)("span",{className:"auth-status-text",children:"You are browsing in unauthenticated mode. Some features like saving to GitHub will be disabled, but you can still explore and use local staging."})]})}),j?(0,u.jsxs)("div",{className:"loading-section",children:[(0,u.jsx)("div",{className:"spinner"}),(0,u.jsx)("p",{children:"Loading profile data..."})]}):(0,u.jsxs)("div",{className:"profile-selection",children:[(0,u.jsx)("h2",{children:e("organization.select")}),(0,u.jsxs)("p",{children:[e("organization.personal"),":"]}),N&&(0,u.jsx)("div",{className:"error-message",children:N}),(0,u.jsxs)("div",{className:"profile-grid-horizontal",children:[f&&a&&(0,u.jsxs)("div",{className:"profile-card",onClick:e=>P(e,(0,i.A)({type:"user"},a)),children:[(0,u.jsxs)("div",{className:"profile-card-header",children:[(0,u.jsx)("img",{src:null===a||void 0===a?void 0:a.avatar_url,alt:"Personal profile"}),w["user-".concat(null===a||void 0===a?void 0:a.login)]>0&&(0,u.jsx)("div",{className:"dak-count-badge",children:w["user-".concat(null===a||void 0===a?void 0:a.login)]})]}),(0,u.jsx)("h3",{children:(null===a||void 0===a?void 0:a.name)||(null===a||void 0===a?void 0:a.login)}),(0,u.jsx)("p",{children:"Personal repositories"}),(0,u.jsx)("div",{className:"profile-badges",children:(0,u.jsx)("span",{className:"profile-type",children:"Personal"})})]}),p.map(a=>(0,u.jsxs)("div",{className:"profile-card ".concat(a.isWHO?"who-org":""),onClick:e=>P(e,(0,i.A)({type:"org"},a)),children:[(0,u.jsxs)("div",{className:"profile-card-header",children:[(0,u.jsx)("img",{src:a.avatar_url||"https://github.com/".concat(a.login,".png"),alt:"".concat(a.name||a.login," organization")}),w["org-".concat(a.login)]>0&&(0,u.jsx)("div",{className:"dak-count-badge",children:w["org-".concat(a.login)]})]}),(0,u.jsx)("h3",{children:a.name||a.login}),(0,u.jsxs)("p",{children:["@",a.login]}),(0,u.jsxs)("div",{className:"profile-badges",children:[(0,u.jsx)("span",{className:"profile-type",children:e("organization.organizations")}),a.isWHO&&(0,u.jsx)("span",{className:"who-badge",children:"WHO Official"})]})]},a.login))]})]})]}),(0,u.jsx)(d.A,{isOpen:A,onClose:()=>{y(!1),W(null)},samlInfo:H})]})}}}]);