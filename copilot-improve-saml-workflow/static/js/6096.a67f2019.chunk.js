"use strict";(self.webpackChunksgex_workbench=self.webpackChunksgex_workbench||[]).push([[6096],{75012:(e,n,t)=>{t.r(n),t.d(n,{default:()=>l});var a=t(9950),o=t(18518),r=t(53782),i=t(75658),s=t(96143),c=t(44414);const l=()=>{const e=(0,o.Zp)(),{profile:n,repository:t,branch:l}=(0,r.N5)(),d=(0,i.f4)("businessProcesses"),m=(0,a.useRef)(null),u=(0,a.useRef)(null),[p,h]=(0,a.useState)([]),[b,f]=(0,a.useState)(null),[g,w]=(0,a.useState)(!0),[v,k]=(0,a.useState)(null),[j,y]=(0,a.useState)(""),[x,D]=(0,a.useState)(""),[E,N]=(0,a.useState)(!1);(0,a.useEffect)(()=>{const e=async()=>{if(u.current&&!m.current&&b)try{m.current=await(0,s.Ub)({container:u.current}),console.log("BPMN modeler initialized successfully")}catch(v){console.error("Failed to initialize BPMN modeler:",v),k("Failed to initialize BPMN editor")}};if(b){e();const n=setTimeout(e,100);return()=>clearTimeout(n)}return()=>{if(m.current){try{m.current.destroy()}catch(v){console.error("Error destroying BPMN modeler:",v)}m.current=null}}},[b]),(0,a.useEffect)(()=>{(async()=>{if(n&&t)if(d)try{w(!0),k(null);const e=(await d.retrieveAll()).map((e,n)=>{var t;return{name:e.filename||"workflow-".concat(n+1,".bpmn"),path:e.path||"input/process/".concat(e.filename||"workflow-".concat(n+1,".bpmn")),sha:e.sha||"mock-sha-".concat(n),size:(null===(t=e.content)||void 0===t?void 0:t.length)||0,type:"file",url:e.url,download_url:e.downloadUrl,content:e.content}});h(e),console.log("Loaded ".concat(e.length," BPMN files via Component Object")),w(!1)}catch(v){console.error("Error loading BPMN files via Component Object:",v),k("Failed to load BPMN files"),w(!1)}else console.log("Component Object not yet available, waiting...");else e("/")})()},[n,t,d,e]);const P=e=>{const n=e.replace(".bpmn",""),t=n.replace(/-/g," ").toUpperCase();return'<?xml version="1.0" encoding="UTF-8"?>\n<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" id="Definitions_1" targetNamespace="http://bpmn.io/schema/bpmn">\n  <bpmn:process id="Process_'.concat(n,'" name="').concat(t,'" isExecutable="true">\n    <bpmn:startEvent id="StartEvent_1">\n      <bpmn:outgoing>Flow_1</bpmn:outgoing>\n    </bpmn:startEvent>\n    <bpmn:task id="Task_1" name="').concat(t,'">\n      <bpmn:incoming>Flow_1</bpmn:incoming>\n      <bpmn:outgoing>Flow_2</bpmn:outgoing>\n    </bpmn:task>\n    <bpmn:endEvent id="EndEvent_1">\n      <bpmn:incoming>Flow_2</bpmn:incoming>\n    </bpmn:endEvent>\n    <bpmn:sequenceFlow id="Flow_1" sourceRef="StartEvent_1" targetRef="Task_1" />\n    <bpmn:sequenceFlow id="Flow_2" sourceRef="Task_1" targetRef="EndEvent_1" />\n  </bpmn:process>\n  <bpmndi:BPMNDiagram id="BPMNDiagram_1">\n    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="Process_').concat(n,'">\n      <bpmndi:BPMNShape id="_BPMNShape_StartEvent_2" bpmnElement="StartEvent_1">\n        <dc:Bounds x="179" y="99" width="36" height="36" />\n      </bpmndi:BPMNShape>\n      <bpmndi:BPMNShape id="Activity_1" bpmnElement="Task_1">\n        <dc:Bounds x="270" y="77" width="100" height="80" />\n      </bpmndi:BPMNShape>\n      <bpmndi:BPMNShape id="Event_1" bpmnElement="EndEvent_1">\n        <dc:Bounds x="432" y="99" width="36" height="36" />\n      </bpmndi:BPMNShape>\n      <bpmndi:BPMNEdge id="Flow_1_di" bpmnElement="Flow_1">\n        <di:waypoint x="215" y="117" />\n        <di:waypoint x="270" y="117" />\n      </bpmndi:BPMNEdge>\n      <bpmndi:BPMNEdge id="Flow_2_di" bpmnElement="Flow_2">\n        <di:waypoint x="370" y="117" />\n        <di:waypoint x="432" y="117" />\n      </bpmndi:BPMNEdge>\n    </bpmndi:BPMNPlane>\n  </bpmndi:BPMNDiagram>\n</bpmn:definitions>')},B=d?"Using Component Object for data operations":"Waiting for Component Object initialization...";return(0,c.jsx)(r.ox,{title:"BPMN Business Process Editor (Integrated)",status:B,onSave:async()=>{if(!m.current||!b)return console.error("Cannot save: modeler or file not available"),!1;try{const{xml:e}=await m.current.saveXML({format:!0}),n=await d.validate({id:b.name.replace(".bpmn",""),name:b.name.replace(".bpmn","").replace(/-/g," "),content:e,filename:b.name});return n.isValid?(await d.save({id:b.name.replace(".bpmn",""),name:b.name.replace(".bpmn","").replace(/-/g," "),content:e,filename:b.name,path:b.path},{saveType:"file",path:b.path,commit:!1}),D(e),y(e),N(!1),console.log("BPMN saved successfully via Component Object"),console.log("dak.json automatically updated with source reference"),!0):(k("Validation errors: ".concat(n.errors.join(", "))),!1)}catch(v){return console.error("Error saving BPMN via Component Object:",v),k("Failed to save: ".concat(v.message)),!1}},onCancel:()=>e("/dashboard"),hasUnsavedChanges:E,saveLabel:"Save Process",children:(0,c.jsxs)("div",{className:"bpmn-editor",children:[(0,c.jsxs)("div",{className:"bpmn-editor-header",children:[(0,c.jsx)("h2",{children:"BPMN Workflows"}),(0,c.jsx)("p",{className:"integration-note",children:"\u2705 This editor uses Component Objects - all changes automatically update dak.json"})]}),g&&(0,c.jsx)("div",{className:"loading-message",children:(0,c.jsx)("p",{children:"Loading BPMN files..."})}),v&&(0,c.jsx)("div",{className:"error-message",children:(0,c.jsx)("p",{children:v})}),!g&&!v&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)("div",{className:"file-list",children:[(0,c.jsxs)("h3",{children:["Available Workflows (",p.length,")"]}),(0,c.jsx)("ul",{children:p.map(e=>(0,c.jsxs)("li",{className:(null===b||void 0===b?void 0:b.path)===e.path?"selected":"",onClick:()=>(async e=>{try{w(!0),k(null),f(e),setTimeout(async()=>{try{if(!m.current&&u.current&&(m.current=await(0,s.Ub)({container:u.current})),!m.current)return k("BPMN editor not ready. Please try again."),void w(!1);let n=e.content;if(!n){const t=(await d.retrieveAll()).find(n=>n.filename===e.name);t&&t.content&&(n=t.content)}n||(n=P(e.name)),await m.current.importXML(n),D(n),y(n),N(!1),m.current.get("eventBus").on("commandStack.changed",()=>{m.current.saveXML({format:!0}).then(e=>{let{xml:n}=e;y(n),N(n!==x)})}),w(!1)}catch(v){console.error("Error loading BPMN file:",v),k("Failed to load diagram: ".concat(v.message)),w(!1)}},100)}catch(v){console.error("Error in loadBpmnFile:",v),k("Failed to load file: ".concat(v.message)),w(!1)}})(e),children:[(0,c.jsx)("span",{className:"file-icon",children:"\ud83d\udcc4"}),(0,c.jsx)("span",{className:"file-name",children:e.name}),(0,c.jsxs)("span",{className:"file-size",children:[(e.size/1024).toFixed(1)," KB"]})]},e.path))})]}),b&&(0,c.jsxs)("div",{className:"bpmn-modeler-container",children:[(0,c.jsxs)("div",{className:"modeler-header",children:[(0,c.jsxs)("h3",{children:["Editing: ",b.name]}),E&&(0,c.jsx)("span",{className:"unsaved-indicator",children:"\u25cf Unsaved changes"})]}),(0,c.jsx)("div",{ref:u,className:"bpmn-canvas",style:{height:"600px",border:"1px solid #ccc"}})]})]}),(0,c.jsx)("style",{jsx:!0,children:"\n          .bpmn-editor {\n            padding: 20px;\n          }\n          .bpmn-editor-header {\n            margin-bottom: 20px;\n          }\n          .integration-note {\n            color: #0078d4;\n            font-weight: 500;\n            margin-top: 8px;\n          }\n          .file-list {\n            margin-bottom: 20px;\n            padding: 15px;\n            background: #f5f5f5;\n            border-radius: 4px;\n          }\n          .file-list ul {\n            list-style: none;\n            padding: 0;\n          }\n          .file-list li {\n            padding: 10px;\n            margin: 5px 0;\n            background: white;\n            border-radius: 4px;\n            cursor: pointer;\n            display: flex;\n            align-items: center;\n            gap: 10px;\n          }\n          .file-list li:hover {\n            background: #e8e8e8;\n          }\n          .file-list li.selected {\n            background: #0078d4;\n            color: white;\n          }\n          .file-name {\n            flex: 1;\n          }\n          .file-size {\n            font-size: 0.9em;\n            color: #666;\n          }\n          .file-list li.selected .file-size {\n            color: #fff;\n          }\n          .modeler-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            margin-bottom: 10px;\n          }\n          .unsaved-indicator {\n            color: #ff9800;\n            font-weight: bold;\n          }\n          .loading-message, .error-message {\n            padding: 20px;\n            text-align: center;\n          }\n          .error-message {\n            background: #ffe6e6;\n            color: #d32f2f;\n            border-radius: 4px;\n          }\n        "})]})})}},75658:(e,n,t)=>{t.d(n,{f4:()=>s});var a=t(9950),o=t(89379),r=t(57561);new class{constructor(){this.dakFactory=null,this.currentDakObject=null,this.initialized=!1}async initializeForRepository(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"main";try{var a;const{DAKFactory:o}=await Promise.all([t.e(8900),t.e(5508),t.e(9082),t.e(2873),t.e(119)]).then(t.t.bind(t,90119,23));return this.dakFactory=new o(r.A),this.currentDakObject=await this.dakFactory.createFromRepository((null===(a=e.owner)||void 0===a?void 0:a.login)||e.full_name.split("/")[0],e.name,n),this.initialized=!0,this.currentDakObject}catch(o){return console.error("Failed to initialize DAK object:",o),console.warn("Using mock DAK object (dak-core not available)"),this.currentDakObject=this.createMockDakObject(e,n),this.initialized=!0,this.currentDakObject}}createMockDakObject(e,n){var t;const a=e=>({componentType:e,getSources:()=>[],addSource:n=>console.log("Mock: Add source to ".concat(e),n),retrieveAll:async()=>(console.log("Mock: Retrieve all from ".concat(e)),[]),retrieveById:async n=>(console.log("Mock: Retrieve ".concat(n," from ").concat(e)),null),save:async(n,t)=>{if(console.log("Mock: Save to ".concat(e),n,t),"businessProcesses"===e&&n.xml){const e=(null===t||void 0===t?void 0:t.filename)||"".concat(n.id,".bpmn");r.A.updateFile("input/process/".concat(e),n.xml)}else if("personas"===e&&n.fsh){const e=(null===t||void 0===t?void 0:t.filename)||"".concat(n.id,".fsh");r.A.updateFile("input/fsh/actors/".concat(e),n.fsh)}return{success:!0,id:n.id}},validate:async n=>(console.log("Mock: Validate in ".concat(e),n),{isValid:!0,errors:[],warnings:[]})});return{repository:{owner:null===(t=e.owner)||void 0===t?void 0:t.login,name:e.name},branch:n,metadata:{id:e.name,name:e.name,title:e.description||e.name,description:e.description||"",version:"0.0.1",status:"draft"},healthInterventions:a("healthInterventions"),personas:a("personas"),userScenarios:a("userScenarios"),businessProcesses:a("businessProcesses"),dataElements:a("dataElements"),decisionLogic:a("decisionLogic"),indicators:a("indicators"),requirements:a("requirements"),testScenarios:a("testScenarios"),getMetadata:()=>this.metadata,updateMetadata:e=>{this.metadata=(0,o.A)((0,o.A)({},this.metadata),e)},toJSON:()=>({metadata:this.metadata,components:{}}),saveDakJson:async()=>console.log("Mock: Save dak.json")}}getDakObject(){return this.currentDakObject}isInitialized(){return this.initialized&&null!==this.currentDakObject}async saveBpmnWorkflow(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this.currentDakObject)throw new Error("DAK object not initialized");const a=this.currentDakObject.businessProcesses;return await a.save({id:e.replace(".bpmn",""),name:t.name||e,description:t.description||"",xml:n},{filename:e,format:"bpmn",validate:!0})}async loadBpmnWorkflows(){if(!this.currentDakObject)throw new Error("DAK object not initialized");const e=this.currentDakObject.businessProcesses;return await e.retrieveAll()}async loadBpmnWorkflow(e){if(!this.currentDakObject)throw new Error("DAK object not initialized");const n=this.currentDakObject.businessProcesses;return await n.retrieveById(e)}async saveActor(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.currentDakObject)throw new Error("DAK object not initialized");const t=this.currentDakObject.personas;return await t.save({id:e.id,name:e.name,description:e.description,type:e.type,roles:e.roles,qualifications:e.qualifications,metadata:e.metadata},{format:n.format||"fsh",validate:!1!==n.validate})}async loadActors(){if(!this.currentDakObject)throw new Error("DAK object not initialized");const e=this.currentDakObject.personas;return await e.retrieveAll()}async loadActor(e){if(!this.currentDakObject)throw new Error("DAK object not initialized");const n=this.currentDakObject.personas;return await n.retrieveById(e)}async saveComponent(e,n,t){if(!this.currentDakObject)throw new Error("DAK object not initialized");const a=this.currentDakObject[e];if(!a)throw new Error("Unknown component type: ".concat(e));return await a.save(n,t)}async retrieveComponent(e){if(!this.currentDakObject)throw new Error("DAK object not initialized");const n=this.currentDakObject[e];if(!n)throw new Error("Unknown component type: ".concat(e));return await n.retrieveAll()}getComponentSources(e){if(!this.currentDakObject)return[];const n=this.currentDakObject[e];return n?n.getSources():[]}async saveDakJson(){if(!this.currentDakObject)throw new Error("DAK object not initialized");await this.currentDakObject.saveDakJson()}};t(44414);const i=(0,a.createContext)(null),s=e=>{const n=(()=>{const e=(0,a.useContext)(i);if(!e)throw new Error("useDakObject must be used within ComponentObjectProvider");return e})(),{dakObject:t,loading:o,error:r,refresh:s}=n,c=n[e];return c||o||!t||console.warn("Component type '".concat(e,"' not found in DAK object")),{component:c,dakObject:t,loading:o,error:r,refresh:s,retrieveAll:(0,a.useCallback)(async()=>c?await c.retrieveAll():(console.warn("Cannot retrieve from null component: ".concat(e)),[]),[c,e]),retrieveById:(0,a.useCallback)(async n=>c?await c.retrieveById(n):(console.warn("Cannot retrieve by id from null component: ".concat(e)),null),[c,e]),save:(0,a.useCallback)(async(n,t)=>{if(!c)throw new Error("Cannot save to null component: ".concat(e));return await c.save(n,t)},[c,e]),validate:(0,a.useCallback)(async n=>c?await c.validate(n):(console.warn("Cannot validate with null component: ".concat(e)),{isValid:!0,errors:[],warnings:[]}),[c,e]),getSources:(0,a.useCallback)(()=>c?c.getSources():(console.warn("Cannot get sources from null component: ".concat(e)),[]),[c,e]),addSource:(0,a.useCallback)(n=>{if(!c)throw new Error("Cannot add source to null component: ".concat(e));return c.addSource(n)},[c,e])}}},96143:(e,n,t)=>{t.d(n,{Ub:()=>o,_Q:()=>r});var a=t(57335);async function o(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new(await(0,a.uW)())(e)}async function r(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new(await(0,a.M3)())(e)}}}]);