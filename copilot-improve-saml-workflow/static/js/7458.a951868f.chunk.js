"use strict";(self.webpackChunksgex_workbench=self.webpackChunksgex_workbench||[]).push([[7458],{27458:(e,n,a)=>{a.r(n),a.d(n,{default:()=>p});var i=a(89379),t=a(9950),s=a(18518),o=a(67818),r=a(46901),l=a(29473),c=(a(78723),a(78952)),d=a(37210),u=a(53155),h=a(53782),g=a(1932),m=a(44414);const p=()=>{const{t:e}=(0,o.Bd)(),[n,a]=(0,t.useState)(null),[p,x]=(0,t.useState)([]),[j,f]=(0,t.useState)(!1),[A,v]=(0,t.useState)(!1),[z,b]=(0,t.useState)(null),[k,N]=(0,t.useState)({}),[w,y]=(0,t.useState)(null),[S,C]=(0,t.useState)(!1),[T,O]=(0,t.useState)(null),L=(0,s.Zp)(),M=(0,s.zy)(),P=(0,t.useCallback)((e,n)=>{if(!r.A.isAuth())return;const a={};if(e){const n=l.A.getCachedRepositories(e.login,"user");n&&n.repositories&&(a["user-".concat(e.login)]=n.repositories.length)}n.forEach(e=>{const n=l.A.getCachedRepositories(e.login,"org");n&&n.repositories&&(a["org-".concat(e.login)]=n.repositories.length)}),N(a)},[]),E=(0,t.useCallback)(async()=>{v(!0),b(null);try{await r.A.checkTokenPermissions();const n=await r.A.getCurrentUser();a(n);let t=[];if(r.A.isAuth())try{t=await r.A.getUserOrganizations()}catch(z){console.error("Error fetching organizations:",z),t=[]}try{const e=await r.A.getWHOOrganization(),n=t.findIndex(e=>"WorldHealthOrganization"===e.login);n>=0?t[n]=(0,i.A)((0,i.A)((0,i.A)({},t[n]),e),{},{isWHO:!0}):t.unshift(e)}catch(e){console.warn("Could not fetch WHO organization data, using fallback:",e);const n={id:"who-organization",login:"WorldHealthOrganization",name:"World Health Organization",description:"The World Health Organization is a specialized agency of the United Nations responsible for international public health.",avatar_url:"https://avatars.githubusercontent.com/u/12261302?s=200&v=4",html_url:"https://github.com/WorldHealthOrganization",type:"Organization",isWHO:!0};t.some(e=>"WorldHealthOrganization"===e.login)?t=t.map(e=>"WorldHealthOrganization"===e.login?(0,i.A)((0,i.A)({},e),{},{isWHO:!0}):e):t.unshift(n)}x(t),P(n,t)}catch(z){console.error("Error fetching user data:",z),b("Failed to fetch user data. Please check your connection and try again."),f(!1),r.A.logout()}finally{v(!1)}},[P]);(0,t.useEffect)(()=>{r.A.initializeFromStoredToken()&&f(!0)},[]),(0,t.useEffect)(()=>{c.A.registerModalCallback(e=>{O(e),C(!0)})},[]),(0,t.useEffect)(()=>{var e;null!==(e=M.state)&&void 0!==e&&e.warningMessage&&(y(M.state.warningMessage),L(M.pathname,{replace:!0,state:{}}))},[M.state,L,M.pathname]),(0,t.useEffect)(()=>{j&&!n&&E()},[j,n,E]);const H=(e,n)=>{r.A.authenticateWithOctokit(n),r.A.authenticate(e),f(!0),b(null),E()},W=(e,n)=>{const a={profile:n};(0,g.hX)(e,"/dak-action/".concat(n.login),L,a)},D=e=>{const n={login:"demo-user",name:"Demo User",avatar_url:"https://github.com/github.png",type:"User",isDemo:!0},a={profile:n,action:"edit"};(0,g.hX)(e,"/dak-selection/".concat(n.login),L,a)},I=()=>{y(null)};return j?(0,m.jsxs)(h.Mx,{pageName:"landing-authenticated",children:[(0,m.jsxs)("div",{className:"landing-content",children:[w&&(0,m.jsx)("div",{className:"warning-message",children:(0,m.jsxs)("div",{className:"warning-content",children:[(0,m.jsx)("span",{className:"warning-icon",children:"\u26a0\ufe0f"}),(0,m.jsx)("span",{className:"warning-text",children:w}),(0,m.jsx)("button",{className:"warning-dismiss",onClick:I,"aria-label":"Dismiss warning",children:"\xd7"})]})}),A?(0,m.jsxs)("div",{className:"loading-section",children:[(0,m.jsx)("div",{className:"spinner"}),(0,m.jsx)("p",{children:"Loading profile data..."})]}):(0,m.jsxs)("div",{className:"profile-selection",children:[(0,m.jsx)("h2",{children:e("organization.select")}),(0,m.jsxs)("p",{children:[e("organization.personal"),":"]}),z&&(0,m.jsx)("div",{className:"error-message",children:z}),(0,m.jsxs)("div",{className:"profile-grid",children:[(0,m.jsxs)("div",{className:"profile-card",onClick:e=>W(e,(0,i.A)({type:"user"},n)),children:[(0,m.jsxs)("div",{className:"profile-card-header",children:[(0,m.jsx)("img",{src:null===n||void 0===n?void 0:n.avatar_url,alt:"Personal profile"}),k["user-".concat(null===n||void 0===n?void 0:n.login)]>0&&(0,m.jsx)("div",{className:"dak-count-badge",children:k["user-".concat(null===n||void 0===n?void 0:n.login)]})]}),(0,m.jsx)("h3",{children:(null===n||void 0===n?void 0:n.name)||(null===n||void 0===n?void 0:n.login)}),(0,m.jsx)("p",{children:"Personal repositories"}),(0,m.jsx)("div",{className:"profile-badges",children:(0,m.jsx)("span",{className:"profile-type",children:"Personal"})})]}),p.map(n=>(0,m.jsxs)("div",{className:"profile-card ".concat(n.isWHO?"who-org":""),onClick:e=>W(e,(0,i.A)({type:"org"},n)),children:[(0,m.jsxs)("div",{className:"profile-card-header",children:[(0,m.jsx)("img",{src:n.avatar_url||"https://github.com/".concat(n.login,".png"),alt:"".concat(n.name||n.login," organization")}),k["org-".concat(n.login)]>0&&(0,m.jsx)("div",{className:"dak-count-badge",children:k["org-".concat(n.login)]})]}),(0,m.jsx)("h3",{children:n.name||n.login}),(0,m.jsxs)("p",{children:["@",n.login]}),(0,m.jsxs)("div",{className:"profile-badges",children:[(0,m.jsx)("span",{className:"profile-type",children:e("organization.organizations")}),n.isWHO&&(0,m.jsx)("span",{className:"who-badge",children:"WHO Official"})]})]},n.login))]})]})]}),(0,m.jsx)(u.A,{isOpen:S,onClose:()=>{C(!1),O(null)},samlInfo:T})]}):(0,m.jsx)(h.Mx,{pageName:"landing-unauthenticated",children:(0,m.jsxs)("div",{className:"landing-content",children:[w&&(0,m.jsx)("div",{className:"warning-message",children:(0,m.jsxs)("div",{className:"warning-content",children:[(0,m.jsx)("span",{className:"warning-icon",children:"\u26a0\ufe0f"}),(0,m.jsx)("span",{className:"warning-text",children:w}),(0,m.jsx)("button",{className:"warning-dismiss",onClick:I,"aria-label":"Dismiss warning",children:"\xd7"})]})}),(0,m.jsxs)("div",{className:"welcome-section",children:[(0,m.jsx)("h2",{children:e("landing.welcome")}),(0,m.jsx)("p",{children:e("app.description")}),(0,m.jsxs)("div",{className:"auth-section",children:[(0,m.jsxs)("p",{children:[e("auth.signInWithPAT"),":"]}),(0,m.jsx)(d.A,{onAuthSuccess:H}),z&&(0,m.jsx)("div",{className:"error-message",children:z})]}),(0,m.jsxs)("div",{className:"demo-section",children:[(0,m.jsx)("p",{children:"Want to try without authentication?"}),(0,m.jsx)("button",{onClick:D,className:"demo-mode-btn",children:"\ud83c\udfad Try Demo Mode"}),(0,m.jsx)("p",{className:"demo-note",children:"Demo mode showcases the enhanced DAK scanning display with mock data."})]}),(0,m.jsx)("div",{className:"info-section",children:(0,m.jsx)("p",{children:"Need help getting started? Use the help mascot (bottom-right corner) to access comprehensive documentation and learn more about SGEX Workbench and DAK components."})})]})]})})}},37210:(e,n,a)=>{a.d(n,{A:()=>r});var i=a(9950),t=a(67818),s=a(85571),o=a(44414);const r=e=>{let{onAuthSuccess:n}=e;const{t:r}=(0,t.Bd)(),[l,c]=(0,i.useState)(""),[d,u]=(0,i.useState)(""),[h,g]=(0,i.useState)(""),[m,p]=(0,i.useState)(!1),x=s.A.getLogger("PATLogin");i.useEffect(()=>(x.componentMount({hasOnAuthSuccess:!!n}),()=>x.componentUnmount()),[x,n]);return(0,o.jsx)("div",{className:"pat-login",children:(0,o.jsxs)("div",{className:"pat-login-section",children:[(0,o.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),x.userAction("PAT login attempt",{tokenProvided:!!l.trim()}),!l.trim()){return g("Please enter a GitHub Personal Access Token"),void x.warn("PAT login failed - no token provided")}p(!0),g("");const i=Date.now();x.auth("Starting PAT authentication");try{const{Octokit:e}=await a.e(112).then(a.bind(a,10112)),t=new e({auth:l.trim()});x.debug("Octokit instance created for PAT validation"),x.apiCall("GET","/user",null);const s=await t.rest.users.getAuthenticated(),o=Date.now()-i;x.apiResponse("GET","/user",s.status,o),x.auth("PAT authentication successful",{username:s.data.login,duration:o}),n(l.trim(),t)}catch(t){const e=Date.now()-i;x.apiError("GET","/user",t),x.auth("PAT authentication failed",{status:t.status,message:t.message,duration:e}),console.error("PAT authentication failed:",t),401===t.status?g("Invalid Personal Access Token. Please check your token and try again."):403===t.status?g("Token doesn't have sufficient permissions. Please ensure your token has 'repo' and 'read:org' scopes."):g("Authentication failed. Please check your connection and try again.")}finally{p(!1)}},className:"pat-form",children:[(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{htmlFor:"token-name",children:"Token Name (optional):"}),(0,o.jsx)("input",{id:"token-name",type:"text",value:d,onChange:e=>{u(e.target.value),h&&g("")},placeholder:"e.g., SGEX Access Token",className:"token-name-input",disabled:m,autoComplete:"username"})]}),(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsxs)("label",{htmlFor:"pat-token",children:[r("auth.setupToken"),":"]}),(0,o.jsx)("input",{id:"pat-token",type:"password",value:l,onChange:e=>{c(e.target.value),h&&g("")},placeholder:"ghp_xxxxxxxxxxxxxxxxxxxx",className:"token-input ".concat(h?"error":""),disabled:m,autoComplete:"current-password"})]}),(0,o.jsx)("button",{type:"submit",className:"github-login-btn",disabled:m||!l.trim(),children:m?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("span",{className:"spinner small"}),r("common.loading"),"..."]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("span",{className:"github-icon",children:"\ud83d\udd11"}),r("auth.signInWithPAT")]})})]}),h&&(0,o.jsx)("div",{className:"error-message",children:h})]})})}},53155:(e,n,a)=>{a.d(n,{A:()=>l});var i=a(9950),t=a(85571),s=a(36241),o=a(78952),r=a(44414);const l=e=>{let{isOpen:n,onClose:a,samlInfo:l,onAuthorizationComplete:c,pollingInterval:d=3e3,pollingTimeout:u=3e5}=e;const h=t.A.getLogger("SAMLAuthModal"),[g,m]=(0,i.useState)(!1),[p,x]=(0,i.useState)(null),[j,f]=(0,i.useState)(null),A=(0,i.useRef)(null),v=(0,i.useRef)(null),z=(0,i.useRef)(null);(0,i.useEffect)(()=>{n&&null!==l&&void 0!==l&&l.originalRequest&&(z.current=l.originalRequest)},[n,l]);const b=(0,i.useCallback)(async()=>{if(null===l||void 0===l||!l.organization)return!1;try{if(h.debug("Checking SAML authorization status",{organization:l.organization,repository:l.repository}),z.current)try{return await z.current(),h.info("SAML authorization successful - original request succeeded",{organization:l.organization}),!0}catch(n){var e;return(403!==n.status||null===(e=n.message)||void 0===e||!e.toLowerCase().includes("saml"))&&(h.warn("Original request failed with non-SAML error",{organization:l.organization,error:n.message}),!0)}return!1}catch(n){return h.error("Error checking SAML status",{organization:l.organization,error:n.message}),!1}},[l,h]),k=(0,i.useCallback)(()=>{A.current&&(clearInterval(A.current),A.current=null,m(!1),x(null),v.current=null,h.debug("Polling stopped",{organization:null===l||void 0===l?void 0:l.organization}))},[l,h]),N=(0,i.useCallback)(()=>{!g&&null!==l&&void 0!==l&&l.organization&&(m(!0),v.current=Date.now(),x("Waiting for authorization..."),h.info("Started polling for SAML authorization",{organization:l.organization,pollingInterval:d,pollingTimeout:u}),s.A.isAvailable()&&s.A.broadcast(s.B.SAML_POLLING_STARTED,{organization:l.organization,timestamp:Date.now()}),A.current=setInterval(async()=>{const e=Date.now()-v.current;if(e>u)return h.warn("SAML polling timeout reached",{organization:l.organization,elapsedTime:e,timeout:u}),x("Authorization check timed out. Please try again."),void k();await b()?(h.info("SAML authorization detected",{organization:l.organization,elapsedTime:e}),o.A.markSAMLAuthorized(l.organization,l.repository),c&&c({organization:l.organization,repository:l.repository}),x("Authorization successful!"),setTimeout(()=>{k(),a()},1e3)):h.debug("SAML authorization not yet complete",{organization:l.organization,elapsedTime:e})},d))},[g,l,d,u,b,k,c,a,h]);if((0,i.useEffect)(()=>{if(!n||null===l||void 0===l||!l.organization)return;return s.A.on(s.B.SAML_AUTHENTICATED,e=>{e.organization===l.organization&&(h.debug("SAML authentication detected from another tab",{organization:e.organization}),k(),a())})},[n,l,k,a,h]),(0,i.useEffect)(()=>{n||(k(),j&&!j.closed&&h.debug("Closing SSO window",{organization:null===l||void 0===l?void 0:l.organization}))},[n,j,l,k,h]),(0,i.useEffect)(()=>(n&&l&&h.componentMount({organization:l.organization,repository:l.repository}),()=>{n&&(k(),h.componentUnmount())}),[h,n,l,k]),!n||!l)return null;const{organization:w,repository:y,authorizationUrl:S}=l,C=()=>{h.userAction("SAML modal closed",{organization:w}),k(),a()};return(0,r.jsx)("div",{className:"saml-modal-overlay",onClick:C,onKeyDown:e=>"Escape"===e.key&&C(),role:"dialog","aria-modal":"true","aria-labelledby":"saml-modal-title",tabIndex:-1,children:(0,r.jsxs)("div",{className:"saml-modal",onClick:e=>e.stopPropagation(),onKeyDown:e=>e.stopPropagation(),role:"document",children:[(0,r.jsxs)("div",{className:"saml-modal-header",children:[(0,r.jsx)("h2",{id:"saml-modal-title",children:"\ud83d\udd10 SAML SSO Authorization Required"}),(0,r.jsx)("button",{onClick:C,className:"close-button","aria-label":"Close",children:"\xd7"})]}),(0,r.jsxs)("div",{className:"saml-modal-content",children:[(0,r.jsxs)("div",{className:"saml-info-section",children:[(0,r.jsx)("div",{className:"saml-icon",children:(0,r.jsx)("span",{role:"img","aria-label":"lock",children:"\ud83d\udd12"})}),(0,r.jsx)("h3",{children:"Organization Access Required"}),(0,r.jsxs)("p",{className:"saml-description",children:["Your Personal Access Token needs SAML SSO authorization to access the"," ",(0,r.jsx)("strong",{children:w})," organization",y?" and the ".concat(y," repository"):"","."]})]}),(0,r.jsxs)("div",{className:"saml-steps-section",children:[(0,r.jsx)("h4",{children:"How to authorize your token:"}),(0,r.jsxs)("ol",{className:"saml-steps",children:[(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:'Click "Authorize on GitHub"'})," below to open the authorization page"]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"Review the permissions"})," requested by the organization"]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:'Click "Authorize"'})," to grant your token access"]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"This modal will automatically detect"})," when authorization is complete"]})]})]}),g&&(0,r.jsxs)("div",{className:"saml-polling-status",children:[(0,r.jsx)("span",{className:"polling-spinner",children:"\u23f3"}),(0,r.jsx)("p",{children:p})]}),(0,r.jsxs)("div",{className:"saml-note",children:[(0,r.jsx)("span",{className:"note-icon",children:"\u2139\ufe0f"}),(0,r.jsxs)("p",{children:["This is a GitHub security feature for organizations using SAML SSO. You only need to authorize once per organization per token.",!g&&' Click "Later" to dismiss for 1 minute.']})]}),(0,r.jsx)("div",{className:"saml-modal-actions",children:g?(0,r.jsx)("button",{onClick:C,className:"saml-cancel-btn",children:"Cancel"}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{onClick:()=>{h.userAction("Authorize SAML clicked",{organization:w,authorizationUrl:S});const e=window.open(S,"_blank","noopener,noreferrer");f(e),h.info("SAML authorization page opened",{organization:w,instruction:"Polling will check for authorization completion"}),N()},className:"saml-authorize-btn",children:"\ud83d\udd13 Authorize on GitHub"}),(0,r.jsx)("button",{onClick:()=>{h.userAction('SAML modal "Later" clicked',{organization:w}),k(),o.A.clearCooldown(w),a()},className:"saml-cancel-btn",children:"Later"})]})})]})]})})}}}]);