"use strict";(self.webpackChunksgex_workbench=self.webpackChunksgex_workbench||[]).push([[1008],{53155:(e,o,i)=>{i.d(o,{A:()=>l});var n=i(9950),a=i(85571),s=i(36241),t=i(78952),r=i(44414);const l=e=>{let{isOpen:o,onClose:i,samlInfo:l,onAuthorizationComplete:c,pollingInterval:d=3e3,pollingTimeout:u=3e5}=e;const h=a.A.getLogger("SAMLAuthModal"),[g,p]=(0,n.useState)(!1),[m,x]=(0,n.useState)(null),[j,z]=(0,n.useState)(null),f=(0,n.useRef)(null),A=(0,n.useRef)(null),v=(0,n.useRef)(null);(0,n.useEffect)(()=>{o&&null!==l&&void 0!==l&&l.originalRequest&&(v.current=l.originalRequest)},[o,l]);const y=(0,n.useCallback)(async()=>{if(null===l||void 0===l||!l.organization)return!1;try{if(h.debug("Checking SAML authorization status",{organization:l.organization,repository:l.repository}),v.current)try{return await v.current(),h.info("SAML authorization successful - original request succeeded",{organization:l.organization}),!0}catch(o){var e;return(403!==o.status||null===(e=o.message)||void 0===e||!e.toLowerCase().includes("saml"))&&(h.warn("Original request failed with non-SAML error",{organization:l.organization,error:o.message}),!0)}return!1}catch(o){return h.error("Error checking SAML status",{organization:l.organization,error:o.message}),!1}},[l,h]),N=(0,n.useCallback)(()=>{f.current&&(clearInterval(f.current),f.current=null,p(!1),x(null),A.current=null,h.debug("Polling stopped",{organization:null===l||void 0===l?void 0:l.organization}))},[l,h]),b=(0,n.useCallback)(()=>{!g&&null!==l&&void 0!==l&&l.organization&&(p(!0),A.current=Date.now(),x("Waiting for authorization..."),h.info("Started polling for SAML authorization",{organization:l.organization,pollingInterval:d,pollingTimeout:u}),s.A.isAvailable()&&s.A.broadcast(s.B.SAML_POLLING_STARTED,{organization:l.organization,timestamp:Date.now()}),f.current=setInterval(async()=>{const e=Date.now()-A.current;if(e>u)return h.warn("SAML polling timeout reached",{organization:l.organization,elapsedTime:e,timeout:u}),x("Authorization check timed out. Please try again."),void N();await y()?(h.info("SAML authorization detected",{organization:l.organization,elapsedTime:e}),t.A.markSAMLAuthorized(l.organization,l.repository),c&&c({organization:l.organization,repository:l.repository}),x("Authorization successful!"),setTimeout(()=>{N(),i()},1e3)):h.debug("SAML authorization not yet complete",{organization:l.organization,elapsedTime:e})},d))},[g,l,d,u,y,N,c,i,h]);if((0,n.useEffect)(()=>{if(!o||null===l||void 0===l||!l.organization)return;return s.A.on(s.B.SAML_AUTHENTICATED,e=>{e.organization===l.organization&&(h.debug("SAML authentication detected from another tab",{organization:e.organization}),N(),i())})},[o,l,N,i,h]),(0,n.useEffect)(()=>{o||(N(),j&&!j.closed&&h.debug("Closing SSO window",{organization:null===l||void 0===l?void 0:l.organization}))},[o,j,l,N,h]),(0,n.useEffect)(()=>(o&&l&&h.componentMount({organization:l.organization,repository:l.repository}),()=>{o&&(N(),h.componentUnmount())}),[h,o,l,N]),!o||!l)return null;const{organization:S,repository:k,authorizationUrl:w}=l,C=()=>{h.userAction("SAML modal closed",{organization:S}),N(),i()};return(0,r.jsx)("div",{className:"saml-modal-overlay",onClick:C,onKeyDown:e=>"Escape"===e.key&&C(),role:"dialog","aria-modal":"true","aria-labelledby":"saml-modal-title",tabIndex:-1,children:(0,r.jsxs)("div",{className:"saml-modal",onClick:e=>e.stopPropagation(),onKeyDown:e=>e.stopPropagation(),role:"document",children:[(0,r.jsxs)("div",{className:"saml-modal-header",children:[(0,r.jsx)("h2",{id:"saml-modal-title",children:"\ud83d\udd10 SAML SSO Authorization Required"}),(0,r.jsx)("button",{onClick:C,className:"close-button","aria-label":"Close",children:"\xd7"})]}),(0,r.jsxs)("div",{className:"saml-modal-content",children:[(0,r.jsxs)("div",{className:"saml-info-section",children:[(0,r.jsx)("div",{className:"saml-icon",children:(0,r.jsx)("span",{role:"img","aria-label":"lock",children:"\ud83d\udd12"})}),(0,r.jsx)("h3",{children:"Organization Access Required"}),(0,r.jsxs)("p",{className:"saml-description",children:["Your Personal Access Token needs SAML SSO authorization to access the"," ",(0,r.jsx)("strong",{children:S})," organization",k?" and the ".concat(k," repository"):"","."]})]}),(0,r.jsxs)("div",{className:"saml-steps-section",children:[(0,r.jsx)("h4",{children:"How to authorize your token:"}),(0,r.jsxs)("ol",{className:"saml-steps",children:[(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:'Click "Authorize on GitHub"'})," below to open the authorization page"]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"Review the permissions"})," requested by the organization"]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:'Click "Authorize"'})," to grant your token access"]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"This modal will automatically detect"})," when authorization is complete"]})]})]}),g&&(0,r.jsxs)("div",{className:"saml-polling-status",children:[(0,r.jsx)("span",{className:"polling-spinner",children:"\u23f3"}),(0,r.jsx)("p",{children:m})]}),(0,r.jsxs)("div",{className:"saml-note",children:[(0,r.jsx)("span",{className:"note-icon",children:"\u2139\ufe0f"}),(0,r.jsxs)("p",{children:["This is a GitHub security feature for organizations using SAML SSO. You only need to authorize once per organization per token.",!g&&' Click "Later" to dismiss for 1 minute.']})]}),(0,r.jsx)("div",{className:"saml-modal-actions",children:g?(0,r.jsx)("button",{onClick:C,className:"saml-cancel-btn",children:"Cancel"}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{onClick:()=>{h.userAction("Authorize SAML clicked",{organization:S,authorizationUrl:w});const e=window.open(w,"_blank","noopener,noreferrer");z(e),h.info("SAML authorization page opened",{organization:S,instruction:"Polling will check for authorization completion"}),b()},className:"saml-authorize-btn",children:"\ud83d\udd13 Authorize on GitHub"}),(0,r.jsx)("button",{onClick:()=>{h.userAction('SAML modal "Later" clicked',{organization:S}),N(),t.A.clearCooldown(S),i()},className:"saml-cancel-btn",children:"Later"})]})})]})]})})}},81008:(e,o,i)=>{i.r(o),i.d(o,{default:()=>u});var n=i(9950),a=i(18518),s=i(46901),t=i(29473),r=i(78952),l=i(53155),c=i(53782),d=i(44414);const u=()=>{var e;const o=(0,a.zy)(),i=(0,a.Zp)(),{user:u}=(0,a.g)(),[h,g]=(0,n.useState)([]),[p,m]=(0,n.useState)(!0),[x,j]=(0,n.useState)(null),[z,f]=(0,n.useState)(!1),[A,v]=(0,n.useState)(null),[y,N]=(0,n.useState)(null===(e=o.state)||void 0===e?void 0:e.profile);(0,n.useEffect)(()=>{r.A.registerModalCallback(e=>{v(e),f(!0)}),(async()=>{if(u&&!y)try{if(s.A.isAuth()){const e=await s.A.getUser(u);N(e)}else N({login:u,name:u.charAt(0).toUpperCase()+u.slice(1),avatar_url:"https://github.com/".concat(u,".png"),type:"User"})}catch(x){console.error("Error fetching user profile:",x),i("/",{state:{warningMessage:"User '".concat(u,"' not found or not accessible.")}})}})()},[u,y,i]);const b=(0,n.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];m(!0),j(null);try{const i=y.type;if(!e){let e=null;try{e=t.A.getCachedRepositories(y.login,i)}catch(o){console.warn("Error accessing repository cache:",o)}if(e)return console.log("Using cached repositories for ".concat(y.login," (").concat(i,")")),g(e.repositories),void m(!1)}console.log("Fetching fresh repositories for ".concat(y.login," (").concat(i,")"));const n=await s.A.getRepositories(y.login,i);try{t.A.setCachedRepositories(y.login,i,n)}catch(o){console.warn("Error caching repositories:",o)}g(n)}catch(x){console.error("Error fetching repositories:",x),j("Failed to fetch repositories. Please check your connection and try again.")}finally{m(!1)}},[y]);(0,n.useEffect)(()=>{y||u?y&&b():i("/")},[y,u,i,b]);return(0,d.jsxs)(c.Mx,{pageName:"repository-selection",children:[y?(0,d.jsx)("div",{className:"repo-content",children:(0,d.jsx)("div",{className:"repo-main",children:(0,d.jsxs)("div",{className:"repo-selection",children:[(0,d.jsx)("h2",{children:"Select DAK Repository"}),(0,d.jsx)("p",{children:"Choose a repository containing WHO SMART Guidelines Digital Adaptation Kit content:"}),p?(0,d.jsxs)("div",{className:"loading",children:[(0,d.jsx)("div",{className:"spinner"}),(0,d.jsx)("p",{children:"Loading repositories..."})]}):x?(0,d.jsxs)("div",{className:"error-state",children:[(0,d.jsx)("h3",{children:"Error loading repositories"}),(0,d.jsx)("p",{children:x}),(0,d.jsx)("button",{onClick:()=>b(!0),className:"retry-btn",children:"Try Again"})]}):0===h.length?(0,d.jsxs)("div",{className:"empty-state",children:[(0,d.jsx)("h3",{children:"No DAK repositories found"}),(0,d.jsx)("p",{children:"No repositories found with DAK-related topics or keywords. Create a new repository or add topics like 'who', 'smart-guidelines', 'dak', or 'health' to existing repositories."})]}):(0,d.jsx)("div",{className:"repo-grid",children:h.map(e=>{return(0,d.jsxs)("div",{className:"repo-card",onClick:()=>(e=>{i("/dashboard/".concat(e.owner.login,"/").concat(e.name),{state:{profile:y,repository:e}})})(e),children:[(0,d.jsxs)("div",{className:"repo-header-info",children:[(0,d.jsx)("h3",{children:e.name}),(0,d.jsxs)("div",{className:"repo-meta",children:[e.private&&(0,d.jsx)("span",{className:"private-badge",children:"Private"}),e.language&&(0,d.jsx)("span",{className:"language-badge",children:e.language})]})]}),(0,d.jsx)("p",{className:"repo-description",children:e.description||"No description available"}),(0,d.jsxs)("div",{className:"repo-topics",children:[(e.topics||[]).slice(0,3).map(e=>(0,d.jsx)("span",{className:"topic-tag",children:e},e)),(e.topics||[]).length>3&&(0,d.jsxs)("span",{className:"topic-more",children:["+",(e.topics||[]).length-3," more"]})]}),(0,d.jsxs)("div",{className:"repo-stats",children:[(0,d.jsxs)("div",{className:"stat",children:[(0,d.jsx)("span",{className:"stat-icon",children:"\u2b50"}),(0,d.jsx)("span",{children:e.stargazers_count||0})]}),(0,d.jsxs)("div",{className:"stat",children:[(0,d.jsx)("span",{className:"stat-icon",children:"\ud83c\udf74"}),(0,d.jsx)("span",{children:e.forks_count||0})]}),(0,d.jsxs)("div",{className:"stat",children:[(0,d.jsx)("span",{className:"stat-icon",children:"\ud83d\udcc5"}),(0,d.jsxs)("span",{children:["Updated ",(o=e.updated_at,new Date(o).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}))]})]})]})]},e.id);var o})})]})})}):(0,d.jsx)("div",{children:"Redirecting..."}),(0,d.jsx)(l.A,{isOpen:z,onClose:()=>{f(!1),v(null)},samlInfo:A})]})}}}]);