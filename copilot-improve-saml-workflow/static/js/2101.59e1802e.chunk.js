"use strict";(self.webpackChunksgex_workbench=self.webpackChunksgex_workbench||[]).push([[2101],{12101:(e,a,i)=>{i.r(a),i.d(a,{default:()=>h});var n=i(89379),o=i(9950),t=i(18518),r=i(46901),s=i(78952),l=i(53155),c=i(53782),d=i(44414);const h=()=>{var e;const a=(0,t.zy)(),i=(0,t.Zp)(),[h,u]=(0,o.useState)([]),[p,g]=(0,o.useState)(null),[m,v]=(0,o.useState)(!0),[z,b]=(0,o.useState)(null),[x,j]=(0,o.useState)(!0),[_,y]=(0,o.useState)(!1),[f,N]=(0,o.useState)(null),{profile:A,sourceRepository:k,action:O}=a.state||{},w=()=>{switch(O){case"fork":return{title:"Select Destination for Fork",description:'Choose where to create a fork of "'.concat(null===k||void 0===k?void 0:k.name,'".'),buttonText:"Fork Repository",nextRoute:"/dashboard"};case"create":return{title:"Select Destination for New DAK",description:'Choose where to create your new DAK based on "'.concat(null===k||void 0===k?void 0:k.name,'".'),buttonText:"Continue to Configuration",nextRoute:"/dak-configuration"};default:return{title:"Select Organization",description:"Choose an organization for your DAK.",buttonText:"Continue",nextRoute:"/dashboard"}}},S=(0,o.useCallback)(async()=>{v(!0),b(null);try{let a=[];a=r.A.isAuth()?await r.A.getUserOrganizations():await C();try{const e=await r.A.getWHOOrganization(),i=a.findIndex(e=>"WorldHealthOrganization"===e.login);i>=0?a[i]=(0,n.A)((0,n.A)({},a[i]),e):a.unshift(e)}catch(e){console.warn("Could not fetch WHO organization data, using fallback:",e);const i={id:"who-organization",login:"WorldHealthOrganization",display_name:"World Health Organization",description:"The World Health Organization is a specialized agency of the United Nations responsible for international public health.",avatar_url:"https://avatars.githubusercontent.com/u/12261302?s=200&v=4",html_url:"https://github.com/WorldHealthOrganization",type:"Organization",permissions:{can_create_repositories:!0,can_create_private_repositories:!0},plan:{name:"Organization",private_repos:"unlimited"},isWHO:!0};a.some(e=>"WorldHealthOrganization"===e.login)||a.unshift(i)}u(a)}catch(z){console.error("Error fetching organizations:",z),b("Failed to fetch organizations. Please check your connection and try again.");try{const e=await C();u(e)}catch(a){u([{id:"who-organization",login:"WorldHealthOrganization",display_name:"World Health Organization",description:"The World Health Organization is a specialized agency of the United Nations responsible for international public health.",avatar_url:"https://avatars.githubusercontent.com/u/12261302?s=200&v=4",html_url:"https://github.com/WorldHealthOrganization",type:"Organization",permissions:{can_create_repositories:!0,can_create_private_repositories:!0},plan:{name:"Organization",private_repos:"unlimited"},isWHO:!0}])}}finally{v(!1)}},[]),C=async()=>{try{return[await r.A.getWHOOrganization(),{id:1,login:"my-health-org",display_name:"My Health Organization",description:"Healthcare technology organization focused on digital health solutions",avatar_url:"https://avatars.githubusercontent.com/u/1?s=200&v=4",html_url:"https://github.com/my-health-org",type:"Organization",permissions:{can_create_repositories:!0,can_create_private_repositories:!0},plan:{name:"Team",private_repos:10}},{id:2,login:"global-health-initiative",display_name:"Global Health Initiative",description:"International organization working on global health standards",avatar_url:"https://avatars.githubusercontent.com/u/2?s=200&v=4",html_url:"https://github.com/global-health-initiative",type:"Organization",permissions:{can_create_repositories:!0,can_create_private_repositories:!1},plan:{name:"Free",private_repos:0}}]}catch(z){return console.warn("Could not fetch WHO data for mock organizations, using fallback:",z),[{id:"who-organization",login:"WorldHealthOrganization",display_name:"World Health Organization",description:"The World Health Organization is a specialized agency of the United Nations responsible for international public health.",avatar_url:"https://avatars.githubusercontent.com/u/12261302?s=200&v=4",html_url:"https://github.com/WorldHealthOrganization",type:"Organization",permissions:{can_create_repositories:!0,can_create_private_repositories:!0},plan:{name:"Organization",private_repos:"unlimited"},isWHO:!0},{id:1,login:"my-health-org",display_name:"My Health Organization",description:"Healthcare technology organization focused on digital health solutions",avatar_url:"https://avatars.githubusercontent.com/u/1?s=200&v=4",html_url:"https://github.com/my-health-org",type:"Organization",permissions:{can_create_repositories:!0,can_create_private_repositories:!0},plan:{name:"Team",private_repos:10}},{id:2,login:"global-health-initiative",display_name:"Global Health Initiative",description:"International organization working on global health standards",avatar_url:"https://avatars.githubusercontent.com/u/2?s=200&v=4",html_url:"https://github.com/global-health-initiative",type:"Organization",permissions:{can_create_repositories:!0,can_create_private_repositories:!1},plan:{name:"Free",private_repos:0}}]}};(0,o.useEffect)(()=>{A&&k&&O?(s.A.registerModalCallback(e=>{N(e),y(!0)}),S()):i("/")},[A,k,O,i,S]);const H=w(),L=[];return x&&L.push((0,n.A)((0,n.A)({},A),{},{type:"User",display_name:A.name||A.login,description:"Your personal GitHub account",permissions:{can_create_repositories:!0,can_create_private_repositories:!0},isPersonal:!0})),L.push(...h),(0,d.jsxs)(c.Mx,{pageName:"organization-selection",children:[A&&k&&O?(0,d.jsxs)("div",{className:"org-content",children:[(0,d.jsxs)("div",{className:"breadcrumb",children:[(0,d.jsx)("button",{onClick:()=>i("/"),className:"breadcrumb-link",children:"Select Profile"}),(0,d.jsx)("span",{className:"breadcrumb-separator",children:"\u203a"}),(0,d.jsx)("button",{onClick:()=>i("/dak-action",{state:{profile:A}}),className:"breadcrumb-link",children:"Choose DAK Action"}),(0,d.jsx)("span",{className:"breadcrumb-separator",children:"\u203a"}),(0,d.jsx)("button",{onClick:()=>{i("/dak-selection/".concat(A.login),{state:{profile:A,action:O}})},className:"breadcrumb-link",children:"Select DAK"}),(0,d.jsx)("span",{className:"breadcrumb-separator",children:"\u203a"}),(0,d.jsx)("span",{className:"breadcrumb-current",children:"Select Organization"})]}),(0,d.jsxs)("div",{className:"org-main",children:[(0,d.jsxs)("div",{className:"org-intro",children:[(0,d.jsx)("h2",{children:H.title}),(0,d.jsx)("p",{children:H.description}),k&&(0,d.jsxs)("div",{className:"source-repo-info",children:[(0,d.jsx)("span",{className:"repo-label",children:"Source Repository:"}),(0,d.jsxs)("div",{className:"repo-badge",children:[(0,d.jsx)("span",{className:"repo-name",children:k.name}),(0,d.jsxs)("span",{className:"repo-owner",children:["@",null===(e=k.full_name)||void 0===e?void 0:e.split("/")[0]]})]})]})]}),(0,d.jsxs)("div",{className:"options-section",children:[(0,d.jsx)("div",{className:"include-personal",children:(0,d.jsxs)("label",{className:"checkbox-label",children:[(0,d.jsx)("input",{type:"checkbox",checked:x,onChange:e=>j(e.target.checked)}),(0,d.jsx)("span",{children:"Include my personal account as an option"})]})}),m?(0,d.jsxs)("div",{className:"loading",children:[(0,d.jsx)("div",{className:"spinner"}),(0,d.jsx)("p",{children:"Loading organizations..."})]}):z?(0,d.jsxs)("div",{className:"error-state",children:[(0,d.jsx)("h3",{children:"Error loading organizations"}),(0,d.jsx)("p",{children:z}),(0,d.jsx)("button",{onClick:S,className:"retry-btn",children:"Try Again"})]}):0===L.length?(0,d.jsxs)("div",{className:"empty-state",children:[(0,d.jsx)("h3",{children:"No organizations available"}),(0,d.jsx)("p",{children:"Enable personal account option or join organizations to see options here."})]}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{className:"org-grid",children:L.map(e=>{var a,i,n,o;return(0,d.jsxs)("div",{className:"org-card ".concat((null===p||void 0===p?void 0:p.id)===e.id&&(null===p||void 0===p?void 0:p.type)===e.type?"selected":""," ").concat(e.isPersonal?"personal":""," ").concat(e.isWHO?"who-org":""),onClick:()=>(e=>{g(e)})(e),children:[(0,d.jsxs)("div",{className:"org-header-info",children:[(0,d.jsx)("img",{src:e.avatar_url||"https://github.com/".concat(e.login,".png"),alt:"".concat(e.display_name||e.login," avatar"),className:"org-avatar"}),(0,d.jsxs)("div",{className:"org-details",children:[(0,d.jsx)("h3",{children:e.display_name||e.login}),(0,d.jsxs)("p",{className:"org-login",children:["@",e.login]}),e.isPersonal&&(0,d.jsx)("span",{className:"personal-badge",children:"Personal"}),e.isWHO&&(0,d.jsx)("span",{className:"who-badge",children:"WHO Official"})]})]}),(0,d.jsx)("p",{className:"org-description",children:e.description||"No description available"}),(0,d.jsxs)("div",{className:"org-permissions",children:[(0,d.jsxs)("div",{className:"permission-item",children:[(0,d.jsx)("span",{className:"permission-icon ".concat(null!==(a=e.permissions)&&void 0!==a&&a.can_create_repositories?"allowed":"denied"),children:null!==(i=e.permissions)&&void 0!==i&&i.can_create_repositories?"\u2713":"\u2717"}),(0,d.jsx)("span",{children:"Create repositories"})]}),(0,d.jsxs)("div",{className:"permission-item",children:[(0,d.jsx)("span",{className:"permission-icon ".concat(null!==(n=e.permissions)&&void 0!==n&&n.can_create_private_repositories?"allowed":"denied"),children:null!==(o=e.permissions)&&void 0!==o&&o.can_create_private_repositories?"\u2713":"\u2717"}),(0,d.jsx)("span",{children:"Create private repositories"})]})]}),e.plan&&(0,d.jsxs)("div",{className:"org-plan",children:[(0,d.jsxs)("span",{className:"plan-name",children:[e.plan.name," Plan"]}),void 0!==e.plan.private_repos&&(0,d.jsxs)("span",{className:"plan-repos",children:[e.plan.private_repos," private repos"]})]}),(null===p||void 0===p?void 0:p.id)===e.id&&(null===p||void 0===p?void 0:p.type)===e.type&&(0,d.jsx)("div",{className:"selection-indicator",children:(0,d.jsx)("span",{children:"\u2713 Selected"})})]},"".concat(e.type,"-").concat(e.id))})}),(0,d.jsx)("div",{className:"org-footer",children:(0,d.jsx)("button",{className:"continue-btn",onClick:()=>{if(!p)return void alert("Please select an organization to continue");const e=w();"fork"===O?i(e.nextRoute,{state:{profile:A,repository:(0,n.A)((0,n.A)({},k),{},{full_name:"".concat(p.login,"/").concat(k.name),html_url:"https://github.com/".concat(p.login,"/").concat(k.name),owner:p}),sourceRepository:k,destinationOrganization:p,action:O}}):"create"===O&&i(e.nextRoute,{state:{profile:A,templateRepository:k,destinationOrganization:p,action:O}})},disabled:!p,children:H.buttonText})})]})]})]})]}):(0,d.jsx)("div",{children:"Redirecting..."}),(0,d.jsx)(l.A,{isOpen:_,onClose:()=>{y(!1),N(null)},samlInfo:f})]})}},53155:(e,a,i)=>{i.d(a,{A:()=>l});var n=i(9950),o=i(85571),t=i(36241),r=i(78952),s=i(44414);const l=e=>{let{isOpen:a,onClose:i,samlInfo:l,onAuthorizationComplete:c,pollingInterval:d=3e3,pollingTimeout:h=3e5}=e;const u=o.A.getLogger("SAMLAuthModal"),[p,g]=(0,n.useState)(!1),[m,v]=(0,n.useState)(null),[z,b]=(0,n.useState)(null),x=(0,n.useRef)(null),j=(0,n.useRef)(null),_=(0,n.useRef)(null);(0,n.useEffect)(()=>{a&&null!==l&&void 0!==l&&l.originalRequest&&(_.current=l.originalRequest)},[a,l]);const y=(0,n.useCallback)(async()=>{if(null===l||void 0===l||!l.organization)return!1;try{if(u.debug("Checking SAML authorization status",{organization:l.organization,repository:l.repository}),_.current)try{return await _.current(),u.info("SAML authorization successful - original request succeeded",{organization:l.organization}),!0}catch(a){var e;return(403!==a.status||null===(e=a.message)||void 0===e||!e.toLowerCase().includes("saml"))&&(u.warn("Original request failed with non-SAML error",{organization:l.organization,error:a.message}),!0)}return!1}catch(a){return u.error("Error checking SAML status",{organization:l.organization,error:a.message}),!1}},[l,u]),f=(0,n.useCallback)(()=>{x.current&&(clearInterval(x.current),x.current=null,g(!1),v(null),j.current=null,u.debug("Polling stopped",{organization:null===l||void 0===l?void 0:l.organization}))},[l,u]),N=(0,n.useCallback)(()=>{!p&&null!==l&&void 0!==l&&l.organization&&(g(!0),j.current=Date.now(),v("Waiting for authorization..."),u.info("Started polling for SAML authorization",{organization:l.organization,pollingInterval:d,pollingTimeout:h}),t.A.isAvailable()&&t.A.broadcast(t.B.SAML_POLLING_STARTED,{organization:l.organization,timestamp:Date.now()}),x.current=setInterval(async()=>{const e=Date.now()-j.current;if(e>h)return u.warn("SAML polling timeout reached",{organization:l.organization,elapsedTime:e,timeout:h}),v("Authorization check timed out. Please try again."),void f();await y()?(u.info("SAML authorization detected",{organization:l.organization,elapsedTime:e}),r.A.markSAMLAuthorized(l.organization,l.repository),c&&c({organization:l.organization,repository:l.repository}),v("Authorization successful!"),setTimeout(()=>{f(),i()},1e3)):u.debug("SAML authorization not yet complete",{organization:l.organization,elapsedTime:e})},d))},[p,l,d,h,y,f,c,i,u]);if((0,n.useEffect)(()=>{if(!a||null===l||void 0===l||!l.organization)return;return t.A.on(t.B.SAML_AUTHENTICATED,e=>{e.organization===l.organization&&(u.debug("SAML authentication detected from another tab",{organization:e.organization}),f(),i())})},[a,l,f,i,u]),(0,n.useEffect)(()=>{a||(f(),z&&!z.closed&&u.debug("Closing SSO window",{organization:null===l||void 0===l?void 0:l.organization}))},[a,z,l,f,u]),(0,n.useEffect)(()=>(a&&l&&u.componentMount({organization:l.organization,repository:l.repository}),()=>{a&&(f(),u.componentUnmount())}),[u,a,l,f]),!a||!l)return null;const{organization:A,repository:k,authorizationUrl:O}=l,w=()=>{u.userAction("SAML modal closed",{organization:A}),f(),i()};return(0,s.jsx)("div",{className:"saml-modal-overlay",onClick:w,onKeyDown:e=>"Escape"===e.key&&w(),role:"dialog","aria-modal":"true","aria-labelledby":"saml-modal-title",tabIndex:-1,children:(0,s.jsxs)("div",{className:"saml-modal",onClick:e=>e.stopPropagation(),onKeyDown:e=>e.stopPropagation(),role:"document",children:[(0,s.jsxs)("div",{className:"saml-modal-header",children:[(0,s.jsx)("h2",{id:"saml-modal-title",children:"\ud83d\udd10 SAML SSO Authorization Required"}),(0,s.jsx)("button",{onClick:w,className:"close-button","aria-label":"Close",children:"\xd7"})]}),(0,s.jsxs)("div",{className:"saml-modal-content",children:[(0,s.jsxs)("div",{className:"saml-info-section",children:[(0,s.jsx)("div",{className:"saml-icon",children:(0,s.jsx)("span",{role:"img","aria-label":"lock",children:"\ud83d\udd12"})}),(0,s.jsx)("h3",{children:"Organization Access Required"}),(0,s.jsxs)("p",{className:"saml-description",children:["Your Personal Access Token needs SAML SSO authorization to access the"," ",(0,s.jsx)("strong",{children:A})," organization",k?" and the ".concat(k," repository"):"","."]})]}),(0,s.jsxs)("div",{className:"saml-steps-section",children:[(0,s.jsx)("h4",{children:"How to authorize your token:"}),(0,s.jsxs)("ol",{className:"saml-steps",children:[(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:'Click "Authorize on GitHub"'})," below to open the authorization page"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Review the permissions"})," requested by the organization"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:'Click "Authorize"'})," to grant your token access"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"This modal will automatically detect"})," when authorization is complete"]})]})]}),p&&(0,s.jsxs)("div",{className:"saml-polling-status",children:[(0,s.jsx)("span",{className:"polling-spinner",children:"\u23f3"}),(0,s.jsx)("p",{children:m})]}),(0,s.jsxs)("div",{className:"saml-note",children:[(0,s.jsx)("span",{className:"note-icon",children:"\u2139\ufe0f"}),(0,s.jsxs)("p",{children:["This is a GitHub security feature for organizations using SAML SSO. You only need to authorize once per organization per token.",!p&&' Click "Later" to dismiss for 1 minute.']})]}),(0,s.jsx)("div",{className:"saml-modal-actions",children:p?(0,s.jsx)("button",{onClick:w,className:"saml-cancel-btn",children:"Cancel"}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{onClick:()=>{u.userAction("Authorize SAML clicked",{organization:A,authorizationUrl:O});const e=window.open(O,"_blank","noopener,noreferrer");b(e),u.info("SAML authorization page opened",{organization:A,instruction:"Polling will check for authorization completion"}),N()},className:"saml-authorize-btn",children:"\ud83d\udd13 Authorize on GitHub"}),(0,s.jsx)("button",{onClick:()=>{u.userAction('SAML modal "Later" clicked',{organization:A}),f(),r.A.clearCooldown(A),i()},className:"saml-cancel-btn",children:"Later"})]})})]})]})})}}}]);