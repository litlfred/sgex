"use strict";(self.webpackChunksgex_workbench=self.webpackChunksgex_workbench||[]).push([[8700],{53155:(e,a,i)=>{i.d(a,{A:()=>l});var n=i(9950),o=i(85571),s=i(36241),t=i(78952),r=i(44414);const l=e=>{let{isOpen:a,onClose:i,samlInfo:l,onAuthorizationComplete:c,pollingInterval:d=3e3,pollingTimeout:u=3e5}=e;const g=o.A.getLogger("SAMLAuthModal"),[h,m]=(0,n.useState)(!1),[p,z]=(0,n.useState)(null),[x,f]=(0,n.useState)(null),j=(0,n.useRef)(null),v=(0,n.useRef)(null),A=(0,n.useRef)(null);(0,n.useEffect)(()=>{a&&null!==l&&void 0!==l&&l.originalRequest&&(A.current=l.originalRequest)},[a,l]);const b=(0,n.useCallback)(async()=>{if(null===l||void 0===l||!l.organization)return!1;try{if(g.debug("Checking SAML authorization status",{organization:l.organization,repository:l.repository}),A.current)try{return await A.current(),g.info("SAML authorization successful - original request succeeded",{organization:l.organization}),!0}catch(a){var e;return(403!==a.status||null===(e=a.message)||void 0===e||!e.toLowerCase().includes("saml"))&&(g.warn("Original request failed with non-SAML error",{organization:l.organization,error:a.message}),!0)}return!1}catch(a){return g.error("Error checking SAML status",{organization:l.organization,error:a.message}),!1}},[l,g]),N=(0,n.useCallback)(()=>{j.current&&(clearInterval(j.current),j.current=null,m(!1),z(null),v.current=null,g.debug("Polling stopped",{organization:null===l||void 0===l?void 0:l.organization}))},[l,g]),k=(0,n.useCallback)(()=>{!h&&null!==l&&void 0!==l&&l.organization&&(m(!0),v.current=Date.now(),z("Waiting for authorization..."),g.info("Started polling for SAML authorization",{organization:l.organization,pollingInterval:d,pollingTimeout:u}),s.A.isAvailable()&&s.A.broadcast(s.B.SAML_POLLING_STARTED,{organization:l.organization,timestamp:Date.now()}),j.current=setInterval(async()=>{const e=Date.now()-v.current;if(e>u)return g.warn("SAML polling timeout reached",{organization:l.organization,elapsedTime:e,timeout:u}),z("Authorization check timed out. Please try again."),void N();await b()?(g.info("SAML authorization detected",{organization:l.organization,elapsedTime:e}),t.A.markSAMLAuthorized(l.organization,l.repository),c&&c({organization:l.organization,repository:l.repository}),z("Authorization successful!"),setTimeout(()=>{N(),i()},1e3)):g.debug("SAML authorization not yet complete",{organization:l.organization,elapsedTime:e})},d))},[h,l,d,u,b,N,c,i,g]);if((0,n.useEffect)(()=>{if(!a||null===l||void 0===l||!l.organization)return;return s.A.on(s.B.SAML_AUTHENTICATED,e=>{e.organization===l.organization&&(g.debug("SAML authentication detected from another tab",{organization:e.organization}),N(),i())})},[a,l,N,i,g]),(0,n.useEffect)(()=>{a||(N(),x&&!x.closed&&g.debug("Closing SSO window",{organization:null===l||void 0===l?void 0:l.organization}))},[a,x,l,N,g]),(0,n.useEffect)(()=>(a&&l&&g.componentMount({organization:l.organization,repository:l.repository}),()=>{a&&(N(),g.componentUnmount())}),[g,a,l,N]),!a||!l)return null;const{organization:w,repository:S,authorizationUrl:y}=l,C=()=>{g.userAction("SAML modal closed",{organization:w}),N(),i()};return(0,r.jsx)("div",{className:"saml-modal-overlay",onClick:C,onKeyDown:e=>"Escape"===e.key&&C(),role:"dialog","aria-modal":"true","aria-labelledby":"saml-modal-title",tabIndex:-1,children:(0,r.jsxs)("div",{className:"saml-modal",onClick:e=>e.stopPropagation(),onKeyDown:e=>e.stopPropagation(),role:"document",children:[(0,r.jsxs)("div",{className:"saml-modal-header",children:[(0,r.jsx)("h2",{id:"saml-modal-title",children:"\ud83d\udd10 SAML SSO Authorization Required"}),(0,r.jsx)("button",{onClick:C,className:"close-button","aria-label":"Close",children:"\xd7"})]}),(0,r.jsxs)("div",{className:"saml-modal-content",children:[(0,r.jsxs)("div",{className:"saml-info-section",children:[(0,r.jsx)("div",{className:"saml-icon",children:(0,r.jsx)("span",{role:"img","aria-label":"lock",children:"\ud83d\udd12"})}),(0,r.jsx)("h3",{children:"Organization Access Required"}),(0,r.jsxs)("p",{className:"saml-description",children:["Your Personal Access Token needs SAML SSO authorization to access the"," ",(0,r.jsx)("strong",{children:w})," organization",S?" and the ".concat(S," repository"):"","."]})]}),(0,r.jsxs)("div",{className:"saml-steps-section",children:[(0,r.jsx)("h4",{children:"How to authorize your token:"}),(0,r.jsxs)("ol",{className:"saml-steps",children:[(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:'Click "Authorize on GitHub"'})," below to open the authorization page"]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"Review the permissions"})," requested by the organization"]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:'Click "Authorize"'})," to grant your token access"]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"This modal will automatically detect"})," when authorization is complete"]})]})]}),h&&(0,r.jsxs)("div",{className:"saml-polling-status",children:[(0,r.jsx)("span",{className:"polling-spinner",children:"\u23f3"}),(0,r.jsx)("p",{children:p})]}),(0,r.jsxs)("div",{className:"saml-note",children:[(0,r.jsx)("span",{className:"note-icon",children:"\u2139\ufe0f"}),(0,r.jsxs)("p",{children:["This is a GitHub security feature for organizations using SAML SSO. You only need to authorize once per organization per token.",!h&&' Click "Later" to dismiss for 1 minute.']})]}),(0,r.jsx)("div",{className:"saml-modal-actions",children:h?(0,r.jsx)("button",{onClick:C,className:"saml-cancel-btn",children:"Cancel"}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{onClick:()=>{g.userAction("Authorize SAML clicked",{organization:w,authorizationUrl:y});const e=window.open(y,"_blank","noopener,noreferrer");f(e),g.info("SAML authorization page opened",{organization:w,instruction:"Polling will check for authorization completion"}),k()},className:"saml-authorize-btn",children:"\ud83d\udd13 Authorize on GitHub"}),(0,r.jsx)("button",{onClick:()=>{g.userAction('SAML modal "Later" clicked',{organization:w}),N(),t.A.clearCooldown(w),i()},className:"saml-cancel-btn",children:"Later"})]})})]})]})})}},98700:(e,a,i)=>{i.r(a),i.d(a,{default:()=>m});var n=i(89379),o=i(9950),s=i(18518),t=i(67818),r=i(46901),l=i(29473),c=i(78952),d=i(53155),u=i(53782),g=i(1932),h=i(44414);const m=()=>{const{t:e}=(0,t.Bd)(),[a,i]=(0,o.useState)(null),[m,p]=(0,o.useState)([]),[z,x]=(0,o.useState)(!1),[f,j]=(0,o.useState)(!1),[v,A]=(0,o.useState)(null),[b,N]=(0,o.useState)({}),[k,w]=(0,o.useState)(null),[S,y]=(0,o.useState)(!1),[C,L]=(0,o.useState)(null),O=(0,s.Zp)(),M=(0,s.zy)(),H=(0,o.useCallback)((e,a)=>{if(!r.A.isAuth())return;const i={};if(e){const a=l.A.getCachedRepositories(e.login,"user");a&&a.repositories&&(i["user-".concat(e.login)]=a.repositories.length)}a.forEach(e=>{const a=l.A.getCachedRepositories(e.login,"org");a&&a.repositories&&(i["org-".concat(e.login)]=a.repositories.length)}),N(i)},[]),T=(0,o.useCallback)(async()=>{j(!0),A(null);try{let a=null;z?(await r.A.checkTokenPermissions(),a=await r.A.getCurrentUser(),i(a)):(a=null,i(null));let o=[];if(z)try{o=await r.A.getUserOrganizations()}catch(v){console.error("Error fetching organizations:",v),o=[]}try{const e=await r.A.getWHOOrganization(),a=o.findIndex(e=>"WorldHealthOrganization"===e.login);a>=0?o[a]=(0,n.A)((0,n.A)((0,n.A)({},o[a]),e),{},{isWHO:!0}):o.unshift(e)}catch(e){console.warn("Could not fetch WHO organization data, using fallback:",e);const a={id:"who-organization",login:"WorldHealthOrganization",name:"World Health Organization",description:"The World Health Organization is a specialized agency of the United Nations responsible for international public health.",avatar_url:"https://avatars.githubusercontent.com/u/12261302?s=200&v=4",html_url:"https://github.com/WorldHealthOrganization",type:"Organization",isWHO:!0};o.some(e=>"WorldHealthOrganization"===e.login)?o=o.map(e=>"WorldHealthOrganization"===e.login?(0,n.A)((0,n.A)({},e),{},{isWHO:!0}):e):o.unshift(a)}p(o),z&&H(a,o)}catch(v){console.error("Error fetching user data:",v),z?(A("Failed to fetch user data. Please check your connection and try again."),x(!1),r.A.logout()):A("Unable to fetch additional data. Some features may be limited.")}finally{j(!1)}},[H,z]);(0,o.useEffect)(()=>{(()=>{const e=r.A.initializeFromStoredToken();x(!!e)})()},[]),(0,o.useEffect)(()=>{c.A.registerModalCallback(e=>{L(e),y(!0)})},[]),(0,o.useEffect)(()=>{var e;null!==(e=M.state)&&void 0!==e&&e.warningMessage&&(w(M.state.warningMessage),O(M.pathname,{replace:!0,state:{}}))},[M.state,O,M.pathname]),(0,o.useEffect)(()=>{a||T()},[a,T]);const E=(e,a)=>{const i={profile:a};(0,g.hX)(e,"/dak-action/".concat(a.login),O,i)};return(0,h.jsxs)(u.Mx,{pageName:"select-profile",children:[f&&!a?(0,h.jsxs)("div",{className:"loading-section",children:[(0,h.jsx)("div",{className:"spinner"}),(0,h.jsx)("p",{children:"Loading profile data..."})]}):(0,h.jsxs)("div",{className:"select-profile-content",children:[k&&(0,h.jsx)("div",{className:"warning-message",children:(0,h.jsxs)("div",{className:"warning-content",children:[(0,h.jsxs)("div",{className:"warning-header",children:[(0,h.jsx)("span",{className:"warning-icon",children:"\u26a0\ufe0f"}),(0,h.jsx)("span",{className:"warning-text",children:k})]}),(0,h.jsx)("button",{className:"warning-dismiss",onClick:()=>{w(null)},"aria-label":"Dismiss warning",children:"\xd7 Dismiss"})]})}),!z&&(0,h.jsx)("div",{className:"auth-status-message",children:(0,h.jsxs)("div",{className:"auth-status-content",children:[(0,h.jsx)("span",{className:"auth-status-icon",children:"\ud83d\udd13"}),(0,h.jsx)("span",{className:"auth-status-text",children:"You are browsing in unauthenticated mode. Some features like saving to GitHub will be disabled, but you can still explore and use local staging."})]})}),f?(0,h.jsxs)("div",{className:"loading-section",children:[(0,h.jsx)("div",{className:"spinner"}),(0,h.jsx)("p",{children:"Loading profile data..."})]}):(0,h.jsxs)("div",{className:"profile-selection",children:[(0,h.jsx)("h2",{children:e("organization.select")}),(0,h.jsxs)("p",{children:[e("organization.personal"),":"]}),v&&(0,h.jsx)("div",{className:"error-message",children:v}),(0,h.jsxs)("div",{className:"profile-grid-horizontal",children:[z&&a&&(0,h.jsxs)("div",{className:"profile-card",onClick:e=>E(e,(0,n.A)({type:"user"},a)),children:[(0,h.jsxs)("div",{className:"profile-card-header",children:[(0,h.jsx)("img",{src:null===a||void 0===a?void 0:a.avatar_url,alt:"Personal profile"}),b["user-".concat(null===a||void 0===a?void 0:a.login)]>0&&(0,h.jsx)("div",{className:"dak-count-badge",children:b["user-".concat(null===a||void 0===a?void 0:a.login)]})]}),(0,h.jsx)("h3",{children:(null===a||void 0===a?void 0:a.name)||(null===a||void 0===a?void 0:a.login)}),(0,h.jsx)("p",{children:"Personal repositories"}),(0,h.jsx)("div",{className:"profile-badges",children:(0,h.jsx)("span",{className:"profile-type",children:"Personal"})})]}),m.map(a=>(0,h.jsxs)("div",{className:"profile-card ".concat(a.isWHO?"who-org":""),onClick:e=>E(e,(0,n.A)({type:"org"},a)),children:[(0,h.jsxs)("div",{className:"profile-card-header",children:[(0,h.jsx)("img",{src:a.avatar_url||"https://github.com/".concat(a.login,".png"),alt:"".concat(a.name||a.login," organization")}),b["org-".concat(a.login)]>0&&(0,h.jsx)("div",{className:"dak-count-badge",children:b["org-".concat(a.login)]})]}),(0,h.jsx)("h3",{children:a.name||a.login}),(0,h.jsxs)("p",{children:["@",a.login]}),(0,h.jsxs)("div",{className:"profile-badges",children:[(0,h.jsx)("span",{className:"profile-type",children:e("organization.organizations")}),a.isWHO&&(0,h.jsx)("span",{className:"who-badge",children:"WHO Official"})]})]},a.login))]})]})]}),(0,h.jsx)(d.A,{isOpen:S,onClose:()=>{y(!1),L(null)},samlInfo:C})]})}}}]);